{"version":3,"file":"index-umd.min.js","sources":["../editor/touch.js","../editor/namespaces.js","../editor/svgpathseg.js","../editor/browser.js","../editor/jQuery.attr.js","../editor/svgtransformlist.js","../editor/units.js","../editor/history.js","../editor/math.js","../editor/path.js","../editor/utilities.js","../editor/contextmenu.js","../editor/external/dynamic-import-polyfill/importModule.js","../editor/layer.js","../editor/historyrecording.js","../editor/draw.js","../editor/sanitize.js","../editor/coords.js","../editor/recalculate.js","../editor/select.js","../editor/svgcanvas.js","../editor/jgraduate/jQuery.jGraduate.js","../editor/jgraduate/jQuery.jPicker.js","../editor/locale/locale.js","../editor/svg-editor.js","../editor/js-hotkeys/jquery.hotkeys.min.js","../editor/jquerybbq/jquery.bbq.min.js","../editor/svgicons/jQuery.svgIcons.js","../editor/spinbtn/jQuery.SpinButton.js","../editor/contextmenu/jQuery.contextMenu.js","../editor/external/load-stylesheets/index-es.js"],"sourcesContent":["// http://ross.posterous.com/2008/08/19/iphone-touch-events-in-javascript/\nfunction touchHandler (ev) {\n  const {changedTouches} = ev,\n    first = changedTouches[0];\n\n  let type = '';\n  switch (ev.type) {\n  case 'touchstart': type = 'mousedown'; break;\n  case 'touchmove': type = 'mousemove'; break;\n  case 'touchend': type = 'mouseup'; break;\n  default: return;\n  }\n\n  const {screenX, screenY, clientX, clientY} = first;\n  const simulatedEvent = new MouseEvent(type, {\n    // Event interface\n    bubbles: true,\n    cancelable: true,\n    // UIEvent interface\n    view: window,\n    detail: 1, // click count\n    // MouseEvent interface (customized)\n    screenX, screenY, clientX, clientY,\n    // MouseEvent interface (defaults) - these could be removed\n    ctrlKey: false,\n    altKey: false,\n    shiftKey: false,\n    metaKey: false,\n    button: 0, // main button (usually left)\n    relatedTarget: null\n  });\n  if (changedTouches.length < 2) {\n    first.target.dispatchEvent(simulatedEvent);\n    ev.preventDefault();\n  }\n}\n\ndocument.addEventListener('touchstart', touchHandler, true);\ndocument.addEventListener('touchmove', touchHandler, true);\ndocument.addEventListener('touchend', touchHandler, true);\ndocument.addEventListener('touchcancel', touchHandler, true);\n","/**\n * Namespaces or tools therefor\n * @module namespaces\n * @license MIT\n*/\n\n/**\n* Common namepaces constants in alpha order\n* @enum {string}\n* @type {PlainObject}\n* @memberof module:namespaces\n*/\nexport const NS = {\n  HTML: 'http://www.w3.org/1999/xhtml',\n  MATH: 'http://www.w3.org/1998/Math/MathML',\n  SE: 'http://svg-edit.googlecode.com',\n  SVG: 'http://www.w3.org/2000/svg',\n  XLINK: 'http://www.w3.org/1999/xlink',\n  XML: 'http://www.w3.org/XML/1998/namespace',\n  XMLNS: 'http://www.w3.org/2000/xmlns/' // see http://www.w3.org/TR/REC-xml-names/#xmlReserved\n};\n\n/**\n* @function module:namespaces.getReverseNS\n* @returns {string} The NS with key values switched and lowercase\n*/\nexport const getReverseNS = function () {\n  const reverseNS = {};\n  Object.entries(NS).forEach(([name, URI]) => {\n    reverseNS[URI] = name.toLowerCase();\n  });\n  return reverseNS;\n};\n","/**\n* SVGPathSeg API polyfill\n* https://github.com/progers/pathseg\n*\n* This is a drop-in replacement for the `SVGPathSeg` and `SVGPathSegList` APIs\n* that were removed from SVG2 ({@link https://lists.w3.org/Archives/Public/www-svg/2015Jun/0044.html}),\n* including the latest spec changes which were implemented in Firefox 43 and\n* Chrome 46.\n*/\n(() => {\nif (!('SVGPathSeg' in window)) {\n  // Spec: https://www.w3.org/TR/SVG11/single-page.html#paths-InterfaceSVGPathSeg\n  class SVGPathSeg {\n    constructor (type, typeAsLetter, owningPathSegList) {\n      this.pathSegType = type;\n      this.pathSegTypeAsLetter = typeAsLetter;\n      this._owningPathSegList = owningPathSegList;\n    }\n    // Notify owning PathSegList on any changes so they can be synchronized back to the path element.\n    _segmentChanged () {\n      if (this._owningPathSegList) {\n        this._owningPathSegList.segmentChanged(this);\n      }\n    }\n  }\n  SVGPathSeg.prototype.classname = 'SVGPathSeg';\n\n  SVGPathSeg.PATHSEG_UNKNOWN = 0;\n  SVGPathSeg.PATHSEG_CLOSEPATH = 1;\n  SVGPathSeg.PATHSEG_MOVETO_ABS = 2;\n  SVGPathSeg.PATHSEG_MOVETO_REL = 3;\n  SVGPathSeg.PATHSEG_LINETO_ABS = 4;\n  SVGPathSeg.PATHSEG_LINETO_REL = 5;\n  SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS = 6;\n  SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL = 7;\n  SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS = 8;\n  SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL = 9;\n  SVGPathSeg.PATHSEG_ARC_ABS = 10;\n  SVGPathSeg.PATHSEG_ARC_REL = 11;\n  SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS = 12;\n  SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL = 13;\n  SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS = 14;\n  SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL = 15;\n  SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS = 16;\n  SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL = 17;\n  SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS = 18;\n  SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL = 19;\n\n  class SVGPathSegClosePath extends SVGPathSeg {\n    constructor (owningPathSegList) {\n      super(SVGPathSeg.PATHSEG_CLOSEPATH, 'z', owningPathSegList);\n    }\n    toString () { return '[object SVGPathSegClosePath]'; }\n    _asPathString () { return this.pathSegTypeAsLetter; }\n    clone () { return new SVGPathSegClosePath(undefined); }\n  }\n\n  class SVGPathSegMovetoAbs extends SVGPathSeg {\n    constructor (owningPathSegList, x, y) {\n      super(SVGPathSeg.PATHSEG_MOVETO_ABS, 'M', owningPathSegList);\n      this._x = x;\n      this._y = y;\n    }\n    toString () { return '[object SVGPathSegMovetoAbs]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegMovetoAbs(undefined, this._x, this._y); }\n  }\n  Object.defineProperties(SVGPathSegMovetoAbs.prototype, {\n    x: {\n      get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true\n    },\n    y: {\n      get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true\n    }\n  });\n\n  class SVGPathSegMovetoRel extends SVGPathSeg {\n    constructor (owningPathSegList, x, y) {\n      super(SVGPathSeg.PATHSEG_MOVETO_REL, 'm', owningPathSegList);\n      this._x = x;\n      this._y = y;\n    }\n    toString () { return '[object SVGPathSegMovetoRel]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegMovetoRel(undefined, this._x, this._y); }\n  }\n  Object.defineProperties(SVGPathSegMovetoRel.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegLinetoAbs extends SVGPathSeg {\n    constructor (owningPathSegList, x, y) {\n      super(SVGPathSeg.PATHSEG_LINETO_ABS, 'L', owningPathSegList);\n      this._x = x;\n      this._y = y;\n    }\n    toString () { return '[object SVGPathSegLinetoAbs]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegLinetoAbs(undefined, this._x, this._y); }\n  }\n  Object.defineProperties(SVGPathSegLinetoAbs.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegLinetoRel extends SVGPathSeg {\n    constructor (owningPathSegList, x, y) {\n      super(SVGPathSeg.PATHSEG_LINETO_REL, 'l', owningPathSegList);\n      this._x = x;\n      this._y = y;\n    }\n    toString () { return '[object SVGPathSegLinetoRel]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegLinetoRel(undefined, this._x, this._y); }\n  }\n  Object.defineProperties(SVGPathSegLinetoRel.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegCurvetoCubicAbs extends SVGPathSeg {\n    constructor (owningPathSegList, x, y, x1, y1, x2, y2) {\n      super(SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS, 'C', owningPathSegList);\n      this._x = x;\n      this._y = y;\n      this._x1 = x1;\n      this._y1 = y1;\n      this._x2 = x2;\n      this._y2 = y2;\n    }\n    toString () { return '[object SVGPathSegCurvetoCubicAbs]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x1 + ' ' + this._y1 + ' ' + this._x2 + ' ' + this._y2 + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegCurvetoCubicAbs(undefined, this._x, this._y, this._x1, this._y1, this._x2, this._y2); }\n  }\n  Object.defineProperties(SVGPathSegCurvetoCubicAbs.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true },\n    x1: { get () { return this._x1; }, set (x1) { this._x1 = x1; this._segmentChanged(); }, enumerable: true },\n    y1: { get () { return this._y1; }, set (y1) { this._y1 = y1; this._segmentChanged(); }, enumerable: true },\n    x2: { get () { return this._x2; }, set (x2) { this._x2 = x2; this._segmentChanged(); }, enumerable: true },\n    y2: { get () { return this._y2; }, set (y2) { this._y2 = y2; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegCurvetoCubicRel extends SVGPathSeg {\n    constructor (owningPathSegList, x, y, x1, y1, x2, y2) {\n      super(SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL, 'c', owningPathSegList);\n      this._x = x;\n      this._y = y;\n      this._x1 = x1;\n      this._y1 = y1;\n      this._x2 = x2;\n      this._y2 = y2;\n    }\n    toString () { return '[object SVGPathSegCurvetoCubicRel]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x1 + ' ' + this._y1 + ' ' + this._x2 + ' ' + this._y2 + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegCurvetoCubicRel(undefined, this._x, this._y, this._x1, this._y1, this._x2, this._y2); }\n  }\n  Object.defineProperties(SVGPathSegCurvetoCubicRel.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true },\n    x1: { get () { return this._x1; }, set (x1) { this._x1 = x1; this._segmentChanged(); }, enumerable: true },\n    y1: { get () { return this._y1; }, set (y1) { this._y1 = y1; this._segmentChanged(); }, enumerable: true },\n    x2: { get () { return this._x2; }, set (x2) { this._x2 = x2; this._segmentChanged(); }, enumerable: true },\n    y2: { get () { return this._y2; }, set (y2) { this._y2 = y2; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegCurvetoQuadraticAbs extends SVGPathSeg {\n    constructor (owningPathSegList, x, y, x1, y1) {\n      super(SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS, 'Q', owningPathSegList);\n      this._x = x;\n      this._y = y;\n      this._x1 = x1;\n      this._y1 = y1;\n    }\n    toString () { return '[object SVGPathSegCurvetoQuadraticAbs]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x1 + ' ' + this._y1 + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegCurvetoQuadraticAbs(undefined, this._x, this._y, this._x1, this._y1); }\n  }\n  Object.defineProperties(SVGPathSegCurvetoQuadraticAbs.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true },\n    x1: { get () { return this._x1; }, set (x1) { this._x1 = x1; this._segmentChanged(); }, enumerable: true },\n    y1: { get () { return this._y1; }, set (y1) { this._y1 = y1; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegCurvetoQuadraticRel extends SVGPathSeg {\n    constructor (owningPathSegList, x, y, x1, y1) {\n      super(SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL, 'q', owningPathSegList);\n      this._x = x;\n      this._y = y;\n      this._x1 = x1;\n      this._y1 = y1;\n    }\n    toString () { return '[object SVGPathSegCurvetoQuadraticRel]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x1 + ' ' + this._y1 + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegCurvetoQuadraticRel(undefined, this._x, this._y, this._x1, this._y1); }\n  }\n  Object.defineProperties(SVGPathSegCurvetoQuadraticRel.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true },\n    x1: { get () { return this._x1; }, set (x1) { this._x1 = x1; this._segmentChanged(); }, enumerable: true },\n    y1: { get () { return this._y1; }, set (y1) { this._y1 = y1; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegArcAbs extends SVGPathSeg {\n    constructor (owningPathSegList, x, y, r1, r2, angle, largeArcFlag, sweepFlag) {\n      super(SVGPathSeg.PATHSEG_ARC_ABS, 'A', owningPathSegList);\n      this._x = x;\n      this._y = y;\n      this._r1 = r1;\n      this._r2 = r2;\n      this._angle = angle;\n      this._largeArcFlag = largeArcFlag;\n      this._sweepFlag = sweepFlag;\n    }\n    toString () { return '[object SVGPathSegArcAbs]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._r1 + ' ' + this._r2 + ' ' + this._angle + ' ' + (this._largeArcFlag ? '1' : '0') + ' ' + (this._sweepFlag ? '1' : '0') + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegArcAbs(undefined, this._x, this._y, this._r1, this._r2, this._angle, this._largeArcFlag, this._sweepFlag); }\n  }\n  Object.defineProperties(SVGPathSegArcAbs.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true },\n    r1: { get () { return this._r1; }, set (r1) { this._r1 = r1; this._segmentChanged(); }, enumerable: true },\n    r2: { get () { return this._r2; }, set (r2) { this._r2 = r2; this._segmentChanged(); }, enumerable: true },\n    angle: { get () { return this._angle; }, set (angle) { this._angle = angle; this._segmentChanged(); }, enumerable: true },\n    largeArcFlag: { get () { return this._largeArcFlag; }, set (largeArcFlag) { this._largeArcFlag = largeArcFlag; this._segmentChanged(); }, enumerable: true },\n    sweepFlag: { get () { return this._sweepFlag; }, set (sweepFlag) { this._sweepFlag = sweepFlag; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegArcRel extends SVGPathSeg {\n    constructor (owningPathSegList, x, y, r1, r2, angle, largeArcFlag, sweepFlag) {\n      super(SVGPathSeg.PATHSEG_ARC_REL, 'a', owningPathSegList);\n      this._x = x;\n      this._y = y;\n      this._r1 = r1;\n      this._r2 = r2;\n      this._angle = angle;\n      this._largeArcFlag = largeArcFlag;\n      this._sweepFlag = sweepFlag;\n    }\n    toString () { return '[object SVGPathSegArcRel]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._r1 + ' ' + this._r2 + ' ' + this._angle + ' ' + (this._largeArcFlag ? '1' : '0') + ' ' + (this._sweepFlag ? '1' : '0') + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegArcRel(undefined, this._x, this._y, this._r1, this._r2, this._angle, this._largeArcFlag, this._sweepFlag); }\n  }\n  Object.defineProperties(SVGPathSegArcRel.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true },\n    r1: { get () { return this._r1; }, set (r1) { this._r1 = r1; this._segmentChanged(); }, enumerable: true },\n    r2: { get () { return this._r2; }, set (r2) { this._r2 = r2; this._segmentChanged(); }, enumerable: true },\n    angle: { get () { return this._angle; }, set (angle) { this._angle = angle; this._segmentChanged(); }, enumerable: true },\n    largeArcFlag: { get () { return this._largeArcFlag; }, set (largeArcFlag) { this._largeArcFlag = largeArcFlag; this._segmentChanged(); }, enumerable: true },\n    sweepFlag: { get () { return this._sweepFlag; }, set (sweepFlag) { this._sweepFlag = sweepFlag; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegLinetoHorizontalAbs extends SVGPathSeg {\n    constructor (owningPathSegList, x) {\n      super(SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS, 'H', owningPathSegList);\n      this._x = x;\n    }\n    toString () { return '[object SVGPathSegLinetoHorizontalAbs]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x; }\n    clone () { return new SVGPathSegLinetoHorizontalAbs(undefined, this._x); }\n  }\n  Object.defineProperty(SVGPathSegLinetoHorizontalAbs.prototype, 'x', { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true });\n\n  class SVGPathSegLinetoHorizontalRel extends SVGPathSeg {\n    constructor (owningPathSegList, x) {\n      super(SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL, 'h', owningPathSegList);\n      this._x = x;\n    }\n    toString () { return '[object SVGPathSegLinetoHorizontalRel]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x; }\n    clone () { return new SVGPathSegLinetoHorizontalRel(undefined, this._x); }\n  }\n  Object.defineProperty(SVGPathSegLinetoHorizontalRel.prototype, 'x', { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true });\n\n  class SVGPathSegLinetoVerticalAbs extends SVGPathSeg {\n    constructor (owningPathSegList, y) {\n      super(SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS, 'V', owningPathSegList);\n      this._y = y;\n    }\n    toString () { return '[object SVGPathSegLinetoVerticalAbs]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._y; }\n    clone () { return new SVGPathSegLinetoVerticalAbs(undefined, this._y); }\n  }\n  Object.defineProperty(SVGPathSegLinetoVerticalAbs.prototype, 'y', { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true });\n\n  class SVGPathSegLinetoVerticalRel extends SVGPathSeg {\n    constructor (owningPathSegList, y) {\n      super(SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL, 'v', owningPathSegList);\n      this._y = y;\n    }\n    toString () { return '[object SVGPathSegLinetoVerticalRel]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._y; }\n    clone () { return new SVGPathSegLinetoVerticalRel(undefined, this._y); }\n  }\n  Object.defineProperty(SVGPathSegLinetoVerticalRel.prototype, 'y', { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true });\n\n  class SVGPathSegCurvetoCubicSmoothAbs extends SVGPathSeg {\n    constructor (owningPathSegList, x, y, x2, y2) {\n      super(SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS, 'S', owningPathSegList);\n      this._x = x;\n      this._y = y;\n      this._x2 = x2;\n      this._y2 = y2;\n    }\n    toString () { return '[object SVGPathSegCurvetoCubicSmoothAbs]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x2 + ' ' + this._y2 + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegCurvetoCubicSmoothAbs(undefined, this._x, this._y, this._x2, this._y2); }\n  }\n  Object.defineProperties(SVGPathSegCurvetoCubicSmoothAbs.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true },\n    x2: { get () { return this._x2; }, set (x2) { this._x2 = x2; this._segmentChanged(); }, enumerable: true },\n    y2: { get () { return this._y2; }, set (y2) { this._y2 = y2; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegCurvetoCubicSmoothRel extends SVGPathSeg {\n    constructor (owningPathSegList, x, y, x2, y2) {\n      super(SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL, 's', owningPathSegList);\n      this._x = x;\n      this._y = y;\n      this._x2 = x2;\n      this._y2 = y2;\n    }\n    toString () { return '[object SVGPathSegCurvetoCubicSmoothRel]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x2 + ' ' + this._y2 + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegCurvetoCubicSmoothRel(undefined, this._x, this._y, this._x2, this._y2); }\n  }\n  Object.defineProperties(SVGPathSegCurvetoCubicSmoothRel.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true },\n    x2: { get () { return this._x2; }, set (x2) { this._x2 = x2; this._segmentChanged(); }, enumerable: true },\n    y2: { get () { return this._y2; }, set (y2) { this._y2 = y2; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegCurvetoQuadraticSmoothAbs extends SVGPathSeg {\n    constructor (owningPathSegList, x, y) {\n      super(SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS, 'T', owningPathSegList);\n      this._x = x;\n      this._y = y;\n    }\n    toString () { return '[object SVGPathSegCurvetoQuadraticSmoothAbs]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegCurvetoQuadraticSmoothAbs(undefined, this._x, this._y); }\n  }\n  Object.defineProperties(SVGPathSegCurvetoQuadraticSmoothAbs.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true }\n  });\n\n  class SVGPathSegCurvetoQuadraticSmoothRel extends SVGPathSeg {\n    constructor (owningPathSegList, x, y) {\n      super(SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL, 't', owningPathSegList);\n      this._x = x;\n      this._y = y;\n    }\n    toString () { return '[object SVGPathSegCurvetoQuadraticSmoothRel]'; }\n    _asPathString () { return this.pathSegTypeAsLetter + ' ' + this._x + ' ' + this._y; }\n    clone () { return new SVGPathSegCurvetoQuadraticSmoothRel(undefined, this._x, this._y); }\n  }\n  Object.defineProperties(SVGPathSegCurvetoQuadraticSmoothRel.prototype, {\n    x: { get () { return this._x; }, set (x) { this._x = x; this._segmentChanged(); }, enumerable: true },\n    y: { get () { return this._y; }, set (y) { this._y = y; this._segmentChanged(); }, enumerable: true }\n  });\n\n  // Add createSVGPathSeg* functions to SVGPathElement.\n  // Spec: https://www.w3.org/TR/SVG11/single-page.html#paths-InterfaceSVGPathElement.\n  SVGPathElement.prototype.createSVGPathSegClosePath = function () { return new SVGPathSegClosePath(undefined); };\n  SVGPathElement.prototype.createSVGPathSegMovetoAbs = function (x, y) { return new SVGPathSegMovetoAbs(undefined, x, y); };\n  SVGPathElement.prototype.createSVGPathSegMovetoRel = function (x, y) { return new SVGPathSegMovetoRel(undefined, x, y); };\n  SVGPathElement.prototype.createSVGPathSegLinetoAbs = function (x, y) { return new SVGPathSegLinetoAbs(undefined, x, y); };\n  SVGPathElement.prototype.createSVGPathSegLinetoRel = function (x, y) { return new SVGPathSegLinetoRel(undefined, x, y); };\n  SVGPathElement.prototype.createSVGPathSegCurvetoCubicAbs = function (x, y, x1, y1, x2, y2) { return new SVGPathSegCurvetoCubicAbs(undefined, x, y, x1, y1, x2, y2); };\n  SVGPathElement.prototype.createSVGPathSegCurvetoCubicRel = function (x, y, x1, y1, x2, y2) { return new SVGPathSegCurvetoCubicRel(undefined, x, y, x1, y1, x2, y2); };\n  SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticAbs = function (x, y, x1, y1) { return new SVGPathSegCurvetoQuadraticAbs(undefined, x, y, x1, y1); };\n  SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticRel = function (x, y, x1, y1) { return new SVGPathSegCurvetoQuadraticRel(undefined, x, y, x1, y1); };\n  SVGPathElement.prototype.createSVGPathSegArcAbs = function (x, y, r1, r2, angle, largeArcFlag, sweepFlag) { return new SVGPathSegArcAbs(undefined, x, y, r1, r2, angle, largeArcFlag, sweepFlag); };\n  SVGPathElement.prototype.createSVGPathSegArcRel = function (x, y, r1, r2, angle, largeArcFlag, sweepFlag) { return new SVGPathSegArcRel(undefined, x, y, r1, r2, angle, largeArcFlag, sweepFlag); };\n  SVGPathElement.prototype.createSVGPathSegLinetoHorizontalAbs = function (x) { return new SVGPathSegLinetoHorizontalAbs(undefined, x); };\n  SVGPathElement.prototype.createSVGPathSegLinetoHorizontalRel = function (x) { return new SVGPathSegLinetoHorizontalRel(undefined, x); };\n  SVGPathElement.prototype.createSVGPathSegLinetoVerticalAbs = function (y) { return new SVGPathSegLinetoVerticalAbs(undefined, y); };\n  SVGPathElement.prototype.createSVGPathSegLinetoVerticalRel = function (y) { return new SVGPathSegLinetoVerticalRel(undefined, y); };\n  SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothAbs = function (x, y, x2, y2) { return new SVGPathSegCurvetoCubicSmoothAbs(undefined, x, y, x2, y2); };\n  SVGPathElement.prototype.createSVGPathSegCurvetoCubicSmoothRel = function (x, y, x2, y2) { return new SVGPathSegCurvetoCubicSmoothRel(undefined, x, y, x2, y2); };\n  SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothAbs = function (x, y) { return new SVGPathSegCurvetoQuadraticSmoothAbs(undefined, x, y); };\n  SVGPathElement.prototype.createSVGPathSegCurvetoQuadraticSmoothRel = function (x, y) { return new SVGPathSegCurvetoQuadraticSmoothRel(undefined, x, y); };\n\n  if (!('getPathSegAtLength' in SVGPathElement.prototype)) {\n    // Add getPathSegAtLength to SVGPathElement.\n    // Spec: https://www.w3.org/TR/SVG11/single-page.html#paths-__svg__SVGPathElement__getPathSegAtLength\n    // This polyfill requires SVGPathElement.getTotalLength to implement the distance-along-a-path algorithm.\n    SVGPathElement.prototype.getPathSegAtLength = function (distance) {\n      if (distance === undefined || !isFinite(distance)) {\n        throw new Error('Invalid arguments.');\n      }\n\n      const measurementElement = document.createElementNS('http://www.w3.org/2000/svg', 'path');\n      measurementElement.setAttribute('d', this.getAttribute('d'));\n      let lastPathSegment = measurementElement.pathSegList.numberOfItems - 1;\n\n      // If the path is empty, return 0.\n      if (lastPathSegment <= 0) {\n        return 0;\n      }\n\n      do {\n        measurementElement.pathSegList.removeItem(lastPathSegment);\n        if (distance > measurementElement.getTotalLength()) {\n          break;\n        }\n        lastPathSegment--;\n      } while (lastPathSegment > 0);\n      return lastPathSegment;\n    };\n  }\n\n  window.SVGPathSeg = SVGPathSeg;\n  window.SVGPathSegClosePath = SVGPathSegClosePath;\n  window.SVGPathSegMovetoAbs = SVGPathSegMovetoAbs;\n  window.SVGPathSegMovetoRel = SVGPathSegMovetoRel;\n  window.SVGPathSegLinetoAbs = SVGPathSegLinetoAbs;\n  window.SVGPathSegLinetoRel = SVGPathSegLinetoRel;\n  window.SVGPathSegCurvetoCubicAbs = SVGPathSegCurvetoCubicAbs;\n  window.SVGPathSegCurvetoCubicRel = SVGPathSegCurvetoCubicRel;\n  window.SVGPathSegCurvetoQuadraticAbs = SVGPathSegCurvetoQuadraticAbs;\n  window.SVGPathSegCurvetoQuadraticRel = SVGPathSegCurvetoQuadraticRel;\n  window.SVGPathSegArcAbs = SVGPathSegArcAbs;\n  window.SVGPathSegArcRel = SVGPathSegArcRel;\n  window.SVGPathSegLinetoHorizontalAbs = SVGPathSegLinetoHorizontalAbs;\n  window.SVGPathSegLinetoHorizontalRel = SVGPathSegLinetoHorizontalRel;\n  window.SVGPathSegLinetoVerticalAbs = SVGPathSegLinetoVerticalAbs;\n  window.SVGPathSegLinetoVerticalRel = SVGPathSegLinetoVerticalRel;\n  window.SVGPathSegCurvetoCubicSmoothAbs = SVGPathSegCurvetoCubicSmoothAbs;\n  window.SVGPathSegCurvetoCubicSmoothRel = SVGPathSegCurvetoCubicSmoothRel;\n  window.SVGPathSegCurvetoQuadraticSmoothAbs = SVGPathSegCurvetoQuadraticSmoothAbs;\n  window.SVGPathSegCurvetoQuadraticSmoothRel = SVGPathSegCurvetoQuadraticSmoothRel;\n}\n\n// Checking for SVGPathSegList in window checks for the case of an implementation without the\n// SVGPathSegList API.\n// The second check for appendItem is specific to Firefox 59+ which removed only parts of the\n// SVGPathSegList API (e.g., appendItem). In this case we need to re-implement the entire API\n// so the polyfill data (i.e., _list) is used throughout.\nif (!('SVGPathSegList' in window) || !('appendItem' in SVGPathSegList.prototype)) {\n  // Spec: https://www.w3.org/TR/SVG11/single-page.html#paths-InterfaceSVGPathSegList\n  class SVGPathSegList {\n    constructor (pathElement) {\n      this._pathElement = pathElement;\n      this._list = this._parsePath(this._pathElement.getAttribute('d'));\n\n      // Use a MutationObserver to catch changes to the path's \"d\" attribute.\n      this._mutationObserverConfig = {attributes: true, attributeFilter: ['d']};\n      this._pathElementMutationObserver = new MutationObserver(this._updateListFromPathMutations.bind(this));\n      this._pathElementMutationObserver.observe(this._pathElement, this._mutationObserverConfig);\n    }\n    // Process any pending mutations to the path element and update the list as needed.\n    // This should be the first call of all public functions and is needed because\n    // MutationObservers are not synchronous so we can have pending asynchronous mutations.\n    _checkPathSynchronizedToList () {\n      this._updateListFromPathMutations(this._pathElementMutationObserver.takeRecords());\n    }\n\n    _updateListFromPathMutations (mutationRecords) {\n      if (!this._pathElement) {\n        return;\n      }\n      let hasPathMutations = false;\n      mutationRecords.forEach((record) => {\n        if (record.attributeName === 'd') {\n          hasPathMutations = true;\n        }\n      });\n      if (hasPathMutations) {\n        this._list = this._parsePath(this._pathElement.getAttribute('d'));\n      }\n    }\n\n    // Serialize the list and update the path's 'd' attribute.\n    _writeListToPath () {\n      this._pathElementMutationObserver.disconnect();\n      this._pathElement.setAttribute('d', SVGPathSegList._pathSegArrayAsString(this._list));\n      this._pathElementMutationObserver.observe(this._pathElement, this._mutationObserverConfig);\n    }\n\n    // When a path segment changes the list needs to be synchronized back to the path element.\n    segmentChanged (pathSeg) {\n      this._writeListToPath();\n    }\n\n    clear () {\n      this._checkPathSynchronizedToList();\n\n      this._list.forEach((pathSeg) => {\n        pathSeg._owningPathSegList = null;\n      });\n      this._list = [];\n      this._writeListToPath();\n    }\n\n    initialize (newItem) {\n      this._checkPathSynchronizedToList();\n\n      this._list = [newItem];\n      newItem._owningPathSegList = this;\n      this._writeListToPath();\n      return newItem;\n    }\n\n    _checkValidIndex (index) {\n      if (isNaN(index) || index < 0 || index >= this.numberOfItems) {\n        throw new Error('INDEX_SIZE_ERR');\n      }\n    }\n\n    getItem (index) {\n      this._checkPathSynchronizedToList();\n\n      this._checkValidIndex(index);\n      return this._list[index];\n    }\n\n    insertItemBefore (newItem, index) {\n      this._checkPathSynchronizedToList();\n\n      // Spec: If the index is greater than or equal to numberOfItems, then the new item is appended to the end of the list.\n      if (index > this.numberOfItems) {\n        index = this.numberOfItems;\n      }\n      if (newItem._owningPathSegList) {\n        // SVG2 spec says to make a copy.\n        newItem = newItem.clone();\n      }\n      this._list.splice(index, 0, newItem);\n      newItem._owningPathSegList = this;\n      this._writeListToPath();\n      return newItem;\n    }\n\n    replaceItem (newItem, index) {\n      this._checkPathSynchronizedToList();\n\n      if (newItem._owningPathSegList) {\n        // SVG2 spec says to make a copy.\n        newItem = newItem.clone();\n      }\n      this._checkValidIndex(index);\n      this._list[index] = newItem;\n      newItem._owningPathSegList = this;\n      this._writeListToPath();\n      return newItem;\n    }\n\n    removeItem (index) {\n      this._checkPathSynchronizedToList();\n\n      this._checkValidIndex(index);\n      const item = this._list[index];\n      this._list.splice(index, 1);\n      this._writeListToPath();\n      return item;\n    }\n\n    appendItem (newItem) {\n      this._checkPathSynchronizedToList();\n\n      if (newItem._owningPathSegList) {\n        // SVG2 spec says to make a copy.\n        newItem = newItem.clone();\n      }\n      this._list.push(newItem);\n      newItem._owningPathSegList = this;\n      // TODO: Optimize this to just append to the existing attribute.\n      this._writeListToPath();\n      return newItem;\n    }\n\n    // This closely follows SVGPathParser::parsePath from Source/core/svg/SVGPathParser.cpp.\n    _parsePath (string) {\n      if (!string || !string.length) {\n        return [];\n      }\n\n      const owningPathSegList = this;\n\n      class Builder {\n        constructor () {\n          this.pathSegList = [];\n        }\n        appendSegment (pathSeg) {\n          this.pathSegList.push(pathSeg);\n        }\n      }\n\n      class Source {\n        constructor (string) {\n          this._string = string;\n          this._currentIndex = 0;\n          this._endIndex = this._string.length;\n          this._previousCommand = SVGPathSeg.PATHSEG_UNKNOWN;\n\n          this._skipOptionalSpaces();\n        }\n        _isCurrentSpace () {\n          const character = this._string[this._currentIndex];\n          return character <= ' ' && (character === ' ' || character === '\\n' || character === '\\t' || character === '\\r' || character === '\\f');\n        }\n\n        _skipOptionalSpaces () {\n          while (this._currentIndex < this._endIndex && this._isCurrentSpace()) {\n            this._currentIndex++;\n          }\n          return this._currentIndex < this._endIndex;\n        }\n\n        _skipOptionalSpacesOrDelimiter () {\n          if (this._currentIndex < this._endIndex && !this._isCurrentSpace() && this._string.charAt(this._currentIndex) !== ',') {\n            return false;\n          }\n          if (this._skipOptionalSpaces()) {\n            if (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) === ',') {\n              this._currentIndex++;\n              this._skipOptionalSpaces();\n            }\n          }\n          return this._currentIndex < this._endIndex;\n        }\n\n        hasMoreData () {\n          return this._currentIndex < this._endIndex;\n        }\n\n        peekSegmentType () {\n          const lookahead = this._string[this._currentIndex];\n          return this._pathSegTypeFromChar(lookahead);\n        }\n\n        _pathSegTypeFromChar (lookahead) {\n          switch (lookahead) {\n          case 'Z':\n          case 'z':\n            return SVGPathSeg.PATHSEG_CLOSEPATH;\n          case 'M':\n            return SVGPathSeg.PATHSEG_MOVETO_ABS;\n          case 'm':\n            return SVGPathSeg.PATHSEG_MOVETO_REL;\n          case 'L':\n            return SVGPathSeg.PATHSEG_LINETO_ABS;\n          case 'l':\n            return SVGPathSeg.PATHSEG_LINETO_REL;\n          case 'C':\n            return SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS;\n          case 'c':\n            return SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL;\n          case 'Q':\n            return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS;\n          case 'q':\n            return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL;\n          case 'A':\n            return SVGPathSeg.PATHSEG_ARC_ABS;\n          case 'a':\n            return SVGPathSeg.PATHSEG_ARC_REL;\n          case 'H':\n            return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS;\n          case 'h':\n            return SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL;\n          case 'V':\n            return SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS;\n          case 'v':\n            return SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL;\n          case 'S':\n            return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS;\n          case 's':\n            return SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL;\n          case 'T':\n            return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS;\n          case 't':\n            return SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL;\n          default:\n            return SVGPathSeg.PATHSEG_UNKNOWN;\n          }\n        }\n\n        _nextCommandHelper (lookahead, previousCommand) {\n          // Check for remaining coordinates in the current command.\n          if ((lookahead === '+' || lookahead === '-' || lookahead === '.' || (lookahead >= '0' && lookahead <= '9')) && previousCommand !== SVGPathSeg.PATHSEG_CLOSEPATH) {\n            if (previousCommand === SVGPathSeg.PATHSEG_MOVETO_ABS) {\n              return SVGPathSeg.PATHSEG_LINETO_ABS;\n            }\n            if (previousCommand === SVGPathSeg.PATHSEG_MOVETO_REL) {\n              return SVGPathSeg.PATHSEG_LINETO_REL;\n            }\n            return previousCommand;\n          }\n          return SVGPathSeg.PATHSEG_UNKNOWN;\n        }\n\n        initialCommandIsMoveTo () {\n          // If the path is empty it is still valid, so return true.\n          if (!this.hasMoreData()) {\n            return true;\n          }\n          const command = this.peekSegmentType();\n          // Path must start with moveTo.\n          return command === SVGPathSeg.PATHSEG_MOVETO_ABS || command === SVGPathSeg.PATHSEG_MOVETO_REL;\n        }\n\n        // Parse a number from an SVG path. This very closely follows genericParseNumber(...) from Source/core/svg/SVGParserUtilities.cpp.\n        // Spec: https://www.w3.org/TR/SVG11/single-page.html#paths-PathDataBNF\n        _parseNumber () {\n          let exponent = 0;\n          let integer = 0;\n          let frac = 1;\n          let decimal = 0;\n          let sign = 1;\n          let expsign = 1;\n\n          const startIndex = this._currentIndex;\n\n          this._skipOptionalSpaces();\n\n          // Read the sign.\n          if (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) === '+') {\n            this._currentIndex++;\n          } else if (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) === '-') {\n            this._currentIndex++;\n            sign = -1;\n          }\n\n          if (this._currentIndex === this._endIndex || ((this._string.charAt(this._currentIndex) < '0' || this._string.charAt(this._currentIndex) > '9') && this._string.charAt(this._currentIndex) !== '.')) {\n            // The first character of a number must be one of [0-9+-.].\n            return undefined;\n          }\n\n          // Read the integer part, build right-to-left.\n          const startIntPartIndex = this._currentIndex;\n          while (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) >= '0' && this._string.charAt(this._currentIndex) <= '9') {\n            this._currentIndex++; // Advance to first non-digit.\n          }\n\n          if (this._currentIndex !== startIntPartIndex) {\n            let scanIntPartIndex = this._currentIndex - 1;\n            let multiplier = 1;\n            while (scanIntPartIndex >= startIntPartIndex) {\n              integer += multiplier * (this._string.charAt(scanIntPartIndex--) - '0');\n              multiplier *= 10;\n            }\n          }\n\n          // Read the decimals.\n          if (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) === '.') {\n            this._currentIndex++;\n\n            // There must be a least one digit following the .\n            if (this._currentIndex >= this._endIndex || this._string.charAt(this._currentIndex) < '0' || this._string.charAt(this._currentIndex) > '9') {\n              return undefined;\n            }\n            while (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) >= '0' && this._string.charAt(this._currentIndex) <= '9') {\n              frac *= 10;\n              decimal += (this._string.charAt(this._currentIndex) - '0') / frac;\n              this._currentIndex += 1;\n            }\n          }\n\n          // Read the exponent part.\n          if (this._currentIndex !== startIndex && this._currentIndex + 1 < this._endIndex && (this._string.charAt(this._currentIndex) === 'e' || this._string.charAt(this._currentIndex) === 'E') && (this._string.charAt(this._currentIndex + 1) !== 'x' && this._string.charAt(this._currentIndex + 1) !== 'm')) {\n            this._currentIndex++;\n\n            // Read the sign of the exponent.\n            if (this._string.charAt(this._currentIndex) === '+') {\n              this._currentIndex++;\n            } else if (this._string.charAt(this._currentIndex) === '-') {\n              this._currentIndex++;\n              expsign = -1;\n            }\n\n            // There must be an exponent.\n            if (this._currentIndex >= this._endIndex || this._string.charAt(this._currentIndex) < '0' || this._string.charAt(this._currentIndex) > '9') {\n              return undefined;\n            }\n\n            while (this._currentIndex < this._endIndex && this._string.charAt(this._currentIndex) >= '0' && this._string.charAt(this._currentIndex) <= '9') {\n              exponent *= 10;\n              exponent += (this._string.charAt(this._currentIndex) - '0');\n              this._currentIndex++;\n            }\n          }\n\n          let number = integer + decimal;\n          number *= sign;\n\n          if (exponent) {\n            number *= Math.pow(10, expsign * exponent);\n          }\n\n          if (startIndex === this._currentIndex) {\n            return undefined;\n          }\n\n          this._skipOptionalSpacesOrDelimiter();\n\n          return number;\n        }\n\n        _parseArcFlag () {\n          if (this._currentIndex >= this._endIndex) {\n            return undefined;\n          }\n          let flag = false;\n          const flagChar = this._string.charAt(this._currentIndex++);\n          if (flagChar === '0') {\n            flag = false;\n          } else if (flagChar === '1') {\n            flag = true;\n          } else {\n            return undefined;\n          }\n\n          this._skipOptionalSpacesOrDelimiter();\n          return flag;\n        }\n\n        parseSegment () {\n          const lookahead = this._string[this._currentIndex];\n          let command = this._pathSegTypeFromChar(lookahead);\n          if (command === SVGPathSeg.PATHSEG_UNKNOWN) {\n            // Possibly an implicit command. Not allowed if this is the first command.\n            if (this._previousCommand === SVGPathSeg.PATHSEG_UNKNOWN) {\n              return null;\n            }\n            command = this._nextCommandHelper(lookahead, this._previousCommand);\n            if (command === SVGPathSeg.PATHSEG_UNKNOWN) {\n              return null;\n            }\n          } else {\n            this._currentIndex++;\n          }\n\n          this._previousCommand = command;\n\n          switch (command) {\n          case SVGPathSeg.PATHSEG_MOVETO_REL:\n            return new SVGPathSegMovetoRel(owningPathSegList, this._parseNumber(), this._parseNumber());\n          case SVGPathSeg.PATHSEG_MOVETO_ABS:\n            return new SVGPathSegMovetoAbs(owningPathSegList, this._parseNumber(), this._parseNumber());\n          case SVGPathSeg.PATHSEG_LINETO_REL:\n            return new SVGPathSegLinetoRel(owningPathSegList, this._parseNumber(), this._parseNumber());\n          case SVGPathSeg.PATHSEG_LINETO_ABS:\n            return new SVGPathSegLinetoAbs(owningPathSegList, this._parseNumber(), this._parseNumber());\n          case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_REL:\n            return new SVGPathSegLinetoHorizontalRel(owningPathSegList, this._parseNumber());\n          case SVGPathSeg.PATHSEG_LINETO_HORIZONTAL_ABS:\n            return new SVGPathSegLinetoHorizontalAbs(owningPathSegList, this._parseNumber());\n          case SVGPathSeg.PATHSEG_LINETO_VERTICAL_REL:\n            return new SVGPathSegLinetoVerticalRel(owningPathSegList, this._parseNumber());\n          case SVGPathSeg.PATHSEG_LINETO_VERTICAL_ABS:\n            return new SVGPathSegLinetoVerticalAbs(owningPathSegList, this._parseNumber());\n          case SVGPathSeg.PATHSEG_CLOSEPATH:\n            this._skipOptionalSpaces();\n            return new SVGPathSegClosePath(owningPathSegList);\n          case SVGPathSeg.PATHSEG_CURVETO_CUBIC_REL: {\n            const points = {x1: this._parseNumber(), y1: this._parseNumber(), x2: this._parseNumber(), y2: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber()};\n            return new SVGPathSegCurvetoCubicRel(owningPathSegList, points.x, points.y, points.x1, points.y1, points.x2, points.y2);\n          } case SVGPathSeg.PATHSEG_CURVETO_CUBIC_ABS: {\n            const points = {x1: this._parseNumber(), y1: this._parseNumber(), x2: this._parseNumber(), y2: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber()};\n            return new SVGPathSegCurvetoCubicAbs(owningPathSegList, points.x, points.y, points.x1, points.y1, points.x2, points.y2);\n          } case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_REL: {\n            const points = {x2: this._parseNumber(), y2: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber()};\n            return new SVGPathSegCurvetoCubicSmoothRel(owningPathSegList, points.x, points.y, points.x2, points.y2);\n          } case SVGPathSeg.PATHSEG_CURVETO_CUBIC_SMOOTH_ABS: {\n            const points = {x2: this._parseNumber(), y2: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber()};\n            return new SVGPathSegCurvetoCubicSmoothAbs(owningPathSegList, points.x, points.y, points.x2, points.y2);\n          } case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_REL: {\n            const points = {x1: this._parseNumber(), y1: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber()};\n            return new SVGPathSegCurvetoQuadraticRel(owningPathSegList, points.x, points.y, points.x1, points.y1);\n          } case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_ABS:\n            const points = {x1: this._parseNumber(), y1: this._parseNumber(), x: this._parseNumber(), y: this._parseNumber()};\n            return new SVGPathSegCurvetoQuadraticAbs(owningPathSegList, points.x, points.y, points.x1, points.y1);\n          case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL:\n            return new SVGPathSegCurvetoQuadraticSmoothRel(owningPathSegList, this._parseNumber(), this._parseNumber());\n          case SVGPathSeg.PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS:\n            return new SVGPathSegCurvetoQuadraticSmoothAbs(owningPathSegList, this._parseNumber(), this._parseNumber());\n          case SVGPathSeg.PATHSEG_ARC_REL: {\n            const points = {x1: this._parseNumber(), y1: this._parseNumber(), arcAngle: this._parseNumber(), arcLarge: this._parseArcFlag(), arcSweep: this._parseArcFlag(), x: this._parseNumber(), y: this._parseNumber()};\n            return new SVGPathSegArcRel(owningPathSegList, points.x, points.y, points.x1, points.y1, points.arcAngle, points.arcLarge, points.arcSweep);\n          } case SVGPathSeg.PATHSEG_ARC_ABS: {\n            const points = {x1: this._parseNumber(), y1: this._parseNumber(), arcAngle: this._parseNumber(), arcLarge: this._parseArcFlag(), arcSweep: this._parseArcFlag(), x: this._parseNumber(), y: this._parseNumber()};\n            return new SVGPathSegArcAbs(owningPathSegList, points.x, points.y, points.x1, points.y1, points.arcAngle, points.arcLarge, points.arcSweep);\n          } default:\n            throw new Error('Unknown path seg type.');\n          }\n        }\n      }\n\n      const builder = new Builder();\n      const source = new Source(string);\n\n      if (!source.initialCommandIsMoveTo()) {\n        return [];\n      }\n      while (source.hasMoreData()) {\n        const pathSeg = source.parseSegment();\n        if (!pathSeg) {\n          return [];\n        }\n        builder.appendSegment(pathSeg);\n      }\n\n      return builder.pathSegList;\n    }\n  }\n\n  SVGPathSegList.prototype.classname = 'SVGPathSegList';\n\n  Object.defineProperty(SVGPathSegList.prototype, 'numberOfItems', {\n    get () {\n      this._checkPathSynchronizedToList();\n      return this._list.length;\n    },\n    enumerable: true\n  });\n\n  SVGPathSegList._pathSegArrayAsString = function (pathSegArray) {\n    let string = '';\n    let first = true;\n    pathSegArray.forEach((pathSeg) => {\n      if (first) {\n        first = false;\n        string += pathSeg._asPathString();\n      } else {\n        string += ' ' + pathSeg._asPathString();\n      }\n    });\n    return string;\n  };\n\n  // Add the pathSegList accessors to SVGPathElement.\n  // Spec: https://www.w3.org/TR/SVG11/single-page.html#paths-InterfaceSVGAnimatedPathData\n  Object.defineProperties(SVGPathElement.prototype, {\n    pathSegList: {\n      get () {\n        if (!this._pathSegList) {\n          this._pathSegList = new SVGPathSegList(this);\n        }\n        return this._pathSegList;\n      },\n      enumerable: true\n    },\n    // FIXME: The following are not implemented and simply return SVGPathElement.pathSegList.\n    normalizedPathSegList: { get () { return this.pathSegList; }, enumerable: true },\n    animatedPathSegList: { get () { return this.pathSegList; }, enumerable: true },\n    animatedNormalizedPathSegList: { get () { return this.pathSegList; }, enumerable: true }\n  });\n  window.SVGPathSegList = SVGPathSegList;\n}\n})();\n","/* globals jQuery */\n/**\n * Browser detection\n * @module browser\n * @license MIT\n *\n * @copyright 2010 Jeff Schiller, 2010 Alexis Deveria\n */\n\n// Dependencies:\n// 1) jQuery (for $.alert())\n\nimport './svgpathseg.js';\nimport {NS} from './namespaces.js';\n\nconst $ = jQuery;\n\nconst supportsSVG_ = (function () {\nreturn !!document.createElementNS && !!document.createElementNS(NS.SVG, 'svg').createSVGRect;\n}());\n\n/**\n * @function module:browser.supportsSvg\n * @returns {boolean}\n*/\nexport const supportsSvg = () => supportsSVG_;\n\nconst {userAgent} = navigator;\nconst svg = document.createElementNS(NS.SVG, 'svg');\n\n// Note: Browser sniffing should only be used if no other detection method is possible\nconst isOpera_ = !!window.opera;\nconst isWebkit_ = userAgent.includes('AppleWebKit');\nconst isGecko_ = userAgent.includes('Gecko/');\nconst isIE_ = userAgent.includes('MSIE');\nconst isChrome_ = userAgent.includes('Chrome/');\nconst isWindows_ = userAgent.includes('Windows');\nconst isMac_ = userAgent.includes('Macintosh');\nconst isTouch_ = 'ontouchstart' in window;\n\nconst supportsSelectors_ = (function () {\nreturn !!svg.querySelector;\n}());\n\nconst supportsXpath_ = (function () {\nreturn !!document.evaluate;\n}());\n\n// segList functions (for FF1.5 and 2.0)\nconst supportsPathReplaceItem_ = (function () {\nconst path = document.createElementNS(NS.SVG, 'path');\npath.setAttribute('d', 'M0,0 10,10');\nconst seglist = path.pathSegList;\nconst seg = path.createSVGPathSegLinetoAbs(5, 5);\ntry {\n  seglist.replaceItem(seg, 1);\n  return true;\n} catch (err) {}\nreturn false;\n}());\n\nconst supportsPathInsertItemBefore_ = (function () {\nconst path = document.createElementNS(NS.SVG, 'path');\npath.setAttribute('d', 'M0,0 10,10');\nconst seglist = path.pathSegList;\nconst seg = path.createSVGPathSegLinetoAbs(5, 5);\ntry {\n  seglist.insertItemBefore(seg, 1);\n  return true;\n} catch (err) {}\nreturn false;\n}());\n\n// text character positioning (for IE9)\nconst supportsGoodTextCharPos_ = (function () {\nconst svgroot = document.createElementNS(NS.SVG, 'svg');\nconst svgcontent = document.createElementNS(NS.SVG, 'svg');\ndocument.documentElement.append(svgroot);\nsvgcontent.setAttribute('x', 5);\nsvgroot.append(svgcontent);\nconst text = document.createElementNS(NS.SVG, 'text');\ntext.textContent = 'a';\nsvgcontent.append(text);\nconst pos = text.getStartPositionOfChar(0).x;\nsvgroot.remove();\nreturn (pos === 0);\n}());\n\nconst supportsPathBBox_ = (function () {\nconst svgcontent = document.createElementNS(NS.SVG, 'svg');\ndocument.documentElement.append(svgcontent);\nconst path = document.createElementNS(NS.SVG, 'path');\npath.setAttribute('d', 'M0,0 C0,0 10,10 10,0');\nsvgcontent.append(path);\nconst bbox = path.getBBox();\nsvgcontent.remove();\nreturn (bbox.height > 4 && bbox.height < 5);\n}());\n\n// Support for correct bbox sizing on groups with horizontal/vertical lines\nconst supportsHVLineContainerBBox_ = (function () {\nconst svgcontent = document.createElementNS(NS.SVG, 'svg');\ndocument.documentElement.append(svgcontent);\nconst path = document.createElementNS(NS.SVG, 'path');\npath.setAttribute('d', 'M0,0 10,0');\nconst path2 = document.createElementNS(NS.SVG, 'path');\npath2.setAttribute('d', 'M5,0 15,0');\nconst g = document.createElementNS(NS.SVG, 'g');\ng.append(path, path2);\nsvgcontent.append(g);\nconst bbox = g.getBBox();\nsvgcontent.remove();\n// Webkit gives 0, FF gives 10, Opera (correctly) gives 15\nreturn (bbox.width === 15);\n}());\n\nconst supportsEditableText_ = (function () {\n// TODO: Find better way to check support for this\nreturn isOpera_;\n}());\n\nconst supportsGoodDecimals_ = (function () {\n// Correct decimals on clone attributes (Opera < 10.5/win/non-en)\nconst rect = document.createElementNS(NS.SVG, 'rect');\nrect.setAttribute('x', 0.1);\nconst crect = rect.cloneNode(false);\nconst retValue = (!crect.getAttribute('x').includes(','));\nif (!retValue) {\n  // Todo: i18nize or remove\n  $.alert('NOTE: This version of Opera is known to contain bugs in SVG-edit.\\n' +\n\t'Please upgrade to the <a href=\"http://opera.com\">latest version</a> in which the problems have been fixed.');\n}\nreturn retValue;\n}());\n\nconst supportsNonScalingStroke_ = (function () {\nconst rect = document.createElementNS(NS.SVG, 'rect');\nrect.setAttribute('style', 'vector-effect:non-scaling-stroke');\nreturn rect.style.vectorEffect === 'non-scaling-stroke';\n}());\n\nlet supportsNativeSVGTransformLists_ = (function () {\nconst rect = document.createElementNS(NS.SVG, 'rect');\nconst rxform = rect.transform.baseVal;\nconst t1 = svg.createSVGTransform();\nrxform.appendItem(t1);\nconst r1 = rxform.getItem(0);\n// Todo: Do frame-independent instance checking\nreturn r1 instanceof SVGTransform && t1 instanceof SVGTransform &&\n\tr1.type === t1.type && r1.angle === t1.angle &&\n\tr1.matrix.a === t1.matrix.a &&\n\tr1.matrix.b === t1.matrix.b &&\n\tr1.matrix.c === t1.matrix.c &&\n\tr1.matrix.d === t1.matrix.d &&\n\tr1.matrix.e === t1.matrix.e &&\n\tr1.matrix.f === t1.matrix.f;\n}());\n\n// Public API\n\n/**\n * @function module:browser.isOpera\n * @returns {boolean}\n*/\nexport const isOpera = () => isOpera_;\n/**\n * @function module:browser.isWebkit\n * @returns {boolean}\n*/\nexport const isWebkit = () => isWebkit_;\n/**\n * @function module:browser.isGecko\n * @returns {boolean}\n*/\nexport const isGecko = () => isGecko_;\n/**\n * @function module:browser.isIE\n * @returns {boolean}\n*/\nexport const isIE = () => isIE_;\n/**\n * @function module:browser.isChrome\n * @returns {boolean}\n*/\nexport const isChrome = () => isChrome_;\n/**\n * @function module:browser.isWindows\n * @returns {boolean}\n*/\nexport const isWindows = () => isWindows_;\n/**\n * @function module:browser.isMac\n * @returns {boolean}\n*/\nexport const isMac = () => isMac_;\n/**\n * @function module:browser.isTouch\n * @returns {boolean}\n*/\nexport const isTouch = () => isTouch_;\n\n/**\n * @function module:browser.supportsSelectors\n * @returns {boolean}\n*/\nexport const supportsSelectors = () => supportsSelectors_;\n\n/**\n * @function module:browser.supportsXpath\n * @returns {boolean}\n*/\nexport const supportsXpath = () => supportsXpath_;\n\n/**\n * @function module:browser.supportsPathReplaceItem\n * @returns {boolean}\n*/\nexport const supportsPathReplaceItem = () => supportsPathReplaceItem_;\n\n/**\n * @function module:browser.supportsPathInsertItemBefore\n * @returns {boolean}\n*/\nexport const supportsPathInsertItemBefore = () => supportsPathInsertItemBefore_;\n\n/**\n * @function module:browser.supportsPathBBox\n * @returns {boolean}\n*/\nexport const supportsPathBBox = () => supportsPathBBox_;\n\n/**\n * @function module:browser.supportsHVLineContainerBBox\n * @returns {boolean}\n*/\nexport const supportsHVLineContainerBBox = () => supportsHVLineContainerBBox_;\n\n/**\n * @function module:browser.supportsGoodTextCharPos\n * @returns {boolean}\n*/\nexport const supportsGoodTextCharPos = () => supportsGoodTextCharPos_;\n\n/**\n* @function module:browser.supportsEditableText\n * @returns {boolean}\n*/\nexport const supportsEditableText = () => supportsEditableText_;\n\n/**\n * @function module:browser.supportsGoodDecimals\n * @returns {boolean}\n*/\nexport const supportsGoodDecimals = () => supportsGoodDecimals_;\n\n/**\n* @function module:browser.supportsNonScalingStroke\n* @returns {boolean}\n*/\nexport const supportsNonScalingStroke = () => supportsNonScalingStroke_;\n\n/**\n* @function module:browser.supportsNativeTransformLists\n* @returns {boolean}\n*/\nexport const supportsNativeTransformLists = () => supportsNativeSVGTransformLists_;\n\n/**\n * Set `supportsNativeSVGTransformLists_` to `false` (for unit testing)\n * @function module:browser.disableSupportsNativeTransformLists\n * @returns {undefined}\n*/\nexport const disableSupportsNativeTransformLists = () => {\n  supportsNativeSVGTransformLists_ = false;\n};\n","/**\n * jQuery module to work with SVG attributes\n * @module jQueryAttr\n * @license MIT\n */\n\n/**\n* This fixes `$(...).attr()` to work as expected with SVG elements.\n* Does not currently use `*AttributeNS()` since we rarely need that.\n* Adds {@link external:jQuery.fn.attr}.\n* See {@link https://api.jquery.com/attr/} for basic documentation of `.attr()`\n*\n* Additional functionality:\n* - When getting attributes, a string that's a number is returned as type number.\n* - If an array is supplied as the first parameter, multiple values are returned\n*    as an object with values for each given attribute\n* @function module:jQueryAttr.jQueryAttr\n* @param {external:jQuery} $ The jQuery object to which to add the plug-in\n* @returns {external:jQuery}\n*/\nexport default function ($) {\n  const proxied = $.fn.attr,\n    svgns = 'http://www.w3.org/2000/svg';\n  /**\n  * @typedef {PlainObject.<string, string|Float>} module:jQueryAttr.Attributes\n  */\n  /**\n  * @function external:jQuery.fn.attr\n  * @param {string|string[]|PlainObject.<string, string>} key\n  * @param {string} value\n  * @returns {external:jQuery|module:jQueryAttr.Attributes}\n  */\n  $.fn.attr = function (key, value) {\n    const len = this.length;\n    if (!len) { return proxied.apply(this, arguments); }\n    for (let i = 0; i < len; ++i) {\n      const elem = this[i];\n      // set/get SVG attribute\n      if (elem.namespaceURI === svgns) {\n        // Setting attribute\n        if (value !== undefined) {\n          elem.setAttribute(key, value);\n        } else if (Array.isArray(key)) {\n          // Getting attributes from array\n          const obj = {};\n          let j = key.length;\n\n          while (j--) {\n            const aname = key[j];\n            let attr = elem.getAttribute(aname);\n            // This returns a number when appropriate\n            if (attr || attr === '0') {\n              attr = isNaN(attr) ? attr : (attr - 0);\n            }\n            obj[aname] = attr;\n          }\n          return obj;\n        }\n        if (typeof key === 'object') {\n          // Setting attributes from object\n          for (const [name, val] of Object.entries(key)) {\n            elem.setAttribute(name, val);\n          }\n        // Getting attribute\n        } else {\n          let attr = elem.getAttribute(key);\n          if (attr || attr === '0') {\n            attr = isNaN(attr) ? attr : (attr - 0);\n          }\n          return attr;\n        }\n      } else {\n        return proxied.apply(this, arguments);\n      }\n    }\n    return this;\n  };\n  return $;\n}\n","/**\n * Partial polyfill of `SVGTransformList`\n * @module SVGTransformList\n *\n * @license MIT\n *\n * @copyright 2010 Alexis Deveria, 2010 Jeff Schiller\n */\n\nimport {NS} from './namespaces.js';\nimport {supportsNativeTransformLists} from './browser.js';\n\nconst svgroot = document.createElementNS(NS.SVG, 'svg');\n\n// Helper function.\nfunction transformToString (xform) {\n  const m = xform.matrix;\n  let text = '';\n  switch (xform.type) {\n  case 1: // MATRIX\n    text = 'matrix(' + [m.a, m.b, m.c, m.d, m.e, m.f].join(',') + ')';\n    break;\n  case 2: // TRANSLATE\n    text = 'translate(' + m.e + ',' + m.f + ')';\n    break;\n  case 3: // SCALE\n    if (m.a === m.d) {\n      text = 'scale(' + m.a + ')';\n    } else {\n      text = 'scale(' + m.a + ',' + m.d + ')';\n    }\n    break;\n  case 4: { // ROTATE\n    let cx = 0;\n    let cy = 0;\n    // this prevents divide by zero\n    if (xform.angle !== 0) {\n      const K = 1 - m.a;\n      cy = (K * m.f + m.b * m.e) / (K * K + m.b * m.b);\n      cx = (m.e - m.b * cy) / K;\n    }\n    text = 'rotate(' + xform.angle + ' ' + cx + ',' + cy + ')';\n    break;\n  }\n  }\n  return text;\n}\n\n/**\n * Map of SVGTransformList objects.\n */\nlet listMap_ = {};\n\n/**\n* @interface module:SVGTransformList.SVGEditTransformList\n* @property {Integer} numberOfItems unsigned long\n*/\n/**\n* @function module:SVGTransformList.SVGEditTransformList#clear\n* @returns {undefined}\n*/\n/**\n* @function module:SVGTransformList.SVGEditTransformList#initialize\n* @param {SVGTransform} newItem\n* @returns {SVGTransform}\n*/\n/**\n* (DOES NOT THROW DOMException, INDEX_SIZE_ERR)\n* @function module:SVGTransformList.SVGEditTransformList#getItem\n* @param {Integer} index unsigned long\n* @returns {SVGTransform}\n*/\n/**\n* (DOES NOT THROW DOMException, INDEX_SIZE_ERR)\n* @function module:SVGTransformList.SVGEditTransformList#insertItemBefore\n* @param {SVGTransform} newItem\n* @param {Integer} index unsigned long\n* @returns {SVGTransform}\n*/\n/**\n* (DOES NOT THROW DOMException, INDEX_SIZE_ERR)\n* @function module:SVGTransformList.SVGEditTransformList#replaceItem\n* @param {SVGTransform} newItem\n* @param {Integer} index unsigned long\n* @returns {SVGTransform}\n*/\n/**\n* (DOES NOT THROW DOMException, INDEX_SIZE_ERR)\n* @function module:SVGTransformList.SVGEditTransformList#removeItem\n* @param {Integer} index unsigned long\n* @returns {SVGTransform}\n*/\n/**\n* @function module:SVGTransformList.SVGEditTransformList#appendItem\n* @param {SVGTransform} newItem\n* @returns {SVGTransform}\n*/\n/**\n* NOT IMPLEMENTED\n* @ignore\n* @function module:SVGTransformList.SVGEditTransformList#createSVGTransformFromMatrix\n* @param {SVGMatrix} matrix\n* @returns {SVGTransform}\n*/\n/**\n* NOT IMPLEMENTED\n* @ignore\n* @function module:SVGTransformList.SVGEditTransformList#consolidate\n* @returns {SVGTransform}\n*/\n\n/**\n* SVGTransformList implementation for Webkit.\n* These methods do not currently raise any exceptions.\n* These methods also do not check that transforms are being inserted.  This is basically\n* implementing as much of SVGTransformList that we need to get the job done.\n*/\nexport class SVGTransformList {\n  /**\n  * @param {Element} elem\n  */\n  constructor (elem) {\n    this._elem = elem || null;\n    this._xforms = [];\n    // TODO: how do we capture the undo-ability in the changed transform list?\n    this._update = function () {\n      let tstr = '';\n      /* const concatMatrix = */ svgroot.createSVGMatrix();\n      for (let i = 0; i < this.numberOfItems; ++i) {\n        const xform = this._list.getItem(i);\n        tstr += transformToString(xform) + ' ';\n      }\n      this._elem.setAttribute('transform', tstr);\n    };\n    this._list = this;\n    this._init = function () {\n      // Transform attribute parser\n      let str = this._elem.getAttribute('transform');\n      if (!str) { return; }\n\n      // TODO: Add skew support in future\n      const re = /\\s*((scale|matrix|rotate|translate)\\s*\\(.*?\\))\\s*,?\\s*/;\n      let m = true;\n      while (m) {\n        m = str.match(re);\n        str = str.replace(re, '');\n        if (m && m[1]) {\n          const x = m[1];\n          const bits = x.split(/\\s*\\(/);\n          const name = bits[0];\n          const valBits = bits[1].match(/\\s*(.*?)\\s*\\)/);\n          valBits[1] = valBits[1].replace(/(\\d)-/g, '$1 -');\n          const valArr = valBits[1].split(/[, ]+/);\n          const letters = 'abcdef'.split('');\n          const mtx = svgroot.createSVGMatrix();\n          Object.values(valArr).forEach(function (item, i) {\n            valArr[i] = parseFloat(item);\n            if (name === 'matrix') {\n              mtx[letters[i]] = valArr[i];\n            }\n          });\n          const xform = svgroot.createSVGTransform();\n          const fname = 'set' + name.charAt(0).toUpperCase() + name.slice(1);\n          const values = name === 'matrix' ? [mtx] : valArr;\n\n          if (name === 'scale' && values.length === 1) {\n            values.push(values[0]);\n          } else if (name === 'translate' && values.length === 1) {\n            values.push(0);\n          } else if (name === 'rotate' && values.length === 1) {\n            values.push(0, 0);\n          }\n          xform[fname].apply(xform, values);\n          this._list.appendItem(xform);\n        }\n      }\n    };\n    this._removeFromOtherLists = function (item) {\n      if (item) {\n        // Check if this transform is already in a transformlist, and\n        // remove it if so.\n        let found = false;\n        for (const id in listMap_) {\n          const tl = listMap_[id];\n          for (let i = 0, len = tl._xforms.length; i < len; ++i) {\n            if (tl._xforms[i] === item) {\n              found = true;\n              tl.removeItem(i);\n              break;\n            }\n          }\n          if (found) {\n            break;\n          }\n        }\n      }\n    };\n\n    this.numberOfItems = 0;\n  }\n  /**\n  * @returns {undefined}\n  */\n  clear () {\n    this.numberOfItems = 0;\n    this._xforms = [];\n  }\n\n  /**\n  * @param {SVGTransform} newItem\n  * @returns {SVGTransform}\n  */\n  initialize (newItem) {\n    this.numberOfItems = 1;\n    this._removeFromOtherLists(newItem);\n    this._xforms = [newItem];\n  }\n\n  /**\n  * @param {Integer} index unsigned long\n  * @throws {Error}\n  * @returns {SVGTransform}\n  */\n  getItem (index) {\n    if (index < this.numberOfItems && index >= 0) {\n      return this._xforms[index];\n    }\n    const err = new Error('DOMException with code=INDEX_SIZE_ERR');\n    err.code = 1;\n    throw err;\n  }\n\n  /**\n  * @param {SVGTransform} newItem\n  * @param {Integer} index unsigned long\n  * @returns {SVGTransform}\n  */\n  insertItemBefore (newItem, index) {\n    let retValue = null;\n    if (index >= 0) {\n      if (index < this.numberOfItems) {\n        this._removeFromOtherLists(newItem);\n        const newxforms = new Array(this.numberOfItems + 1);\n        // TODO: use array copying and slicing\n        let i;\n        for (i = 0; i < index; ++i) {\n          newxforms[i] = this._xforms[i];\n        }\n        newxforms[i] = newItem;\n        for (let j = i + 1; i < this.numberOfItems; ++j, ++i) {\n          newxforms[j] = this._xforms[i];\n        }\n        this.numberOfItems++;\n        this._xforms = newxforms;\n        retValue = newItem;\n        this._list._update();\n      } else {\n        retValue = this._list.appendItem(newItem);\n      }\n    }\n    return retValue;\n  }\n\n  /**\n  * @param {SVGTransform} newItem\n  * @param {Integer} index unsigned long\n  * @returns {SVGTransform}\n  */\n  replaceItem (newItem, index) {\n    let retValue = null;\n    if (index < this.numberOfItems && index >= 0) {\n      this._removeFromOtherLists(newItem);\n      this._xforms[index] = newItem;\n      retValue = newItem;\n      this._list._update();\n    }\n    return retValue;\n  }\n\n  /**\n  * @param {Integer} index unsigned long\n  * @throws {Error}\n  * @returns {SVGTransform}\n  */\n  removeItem (index) {\n    if (index < this.numberOfItems && index >= 0) {\n      const retValue = this._xforms[index];\n      const newxforms = new Array(this.numberOfItems - 1);\n      let i;\n      for (i = 0; i < index; ++i) {\n        newxforms[i] = this._xforms[i];\n      }\n      for (let j = i; j < this.numberOfItems - 1; ++j, ++i) {\n        newxforms[j] = this._xforms[i + 1];\n      }\n      this.numberOfItems--;\n      this._xforms = newxforms;\n      this._list._update();\n      return retValue;\n    }\n    const err = new Error('DOMException with code=INDEX_SIZE_ERR');\n    err.code = 1;\n    throw err;\n  }\n\n  /**\n  * @param {SVGTransform} newItem\n  * @returns {SVGTransform}\n  */\n  appendItem (newItem) {\n    this._removeFromOtherLists(newItem);\n    this._xforms.push(newItem);\n    this.numberOfItems++;\n    this._list._update();\n    return newItem;\n  }\n}\n\n/**\n* @function module:SVGTransformList.resetListMap\n* @returns {undefined}\n*/\nexport const resetListMap = function () {\n  listMap_ = {};\n};\n\n/**\n * Removes transforms of the given element from the map.\n * @function module:SVGTransformList.removeElementFromListMap\n * @param {Element} elem - a DOM Element\n * @returns {undefined}\n */\nexport let removeElementFromListMap = function (elem) {\n  if (elem.id && listMap_[elem.id]) {\n    delete listMap_[elem.id];\n  }\n};\n\n/**\n* Returns an object that behaves like a `SVGTransformList` for the given DOM element\n* @function module:SVGTransformList.getTransformList\n* @param {Element} elem - DOM element to get a transformlist from\n* @todo The polyfill should have `SVGAnimatedTransformList` and this should use it\n* @returns {SVGAnimatedTransformList|SVGTransformList}\n*/\nexport const getTransformList = function (elem) {\n  if (!supportsNativeTransformLists()) {\n    const id = elem.id || 'temp';\n    let t = listMap_[id];\n    if (!t || id === 'temp') {\n      listMap_[id] = new SVGTransformList(elem);\n      listMap_[id]._init();\n      t = listMap_[id];\n    }\n    return t;\n  }\n  if (elem.transform) {\n    return elem.transform.baseVal;\n  }\n  if (elem.gradientTransform) {\n    return elem.gradientTransform.baseVal;\n  }\n  if (elem.patternTransform) {\n    return elem.patternTransform.baseVal;\n  }\n\n  return null;\n};\n\n/**\n* @callback module:SVGTransformList.removeElementFromListMap\n* @param {Element} elem\n*/\n/**\n* For unit-testing\n* @function module:SVGTransformList.changeRemoveElementFromListMap\n* @param {module:SVGTransformList.removeElementFromListMap} cb Passed a single argument `elem`\n* @returns {undefined}\n*/\nexport const changeRemoveElementFromListMap = function (cb) {\n  removeElementFromListMap = cb;\n};\n","/**\n * Tools for working with units\n * @module units\n * @license MIT\n *\n * @copyright 2010 Alexis Deveria, 2010 Jeff Schiller\n */\n\nimport {NS} from './namespaces.js';\n\nconst wAttrs = ['x', 'x1', 'cx', 'rx', 'width'];\nconst hAttrs = ['y', 'y1', 'cy', 'ry', 'height'];\nconst unitAttrs = ['r', 'radius', ...wAttrs, ...hAttrs];\n// unused\n/*\nconst unitNumMap = {\n  '%': 2,\n  em: 3,\n  ex: 4,\n  px: 5,\n  cm: 6,\n  mm: 7,\n  in: 8,\n  pt: 9,\n  pc: 10\n};\n*/\n// Container of elements.\nlet elementContainer_;\n\n// Stores mapping of unit type to user coordinates.\nlet typeMap_ = {};\n\n/**\n * @interface module:units.ElementContainer\n */\n/**\n * @function module:units.ElementContainer#getBaseUnit\n * @returns {string} The base unit type of the container ('em')\n */\n/**\n * @function module:units.ElementContainer#getElement\n * @returns {Element} An element in the container given an id\n */\n/**\n * @function module:units.ElementContainer#getHeight\n * @returns {Float} The container's height\n */\n/**\n * @function module:units.ElementContainer#getWidth\n * @returns {Float} The container's width\n */\n/**\n * @function module:units.ElementContainer#getRoundDigits\n * @returns {Integer} The number of digits number should be rounded to\n */\n\n/**\n * @typedef {PlainObject} module:units.TypeMap\n * @property {Float} em\n * @property {Float} ex\n * @property {Float} in\n * @property {Float} cm\n * @property {Float} mm\n * @property {Float} pt\n * @property {Float} pc\n * @property {Integer} px\n * @property {0} %\n */\n\n/**\n * Initializes this module.\n *\n * @function module:units.init\n * @param {module:units.ElementContainer} elementContainer - An object implementing the ElementContainer interface.\n * @returns {undefined}\n */\nexport const init = function (elementContainer) {\n  elementContainer_ = elementContainer;\n\n  // Get correct em/ex values by creating a temporary SVG.\n  const svg = document.createElementNS(NS.SVG, 'svg');\n  document.body.append(svg);\n  const rect = document.createElementNS(NS.SVG, 'rect');\n  rect.setAttribute('width', '1em');\n  rect.setAttribute('height', '1ex');\n  rect.setAttribute('x', '1in');\n  svg.append(rect);\n  const bb = rect.getBBox();\n  svg.remove();\n\n  const inch = bb.x;\n  typeMap_ = {\n    em: bb.width,\n    ex: bb.height,\n    in: inch,\n    cm: inch / 2.54,\n    mm: inch / 25.4,\n    pt: inch / 72,\n    pc: inch / 6,\n    px: 1,\n    '%': 0\n  };\n};\n\n/**\n* Group: Unit conversion functions\n*/\n\n/**\n * @function module:units.getTypeMap\n * @returns {module:units.TypeMap} The unit object with values for each unit\n*/\nexport const getTypeMap = function () {\n  return typeMap_;\n};\n\n/**\n* @typedef {GenericArray} module:units.CompareNumbers\n* @property {Integer} length 2\n* @property {Float} 0\n* @property {Float} 1\n*/\n\n/**\n* Rounds a given value to a float with number of digits defined in\n* `round_digits` of `saveOptions`\n*\n* @function module:units.shortFloat\n* @param {string|Float|module:units.CompareNumbers} val - The value (or Array of two numbers) to be rounded\n* @returns {Float|string} If a string/number was given, returns a Float. If an array, return a string\n* with comma-separated floats\n*/\nexport const shortFloat = function (val) {\n  const digits = elementContainer_.getRoundDigits();\n  if (!isNaN(val)) {\n    // Note that + converts to Number\n    return +((+val).toFixed(digits));\n  }\n  if (Array.isArray(val)) {\n    return shortFloat(val[0]) + ',' + shortFloat(val[1]);\n  }\n  return parseFloat(val).toFixed(digits) - 0;\n};\n\n/**\n* Converts the number to given unit or baseUnit\n* @function module:units.convertUnit\n* @returns {Float}\n*/\nexport const convertUnit = function (val, unit) {\n  unit = unit || elementContainer_.getBaseUnit();\n  // baseVal.convertToSpecifiedUnits(unitNumMap[unit]);\n  // const val = baseVal.valueInSpecifiedUnits;\n  // baseVal.convertToSpecifiedUnits(1);\n  return shortFloat(val / typeMap_[unit]);\n};\n\n/**\n* Sets an element's attribute based on the unit in its current value.\n*\n* @function module:units.setUnitAttr\n* @param {Element} elem - DOM element to be changed\n* @param {string} attr - Name of the attribute associated with the value\n* @param {string} val - Attribute value to convert\n* @returns {undefined}\n*/\nexport const setUnitAttr = function (elem, attr, val) {\n  //  if (!isNaN(val)) {\n  // New value is a number, so check currently used unit\n  // const oldVal = elem.getAttribute(attr);\n\n  // Enable this for alternate mode\n  // if (oldVal !== null && (isNaN(oldVal) || elementContainer_.getBaseUnit() !== 'px')) {\n  //   // Old value was a number, so get unit, then convert\n  //   let unit;\n  //   if (oldVal.substr(-1) === '%') {\n  //     const res = getResolution();\n  //     unit = '%';\n  //     val *= 100;\n  //     if (wAttrs.includes(attr)) {\n  //       val = val / res.w;\n  //     } else if (hAttrs.includes(attr)) {\n  //       val = val / res.h;\n  //     } else {\n  //       return val / Math.sqrt((res.w*res.w) + (res.h*res.h))/Math.sqrt(2);\n  //     }\n  //   } else {\n  //     if (elementContainer_.getBaseUnit() !== 'px') {\n  //       unit = elementContainer_.getBaseUnit();\n  //     } else {\n  //       unit = oldVal.substr(-2);\n  //     }\n  //     val = val / typeMap_[unit];\n  //   }\n  //\n  // val += unit;\n  // }\n  // }\n  elem.setAttribute(attr, val);\n};\n\nconst attrsToConvert = {\n  line: ['x1', 'x2', 'y1', 'y2'],\n  circle: ['cx', 'cy', 'r'],\n  ellipse: ['cx', 'cy', 'rx', 'ry'],\n  foreignObject: ['x', 'y', 'width', 'height'],\n  rect: ['x', 'y', 'width', 'height'],\n  image: ['x', 'y', 'width', 'height'],\n  use: ['x', 'y', 'width', 'height'],\n  text: ['x', 'y']\n};\n\n/**\n* Converts all applicable attributes to the configured baseUnit\n* @function module:units.convertAttrs\n* @param {Element} element - A DOM element whose attributes should be converted\n* @returns {undefined}\n*/\nexport const convertAttrs = function (element) {\n  const elName = element.tagName;\n  const unit = elementContainer_.getBaseUnit();\n  const attrs = attrsToConvert[elName];\n  if (!attrs) { return; }\n\n  const len = attrs.length;\n  for (let i = 0; i < len; i++) {\n    const attr = attrs[i];\n    const cur = element.getAttribute(attr);\n    if (cur) {\n      if (!isNaN(cur)) {\n        element.setAttribute(attr, (cur / typeMap_[unit]) + unit);\n      }\n      // else {\n      // Convert existing?\n      // }\n    }\n  }\n};\n\n/**\n* Converts given values to numbers. Attributes must be supplied in\n* case a percentage is given\n*\n* @function module:units.convertToNum\n* @param {string} attr - Name of the attribute associated with the value\n* @param {string} val - Attribute value to convert\n* @returns {Float} The converted number\n*/\nexport const convertToNum = function (attr, val) {\n  // Return a number if that's what it already is\n  if (!isNaN(val)) { return val - 0; }\n  if (val.substr(-1) === '%') {\n    // Deal with percentage, depends on attribute\n    const num = val.substr(0, val.length - 1) / 100;\n    const width = elementContainer_.getWidth();\n    const height = elementContainer_.getHeight();\n\n    if (wAttrs.includes(attr)) {\n      return num * width;\n    }\n    if (hAttrs.includes(attr)) {\n      return num * height;\n    }\n    return num * Math.sqrt((width * width) + (height * height)) / Math.sqrt(2);\n  }\n  const unit = val.substr(-2);\n  const num = val.substr(0, val.length - 2);\n  // Note that this multiplication turns the string into a number\n  return num * typeMap_[unit];\n};\n\n/**\n* Check if an attribute's value is in a valid format\n* @function module:units.isValidUnit\n* @param {string} attr - The name of the attribute associated with the value\n* @param {string} val - The attribute value to check\n* @returns {boolean} Whether the unit is valid\n*/\nexport const isValidUnit = function (attr, val, selectedElement) {\n  if (unitAttrs.includes(attr)) {\n    // True if it's just a number\n    if (!isNaN(val)) {\n      return true;\n    }\n    // Not a number, check if it has a valid unit\n    val = val.toLowerCase();\n    return Object.keys(typeMap_).some((unit) => {\n      const re = new RegExp('^-?[\\\\d\\\\.]+' + unit + '$');\n      return re.test(val);\n    });\n  }\n  if (attr === 'id') {\n    // if we're trying to change the id, make sure it's not already present in the doc\n    // and the id value is valid.\n\n    let result = false;\n    // because getElem() can throw an exception in the case of an invalid id\n    // (according to https://www.w3.org/TR/xml-id/ IDs must be a NCName)\n    // we wrap it in an exception and only return true if the ID was valid and\n    // not already present\n    try {\n      const elem = elementContainer_.getElement(val);\n      result = (elem == null || elem === selectedElement);\n    } catch (e) {}\n    return result;\n  }\n  return true;\n};\n","/**\n * For command history tracking and undo functionality\n * @module history\n * @license MIT\n * @copyright 2010 Jeff Schiller\n */\n\nimport {getHref, setHref, getRotationAngle} from './utilities.js';\nimport {removeElementFromListMap} from './svgtransformlist.js';\n\n/**\n* Group: Undo/Redo history management\n*/\nexport const HistoryEventTypes = {\n  BEFORE_APPLY: 'before_apply',\n  AFTER_APPLY: 'after_apply',\n  BEFORE_UNAPPLY: 'before_unapply',\n  AFTER_UNAPPLY: 'after_unapply'\n};\n\n// const removedElements = {};\n\n/**\n* Base class for commands\n*/\nclass Command {\n  /**\n  * @returns {string}\n  */\n  getText () {\n    return this.text;\n  }\n}\n\n// Todo: Figure out why the interface members aren't showing\n//   up (with or without modules applied), despite our apparently following\n//   http://usejsdoc.org/tags-interface.html#virtual-comments\n\n/**\n * An interface that all command objects must implement.\n * @interface module:history.HistoryCommand\n*/\n/**\n * Applies\n *\n * @function module:history.HistoryCommand#apply\n * @param {module:history.HistoryEventHandler}\n * @fires module:history~Command#event:history\n * @returns {undefined|true}\n */\n/**\n *\n * Unapplies\n * @function module:history.HistoryCommand#unapply\n * @param {module:history.HistoryEventHandler}\n * @fires module:history~Command#event:history\n * @returns {undefined|true}\n */\n/**\n * Returns the elements\n * @function module:history.HistoryCommand#elements\n * @returns {Element[]}\n */\n/**\n * Gets the text\n * @function module:history.HistoryCommand#getText\n * @returns {string}\n */\n/**\n * Gives the type\n * @function module:history.HistoryCommand.type\n * @returns {string}\n */\n/**\n * Gives the type\n * @function module:history.HistoryCommand#type\n * @returns {string}\n*/\n\n/**\n * @event module:history~Command#event:history\n * @type {module:history.HistoryCommand}\n */\n\n/**\n * An interface for objects that will handle history events.\n * @interface module:history.HistoryEventHandler\n */\n/**\n *\n * @function module:history.HistoryEventHandler#handleHistoryEvent\n * @param {string} eventType One of the HistoryEvent types\n * @param {module:history~Command#event:history} command\n * @listens module:history~Command#event:history\n * @returns {undefined}\n *\n */\n\n/**\n * History command for an element that had its DOM position changed\n * @implements {module:history.HistoryCommand}\n * @param {Element} elem - The DOM element that was moved\n * @param {Element} oldNextSibling - The element's next sibling before it was moved\n * @param {Element} oldParent - The element's parent before it was moved\n * @param {string} [text] - An optional string visible to user related to this change\n*/\nexport class MoveElementCommand extends Command {\n  constructor (elem, oldNextSibling, oldParent, text) {\n    super();\n    this.elem = elem;\n    this.text = text ? ('Move ' + elem.tagName + ' to ' + text) : ('Move ' + elem.tagName);\n    this.oldNextSibling = oldNextSibling;\n    this.oldParent = oldParent;\n    this.newNextSibling = elem.nextSibling;\n    this.newParent = elem.parentNode;\n  }\n  type () {\n    return 'svgedit.history.MoveElementCommand';\n  }\n\n  /**\n   * Re-positions the element\n   * @param {module:history.HistoryEventHandler} handler\n   * @fires module:history~Command#event:history\n   * @returns {undefined}\n  */\n  apply (handler) {\n    // TODO(codedread): Refactor this common event code into a base HistoryCommand class.\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.BEFORE_APPLY, this);\n    }\n\n    this.elem = this.newParent.insertBefore(this.elem, this.newNextSibling);\n\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.AFTER_APPLY, this);\n    }\n  }\n\n  /**\n   * Positions the element back to its original location\n   * @param {module:history.HistoryEventHandler} handler\n   * @fires module:history~Command#event:history\n   * @returns {undefined}\n  */\n  unapply (handler) {\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.BEFORE_UNAPPLY, this);\n    }\n\n    this.elem = this.oldParent.insertBefore(this.elem, this.oldNextSibling);\n\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.AFTER_UNAPPLY, this);\n    }\n  }\n\n  /**\n  * @returns {Element[]} Array with element associated with this command\n  */\n  elements () {\n    return [this.elem];\n  }\n}\nMoveElementCommand.type = MoveElementCommand.prototype.type;\n\n/**\n* History command for an element that was added to the DOM\n* @implements {module:history.HistoryCommand}\n*\n* @param {Element} elem - The newly added DOM element\n* @param {string} text - An optional string visible to user related to this change\n*/\nexport class InsertElementCommand extends Command {\n  constructor (elem, text) {\n    super();\n    this.elem = elem;\n    this.text = text || ('Create ' + elem.tagName);\n    this.parent = elem.parentNode;\n    this.nextSibling = this.elem.nextSibling;\n  }\n\n  type () {\n    return 'svgedit.history.InsertElementCommand';\n  }\n\n  /**\n  * Re-inserts the new element\n  * @param {module:history.HistoryEventHandler} handler\n  * @fires module:history~Command#event:history\n  * @returns {undefined}\n  */\n  apply (handler) {\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.BEFORE_APPLY, this);\n    }\n\n    this.elem = this.parent.insertBefore(this.elem, this.nextSibling);\n\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.AFTER_APPLY, this);\n    }\n  }\n\n  /**\n  * Removes the element\n  * @param {module:history.HistoryEventHandler} handler\n  * @fires module:history~Command#event:history\n  * @returns {undefined}\n  */\n  unapply (handler) {\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.BEFORE_UNAPPLY, this);\n    }\n\n    this.parent = this.elem.parentNode;\n    this.elem = this.elem.parentNode.removeChild(this.elem);\n\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.AFTER_UNAPPLY, this);\n    }\n  }\n\n  /**\n  * @returns {Element[]} Array with element associated with this command\n  */\n  elements () {\n    return [this.elem];\n  }\n}\nInsertElementCommand.type = InsertElementCommand.prototype.type;\n\n/**\n* History command for an element removed from the DOM\n* @implements {module:history.HistoryCommand}\n* @param {Element} elem - The removed DOM element\n* @param {Node} oldNextSibling - The DOM element's nextSibling when it was in the DOM\n* @param {Element} oldParent - The DOM element's parent\n* @param {string} [text] - An optional string visible to user related to this change\n*/\nexport class RemoveElementCommand extends Command {\n  constructor (elem, oldNextSibling, oldParent, text) {\n    super();\n    this.elem = elem;\n    this.text = text || ('Delete ' + elem.tagName);\n    this.nextSibling = oldNextSibling;\n    this.parent = oldParent;\n\n    // special hack for webkit: remove this element's entry in the svgTransformLists map\n    removeElementFromListMap(elem);\n  }\n  type () {\n    return 'svgedit.history.RemoveElementCommand';\n  }\n\n  /**\n  * Re-removes the new element\n  * @param {module:history.HistoryEventHandler} handler\n  * @fires module:history~Command#event:history\n  * @returns {undefined}\n  */\n  apply (handler) {\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.BEFORE_APPLY, this);\n    }\n\n    removeElementFromListMap(this.elem);\n    this.parent = this.elem.parentNode;\n    this.elem = this.parent.removeChild(this.elem);\n\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.AFTER_APPLY, this);\n    }\n  }\n\n  /**\n  * Re-adds the new element\n  * @param {module:history.HistoryEventHandler} handler\n  * @fires module:history~Command#event:history\n  * @returns {undefined}\n  */\n  unapply (handler) {\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.BEFORE_UNAPPLY, this);\n    }\n\n    removeElementFromListMap(this.elem);\n    if (this.nextSibling == null) {\n      if (window.console) {\n        console.log('Error: reference element was lost');\n      }\n    }\n    this.parent.insertBefore(this.elem, this.nextSibling); // Don't use `before` or `prepend` as `this.nextSibling` may be `null`\n\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.AFTER_UNAPPLY, this);\n    }\n  }\n\n  /**\n  * @returns {Element[]} Array with element associated with this command\n  */\n  elements () {\n    return [this.elem];\n  }\n}\nRemoveElementCommand.type = RemoveElementCommand.prototype.type;\n\n/**\n* @typedef {\"#text\"|\"#href\"|string} module:history.CommandAttributeName\n*/\n/**\n* @typedef {PlainObject.<module:history.CommandAttributeName, string>} module:history.CommandAttributes\n*/\n\n/**\n* History command to make a change to an element.\n* Usually an attribute change, but can also be textcontent.\n* @implements {module:history.HistoryCommand}\n* @param {Element} elem - The DOM element that was changed\n* @param {module:history.CommandAttributes} attrs - Attributes to be changed with the values they had *before* the change\n* @param {string} text - An optional string visible to user related to this change\n*/\nexport class ChangeElementCommand extends Command {\n  constructor (elem, attrs, text) {\n    super();\n    this.elem = elem;\n    this.text = text ? ('Change ' + elem.tagName + ' ' + text) : ('Change ' + elem.tagName);\n    this.newValues = {};\n    this.oldValues = attrs;\n    for (const attr in attrs) {\n      if (attr === '#text') {\n        this.newValues[attr] = elem.textContent;\n      } else if (attr === '#href') {\n        this.newValues[attr] = getHref(elem);\n      } else {\n        this.newValues[attr] = elem.getAttribute(attr);\n      }\n    }\n  }\n  type () {\n    return 'svgedit.history.ChangeElementCommand';\n  }\n\n  /**\n  * Performs the stored change action\n  * @param {module:history.HistoryEventHandler} handler\n  * @fires module:history~Command#event:history\n  * @returns {true}\n  */\n  apply (handler) {\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.BEFORE_APPLY, this);\n    }\n\n    let bChangedTransform = false;\n    for (const attr in this.newValues) {\n      if (this.newValues[attr]) {\n        if (attr === '#text') {\n          this.elem.textContent = this.newValues[attr];\n        } else if (attr === '#href') {\n          setHref(this.elem, this.newValues[attr]);\n        } else {\n          this.elem.setAttribute(attr, this.newValues[attr]);\n        }\n      } else {\n        if (attr === '#text') {\n          this.elem.textContent = '';\n        } else {\n          this.elem.setAttribute(attr, '');\n          this.elem.removeAttribute(attr);\n        }\n      }\n\n      if (attr === 'transform') { bChangedTransform = true; }\n    }\n\n    // relocate rotational transform, if necessary\n    if (!bChangedTransform) {\n      const angle = getRotationAngle(this.elem);\n      if (angle) {\n        const bbox = this.elem.getBBox();\n        const cx = bbox.x + bbox.width / 2,\n          cy = bbox.y + bbox.height / 2;\n        const rotate = ['rotate(', angle, ' ', cx, ',', cy, ')'].join('');\n        if (rotate !== this.elem.getAttribute('transform')) {\n          this.elem.setAttribute('transform', rotate);\n        }\n      }\n    }\n\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.AFTER_APPLY, this);\n    }\n\n    return true;\n  }\n\n  /**\n  * Reverses the stored change action\n  * @param {module:history.HistoryEventHandler} handler\n  * @fires module:history~Command#event:history\n  * @returns {true}\n  */\n  unapply (handler) {\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.BEFORE_UNAPPLY, this);\n    }\n\n    let bChangedTransform = false;\n    for (const attr in this.oldValues) {\n      if (this.oldValues[attr]) {\n        if (attr === '#text') {\n          this.elem.textContent = this.oldValues[attr];\n        } else if (attr === '#href') {\n          setHref(this.elem, this.oldValues[attr]);\n        } else {\n          this.elem.setAttribute(attr, this.oldValues[attr]);\n        }\n      } else {\n        if (attr === '#text') {\n          this.elem.textContent = '';\n        } else {\n          this.elem.removeAttribute(attr);\n        }\n      }\n      if (attr === 'transform') { bChangedTransform = true; }\n    }\n    // relocate rotational transform, if necessary\n    if (!bChangedTransform) {\n      const angle = getRotationAngle(this.elem);\n      if (angle) {\n        const bbox = this.elem.getBBox();\n        const cx = bbox.x + bbox.width / 2,\n          cy = bbox.y + bbox.height / 2;\n        const rotate = ['rotate(', angle, ' ', cx, ',', cy, ')'].join('');\n        if (rotate !== this.elem.getAttribute('transform')) {\n          this.elem.setAttribute('transform', rotate);\n        }\n      }\n    }\n\n    // Remove transformlist to prevent confusion that causes bugs like 575.\n    removeElementFromListMap(this.elem);\n\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.AFTER_UNAPPLY, this);\n    }\n\n    return true;\n  }\n\n  /**\n  * @returns {Element[]} Array with element associated with this command\n  */\n  elements () {\n    return [this.elem];\n  }\n}\nChangeElementCommand.type = ChangeElementCommand.prototype.type;\n\n// TODO: create a 'typing' command object that tracks changes in text\n// if a new Typing command is created and the top command on the stack is also a Typing\n// and they both affect the same element, then collapse the two commands into one\n\n/**\n* History command that can contain/execute multiple other commands\n* @implements {module:history.HistoryCommand}\n*/\nexport class BatchCommand extends Command {\n  /**\n  * @param {string} [text] - An optional string visible to user related to this change\n  */\n  constructor (text) {\n    super();\n    this.text = text || 'Batch Command';\n    this.stack = [];\n  }\n\n  type () {\n    return 'svgedit.history.BatchCommand';\n  }\n\n  /**\n  * Runs \"apply\" on all subcommands\n  * @param {module:history.HistoryEventHandler} handler\n  * @fires module:history~Command#event:history\n  * @returns {undefined}\n  */\n  apply (handler) {\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.BEFORE_APPLY, this);\n    }\n\n    const len = this.stack.length;\n    for (let i = 0; i < len; ++i) {\n      this.stack[i].apply(handler);\n    }\n\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.AFTER_APPLY, this);\n    }\n  }\n\n  /**\n  * Runs \"unapply\" on all subcommands\n  * @param {module:history.HistoryEventHandler} handler\n  * @fires module:history~Command#event:history\n  * @returns {undefined}\n  */\n  unapply (handler) {\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.BEFORE_UNAPPLY, this);\n    }\n\n    for (let i = this.stack.length - 1; i >= 0; i--) {\n      this.stack[i].unapply(handler);\n    }\n\n    if (handler) {\n      handler.handleHistoryEvent(HistoryEventTypes.AFTER_UNAPPLY, this);\n    }\n  }\n\n  /**\n  * Iterate through all our subcommands\n  * @returns {Element[]} All the elements we are changing\n  */\n  elements () {\n    const elems = [];\n    let cmd = this.stack.length;\n    while (cmd--) {\n      const thisElems = this.stack[cmd].elements();\n      let elem = thisElems.length;\n      while (elem--) {\n        if (!elems.includes(thisElems[elem])) { elems.push(thisElems[elem]); }\n      }\n    }\n    return elems;\n  }\n\n  /**\n  * Adds a given command to the history stack\n  * @param {Command} cmd - The undo command object to add\n  */\n  addSubCommand (cmd) {\n    this.stack.push(cmd);\n  }\n\n  /**\n  * @returns {boolean} Indicates whether or not the batch command is empty\n  */\n  isEmpty () {\n    return !this.stack.length;\n  }\n}\nBatchCommand.type = BatchCommand.prototype.type;\n\n/**\n*\n*/\nexport class UndoManager {\n  /**\n  * @param {module:history.HistoryEventHandler} historyEventHandler\n  */\n  constructor (historyEventHandler) {\n    this.handler_ = historyEventHandler || null;\n    this.undoStackPointer = 0;\n    this.undoStack = [];\n\n    // this is the stack that stores the original values, the elements and\n    // the attribute name for begin/finish\n    this.undoChangeStackPointer = -1;\n    this.undoableChangeStack = [];\n  }\n\n  /**\n  * Resets the undo stack, effectively clearing the undo/redo history\n  * @returns {undefined}\n  */\n  resetUndoStack () {\n    this.undoStack = [];\n    this.undoStackPointer = 0;\n  }\n\n  /**\n  * @returns {Integer} Current size of the undo history stack\n  */\n  getUndoStackSize () {\n    return this.undoStackPointer;\n  }\n\n  /**\n  * @returns {Integer} Current size of the redo history stack\n  */\n  getRedoStackSize () {\n    return this.undoStack.length - this.undoStackPointer;\n  }\n\n  /**\n  * @returns {string} String associated with the next undo command\n  */\n  getNextUndoCommandText () {\n    return this.undoStackPointer > 0 ? this.undoStack[this.undoStackPointer - 1].getText() : '';\n  }\n\n  /**\n  * @returns {string} String associated with the next redo command\n  */\n  getNextRedoCommandText () {\n    return this.undoStackPointer < this.undoStack.length ? this.undoStack[this.undoStackPointer].getText() : '';\n  }\n\n  /**\n  * Performs an undo step\n  * @returns {undefined}\n  */\n  undo () {\n    if (this.undoStackPointer > 0) {\n      const cmd = this.undoStack[--this.undoStackPointer];\n      cmd.unapply(this.handler_);\n    }\n  }\n\n  /**\n  * Performs a redo step\n  * @returns {undefined}\n  */\n  redo () {\n    if (this.undoStackPointer < this.undoStack.length && this.undoStack.length > 0) {\n      const cmd = this.undoStack[this.undoStackPointer++];\n      cmd.apply(this.handler_);\n    }\n  }\n\n  /**\n  * Adds a command object to the undo history stack\n  * @param {Command} cmd - The command object to add\n  * @returns {undefined}\n  */\n  addCommandToHistory (cmd) {\n    // FIXME: we MUST compress consecutive text changes to the same element\n    // (right now each keystroke is saved as a separate command that includes the\n    // entire text contents of the text element)\n    // TODO: consider limiting the history that we store here (need to do some slicing)\n\n    // if our stack pointer is not at the end, then we have to remove\n    // all commands after the pointer and insert the new command\n    if (this.undoStackPointer < this.undoStack.length && this.undoStack.length > 0) {\n      this.undoStack = this.undoStack.splice(0, this.undoStackPointer);\n    }\n    this.undoStack.push(cmd);\n    this.undoStackPointer = this.undoStack.length;\n  }\n\n  /**\n  * This function tells the canvas to remember the old values of the\n  * `attrName` attribute for each element sent in.  The elements and values\n  * are stored on a stack, so the next call to `finishUndoableChange()` will\n  * pop the elements and old values off the stack, gets the current values\n  * from the DOM and uses all of these to construct the undo-able command.\n  * @param {string} attrName - The name of the attribute being changed\n  * @param {Element[]} elems - Array of DOM elements being changed\n  * @returns {undefined}\n  */\n  beginUndoableChange (attrName, elems) {\n    const p = ++this.undoChangeStackPointer;\n    let i = elems.length;\n    const oldValues = new Array(i), elements = new Array(i);\n    while (i--) {\n      const elem = elems[i];\n      if (elem == null) { continue; }\n      elements[i] = elem;\n      oldValues[i] = elem.getAttribute(attrName);\n    }\n    this.undoableChangeStack[p] = {\n      attrName,\n      oldValues,\n      elements\n    };\n  }\n\n  /**\n  * This function returns a `BatchCommand` object which summarizes the\n  * change since `beginUndoableChange` was called.  The command can then\n  * be added to the command history\n  * @returns {BatchCommand} Batch command object with resulting changes\n  */\n  finishUndoableChange () {\n    const p = this.undoChangeStackPointer--;\n    const changeset = this.undoableChangeStack[p];\n    const {attrName} = changeset;\n    const batchCmd = new BatchCommand('Change ' + attrName);\n    let i = changeset.elements.length;\n    while (i--) {\n      const elem = changeset.elements[i];\n      if (elem == null) { continue; }\n      const changes = {};\n      changes[attrName] = changeset.oldValues[i];\n      if (changes[attrName] !== elem.getAttribute(attrName)) {\n        batchCmd.addSubCommand(new ChangeElementCommand(elem, changes, attrName));\n      }\n    }\n    this.undoableChangeStack[p] = null;\n    return batchCmd;\n  }\n}\n","/**\n * Mathematical utilities\n * @module math\n * @license MIT\n *\n * @copyright 2010 Alexis Deveria, 2010 Jeff Schiller\n */\n\n/**\n* @typedef {PlainObject} module:math.AngleCoord45\n* @property {Float} x - The angle-snapped x value\n* @property {Float} y - The angle-snapped y value\n* @property {Integer} a - The angle at which to snap\n*/\n\n/**\n* @typedef {PlainObject} module:math.XYObject\n* @property {Float} x\n* @property {Float} y\n*/\n\nimport {NS} from './namespaces.js';\nimport {getTransformList} from './svgtransformlist.js';\n\n// Constants\nconst NEAR_ZERO = 1e-14;\n\n// Throw away SVGSVGElement used for creating matrices/transforms.\nconst svg = document.createElementNS(NS.SVG, 'svg');\n\n/**\n * A (hopefully) quicker function to transform a point by a matrix\n * (this function avoids any DOM calls and just does the math)\n * @function module:math.transformPoint\n * @param {Float} x - Float representing the x coordinate\n * @param {Float} y - Float representing the y coordinate\n * @param {SVGMatrix} m - Matrix object to transform the point with\n * @returns {module:math.XYObject} An x, y object representing the transformed point\n*/\nexport const transformPoint = function (x, y, m) {\n  return {x: m.a * x + m.c * y + m.e, y: m.b * x + m.d * y + m.f};\n};\n\n/**\n * Helper function to check if the matrix performs no actual transform\n * (i.e. exists for identity purposes)\n * @function module:math.isIdentity\n * @param {SVGMatrix} m - The matrix object to check\n * @returns {boolean} Indicates whether or not the matrix is 1,0,0,1,0,0\n*/\nexport const isIdentity = function (m) {\n  return (m.a === 1 && m.b === 0 && m.c === 0 && m.d === 1 && m.e === 0 && m.f === 0);\n};\n\n/**\n * This function tries to return a `SVGMatrix` that is the multiplication `m1 * m2`.\n * We also round to zero when it's near zero\n * @function module:math.matrixMultiply\n * @param {...SVGMatrix} args - Matrix objects to multiply\n * @returns {SVGMatrix} The matrix object resulting from the calculation\n*/\nexport const matrixMultiply = function (...args) {\n  const m = args.reduceRight((prev, m1) => {\n    return m1.multiply(prev);\n  });\n\n  if (Math.abs(m.a) < NEAR_ZERO) { m.a = 0; }\n  if (Math.abs(m.b) < NEAR_ZERO) { m.b = 0; }\n  if (Math.abs(m.c) < NEAR_ZERO) { m.c = 0; }\n  if (Math.abs(m.d) < NEAR_ZERO) { m.d = 0; }\n  if (Math.abs(m.e) < NEAR_ZERO) { m.e = 0; }\n  if (Math.abs(m.f) < NEAR_ZERO) { m.f = 0; }\n\n  return m;\n};\n\n/**\n * See if the given transformlist includes a non-indentity matrix transform\n * @function module:math.hasMatrixTransform\n * @param {SVGTransformList} [tlist] - The transformlist to check\n * @returns {boolean} Whether or not a matrix transform was found\n*/\nexport const hasMatrixTransform = function (tlist) {\n  if (!tlist) { return false; }\n  let num = tlist.numberOfItems;\n  while (num--) {\n    const xform = tlist.getItem(num);\n    if (xform.type === 1 && !isIdentity(xform.matrix)) { return true; }\n  }\n  return false;\n};\n\n/**\n* @typedef {PlainObject} module:math.TransformedBox An object with the following values\n* @property {module:math.XYObject} tl - The top left coordinate\n* @property {module:math.XYObject} tr - The top right coordinate\n* @property {module:math.XYObject} bl - The bottom left coordinate\n* @property {module:math.XYObject} br - The bottom right coordinate\n* @property {PlainObject} aabox - Object with the following values:\n* @property {Float} aabox.x - Float with the axis-aligned x coordinate\n* @property {Float} aabox.y - Float with the axis-aligned y coordinate\n* @property {Float} aabox.width - Float with the axis-aligned width coordinate\n* @property {Float} aabox.height - Float with the axis-aligned height coordinate\n*/\n\n/**\n * Transforms a rectangle based on the given matrix\n * @function module:math.transformBox\n * @param {Float} l - Float with the box's left coordinate\n * @param {Float} t - Float with the box's top coordinate\n * @param {Float} w - Float with the box width\n * @param {Float} h - Float with the box height\n * @param {SVGMatrix} m - Matrix object to transform the box by\n * @returns {module:math.TransformedBox}\n*/\nexport const transformBox = function (l, t, w, h, m) {\n  const tl = transformPoint(l, t, m),\n    tr = transformPoint((l + w), t, m),\n    bl = transformPoint(l, (t + h), m),\n    br = transformPoint((l + w), (t + h), m),\n\n    minx = Math.min(tl.x, tr.x, bl.x, br.x),\n    maxx = Math.max(tl.x, tr.x, bl.x, br.x),\n    miny = Math.min(tl.y, tr.y, bl.y, br.y),\n    maxy = Math.max(tl.y, tr.y, bl.y, br.y);\n\n  return {\n    tl,\n    tr,\n    bl,\n    br,\n    aabox: {\n      x: minx,\n      y: miny,\n      width: (maxx - minx),\n      height: (maxy - miny)\n    }\n  };\n};\n\n/**\n * This returns a single matrix Transform for a given Transform List\n * (this is the equivalent of `SVGTransformList.consolidate()` but unlike\n * that method, this one does not modify the actual `SVGTransformList`).\n * This function is very liberal with its `min`, `max` arguments\n * @function module:math.transformListToTransform\n * @param {SVGTransformList} tlist - The transformlist object\n * @param {Integer} [min=0] - Optional integer indicating start transform position\n * @param {Integer} [max] - Optional integer indicating end transform position;\n *   defaults to one less than the tlist's `numberOfItems`\n * @returns {SVGTransform} A single matrix transform object\n*/\nexport const transformListToTransform = function (tlist, min, max) {\n  if (tlist == null) {\n    // Or should tlist = null have been prevented before this?\n    return svg.createSVGTransformFromMatrix(svg.createSVGMatrix());\n  }\n  min = min || 0;\n  max = max || (tlist.numberOfItems - 1);\n  min = parseInt(min, 10);\n  max = parseInt(max, 10);\n  if (min > max) { const temp = max; max = min; min = temp; }\n  let m = svg.createSVGMatrix();\n  for (let i = min; i <= max; ++i) {\n    // if our indices are out of range, just use a harmless identity matrix\n    const mtom = (i >= 0 && i < tlist.numberOfItems\n      ? tlist.getItem(i).matrix\n      : svg.createSVGMatrix());\n    m = matrixMultiply(m, mtom);\n  }\n  return svg.createSVGTransformFromMatrix(m);\n};\n\n/**\n * Get the matrix object for a given element\n * @function module:math.getMatrix\n * @param {Element} elem - The DOM element to check\n * @returns {SVGMatrix} The matrix object associated with the element's transformlist\n*/\nexport const getMatrix = function (elem) {\n  const tlist = getTransformList(elem);\n  return transformListToTransform(tlist).matrix;\n};\n\n/**\n * Returns a 45 degree angle coordinate associated with the two given\n * coordinates\n * @function module:math.snapToAngle\n * @param {Integer} x1 - First coordinate's x value\n * @param {Integer} x2 - Second coordinate's x value\n * @param {Integer} y1 - First coordinate's y value\n * @param {Integer} y2 - Second coordinate's y value\n * @returns {module:math.AngleCoord45}\n*/\nexport const snapToAngle = function (x1, y1, x2, y2) {\n  const snap = Math.PI / 4; // 45 degrees\n  const dx = x2 - x1;\n  const dy = y2 - y1;\n  const angle = Math.atan2(dy, dx);\n  const dist = Math.sqrt(dx * dx + dy * dy);\n  const snapangle = Math.round(angle / snap) * snap;\n\n  return {\n    x: x1 + dist * Math.cos(snapangle),\n    y: y1 + dist * Math.sin(snapangle),\n    a: snapangle\n  };\n};\n\n/**\n * Check if two rectangles (BBoxes objects) intersect each other\n * @function module:math.rectsIntersect\n * @param {SVGRect} r1 - The first BBox-like object\n * @param {SVGRect} r2 - The second BBox-like object\n * @returns {boolean} True if rectangles intersect\n */\nexport const rectsIntersect = function (r1, r2) {\n  return r2.x < (r1.x + r1.width) &&\n    (r2.x + r2.width) > r1.x &&\n    r2.y < (r1.y + r1.height) &&\n    (r2.y + r2.height) > r1.y;\n};\n","/* globals jQuery */\n/**\n * Path functionality\n * @module path\n * @license MIT\n *\n * @copyright 2011 Alexis Deveria, 2011 Jeff Schiller\n */\n\nimport './svgpathseg.js';\nimport {NS} from './namespaces.js';\nimport {getTransformList} from './svgtransformlist.js';\nimport {shortFloat} from './units.js';\nimport {ChangeElementCommand, BatchCommand} from './history.js';\nimport {\n  transformPoint, getMatrix, snapToAngle, rectsIntersect,\n  transformListToTransform\n} from './math.js';\nimport {\n  assignAttributes, getElem, getRotationAngle, getBBox,\n  getRefElem, findDefs, snapToGrid,\n  getBBox as utilsGetBBox\n} from './utilities.js';\nimport {\n  supportsPathInsertItemBefore, supportsPathReplaceItem, isWebkit\n} from './browser.js';\n\nconst $ = jQuery;\n\nconst segData = {\n  2: ['x', 'y'], // PATHSEG_MOVETO_ABS\n  4: ['x', 'y'], // PATHSEG_LINETO_ABS\n  6: ['x', 'y', 'x1', 'y1', 'x2', 'y2'], // PATHSEG_CURVETO_CUBIC_ABS\n  8: ['x', 'y', 'x1', 'y1'], // PATHSEG_CURVETO_QUADRATIC_ABS\n  10: ['x', 'y', 'r1', 'r2', 'angle', 'largeArcFlag', 'sweepFlag'], // PATHSEG_ARC_ABS\n  12: ['x'], // PATHSEG_LINETO_HORIZONTAL_ABS\n  14: ['y'], // PATHSEG_LINETO_VERTICAL_ABS\n  16: ['x', 'y', 'x2', 'y2'], // PATHSEG_CURVETO_CUBIC_SMOOTH_ABS\n  18: ['x', 'y'] // PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS\n};\n\n/**\n * @tutorial LocaleDocs\n * @typedef {module:locale.LocaleStrings|PlainObject} module:path.uiStrings\n * @property {PlainObject.<string, string>} ui\n*/\n\nconst uiStrings = {};\n/**\n* @function module:path.setUiStrings\n* @param {module:path.uiStrings} strs\n* @returns {undefined}\n*/\nexport const setUiStrings = function (strs) {\n  Object.assign(uiStrings, strs.ui);\n};\n\nlet pathFuncs = [];\n\nlet linkControlPts = true;\n\n// Stores references to paths via IDs.\n// TODO: Make this cross-document happy.\nlet pathData = {};\n\n/**\n* @function module:path.setLinkControlPoints\n* @param {boolean} lcp\n* @returns {undefined}\n*/\nexport const setLinkControlPoints = function (lcp) {\n  linkControlPts = lcp;\n};\n\n/**\n * @name module:path.path\n * @type {null|module:path.Path}\n * @memberof module:path\n*/\nexport let path = null;\n\nlet editorContext_ = null;\n\n/**\n* @external MouseEvent\n*/\n\n/**\n* Object with the following keys/values\n* @typedef {PlainObject} module:path.SVGElementJSON\n* @property {string} element - Tag name of the SVG element to create\n* @property {PlainObject.<string, string>} attr - Has key-value attributes to assign to the new element\n* @property {boolean} [curStyles=false] - Indicates whether current style attributes should be applied first\n* @property {module:path.SVGElementJSON[]} [children] - Data objects to be added recursively as children\n* @property {string} [namespace=\"http://www.w3.org/2000/svg\"] - Indicate a (non-SVG) namespace\n*/\n/**\n * @interface module:path.EditorContext\n * @property {module:select.SelectorManager} selectorManager\n * @property {module:svgcanvas.SvgCanvas} canvas\n */\n/**\n * @function module:path.EditorContext#call\n * @param {\"selected\"|\"changed\"} ev - String with the event name\n * @param {module:svgcanvas.SvgCanvas#event:selected|module:svgcanvas.SvgCanvas#event:changed} arg - Argument to pass through to the callback function. If the event is \"changed\", an array of `Element`s is passed; if \"selected\", a single-item array of `Element` is passed.\n * @returns {undefined}\n */\n/**\n * @function module:path.EditorContext#resetD\n * @param {SVGPathElement} p\n * @returns {undefined}\n*/\n/**\n * Note: This doesn't round to an integer necessarily\n * @function module:path.EditorContext#round\n * @param {Float} val\n * @returns {Float} Rounded value to nearest value based on `currentZoom`\n */\n/**\n * @function module:path.EditorContext#clearSelection\n * @param {boolean} [noCall] - When `true`, does not call the \"selected\" handler\n * @returns {undefined}\n*/\n/**\n * @function module:path.EditorContext#addToSelection\n * @param {Element[]} elemsToAdd - An array of DOM elements to add to the selection\n * @param {boolean} showGrips - Indicates whether the resize grips should be shown\n * @returns {undefined}\n*/\n/**\n * @function module:path.EditorContext#addCommandToHistory\n * @param {Command} cmd\n * @returns {undefined}\n */\n/**\n * @function module:path.EditorContext#remapElement\n * @param {Element} selected - DOM element to be changed\n * @param {PlainObject.<string, string>} changes - Object with changes to be remapped\n * @param {SVGMatrix} m - Matrix object to use for remapping coordinates\n * @returns {undefined}\n */\n/**\n * @function module:path.EditorContext#addSVGElementFromJson\n * @param {module:path.SVGElementJSON} data\n * @returns {Element} The new element\n*/\n/**\n * @function module:path.EditorContext#getGridSnapping\n * @returns {boolean}\n */\n/**\n * @function module:path.EditorContext#getOpacity\n * @returns {Float}\n */\n/**\n * @function module:path.EditorContext#getSelectedElements\n * @returns {Element[]} the array with selected DOM elements\n*/\n/**\n * @function module:path.EditorContext#getContainer\n * @returns {Element}\n */\n/**\n * @function module:path.EditorContext#setStarted\n * @param {boolean} s\n * @returns {undefined}\n */\n/**\n * @function module:path.EditorContext#getRubberBox\n * @returns {SVGRectElement}\n*/\n/**\n * @function module:path.EditorContext#setRubberBox\n * @param {SVGRectElement} rb\n * @returns {SVGRectElement} Same as parameter passed in\n */\n/**\n * @function module:path.EditorContext#addPtsToSelection\n * @param {PlainObject} cfg\n * @param {boolean} cfg.closedSubpath\n * @param {SVGCircleElement[]} cfg.grips\n * @returns {undefined}\n */\n/**\n * @function module:path.EditorContext#endChanges\n * @param {PlainObject} cfg\n * @param {string} cfg.cmd\n * @param {Element} cfg.elem\n * @returns {undefined}\n*/\n/**\n * @function module:path.EditorContext#getCurrentZoom\n * @returns {Float} The current zoom level\n */\n/**\n * Returns the last created DOM element ID string\n * @function module:path.EditorContext#getId\n * @returns {string}\n */\n/**\n * Creates and returns a unique ID string for a DOM element\n * @function module:path.EditorContext#getNextId\n * @returns {string}\n*/\n/**\n * Gets the desired element from a mouse event\n * @function module:path.EditorContext#getMouseTarget\n * @param {external:MouseEvent} evt - Event object from the mouse event\n * @returns {Element} DOM element we want\n */\n/**\n * @function module:path.EditorContext#getCurrentMode\n * @returns {string}\n */\n/**\n * @function module:path.EditorContext#setCurrentMode\n * @param {string} cm The mode\n * @returns {string} The same mode as passed in\n*/\n/**\n * @function module:path.EditorContext#getDrawnPath\n * @returns {SVGPathElement|null}\n */\n/**\n * @function module:path.EditorContext#setDrawnPath\n * @param {SVGPathElement|null} dp\n * @returns {SVGPathElement|null} The same value as passed in\n */\n/**\n * @function module:path.EditorContext#getSVGRoot\n * @returns {SVGSVGElement}\n*/\n\n/**\n* @function module:path.init\n* @param {module:path.EditorContext} editorContext\n* @returns {undefined}\n*/\nexport const init = function (editorContext) {\n  editorContext_ = editorContext;\n\n  pathFuncs = [0, 'ClosePath'];\n  const pathFuncsStrs = ['Moveto', 'Lineto', 'CurvetoCubic', 'CurvetoQuadratic', 'Arc',\n    'LinetoHorizontal', 'LinetoVertical', 'CurvetoCubicSmooth', 'CurvetoQuadraticSmooth'];\n  $.each(pathFuncsStrs, function (i, s) {\n    pathFuncs.push(s + 'Abs');\n    pathFuncs.push(s + 'Rel');\n  });\n};\n\n/**\n* @function module:path.insertItemBefore\n* @param {Element} elem\n* @param {Segment} newseg\n* @param {Integer} index\n* @returns {undefined}\n*/\nexport const insertItemBefore = function (elem, newseg, index) {\n  // Support insertItemBefore on paths for FF2\n  const list = elem.pathSegList;\n\n  if (supportsPathInsertItemBefore()) {\n    list.insertItemBefore(newseg, index);\n    return;\n  }\n  const len = list.numberOfItems;\n  const arr = [];\n  for (let i = 0; i < len; i++) {\n    const curSeg = list.getItem(i);\n    arr.push(curSeg);\n  }\n  list.clear();\n  for (let i = 0; i < len; i++) {\n    if (i === index) { // index + 1\n      list.appendItem(newseg);\n    }\n    list.appendItem(arr[i]);\n  }\n};\n\n/**\n* @function module:path.ptObjToArr\n* @todo See if this should just live in `replacePathSeg`\n* @param {string} type\n* @param {SVGPathSegMovetoAbs|SVGPathSegLinetoAbs|SVGPathSegCurvetoCubicAbs|SVGPathSegCurvetoQuadraticAbs|SVGPathSegArcAbs|SVGPathSegLinetoHorizontalAbs|SVGPathSegLinetoVerticalAbs|SVGPathSegCurvetoCubicSmoothAbs|SVGPathSegCurvetoQuadraticSmoothAbs} segItem\n* @returns {ArgumentsArray}\n*/\nexport const ptObjToArr = function (type, segItem) {\n  const props = segData[type];\n  return props.map((prop) => {\n    return segItem[prop];\n  });\n};\n\n/**\n* @function module:path.getGripPt\n* @param {Segment} seg\n* @param {module:math.XYObject} altPt\n* @returns {module:math.XYObject}\n*/\nexport const getGripPt = function (seg, altPt) {\n  const {path} = seg;\n  let out = {\n    x: altPt ? altPt.x : seg.item.x,\n    y: altPt ? altPt.y : seg.item.y\n  };\n\n  if (path.matrix) {\n    const pt = transformPoint(out.x, out.y, path.matrix);\n    out = pt;\n  }\n\n  const currentZoom = editorContext_.getCurrentZoom();\n  out.x *= currentZoom;\n  out.y *= currentZoom;\n\n  return out;\n};\n\n/**\n* @function module:path.getPointFromGrip\n* @param {module:math.XYObject} pt\n* @param {module:path.Path} path\n* @returns {module:math.XYObject}\n*/\nexport const getPointFromGrip = function (pt, path) {\n  const out = {\n    x: pt.x,\n    y: pt.y\n  };\n\n  if (path.matrix) {\n    pt = transformPoint(out.x, out.y, path.imatrix);\n    out.x = pt.x;\n    out.y = pt.y;\n  }\n\n  const currentZoom = editorContext_.getCurrentZoom();\n  out.x /= currentZoom;\n  out.y /= currentZoom;\n\n  return out;\n};\n\n/**\n* Requires prior call to `setUiStrings` if `xlink:title`\n*    to be set on the grip\n* @function module:path.addPointGrip\n* @param {Integer} index\n* @param {Integer} x\n* @param {Integer} y\n* @returns {SVGCircleElement}\n*/\nexport const addPointGrip = function (index, x, y) {\n  // create the container of all the point grips\n  const pointGripContainer = getGripContainer();\n\n  let pointGrip = getElem('pathpointgrip_' + index);\n  // create it\n  if (!pointGrip) {\n    pointGrip = document.createElementNS(NS.SVG, 'circle');\n    const atts = {\n      id: 'pathpointgrip_' + index,\n      display: 'none',\n      r: 4,\n      fill: '#0FF',\n      stroke: '#00F',\n      'stroke-width': 2,\n      cursor: 'move',\n      style: 'pointer-events:all'\n    };\n    if ('pathNodeTooltip' in uiStrings) { // May be empty if running path.js without svg-editor\n      atts['xlink:title'] = uiStrings.pathNodeTooltip;\n    }\n    assignAttributes(pointGrip, atts);\n    pointGrip = pointGripContainer.appendChild(pointGrip);\n\n    const grip = $('#pathpointgrip_' + index);\n    grip.dblclick(function () {\n      if (path) {\n        path.setSegType();\n      }\n    });\n  }\n  if (x && y) {\n    // set up the point grip element and display it\n    assignAttributes(pointGrip, {\n      cx: x,\n      cy: y,\n      display: 'inline'\n    });\n  }\n  return pointGrip;\n};\n\n/**\n* @function module:path.getGripContainer\n* @returns {Element}\n*/\nexport const getGripContainer = function () {\n  let c = getElem('pathpointgrip_container');\n  if (!c) {\n    const parent = getElem('selectorParentGroup');\n    c = parent.appendChild(document.createElementNS(NS.SVG, 'g'));\n    c.id = 'pathpointgrip_container';\n  }\n  return c;\n};\n\n/**\n* Requires prior call to `setUiStrings` if `xlink:title`\n*    to be set on the grip\n* @function module:path.addCtrlGrip\n* @param {string} id\n* @returns {SVGCircleElement}\n*/\nexport const addCtrlGrip = function (id) {\n  let pointGrip = getElem('ctrlpointgrip_' + id);\n  if (pointGrip) { return pointGrip; }\n\n  pointGrip = document.createElementNS(NS.SVG, 'circle');\n  const atts = {\n    id: 'ctrlpointgrip_' + id,\n    display: 'none',\n    r: 4,\n    fill: '#0FF',\n    stroke: '#55F',\n    'stroke-width': 1,\n    cursor: 'move',\n    style: 'pointer-events:all'\n  };\n  if ('pathCtrlPtTooltip' in uiStrings) { // May be empty if running path.js without svg-editor\n    atts['xlink:title'] = uiStrings.pathCtrlPtTooltip;\n  }\n  assignAttributes(pointGrip, atts);\n  getGripContainer().append(pointGrip);\n  return pointGrip;\n};\n\n/**\n* @function module:path.getCtrlLine\n* @param {string} id\n* @returns {SVGLineElement}\n*/\nexport const getCtrlLine = function (id) {\n  let ctrlLine = getElem('ctrlLine_' + id);\n  if (ctrlLine) { return ctrlLine; }\n\n  ctrlLine = document.createElementNS(NS.SVG, 'line');\n  assignAttributes(ctrlLine, {\n    id: 'ctrlLine_' + id,\n    stroke: '#555',\n    'stroke-width': 1,\n    style: 'pointer-events:none'\n  });\n  getGripContainer().append(ctrlLine);\n  return ctrlLine;\n};\n\n/**\n* @function module:path.getPointGrip\n* @param {Segment} seg\n* @param {boolean} update\n* @returns {SVGCircleElement}\n*/\nexport const getPointGrip = function (seg, update) {\n  const {index} = seg;\n  const pointGrip = addPointGrip(index);\n\n  if (update) {\n    const pt = getGripPt(seg);\n    assignAttributes(pointGrip, {\n      cx: pt.x,\n      cy: pt.y,\n      display: 'inline'\n    });\n  }\n\n  return pointGrip;\n};\n\n/**\n* @function module:path.getControlPoints\n* @param {Segment} seg\n* @returns {PlainObject.<string, SVGLineElement|SVGCircleElement>}\n*/\nexport const getControlPoints = function (seg) {\n  const {item, index} = seg;\n  if (!('x1' in item) || !('x2' in item)) { return null; }\n  const cpt = {};\n  /* const pointGripContainer = */ getGripContainer();\n\n  // Note that this is intentionally not seg.prev.item\n  const prev = path.segs[index - 1].item;\n\n  const segItems = [prev, item];\n\n  for (let i = 1; i < 3; i++) {\n    const id = index + 'c' + i;\n\n    const ctrlLine = cpt['c' + i + '_line'] = getCtrlLine(id);\n\n    const pt = getGripPt(seg, {x: item['x' + i], y: item['y' + i]});\n    const gpt = getGripPt(seg, {x: segItems[i - 1].x, y: segItems[i - 1].y});\n\n    assignAttributes(ctrlLine, {\n      x1: pt.x,\n      y1: pt.y,\n      x2: gpt.x,\n      y2: gpt.y,\n      display: 'inline'\n    });\n\n    cpt['c' + i + '_line'] = ctrlLine;\n\n    // create it\n    const pointGrip = cpt['c' + i] = addCtrlGrip(id);\n\n    assignAttributes(pointGrip, {\n      cx: pt.x,\n      cy: pt.y,\n      display: 'inline'\n    });\n    cpt['c' + i] = pointGrip;\n  }\n  return cpt;\n};\n\n/**\n* This replaces the segment at the given index. Type is given as number.\n* @function module:path.replacePathSeg\n* @param {Integer} type Possible values set during {@link module:path.init}\n* @param {Integer} index\n* @param {ArgumentsArray} pts\n* @param {SVGPathElement} elem\n*/\nexport const replacePathSeg = function (type, index, pts, elem) {\n  const pth = elem || path.elem;\n\n  const func = 'createSVGPathSeg' + pathFuncs[type];\n  const seg = pth[func].apply(pth, pts);\n\n  if (supportsPathReplaceItem()) {\n    pth.pathSegList.replaceItem(seg, index);\n  } else {\n    const segList = pth.pathSegList;\n    const len = segList.numberOfItems;\n    const arr = [];\n    for (let i = 0; i < len; i++) {\n      const curSeg = segList.getItem(i);\n      arr.push(curSeg);\n    }\n    segList.clear();\n    for (let i = 0; i < len; i++) {\n      if (i === index) {\n        segList.appendItem(seg);\n      } else {\n        segList.appendItem(arr[i]);\n      }\n    }\n  }\n};\n\n/**\n* @function module:path.getSegSelector\n* @param {Segment} seg\n* @param {boolean} update\n* @returns {SVGPathElement}\n*/\nexport const getSegSelector = function (seg, update) {\n  const {index} = seg;\n  let segLine = getElem('segline_' + index);\n  if (!segLine) {\n    const pointGripContainer = getGripContainer();\n    // create segline\n    segLine = document.createElementNS(NS.SVG, 'path');\n    assignAttributes(segLine, {\n      id: 'segline_' + index,\n      display: 'none',\n      fill: 'none',\n      stroke: '#0FF',\n      'stroke-width': 2,\n      style: 'pointer-events:none',\n      d: 'M0,0 0,0'\n    });\n    pointGripContainer.append(segLine);\n  }\n\n  if (update) {\n    const {prev} = seg;\n    if (!prev) {\n      segLine.setAttribute('display', 'none');\n      return segLine;\n    }\n\n    const pt = getGripPt(prev);\n    // Set start point\n    replacePathSeg(2, 0, [pt.x, pt.y], segLine);\n\n    const pts = ptObjToArr(seg.type, seg.item, true);\n    for (let i = 0; i < pts.length; i += 2) {\n      const pt = getGripPt(seg, {x: pts[i], y: pts[i + 1]});\n      pts[i] = pt.x;\n      pts[i + 1] = pt.y;\n    }\n\n    replacePathSeg(seg.type, 1, pts, segLine);\n  }\n  return segLine;\n};\n\n/**\n * @typedef {PlainObject} Point\n * @property {Integer} x The x value\n * @property {Integer} y The y value\n */\n\n/**\n* Takes three points and creates a smoother line based on them\n* @function module:path.smoothControlPoints\n* @param {Point} ct1 - Object with x and y values (first control point)\n* @param {Point} ct2 - Object with x and y values (second control point)\n* @param {Point} pt - Object with x and y values (third point)\n* @returns {Point[]} Array of two \"smoothed\" point objects\n*/\nexport const smoothControlPoints = function (ct1, ct2, pt) {\n  // each point must not be the origin\n  const x1 = ct1.x - pt.x,\n    y1 = ct1.y - pt.y,\n    x2 = ct2.x - pt.x,\n    y2 = ct2.y - pt.y;\n\n  if ((x1 !== 0 || y1 !== 0) && (x2 !== 0 || y2 !== 0)) {\n    const\n      r1 = Math.sqrt(x1 * x1 + y1 * y1),\n      r2 = Math.sqrt(x2 * x2 + y2 * y2),\n      nct1 = editorContext_.getSVGRoot().createSVGPoint(),\n      nct2 = editorContext_.getSVGRoot().createSVGPoint();\n    let anglea = Math.atan2(y1, x1),\n      angleb = Math.atan2(y2, x2);\n    if (anglea < 0) { anglea += 2 * Math.PI; }\n    if (angleb < 0) { angleb += 2 * Math.PI; }\n\n    const angleBetween = Math.abs(anglea - angleb),\n      angleDiff = Math.abs(Math.PI - angleBetween) / 2;\n\n    let newAnglea, newAngleb;\n    if (anglea - angleb > 0) {\n      newAnglea = angleBetween < Math.PI ? (anglea + angleDiff) : (anglea - angleDiff);\n      newAngleb = angleBetween < Math.PI ? (angleb - angleDiff) : (angleb + angleDiff);\n    } else {\n      newAnglea = angleBetween < Math.PI ? (anglea - angleDiff) : (anglea + angleDiff);\n      newAngleb = angleBetween < Math.PI ? (angleb + angleDiff) : (angleb - angleDiff);\n    }\n\n    // rotate the points\n    nct1.x = r1 * Math.cos(newAnglea) + pt.x;\n    nct1.y = r1 * Math.sin(newAnglea) + pt.y;\n    nct2.x = r2 * Math.cos(newAngleb) + pt.x;\n    nct2.y = r2 * Math.sin(newAngleb) + pt.y;\n\n    return [nct1, nct2];\n  }\n  return undefined;\n};\n\n/**\n*\n*/\nexport class Segment {\n  /**\n  * @param {Integer} index\n  * @param {SVGPathSeg} item\n  * @todo Is `item` be more constrained here?\n  */\n  constructor (index, item) {\n    this.selected = false;\n    this.index = index;\n    this.item = item;\n    this.type = item.pathSegType;\n\n    this.ctrlpts = [];\n    this.ptgrip = null;\n    this.segsel = null;\n  }\n\n  /**\n   * @param {boolean} y\n   * @returns {undefined}\n   */\n  showCtrlPts (y) {\n    for (const i in this.ctrlpts) {\n      if (this.ctrlpts.hasOwnProperty(i)) {\n        this.ctrlpts[i].setAttribute('display', y ? 'inline' : 'none');\n      }\n    }\n  }\n\n  /**\n   * @param {boolean} y\n   * @returns {undefined}\n   */\n  selectCtrls (y) {\n    $('#ctrlpointgrip_' + this.index + 'c1, #ctrlpointgrip_' + this.index + 'c2')\n      .attr('fill', y ? '#0FF' : '#EEE');\n  }\n\n  /**\n   * @param {boolean} y\n   * @returns {undefined}\n   */\n  show (y) {\n    if (this.ptgrip) {\n      this.ptgrip.setAttribute('display', y ? 'inline' : 'none');\n      this.segsel.setAttribute('display', y ? 'inline' : 'none');\n      // Show/hide all control points if available\n      this.showCtrlPts(y);\n    }\n  }\n\n  /**\n   * @param {boolean} y\n   * @returns {undefined}\n   */\n  select (y) {\n    if (this.ptgrip) {\n      this.ptgrip.setAttribute('stroke', y ? '#0FF' : '#00F');\n      this.segsel.setAttribute('display', y ? 'inline' : 'none');\n      if (this.ctrlpts) {\n        this.selectCtrls(y);\n      }\n      this.selected = y;\n    }\n  }\n\n  /**\n   * @returns {undefined}\n   */\n  addGrip () {\n    this.ptgrip = getPointGrip(this, true);\n    this.ctrlpts = getControlPoints(this, true);\n    this.segsel = getSegSelector(this, true);\n  }\n\n  /**\n   * @param {boolean} full\n   * @returns {undefined}\n   */\n  update (full) {\n    if (this.ptgrip) {\n      const pt = getGripPt(this);\n      assignAttributes(this.ptgrip, {\n        cx: pt.x,\n        cy: pt.y\n      });\n\n      getSegSelector(this, true);\n\n      if (this.ctrlpts) {\n        if (full) {\n          this.item = path.elem.pathSegList.getItem(this.index);\n          this.type = this.item.pathSegType;\n        }\n        getControlPoints(this);\n      }\n      // this.segsel.setAttribute('display', y ? 'inline' : 'none');\n    }\n  }\n\n  /**\n   * @param {Integer} dx\n   * @param {Integer} dy\n   * @returns {undefined}\n   */\n  move (dx, dy) {\n    const {item} = this;\n\n    const curPts = this.ctrlpts\n      ? [item.x += dx, item.y += dy,\n        item.x1, item.y1, item.x2 += dx, item.y2 += dy\n      ]\n      : [item.x += dx, item.y += dy];\n\n    replacePathSeg(this.type, this.index, curPts);\n\n    if (this.next && this.next.ctrlpts) {\n      const next = this.next.item;\n      const nextPts = [next.x, next.y,\n        next.x1 += dx, next.y1 += dy, next.x2, next.y2];\n      replacePathSeg(this.next.type, this.next.index, nextPts);\n    }\n\n    if (this.mate) {\n      // The last point of a closed subpath has a 'mate',\n      // which is the 'M' segment of the subpath\n      const {item} = this.mate;\n      const pts = [item.x += dx, item.y += dy];\n      replacePathSeg(this.mate.type, this.mate.index, pts);\n      // Has no grip, so does not need 'updating'?\n    }\n\n    this.update(true);\n    if (this.next) { this.next.update(true); }\n  }\n\n  /**\n   * @param {Integer} num\n   * @returns {undefined}\n   */\n  setLinked (num) {\n    let seg, anum, pt;\n    if (num === 2) {\n      anum = 1;\n      seg = this.next;\n      if (!seg) { return; }\n      pt = this.item;\n    } else {\n      anum = 2;\n      seg = this.prev;\n      if (!seg) { return; }\n      pt = seg.item;\n    }\n\n    const {item} = seg;\n    item['x' + anum] = pt.x + (pt.x - this.item['x' + num]);\n    item['y' + anum] = pt.y + (pt.y - this.item['y' + num]);\n\n    const pts = [item.x, item.y,\n      item.x1, item.y1,\n      item.x2, item.y2];\n\n    replacePathSeg(seg.type, seg.index, pts);\n    seg.update(true);\n  }\n\n  /**\n   * @param {Integer} num\n   * @param {Integer} dx\n   * @param {Integer} dy\n   * @returns {undefined}\n   */\n  moveCtrl (num, dx, dy) {\n    const {item} = this;\n    item['x' + num] += dx;\n    item['y' + num] += dy;\n\n    const pts = [item.x, item.y,\n      item.x1, item.y1, item.x2, item.y2];\n\n    replacePathSeg(this.type, this.index, pts);\n    this.update(true);\n  }\n\n  /**\n   * @param {Integer} newType Possible values set during {@link module:path.init}\n   * @param {ArgumentsArray} pts\n   */\n  setType (newType, pts) {\n    replacePathSeg(newType, this.index, pts);\n    this.type = newType;\n    this.item = path.elem.pathSegList.getItem(this.index);\n    this.showCtrlPts(newType === 6);\n    this.ctrlpts = getControlPoints(this);\n    this.update(true);\n  }\n}\n\n/**\n*\n*/\nexport class Path {\n  /**\n  * @param {SVGPathElement}\n  * @throws {Error} If constructed without a path element\n  */\n  constructor (elem) {\n    if (!elem || elem.tagName !== 'path') {\n      throw new Error('svgedit.path.Path constructed without a <path> element');\n    }\n\n    this.elem = elem;\n    this.segs = [];\n    this.selected_pts = [];\n    path = this;\n\n    this.init();\n  }\n\n  /**\n  * Reset path data\n  * @returns {module:path.Path}\n  */\n  init () {\n    // Hide all grips, etc\n\n    // fixed, needed to work on all found elements, not just first\n    $(getGripContainer()).find('*').each(function () {\n      $(this).attr('display', 'none');\n    });\n\n    const segList = this.elem.pathSegList;\n    const len = segList.numberOfItems;\n    this.segs = [];\n    this.selected_pts = [];\n    this.first_seg = null;\n\n    // Set up segs array\n    for (let i = 0; i < len; i++) {\n      const item = segList.getItem(i);\n      const segment = new Segment(i, item);\n      segment.path = this;\n      this.segs.push(segment);\n    }\n\n    const {segs} = this;\n\n    let startI = null;\n    for (let i = 0; i < len; i++) {\n      const seg = segs[i];\n      const nextSeg = (i + 1) >= len ? null : segs[i + 1];\n      const prevSeg = (i - 1) < 0 ? null : segs[i - 1];\n      if (seg.type === 2) {\n        if (prevSeg && prevSeg.type !== 1) {\n          // New sub-path, last one is open,\n          // so add a grip to last sub-path's first point\n          const startSeg = segs[startI];\n          startSeg.next = segs[startI + 1];\n          startSeg.next.prev = startSeg;\n          startSeg.addGrip();\n        }\n        // Remember that this is a starter seg\n        startI = i;\n      } else if (nextSeg && nextSeg.type === 1) {\n        // This is the last real segment of a closed sub-path\n        // Next is first seg after \"M\"\n        seg.next = segs[startI + 1];\n\n        // First seg after \"M\"'s prev is this\n        seg.next.prev = seg;\n        seg.mate = segs[startI];\n        seg.addGrip();\n        if (this.first_seg == null) {\n          this.first_seg = seg;\n        }\n      } else if (!nextSeg) {\n        if (seg.type !== 1) {\n          // Last seg, doesn't close so add a grip\n          // to last sub-path's first point\n          const startSeg = segs[startI];\n          startSeg.next = segs[startI + 1];\n          startSeg.next.prev = startSeg;\n          startSeg.addGrip();\n          seg.addGrip();\n\n          if (!this.first_seg) {\n            // Open path, so set first as real first and add grip\n            this.first_seg = segs[startI];\n          }\n        }\n      } else if (seg.type !== 1) {\n        // Regular segment, so add grip and its \"next\"\n        seg.addGrip();\n\n        // Don't set its \"next\" if it's an \"M\"\n        if (nextSeg && nextSeg.type !== 2) {\n          seg.next = nextSeg;\n          seg.next.prev = seg;\n        }\n      }\n    }\n    return this;\n  }\n\n  /**\n  * @callback module:path.PathEachSegCallback\n  * @this module:path.Segment\n  * @param {Integer} i The index of the seg being iterated\n  * @returns {boolean} Will stop execution of `eachSeg` if returns `false`\n  */\n  /**\n  * @param {module:path.PathEachSegCallback} fn\n  * @returns {undefined}\n  */\n  eachSeg (fn) {\n    const len = this.segs.length;\n    for (let i = 0; i < len; i++) {\n      const ret = fn.call(this.segs[i], i);\n      if (ret === false) { break; }\n    }\n  }\n\n  /**\n  * @param {Integer} index\n  * @returns {undefined}\n  */\n  addSeg (index) {\n    // Adds a new segment\n    const seg = this.segs[index];\n    if (!seg.prev) { return; }\n\n    const {prev} = seg;\n    let newseg, newX, newY;\n    switch (seg.item.pathSegType) {\n    case 4: {\n      newX = (seg.item.x + prev.item.x) / 2;\n      newY = (seg.item.y + prev.item.y) / 2;\n      newseg = this.elem.createSVGPathSegLinetoAbs(newX, newY);\n      break;\n    } case 6: { // make it a curved segment to preserve the shape (WRS)\n      // https://en.wikipedia.org/wiki/De_Casteljau%27s_algorithm#Geometric_interpretation\n      const p0x = (prev.item.x + seg.item.x1) / 2;\n      const p1x = (seg.item.x1 + seg.item.x2) / 2;\n      const p2x = (seg.item.x2 + seg.item.x) / 2;\n      const p01x = (p0x + p1x) / 2;\n      const p12x = (p1x + p2x) / 2;\n      newX = (p01x + p12x) / 2;\n      const p0y = (prev.item.y + seg.item.y1) / 2;\n      const p1y = (seg.item.y1 + seg.item.y2) / 2;\n      const p2y = (seg.item.y2 + seg.item.y) / 2;\n      const p01y = (p0y + p1y) / 2;\n      const p12y = (p1y + p2y) / 2;\n      newY = (p01y + p12y) / 2;\n      newseg = this.elem.createSVGPathSegCurvetoCubicAbs(newX, newY, p0x, p0y, p01x, p01y);\n      const pts = [seg.item.x, seg.item.y, p12x, p12y, p2x, p2y];\n      replacePathSeg(seg.type, index, pts);\n      break;\n    }\n    }\n\n    insertItemBefore(this.elem, newseg, index);\n  }\n\n  /**\n  * @param {Integer} index\n  * @returns {undefined}\n  */\n  deleteSeg (index) {\n    const seg = this.segs[index];\n    const list = this.elem.pathSegList;\n\n    seg.show(false);\n    const {next} = seg;\n    if (seg.mate) {\n      // Make the next point be the \"M\" point\n      const pt = [next.item.x, next.item.y];\n      replacePathSeg(2, next.index, pt);\n\n      // Reposition last node\n      replacePathSeg(4, seg.index, pt);\n\n      list.removeItem(seg.mate.index);\n    } else if (!seg.prev) {\n      // First node of open path, make next point the M\n      // const {item} = seg;\n      const pt = [next.item.x, next.item.y];\n      replacePathSeg(2, seg.next.index, pt);\n      list.removeItem(index);\n    } else {\n      list.removeItem(index);\n    }\n  }\n\n  /**\n  * @param {Integer} index\n  * @returns {boolean}\n  */\n  subpathIsClosed (index) {\n    let closed = false;\n    // Check if subpath is already open\n    path.eachSeg(function (i) {\n      if (i <= index) { return true; }\n      if (this.type === 2) {\n        // Found M first, so open\n        return false;\n      }\n      if (this.type === 1) {\n        // Found Z first, so closed\n        closed = true;\n        return false;\n      }\n    });\n\n    return closed;\n  }\n\n  /**\n  * @param {Integer} index\n  * @returns {undefined}\n  */\n  removePtFromSelection (index) {\n    const pos = this.selected_pts.indexOf(index);\n    if (pos === -1) {\n      return;\n    }\n    this.segs[index].select(false);\n    this.selected_pts.splice(pos, 1);\n  }\n\n  /**\n  * @returns {undefined}\n  */\n  clearSelection () {\n    this.eachSeg(function () {\n      // 'this' is the segment here\n      this.select(false);\n    });\n    this.selected_pts = [];\n  }\n\n  /**\n  * @returns {undefined}\n  */\n  storeD () {\n    this.last_d = this.elem.getAttribute('d');\n  }\n\n  /**\n  * @param {Integer} y\n  * @returns {undefined}\n  */\n  show (y) {\n    // Shows this path's segment grips\n    this.eachSeg(function () {\n      // 'this' is the segment here\n      this.show(y);\n    });\n    if (y) {\n      this.selectPt(this.first_seg.index);\n    }\n    return this;\n  }\n\n  /**\n  * Move selected points\n  * @param {Integer} dx\n  * @param {Integer} dy\n  * @returns {undefined}\n  */\n  movePts (dx, dy) {\n    let i = this.selected_pts.length;\n    while (i--) {\n      const seg = this.segs[this.selected_pts[i]];\n      seg.move(dx, dy);\n    }\n  }\n\n  /**\n  * @param {Integer} dx\n  * @param {Integer} dy\n  * @returns {undefined}\n  */\n  moveCtrl (dx, dy) {\n    const seg = this.segs[this.selected_pts[0]];\n    seg.moveCtrl(this.dragctrl, dx, dy);\n    if (linkControlPts) {\n      seg.setLinked(this.dragctrl);\n    }\n  }\n\n  /**\n  * @param {?Integer} newType See {@link https://www.w3.org/TR/SVG/single-page.html#paths-InterfaceSVGPathSeg}\n  * @returns {undefined}\n  */\n  setSegType (newType) {\n    this.storeD();\n    let i = this.selected_pts.length;\n    let text;\n    while (i--) {\n      const selPt = this.selected_pts[i];\n\n      // Selected seg\n      const cur = this.segs[selPt];\n      const {prev} = cur;\n      if (!prev) { continue; }\n\n      if (!newType) { // double-click, so just toggle\n        text = 'Toggle Path Segment Type';\n\n        // Toggle segment to curve/straight line\n        const oldType = cur.type;\n\n        newType = (oldType === 6) ? 4 : 6;\n      }\n\n      newType = Number(newType);\n\n      const curX = cur.item.x;\n      const curY = cur.item.y;\n      const prevX = prev.item.x;\n      const prevY = prev.item.y;\n      let points;\n      switch (newType) {\n      case 6: {\n        if (cur.olditem) {\n          const old = cur.olditem;\n          points = [curX, curY, old.x1, old.y1, old.x2, old.y2];\n        } else {\n          const diffX = curX - prevX;\n          const diffY = curY - prevY;\n          // get control points from straight line segment\n          /*\n          const ct1x = (prevX + (diffY/2));\n          const ct1y = (prevY - (diffX/2));\n          const ct2x = (curX + (diffY/2));\n          const ct2y = (curY - (diffX/2));\n          */\n          // create control points on the line to preserve the shape (WRS)\n          const ct1x = (prevX + (diffX / 3));\n          const ct1y = (prevY + (diffY / 3));\n          const ct2x = (curX - (diffX / 3));\n          const ct2y = (curY - (diffY / 3));\n          points = [curX, curY, ct1x, ct1y, ct2x, ct2y];\n        }\n        break;\n      } case 4: {\n        points = [curX, curY];\n\n        // Store original prevve segment nums\n        cur.olditem = cur.item;\n        break;\n      }\n      }\n\n      cur.setType(newType, points);\n    }\n    path.endChanges(text);\n  }\n\n  /**\n  * @param {Integer} pt\n  * @param {Integer} ctrlNum\n  * @returns {undefined}\n  */\n  selectPt (pt, ctrlNum) {\n    this.clearSelection();\n    if (pt == null) {\n      this.eachSeg(function (i) {\n        // 'this' is the segment here.\n        if (this.prev) {\n          pt = i;\n        }\n      });\n    }\n    this.addPtsToSelection(pt);\n    if (ctrlNum) {\n      this.dragctrl = ctrlNum;\n\n      if (linkControlPts) {\n        this.segs[pt].setLinked(ctrlNum);\n      }\n    }\n  }\n\n  /**\n  * Update position of all points\n  * @returns {Path}\n  */\n  update () {\n    const {elem} = this;\n    if (getRotationAngle(elem)) {\n      this.matrix = getMatrix(elem);\n      this.imatrix = this.matrix.inverse();\n    } else {\n      this.matrix = null;\n      this.imatrix = null;\n    }\n\n    this.eachSeg(function (i) {\n      this.item = elem.pathSegList.getItem(i);\n      this.update();\n    });\n\n    return this;\n  }\n\n  /**\n  * @param {string} text\n  * @returns {undefined}\n  */\n  endChanges (text) {\n    if (isWebkit()) { editorContext_.resetD(this.elem); }\n    const cmd = new ChangeElementCommand(this.elem, {d: this.last_d}, text);\n    editorContext_.endChanges({cmd, elem: this.elem});\n  }\n\n  /**\n  * @param {Integer|Integer[]} indexes\n  * @returns {undefined}\n  */\n  addPtsToSelection (indexes) {\n    if (!Array.isArray(indexes)) { indexes = [indexes]; }\n    for (let i = 0; i < indexes.length; i++) {\n      const index = indexes[i];\n      const seg = this.segs[index];\n      if (seg.ptgrip) {\n        if (!this.selected_pts.includes(index) && index >= 0) {\n          this.selected_pts.push(index);\n        }\n      }\n    }\n    this.selected_pts.sort();\n    let i = this.selected_pts.length;\n    const grips = [];\n    grips.length = i;\n    // Loop through points to be selected and highlight each\n    while (i--) {\n      const pt = this.selected_pts[i];\n      const seg = this.segs[pt];\n      seg.select(true);\n      grips[i] = seg.ptgrip;\n    }\n\n    const closedSubpath = this.subpathIsClosed(this.selected_pts[0]);\n    editorContext_.addPtsToSelection({grips, closedSubpath});\n  }\n}\n\n/**\n* @function module:path.getPath_\n* @param {SVGPathElement} elem\n* @returns {module:path.Path}\n*/\nexport const getPath_ = function (elem) {\n  let p = pathData[elem.id];\n  if (!p) {\n    p = pathData[elem.id] = new Path(elem);\n  }\n  return p;\n};\n\n/**\n* @function module:path.removePath_\n* @param {string} id\n* @returns {undefined}\n*/\nexport const removePath_ = function (id) {\n  if (id in pathData) { delete pathData[id]; }\n};\n\nlet newcx, newcy, oldcx, oldcy, angle;\n\nconst getRotVals = function (x, y) {\n  let dx = x - oldcx;\n  let dy = y - oldcy;\n\n  // rotate the point around the old center\n  let r = Math.sqrt(dx * dx + dy * dy);\n  let theta = Math.atan2(dy, dx) + angle;\n  dx = r * Math.cos(theta) + oldcx;\n  dy = r * Math.sin(theta) + oldcy;\n\n  // dx,dy should now hold the actual coordinates of each\n  // point after being rotated\n\n  // now we want to rotate them around the new center in the reverse direction\n  dx -= newcx;\n  dy -= newcy;\n\n  r = Math.sqrt(dx * dx + dy * dy);\n  theta = Math.atan2(dy, dx) - angle;\n\n  return {x: r * Math.cos(theta) + newcx,\n    y: r * Math.sin(theta) + newcy};\n};\n\n// If the path was rotated, we must now pay the piper:\n// Every path point must be rotated into the rotated coordinate system of\n// its old center, then determine the new center, then rotate it back\n// This is because we want the path to remember its rotation\n\n/**\n* @function module:path.recalcRotatedPath\n* @todo This is still using ye olde transform methods, can probably\n* be optimized or even taken care of by `recalculateDimensions`\n* @returns {undefined}\n*/\nexport const recalcRotatedPath = function () {\n  const currentPath = path.elem;\n  angle = getRotationAngle(currentPath, true);\n  if (!angle) { return; }\n  // selectedBBoxes[0] = path.oldbbox;\n  const oldbox = path.oldbbox; // selectedBBoxes[0],\n  oldcx = oldbox.x + oldbox.width / 2;\n  oldcy = oldbox.y + oldbox.height / 2;\n  let box = getBBox(currentPath);\n  newcx = box.x + box.width / 2;\n  newcy = box.y + box.height / 2;\n\n  // un-rotate the new center to the proper position\n  const dx = newcx - oldcx,\n    dy = newcy - oldcy,\n    r = Math.sqrt(dx * dx + dy * dy),\n    theta = Math.atan2(dy, dx) + angle;\n\n  newcx = r * Math.cos(theta) + oldcx;\n  newcy = r * Math.sin(theta) + oldcy;\n\n  const list = currentPath.pathSegList;\n\n  let i = list.numberOfItems;\n  while (i) {\n    i -= 1;\n    const seg = list.getItem(i),\n      type = seg.pathSegType;\n    if (type === 1) { continue; }\n\n    const rvals = getRotVals(seg.x, seg.y),\n      points = [rvals.x, rvals.y];\n    if (seg.x1 != null && seg.x2 != null) {\n      const cVals1 = getRotVals(seg.x1, seg.y1);\n      const cVals2 = getRotVals(seg.x2, seg.y2);\n      points.splice(points.length, 0, cVals1.x, cVals1.y, cVals2.x, cVals2.y);\n    }\n    replacePathSeg(type, i, points);\n  } // loop for each point\n\n  box = getBBox(currentPath);\n  // selectedBBoxes[0].x = box.x; selectedBBoxes[0].y = box.y;\n  // selectedBBoxes[0].width = box.width; selectedBBoxes[0].height = box.height;\n\n  // now we must set the new transform to be rotated around the new center\n  const Rnc = editorContext_.getSVGRoot().createSVGTransform(),\n    tlist = getTransformList(currentPath);\n  Rnc.setRotate((angle * 180.0 / Math.PI), newcx, newcy);\n  tlist.replaceItem(Rnc, 0);\n};\n\n// ====================================\n// Public API starts here\n\n/**\n* @function module:path.clearData\n* @returns {undefined}\n*/\nexport const clearData = function () {\n  pathData = {};\n};\n\n// Making public for mocking\n/**\n* @function module:path.reorientGrads\n* @param {Element} elem\n* @param {SVGMatrix} m\n* @returns {undefined}\n*/\nexport const reorientGrads = function (elem, m) {\n  const bb = utilsGetBBox(elem);\n  for (let i = 0; i < 2; i++) {\n    const type = i === 0 ? 'fill' : 'stroke';\n    const attrVal = elem.getAttribute(type);\n    if (attrVal && attrVal.startsWith('url(')) {\n      const grad = getRefElem(attrVal);\n      if (grad.tagName === 'linearGradient') {\n        let x1 = grad.getAttribute('x1') || 0;\n        let y1 = grad.getAttribute('y1') || 0;\n        let x2 = grad.getAttribute('x2') || 1;\n        let y2 = grad.getAttribute('y2') || 0;\n\n        // Convert to USOU points\n        x1 = (bb.width * x1) + bb.x;\n        y1 = (bb.height * y1) + bb.y;\n        x2 = (bb.width * x2) + bb.x;\n        y2 = (bb.height * y2) + bb.y;\n\n        // Transform those points\n        const pt1 = transformPoint(x1, y1, m);\n        const pt2 = transformPoint(x2, y2, m);\n\n        // Convert back to BB points\n        const gCoords = {};\n\n        gCoords.x1 = (pt1.x - bb.x) / bb.width;\n        gCoords.y1 = (pt1.y - bb.y) / bb.height;\n        gCoords.x2 = (pt2.x - bb.x) / bb.width;\n        gCoords.y2 = (pt2.y - bb.y) / bb.height;\n\n        const newgrad = grad.cloneNode(true);\n        $(newgrad).attr(gCoords);\n\n        newgrad.id = editorContext_.getNextId();\n        findDefs().append(newgrad);\n        elem.setAttribute(type, 'url(#' + newgrad.id + ')');\n      }\n    }\n  }\n};\n\n/**\n* This is how we map paths to our preferred relative segment types\n* @name module:path.pathMap\n* @type {GenericArray}\n*/\nconst pathMap = [0, 'z', 'M', 'm', 'L', 'l', 'C', 'c', 'Q', 'q', 'A', 'a',\n  'H', 'h', 'V', 'v', 'S', 's', 'T', 't'];\n\n/**\n * Convert a path to one with only absolute or relative values\n * @todo move to pathActions.js\n * @function module:path.convertPath\n * @param {SVGPathElement} path - the path to convert\n * @param {boolean} toRel - true of convert to relative\n * @returns {string}\n */\nexport const convertPath = function (path, toRel) {\n  const segList = path.pathSegList;\n  const len = segList.numberOfItems;\n  let curx = 0, cury = 0;\n  let d = '';\n  let lastM = null;\n\n  for (let i = 0; i < len; ++i) {\n    const seg = segList.getItem(i);\n    // if these properties are not in the segment, set them to zero\n    let x = seg.x || 0,\n      y = seg.y || 0,\n      x1 = seg.x1 || 0,\n      y1 = seg.y1 || 0,\n      x2 = seg.x2 || 0,\n      y2 = seg.y2 || 0;\n\n    const type = seg.pathSegType;\n    let letter = pathMap[type]['to' + (toRel ? 'Lower' : 'Upper') + 'Case']();\n\n    switch (type) {\n    case 1: // z,Z closepath (Z/z)\n      d += 'z';\n      if (lastM && !toRel) {\n        curx = lastM[0];\n        cury = lastM[1];\n      }\n      break;\n    case 12: // absolute horizontal line (H)\n      x -= curx;\n      // Fallthrough\n    case 13: // relative horizontal line (h)\n      if (toRel) {\n        curx += x;\n        letter = 'l';\n      } else {\n        x += curx;\n        curx = x;\n        letter = 'L';\n      }\n      // Convert to \"line\" for easier editing\n      d += pathDSegment(letter, [[x, cury]]);\n      break;\n    case 14: // absolute vertical line (V)\n      y -= cury;\n      // Fallthrough\n    case 15: // relative vertical line (v)\n      if (toRel) {\n        cury += y;\n        letter = 'l';\n      } else {\n        y += cury;\n        cury = y;\n        letter = 'L';\n      }\n      // Convert to \"line\" for easier editing\n      d += pathDSegment(letter, [[curx, y]]);\n      break;\n    case 2: // absolute move (M)\n    case 4: // absolute line (L)\n    case 18: // absolute smooth quad (T)\n      x -= curx;\n      y -= cury;\n      // Fallthrough\n    case 5: // relative line (l)\n    case 3: // relative move (m)\n    case 19: // relative smooth quad (t)\n      if (toRel) {\n        curx += x;\n        cury += y;\n      } else {\n        x += curx;\n        y += cury;\n        curx = x;\n        cury = y;\n      }\n      if (type === 2 || type === 3) { lastM = [curx, cury]; }\n\n      d += pathDSegment(letter, [[x, y]]);\n      break;\n    case 6: // absolute cubic (C)\n      x -= curx; x1 -= curx; x2 -= curx;\n      y -= cury; y1 -= cury; y2 -= cury;\n      // Fallthrough\n    case 7: // relative cubic (c)\n      if (toRel) {\n        curx += x;\n        cury += y;\n      } else {\n        x += curx; x1 += curx; x2 += curx;\n        y += cury; y1 += cury; y2 += cury;\n        curx = x;\n        cury = y;\n      }\n      d += pathDSegment(letter, [[x1, y1], [x2, y2], [x, y]]);\n      break;\n    case 8: // absolute quad (Q)\n      x -= curx; x1 -= curx;\n      y -= cury; y1 -= cury;\n      // Fallthrough\n    case 9: // relative quad (q)\n      if (toRel) {\n        curx += x;\n        cury += y;\n      } else {\n        x += curx; x1 += curx;\n        y += cury; y1 += cury;\n        curx = x;\n        cury = y;\n      }\n      d += pathDSegment(letter, [[x1, y1], [x, y]]);\n      break;\n    case 10: // absolute elliptical arc (A)\n      x -= curx;\n      y -= cury;\n      // Fallthrough\n    case 11: // relative elliptical arc (a)\n      if (toRel) {\n        curx += x;\n        cury += y;\n      } else {\n        x += curx;\n        y += cury;\n        curx = x;\n        cury = y;\n      }\n      d += pathDSegment(letter, [[seg.r1, seg.r2]], [\n        seg.angle,\n        (seg.largeArcFlag ? 1 : 0),\n        (seg.sweepFlag ? 1 : 0)\n      ], [x, y]);\n      break;\n    case 16: // absolute smooth cubic (S)\n      x -= curx; x2 -= curx;\n      y -= cury; y2 -= cury;\n      // Fallthrough\n    case 17: // relative smooth cubic (s)\n      if (toRel) {\n        curx += x;\n        cury += y;\n      } else {\n        x += curx; x2 += curx;\n        y += cury; y2 += cury;\n        curx = x;\n        cury = y;\n      }\n      d += pathDSegment(letter, [[x2, y2], [x, y]]);\n      break;\n    } // switch on path segment type\n  } // for each segment\n  return d;\n};\n\n/**\n * TODO: refactor callers in convertPath to use getPathDFromSegments instead of this function.\n * Legacy code refactored from svgcanvas.pathActions.convertPath\n * @param {string} letter - path segment command (letter in potentially either case from {@link module:path.pathMap}; see [SVGPathSeg#pathSegTypeAsLetter]{@link https://www.w3.org/TR/SVG/single-page.html#paths-__svg__SVGPathSeg__pathSegTypeAsLetter})\n * @param {Integer[][]} points - x,y points\n * @param {Integer[][]} [morePoints] - x,y points\n * @param {Integer[]} [lastPoint] - x,y point\n * @returns {string}\n */\nfunction pathDSegment (letter, points, morePoints, lastPoint) {\n  $.each(points, function (i, pnt) {\n    points[i] = shortFloat(pnt);\n  });\n  let segment = letter + points.join(' ');\n  if (morePoints) {\n    segment += ' ' + morePoints.join(' ');\n  }\n  if (lastPoint) {\n    segment += ' ' + shortFloat(lastPoint);\n  }\n  return segment;\n}\n\n/**\n* Group: Path edit functions\n* Functions relating to editing path elements\n* @namespace {PlainObject} pathActions\n* @memberof module:path\n*/\nexport const pathActions = (function () {\n  let subpath = false;\n  let newPoint, firstCtrl;\n\n  let currentPath = null;\n  let hasMoved = false;\n  // No `editorContext_` yet but should be ok as is `null` by default\n  // editorContext_.setDrawnPath(null);\n\n  /**\n  * This function converts a polyline (created by the fh_path tool) into\n  * a path element and coverts every three line segments into a single bezier\n  * curve in an attempt to smooth out the free-hand\n  * @function smoothPolylineIntoPath\n  * @param {Element} element\n  * @returns {Element}\n  */\n  const smoothPolylineIntoPath = function (element) {\n    let i;\n    const {points} = element;\n    const N = points.numberOfItems;\n    if (N >= 4) {\n      // loop through every 3 points and convert to a cubic bezier curve segment\n      //\n      // NOTE: this is cheating, it means that every 3 points has the potential to\n      // be a corner instead of treating each point in an equal manner. In general,\n      // this technique does not look that good.\n      //\n      // I am open to better ideas!\n      //\n      // Reading:\n      // - http://www.efg2.com/Lab/Graphics/Jean-YvesQueinecBezierCurves.htm\n      // - https://www.codeproject.com/KB/graphics/BezierSpline.aspx?msg=2956963\n      // - https://www.ian-ko.com/ET_GeoWizards/UserGuide/smooth.htm\n      // - https://www.cs.mtu.edu/~shene/COURSES/cs3621/NOTES/spline/Bezier/bezier-der.html\n      let curpos = points.getItem(0), prevCtlPt = null;\n      let d = [];\n      d.push(['M', curpos.x, ',', curpos.y, ' C'].join(''));\n      for (i = 1; i <= (N - 4); i += 3) {\n        let ct1 = points.getItem(i);\n        const ct2 = points.getItem(i + 1);\n        const end = points.getItem(i + 2);\n\n        // if the previous segment had a control point, we want to smooth out\n        // the control points on both sides\n        if (prevCtlPt) {\n          const newpts = smoothControlPoints(prevCtlPt, ct1, curpos);\n          if (newpts && newpts.length === 2) {\n            const prevArr = d[d.length - 1].split(',');\n            prevArr[2] = newpts[0].x;\n            prevArr[3] = newpts[0].y;\n            d[d.length - 1] = prevArr.join(',');\n            ct1 = newpts[1];\n          }\n        }\n\n        d.push([ct1.x, ct1.y, ct2.x, ct2.y, end.x, end.y].join(','));\n\n        curpos = end;\n        prevCtlPt = ct2;\n      }\n      // handle remaining line segments\n      d.push('L');\n      while (i < N) {\n        const pt = points.getItem(i);\n        d.push([pt.x, pt.y].join(','));\n        i++;\n      }\n      d = d.join(' ');\n\n      // create new path element\n      element = editorContext_.addSVGElementFromJson({\n        element: 'path',\n        curStyles: true,\n        attr: {\n          id: editorContext_.getId(),\n          d,\n          fill: 'none'\n        }\n      });\n      // No need to call \"changed\", as this is already done under mouseUp\n    }\n    return element;\n  };\n\n  return (/** @lends module:path.pathActions */ {\n    /**\n    * @param {MouseEvent} evt\n    * @param {Element} mouseTarget\n    * @param {Float} startX\n    * @param {Float} startY\n    * @returns {undefined}\n    */\n    mouseDown (evt, mouseTarget, startX, startY) {\n      let id;\n      if (editorContext_.getCurrentMode() === 'path') {\n        let mouseX = startX; // Was this meant to work with the other `mouseX`? (was defined globally so adding `let` to at least avoid a global)\n        let mouseY = startY; // Was this meant to work with the other `mouseY`? (was defined globally so adding `let` to at least avoid a global)\n\n        const currentZoom = editorContext_.getCurrentZoom();\n        let x = mouseX / currentZoom,\n          y = mouseY / currentZoom,\n          stretchy = getElem('path_stretch_line');\n        newPoint = [x, y];\n\n        if (editorContext_.getGridSnapping()) {\n          x = snapToGrid(x);\n          y = snapToGrid(y);\n          mouseX = snapToGrid(mouseX);\n          mouseY = snapToGrid(mouseY);\n        }\n\n        if (!stretchy) {\n          stretchy = document.createElementNS(NS.SVG, 'path');\n          assignAttributes(stretchy, {\n            id: 'path_stretch_line',\n            stroke: '#22C',\n            'stroke-width': '0.5',\n            fill: 'none'\n          });\n          stretchy = getElem('selectorParentGroup').appendChild(stretchy);\n        }\n        stretchy.setAttribute('display', 'inline');\n\n        let keep = null;\n        let index;\n        // if pts array is empty, create path element with M at current point\n        let drawnPath = editorContext_.getDrawnPath();\n        if (!drawnPath) {\n          const dAttr = 'M' + x + ',' + y + ' '; // Was this meant to work with the other `dAttr`? (was defined globally so adding `var` to at least avoid a global)\n          drawnPath = editorContext_.setDrawnPath(editorContext_.addSVGElementFromJson({\n            element: 'path',\n            curStyles: true,\n            attr: {\n              d: dAttr,\n              id: editorContext_.getNextId(),\n              opacity: editorContext_.getOpacity() / 2\n            }\n          }));\n          // set stretchy line to first point\n          stretchy.setAttribute('d', ['M', mouseX, mouseY, mouseX, mouseY].join(' '));\n          index = subpath ? path.segs.length : 0;\n          addPointGrip(index, mouseX, mouseY);\n        } else {\n          // determine if we clicked on an existing point\n          const seglist = drawnPath.pathSegList;\n          let i = seglist.numberOfItems;\n          const FUZZ = 6 / currentZoom;\n          let clickOnPoint = false;\n          while (i) {\n            i--;\n            const item = seglist.getItem(i);\n            const px = item.x, py = item.y;\n            // found a matching point\n            if (x >= (px - FUZZ) && x <= (px + FUZZ) &&\n              y >= (py - FUZZ) && y <= (py + FUZZ)\n            ) {\n              clickOnPoint = true;\n              break;\n            }\n          }\n\n          // get path element that we are in the process of creating\n          id = editorContext_.getId();\n\n          // Remove previous path object if previously created\n          removePath_(id);\n\n          const newpath = getElem(id);\n          let newseg;\n          let sSeg;\n          const len = seglist.numberOfItems;\n          // if we clicked on an existing point, then we are done this path, commit it\n          // (i, i+1) are the x,y that were clicked on\n          if (clickOnPoint) {\n            // if clicked on any other point but the first OR\n            // the first point was clicked on and there are less than 3 points\n            // then leave the path open\n            // otherwise, close the path\n            if (i <= 1 && len >= 2) {\n              // Create end segment\n              const absX = seglist.getItem(0).x;\n              const absY = seglist.getItem(0).y;\n\n              sSeg = stretchy.pathSegList.getItem(1);\n              if (sSeg.pathSegType === 4) {\n                newseg = drawnPath.createSVGPathSegLinetoAbs(absX, absY);\n              } else {\n                newseg = drawnPath.createSVGPathSegCurvetoCubicAbs(\n                  absX,\n                  absY,\n                  sSeg.x1 / currentZoom,\n                  sSeg.y1 / currentZoom,\n                  absX,\n                  absY\n                );\n              }\n\n              const endseg = drawnPath.createSVGPathSegClosePath();\n              seglist.appendItem(newseg);\n              seglist.appendItem(endseg);\n            } else if (len < 3) {\n              keep = false;\n              return keep;\n            }\n            $(stretchy).remove();\n\n            // This will signal to commit the path\n            // const element = newpath; // Other event handlers define own `element`, so this was probably not meant to interact with them or one which shares state (as there were none); I therefore adding a missing `var` to avoid a global\n            drawnPath = editorContext_.setDrawnPath(null);\n            editorContext_.setStarted(false);\n\n            if (subpath) {\n              if (path.matrix) {\n                editorContext_.remapElement(newpath, {}, path.matrix.inverse());\n              }\n\n              const newD = newpath.getAttribute('d');\n              const origD = $(path.elem).attr('d');\n              $(path.elem).attr('d', origD + newD);\n              $(newpath).remove();\n              if (path.matrix) {\n                recalcRotatedPath();\n              }\n              init();\n              pathActions.toEditMode(path.elem);\n              path.selectPt();\n              return false;\n            }\n          // else, create a new point, update path element\n          } else {\n            // Checks if current target or parents are #svgcontent\n            if (!$.contains(\n              editorContext_.getContainer(),\n              editorContext_.getMouseTarget(evt)\n            )) {\n              // Clicked outside canvas, so don't make point\n              console.log('Clicked outside canvas');\n              return false;\n            }\n\n            const num = drawnPath.pathSegList.numberOfItems;\n            const last = drawnPath.pathSegList.getItem(num - 1);\n            const lastx = last.x, lasty = last.y;\n\n            if (evt.shiftKey) {\n              const xya = snapToAngle(lastx, lasty, x, y);\n              ({x, y} = xya);\n            }\n\n            // Use the segment defined by stretchy\n            sSeg = stretchy.pathSegList.getItem(1);\n            if (sSeg.pathSegType === 4) {\n              newseg = drawnPath.createSVGPathSegLinetoAbs(\n                editorContext_.round(x),\n                editorContext_.round(y)\n              );\n            } else {\n              newseg = drawnPath.createSVGPathSegCurvetoCubicAbs(\n                editorContext_.round(x),\n                editorContext_.round(y),\n                sSeg.x1 / currentZoom,\n                sSeg.y1 / currentZoom,\n                sSeg.x2 / currentZoom,\n                sSeg.y2 / currentZoom\n              );\n            }\n\n            drawnPath.pathSegList.appendItem(newseg);\n\n            x *= currentZoom;\n            y *= currentZoom;\n\n            // set stretchy line to latest point\n            stretchy.setAttribute('d', ['M', x, y, x, y].join(' '));\n            index = num;\n            if (subpath) { index += path.segs.length; }\n            addPointGrip(index, x, y);\n          }\n          // keep = true;\n        }\n\n        return;\n      }\n\n      // TODO: Make sure currentPath isn't null at this point\n      if (!path) { return; }\n\n      path.storeD();\n\n      ({id} = evt.target);\n      let curPt;\n      if (id.substr(0, 14) === 'pathpointgrip_') {\n        // Select this point\n        curPt = path.cur_pt = parseInt(id.substr(14), 10);\n        path.dragging = [startX, startY];\n        const seg = path.segs[curPt];\n\n        // only clear selection if shift is not pressed (otherwise, add\n        // node to selection)\n        if (!evt.shiftKey) {\n          if (path.selected_pts.length <= 1 || !seg.selected) {\n            path.clearSelection();\n          }\n          path.addPtsToSelection(curPt);\n        } else if (seg.selected) {\n          path.removePtFromSelection(curPt);\n        } else {\n          path.addPtsToSelection(curPt);\n        }\n      } else if (id.startsWith('ctrlpointgrip_')) {\n        path.dragging = [startX, startY];\n\n        const parts = id.split('_')[1].split('c');\n        curPt = Number(parts[0]);\n        const ctrlNum = Number(parts[1]);\n        path.selectPt(curPt, ctrlNum);\n      }\n\n      // Start selection box\n      if (!path.dragging) {\n        let rubberBox = editorContext_.getRubberBox();\n        if (rubberBox == null) {\n          rubberBox = editorContext_.setRubberBox(\n            editorContext_.selectorManager.getRubberBandBox()\n          );\n        }\n        const currentZoom = editorContext_.getCurrentZoom();\n        assignAttributes(rubberBox, {\n          x: startX * currentZoom,\n          y: startY * currentZoom,\n          width: 0,\n          height: 0,\n          display: 'inline'\n        }, 100);\n      }\n    },\n    /**\n    * @param {Float} mouseX\n    * @param {Float} mouseY\n    * @returns {undefined}\n    */\n    mouseMove (mouseX, mouseY) {\n      const currentZoom = editorContext_.getCurrentZoom();\n      hasMoved = true;\n      const drawnPath = editorContext_.getDrawnPath();\n      if (editorContext_.getCurrentMode() === 'path') {\n        if (!drawnPath) { return; }\n        const seglist = drawnPath.pathSegList;\n        const index = seglist.numberOfItems - 1;\n\n        if (newPoint) {\n          // First point\n          // if (!index) { return; }\n\n          // Set control points\n          const pointGrip1 = addCtrlGrip('1c1');\n          const pointGrip2 = addCtrlGrip('0c2');\n\n          // dragging pointGrip1\n          pointGrip1.setAttribute('cx', mouseX);\n          pointGrip1.setAttribute('cy', mouseY);\n          pointGrip1.setAttribute('display', 'inline');\n\n          const ptX = newPoint[0];\n          const ptY = newPoint[1];\n\n          // set curve\n          // const seg = seglist.getItem(index);\n          const curX = mouseX / currentZoom;\n          const curY = mouseY / currentZoom;\n          const altX = (ptX + (ptX - curX));\n          const altY = (ptY + (ptY - curY));\n\n          pointGrip2.setAttribute('cx', altX * currentZoom);\n          pointGrip2.setAttribute('cy', altY * currentZoom);\n          pointGrip2.setAttribute('display', 'inline');\n\n          const ctrlLine = getCtrlLine(1);\n          assignAttributes(ctrlLine, {\n            x1: mouseX,\n            y1: mouseY,\n            x2: altX * currentZoom,\n            y2: altY * currentZoom,\n            display: 'inline'\n          });\n\n          if (index === 0) {\n            firstCtrl = [mouseX, mouseY];\n          } else {\n            const last = seglist.getItem(index - 1);\n            let lastX = last.x;\n            let lastY = last.y;\n\n            if (last.pathSegType === 6) {\n              lastX += (lastX - last.x2);\n              lastY += (lastY - last.y2);\n            } else if (firstCtrl) {\n              lastX = firstCtrl[0] / currentZoom;\n              lastY = firstCtrl[1] / currentZoom;\n            }\n            replacePathSeg(6, index, [ptX, ptY, lastX, lastY, altX, altY], drawnPath);\n          }\n        } else {\n          const stretchy = getElem('path_stretch_line');\n          if (stretchy) {\n            const prev = seglist.getItem(index);\n            if (prev.pathSegType === 6) {\n              const prevX = prev.x + (prev.x - prev.x2);\n              const prevY = prev.y + (prev.y - prev.y2);\n              replacePathSeg(6, 1, [mouseX, mouseY, prevX * currentZoom, prevY * currentZoom, mouseX, mouseY], stretchy);\n            } else if (firstCtrl) {\n              replacePathSeg(6, 1, [mouseX, mouseY, firstCtrl[0], firstCtrl[1], mouseX, mouseY], stretchy);\n            } else {\n              replacePathSeg(4, 1, [mouseX, mouseY], stretchy);\n            }\n          }\n        }\n        return;\n      }\n      // if we are dragging a point, let's move it\n      if (path.dragging) {\n        const pt = getPointFromGrip({\n          x: path.dragging[0],\n          y: path.dragging[1]\n        }, path);\n        const mpt = getPointFromGrip({\n          x: mouseX,\n          y: mouseY\n        }, path);\n        const diffX = mpt.x - pt.x;\n        const diffY = mpt.y - pt.y;\n        path.dragging = [mouseX, mouseY];\n\n        if (path.dragctrl) {\n          path.moveCtrl(diffX, diffY);\n        } else {\n          path.movePts(diffX, diffY);\n        }\n      } else {\n        path.selected_pts = [];\n        path.eachSeg(function (i) {\n          const seg = this;\n          if (!seg.next && !seg.prev) { return; }\n\n          // const {item} = seg;\n          const rubberBox = editorContext_.getRubberBox();\n          const rbb = rubberBox.getBBox();\n\n          const pt = getGripPt(seg);\n          const ptBb = {\n            x: pt.x,\n            y: pt.y,\n            width: 0,\n            height: 0\n          };\n\n          const sel = rectsIntersect(rbb, ptBb);\n\n          this.select(sel);\n          // Note that addPtsToSelection is not being run\n          if (sel) { path.selected_pts.push(seg.index); }\n        });\n      }\n    },\n    /**\n    * @param {Event} evt\n    * @param {Element} element\n    * @param {Float} mouseX\n    * @param {Float} mouseY\n    * @returns {undefined}\n    */\n    mouseUp (evt, element, mouseX, mouseY) {\n      const drawnPath = editorContext_.getDrawnPath();\n      // Create mode\n      if (editorContext_.getCurrentMode() === 'path') {\n        newPoint = null;\n        if (!drawnPath) {\n          element = getElem(editorContext_.getId());\n          editorContext_.setStarted(false);\n          firstCtrl = null;\n        }\n\n        return {\n          keep: true,\n          element\n        };\n      }\n\n      // Edit mode\n      const rubberBox = editorContext_.getRubberBox();\n      if (path.dragging) {\n        const lastPt = path.cur_pt;\n\n        path.dragging = false;\n        path.dragctrl = false;\n        path.update();\n\n        if (hasMoved) {\n          path.endChanges('Move path point(s)');\n        }\n\n        if (!evt.shiftKey && !hasMoved) {\n          path.selectPt(lastPt);\n        }\n      } else if (rubberBox && rubberBox.getAttribute('display') !== 'none') {\n        // Done with multi-node-select\n        rubberBox.setAttribute('display', 'none');\n\n        if (rubberBox.getAttribute('width') <= 2 && rubberBox.getAttribute('height') <= 2) {\n          pathActions.toSelectMode(evt.target);\n        }\n\n      // else, move back to select mode\n      } else {\n        pathActions.toSelectMode(evt.target);\n      }\n      hasMoved = false;\n    },\n    /**\n    * @param {Element} element\n    * @returns {undefined}\n    */\n    toEditMode (element) {\n      path = getPath_(element);\n      editorContext_.setCurrentMode('pathedit');\n      editorContext_.clearSelection();\n      path.show(true).update();\n      path.oldbbox = utilsGetBBox(path.elem);\n      subpath = false;\n    },\n    /**\n    * @param {Element} element\n    * @fires module:svgcanvas.SvgCanvas#event:selected\n    * @returns {undefined}\n    */\n    toSelectMode (elem) {\n      const selPath = (elem === path.elem);\n      editorContext_.setCurrentMode('select');\n      path.show(false);\n      currentPath = false;\n      editorContext_.clearSelection();\n\n      if (path.matrix) {\n        // Rotated, so may need to re-calculate the center\n        recalcRotatedPath();\n      }\n\n      if (selPath) {\n        editorContext_.call('selected', [elem]);\n        editorContext_.addToSelection([elem], true);\n      }\n    },\n    /**\n    * @param {boolean} on\n    * @returns {undefined}\n    */\n    addSubPath (on) {\n      if (on) {\n        // Internally we go into \"path\" mode, but in the UI it will\n        // still appear as if in \"pathedit\" mode.\n        editorContext_.setCurrentMode('path');\n        subpath = true;\n      } else {\n        pathActions.clear(true);\n        pathActions.toEditMode(path.elem);\n      }\n    },\n    /**\n    * @param {Element} target\n    * @returns {undefined}\n    */\n    select (target) {\n      if (currentPath === target) {\n        pathActions.toEditMode(target);\n        editorContext_.setCurrentMode('pathedit');\n      // going into pathedit mode\n      } else {\n        currentPath = target;\n      }\n    },\n    /**\n    * @fires module:svgcanvas.SvgCanvas#event:changed\n    * @returns {undefined}\n    */\n    reorient () {\n      const elem = editorContext_.getSelectedElements()[0];\n      if (!elem) { return; }\n      const angle = getRotationAngle(elem);\n      if (angle === 0) { return; }\n\n      const batchCmd = new BatchCommand('Reorient path');\n      const changes = {\n        d: elem.getAttribute('d'),\n        transform: elem.getAttribute('transform')\n      };\n      batchCmd.addSubCommand(new ChangeElementCommand(elem, changes));\n      editorContext_.clearSelection();\n      this.resetOrientation(elem);\n\n      editorContext_.addCommandToHistory(batchCmd);\n\n      // Set matrix to null\n      getPath_(elem).show(false).matrix = null;\n\n      this.clear();\n\n      editorContext_.addToSelection([elem], true);\n      editorContext_.call('changed', editorContext_.getSelectedElements());\n    },\n\n    /**\n    * @param {boolean} remove Not in use\n    * @returns {undefined}\n    */\n    clear (remove) {\n      const drawnPath = editorContext_.getDrawnPath();\n      currentPath = null;\n      if (drawnPath) {\n        const elem = getElem(editorContext_.getId());\n        $(getElem('path_stretch_line')).remove();\n        $(elem).remove();\n        $(getElem('pathpointgrip_container')).find('*').attr('display', 'none');\n        firstCtrl = null;\n        editorContext_.setDrawnPath(null);\n        editorContext_.setStarted(false);\n      } else if (editorContext_.getCurrentMode() === 'pathedit') {\n        this.toSelectMode();\n      }\n      if (path) { path.init().show(false); }\n    },\n    /**\n    * @param {?(Element|SVGPathElement)} pth\n    * @returns {false|undefined}\n    */\n    resetOrientation (pth) {\n      if (pth == null || pth.nodeName !== 'path') { return false; }\n      const tlist = getTransformList(pth);\n      const m = transformListToTransform(tlist).matrix;\n      tlist.clear();\n      pth.removeAttribute('transform');\n      const segList = pth.pathSegList;\n\n      // Opera/win/non-EN throws an error here.\n      // TODO: Find out why!\n      // Presumed fixed in Opera 10.5, so commented out for now\n\n      // try {\n      const len = segList.numberOfItems;\n      // } catch(err) {\n      //   const fixed_d = pathActions.convertPath(pth);\n      //   pth.setAttribute('d', fixed_d);\n      //   segList = pth.pathSegList;\n      //   const len = segList.numberOfItems;\n      // }\n      // let lastX, lastY;\n      for (let i = 0; i < len; ++i) {\n        const seg = segList.getItem(i);\n        const type = seg.pathSegType;\n        if (type === 1) { continue; }\n        const pts = [];\n        $.each(['', 1, 2], function (j, n) {\n          const x = seg['x' + n], y = seg['y' + n];\n          if (x !== undefined && y !== undefined) {\n            const pt = transformPoint(x, y, m);\n            pts.splice(pts.length, 0, pt.x, pt.y);\n          }\n        });\n        replacePathSeg(type, i, pts, pth);\n      }\n\n      reorientGrads(pth, m);\n    },\n    /**\n    * @returns {undefined}\n    */\n    zoomChange () {\n      if (editorContext_.getCurrentMode() === 'pathedit') {\n        path.update();\n      }\n    },\n    /**\n    * @typedef {PlainObject} module:path.NodePoint\n    * @property {Float} x\n    * @property {Float} y\n    * @property {Integer} type\n    */\n    /**\n    * @returns {module:path.NodePoint}\n    */\n    getNodePoint () {\n      const selPt = path.selected_pts.length ? path.selected_pts[0] : 1;\n\n      const seg = path.segs[selPt];\n      return {\n        x: seg.item.x,\n        y: seg.item.y,\n        type: seg.type\n      };\n    },\n    /**\n    * @param {boolean} linkPoints\n    * @returns {undefined}\n    */\n    linkControlPoints (linkPoints) {\n      setLinkControlPoints(linkPoints);\n    },\n    /**\n    * @returns {undefined}\n    */\n    clonePathNode () {\n      path.storeD();\n\n      const selPts = path.selected_pts;\n      // const {segs} = path;\n\n      let i = selPts.length;\n      const nums = [];\n\n      while (i--) {\n        const pt = selPts[i];\n        path.addSeg(pt);\n\n        nums.push(pt + i);\n        nums.push(pt + i + 1);\n      }\n      path.init().addPtsToSelection(nums);\n\n      path.endChanges('Clone path node(s)');\n    },\n    /**\n    * @returns {undefined}\n    */\n    opencloseSubPath () {\n      const selPts = path.selected_pts;\n      // Only allow one selected node for now\n      if (selPts.length !== 1) { return; }\n\n      const {elem} = path;\n      const list = elem.pathSegList;\n\n      // const len = list.numberOfItems;\n\n      const index = selPts[0];\n\n      let openPt = null;\n      let startItem = null;\n\n      // Check if subpath is already open\n      path.eachSeg(function (i) {\n        if (this.type === 2 && i <= index) {\n          startItem = this.item;\n        }\n        if (i <= index) { return true; }\n        if (this.type === 2) {\n          // Found M first, so open\n          openPt = i;\n          return false;\n        }\n        if (this.type === 1) {\n          // Found Z first, so closed\n          openPt = false;\n          return false;\n        }\n      });\n\n      if (openPt == null) {\n        // Single path, so close last seg\n        openPt = path.segs.length - 1;\n      }\n\n      if (openPt !== false) {\n        // Close this path\n\n        // Create a line going to the previous \"M\"\n        const newseg = elem.createSVGPathSegLinetoAbs(startItem.x, startItem.y);\n\n        const closer = elem.createSVGPathSegClosePath();\n        if (openPt === path.segs.length - 1) {\n          list.appendItem(newseg);\n          list.appendItem(closer);\n        } else {\n          insertItemBefore(elem, closer, openPt);\n          insertItemBefore(elem, newseg, openPt);\n        }\n\n        path.init().selectPt(openPt + 1);\n        return;\n      }\n\n      // M 1,1 L 2,2 L 3,3 L 1,1 z // open at 2,2\n      // M 2,2 L 3,3 L 1,1\n\n      // M 1,1 L 2,2 L 1,1 z M 4,4 L 5,5 L6,6 L 5,5 z\n      // M 1,1 L 2,2 L 1,1 z [M 4,4] L 5,5 L(M)6,6 L 5,5 z\n\n      const seg = path.segs[index];\n\n      if (seg.mate) {\n        list.removeItem(index); // Removes last \"L\"\n        list.removeItem(index); // Removes the \"Z\"\n        path.init().selectPt(index - 1);\n        return;\n      }\n\n      let lastM, zSeg;\n\n      // Find this sub-path's closing point and remove\n      for (let i = 0; i < list.numberOfItems; i++) {\n        const item = list.getItem(i);\n\n        if (item.pathSegType === 2) {\n          // Find the preceding M\n          lastM = i;\n        } else if (i === index) {\n          // Remove it\n          list.removeItem(lastM);\n          // index--;\n        } else if (item.pathSegType === 1 && index < i) {\n          // Remove the closing seg of this subpath\n          zSeg = i - 1;\n          list.removeItem(i);\n          break;\n        }\n      }\n\n      let num = (index - lastM) - 1;\n\n      while (num--) {\n        insertItemBefore(elem, list.getItem(lastM), zSeg);\n      }\n\n      const pt = list.getItem(lastM);\n\n      // Make this point the new \"M\"\n      replacePathSeg(2, lastM, [pt.x, pt.y]);\n\n      // i = index; // i is local here, so has no effect; what was the intent for this?\n\n      path.init().selectPt(0);\n    },\n    /**\n    * @returns {undefined}\n    */\n    deletePathNode () {\n      if (!pathActions.canDeleteNodes) { return; }\n      path.storeD();\n\n      const selPts = path.selected_pts;\n\n      let i = selPts.length;\n      while (i--) {\n        const pt = selPts[i];\n        path.deleteSeg(pt);\n      }\n\n      // Cleanup\n      const cleanup = function () {\n        const segList = path.elem.pathSegList;\n        let len = segList.numberOfItems;\n\n        const remItems = function (pos, count) {\n          while (count--) {\n            segList.removeItem(pos);\n          }\n        };\n\n        if (len <= 1) { return true; }\n\n        while (len--) {\n          const item = segList.getItem(len);\n          if (item.pathSegType === 1) {\n            const prev = segList.getItem(len - 1);\n            const nprev = segList.getItem(len - 2);\n            if (prev.pathSegType === 2) {\n              remItems(len - 1, 2);\n              cleanup();\n              break;\n            } else if (nprev.pathSegType === 2) {\n              remItems(len - 2, 3);\n              cleanup();\n              break;\n            }\n          } else if (item.pathSegType === 2) {\n            if (len > 0) {\n              const prevType = segList.getItem(len - 1).pathSegType;\n              // Path has M M\n              if (prevType === 2) {\n                remItems(len - 1, 1);\n                cleanup();\n                break;\n              // Entire path ends with Z M\n              } else if (prevType === 1 && segList.numberOfItems - 1 === len) {\n                remItems(len, 1);\n                cleanup();\n                break;\n              }\n            }\n          }\n        }\n        return false;\n      };\n\n      cleanup();\n\n      // Completely delete a path with 1 or 0 segments\n      if (path.elem.pathSegList.numberOfItems <= 1) {\n        pathActions.toSelectMode(path.elem);\n        editorContext_.canvas.deleteSelectedElements();\n        return;\n      }\n\n      path.init();\n      path.clearSelection();\n\n      // TODO: Find right way to select point now\n      // path.selectPt(selPt);\n      if (window.opera) { // Opera repaints incorrectly\n        const cp = $(path.elem);\n        cp.attr('d', cp.attr('d'));\n      }\n      path.endChanges('Delete path node(s)');\n    },\n    // Can't seem to use `@borrows` here, so using `@see`\n    /**\n    * Smooth polyline into path\n    * @function module:path.pathActions.smoothPolylineIntoPath\n    * @see module:path~smoothPolylineIntoPath\n    */\n    smoothPolylineIntoPath,\n    /**\n    * @returns {undefined}\n    */\n    setSegType (v) {\n      path.setSegType(v);\n    },\n    /**\n    * @param {string} attr\n    * @param {Float} newValue\n    * @returns {undefined}\n    */\n    moveNode (attr, newValue) {\n      const selPts = path.selected_pts;\n      if (!selPts.length) { return; }\n\n      path.storeD();\n\n      // Get first selected point\n      const seg = path.segs[selPts[0]];\n      const diff = {x: 0, y: 0};\n      diff[attr] = newValue - seg.item[attr];\n\n      seg.move(diff.x, diff.y);\n      path.endChanges('Move path point');\n    },\n    /**\n    * @param {Element} elem\n    * @returns {undefined}\n    */\n    fixEnd (elem) {\n      // Adds an extra segment if the last seg before a Z doesn't end\n      // at its M point\n      // M0,0 L0,100 L100,100 z\n      const segList = elem.pathSegList;\n      const len = segList.numberOfItems;\n      let lastM;\n      for (let i = 0; i < len; ++i) {\n        const item = segList.getItem(i);\n        if (item.pathSegType === 2) {\n          lastM = item;\n        }\n\n        if (item.pathSegType === 1) {\n          const prev = segList.getItem(i - 1);\n          if (prev.x !== lastM.x || prev.y !== lastM.y) {\n            // Add an L segment here\n            const newseg = elem.createSVGPathSegLinetoAbs(lastM.x, lastM.y);\n            insertItemBefore(elem, newseg, i);\n            // Can this be done better?\n            pathActions.fixEnd(elem);\n            break;\n          }\n        }\n      }\n      if (isWebkit()) { editorContext_.resetD(elem); }\n    },\n    // Can't seem to use `@borrows` here, so using `@see`\n    /**\n    * Convert a path to one with only absolute or relative values\n    * @function module:path.pathActions.convertPath\n    * @see module:path.convertPath\n    */\n    convertPath\n  });\n})();\n// end pathActions\n","/* globals jQuery */\n/**\n * Miscellaneous utilities\n * @module utilities\n * @license MIT\n *\n * @copyright 2010 Alexis Deveria, 2010 Jeff Schiller\n */\n\nimport './svgpathseg.js';\nimport jqPluginSVG from './jQuery.attr.js'; // Needed for SVG attribute setting and array form with `attr`\nimport {NS} from './namespaces.js';\nimport {getTransformList} from './svgtransformlist.js';\nimport {setUnitAttr, getTypeMap} from './units.js';\nimport {convertPath} from './path.js';\nimport {\n  hasMatrixTransform, transformListToTransform, transformBox\n} from './math.js';\nimport {\n  isWebkit, supportsHVLineContainerBBox, supportsPathBBox, supportsXpath,\n  supportsSelectors\n} from './browser.js';\n\n// Constants\nconst $ = jqPluginSVG(jQuery);\n\n// String used to encode base64.\nconst KEYSTR = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n\n// Much faster than running getBBox() every time\nconst visElems = 'a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use';\nconst visElemsArr = visElems.split(',');\n// const hidElems = 'clipPath,defs,desc,feGaussianBlur,filter,linearGradient,marker,mask,metadata,pattern,radialGradient,stop,switch,symbol,title,textPath';\n\nlet editorContext_ = null;\nlet domdoc_ = null;\nlet domcontainer_ = null;\nlet svgroot_ = null;\n\n/**\n* Object with the following keys/values\n* @typedef {PlainObject} module:utilities.SVGElementJSON\n* @property {string} element - Tag name of the SVG element to create\n* @property {PlainObject.<string, string>} attr - Has key-value attributes to assign to the new element\n* @property {boolean} [curStyles=false] - Indicates whether current style attributes should be applied first\n* @property {module:utilities.SVGElementJSON[]} [children] - Data objects to be added recursively as children\n* @property {string} [namespace=\"http://www.w3.org/2000/svg\"] - Indicate a (non-SVG) namespace\n*/\n\n/**\n * An object that creates SVG elements for the canvas.\n *\n * @interface module:utilities.EditorContext\n * @property {module:path.pathActions} pathActions\n */\n/**\n * @function module:utilities.EditorContext#getSVGContent\n * @returns {SVGSVGElement}\n */\n/**\n * Create a new SVG element based on the given object keys/values and add it\n * to the current layer.\n * The element will be run through `cleanupElement` before being returned\n * @function module:utilities.EditorContext#addSVGElementFromJson\n * @param {module:utilities.SVGElementJSON} data\n * @returns {Element} The new element\n*/\n/**\n * @function module:utilities.EditorContext#getSelectedElements\n * @returns {Element[]} the array with selected DOM elements\n*/\n/**\n * @function module:utilities.EditorContext#getDOMDocument\n * @returns {HTMLDocument}\n*/\n/**\n * @function module:utilities.EditorContext#getDOMContainer\n * @returns {HTMLElement}\n*/\n/**\n * @function module:utilities.EditorContext#getSVGRoot\n * @returns {SVGSVGElement}\n*/\n/**\n * @function module:utilities.EditorContext#getBaseUnit\n * @returns {string}\n*/\n/**\n * @function module:utilities.EditorContext#getSnappingStep\n * @returns {Float|string}\n*/\n\n/**\n* @function module:utilities.init\n* @param {module:utilities.EditorContext} editorContext\n* @returns {undefined}\n*/\nexport const init = function (editorContext) {\n  editorContext_ = editorContext;\n  domdoc_ = editorContext.getDOMDocument();\n  domcontainer_ = editorContext.getDOMContainer();\n  svgroot_ = editorContext.getSVGRoot();\n};\n\n/**\n* Converts characters in a string to XML-friendly entities.\n* @function module:utilities.toXml\n* @example `&` becomes `&amp;`\n* @param {string} str - The string to be converted\n* @returns {string} The converted string\n*/\nexport const toXml = function (str) {\n  // &apos; is ok in XML, but not HTML\n  // &gt; does not normally need escaping, though it can if within a CDATA expression (and preceded by \"]]\")\n  return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/\"/g, '&quot;').replace(/'/, '&#x27;');\n};\n\n/**\n* Converts XML entities in a string to single characters.\n* @function module:utilities.fromXml\n* @example `&amp;` becomes `&`\n* @param {string} str - The string to be converted\n* @returns {string} The converted string\n*/\nexport const fromXml = function (str) {\n  return $('<p/>').html(str).text();\n};\n\n// This code was written by Tyler Akins and has been placed in the\n// public domain.  It would be nice if you left this header intact.\n// Base64 code from Tyler Akins -- http://rumkin.com\n\n// schiller: Removed string concatenation in favour of Array.join() optimization,\n//        also precalculate the size of the array needed.\n\n/**\n* Converts a string to base64\n* @function module:utilities.encode64\n* @param {string} input\n* @returns {string} Base64 output\n*/\nexport const encode64 = function (input) {\n  // base64 strings are 4/3 larger than the original string\n  input = encodeUTF8(input); // convert non-ASCII characters\n  // input = convertToXMLReferences(input);\n  if (window.btoa) {\n    return window.btoa(input); // Use native if available\n  }\n  const output = [];\n  output.length = Math.floor((input.length + 2) / 3) * 4;\n\n  let i = 0, p = 0;\n  do {\n    const chr1 = input.charCodeAt(i++);\n    const chr2 = input.charCodeAt(i++);\n    const chr3 = input.charCodeAt(i++);\n\n    const enc1 = chr1 >> 2;\n    const enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\n\n    let enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\n    let enc4 = chr3 & 63;\n\n    if (isNaN(chr2)) {\n      enc3 = enc4 = 64;\n    } else if (isNaN(chr3)) {\n      enc4 = 64;\n    }\n\n    output[p++] = KEYSTR.charAt(enc1);\n    output[p++] = KEYSTR.charAt(enc2);\n    output[p++] = KEYSTR.charAt(enc3);\n    output[p++] = KEYSTR.charAt(enc4);\n  } while (i < input.length);\n\n  return output.join('');\n};\n\n/**\n* Converts a string from base64\n* @function module:utilities.decode64\n* @param {string} input Base64-encoded input\n* @returns {string} Decoded output\n*/\nexport const decode64 = function (input) {\n  if (window.atob) {\n    return decodeUTF8(window.atob(input));\n  }\n\n  // remove all characters that are not A-Z, a-z, 0-9, +, /, or =\n  input = input.replace(/[^A-Za-z0-9+/=]/g, '');\n\n  let output = '';\n  let i = 0;\n\n  do {\n    const enc1 = KEYSTR.indexOf(input.charAt(i++));\n    const enc2 = KEYSTR.indexOf(input.charAt(i++));\n    const enc3 = KEYSTR.indexOf(input.charAt(i++));\n    const enc4 = KEYSTR.indexOf(input.charAt(i++));\n\n    const chr1 = (enc1 << 2) | (enc2 >> 4);\n    const chr2 = ((enc2 & 15) << 4) | (enc3 >> 2);\n    const chr3 = ((enc3 & 3) << 6) | enc4;\n\n    output += String.fromCharCode(chr1);\n\n    if (enc3 !== 64) {\n      output = output + String.fromCharCode(chr2);\n    }\n    if (enc4 !== 64) {\n      output = output + String.fromCharCode(chr3);\n    }\n  } while (i < input.length);\n  return decodeUTF8(output);\n};\n\n/**\n* @function module:utilities.decodeUTF8\n* @param {string} argString\n* @returns {string}\n*/\nexport const decodeUTF8 = function (argString) {\n  return decodeURIComponent(escape(argString));\n};\n\n// codedread:does not seem to work with webkit-based browsers on OSX // Brettz9: please test again as function upgraded\n/**\n* @function module:utilities.encodeUTF8\n* @param {string} argString\n* @returns {string}\n*/\nexport const encodeUTF8 = function (argString) {\n  return unescape(encodeURIComponent(argString));\n};\n\n/**\n * convert dataURL to object URL\n * @function module:utilities.dataURLToObjectURL\n * @param {string} dataurl\n * @returns {string} object URL or empty string\n */\nexport const dataURLToObjectURL = function (dataurl) {\n  if (typeof Uint8Array === 'undefined' || typeof Blob === 'undefined' || typeof URL === 'undefined' || !URL.createObjectURL) {\n    return '';\n  }\n  const arr = dataurl.split(','), mime = arr[0].match(/:(.*?);/)[1],\n    bstr = atob(arr[1]);\n  let n = bstr.length;\n  const u8arr = new Uint8Array(n);\n  while (n--) {\n    u8arr[n] = bstr.charCodeAt(n);\n  }\n  const blob = new Blob([u8arr], {type: mime});\n  return URL.createObjectURL(blob);\n};\n\n/**\n * get object URL for a blob object\n * @function module:utilities.createObjectURL\n * @param {Blob} blob A Blob object or File object\n * @returns {string} object URL or empty string\n */\nexport const createObjectURL = function (blob) {\n  if (!blob || typeof URL === 'undefined' || !URL.createObjectURL) {\n    return '';\n  }\n  return URL.createObjectURL(blob);\n};\n\n/**\n * @property {string} blankPageObjectURL\n */\nexport const blankPageObjectURL = (function () {\n  if (typeof Blob === 'undefined') {\n    return '';\n  }\n  const blob = new Blob(['<html><head><title>SVG-edit</title></head><body>&nbsp;</body></html>'], {type: 'text/html'});\n  return createObjectURL(blob);\n})();\n\n/**\n* Converts a string to use XML references (for non-ASCII)\n* @function module:utilities.convertToXMLReferences\n* @param {string} input\n* @returns {string} Decimal numeric character references\n*/\nexport const convertToXMLReferences = function (input) {\n  let output = '';\n  [...input].forEach((ch) => {\n    const c = ch.charCodeAt();\n    if (c <= 127) {\n      output += ch;\n    } else {\n      output += `&#${c};`;\n    }\n  });\n  return output;\n};\n\n/**\n* Cross-browser compatible method of converting a string to an XML tree\n* found this function [here]{@link http://groups.google.com/group/jquery-dev/browse_thread/thread/c6d11387c580a77f}\n* @function module:utilities.text2xml\n* @param {string} sXML\n* @throws {Error}\n* @returns {XMLDocument}\n*/\nexport const text2xml = function (sXML) {\n  if (sXML.includes('<svg:svg')) {\n    sXML = sXML.replace(/<(\\/?)svg:/g, '<$1').replace('xmlns:svg', 'xmlns');\n  }\n\n  let out, dXML;\n  try {\n    dXML = (window.DOMParser) ? new DOMParser() : new window.ActiveXObject('Microsoft.XMLDOM');\n    dXML.async = false;\n  } catch (e) {\n    throw new Error('XML Parser could not be instantiated');\n  }\n  try {\n    if (dXML.loadXML) {\n      out = (dXML.loadXML(sXML)) ? dXML : false;\n    } else {\n      out = dXML.parseFromString(sXML, 'text/xml');\n    }\n  } catch (e2) { throw new Error('Error parsing XML string'); }\n  return out;\n};\n\n/**\n* @typedef {PlainObject} module:utilities.BBoxObject (like `DOMRect`)\n* @property {Float} x\n* @property {Float} y\n* @property {Float} width\n* @property {Float} height\n*/\n\n/**\n* Converts a `SVGRect` into an object.\n* @function module:utilities.bboxToObj\n* @param {SVGRect} bbox - a SVGRect\n* @returns {module:utilities.BBoxObject} An object with properties names x, y, width, height.\n*/\nexport const bboxToObj = function ({x, y, width, height}) {\n  return {x, y, width, height};\n};\n\n/**\n* @callback module:utilities.TreeWalker\n* @param {Element} elem - DOM element being traversed\n* @returns {undefined}\n*/\n\n/**\n* Walks the tree and executes the callback on each element in a top-down fashion\n* @function module:utilities.walkTree\n* @param {Element} elem - DOM element to traverse\n* @param {module:utilities.TreeWalker} cbFn - Callback function to run on each element\n* @returns {undefined}\n*/\nexport const walkTree = function (elem, cbFn) {\n  if (elem && elem.nodeType === 1) {\n    cbFn(elem);\n    let i = elem.childNodes.length;\n    while (i--) {\n      walkTree(elem.childNodes.item(i), cbFn);\n    }\n  }\n};\n\n/**\n* Walks the tree and executes the callback on each element in a depth-first fashion\n* @function module:utilities.walkTreePost\n* @todo FIXME: Shouldn't this be calling walkTreePost?\n* @param {Element} elem - DOM element to traverse\n* @param {module:utilities.TreeWalker} cbFn - Callback function to run on each element\n* @returns {undefined}\n*/\nexport const walkTreePost = function (elem, cbFn) {\n  if (elem && elem.nodeType === 1) {\n    let i = elem.childNodes.length;\n    while (i--) {\n      walkTree(elem.childNodes.item(i), cbFn);\n    }\n    cbFn(elem);\n  }\n};\n\n/**\n* Extracts the URL from the `url(...)` syntax of some attributes.\n* Three variants:\n*  - `<circle fill=\"url(someFile.svg#foo)\" />`\n*  - `<circle fill=\"url('someFile.svg#foo')\" />`\n*  - `<circle fill='url(\"someFile.svg#foo\")' />`\n* @function module:utilities.getUrlFromAttr\n* @param {string} attrVal The attribute value as a string\n* @returns {string} String with just the URL, like \"someFile.svg#foo\"\n*/\nexport const getUrlFromAttr = function (attrVal) {\n  if (attrVal) {\n    // url('#somegrad')\n    if (attrVal.startsWith('url(\"')) {\n      return attrVal.substring(5, attrVal.indexOf('\"', 6));\n    }\n    // url('#somegrad')\n    if (attrVal.startsWith(\"url('\")) {\n      return attrVal.substring(5, attrVal.indexOf(\"'\", 6));\n    }\n    if (attrVal.startsWith('url(')) {\n      return attrVal.substring(4, attrVal.indexOf(')'));\n    }\n  }\n  return null;\n};\n\n/**\n* @function module:utilities.getHref\n* @param {Element} elem\n* @returns {string} The given element's `xlink:href` value\n*/\nexport let getHref = function (elem) {\n  return elem.getAttributeNS(NS.XLINK, 'href');\n};\n\n/**\n* Sets the given element's `xlink:href` value\n* @function module:utilities.setHref\n* @param {Element} elem\n* @param {string} val\n* @returns {undefined}\n*/\nexport let setHref = function (elem, val) {\n  elem.setAttributeNS(NS.XLINK, 'xlink:href', val);\n};\n\n/**\n* @function module:utilities.findDefs\n* @returns {SVGDefsElement} The document's `<defs>` element, creating it first if necessary\n*/\nexport const findDefs = function () {\n  const svgElement = editorContext_.getSVGContent();\n  let defs = svgElement.getElementsByTagNameNS(NS.SVG, 'defs');\n  if (defs.length > 0) {\n    defs = defs[0];\n  } else {\n    defs = svgElement.ownerDocument.createElementNS(NS.SVG, 'defs');\n    if (svgElement.firstChild) {\n      // first child is a comment, so call nextSibling\n      svgElement.insertBefore(defs, svgElement.firstChild.nextSibling);\n      // svgElement.firstChild.nextSibling.before(defs); // Not safe\n    } else {\n      svgElement.append(defs);\n    }\n  }\n  return defs;\n};\n\n// TODO(codedread): Consider moving the next to functions to bbox.js\n\n/**\n* Get correct BBox for a path in Webkit.\n* Converted from code found [here]{@link http://blog.hackers-cafe.net/2009/06/how-to-calculate-bezier-curves-bounding.html}\n* @function module:utilities.getPathBBox\n* @param {SVGPathElement} path - The path DOM element to get the BBox for\n* @returns {module:utilities.BBoxObject} A BBox-like object\n*/\nexport const getPathBBox = function (path) {\n  const seglist = path.pathSegList;\n  const tot = seglist.numberOfItems;\n\n  const bounds = [[], []];\n  const start = seglist.getItem(0);\n  let P0 = [start.x, start.y];\n\n  for (let i = 0; i < tot; i++) {\n    const seg = seglist.getItem(i);\n\n    if (seg.x === undefined) { continue; }\n\n    // Add actual points to limits\n    bounds[0].push(P0[0]);\n    bounds[1].push(P0[1]);\n\n    if (seg.x1) {\n      const P1 = [seg.x1, seg.y1],\n        P2 = [seg.x2, seg.y2],\n        P3 = [seg.x, seg.y];\n\n      for (let j = 0; j < 2; j++) {\n        const calc = function (t) {\n          return Math.pow(1 - t, 3) * P0[j] +\n            3 * Math.pow(1 - t, 2) * t * P1[j] +\n            3 * (1 - t) * Math.pow(t, 2) * P2[j] +\n            Math.pow(t, 3) * P3[j];\n        };\n\n        const b = 6 * P0[j] - 12 * P1[j] + 6 * P2[j];\n        const a = -3 * P0[j] + 9 * P1[j] - 9 * P2[j] + 3 * P3[j];\n        const c = 3 * P1[j] - 3 * P0[j];\n\n        if (a === 0) {\n          if (b === 0) {\n            continue;\n          }\n          const t = -c / b;\n          if (t > 0 && t < 1) {\n            bounds[j].push(calc(t));\n          }\n          continue;\n        }\n        const b2ac = Math.pow(b, 2) - 4 * c * a;\n        if (b2ac < 0) { continue; }\n        const t1 = (-b + Math.sqrt(b2ac)) / (2 * a);\n        if (t1 > 0 && t1 < 1) { bounds[j].push(calc(t1)); }\n        const t2 = (-b - Math.sqrt(b2ac)) / (2 * a);\n        if (t2 > 0 && t2 < 1) { bounds[j].push(calc(t2)); }\n      }\n      P0 = P3;\n    } else {\n      bounds[0].push(seg.x);\n      bounds[1].push(seg.y);\n    }\n  }\n\n  const x = Math.min.apply(null, bounds[0]);\n  const w = Math.max.apply(null, bounds[0]) - x;\n  const y = Math.min.apply(null, bounds[1]);\n  const h = Math.max.apply(null, bounds[1]) - y;\n  return {\n    x,\n    y,\n    width: w,\n    height: h\n  };\n};\n\n/**\n* Get the given/selected element's bounding box object, checking for\n* horizontal/vertical lines (see issue 717)\n* Note that performance is currently terrible, so some way to improve would\n* be great.\n* @param {Element} selected - Container or `<use>` DOM element\n* @returns {DOMRect} Bounding box object\n*/\nfunction groupBBFix (selected) {\n  if (supportsHVLineContainerBBox()) {\n    try { return selected.getBBox(); } catch (e) {}\n  }\n  const ref = $.data(selected, 'ref');\n  let matched = null;\n  let ret, copy;\n\n  if (ref) {\n    copy = $(ref).children().clone().attr('visibility', 'hidden');\n    $(svgroot_).append(copy);\n    matched = copy.filter('line, path');\n  } else {\n    matched = $(selected).find('line, path');\n  }\n\n  let issue = false;\n  if (matched.length) {\n    matched.each(function () {\n      const bb = this.getBBox();\n      if (!bb.width || !bb.height) {\n        issue = true;\n      }\n    });\n    if (issue) {\n      const elems = ref ? copy : $(selected).children();\n      ret = getStrokedBBox(elems);\n    } else {\n      ret = selected.getBBox();\n    }\n  } else {\n    ret = selected.getBBox();\n  }\n  if (ref) {\n    copy.remove();\n  }\n  return ret;\n}\n\n/**\n* Get the given/selected element's bounding box object, convert it to be more\n* usable when necessary\n* @function module:utilities.getBBox\n* @param {Element} elem - Optional DOM element to get the BBox for\n* @returns {module:utilities.BBoxObject} Bounding box object\n*/\nexport const getBBox = function (elem) {\n  const selected = elem || editorContext_.geSelectedElements()[0];\n  if (elem.nodeType !== 1) { return null; }\n  const elname = selected.nodeName;\n\n  let ret = null;\n  switch (elname) {\n  case 'text':\n    if (selected.textContent === '') {\n      selected.textContent = 'a'; // Some character needed for the selector to use.\n      ret = selected.getBBox();\n      selected.textContent = '';\n    } else {\n      if (selected.getBBox) { ret = selected.getBBox(); }\n    }\n    break;\n  case 'path':\n    if (!supportsPathBBox()) {\n      ret = getPathBBox(selected);\n    } else {\n      if (selected.getBBox) { ret = selected.getBBox(); }\n    }\n    break;\n  case 'g':\n  case 'a':\n    ret = groupBBFix(selected);\n    break;\n  default:\n\n    if (elname === 'use') {\n      ret = groupBBFix(selected, true);\n    }\n    if (elname === 'use' || (elname === 'foreignObject' && isWebkit())) {\n      if (!ret) { ret = selected.getBBox(); }\n      // This is resolved in later versions of webkit, perhaps we should\n      // have a featured detection for correct 'use' behavior?\n      // ——————————\n      if (!isWebkit()) {\n        const bb = {};\n        bb.width = ret.width;\n        bb.height = ret.height;\n        bb.x = ret.x + parseFloat(selected.getAttribute('x') || 0);\n        bb.y = ret.y + parseFloat(selected.getAttribute('y') || 0);\n        ret = bb;\n      }\n    } else if (visElemsArr.includes(elname)) {\n      if (selected) {\n        try {\n          ret = selected.getBBox();\n        } catch (err) {\n          // tspan (and textPath apparently) have no `getBBox` in Firefox: https://bugzilla.mozilla.org/show_bug.cgi?id=937268\n          // Re: Chrome returning bbox for containing text element, see: https://bugs.chromium.org/p/chromium/issues/detail?id=349835\n          const extent = selected.getExtentOfChar(0); // pos+dimensions of the first glyph\n          const width = selected.getComputedTextLength(); // width of the tspan\n          ret = {\n            x: extent.x,\n            y: extent.y,\n            width,\n            height: extent.height\n          };\n        }\n      } else {\n        // Check if element is child of a foreignObject\n        const fo = $(selected).closest('foreignObject');\n        if (fo.length) {\n          if (fo[0].getBBox) {\n            ret = fo[0].getBBox();\n          }\n        }\n      }\n    }\n  }\n  if (ret) {\n    ret = bboxToObj(ret);\n  }\n\n  // get the bounding box from the DOM (which is in that element's coordinate system)\n  return ret;\n};\n\n/**\n* @typedef {GenericArray} module:utilities.PathSegmentArray\n* @property {Integer} length 2\n* @property {\"M\"|\"L\"|\"C\"|\"Z\"} 0\n* @property {Float[]} 1\n*/\n\n/**\n* Create a path 'd' attribute from path segments.\n* Each segment is an array of the form: `[singleChar, [x,y, x,y, ...]]`\n* @function module:utilities.getPathDFromSegments\n* @param {module:utilities.PathSegmentArray[]} pathSegments - An array of path segments to be converted\n* @returns {string} The converted path d attribute.\n*/\nexport const getPathDFromSegments = function (pathSegments) {\n  let d = '';\n\n  $.each(pathSegments, function (j, [singleChar, pts]) {\n    d += singleChar;\n    for (let i = 0; i < pts.length; i += 2) {\n      d += (pts[i] + ',' + pts[i + 1]) + ' ';\n    }\n  });\n\n  return d;\n};\n\n/**\n* Make a path 'd' attribute from a simple SVG element shape.\n* @function module:utilities.getPathDFromElement\n* @param {Element} elem - The element to be converted\n* @returns {string} The path d attribute or `undefined` if the element type is unknown.\n*/\nexport const getPathDFromElement = function (elem) {\n  // Possibly the cubed root of 6, but 1.81 works best\n  let num = 1.81;\n  let d, a, rx, ry;\n  switch (elem.tagName) {\n  case 'ellipse':\n  case 'circle':\n    a = $(elem).attr(['rx', 'ry', 'cx', 'cy']);\n    const {cx, cy} = a;\n    ({rx, ry} = a);\n    if (elem.tagName === 'circle') {\n      rx = ry = $(elem).attr('r');\n    }\n\n    d = getPathDFromSegments([\n      ['M', [(cx - rx), (cy)]],\n      ['C', [(cx - rx), (cy - ry / num), (cx - rx / num), (cy - ry), (cx), (cy - ry)]],\n      ['C', [(cx + rx / num), (cy - ry), (cx + rx), (cy - ry / num), (cx + rx), (cy)]],\n      ['C', [(cx + rx), (cy + ry / num), (cx + rx / num), (cy + ry), (cx), (cy + ry)]],\n      ['C', [(cx - rx / num), (cy + ry), (cx - rx), (cy + ry / num), (cx - rx), (cy)]],\n      ['Z', []]\n    ]);\n    break;\n  case 'path':\n    d = elem.getAttribute('d');\n    break;\n  case 'line':\n    a = $(elem).attr(['x1', 'y1', 'x2', 'y2']);\n    d = 'M' + a.x1 + ',' + a.y1 + 'L' + a.x2 + ',' + a.y2;\n    break;\n  case 'polyline':\n    d = 'M' + elem.getAttribute('points');\n    break;\n  case 'polygon':\n    d = 'M' + elem.getAttribute('points') + ' Z';\n    break;\n  case 'rect':\n    const r = $(elem).attr(['rx', 'ry']);\n    ({rx, ry} = r);\n    const b = elem.getBBox();\n    const {x, y} = b, w = b.width, h = b.height;\n    num = 4 - num; // Why? Because!\n\n    if (!rx && !ry) {\n      // Regular rect\n      d = getPathDFromSegments([\n        ['M', [x, y]],\n        ['L', [x + w, y]],\n        ['L', [x + w, y + h]],\n        ['L', [x, y + h]],\n        ['L', [x, y]],\n        ['Z', []]\n      ]);\n    } else {\n      d = getPathDFromSegments([\n        ['M', [x, y + ry]],\n        ['C', [x, y + ry / num, x + rx / num, y, x + rx, y]],\n        ['L', [x + w - rx, y]],\n        ['C', [x + w - rx / num, y, x + w, y + ry / num, x + w, y + ry]],\n        ['L', [x + w, y + h - ry]],\n        ['C', [x + w, y + h - ry / num, x + w - rx / num, y + h, x + w - rx, y + h]],\n        ['L', [x + rx, y + h]],\n        ['C', [x + rx / num, y + h, x, y + h - ry / num, x, y + h - ry]],\n        ['L', [x, y + ry]],\n        ['Z', []]\n      ]);\n    }\n    break;\n  default:\n    break;\n  }\n\n  return d;\n};\n\n/**\n* Get a set of attributes from an element that is useful for convertToPath.\n* @function module:utilities.getExtraAttributesForConvertToPath\n* @param {Element} elem - The element to be probed\n* @returns {PlainObject.<\"marker-start\"|\"marker-end\"|\"marker-mid\"|\"filter\"|\"clip-path\", string>} An object with attributes.\n*/\nexport const getExtraAttributesForConvertToPath = function (elem) {\n  const attrs = {};\n  // TODO: make this list global so that we can properly maintain it\n  // TODO: what about @transform, @clip-rule, @fill-rule, etc?\n  $.each(['marker-start', 'marker-end', 'marker-mid', 'filter', 'clip-path'], function () {\n    const a = elem.getAttribute(this);\n    if (a) {\n      attrs[this] = a;\n    }\n  });\n  return attrs;\n};\n\n/**\n* Get the BBox of an element-as-path\n* @function module:utilities.getBBoxOfElementAsPath\n* @param {Element} elem - The DOM element to be probed\n* @param {module:utilities.EditorContext#addSVGElementFromJson} addSVGElementFromJson - Function to add the path element to the current layer. See canvas.addSVGElementFromJson\n* @param {module:path.pathActions} pathActions - If a transform exists, `pathActions.resetOrientation()` is used. See: canvas.pathActions.\n* @returns {DOMRect|false} The resulting path's bounding box object.\n*/\nexport const getBBoxOfElementAsPath = function (elem, addSVGElementFromJson, pathActions) {\n  const path = addSVGElementFromJson({\n    element: 'path',\n    attr: getExtraAttributesForConvertToPath(elem)\n  });\n\n  const eltrans = elem.getAttribute('transform');\n  if (eltrans) {\n    path.setAttribute('transform', eltrans);\n  }\n\n  const parent = elem.parentNode;\n  if (elem.nextSibling) {\n    elem.before(path);\n  } else {\n    parent.append(path);\n  }\n\n  const d = getPathDFromElement(elem);\n  if (d) {\n    path.setAttribute('d', d);\n  } else {\n    path.remove();\n  }\n\n  // Get the correct BBox of the new path, then discard it\n  pathActions.resetOrientation(path);\n  let bb = false;\n  try {\n    bb = path.getBBox();\n  } catch (e) {\n    // Firefox fails\n  }\n  path.remove();\n  return bb;\n};\n\n/**\n* Convert selected element to a path.\n* @function module:utilities.convertToPath\n* @param {Element} elem - The DOM element to be converted\n* @param {module:utilities.SVGElementJSON} attrs - Apply attributes to new path. see canvas.convertToPath\n* @param {module:utilities.EditorContext#addSVGElementFromJson} addSVGElementFromJson - Function to add the path element to the current layer. See canvas.addSVGElementFromJson\n* @param {module:path.pathActions} pathActions - If a transform exists, pathActions.resetOrientation() is used. See: canvas.pathActions.\n* @param {module:draw.DrawCanvasInit#clearSelection|module:path.EditorContext#clearSelection} clearSelection - see [canvas.clearSelection]{@link module:svgcanvas.SvgCanvas#clearSelection}\n* @param {module:path.EditorContext#addToSelection} addToSelection - see [canvas.addToSelection]{@link module:svgcanvas.SvgCanvas#addToSelection}\n* @param {module:history} history - see history module\n* @param {module:path.EditorContext#addCommandToHistory|module:draw.DrawCanvasInit#addCommandToHistory} addCommandToHistory - see [canvas.addCommandToHistory]{@link module:svgcanvas~addCommandToHistory}\n* @returns {SVGPathElement|null} The converted path element or null if the DOM element was not recognized.\n*/\nexport const convertToPath = function (elem, attrs, addSVGElementFromJson, pathActions, clearSelection, addToSelection, history, addCommandToHistory) {\n  const batchCmd = new history.BatchCommand('Convert element to Path');\n\n  // Any attribute on the element not covered by the passed-in attributes\n  attrs = $.extend({}, attrs, getExtraAttributesForConvertToPath(elem));\n\n  const path = addSVGElementFromJson({\n    element: 'path',\n    attr: attrs\n  });\n\n  const eltrans = elem.getAttribute('transform');\n  if (eltrans) {\n    path.setAttribute('transform', eltrans);\n  }\n\n  const {id} = elem;\n  const parent = elem.parentNode;\n  if (elem.nextSibling) {\n    elem.before(path);\n  } else {\n    parent.append(path);\n  }\n\n  const d = getPathDFromElement(elem);\n  if (d) {\n    path.setAttribute('d', d);\n\n    // Replace the current element with the converted one\n\n    // Reorient if it has a matrix\n    if (eltrans) {\n      const tlist = getTransformList(path);\n      if (hasMatrixTransform(tlist)) {\n        pathActions.resetOrientation(path);\n      }\n    }\n\n    const {nextSibling} = elem;\n    batchCmd.addSubCommand(new history.RemoveElementCommand(elem, nextSibling, parent));\n    batchCmd.addSubCommand(new history.InsertElementCommand(path));\n\n    clearSelection();\n    elem.remove();\n    path.setAttribute('id', id);\n    path.removeAttribute('visibility');\n    addToSelection([path], true);\n\n    addCommandToHistory(batchCmd);\n\n    return path;\n  }\n  // the elem.tagName was not recognized, so no \"d\" attribute. Remove it, so we've haven't changed anything.\n  path.remove();\n  return null;\n};\n\n/**\n* Can the bbox be optimized over the native getBBox? The optimized bbox is the same as the native getBBox when\n* the rotation angle is a multiple of 90 degrees and there are no complex transforms.\n* Getting an optimized bbox can be dramatically slower, so we want to make sure it's worth it.\n*\n* The best example for this is a circle rotate 45 degrees. The circle doesn't get wider or taller when rotated\n* about it's center.\n*\n* The standard, unoptimized technique gets the native bbox of the circle, rotates the box 45 degrees, uses\n* that width and height, and applies any transforms to get the final bbox. This means the calculated bbox\n* is much wider than the original circle. If the angle had been 0, 90, 180, etc. both techniques render the\n* same bbox.\n*\n* The optimization is not needed if the rotation is a multiple 90 degrees. The default technique is to call\n* getBBox then apply the angle and any transforms.\n*\n* @param {Float} angle - The rotation angle in degrees\n* @param {boolean} hasMatrixTransform - True if there is a matrix transform\n* @returns {boolean} True if the bbox can be optimized.\n*/\nfunction bBoxCanBeOptimizedOverNativeGetBBox (angle, hasMatrixTransform) {\n  const angleModulo90 = angle % 90;\n  const closeTo90 = angleModulo90 < -89.99 || angleModulo90 > 89.99;\n  const closeTo0 = angleModulo90 > -0.001 && angleModulo90 < 0.001;\n  return hasMatrixTransform || !(closeTo0 || closeTo90);\n}\n\n/**\n* Get bounding box that includes any transforms.\n* @function module:utilities.getBBoxWithTransform\n* @param {Element} elem - The DOM element to be converted\n* @param {module:utilities.EditorContext#addSVGElementFromJson} addSVGElementFromJson - Function to add the path element to the current layer. See canvas.addSVGElementFromJson\n* @param {module:path.pathActions} pathActions - If a transform exists, pathActions.resetOrientation() is used. See: canvas.pathActions.\n* @returns {module:utilities.BBoxObject|module:math.TransformedBox|DOMRect} A single bounding box object\n*/\nexport const getBBoxWithTransform = function (elem, addSVGElementFromJson, pathActions) {\n  // TODO: Fix issue with rotated groups. Currently they work\n  // fine in FF, but not in other browsers (same problem mentioned\n  // in Issue 339 comment #2).\n\n  let bb = getBBox(elem);\n\n  if (!bb) {\n    return null;\n  }\n\n  const tlist = getTransformList(elem);\n  const angle = getRotationAngleFromTransformList(tlist);\n  const hasMatrixXForm = hasMatrixTransform(tlist);\n\n  if (angle || hasMatrixXForm) {\n    let goodBb = false;\n    if (bBoxCanBeOptimizedOverNativeGetBBox(angle, hasMatrixXForm)) {\n      // Get the BBox from the raw path for these elements\n      // TODO: why ellipse and not circle\n      const elemNames = ['ellipse', 'path', 'line', 'polyline', 'polygon'];\n      if (elemNames.includes(elem.tagName)) {\n        bb = goodBb = getBBoxOfElementAsPath(elem, addSVGElementFromJson, pathActions);\n      } else if (elem.tagName === 'rect') {\n        // Look for radius\n        const rx = elem.getAttribute('rx');\n        const ry = elem.getAttribute('ry');\n        if (rx || ry) {\n          bb = goodBb = getBBoxOfElementAsPath(elem, addSVGElementFromJson, pathActions);\n        }\n      }\n    }\n\n    if (!goodBb) {\n      const {matrix} = transformListToTransform(tlist);\n      bb = transformBox(bb.x, bb.y, bb.width, bb.height, matrix).aabox;\n\n      // Old technique that was exceedingly slow with large documents.\n      //\n      // Accurate way to get BBox of rotated element in Firefox:\n      // Put element in group and get its BBox\n      //\n      // Must use clone else FF freaks out\n      // const clone = elem.cloneNode(true);\n      // const g = document.createElementNS(NS.SVG, 'g');\n      // const parent = elem.parentNode;\n      // parent.append(g);\n      // g.append(clone);\n      // const bb2 = bboxToObj(g.getBBox());\n      // g.remove();\n    }\n  }\n  return bb;\n};\n\n// TODO: This is problematic with large stroke-width and, for example, a single horizontal line. The calculated BBox extends way beyond left and right sides.\nfunction getStrokeOffsetForBBox (elem) {\n  const sw = elem.getAttribute('stroke-width');\n  return (!isNaN(sw) && elem.getAttribute('stroke') !== 'none') ? sw / 2 : 0;\n}\n\n/**\n * @typedef {PlainObject} BBox\n * @property {Integer} x The x value\n * @property {Integer} y The y value\n * @property {Float} width\n * @property {Float} height\n */\n\n/**\n* Get the bounding box for one or more stroked and/or transformed elements\n* @function module:utilities.getStrokedBBox\n* @param {Element[]} elems - Array with DOM elements to check\n* @param {module:utilities.EditorContext#addSVGElementFromJson} addSVGElementFromJson - Function to add the path element to the current layer. See canvas.addSVGElementFromJson\n* @param {module:path.pathActions} pathActions - If a transform exists, pathActions.resetOrientation() is used. See: canvas.pathActions.\n* @returns {module:utilities.BBoxObject|module:math.TransformedBox|DOMRect} A single bounding box object\n*/\nexport const getStrokedBBox = function (elems, addSVGElementFromJson, pathActions) {\n  if (!elems || !elems.length) { return false; }\n\n  let fullBb;\n  $.each(elems, function () {\n    if (fullBb) { return; }\n    if (!this.parentNode) { return; }\n    fullBb = getBBoxWithTransform(this, addSVGElementFromJson, pathActions);\n  });\n\n  // This shouldn't ever happen...\n  if (fullBb === undefined) { return null; }\n\n  // fullBb doesn't include the stoke, so this does no good!\n  // if (elems.length == 1) return fullBb;\n\n  let maxX = fullBb.x + fullBb.width;\n  let maxY = fullBb.y + fullBb.height;\n  let minX = fullBb.x;\n  let minY = fullBb.y;\n\n  // If only one elem, don't call the potentially slow getBBoxWithTransform method again.\n  if (elems.length === 1) {\n    const offset = getStrokeOffsetForBBox(elems[0]);\n    minX -= offset;\n    minY -= offset;\n    maxX += offset;\n    maxY += offset;\n  } else {\n    $.each(elems, function (i, elem) {\n      const curBb = getBBoxWithTransform(elem, addSVGElementFromJson, pathActions);\n      if (curBb) {\n        const offset = getStrokeOffsetForBBox(elem);\n        minX = Math.min(minX, curBb.x - offset);\n        minY = Math.min(minY, curBb.y - offset);\n        // TODO: The old code had this test for max, but not min. I suspect this test should be for both min and max\n        if (elem.nodeType === 1) {\n          maxX = Math.max(maxX, curBb.x + curBb.width + offset);\n          maxY = Math.max(maxY, curBb.y + curBb.height + offset);\n        }\n      }\n    });\n  }\n\n  fullBb.x = minX;\n  fullBb.y = minY;\n  fullBb.width = maxX - minX;\n  fullBb.height = maxY - minY;\n  return fullBb;\n};\n\n/**\n* Get all elements that have a BBox (excludes `<defs>`, `<title>`, etc).\n* Note that 0-opacity, off-screen etc elements are still considered \"visible\"\n* for this function\n* @function module:utilities.getVisibleElements\n* @param {Element} parent - The parent DOM element to search within\n* @returns {Element[]} All \"visible\" elements.\n*/\nexport const getVisibleElements = function (parent) {\n  if (!parent) {\n    parent = $(editorContext_.getSVGContent()).children(); // Prevent layers from being included\n  }\n\n  const contentElems = [];\n  $(parent).children().each(function (i, elem) {\n    if (elem.getBBox) {\n      contentElems.push(elem);\n    }\n  });\n  return contentElems.reverse();\n};\n\n/**\n* Get the bounding box for one or more stroked and/or transformed elements\n* @function module:utilities.getStrokedBBoxDefaultVisible\n* @param {Element[]} elems - Array with DOM elements to check\n* @returns {module:utilities.BBoxObject} A single bounding box object\n*/\nexport const getStrokedBBoxDefaultVisible = function (elems) {\n  if (!elems) { elems = getVisibleElements(); }\n  return getStrokedBBox(\n    elems,\n    editorContext_.addSVGElementFromJson,\n    editorContext_.pathActions\n  );\n};\n\n/**\n* Get the rotation angle of the given transform list.\n* @function module:utilities.getRotationAngleFromTransformList\n* @param {SVGTransformList} tlist - List of transforms\n* @param {boolean} toRad - When true returns the value in radians rather than degrees\n* @returns {Float} The angle in degrees or radians\n*/\nexport const getRotationAngleFromTransformList = function (tlist, toRad) {\n  if (!tlist) { return 0; } // <svg> elements have no tlist\n  const N = tlist.numberOfItems;\n  for (let i = 0; i < N; ++i) {\n    const xform = tlist.getItem(i);\n    if (xform.type === 4) {\n      return toRad ? xform.angle * Math.PI / 180.0 : xform.angle;\n    }\n  }\n  return 0.0;\n};\n\n/**\n* Get the rotation angle of the given/selected DOM element\n* @function module:utilities.getRotationAngle\n* @param {Element} [elem] - DOM element to get the angle for. Default to first of selected elements.\n* @param {boolean} [toRad=false] - When true returns the value in radians rather than degrees\n* @returns {Float} The angle in degrees or radians\n*/\nexport let getRotationAngle = function (elem, toRad) {\n  const selected = elem || editorContext_.getSelectedElements()[0];\n  // find the rotation transform (if any) and set it\n  const tlist = getTransformList(selected);\n  return getRotationAngleFromTransformList(tlist, toRad);\n};\n\n/**\n* Get the reference element associated with the given attribute value\n* @function module:utilities.getRefElem\n* @param {string} attrVal - The attribute value as a string\n* @returns {Element} Reference element\n*/\nexport const getRefElem = function (attrVal) {\n  return getElem(getUrlFromAttr(attrVal).substr(1));\n};\n\n/**\n* Get a DOM element by ID within the SVG root element.\n* @function module:utilities.getElem\n* @param {string} id - String with the element's new ID\n* @returns {Element}\n*/\nexport const getElem = (supportsSelectors())\n  ? function (id) {\n    // querySelector lookup\n    return svgroot_.querySelector('#' + id);\n  } : supportsXpath()\n    ? function (id) {\n      // xpath lookup\n      return domdoc_.evaluate(\n        'svg:svg[@id=\"svgroot\"]//svg:*[@id=\"' + id + '\"]',\n        domcontainer_,\n        function () { return NS.SVG; },\n        9,\n        null).singleNodeValue;\n    }\n    : function (id) {\n      // jQuery lookup: twice as slow as xpath in FF\n      return $(svgroot_).find('[id=' + id + ']')[0];\n    };\n\n/**\n* Assigns multiple attributes to an element.\n* @function module:utilities.assignAttributes\n* @param {Element} elem - DOM element to apply new attribute values to\n* @param {PlainObject.<string, string>} attrs - Object with attribute keys/values\n* @param {Integer} [suspendLength] - Milliseconds to suspend redraw\n* @param {boolean} [unitCheck=false] - Boolean to indicate the need to use units.setUnitAttr\n* @returns {undefined}\n*/\nexport const assignAttributes = function (elem, attrs, suspendLength, unitCheck) {\n  for (const [key, value] of Object.entries(attrs)) {\n    const ns = (key.substr(0, 4) === 'xml:'\n      ? NS.XML\n      : key.substr(0, 6) === 'xlink:' ? NS.XLINK : null);\n\n    if (ns) {\n      elem.setAttributeNS(ns, key, value);\n    } else if (!unitCheck) {\n      elem.setAttribute(key, value);\n    } else {\n      setUnitAttr(elem, key, value);\n    }\n  }\n};\n\n/**\n* Remove unneeded (default) attributes, makes resulting SVG smaller\n* @function module:utilities.cleanupElement\n* @param {Element} element - DOM element to clean up\n* @returns {undefined}\n*/\nexport const cleanupElement = function (element) {\n  const defaults = {\n    'fill-opacity': 1,\n    'stop-opacity': 1,\n    opacity: 1,\n    stroke: 'none',\n    'stroke-dasharray': 'none',\n    'stroke-linejoin': 'miter',\n    'stroke-linecap': 'butt',\n    'stroke-opacity': 1,\n    'stroke-width': 1,\n    rx: 0,\n    ry: 0\n  };\n\n  if (element.nodeName === 'ellipse') {\n    // Ellipse elements require rx and ry attributes\n    delete defaults.rx;\n    delete defaults.ry;\n  }\n\n  for (const attr in defaults) {\n    const val = defaults[attr];\n    if (element.getAttribute(attr) === String(val)) {\n      element.removeAttribute(attr);\n    }\n  }\n};\n\n/**\n* Round value to for snapping\n* @function module:utilities.snapToGrid\n* @param {Float} value\n* @returns {Integer}\n*/\nexport const snapToGrid = function (value) {\n  const unit = editorContext_.getBaseUnit();\n  let stepSize = editorContext_.getSnappingStep();\n  if (unit !== 'px') {\n    stepSize *= getTypeMap()[unit];\n  }\n  value = Math.round(value / stepSize) * stepSize;\n  return value;\n};\n\n/**\n* Escapes special characters in a regular expression\n* @function module:utilities.regexEscape\n* @param {string} str\n* @returns {string}\n*/\nexport const regexEscape = function (str) {\n  // From: http://phpjs.org/functions\n  return String(str).replace(new RegExp('[.\\\\\\\\+*?\\\\[\\\\^\\\\]$(){}=!<>|:\\\\-]', 'g'), '\\\\$&');\n};\n\n/**\n * Prevents default browser click behaviour on the given element\n * @function module:utilities.preventClickDefault\n * @param {Element} img - The DOM element to prevent the click on\n * @returns {undefined}\n */\nexport const preventClickDefault = function (img) {\n  $(img).click(function (e) { e.preventDefault(); });\n};\n\n/**\n * @callback module:utilities.GetNextID\n * @returns {string} The ID\n */\n/**\n * Create a clone of an element, updating its ID and its children's IDs when needed\n * @function module:utilities.copyElem\n * @param {Element} el - DOM element to clone\n * @param {module:utilities.GetNextID} getNextId - The getter of the next unique ID.\n * @returns {Element} The cloned element\n */\nexport const copyElem = function (el, getNextId) {\n  // manually create a copy of the element\n  const newEl = document.createElementNS(el.namespaceURI, el.nodeName);\n  $.each(el.attributes, function (i, attr) {\n    if (attr.localName !== '-moz-math-font-style') {\n      newEl.setAttributeNS(attr.namespaceURI, attr.nodeName, attr.value);\n    }\n  });\n  // set the copied element's new id\n  newEl.removeAttribute('id');\n  newEl.id = getNextId();\n\n  // Opera's \"d\" value needs to be reset for Opera/Win/non-EN\n  // Also needed for webkit (else does not keep curved segments on clone)\n  if (isWebkit() && el.nodeName === 'path') {\n    const fixedD = convertPath(el);\n    newEl.setAttribute('d', fixedD);\n  }\n\n  // now create copies of all children\n  $.each(el.childNodes, function (i, child) {\n    switch (child.nodeType) {\n    case 1: // element node\n      newEl.append(copyElem(child, getNextId));\n      break;\n    case 3: // text node\n      newEl.textContent = child.nodeValue;\n      break;\n    default:\n      break;\n    }\n  });\n\n  if ($(el).data('gsvg')) {\n    $(newEl).data('gsvg', newEl.firstChild);\n  } else if ($(el).data('symbol')) {\n    const ref = $(el).data('symbol');\n    $(newEl).data('ref', ref).data('symbol', ref);\n  } else if (newEl.tagName === 'image') {\n    preventClickDefault(newEl);\n  }\n\n  return newEl;\n};\n\n/**\n* Unit testing\n* @function module:utilities.mock\n* @returns {undefined}\n*/\nexport const mock = ({\n  getHref: getHrefUser, setHref: setHrefUser, getRotationAngle: getRotationAngleUser\n}) => {\n  getHref = getHrefUser;\n  setHref = setHrefUser;\n  getRotationAngle = getRotationAngleUser;\n};\n","/* globals jQuery */\n/**\n * Adds context menu functionality\n * @module contextmenu\n * @license Apache-2.0\n * @author Adam Bender\n */\n// Dependencies:\n// 1) jQuery (for dom injection of context menus)\n\nconst $ = jQuery;\n\nlet contextMenuExtensions = {};\n\n/**\n * Signature depends on what the user adds; in the case of our uses with\n * SVGEditor, no parameters are passed nor anything expected for a return.\n * @callback module:contextmenu.MenuItemAction\n*/\n\n/**\n* @typedef {PlainObject} module:contextmenu.MenuItem\n* @property {string} id\n* @property {string} label\n* @property {module:contextmenu.MenuItemAction} action\n*/\n\n/**\n* @param {module:contextmenu.MenuItem} menuItem\n* @returns {boolean}\n*/\nconst menuItemIsValid = function (menuItem) {\n  return menuItem && menuItem.id && menuItem.label && menuItem.action && typeof menuItem.action === 'function';\n};\n\n/**\n* @function module:contextmenu.add\n* @param {module:contextmenu.MenuItem} menuItem\n* @returns {undefined}\n*/\nexport const add = function (menuItem) {\n  // menuItem: {id, label, shortcut, action}\n  if (!menuItemIsValid(menuItem)) {\n    console.error('Menu items must be defined and have at least properties: id, label, action, where action must be a function');\n    return;\n  }\n  if (menuItem.id in contextMenuExtensions) {\n    console.error('Cannot add extension \"' + menuItem.id + '\", an extension by that name already exists\"');\n    return;\n  }\n  // Register menuItem action, see below for deferred menu dom injection\n  console.log('Registed contextmenu item: {id:' + menuItem.id + ', label:' + menuItem.label + '}');\n  contextMenuExtensions[menuItem.id] = menuItem;\n  // TODO: Need to consider how to handle custom enable/disable behavior\n};\n\n/**\n* @function module:contextmenu.hasCustomHandler\n* @param {string} handlerKey\n* @returns {boolean}\n*/\nexport const hasCustomHandler = function (handlerKey) {\n  return Boolean(contextMenuExtensions[handlerKey]);\n};\n\n/**\n* @function module:contextmenu.getCustomHandler\n* @param {string} handlerKey\n* @returns {module:contextmenu.MenuItemAction}\n*/\nexport const getCustomHandler = function (handlerKey) {\n  return contextMenuExtensions[handlerKey].action;\n};\n\n/**\n* @param {module:contextmenu.MenuItem} menuItem\n* @returns {undefined}\n*/\nconst injectExtendedContextMenuItemIntoDom = function (menuItem) {\n  if (!Object.keys(contextMenuExtensions).length) {\n    // all menuItems appear at the bottom of the menu in their own container.\n    // if this is the first extension menu we need to add the separator.\n    $('#cmenu_canvas').append(\"<li class='separator'>\");\n  }\n  const shortcut = menuItem.shortcut || '';\n  $('#cmenu_canvas').append(\"<li class='disabled'><a href='#\" + menuItem.id + \"'>\" +\n    menuItem.label + \"<span class='shortcut'>\" +\n    shortcut + '</span></a></li>');\n};\n\n/**\n* @function module:contextmenu.injectExtendedContextMenuItemsIntoDom\n* @returns {undefined}\n*/\nexport const injectExtendedContextMenuItemsIntoDom = function () {\n  for (const menuItem in contextMenuExtensions) {\n    injectExtendedContextMenuItemIntoDom(contextMenuExtensions[menuItem]);\n  }\n};\n/**\n* @function module:contextmenu.resetCustomMenus\n* @returns {undefined}\n*/\nexport const resetCustomMenus = function () { contextMenuExtensions = {}; };\n","// MIT License\n// From: https://github.com/uupaa/dynamic-import-polyfill/blob/master/importModule.js\n\n/**\n * @module importModule\n */\n\nfunction toAbsoluteURL (url) {\n  const a = document.createElement('a');\n  a.setAttribute('href', url); // <a href=\"hoge.html\">\n  return a.cloneNode(false).href; // -> \"http://example.com/hoge.html\"\n}\n\nfunction addScriptAtts (script, atts) {\n  ['id', 'class', 'type'].forEach((prop) => {\n    if (prop in atts) {\n      script[prop] = atts[prop];\n    }\n  });\n}\n\n// Additions by Brett\n/**\n* @typedef {PlainObject} module:importModule.ImportConfig\n* @property {string} global The variable name to set on `window` (when not using the modular version)\n* @property {boolean} [returnDefault=false]\n*/\n/**\n* @function module:importModule.importSetGlobalDefault\n* @param {string} url\n* @param {module:importModule.ImportConfig} config\n* @returns {*} The return depends on the export of the targeted module.\n*/\nexport async function importSetGlobalDefault (url, config) {\n  return importSetGlobal(url, {...config, returnDefault: true});\n}\n/**\n* @function module:importModule.importSetGlobal\n* @param {string} url\n* @param {module:importModule.ImportConfig} config\n* @returns {ArbitraryModule|*} The return depends on the export of the targeted module.\n*/\nexport async function importSetGlobal (url, {global, returnDefault}) {\n  // Todo: Replace calls to this function with `import()` when supported\n  const modularVersion = !('svgEditor' in window) ||\n    !window.svgEditor ||\n    window.svgEditor.modules !== false;\n  if (modularVersion) {\n    return importModule(url, undefined, {returnDefault});\n  }\n  await importScript(url);\n  return window[global];\n}\n// Addition by Brett\nexport function importScript (url, atts = {}) {\n  if (Array.isArray(url)) {\n    return Promise.all(url.map((u) => {\n      return importScript(u, atts);\n    }));\n  }\n  return new Promise((resolve, reject) => {\n    const script = document.createElement('script');\n    const destructor = () => {\n      script.onerror = null;\n      script.onload = null;\n      script.remove();\n      script.src = '';\n    };\n    script.defer = 'defer';\n    addScriptAtts(script, atts);\n    script.onerror = () => {\n      reject(new Error(`Failed to import: ${url}`));\n      destructor();\n    };\n    script.onload = () => {\n      resolve();\n      destructor();\n    };\n    script.src = url;\n\n    document.head.append(script);\n  });\n}\n\nexport function importModule (url, atts = {}, {returnDefault = false} = {}) {\n  if (Array.isArray(url)) {\n    return Promise.all(url.map((u) => {\n      return importModule(u, atts);\n    }));\n  }\n  return new Promise((resolve, reject) => {\n    const vector = '$importModule$' + Math.random().toString(32).slice(2);\n    const script = document.createElement('script');\n    const destructor = () => {\n      delete window[vector];\n      script.onerror = null;\n      script.onload = null;\n      script.remove();\n      URL.revokeObjectURL(script.src);\n      script.src = '';\n    };\n    addScriptAtts(script, atts);\n    script.defer = 'defer';\n    script.type = 'module';\n    script.onerror = () => {\n      reject(new Error(`Failed to import: ${url}`));\n      destructor();\n    };\n    script.onload = () => {\n      resolve(window[vector]);\n      destructor();\n    };\n    const absURL = toAbsoluteURL(url);\n    const loader = `import * as m from '${absURL.replace(/'/g, \"\\\\'\")}'; window.${vector} = ${returnDefault ? 'm.default || ' : ''}m;`; // export Module\n    const blob = new Blob([loader], { type: 'text/javascript' });\n    script.src = URL.createObjectURL(blob);\n\n    document.head.append(script);\n  });\n}\n\nexport default importModule;\n","/* globals jQuery */\n/**\n * Provides tools for the layer concept\n * @module layer\n * @license MIT\n *\n * @copyright 2011 Jeff Schiller, 2016 Flint O'Brien\n */\n\nimport {NS} from './namespaces.js';\nimport {toXml, walkTree} from './utilities.js';\n\nconst $ = jQuery;\n\n/**\n * This class encapsulates the concept of a layer in the drawing. It can be constructed with\n * an existing group element or, with three parameters, will create a new layer group element.\n *\n * @example\n * new Layer('name', group);          // Use the existing group for this layer.\n * new Layer('name', group, svgElem); // Create a new group and add it to the DOM after group.\n * new Layer('name', null, svgElem);  // Create a new group and add it to the DOM as the last layer.\n * @memberof module:layer\n */\nclass Layer {\n  /**\n  * @param {string} name - Layer name\n  * @param {SVGGElement|null} group - An existing SVG group element or null.\n  *     If group and no svgElem, use group for this layer.\n  *     If group and svgElem, create a new group element and insert it in the DOM after group.\n  *     If no group and svgElem, create a new group element and insert it in the DOM as the last layer.\n  * @param {SVGGElement=} svgElem - The SVG DOM element. If defined, use this to add\n  *     a new layer to the document.\n  */\n  constructor (name, group, svgElem) {\n    this.name_ = name;\n    this.group_ = svgElem ? null : group;\n\n    if (svgElem) {\n      // Create a group element with title and add it to the DOM.\n      const svgdoc = svgElem.ownerDocument;\n      this.group_ = svgdoc.createElementNS(NS.SVG, 'g');\n      const layerTitle = svgdoc.createElementNS(NS.SVG, 'title');\n      layerTitle.textContent = name;\n      this.group_.append(layerTitle);\n      if (group) {\n        $(group).after(this.group_);\n      } else {\n        svgElem.append(this.group_);\n      }\n    }\n\n    addLayerClass(this.group_);\n    walkTree(this.group_, function (e) {\n      e.setAttribute('style', 'pointer-events:inherit');\n    });\n\n    this.group_.setAttribute('style', svgElem ? 'pointer-events:all' : 'pointer-events:none');\n  }\n\n  /**\n   * Get the layer's name.\n   * @returns {string} The layer name\n   */\n  getName () {\n    return this.name_;\n  }\n\n  /**\n   * Get the group element for this layer.\n   * @returns {SVGGElement} The layer SVG group\n   */\n  getGroup () {\n    return this.group_;\n  }\n\n  /**\n   * Active this layer so it takes pointer events.\n   * @returns {undefined}\n   */\n  activate () {\n    this.group_.setAttribute('style', 'pointer-events:all');\n  }\n\n  /**\n   * Deactive this layer so it does NOT take pointer events.\n   * @returns {undefined}\n   */\n  deactivate () {\n    this.group_.setAttribute('style', 'pointer-events:none');\n  }\n\n  /**\n   * Set this layer visible or hidden based on 'visible' parameter.\n   * @param {boolean} visible - If true, make visible; otherwise, hide it.\n   * @returns {undefined}\n   */\n  setVisible (visible) {\n    const expected = visible === undefined || visible ? 'inline' : 'none';\n    const oldDisplay = this.group_.getAttribute('display');\n    if (oldDisplay !== expected) {\n      this.group_.setAttribute('display', expected);\n    }\n  }\n\n  /**\n   * Is this layer visible?\n   * @returns {boolean} True if visible.\n   */\n  isVisible () {\n    return this.group_.getAttribute('display') !== 'none';\n  }\n\n  /**\n   * Get layer opacity.\n   * @returns {Float} Opacity value.\n   */\n  getOpacity () {\n    const opacity = this.group_.getAttribute('opacity');\n    if (opacity === null || opacity === undefined) {\n      return 1;\n    }\n    return parseFloat(opacity);\n  }\n\n  /**\n   * Sets the opacity of this layer. If opacity is not a value between 0.0 and 1.0,\n   * nothing happens.\n   * @param {Float} opacity - A float value in the range 0.0-1.0\n   * @returns {undefined}\n   */\n  setOpacity (opacity) {\n    if (typeof opacity === 'number' && opacity >= 0.0 && opacity <= 1.0) {\n      this.group_.setAttribute('opacity', opacity);\n    }\n  }\n\n  /**\n   * Append children to this layer.\n   * @param {SVGGElement} children - The children to append to this layer.\n   * @returns {undefined}\n   */\n  appendChildren (children) {\n    for (let i = 0; i < children.length; ++i) {\n      this.group_.append(children[i]);\n    }\n  }\n\n  /**\n  * @returns {SVGTitleElement|null}\n  */\n  getTitleElement () {\n    const len = this.group_.childNodes.length;\n    for (let i = 0; i < len; ++i) {\n      const child = this.group_.childNodes.item(i);\n      if (child && child.tagName === 'title') {\n        return child;\n      }\n    }\n    return null;\n  }\n\n  /**\n   * Set the name of this layer.\n   * @param {string} name - The new name.\n   * @param {module:history.HistoryRecordingService} hrService - History recording service\n   * @returns {string|null} The new name if changed; otherwise, null.\n   */\n  setName (name, hrService) {\n    const previousName = this.name_;\n    name = toXml(name);\n    // now change the underlying title element contents\n    const title = this.getTitleElement();\n    if (title) {\n      $(title).empty();\n      title.textContent = name;\n      this.name_ = name;\n      if (hrService) {\n        hrService.changeElement(title, {'#text': previousName});\n      }\n      return this.name_;\n    }\n    return null;\n  }\n\n  /**\n   * Remove this layer's group from the DOM. No more functions on group can be called after this.\n   * @param {SVGGElement} children - The children to append to this layer.\n   * @returns {SVGGElement} The layer SVG group that was just removed.\n   */\n  removeGroup () {\n    const parent = this.group_.parentNode;\n    const group = parent.removeChild(this.group_);\n    this.group_ = undefined;\n    return group;\n  }\n}\n/**\n * @property {string} CLASS_NAME - class attribute assigned to all layer groups.\n */\nLayer.CLASS_NAME = 'layer';\n\n/**\n * @property {RegExp} CLASS_REGEX - Used to test presence of class Layer.CLASS_NAME\n */\nLayer.CLASS_REGEX = new RegExp('(\\\\s|^)' + Layer.CLASS_NAME + '(\\\\s|$)');\n\n/**\n * Add class `Layer.CLASS_NAME` to the element (usually `class='layer'`).\n *\n * @param {SVGGElement} elem - The SVG element to update\n * @returns {undefined}\n */\nfunction addLayerClass (elem) {\n  const classes = elem.getAttribute('class');\n  if (classes === null || classes === undefined || !classes.length) {\n    elem.setAttribute('class', Layer.CLASS_NAME);\n  } else if (!Layer.CLASS_REGEX.test(classes)) {\n    elem.setAttribute('class', classes + ' ' + Layer.CLASS_NAME);\n  }\n}\n\nexport default Layer;\n","/**\n * HistoryRecordingService component of history\n * @module history\n * @license MIT\n * @copyright 2016 Flint O'Brien\n */\n\nimport {\n  BatchCommand, MoveElementCommand, InsertElementCommand, RemoveElementCommand,\n  ChangeElementCommand\n} from './history.js';\n\n/**\n * History recording service.\n *\n * A self-contained service interface for recording history. Once injected, no other dependencies\n * or globals are required (example: UndoManager, command types, etc.). Easy to mock for unit tests.\n * Built on top of history classes in history.js.\n *\n * There is a simple start/end interface for batch commands.\n *\n * HistoryRecordingService.NO_HISTORY is a singleton that can be passed in to functions\n * that record history. This helps when the caller requires that no history be recorded.\n *\n * The following will record history: insert, batch, insert.\n * @example\n * hrService = new history.HistoryRecordingService(this.undoMgr);\n * hrService.insertElement(elem, text);         // add simple command to history.\n * hrService.startBatchCommand('create two elements');\n * hrService.changeElement(elem, attrs, text);  // add to batchCommand\n * hrService.changeElement(elem, attrs2, text); // add to batchCommand\n * hrService.endBatchCommand();                  // add batch command with two change commands to history.\n * hrService.insertElement(elem, text);         // add simple command to history.\n *\n * @example\n * // Note that all functions return this, so commands can be chained, like so:\n * hrService\n *   .startBatchCommand('create two elements')\n *   .insertElement(elem, text)\n *   .changeElement(elem, attrs, text)\n *   .endBatchCommand();\n *\n * @memberof module:history\n */\nclass HistoryRecordingService {\n  /**\n  * @param {history.UndoManager|null} undoManager - The undo manager.\n  *     A value of `null` is valid for cases where no history recording is required.\n  *     See singleton: {@link module:history.HistoryRecordingService.HistoryRecordingService.NO_HISTORY}\n  */\n  constructor (undoManager) {\n    this.undoManager_ = undoManager;\n    this.currentBatchCommand_ = null;\n    this.batchCommandStack_ = [];\n  }\n\n  /**\n   * Start a batch command so multiple commands can recorded as a single history command.\n   * Requires a corresponding call to endBatchCommand. Start and end commands can be nested.\n   *\n   * @param {string} text - Optional string describing the batch command.\n   * @returns {module:history.HistoryRecordingService}\n   */\n  startBatchCommand (text) {\n    if (!this.undoManager_) { return this; }\n    this.currentBatchCommand_ = new BatchCommand(text);\n    this.batchCommandStack_.push(this.currentBatchCommand_);\n    return this;\n  }\n\n  /**\n   * End a batch command and add it to the history or a parent batch command.\n   * @returns {module:history.HistoryRecordingService}\n   */\n  endBatchCommand () {\n    if (!this.undoManager_) { return this; }\n    if (this.currentBatchCommand_) {\n      const batchCommand = this.currentBatchCommand_;\n      this.batchCommandStack_.pop();\n      const {length} = this.batchCommandStack_;\n      this.currentBatchCommand_ = length ? this.batchCommandStack_[length - 1] : null;\n      this.addCommand_(batchCommand);\n    }\n    return this;\n  }\n\n  /**\n   * Add a MoveElementCommand to the history or current batch command\n   * @param {Element} elem - The DOM element that was moved\n   * @param {Element} oldNextSibling - The element's next sibling before it was moved\n   * @param {Element} oldParent - The element's parent before it was moved\n   * @param {string} [text] - An optional string visible to user related to this change\n   * @returns {module:history.HistoryRecordingService}\n   */\n  moveElement (elem, oldNextSibling, oldParent, text) {\n    if (!this.undoManager_) { return this; }\n    this.addCommand_(new MoveElementCommand(elem, oldNextSibling, oldParent, text));\n    return this;\n  }\n\n  /**\n   * Add an InsertElementCommand to the history or current batch command\n   * @param {Element} elem - The DOM element that was added\n   * @param {string} [text] - An optional string visible to user related to this change\n   * @returns {module:history.HistoryRecordingService}\n   */\n  insertElement (elem, text) {\n    if (!this.undoManager_) { return this; }\n    this.addCommand_(new InsertElementCommand(elem, text));\n    return this;\n  }\n\n  /**\n   * Add a RemoveElementCommand to the history or current batch command\n   * @param {Element} elem - The DOM element that was removed\n   * @param {Element} oldNextSibling - The element's next sibling before it was removed\n   * @param {Element} oldParent - The element's parent before it was removed\n   * @param {string} [text] - An optional string visible to user related to this change\n   * @returns {module:history.HistoryRecordingService}\n   */\n  removeElement (elem, oldNextSibling, oldParent, text) {\n    if (!this.undoManager_) { return this; }\n    this.addCommand_(new RemoveElementCommand(elem, oldNextSibling, oldParent, text));\n    return this;\n  }\n\n  /**\n   * Add a ChangeElementCommand to the history or current batch command\n   * @param {Element} elem - The DOM element that was changed\n   * @param {module:history.CommandAttributes} attrs - An object with the attributes to be changed and the values they had *before* the change\n   * @param {string} [text] - An optional string visible to user related to this change\n   * @returns {module:history.HistoryRecordingService}\n   */\n  changeElement (elem, attrs, text) {\n    if (!this.undoManager_) { return this; }\n    this.addCommand_(new ChangeElementCommand(elem, attrs, text));\n    return this;\n  }\n\n  /**\n   * Private function to add a command to the history or current batch command.\n   * @private\n   * @param {Command} cmd\n   * @returns {module:history.HistoryRecordingService}\n   */\n  addCommand_ (cmd) {\n    if (!this.undoManager_) { return this; }\n    if (this.currentBatchCommand_) {\n      this.currentBatchCommand_.addSubCommand(cmd);\n    } else {\n      this.undoManager_.addCommandToHistory(cmd);\n    }\n  }\n}\n/**\n * @memberof module:history.HistoryRecordingService\n * @property {module:history.HistoryRecordingService} NO_HISTORY - Singleton that can be passed to functions that record history, but the caller requires that no history be recorded.\n */\nHistoryRecordingService.NO_HISTORY = new HistoryRecordingService();\nexport default HistoryRecordingService;\n","/* globals jQuery */\n/**\n * Tools for drawing\n * @module draw\n * @license MIT\n * @copyright 2011 Jeff Schiller\n */\n\nimport Layer from './layer.js';\nimport HistoryRecordingService from './historyrecording.js';\n\nimport {NS} from './namespaces.js';\nimport {isOpera} from './browser.js';\nimport {\n  toXml, getElem,\n  copyElem as utilCopyElem\n} from './utilities.js';\nimport {\n  BatchCommand, RemoveElementCommand, MoveElementCommand, ChangeElementCommand\n} from './history.js';\n\nconst $ = jQuery;\n\nconst visElems = 'a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use'.split(',');\n\nconst RandomizeModes = {\n  LET_DOCUMENT_DECIDE: 0,\n  ALWAYS_RANDOMIZE: 1,\n  NEVER_RANDOMIZE: 2\n};\nlet randIds = RandomizeModes.LET_DOCUMENT_DECIDE;\n// Array with current disabled elements (for in-group editing)\nlet disabledElems = [];\n\n/**\n * Get a HistoryRecordingService.\n * @param {module:history.HistoryRecordingService} [hrService] - if exists, return it instead of creating a new service.\n * @returns {module:history.HistoryRecordingService}\n */\nfunction historyRecordingService (hrService) {\n  return hrService || new HistoryRecordingService(canvas_.undoMgr);\n}\n\n/**\n * Find the layer name in a group element.\n * @param {Element} group The group element to search in.\n * @returns {string} The layer name or empty string.\n */\nfunction findLayerNameInGroup (group) {\n  return $('title', group).text() ||\n    (isOpera() && group.querySelectorAll\n      // Hack for Opera 10.60\n      ? $(group.querySelectorAll('title')).text()\n      : '');\n}\n\n/**\n * Given a set of names, return a new unique name.\n * @param {string[]} existingLayerNames - Existing layer names.\n * @returns {string} - The new name.\n */\nfunction getNewLayerName (existingLayerNames) {\n  let i = 1;\n  // TODO(codedread): What about internationalization of \"Layer\"?\n  while (existingLayerNames.includes(('Layer ' + i))) { i++; }\n  return 'Layer ' + i;\n}\n\n/**\n * This class encapsulates the concept of a SVG-edit drawing\n */\nexport class Drawing {\n  /**\n  * @param {SVGSVGElement} svgElem - The SVG DOM Element that this JS object\n  *     encapsulates.  If the svgElem has a se:nonce attribute on it, then\n  *     IDs will use the nonce as they are generated.\n  * @param {string} [optIdPrefix=svg_] - The ID prefix to use.\n  * @throws {Error} If not initialized with an SVG element\n  */\n  constructor (svgElem, optIdPrefix) {\n    if (!svgElem || !svgElem.tagName || !svgElem.namespaceURI ||\n      svgElem.tagName !== 'svg' || svgElem.namespaceURI !== NS.SVG) {\n      throw new Error('Error: svgedit.draw.Drawing instance initialized without a <svg> element');\n    }\n\n    /**\n    * The SVG DOM Element that represents this drawing.\n    * @type {SVGSVGElement}\n    */\n    this.svgElem_ = svgElem;\n\n    /**\n    * The latest object number used in this drawing.\n    * @type {Integer}\n    */\n    this.obj_num = 0;\n\n    /**\n    * The prefix to prepend to each element id in the drawing.\n    * @type {string}\n    */\n    this.idPrefix = optIdPrefix || 'svg_';\n\n    /**\n    * An array of released element ids to immediately reuse.\n    * @type {Integer[]}\n    */\n    this.releasedNums = [];\n\n    /**\n    * The z-ordered array of Layer objects. Each layer has a name\n    * and group element.\n    * The first layer is the one at the bottom of the rendering.\n    * @type {Layer[]}\n    */\n    this.all_layers = [];\n\n    /**\n    * Map of all_layers by name.\n    *\n    * Note: Layers are ordered, but referenced externally by name; so, we need both container\n    * types depending on which function is called (i.e. all_layers and layer_map).\n    *\n    * @type {PlainObject.<string, Layer>}\n    */\n    this.layer_map = {};\n\n    /**\n    * The current layer being used.\n    * @type {Layer}\n    */\n    this.current_layer = null;\n\n    /**\n    * The nonce to use to uniquely identify elements across drawings.\n    * @type {!String}\n    */\n    this.nonce_ = '';\n    const n = this.svgElem_.getAttributeNS(NS.SE, 'nonce');\n    // If already set in the DOM, use the nonce throughout the document\n    // else, if randomizeIds(true) has been called, create and set the nonce.\n    if (!!n && randIds !== RandomizeModes.NEVER_RANDOMIZE) {\n      this.nonce_ = n;\n    } else if (randIds === RandomizeModes.ALWAYS_RANDOMIZE) {\n      this.setNonce(Math.floor(Math.random() * 100001));\n    }\n  }\n\n  /**\n   * @param {string} id Element ID to retrieve\n   * @returns {Element} SVG element within the root SVGSVGElement\n  */\n  getElem_ (id) {\n    if (this.svgElem_.querySelector) {\n      // querySelector lookup\n      return this.svgElem_.querySelector('#' + id);\n    }\n    // jQuery lookup: twice as slow as xpath in FF\n    return $(this.svgElem_).find('[id=' + id + ']')[0];\n  }\n\n  /**\n   * @returns {SVGSVGElement}\n   */\n  getSvgElem () {\n    return this.svgElem_;\n  }\n\n  /**\n   * @returns {!(string|Integer)} The previously set nonce\n   */\n  getNonce () {\n    return this.nonce_;\n  }\n\n  /**\n   * @param {!(string|Integer)} n The nonce to set\n   * @returns {undefined}\n   */\n  setNonce (n) {\n    this.svgElem_.setAttributeNS(NS.XMLNS, 'xmlns:se', NS.SE);\n    this.svgElem_.setAttributeNS(NS.SE, 'se:nonce', n);\n    this.nonce_ = n;\n  }\n\n  /**\n   * Clears any previously set nonce\n   * @returns {undefined}\n   */\n  clearNonce () {\n    // We deliberately leave any se:nonce attributes alone,\n    // we just don't use it to randomize ids.\n    this.nonce_ = '';\n  }\n\n  /**\n   * Returns the latest object id as a string.\n   * @returns {string} The latest object Id.\n   */\n  getId () {\n    return this.nonce_\n      ? this.idPrefix + this.nonce_ + '_' + this.obj_num\n      : this.idPrefix + this.obj_num;\n  }\n\n  /**\n   * Returns the next object Id as a string.\n   * @returns {string} The next object Id to use.\n   */\n  getNextId () {\n    const oldObjNum = this.obj_num;\n    let restoreOldObjNum = false;\n\n    // If there are any released numbers in the release stack,\n    // use the last one instead of the next obj_num.\n    // We need to temporarily use obj_num as that is what getId() depends on.\n    if (this.releasedNums.length > 0) {\n      this.obj_num = this.releasedNums.pop();\n      restoreOldObjNum = true;\n    } else {\n      // If we are not using a released id, then increment the obj_num.\n      this.obj_num++;\n    }\n\n    // Ensure the ID does not exist.\n    let id = this.getId();\n    while (this.getElem_(id)) {\n      if (restoreOldObjNum) {\n        this.obj_num = oldObjNum;\n        restoreOldObjNum = false;\n      }\n      this.obj_num++;\n      id = this.getId();\n    }\n    // Restore the old object number if required.\n    if (restoreOldObjNum) {\n      this.obj_num = oldObjNum;\n    }\n    return id;\n  }\n\n  /**\n   * Releases the object Id, letting it be used as the next id in getNextId().\n   * This method DOES NOT remove any elements from the DOM, it is expected\n   * that client code will do this.\n   * @param {string} id - The id to release.\n   * @returns {boolean} True if the id was valid to be released, false otherwise.\n  */\n  releaseId (id) {\n    // confirm if this is a valid id for this Document, else return false\n    const front = this.idPrefix + (this.nonce_ ? this.nonce_ + '_' : '');\n    if (typeof id !== 'string' || !id.startsWith(front)) {\n      return false;\n    }\n    // extract the obj_num of this id\n    const num = parseInt(id.substr(front.length), 10);\n\n    // if we didn't get a positive number or we already released this number\n    // then return false.\n    if (typeof num !== 'number' || num <= 0 || this.releasedNums.includes(num)) {\n      return false;\n    }\n\n    // push the released number into the released queue\n    this.releasedNums.push(num);\n\n    return true;\n  }\n\n  /**\n   * Returns the number of layers in the current drawing.\n   * @returns {Integer} The number of layers in the current drawing.\n  */\n  getNumLayers () {\n    return this.all_layers.length;\n  }\n\n  /**\n   * Check if layer with given name already exists\n   * @param {string} name - The layer name to check\n   * @returns {boolean}\n  */\n  hasLayer (name) {\n    return this.layer_map[name] !== undefined;\n  }\n\n  /**\n   * Returns the name of the ith layer. If the index is out of range, an empty string is returned.\n   * @param {Integer} i - The zero-based index of the layer you are querying.\n   * @returns {string} The name of the ith layer (or the empty string if none found)\n  */\n  getLayerName (i) {\n    return i >= 0 && i < this.getNumLayers() ? this.all_layers[i].getName() : '';\n  }\n\n  /**\n   * @returns {SVGGElement|null} The SVGGElement representing the current layer.\n   */\n  getCurrentLayer () {\n    return this.current_layer ? this.current_layer.getGroup() : null;\n  }\n\n  /**\n   * Get a layer by name.\n   * @returns {SVGGElement} The SVGGElement representing the named layer or null.\n   */\n  getLayerByName (name) {\n    const layer = this.layer_map[name];\n    return layer ? layer.getGroup() : null;\n  }\n\n  /**\n   * Returns the name of the currently selected layer. If an error occurs, an empty string\n   * is returned.\n   * @returns {string} The name of the currently active layer (or the empty string if none found).\n  */\n  getCurrentLayerName () {\n    return this.current_layer ? this.current_layer.getName() : '';\n  }\n\n  /**\n   * Set the current layer's name.\n   * @param {string} name - The new name.\n   * @param {module:history.HistoryRecordingService} hrService - History recording service\n   * @returns {string|null} The new name if changed; otherwise, null.\n   */\n  setCurrentLayerName (name, hrService) {\n    let finalName = null;\n    if (this.current_layer) {\n      const oldName = this.current_layer.getName();\n      finalName = this.current_layer.setName(name, hrService);\n      if (finalName) {\n        delete this.layer_map[oldName];\n        this.layer_map[finalName] = this.current_layer;\n      }\n    }\n    return finalName;\n  }\n\n  /**\n   * Set the current layer's position.\n   * @param {Integer} newpos - The zero-based index of the new position of the layer. Range should be 0 to layers-1\n   * @returns {{title: SVGGElement, previousName: string}|null} If the name was changed, returns {title:SVGGElement, previousName:string}; otherwise null.\n   */\n  setCurrentLayerPosition (newpos) {\n    const layerCount = this.getNumLayers();\n    if (!this.current_layer || newpos < 0 || newpos >= layerCount) {\n      return null;\n    }\n\n    let oldpos;\n    for (oldpos = 0; oldpos < layerCount; ++oldpos) {\n      if (this.all_layers[oldpos] === this.current_layer) { break; }\n    }\n    // some unknown error condition (current_layer not in all_layers)\n    if (oldpos === layerCount) { return null; }\n\n    if (oldpos !== newpos) {\n      // if our new position is below us, we need to insert before the node after newpos\n      const currentGroup = this.current_layer.getGroup();\n      const oldNextSibling = currentGroup.nextSibling;\n\n      let refGroup = null;\n      if (newpos > oldpos) {\n        if (newpos < layerCount - 1) {\n          refGroup = this.all_layers[newpos + 1].getGroup();\n        }\n      // if our new position is above us, we need to insert before the node at newpos\n      } else {\n        refGroup = this.all_layers[newpos].getGroup();\n      }\n      this.svgElem_.insertBefore(currentGroup, refGroup); // Ok to replace with `refGroup.before(currentGroup);`?\n\n      this.identifyLayers();\n      this.setCurrentLayer(this.getLayerName(newpos));\n\n      return {\n        currentGroup,\n        oldNextSibling\n      };\n    }\n    return null;\n  }\n\n  /**\n  * @param {module:history.HistoryRecordingService} hrService\n  * @returns {undefined}\n  */\n  mergeLayer (hrService) {\n    const currentGroup = this.current_layer.getGroup();\n    const prevGroup = $(currentGroup).prev()[0];\n    if (!prevGroup) { return; }\n\n    hrService.startBatchCommand('Merge Layer');\n\n    const layerNextSibling = currentGroup.nextSibling;\n    hrService.removeElement(currentGroup, layerNextSibling, this.svgElem_);\n\n    while (currentGroup.firstChild) {\n      const child = currentGroup.firstChild;\n      if (child.localName === 'title') {\n        hrService.removeElement(child, child.nextSibling, currentGroup);\n        child.remove();\n        continue;\n      }\n      const oldNextSibling = child.nextSibling;\n      prevGroup.append(child);\n      hrService.moveElement(child, oldNextSibling, currentGroup);\n    }\n\n    // Remove current layer's group\n    this.current_layer.removeGroup();\n    // Remove the current layer and set the previous layer as the new current layer\n    const index = this.all_layers.indexOf(this.current_layer);\n    if (index > 0) {\n      const name = this.current_layer.getName();\n      this.current_layer = this.all_layers[index - 1];\n      this.all_layers.splice(index, 1);\n      delete this.layer_map[name];\n    }\n\n    hrService.endBatchCommand();\n  }\n\n  /**\n  * @param {module:history.HistoryRecordingService} hrService\n  * @returns {undefined}\n  */\n  mergeAllLayers (hrService) {\n    // Set the current layer to the last layer.\n    this.current_layer = this.all_layers[this.all_layers.length - 1];\n\n    hrService.startBatchCommand('Merge all Layers');\n    while (this.all_layers.length > 1) {\n      this.mergeLayer(hrService);\n    }\n    hrService.endBatchCommand();\n  }\n\n  /**\n   * Sets the current layer. If the name is not a valid layer name, then this\n   * function returns `false`. Otherwise it returns `true`. This is not an\n   * undo-able action.\n   * @param {string} name - The name of the layer you want to switch to.\n   * @returns {boolean} `true` if the current layer was switched, otherwise `false`\n   */\n  setCurrentLayer (name) {\n    const layer = this.layer_map[name];\n    if (layer) {\n      if (this.current_layer) {\n        this.current_layer.deactivate();\n      }\n      this.current_layer = layer;\n      this.current_layer.activate();\n      return true;\n    }\n    return false;\n  }\n\n  /**\n   * Deletes the current layer from the drawing and then clears the selection.\n   * This function then calls the 'changed' handler.  This is an undoable action.\n   * @todo Does this actually call the 'changed' handler?\n   * @returns {SVGGElement} The SVGGElement of the layer removed or null.\n   */\n  deleteCurrentLayer () {\n    if (this.current_layer && this.getNumLayers() > 1) {\n      const oldLayerGroup = this.current_layer.removeGroup();\n      this.identifyLayers();\n      return oldLayerGroup;\n    }\n    return null;\n  }\n\n  /**\n   * Updates layer system and sets the current layer to the\n   * top-most layer (last `<g>` child of this drawing).\n   * @returns {undefined}\n  */\n  identifyLayers () {\n    this.all_layers = [];\n    this.layer_map = {};\n    const numchildren = this.svgElem_.childNodes.length;\n    // loop through all children of SVG element\n    const orphans = [], layernames = [];\n    let layer = null;\n    let childgroups = false;\n    for (let i = 0; i < numchildren; ++i) {\n      const child = this.svgElem_.childNodes.item(i);\n      // for each g, find its layer name\n      if (child && child.nodeType === 1) {\n        if (child.tagName === 'g') {\n          childgroups = true;\n          const name = findLayerNameInGroup(child);\n          if (name) {\n            layernames.push(name);\n            layer = new Layer(name, child);\n            this.all_layers.push(layer);\n            this.layer_map[name] = layer;\n          } else {\n            // if group did not have a name, it is an orphan\n            orphans.push(child);\n          }\n        } else if (visElems.includes(child.nodeName)) {\n          // Child is \"visible\" (i.e. not a <title> or <defs> element), so it is an orphan\n          orphans.push(child);\n        }\n      }\n    }\n\n    // If orphans or no layers found, create a new layer and add all the orphans to it\n    if (orphans.length > 0 || !childgroups) {\n      layer = new Layer(getNewLayerName(layernames), null, this.svgElem_);\n      layer.appendChildren(orphans);\n      this.all_layers.push(layer);\n      this.layer_map[name] = layer;\n    } else {\n      layer.activate();\n    }\n    this.current_layer = layer;\n  }\n\n  /**\n   * Creates a new top-level layer in the drawing with the given name and\n   * makes it the current layer.\n   * @param {string} name - The given name. If the layer name exists, a new name will be generated.\n   * @param {module:history.HistoryRecordingService} hrService - History recording service\n   * @returns {SVGGElement} The SVGGElement of the new layer, which is\n   *     also the current layer of this drawing.\n  */\n  createLayer (name, hrService) {\n    if (this.current_layer) {\n      this.current_layer.deactivate();\n    }\n    // Check for duplicate name.\n    if (name === undefined || name === null || name === '' || this.layer_map[name]) {\n      name = getNewLayerName(Object.keys(this.layer_map));\n    }\n\n    // Crate new layer and add to DOM as last layer\n    const layer = new Layer(name, null, this.svgElem_);\n    // Like to assume hrService exists, but this is backwards compatible with old version of createLayer.\n    if (hrService) {\n      hrService.startBatchCommand('Create Layer');\n      hrService.insertElement(layer.getGroup());\n      hrService.endBatchCommand();\n    }\n\n    this.all_layers.push(layer);\n    this.layer_map[name] = layer;\n    this.current_layer = layer;\n    return layer.getGroup();\n  }\n\n  /**\n   * Creates a copy of the current layer with the given name and makes it the current layer.\n   * @param {string} name - The given name. If the layer name exists, a new name will be generated.\n   * @param {module:history.HistoryRecordingService} hrService - History recording service\n   * @returns {SVGGElement} The SVGGElement of the new layer, which is\n   *     also the current layer of this drawing.\n  */\n  cloneLayer (name, hrService) {\n    if (!this.current_layer) { return null; }\n    this.current_layer.deactivate();\n    // Check for duplicate name.\n    if (name === undefined || name === null || name === '' || this.layer_map[name]) {\n      name = getNewLayerName(Object.keys(this.layer_map));\n    }\n\n    // Create new group and add to DOM just after current_layer\n    const currentGroup = this.current_layer.getGroup();\n    const layer = new Layer(name, currentGroup, this.svgElem_);\n    const group = layer.getGroup();\n\n    // Clone children\n    const children = currentGroup.childNodes;\n    for (let index = 0; index < children.length; index++) {\n      const ch = children[index];\n      if (ch.localName === 'title') { continue; }\n      group.append(this.copyElem(ch));\n    }\n\n    if (hrService) {\n      hrService.startBatchCommand('Duplicate Layer');\n      hrService.insertElement(group);\n      hrService.endBatchCommand();\n    }\n\n    // Update layer containers and current_layer.\n    const index = this.all_layers.indexOf(this.current_layer);\n    if (index >= 0) {\n      this.all_layers.splice(index + 1, 0, layer);\n    } else {\n      this.all_layers.push(layer);\n    }\n    this.layer_map[name] = layer;\n    this.current_layer = layer;\n    return group;\n  }\n\n  /**\n   * Returns whether the layer is visible.  If the layer name is not valid,\n   * then this function returns `false`.\n   * @param {string} layerName - The name of the layer which you want to query.\n   * @returns {boolean} The visibility state of the layer, or `false` if the layer name was invalid.\n  */\n  getLayerVisibility (layerName) {\n    const layer = this.layer_map[layerName];\n    return layer ? layer.isVisible() : false;\n  }\n\n  /**\n   * Sets the visibility of the layer. If the layer name is not valid, this\n   * function returns `null`, otherwise it returns the `SVGElement` representing\n   * the layer. This is an undo-able action.\n   * @param {string} layerName - The name of the layer to change the visibility\n   * @param {boolean} bVisible - Whether the layer should be visible\n   * @returns {?SVGGElement} The SVGGElement representing the layer if the\n   *   `layerName` was valid, otherwise `null`.\n  */\n  setLayerVisibility (layerName, bVisible) {\n    if (typeof bVisible !== 'boolean') {\n      return null;\n    }\n    const layer = this.layer_map[layerName];\n    if (!layer) { return null; }\n    layer.setVisible(bVisible);\n    return layer.getGroup();\n  }\n\n  /**\n   * Returns the opacity of the given layer.  If the input name is not a layer, `null` is returned.\n   * @param {string} layerName - name of the layer on which to get the opacity\n   * @returns {?Float} The opacity value of the given layer.  This will be a value between 0.0 and 1.0, or `null`\n   * if `layerName` is not a valid layer\n  */\n  getLayerOpacity (layerName) {\n    const layer = this.layer_map[layerName];\n    if (!layer) { return null; }\n    return layer.getOpacity();\n  }\n\n  /**\n   * Sets the opacity of the given layer.  If the input name is not a layer,\n   * nothing happens. If opacity is not a value between 0.0 and 1.0, then\n   * nothing happens.\n   * NOTE: this function exists solely to apply a highlighting/de-emphasis\n   * effect to a layer. When it is possible for a user to affect the opacity\n   * of a layer, we will need to allow this function to produce an undo-able\n   * action.\n   * @param {string} layerName - Name of the layer on which to set the opacity\n   * @param {Float} opacity - A float value in the range 0.0-1.0\n   * @returns {undefined}\n  */\n  setLayerOpacity (layerName, opacity) {\n    if (typeof opacity !== 'number' || opacity < 0.0 || opacity > 1.0) {\n      return;\n    }\n    const layer = this.layer_map[layerName];\n    if (layer) {\n      layer.setOpacity(opacity);\n    }\n  }\n\n  /**\n   * Create a clone of an element, updating its ID and its children's IDs when needed\n   * @param {Element} el - DOM element to clone\n   * @returns {Element}\n   */\n  copyElem (el) {\n    const self = this;\n    const getNextIdClosure = function () { return self.getNextId(); };\n    return utilCopyElem(el, getNextIdClosure);\n  }\n}\n\n/**\n * Called to ensure that drawings will or will not have randomized ids.\n * The currentDrawing will have its nonce set if it doesn't already.\n * @function module:draw.randomizeIds\n * @param {boolean} enableRandomization - flag indicating if documents should have randomized ids\n * @param {draw.Drawing} currentDrawing\n * @returns {undefined}\n */\nexport const randomizeIds = function (enableRandomization, currentDrawing) {\n  randIds = enableRandomization === false\n    ? RandomizeModes.NEVER_RANDOMIZE\n    : RandomizeModes.ALWAYS_RANDOMIZE;\n\n  if (randIds === RandomizeModes.ALWAYS_RANDOMIZE && !currentDrawing.getNonce()) {\n    currentDrawing.setNonce(Math.floor(Math.random() * 100001));\n  } else if (randIds === RandomizeModes.NEVER_RANDOMIZE && currentDrawing.getNonce()) {\n    currentDrawing.clearNonce();\n  }\n};\n\n// Layer API Functions\n\n/**\n* Group: Layers\n*/\n\n/**\n * @see {@link https://api.jquery.com/jQuery.data/}\n * @name external:jQuery.data\n */\n\n/**\n * @interface module:draw.DrawCanvasInit\n * @property {module:path.pathActions} pathActions\n * @property {external:jQuery.data} elData\n * @property {module:history.UndoManager} undoMgr\n */\n/**\n * @function module:draw.DrawCanvasInit#getCurrentGroup\n * @returns {Element}\n */\n/**\n * @function module:draw.DrawCanvasInit#setCurrentGroup\n * @param {Element} cg\n * @returns {undefined}\n*/\n/**\n * @function module:draw.DrawCanvasInit#getSelectedElements\n * @returns {Element[]} the array with selected DOM elements\n*/\n/**\n * @function module:draw.DrawCanvasInit#getSVGContent\n * @returns {SVGSVGElement}\n */\n/**\n * @function module:draw.DrawCanvasInit#getCurrentDrawing\n * @returns {module:draw.Drawing}\n */\n/**\n * @function module:draw.DrawCanvasInit#clearSelection\n * @param {boolean} [noCall] - When `true`, does not call the \"selected\" handler\n * @returns {undefined}\n*/\n/**\n * Run the callback function associated with the given event\n * @function module:draw.DrawCanvasInit#call\n * @param {\"changed\"|\"contextset\"} ev - String with the event name\n * @param {module:svgcanvas.SvgCanvas#event:changed|module:svgcanvas.SvgCanvas#event:contextset} arg - Argument to pass through to the callback\n * function. If the event is \"changed\", a (single-item) array of `Element`s is\n * passed. If the event is \"contextset\", the arg is `null` or `Element`.\n * @returns {undefined}\n */\n/**\n * @function module:draw.DrawCanvasInit#addCommandToHistory\n * @param {Command} cmd\n * @returns {undefined}\n*/\n/**\n * @function module:draw.DrawCanvasInit#changeSVGContent\n * @returns {undefined}\n */\n\nlet canvas_;\n/**\n* @function module:draw.init\n* @param {module:draw.DrawCanvasInit} canvas\n* @returns {undefined}\n*/\nexport const init = function (canvas) {\n  canvas_ = canvas;\n};\n\n/**\n* Updates layer system\n* @function module:draw.identifyLayers\n* @returns {undefined}\n*/\nexport const identifyLayers = function () {\n  leaveContext();\n  canvas_.getCurrentDrawing().identifyLayers();\n};\n\n/**\n* Creates a new top-level layer in the drawing with the given name, sets the current layer\n* to it, and then clears the selection. This function then calls the 'changed' handler.\n* This is an undoable action.\n* @function module:draw.createLayer\n* @param {string} name - The given name\n* @param {module:history.HistoryRecordingService} hrService\n* @fires module:svgcanvas.SvgCanvas#event:changed\n* @returns {undefined}\n*/\nexport const createLayer = function (name, hrService) {\n  const newLayer = canvas_.getCurrentDrawing().createLayer(\n    name,\n    historyRecordingService(hrService)\n  );\n  canvas_.clearSelection();\n  canvas_.call('changed', [newLayer]);\n};\n\n/**\n * Creates a new top-level layer in the drawing with the given name, copies all the current layer's contents\n * to it, and then clears the selection. This function then calls the 'changed' handler.\n * This is an undoable action.\n * @function module:draw.cloneLayer\n * @param {string} name - The given name. If the layer name exists, a new name will be generated.\n * @param {module:history.HistoryRecordingService} hrService - History recording service\n * @fires module:svgcanvas.SvgCanvas#event:changed\n * @returns {undefined}\n */\nexport const cloneLayer = function (name, hrService) {\n  // Clone the current layer and make the cloned layer the new current layer\n  const newLayer = canvas_.getCurrentDrawing().cloneLayer(name, historyRecordingService(hrService));\n\n  canvas_.clearSelection();\n  leaveContext();\n  canvas_.call('changed', [newLayer]);\n};\n\n/**\n* Deletes the current layer from the drawing and then clears the selection. This function\n* then calls the 'changed' handler. This is an undoable action.\n* @function module:draw.deleteCurrentLayer\n* @fires module:svgcanvas.SvgCanvas#event:changed\n* @returns {boolean} `true` if an old layer group was found to delete\n*/\nexport const deleteCurrentLayer = function () {\n  let currentLayer = canvas_.getCurrentDrawing().getCurrentLayer();\n  const {nextSibling} = currentLayer;\n  const parent = currentLayer.parentNode;\n  currentLayer = canvas_.getCurrentDrawing().deleteCurrentLayer();\n  if (currentLayer) {\n    const batchCmd = new BatchCommand('Delete Layer');\n    // store in our Undo History\n    batchCmd.addSubCommand(new RemoveElementCommand(currentLayer, nextSibling, parent));\n    canvas_.addCommandToHistory(batchCmd);\n    canvas_.clearSelection();\n    canvas_.call('changed', [parent]);\n    return true;\n  }\n  return false;\n};\n\n/**\n* Sets the current layer. If the name is not a valid layer name, then this function returns\n* false. Otherwise it returns true. This is not an undo-able action.\n* @function module:draw.setCurrentLayer\n* @param {string} name - The name of the layer you want to switch to.\n* @returns {boolean} true if the current layer was switched, otherwise false\n*/\nexport const setCurrentLayer = function (name) {\n  const result = canvas_.getCurrentDrawing().setCurrentLayer(toXml(name));\n  if (result) {\n    canvas_.clearSelection();\n  }\n  return result;\n};\n\n/**\n* Renames the current layer. If the layer name is not valid (i.e. unique), then this function\n* does nothing and returns `false`, otherwise it returns `true`. This is an undo-able action.\n* @function module:draw.renameCurrentLayer\n* @param {string} newName - the new name you want to give the current layer. This name must\n* be unique among all layer names.\n* @fires module:svgcanvas.SvgCanvas#event:changed\n* @returns {boolean} Whether the rename succeeded\n*/\nexport const renameCurrentLayer = function (newName) {\n  const drawing = canvas_.getCurrentDrawing();\n  const layer = drawing.getCurrentLayer();\n  if (layer) {\n    const result = drawing.setCurrentLayerName(newName, historyRecordingService());\n    if (result) {\n      canvas_.call('changed', [layer]);\n      return true;\n    }\n  }\n  return false;\n};\n\n/**\n* Changes the position of the current layer to the new value. If the new index is not valid,\n* this function does nothing and returns false, otherwise it returns true. This is an\n* undo-able action.\n* @function module:draw.setCurrentLayerPosition\n* @param {Integer} newPos - The zero-based index of the new position of the layer. This should be between\n* 0 and (number of layers - 1)\n* @returns {boolean} `true` if the current layer position was changed, `false` otherwise.\n*/\nexport const setCurrentLayerPosition = function (newPos) {\n  const drawing = canvas_.getCurrentDrawing();\n  const result = drawing.setCurrentLayerPosition(newPos);\n  if (result) {\n    canvas_.addCommandToHistory(new MoveElementCommand(result.currentGroup, result.oldNextSibling, canvas_.getSVGContent()));\n    return true;\n  }\n  return false;\n};\n\n/**\n* Sets the visibility of the layer. If the layer name is not valid, this function return\n* `false`, otherwise it returns `true`. This is an undo-able action.\n* @function module:draw.setLayerVisibility\n* @param {string} layerName - The name of the layer to change the visibility\n* @param {boolean} bVisible - Whether the layer should be visible\n* @returns {boolean} true if the layer's visibility was set, false otherwise\n*/\nexport const setLayerVisibility = function (layerName, bVisible) {\n  const drawing = canvas_.getCurrentDrawing();\n  const prevVisibility = drawing.getLayerVisibility(layerName);\n  const layer = drawing.setLayerVisibility(layerName, bVisible);\n  if (layer) {\n    const oldDisplay = prevVisibility ? 'inline' : 'none';\n    canvas_.addCommandToHistory(new ChangeElementCommand(layer, {display: oldDisplay}, 'Layer Visibility'));\n  } else {\n    return false;\n  }\n\n  if (layer === drawing.getCurrentLayer()) {\n    canvas_.clearSelection();\n    canvas_.pathActions.clear();\n  }\n  // call('changed', [selected]);\n  return true;\n};\n\n/**\n* Moves the selected elements to layerName. If the name is not a valid layer name, then `false`\n* is returned. Otherwise it returns `true`. This is an undo-able action.\n* @function module:draw.moveSelectedToLayer\n* @param {string} layerName - The name of the layer you want to which you want to move the selected elements\n* @returns {boolean} Whether the selected elements were moved to the layer.\n*/\nexport const moveSelectedToLayer = function (layerName) {\n  // find the layer\n  const drawing = canvas_.getCurrentDrawing();\n  const layer = drawing.getLayerByName(layerName);\n  if (!layer) { return false; }\n\n  const batchCmd = new BatchCommand('Move Elements to Layer');\n\n  // loop for each selected element and move it\n  const selElems = canvas_.getSelectedElements();\n  let i = selElems.length;\n  while (i--) {\n    const elem = selElems[i];\n    if (!elem) { continue; }\n    const oldNextSibling = elem.nextSibling;\n    // TODO: this is pretty brittle!\n    const oldLayer = elem.parentNode;\n    layer.append(elem);\n    batchCmd.addSubCommand(new MoveElementCommand(elem, oldNextSibling, oldLayer));\n  }\n\n  canvas_.addCommandToHistory(batchCmd);\n\n  return true;\n};\n\n/**\n* @function module:draw.mergeLayer\n* @param {module:history.HistoryRecordingService} hrService\n* @returns {undefined}\n*/\nexport const mergeLayer = function (hrService) {\n  canvas_.getCurrentDrawing().mergeLayer(historyRecordingService(hrService));\n  canvas_.clearSelection();\n  leaveContext();\n  canvas_.changeSVGContent();\n};\n\n/**\n* @function module:draw.mergeAllLayers\n* @param {module:history.HistoryRecordingService} hrService\n* @returns {undefined}\n*/\nexport const mergeAllLayers = function (hrService) {\n  canvas_.getCurrentDrawing().mergeAllLayers(historyRecordingService(hrService));\n  canvas_.clearSelection();\n  leaveContext();\n  canvas_.changeSVGContent();\n};\n\n/**\n* Return from a group context to the regular kind, make any previously\n* disabled elements enabled again\n* @function module:draw.leaveContext\n* @fires module:svgcanvas.SvgCanvas#event:contextset\n* @returns {undefined}\n*/\nexport const leaveContext = function () {\n  const len = disabledElems.length;\n  if (len) {\n    for (let i = 0; i < len; i++) {\n      const elem = disabledElems[i];\n      const orig = canvas_.elData(elem, 'orig_opac');\n      if (orig !== 1) {\n        elem.setAttribute('opacity', orig);\n      } else {\n        elem.removeAttribute('opacity');\n      }\n      elem.setAttribute('style', 'pointer-events: inherit');\n    }\n    disabledElems = [];\n    canvas_.clearSelection(true);\n    canvas_.call('contextset', null);\n  }\n  canvas_.setCurrentGroup(null);\n};\n\n/**\n* Set the current context (for in-group editing)\n* @function module:draw.setContext\n* @param {Element} elem\n* @fires module:svgcanvas.SvgCanvas#event:contextset\n* @returns {undefined}\n*/\nexport const setContext = function (elem) {\n  leaveContext();\n  if (typeof elem === 'string') {\n    elem = getElem(elem);\n  }\n\n  // Edit inside this group\n  canvas_.setCurrentGroup(elem);\n\n  // Disable other elements\n  $(elem).parentsUntil('#svgcontent').andSelf().siblings().each(function () {\n    const opac = this.getAttribute('opacity') || 1;\n    // Store the original's opacity\n    canvas_.elData(this, 'orig_opac', opac);\n    this.setAttribute('opacity', opac * 0.33);\n    this.setAttribute('style', 'pointer-events: none');\n    disabledElems.push(this);\n  });\n\n  canvas_.clearSelection();\n  canvas_.call('contextset', canvas_.getCurrentGroup());\n};\n\n/**\n* @memberof module:draw\n* @class Layer\n* @see {@link module:layer.Layer}\n*/\nexport {Layer};\n","/**\n * Tools for SVG sanitization\n * @module sanitize\n * @license MIT\n *\n * @copyright 2010 Alexis Deveria, 2010 Jeff Schiller\n */\n\nimport {getReverseNS, NS} from './namespaces.js';\nimport {isGecko} from './browser.js';\nimport {getHref, setHref, getUrlFromAttr} from './utilities.js';\n\nconst REVERSE_NS = getReverseNS();\n\n// this defines which elements and attributes that we support\nconst svgWhiteList_ = {\n  // SVG Elements\n  a: ['class', 'clip-path', 'clip-rule', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'id', 'mask', 'opacity', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'transform', 'xlink:href', 'xlink:title'],\n  circle: ['class', 'clip-path', 'clip-rule', 'cx', 'cy', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'id', 'mask', 'opacity', 'r', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'transform'],\n  clipPath: ['class', 'clipPathUnits', 'id'],\n  defs: [],\n  style: ['type'],\n  desc: [],\n  ellipse: ['class', 'clip-path', 'clip-rule', 'cx', 'cy', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'id', 'mask', 'opacity', 'requiredFeatures', 'rx', 'ry', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'transform'],\n  feGaussianBlur: ['class', 'color-interpolation-filters', 'id', 'requiredFeatures', 'stdDeviation'],\n  filter: ['class', 'color-interpolation-filters', 'filterRes', 'filterUnits', 'height', 'id', 'primitiveUnits', 'requiredFeatures', 'width', 'x', 'xlink:href', 'y'],\n  foreignObject: ['class', 'font-size', 'height', 'id', 'opacity', 'requiredFeatures', 'style', 'transform', 'width', 'x', 'y'],\n  g: ['class', 'clip-path', 'clip-rule', 'id', 'display', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'mask', 'opacity', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'transform', 'font-family', 'font-size', 'font-style', 'font-weight', 'text-anchor'],\n  image: ['class', 'clip-path', 'clip-rule', 'filter', 'height', 'id', 'mask', 'opacity', 'requiredFeatures', 'style', 'systemLanguage', 'transform', 'width', 'x', 'xlink:href', 'xlink:title', 'y'],\n  line: ['class', 'clip-path', 'clip-rule', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'id', 'marker-end', 'marker-mid', 'marker-start', 'mask', 'opacity', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'transform', 'x1', 'x2', 'y1', 'y2'],\n  linearGradient: ['class', 'id', 'gradientTransform', 'gradientUnits', 'requiredFeatures', 'spreadMethod', 'systemLanguage', 'x1', 'x2', 'xlink:href', 'y1', 'y2'],\n  marker: ['id', 'class', 'markerHeight', 'markerUnits', 'markerWidth', 'orient', 'preserveAspectRatio', 'refX', 'refY', 'systemLanguage', 'viewBox'],\n  mask: ['class', 'height', 'id', 'maskContentUnits', 'maskUnits', 'width', 'x', 'y'],\n  metadata: ['class', 'id'],\n  path: ['class', 'clip-path', 'clip-rule', 'd', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'id', 'marker-end', 'marker-mid', 'marker-start', 'mask', 'opacity', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'transform'],\n  pattern: ['class', 'height', 'id', 'patternContentUnits', 'patternTransform', 'patternUnits', 'requiredFeatures', 'style', 'systemLanguage', 'viewBox', 'width', 'x', 'xlink:href', 'y'],\n  polygon: ['class', 'clip-path', 'clip-rule', 'id', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'id', 'class', 'marker-end', 'marker-mid', 'marker-start', 'mask', 'opacity', 'points', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'transform'],\n  polyline: ['class', 'clip-path', 'clip-rule', 'id', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'marker-end', 'marker-mid', 'marker-start', 'mask', 'opacity', 'points', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'transform'],\n  radialGradient: ['class', 'cx', 'cy', 'fx', 'fy', 'gradientTransform', 'gradientUnits', 'id', 'r', 'requiredFeatures', 'spreadMethod', 'systemLanguage', 'xlink:href'],\n  rect: ['class', 'clip-path', 'clip-rule', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'height', 'id', 'mask', 'opacity', 'requiredFeatures', 'rx', 'ry', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'transform', 'width', 'x', 'y'],\n  stop: ['class', 'id', 'offset', 'requiredFeatures', 'stop-color', 'stop-opacity', 'style', 'systemLanguage'],\n  svg: ['class', 'clip-path', 'clip-rule', 'filter', 'id', 'height', 'mask', 'preserveAspectRatio', 'requiredFeatures', 'style', 'systemLanguage', 'viewBox', 'width', 'x', 'xmlns', 'xmlns:se', 'xmlns:xlink', 'y'],\n  switch: ['class', 'id', 'requiredFeatures', 'systemLanguage'],\n  symbol: ['class', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'font-family', 'font-size', 'font-style', 'font-weight', 'id', 'opacity', 'preserveAspectRatio', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'transform', 'viewBox'],\n  text: ['class', 'clip-path', 'clip-rule', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'font-family', 'font-size', 'font-style', 'font-weight', 'id', 'mask', 'opacity', 'requiredFeatures', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'text-anchor', 'transform', 'x', 'xml:space', 'y'],\n  textPath: ['class', 'id', 'method', 'requiredFeatures', 'spacing', 'startOffset', 'style', 'systemLanguage', 'transform', 'xlink:href'],\n  title: [],\n  tspan: ['class', 'clip-path', 'clip-rule', 'dx', 'dy', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'font-family', 'font-size', 'font-style', 'font-weight', 'id', 'mask', 'opacity', 'requiredFeatures', 'rotate', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'systemLanguage', 'text-anchor', 'textLength', 'transform', 'x', 'xml:space', 'y'],\n  use: ['class', 'clip-path', 'clip-rule', 'fill', 'fill-opacity', 'fill-rule', 'filter', 'height', 'id', 'mask', 'stroke', 'stroke-dasharray', 'stroke-dashoffset', 'stroke-linecap', 'stroke-linejoin', 'stroke-miterlimit', 'stroke-opacity', 'stroke-width', 'style', 'transform', 'width', 'x', 'xlink:href', 'y'],\n\n  // MathML Elements\n  annotation: ['encoding'],\n  'annotation-xml': ['encoding'],\n  maction: ['actiontype', 'other', 'selection'],\n  math: ['class', 'id', 'display', 'xmlns'],\n  menclose: ['notation'],\n  merror: [],\n  mfrac: ['linethickness'],\n  mi: ['mathvariant'],\n  mmultiscripts: [],\n  mn: [],\n  mo: ['fence', 'lspace', 'maxsize', 'minsize', 'rspace', 'stretchy'],\n  mover: [],\n  mpadded: ['lspace', 'width', 'height', 'depth', 'voffset'],\n  mphantom: [],\n  mprescripts: [],\n  mroot: [],\n  mrow: ['xlink:href', 'xlink:type', 'xmlns:xlink'],\n  mspace: ['depth', 'height', 'width'],\n  msqrt: [],\n  mstyle: ['displaystyle', 'mathbackground', 'mathcolor', 'mathvariant', 'scriptlevel'],\n  msub: [],\n  msubsup: [],\n  msup: [],\n  mtable: ['align', 'columnalign', 'columnlines', 'columnspacing', 'displaystyle', 'equalcolumns', 'equalrows', 'frame', 'rowalign', 'rowlines', 'rowspacing', 'width'],\n  mtd: ['columnalign', 'columnspan', 'rowalign', 'rowspan'],\n  mtext: [],\n  mtr: ['columnalign', 'rowalign'],\n  munder: [],\n  munderover: [],\n  none: [],\n  semantics: []\n};\n\n// Produce a Namespace-aware version of svgWhitelist\nconst svgWhiteListNS_ = {};\nObject.entries(svgWhiteList_).forEach(function ([elt, atts]) {\n  const attNS = {};\n  Object.entries(atts).forEach(function ([i, att]) {\n    if (att.includes(':')) {\n      const v = att.split(':');\n      attNS[v[1]] = NS[(v[0]).toUpperCase()];\n    } else {\n      attNS[att] = att === 'xmlns' ? NS.XMLNS : null;\n    }\n  });\n  svgWhiteListNS_[elt] = attNS;\n});\n\n/**\n* Sanitizes the input node and its children.\n* It only keeps what is allowed from our whitelist defined above.\n* @function module:sanitize.sanitizeSvg\n* @param {Text|Element} node - The DOM element to be checked (we'll also check its children) or text node to be cleaned up\n* @returns {undefined}\n*/\nexport const sanitizeSvg = function (node) {\n  // Cleanup text nodes\n  if (node.nodeType === 3) { // 3 === TEXT_NODE\n    // Trim whitespace\n    node.nodeValue = node.nodeValue.replace(/^\\s+|\\s+$/g, '');\n    // Remove if empty\n    if (!node.nodeValue.length) {\n      node.remove();\n    }\n  }\n\n  // We only care about element nodes.\n  // Automatically return for all non-element nodes, such as comments, etc.\n  if (node.nodeType !== 1) { // 1 == ELEMENT_NODE\n    return;\n  }\n\n  const doc = node.ownerDocument;\n  const parent = node.parentNode;\n  // can parent ever be null here?  I think the root node's parent is the document...\n  if (!doc || !parent) {\n    return;\n  }\n\n  const allowedAttrs = svgWhiteList_[node.nodeName];\n  const allowedAttrsNS = svgWhiteListNS_[node.nodeName];\n  // if this element is supported, sanitize it\n  if (typeof allowedAttrs !== 'undefined') {\n    const seAttrs = [];\n    let i = node.attributes.length;\n    while (i--) {\n      // if the attribute is not in our whitelist, then remove it\n      // could use jQuery's inArray(), but I don't know if that's any better\n      const attr = node.attributes.item(i);\n      const attrName = attr.nodeName;\n      const attrLocalName = attr.localName;\n      const attrNsURI = attr.namespaceURI;\n      // Check that an attribute with the correct localName in the correct namespace is on\n      // our whitelist or is a namespace declaration for one of our allowed namespaces\n      if (!(allowedAttrsNS.hasOwnProperty(attrLocalName) && attrNsURI === allowedAttrsNS[attrLocalName] && attrNsURI !== NS.XMLNS) &&\n        !(attrNsURI === NS.XMLNS && REVERSE_NS[attr.value])) {\n        // TODO(codedread): Programmatically add the se: attributes to the NS-aware whitelist.\n        // Bypassing the whitelist to allow se: prefixes.\n        // Is there a more appropriate way to do this?\n        if (attrName.startsWith('se:') || attrName.startsWith('data-')) {\n          seAttrs.push([attrName, attr.value]);\n        }\n        node.removeAttributeNS(attrNsURI, attrLocalName);\n      }\n\n      // Add spaces before negative signs where necessary\n      if (isGecko()) {\n        switch (attrName) {\n        case 'transform':\n        case 'gradientTransform':\n        case 'patternTransform':\n          const val = attr.value.replace(/(\\d)-/g, '$1 -');\n          node.setAttribute(attrName, val);\n          break;\n        }\n      }\n\n      // For the style attribute, rewrite it in terms of XML presentational attributes\n      if (attrName === 'style') {\n        const props = attr.value.split(';');\n        let p = props.length;\n        while (p--) {\n          const [name, val] = props[p].split(':');\n          const styleAttrName = (name || '').trim();\n          const styleAttrVal = (val || '').trim();\n          // Now check that this attribute is supported\n          if (allowedAttrs.includes(styleAttrName)) {\n            node.setAttribute(styleAttrName, styleAttrVal);\n          }\n        }\n        node.removeAttribute('style');\n      }\n    }\n\n    Object.values(seAttrs).forEach(([att, val]) => {\n      node.setAttributeNS(NS.SE, att, val);\n    });\n\n    // for some elements that have a xlink:href, ensure the URI refers to a local element\n    // (but not for links)\n    const href = getHref(node);\n    if (href &&\n      ['filter', 'linearGradient', 'pattern',\n        'radialGradient', 'textPath', 'use'].includes(node.nodeName)) {\n      // TODO: we simply check if the first character is a #, is this bullet-proof?\n      if (href[0] !== '#') {\n        // remove the attribute (but keep the element)\n        setHref(node, '');\n        node.removeAttributeNS(NS.XLINK, 'href');\n      }\n    }\n\n    // Safari crashes on a <use> without a xlink:href, so we just remove the node here\n    if (node.nodeName === 'use' && !getHref(node)) {\n      node.remove();\n      return;\n    }\n    // if the element has attributes pointing to a non-local reference,\n    // need to remove the attribute\n    Object.values(['clip-path', 'fill', 'filter', 'marker-end', 'marker-mid', 'marker-start', 'mask', 'stroke'], function (attr) {\n      let val = node.getAttribute(attr);\n      if (val) {\n        val = getUrlFromAttr(val);\n        // simply check for first character being a '#'\n        if (val && val[0] !== '#') {\n          node.setAttribute(attr, '');\n          node.removeAttribute(attr);\n        }\n      }\n    });\n\n    // recurse to children\n    i = node.childNodes.length;\n    while (i--) { sanitizeSvg(node.childNodes.item(i)); }\n  // else (element not supported), remove it\n  } else {\n    // remove all children from this node and insert them before this node\n    // FIXME: in the case of animation elements this will hardly ever be correct\n    const children = [];\n    while (node.hasChildNodes()) {\n      children.push(parent.insertBefore(node.firstChild, node));\n    }\n\n    // remove this node from the document altogether\n    node.remove();\n\n    // call sanitizeSvg on each of those children\n    let i = children.length;\n    while (i--) { sanitizeSvg(children[i]); }\n  }\n};\n","/* globals jQuery */\n/**\n * Manipulating coordinates\n * @module coords\n * @license MIT\n */\n\nimport './svgpathseg.js';\nimport {\n  snapToGrid, assignAttributes, getBBox, getRefElem, findDefs\n} from './utilities.js';\nimport {\n  transformPoint, transformListToTransform, matrixMultiply, transformBox\n} from './math.js';\nimport {getTransformList} from './svgtransformlist.js';\n\nconst $ = jQuery;\n\n// this is how we map paths to our preferred relative segment types\nconst pathMap = [0, 'z', 'M', 'm', 'L', 'l', 'C', 'c', 'Q', 'q', 'A', 'a',\n  'H', 'h', 'V', 'v', 'S', 's', 'T', 't'];\n\n/**\n * @interface module:coords.EditorContext\n */\n/**\n * @function module:coords.EditorContext#getGridSnapping\n * @returns {boolean}\n */\n/**\n * @function module:coords.EditorContext#getDrawing\n * @returns {module:draw.Drawing}\n*/\n/**\n * @function module:coords.EditorContext#getSVGRoot\n * @returns {SVGSVGElement}\n*/\n\nlet editorContext_ = null;\n\n/**\n* @function module:coords.init\n* @param {module:coords.EditorContext} editorContext\n*/\nexport const init = function (editorContext) {\n  editorContext_ = editorContext;\n};\n\n/**\n * Applies coordinate changes to an element based on the given matrix\n * @function module:coords.remapElement\n * @implements {module:path.EditorContext#remapElement}\n*/\nexport const remapElement = function (selected, changes, m) {\n  const remap = function (x, y) { return transformPoint(x, y, m); },\n    scalew = function (w) { return m.a * w; },\n    scaleh = function (h) { return m.d * h; },\n    doSnapping = editorContext_.getGridSnapping() && selected.parentNode.parentNode.localName === 'svg',\n    finishUp = function () {\n      if (doSnapping) {\n        for (const o in changes) {\n          changes[o] = snapToGrid(changes[o]);\n        }\n      }\n      assignAttributes(selected, changes, 1000, true);\n    },\n    box = getBBox(selected);\n\n  for (let i = 0; i < 2; i++) {\n    const type = i === 0 ? 'fill' : 'stroke';\n    const attrVal = selected.getAttribute(type);\n    if (attrVal && attrVal.startsWith('url(')) {\n      if (m.a < 0 || m.d < 0) {\n        const grad = getRefElem(attrVal);\n        const newgrad = grad.cloneNode(true);\n        if (m.a < 0) {\n          // flip x\n          const x1 = newgrad.getAttribute('x1');\n          const x2 = newgrad.getAttribute('x2');\n          newgrad.setAttribute('x1', -(x1 - 1));\n          newgrad.setAttribute('x2', -(x2 - 1));\n        }\n\n        if (m.d < 0) {\n          // flip y\n          const y1 = newgrad.getAttribute('y1');\n          const y2 = newgrad.getAttribute('y2');\n          newgrad.setAttribute('y1', -(y1 - 1));\n          newgrad.setAttribute('y2', -(y2 - 1));\n        }\n        newgrad.id = editorContext_.getDrawing().getNextId();\n        findDefs().append(newgrad);\n        selected.setAttribute(type, 'url(#' + newgrad.id + ')');\n      }\n\n      // Not really working :(\n      // if (selected.tagName === 'path') {\n      //   reorientGrads(selected, m);\n      // }\n    }\n  }\n\n  const elName = selected.tagName;\n  if (elName === 'g' || elName === 'text' || elName === 'tspan' || elName === 'use') {\n    // if it was a translate, then just update x,y\n    if (m.a === 1 && m.b === 0 && m.c === 0 && m.d === 1 && (m.e !== 0 || m.f !== 0)) {\n      // [T][M] = [M][T']\n      // therefore [T'] = [M_inv][T][M]\n      const existing = transformListToTransform(selected).matrix,\n        tNew = matrixMultiply(existing.inverse(), m, existing);\n      changes.x = parseFloat(changes.x) + tNew.e;\n      changes.y = parseFloat(changes.y) + tNew.f;\n    } else {\n      // we just absorb all matrices into the element and don't do any remapping\n      const chlist = getTransformList(selected);\n      const mt = editorContext_.getSVGRoot().createSVGTransform();\n      mt.setMatrix(matrixMultiply(transformListToTransform(chlist).matrix, m));\n      chlist.clear();\n      chlist.appendItem(mt);\n    }\n  }\n\n  // now we have a set of changes and an applied reduced transform list\n  // we apply the changes directly to the DOM\n  switch (elName) {\n  case 'foreignObject':\n  case 'rect':\n  // case 'svg':\n  case 'image': {\n    // Allow images to be inverted (give them matrix when flipped)\n    if (elName === 'image' && (m.a < 0 || m.d < 0)) {\n      // Convert to matrix\n      const chlist = getTransformList(selected);\n      const mt = editorContext_.getSVGRoot().createSVGTransform();\n      mt.setMatrix(matrixMultiply(transformListToTransform(chlist).matrix, m));\n      chlist.clear();\n      chlist.appendItem(mt);\n    } else {\n      const pt1 = remap(changes.x, changes.y);\n      changes.width = scalew(changes.width);\n      changes.height = scaleh(changes.height);\n      changes.x = pt1.x + Math.min(0, changes.width);\n      changes.y = pt1.y + Math.min(0, changes.height);\n      changes.width = Math.abs(changes.width);\n      changes.height = Math.abs(changes.height);\n    }\n    finishUp();\n    break;\n  } case 'ellipse': {\n    const c = remap(changes.cx, changes.cy);\n    changes.cx = c.x;\n    changes.cy = c.y;\n    changes.rx = scalew(changes.rx);\n    changes.ry = scaleh(changes.ry);\n    changes.rx = Math.abs(changes.rx);\n    changes.ry = Math.abs(changes.ry);\n    finishUp();\n    break;\n  } case 'circle': {\n    const c = remap(changes.cx, changes.cy);\n    changes.cx = c.x;\n    changes.cy = c.y;\n    // take the minimum of the new selected box's dimensions for the new circle radius\n    const tbox = transformBox(box.x, box.y, box.width, box.height, m);\n    const w = tbox.tr.x - tbox.tl.x, h = tbox.bl.y - tbox.tl.y;\n    changes.r = Math.min(w / 2, h / 2);\n\n    if (changes.r) { changes.r = Math.abs(changes.r); }\n    finishUp();\n    break;\n  } case 'line': {\n    const pt1 = remap(changes.x1, changes.y1);\n    const pt2 = remap(changes.x2, changes.y2);\n    changes.x1 = pt1.x;\n    changes.y1 = pt1.y;\n    changes.x2 = pt2.x;\n    changes.y2 = pt2.y;\n  } // Fallthrough\n  case 'text':\n  case 'tspan':\n  case 'use': {\n    finishUp();\n    break;\n  } case 'g': {\n    const gsvg = $(selected).data('gsvg');\n    if (gsvg) {\n      assignAttributes(gsvg, changes, 1000, true);\n    }\n    break;\n  } case 'polyline':\n  case 'polygon': {\n    const len = changes.points.length;\n    for (let i = 0; i < len; ++i) {\n      const pt = changes.points[i];\n      const {x, y} = remap(pt.x, pt.y);\n      changes.points[i].x = x;\n      changes.points[i].y = y;\n    }\n\n    // const len = changes.points.length;\n    let pstr = '';\n    for (let i = 0; i < len; ++i) {\n      const pt = changes.points[i];\n      pstr += pt.x + ',' + pt.y + ' ';\n    }\n    selected.setAttribute('points', pstr);\n    break;\n  } case 'path': {\n    const segList = selected.pathSegList;\n    let len = segList.numberOfItems;\n    changes.d = [];\n    for (let i = 0; i < len; ++i) {\n      const seg = segList.getItem(i);\n      changes.d[i] = {\n        type: seg.pathSegType,\n        x: seg.x,\n        y: seg.y,\n        x1: seg.x1,\n        y1: seg.y1,\n        x2: seg.x2,\n        y2: seg.y2,\n        r1: seg.r1,\n        r2: seg.r2,\n        angle: seg.angle,\n        largeArcFlag: seg.largeArcFlag,\n        sweepFlag: seg.sweepFlag\n      };\n    }\n\n    len = changes.d.length;\n    const firstseg = changes.d[0],\n      currentpt = remap(firstseg.x, firstseg.y);\n    changes.d[0].x = currentpt.x;\n    changes.d[0].y = currentpt.y;\n    for (let i = 1; i < len; ++i) {\n      const seg = changes.d[i];\n      const {type} = seg;\n      // if absolute or first segment, we want to remap x, y, x1, y1, x2, y2\n      // if relative, we want to scalew, scaleh\n      if (type % 2 === 0) { // absolute\n        const thisx = (seg.x !== undefined) ? seg.x : currentpt.x, // for V commands\n          thisy = (seg.y !== undefined) ? seg.y : currentpt.y; // for H commands\n        const pt = remap(thisx, thisy);\n        const pt1 = remap(seg.x1, seg.y1);\n        const pt2 = remap(seg.x2, seg.y2);\n        seg.x = pt.x;\n        seg.y = pt.y;\n        seg.x1 = pt1.x;\n        seg.y1 = pt1.y;\n        seg.x2 = pt2.x;\n        seg.y2 = pt2.y;\n        seg.r1 = scalew(seg.r1);\n        seg.r2 = scaleh(seg.r2);\n      } else { // relative\n        seg.x = scalew(seg.x);\n        seg.y = scaleh(seg.y);\n        seg.x1 = scalew(seg.x1);\n        seg.y1 = scaleh(seg.y1);\n        seg.x2 = scalew(seg.x2);\n        seg.y2 = scaleh(seg.y2);\n        seg.r1 = scalew(seg.r1);\n        seg.r2 = scaleh(seg.r2);\n      }\n    } // for each segment\n\n    let dstr = '';\n    len = changes.d.length;\n    for (let i = 0; i < len; ++i) {\n      const seg = changes.d[i];\n      const {type} = seg;\n      dstr += pathMap[type];\n      switch (type) {\n      case 13: // relative horizontal line (h)\n      case 12: // absolute horizontal line (H)\n        dstr += seg.x + ' ';\n        break;\n      case 15: // relative vertical line (v)\n      case 14: // absolute vertical line (V)\n        dstr += seg.y + ' ';\n        break;\n      case 3: // relative move (m)\n      case 5: // relative line (l)\n      case 19: // relative smooth quad (t)\n      case 2: // absolute move (M)\n      case 4: // absolute line (L)\n      case 18: // absolute smooth quad (T)\n        dstr += seg.x + ',' + seg.y + ' ';\n        break;\n      case 7: // relative cubic (c)\n      case 6: // absolute cubic (C)\n        dstr += seg.x1 + ',' + seg.y1 + ' ' + seg.x2 + ',' + seg.y2 + ' ' +\n          seg.x + ',' + seg.y + ' ';\n        break;\n      case 9: // relative quad (q)\n      case 8: // absolute quad (Q)\n        dstr += seg.x1 + ',' + seg.y1 + ' ' + seg.x + ',' + seg.y + ' ';\n        break;\n      case 11: // relative elliptical arc (a)\n      case 10: // absolute elliptical arc (A)\n        dstr += seg.r1 + ',' + seg.r2 + ' ' + seg.angle + ' ' + (+seg.largeArcFlag) +\n          ' ' + (+seg.sweepFlag) + ' ' + seg.x + ',' + seg.y + ' ';\n        break;\n      case 17: // relative smooth cubic (s)\n      case 16: // absolute smooth cubic (S)\n        dstr += seg.x2 + ',' + seg.y2 + ' ' + seg.x + ',' + seg.y + ' ';\n        break;\n      }\n    }\n\n    selected.setAttribute('d', dstr);\n    break;\n  }\n  }\n};\n","/* globals jQuery */\n/**\n * Recalculate.\n * @module recalculate\n * @license MIT\n */\n\nimport jqPluginSVG from './jQuery.attr.js'; // Needed for SVG attribute setting and array form with `attr`\nimport {NS} from './namespaces.js';\nimport {convertToNum} from './units.js';\nimport {isWebkit} from './browser.js';\nimport {getTransformList} from './svgtransformlist.js';\nimport {getRotationAngle, getHref, getBBox, getRefElem} from './utilities.js';\nimport {BatchCommand, ChangeElementCommand} from './history.js';\nimport {remapElement} from './coords.js';\nimport {\n  isIdentity, matrixMultiply, transformPoint, transformListToTransform,\n  hasMatrixTransform\n} from './math.js';\n\nconst $ = jqPluginSVG(jQuery);\n\nlet context_;\n\n/**\n* @interface module:recalculate.EditorContext\n*/\n/**\n * @function module:recalculate.EditorContext#getSVGRoot\n * @returns {SVGSVGElement} The root DOM element\n */\n/**\n * @function module:recalculate.EditorContext#getStartTransform\n * @returns {string}\n*/\n/**\n * @function module:recalculate.EditorContext#setStartTransform\n * @param {string} transform\n * @returns {undefined}\n */\n\n/**\n* @function module:recalculate.init\n* @param {module:recalculate.EditorContext} editorContext\n* @returns {undefined}\n*/\nexport const init = function (editorContext) {\n  context_ = editorContext;\n};\n\n/**\n* Updates a `<clipPath>`s values based on the given translation of an element\n* @function module:recalculate.updateClipPath\n* @param {string} attr - The clip-path attribute value with the clipPath's ID\n* @param {Float} tx - The translation's x value\n* @param {Float} ty - The translation's y value\n* @returns {undefined}\n*/\nexport const updateClipPath = function (attr, tx, ty) {\n  const path = getRefElem(attr).firstChild;\n  const cpXform = getTransformList(path);\n  const newxlate = context_.getSVGRoot().createSVGTransform();\n  newxlate.setTranslate(tx, ty);\n\n  cpXform.appendItem(newxlate);\n\n  // Update clipPath's dimensions\n  recalculateDimensions(path);\n};\n\n/**\n* Decides the course of action based on the element's transform list\n* @function module:recalculate.recalculateDimensions\n* @param {Element} selected - The DOM element to recalculate\n* @returns {Command} Undo command object with the resulting change\n*/\nexport const recalculateDimensions = function (selected) {\n  if (selected == null) { return null; }\n\n  // Firefox Issue - 1081\n  if (selected.nodeName === 'svg' && navigator.userAgent.includes('Firefox/20')) {\n    return null;\n  }\n\n  const svgroot = context_.getSVGRoot();\n  const tlist = getTransformList(selected);\n\n  // remove any unnecessary transforms\n  if (tlist && tlist.numberOfItems > 0) {\n    let k = tlist.numberOfItems;\n    const noi = k;\n    while (k--) {\n      const xform = tlist.getItem(k);\n      if (xform.type === 0) {\n        tlist.removeItem(k);\n      // remove identity matrices\n      } else if (xform.type === 1) {\n        if (isIdentity(xform.matrix)) {\n          if (noi === 1) {\n            // Overcome Chrome bug (though only when noi is 1) with\n            //    `removeItem` preventing `removeAttribute` from\n            //    subsequently working\n            // See https://bugs.chromium.org/p/chromium/issues/detail?id=843901\n            selected.removeAttribute('transform');\n            return null;\n          }\n          tlist.removeItem(k);\n        }\n      // remove zero-degree rotations\n      } else if (xform.type === 4) {\n        if (xform.angle === 0) {\n          tlist.removeItem(k);\n        }\n      }\n    }\n    // End here if all it has is a rotation\n    if (tlist.numberOfItems === 1 &&\n        getRotationAngle(selected)) { return null; }\n  }\n\n  // if this element had no transforms, we are done\n  if (!tlist || tlist.numberOfItems === 0) {\n    // Chrome apparently had a bug that requires clearing the attribute first.\n    selected.setAttribute('transform', '');\n    // However, this still next line currently doesn't work at all in Chrome\n    selected.removeAttribute('transform');\n    // selected.transform.baseVal.clear(); // Didn't help for Chrome bug\n    return null;\n  }\n\n  // TODO: Make this work for more than 2\n  if (tlist) {\n    let mxs = [];\n    let k = tlist.numberOfItems;\n    while (k--) {\n      const xform = tlist.getItem(k);\n      if (xform.type === 1) {\n        mxs.push([xform.matrix, k]);\n      } else if (mxs.length) {\n        mxs = [];\n      }\n    }\n    if (mxs.length === 2) {\n      const mNew = svgroot.createSVGTransformFromMatrix(matrixMultiply(mxs[1][0], mxs[0][0]));\n      tlist.removeItem(mxs[0][1]);\n      tlist.removeItem(mxs[1][1]);\n      tlist.insertItemBefore(mNew, mxs[1][1]);\n    }\n\n    // combine matrix + translate\n    k = tlist.numberOfItems;\n    if (k >= 2 && tlist.getItem(k - 2).type === 1 && tlist.getItem(k - 1).type === 2) {\n      const mt = svgroot.createSVGTransform();\n\n      const m = matrixMultiply(\n        tlist.getItem(k - 2).matrix,\n        tlist.getItem(k - 1).matrix);\n      mt.setMatrix(m);\n      tlist.removeItem(k - 2);\n      tlist.removeItem(k - 2);\n      tlist.appendItem(mt);\n    }\n  }\n\n  // If it still has a single [M] or [R][M], return null too (prevents BatchCommand from being returned).\n  switch (selected.tagName) {\n  // Ignore these elements, as they can absorb the [M]\n  case 'line':\n  case 'polyline':\n  case 'polygon':\n  case 'path':\n    break;\n  default:\n    if ((tlist.numberOfItems === 1 && tlist.getItem(0).type === 1) ||\n        (tlist.numberOfItems === 2 && tlist.getItem(0).type === 1 && tlist.getItem(0).type === 4)) {\n      return null;\n    }\n  }\n\n  // Grouped SVG element\n  const gsvg = $(selected).data('gsvg');\n\n  // we know we have some transforms, so set up return variable\n  const batchCmd = new BatchCommand('Transform');\n\n  // store initial values that will be affected by reducing the transform list\n  let changes = {};\n  let initial = null;\n  let attrs = [];\n  switch (selected.tagName) {\n  case 'line':\n    attrs = ['x1', 'y1', 'x2', 'y2'];\n    break;\n  case 'circle':\n    attrs = ['cx', 'cy', 'r'];\n    break;\n  case 'ellipse':\n    attrs = ['cx', 'cy', 'rx', 'ry'];\n    break;\n  case 'foreignObject':\n  case 'rect':\n  // case 'svg':\n  case 'image':\n    attrs = ['width', 'height', 'x', 'y'];\n    break;\n  case 'use':\n  case 'text':\n  case 'tspan':\n    attrs = ['x', 'y'];\n    break;\n  case 'polygon':\n  case 'polyline': {\n    initial = {};\n    initial.points = selected.getAttribute('points');\n    const list = selected.points;\n    const len = list.numberOfItems;\n    changes.points = new Array(len);\n    for (let i = 0; i < len; ++i) {\n      const pt = list.getItem(i);\n      changes.points[i] = {x: pt.x, y: pt.y};\n    }\n    break;\n  } case 'path':\n    initial = {};\n    initial.d = selected.getAttribute('d');\n    changes.d = selected.getAttribute('d');\n    break;\n  } // switch on element type to get initial values\n\n  if (attrs.length) {\n    changes = $(selected).attr(attrs);\n    $.each(changes, function (attr, val) {\n      changes[attr] = convertToNum(attr, val);\n    });\n  } else if (gsvg) {\n    // GSVG exception\n    changes = {\n      x: $(gsvg).attr('x') || 0,\n      y: $(gsvg).attr('y') || 0\n    };\n  }\n\n  // if we haven't created an initial array in polygon/polyline/path, then\n  // make a copy of initial values and include the transform\n  if (initial == null) {\n    initial = $.extend(true, {}, changes);\n    $.each(initial, function (attr, val) {\n      initial[attr] = convertToNum(attr, val);\n    });\n  }\n  // save the start transform value too\n  initial.transform = context_.getStartTransform() || '';\n\n  let oldcenter, newcenter;\n\n  // if it's a regular group, we have special processing to flatten transforms\n  if ((selected.tagName === 'g' && !gsvg) || selected.tagName === 'a') {\n    const box = getBBox(selected);\n\n    oldcenter = {x: box.x + box.width / 2, y: box.y + box.height / 2};\n    newcenter = transformPoint(\n      box.x + box.width / 2,\n      box.y + box.height / 2,\n      transformListToTransform(tlist).matrix\n    );\n    let m = svgroot.createSVGMatrix();\n\n    // temporarily strip off the rotate and save the old center\n    const gangle = getRotationAngle(selected);\n    if (gangle) {\n      const a = gangle * Math.PI / 180;\n      let s;\n      if (Math.abs(a) > (1.0e-10)) {\n        s = Math.sin(a) / (1 - Math.cos(a));\n      } else {\n        // FIXME: This blows up if the angle is exactly 0!\n        s = 2 / a;\n      }\n      for (let i = 0; i < tlist.numberOfItems; ++i) {\n        const xform = tlist.getItem(i);\n        if (xform.type === 4) {\n          // extract old center through mystical arts\n          const rm = xform.matrix;\n          oldcenter.y = (s * rm.e + rm.f) / 2;\n          oldcenter.x = (rm.e - s * rm.f) / 2;\n          tlist.removeItem(i);\n          break;\n        }\n      }\n    }\n    const N = tlist.numberOfItems;\n    let tx = 0, ty = 0, operation = 0;\n\n    let firstM;\n    if (N) {\n      firstM = tlist.getItem(0).matrix;\n    }\n\n    let oldStartTransform;\n    // first, if it was a scale then the second-last transform will be it\n    if (N >= 3 && tlist.getItem(N - 2).type === 3 &&\n      tlist.getItem(N - 3).type === 2 && tlist.getItem(N - 1).type === 2) {\n      operation = 3; // scale\n\n      // if the children are unrotated, pass the scale down directly\n      // otherwise pass the equivalent matrix() down directly\n      const tm = tlist.getItem(N - 3).matrix,\n        sm = tlist.getItem(N - 2).matrix,\n        tmn = tlist.getItem(N - 1).matrix;\n\n      const children = selected.childNodes;\n      let c = children.length;\n      while (c--) {\n        const child = children.item(c);\n        tx = 0;\n        ty = 0;\n        if (child.nodeType === 1) {\n          const childTlist = getTransformList(child);\n\n          // some children might not have a transform (<metadata>, <defs>, etc)\n          if (!childTlist) { continue; }\n\n          const m = transformListToTransform(childTlist).matrix;\n\n          // Convert a matrix to a scale if applicable\n          // if (hasMatrixTransform(childTlist) && childTlist.numberOfItems == 1) {\n          //   if (m.b==0 && m.c==0 && m.e==0 && m.f==0) {\n          //     childTlist.removeItem(0);\n          //     const translateOrigin = svgroot.createSVGTransform(),\n          //       scale = svgroot.createSVGTransform(),\n          //       translateBack = svgroot.createSVGTransform();\n          //     translateOrigin.setTranslate(0, 0);\n          //     scale.setScale(m.a, m.d);\n          //     translateBack.setTranslate(0, 0);\n          //     childTlist.appendItem(translateBack);\n          //     childTlist.appendItem(scale);\n          //     childTlist.appendItem(translateOrigin);\n          //   }\n          // }\n\n          const angle = getRotationAngle(child);\n          oldStartTransform = context_.getStartTransform();\n          const childxforms = [];\n          context_.setStartTransform(child.getAttribute('transform'));\n          if (angle || hasMatrixTransform(childTlist)) {\n            const e2t = svgroot.createSVGTransform();\n            e2t.setMatrix(matrixMultiply(tm, sm, tmn, m));\n            childTlist.clear();\n            childTlist.appendItem(e2t);\n            childxforms.push(e2t);\n          // if not rotated or skewed, push the [T][S][-T] down to the child\n          } else {\n            // update the transform list with translate,scale,translate\n\n            // slide the [T][S][-T] from the front to the back\n            // [T][S][-T][M] = [M][T2][S2][-T2]\n\n            // (only bringing [-T] to the right of [M])\n            // [T][S][-T][M] = [T][S][M][-T2]\n            // [-T2] = [M_inv][-T][M]\n            const t2n = matrixMultiply(m.inverse(), tmn, m);\n            // [T2] is always negative translation of [-T2]\n            const t2 = svgroot.createSVGMatrix();\n            t2.e = -t2n.e;\n            t2.f = -t2n.f;\n\n            // [T][S][-T][M] = [M][T2][S2][-T2]\n            // [S2] = [T2_inv][M_inv][T][S][-T][M][-T2_inv]\n            const s2 = matrixMultiply(t2.inverse(), m.inverse(), tm, sm, tmn, m, t2n.inverse());\n\n            const translateOrigin = svgroot.createSVGTransform(),\n              scale = svgroot.createSVGTransform(),\n              translateBack = svgroot.createSVGTransform();\n            translateOrigin.setTranslate(t2n.e, t2n.f);\n            scale.setScale(s2.a, s2.d);\n            translateBack.setTranslate(t2.e, t2.f);\n            childTlist.appendItem(translateBack);\n            childTlist.appendItem(scale);\n            childTlist.appendItem(translateOrigin);\n            childxforms.push(translateBack);\n            childxforms.push(scale);\n            childxforms.push(translateOrigin);\n            // logMatrix(translateBack.matrix);\n            // logMatrix(scale.matrix);\n          } // not rotated\n          batchCmd.addSubCommand(recalculateDimensions(child));\n          // TODO: If any <use> have this group as a parent and are\n          // referencing this child, then we need to impose a reverse\n          // scale on it so that when it won't get double-translated\n          // const uses = selected.getElementsByTagNameNS(NS.SVG, 'use');\n          // const href = '#' + child.id;\n          // let u = uses.length;\n          // while (u--) {\n          //   const useElem = uses.item(u);\n          //   if (href == getHref(useElem)) {\n          //     const usexlate = svgroot.createSVGTransform();\n          //     usexlate.setTranslate(-tx,-ty);\n          //     getTransformList(useElem).insertItemBefore(usexlate,0);\n          //     batchCmd.addSubCommand( recalculateDimensions(useElem) );\n          //   }\n          // }\n          context_.setStartTransform(oldStartTransform);\n        } // element\n      } // for each child\n      // Remove these transforms from group\n      tlist.removeItem(N - 1);\n      tlist.removeItem(N - 2);\n      tlist.removeItem(N - 3);\n    } else if (N >= 3 && tlist.getItem(N - 1).type === 1) {\n      operation = 3; // scale\n      m = transformListToTransform(tlist).matrix;\n      const e2t = svgroot.createSVGTransform();\n      e2t.setMatrix(m);\n      tlist.clear();\n      tlist.appendItem(e2t);\n    // next, check if the first transform was a translate\n    // if we had [ T1 ] [ M ] we want to transform this into [ M ] [ T2 ]\n    // therefore [ T2 ] = [ M_inv ] [ T1 ] [ M ]\n    } else if ((N === 1 || (N > 1 && tlist.getItem(1).type !== 3)) &&\n      tlist.getItem(0).type === 2) {\n      operation = 2; // translate\n      const T_M = transformListToTransform(tlist).matrix;\n      tlist.removeItem(0);\n      const mInv = transformListToTransform(tlist).matrix.inverse();\n      const M2 = matrixMultiply(mInv, T_M);\n\n      tx = M2.e;\n      ty = M2.f;\n\n      if (tx !== 0 || ty !== 0) {\n        // we pass the translates down to the individual children\n        const children = selected.childNodes;\n        let c = children.length;\n\n        let clipPathsDone = [];\n\n        while (c--) {\n          const child = children.item(c);\n          if (child.nodeType === 1) {\n            // Check if child has clip-path\n            if (child.getAttribute('clip-path')) {\n              // tx, ty\n              const attr = child.getAttribute('clip-path');\n              if (!clipPathsDone.includes(attr)) {\n                updateClipPath(attr, tx, ty);\n                clipPathsDone.push(attr);\n              }\n            }\n\n            oldStartTransform = context_.getStartTransform();\n            context_.setStartTransform(child.getAttribute('transform'));\n\n            const childTlist = getTransformList(child);\n            // some children might not have a transform (<metadata>, <defs>, etc)\n            if (childTlist) {\n              const newxlate = svgroot.createSVGTransform();\n              newxlate.setTranslate(tx, ty);\n              if (childTlist.numberOfItems) {\n                childTlist.insertItemBefore(newxlate, 0);\n              } else {\n                childTlist.appendItem(newxlate);\n              }\n              batchCmd.addSubCommand(recalculateDimensions(child));\n              // If any <use> have this group as a parent and are\n              // referencing this child, then impose a reverse translate on it\n              // so that when it won't get double-translated\n              const uses = selected.getElementsByTagNameNS(NS.SVG, 'use');\n              const href = '#' + child.id;\n              let u = uses.length;\n              while (u--) {\n                const useElem = uses.item(u);\n                if (href === getHref(useElem)) {\n                  const usexlate = svgroot.createSVGTransform();\n                  usexlate.setTranslate(-tx, -ty);\n                  getTransformList(useElem).insertItemBefore(usexlate, 0);\n                  batchCmd.addSubCommand(recalculateDimensions(useElem));\n                }\n              }\n              context_.setStartTransform(oldStartTransform);\n            }\n          }\n        }\n\n        clipPathsDone = [];\n        context_.setStartTransform(oldStartTransform);\n      }\n    // else, a matrix imposition from a parent group\n    // keep pushing it down to the children\n    } else if (N === 1 && tlist.getItem(0).type === 1 && !gangle) {\n      operation = 1;\n      const m = tlist.getItem(0).matrix,\n        children = selected.childNodes;\n      let c = children.length;\n      while (c--) {\n        const child = children.item(c);\n        if (child.nodeType === 1) {\n          oldStartTransform = context_.getStartTransform();\n          context_.setStartTransform(child.getAttribute('transform'));\n          const childTlist = getTransformList(child);\n\n          if (!childTlist) { continue; }\n\n          const em = matrixMultiply(m, transformListToTransform(childTlist).matrix);\n          const e2m = svgroot.createSVGTransform();\n          e2m.setMatrix(em);\n          childTlist.clear();\n          childTlist.appendItem(e2m, 0);\n\n          batchCmd.addSubCommand(recalculateDimensions(child));\n          context_.setStartTransform(oldStartTransform);\n\n          // Convert stroke\n          // TODO: Find out if this should actually happen somewhere else\n          const sw = child.getAttribute('stroke-width');\n          if (child.getAttribute('stroke') !== 'none' && !isNaN(sw)) {\n            const avg = (Math.abs(em.a) + Math.abs(em.d)) / 2;\n            child.setAttribute('stroke-width', sw * avg);\n          }\n        }\n      }\n      tlist.clear();\n    // else it was just a rotate\n    } else {\n      if (gangle) {\n        const newRot = svgroot.createSVGTransform();\n        newRot.setRotate(gangle, newcenter.x, newcenter.y);\n        if (tlist.numberOfItems) {\n          tlist.insertItemBefore(newRot, 0);\n        } else {\n          tlist.appendItem(newRot);\n        }\n      }\n      if (tlist.numberOfItems === 0) {\n        selected.removeAttribute('transform');\n      }\n      return null;\n    }\n\n    // if it was a translate, put back the rotate at the new center\n    if (operation === 2) {\n      if (gangle) {\n        newcenter = {\n          x: oldcenter.x + firstM.e,\n          y: oldcenter.y + firstM.f\n        };\n\n        const newRot = svgroot.createSVGTransform();\n        newRot.setRotate(gangle, newcenter.x, newcenter.y);\n        if (tlist.numberOfItems) {\n          tlist.insertItemBefore(newRot, 0);\n        } else {\n          tlist.appendItem(newRot);\n        }\n      }\n    // if it was a resize\n    } else if (operation === 3) {\n      const m = transformListToTransform(tlist).matrix;\n      const roldt = svgroot.createSVGTransform();\n      roldt.setRotate(gangle, oldcenter.x, oldcenter.y);\n      const rold = roldt.matrix;\n      const rnew = svgroot.createSVGTransform();\n      rnew.setRotate(gangle, newcenter.x, newcenter.y);\n      const rnewInv = rnew.matrix.inverse(),\n        mInv = m.inverse(),\n        extrat = matrixMultiply(mInv, rnewInv, rold, m);\n\n      tx = extrat.e;\n      ty = extrat.f;\n\n      if (tx !== 0 || ty !== 0) {\n        // now push this transform down to the children\n        // we pass the translates down to the individual children\n        const children = selected.childNodes;\n        let c = children.length;\n        while (c--) {\n          const child = children.item(c);\n          if (child.nodeType === 1) {\n            oldStartTransform = context_.getStartTransform();\n            context_.setStartTransform(child.getAttribute('transform'));\n            const childTlist = getTransformList(child);\n            const newxlate = svgroot.createSVGTransform();\n            newxlate.setTranslate(tx, ty);\n            if (childTlist.numberOfItems) {\n              childTlist.insertItemBefore(newxlate, 0);\n            } else {\n              childTlist.appendItem(newxlate);\n            }\n\n            batchCmd.addSubCommand(recalculateDimensions(child));\n            context_.setStartTransform(oldStartTransform);\n          }\n        }\n      }\n\n      if (gangle) {\n        if (tlist.numberOfItems) {\n          tlist.insertItemBefore(rnew, 0);\n        } else {\n          tlist.appendItem(rnew);\n        }\n      }\n    }\n  // else, it's a non-group\n  } else {\n    // FIXME: box might be null for some elements (<metadata> etc), need to handle this\n    const box = getBBox(selected);\n\n    // Paths (and possbly other shapes) will have no BBox while still in <defs>,\n    // but we still may need to recalculate them (see issue 595).\n    // TODO: Figure out how to get BBox from these elements in case they\n    // have a rotation transform\n\n    if (!box && selected.tagName !== 'path') return null;\n\n    let m = svgroot.createSVGMatrix();\n    // temporarily strip off the rotate and save the old center\n    const angle = getRotationAngle(selected);\n    if (angle) {\n      oldcenter = {x: box.x + box.width / 2, y: box.y + box.height / 2};\n      newcenter = transformPoint(\n        box.x + box.width / 2,\n        box.y + box.height / 2,\n        transformListToTransform(tlist).matrix\n      );\n\n      const a = angle * Math.PI / 180;\n      const s = (Math.abs(a) > (1.0e-10))\n        ? Math.sin(a) / (1 - Math.cos(a))\n        // FIXME: This blows up if the angle is exactly 0!\n        : 2 / a;\n\n      for (let i = 0; i < tlist.numberOfItems; ++i) {\n        const xform = tlist.getItem(i);\n        if (xform.type === 4) {\n          // extract old center through mystical arts\n          const rm = xform.matrix;\n          oldcenter.y = (s * rm.e + rm.f) / 2;\n          oldcenter.x = (rm.e - s * rm.f) / 2;\n          tlist.removeItem(i);\n          break;\n        }\n      }\n    }\n\n    // 2 = translate, 3 = scale, 4 = rotate, 1 = matrix imposition\n    let operation = 0;\n    const N = tlist.numberOfItems;\n\n    // Check if it has a gradient with userSpaceOnUse, in which case\n    // adjust it by recalculating the matrix transform.\n    // TODO: Make this work in Webkit using transformlist.SVGTransformList\n    if (!isWebkit()) {\n      const fill = selected.getAttribute('fill');\n      if (fill && fill.startsWith('url(')) {\n        const paint = getRefElem(fill);\n        let type = 'pattern';\n        if (paint.tagName !== type) type = 'gradient';\n        const attrVal = paint.getAttribute(type + 'Units');\n        if (attrVal === 'userSpaceOnUse') {\n          // Update the userSpaceOnUse element\n          m = transformListToTransform(tlist).matrix;\n          const gtlist = getTransformList(paint);\n          const gmatrix = transformListToTransform(gtlist).matrix;\n          m = matrixMultiply(m, gmatrix);\n          const mStr = 'matrix(' + [m.a, m.b, m.c, m.d, m.e, m.f].join(',') + ')';\n          paint.setAttribute(type + 'Transform', mStr);\n        }\n      }\n    }\n\n    // first, if it was a scale of a non-skewed element, then the second-last\n    // transform will be the [S]\n    // if we had [M][T][S][T] we want to extract the matrix equivalent of\n    // [T][S][T] and push it down to the element\n    if (N >= 3 && tlist.getItem(N - 2).type === 3 &&\n      tlist.getItem(N - 3).type === 2 && tlist.getItem(N - 1).type === 2) {\n      // Removed this so a <use> with a given [T][S][T] would convert to a matrix.\n      // Is that bad?\n      //  && selected.nodeName != 'use'\n      operation = 3; // scale\n      m = transformListToTransform(tlist, N - 3, N - 1).matrix;\n      tlist.removeItem(N - 1);\n      tlist.removeItem(N - 2);\n      tlist.removeItem(N - 3);\n    // if we had [T][S][-T][M], then this was a skewed element being resized\n    // Thus, we simply combine it all into one matrix\n    } else if (N === 4 && tlist.getItem(N - 1).type === 1) {\n      operation = 3; // scale\n      m = transformListToTransform(tlist).matrix;\n      const e2t = svgroot.createSVGTransform();\n      e2t.setMatrix(m);\n      tlist.clear();\n      tlist.appendItem(e2t);\n      // reset the matrix so that the element is not re-mapped\n      m = svgroot.createSVGMatrix();\n    // if we had [R][T][S][-T][M], then this was a rotated matrix-element\n    // if we had [T1][M] we want to transform this into [M][T2]\n    // therefore [ T2 ] = [ M_inv ] [ T1 ] [ M ] and we can push [T2]\n    // down to the element\n    } else if ((N === 1 || (N > 1 && tlist.getItem(1).type !== 3)) &&\n      tlist.getItem(0).type === 2) {\n      operation = 2; // translate\n      const oldxlate = tlist.getItem(0).matrix,\n        meq = transformListToTransform(tlist, 1).matrix,\n        meqInv = meq.inverse();\n      m = matrixMultiply(meqInv, oldxlate, meq);\n      tlist.removeItem(0);\n    // else if this child now has a matrix imposition (from a parent group)\n    // we might be able to simplify\n    } else if (N === 1 && tlist.getItem(0).type === 1 && !angle) {\n      // Remap all point-based elements\n      m = transformListToTransform(tlist).matrix;\n      switch (selected.tagName) {\n      case 'line':\n        changes = $(selected).attr(['x1', 'y1', 'x2', 'y2']);\n        // Fallthrough\n      case 'polyline':\n      case 'polygon':\n        changes.points = selected.getAttribute('points');\n        if (changes.points) {\n          const list = selected.points;\n          const len = list.numberOfItems;\n          changes.points = new Array(len);\n          for (let i = 0; i < len; ++i) {\n            const pt = list.getItem(i);\n            changes.points[i] = {x: pt.x, y: pt.y};\n          }\n        }\n        // Fallthrough\n      case 'path':\n        changes.d = selected.getAttribute('d');\n        operation = 1;\n        tlist.clear();\n        break;\n      default:\n        break;\n      }\n    // if it was a rotation, put the rotate back and return without a command\n    // (this function has zero work to do for a rotate())\n    } else {\n      operation = 4; // rotation\n      if (angle) {\n        const newRot = svgroot.createSVGTransform();\n        newRot.setRotate(angle, newcenter.x, newcenter.y);\n\n        if (tlist.numberOfItems) {\n          tlist.insertItemBefore(newRot, 0);\n        } else {\n          tlist.appendItem(newRot);\n        }\n      }\n      if (tlist.numberOfItems === 0) {\n        selected.removeAttribute('transform');\n      }\n      return null;\n    }\n\n    // if it was a translate or resize, we need to remap the element and absorb the xform\n    if (operation === 1 || operation === 2 || operation === 3) {\n      remapElement(selected, changes, m);\n    } // if we are remapping\n\n    // if it was a translate, put back the rotate at the new center\n    if (operation === 2) {\n      if (angle) {\n        if (!hasMatrixTransform(tlist)) {\n          newcenter = {\n            x: oldcenter.x + m.e,\n            y: oldcenter.y + m.f\n          };\n        }\n        const newRot = svgroot.createSVGTransform();\n        newRot.setRotate(angle, newcenter.x, newcenter.y);\n        if (tlist.numberOfItems) {\n          tlist.insertItemBefore(newRot, 0);\n        } else {\n          tlist.appendItem(newRot);\n        }\n      }\n      // We have special processing for tspans:  Tspans are not transformable\n      // but they can have x,y coordinates (sigh).  Thus, if this was a translate,\n      // on a text element, also translate any tspan children.\n      if (selected.tagName === 'text') {\n        const children = selected.childNodes;\n        let c = children.length;\n        while (c--) {\n          const child = children.item(c);\n          if (child.tagName === 'tspan') {\n            const tspanChanges = {\n              x: $(child).attr('x') || 0,\n              y: $(child).attr('y') || 0\n            };\n            remapElement(child, tspanChanges, m);\n          }\n        }\n      }\n    // [Rold][M][T][S][-T] became [Rold][M]\n    // we want it to be [Rnew][M][Tr] where Tr is the\n    // translation required to re-center it\n    // Therefore, [Tr] = [M_inv][Rnew_inv][Rold][M]\n    } else if (operation === 3 && angle) {\n      const m = transformListToTransform(tlist).matrix;\n      const roldt = svgroot.createSVGTransform();\n      roldt.setRotate(angle, oldcenter.x, oldcenter.y);\n      const rold = roldt.matrix;\n      const rnew = svgroot.createSVGTransform();\n      rnew.setRotate(angle, newcenter.x, newcenter.y);\n      const rnewInv = rnew.matrix.inverse();\n      const mInv = m.inverse();\n      const extrat = matrixMultiply(mInv, rnewInv, rold, m);\n\n      remapElement(selected, changes, extrat);\n      if (angle) {\n        if (tlist.numberOfItems) {\n          tlist.insertItemBefore(rnew, 0);\n        } else {\n          tlist.appendItem(rnew);\n        }\n      }\n    }\n  } // a non-group\n\n  // if the transform list has been emptied, remove it\n  if (tlist.numberOfItems === 0) {\n    selected.removeAttribute('transform');\n  }\n\n  batchCmd.addSubCommand(new ChangeElementCommand(selected, initial));\n\n  return batchCmd;\n};\n","/* globals jQuery */\n/**\n * DOM element selection box tools\n * @module select\n * @license MIT\n *\n * @copyright 2010 Alexis Deveria, 2010 Jeff Schiller\n */\n\nimport {isTouch, isWebkit} from './browser.js'; // , isOpera\nimport {getRotationAngle, getBBox, getStrokedBBox} from './utilities.js';\nimport {transformListToTransform, transformBox, transformPoint} from './math.js';\nimport {getTransformList} from './svgtransformlist.js';\n\nconst $ = jQuery;\n\nlet svgFactory_;\nlet config_;\nlet selectorManager_; // A Singleton\nconst gripRadius = isTouch() ? 10 : 4;\n\n/**\n* Private class for DOM element selection boxes\n*/\nexport class Selector {\n  /**\n  * @param {Integer} id - Internally identify the selector\n  * @param {Element} elem - DOM element associated with this selector\n  * @param {module:utilities.BBoxObject} [bbox] - Optional bbox to use for initialization (prevents duplicate `getBBox` call).\n  */\n  constructor (id, elem, bbox) {\n    // this is the selector's unique number\n    this.id = id;\n\n    // this holds a reference to the element for which this selector is being used\n    this.selectedElement = elem;\n\n    // this is a flag used internally to track whether the selector is being used or not\n    this.locked = true;\n\n    // this holds a reference to the <g> element that holds all visual elements of the selector\n    this.selectorGroup = svgFactory_.createSVGElement({\n      element: 'g',\n      attr: {id: ('selectorGroup' + this.id)}\n    });\n\n    // this holds a reference to the path rect\n    this.selectorRect = this.selectorGroup.appendChild(\n      svgFactory_.createSVGElement({\n        element: 'path',\n        attr: {\n          id: ('selectedBox' + this.id),\n          fill: 'none',\n          stroke: '#22C',\n          'stroke-width': '1',\n          'stroke-dasharray': '5,5',\n          // need to specify this so that the rect is not selectable\n          style: 'pointer-events:none'\n        }\n      })\n    );\n\n    // this holds a reference to the grip coordinates for this selector\n    this.gripCoords = {\n      nw: null,\n      n: null,\n      ne: null,\n      e: null,\n      se: null,\n      s: null,\n      sw: null,\n      w: null\n    };\n\n    this.reset(this.selectedElement, bbox);\n  }\n\n  /**\n  * Used to reset the id and element that the selector is attached to\n  * @param {Element} e - DOM element associated with this selector\n  * @param {module:utilities.BBoxObject} bbox - Optional bbox to use for reset (prevents duplicate getBBox call).\n  */\n  reset (e, bbox) {\n    this.locked = true;\n    this.selectedElement = e;\n    this.resize(bbox);\n    this.selectorGroup.setAttribute('display', 'inline');\n  }\n\n  /**\n  * Updates cursors for corner grips on rotation so arrows point the right way\n  * @param {Float} angle - Current rotation angle in degrees\n  */\n  updateGripCursors (angle) {\n    let dir;\n    const dirArr = [];\n    let steps = Math.round(angle / 45);\n    if (steps < 0) { steps += 8; }\n    for (dir in selectorManager_.selectorGrips) {\n      dirArr.push(dir);\n    }\n    while (steps > 0) {\n      dirArr.push(dirArr.shift());\n      steps--;\n    }\n    let i = 0;\n    for (dir in selectorManager_.selectorGrips) {\n      selectorManager_.selectorGrips[dir].setAttribute('style', ('cursor:' + dirArr[i] + '-resize'));\n      i++;\n    }\n  }\n\n  /**\n  * Show the resize grips of this selector\n  *\n  * @param {boolean} show - Indicates whether grips should be shown or not\n  */\n  showGrips (show) {\n    const bShow = show ? 'inline' : 'none';\n    selectorManager_.selectorGripsGroup.setAttribute('display', bShow);\n    const elem = this.selectedElement;\n    this.hasGrips = show;\n    if (elem && show) {\n      this.selectorGroup.append(selectorManager_.selectorGripsGroup);\n      this.updateGripCursors(getRotationAngle(elem));\n    }\n  }\n\n  /**\n  * Updates the selector to match the element's size\n  * @param {module:utilities.BBoxObject} [bbox] - BBox to use for resize (prevents duplicate getBBox call).\n  */\n  resize (bbox) {\n    const selectedBox = this.selectorRect,\n      mgr = selectorManager_,\n      selectedGrips = mgr.selectorGrips,\n      selected = this.selectedElement,\n      sw = selected.getAttribute('stroke-width'),\n      currentZoom = svgFactory_.getCurrentZoom();\n    let offset = 1 / currentZoom;\n    if (selected.getAttribute('stroke') !== 'none' && !isNaN(sw)) {\n      offset += (sw / 2);\n    }\n\n    const {tagName} = selected;\n    if (tagName === 'text') {\n      offset += 2 / currentZoom;\n    }\n\n    // loop and transform our bounding box until we reach our first rotation\n    const tlist = getTransformList(selected);\n    const m = transformListToTransform(tlist).matrix;\n\n    // This should probably be handled somewhere else, but for now\n    // it keeps the selection box correctly positioned when zoomed\n    m.e *= currentZoom;\n    m.f *= currentZoom;\n\n    if (!bbox) {\n      bbox = getBBox(selected);\n    }\n    // TODO: getBBox (previous line) already knows to call getStrokedBBox when tagName === 'g'. Remove this?\n    // TODO: getBBox doesn't exclude 'gsvg' and calls getStrokedBBox for any 'g'. Should getBBox be updated?\n    if (tagName === 'g' && !$.data(selected, 'gsvg')) {\n      // The bbox for a group does not include stroke vals, so we\n      // get the bbox based on its children.\n      const strokedBbox = getStrokedBBox([selected.childNodes]);\n      if (strokedBbox) {\n        bbox = strokedBbox;\n      }\n    }\n\n    // apply the transforms\n    const l = bbox.x, t = bbox.y, w = bbox.width, h = bbox.height;\n    bbox = {x: l, y: t, width: w, height: h};\n\n    // we need to handle temporary transforms too\n    // if skewed, get its transformed box, then find its axis-aligned bbox\n\n    // *\n    offset *= currentZoom;\n\n    const nbox = transformBox(l * currentZoom, t * currentZoom, w * currentZoom, h * currentZoom, m),\n      {aabox} = nbox;\n    let nbax = aabox.x - offset,\n      nbay = aabox.y - offset,\n      nbaw = aabox.width + (offset * 2),\n      nbah = aabox.height + (offset * 2);\n\n    // now if the shape is rotated, un-rotate it\n    const cx = nbax + nbaw / 2,\n      cy = nbay + nbah / 2;\n\n    const angle = getRotationAngle(selected);\n    if (angle) {\n      const rot = svgFactory_.svgRoot().createSVGTransform();\n      rot.setRotate(-angle, cx, cy);\n      const rotm = rot.matrix;\n      nbox.tl = transformPoint(nbox.tl.x, nbox.tl.y, rotm);\n      nbox.tr = transformPoint(nbox.tr.x, nbox.tr.y, rotm);\n      nbox.bl = transformPoint(nbox.bl.x, nbox.bl.y, rotm);\n      nbox.br = transformPoint(nbox.br.x, nbox.br.y, rotm);\n\n      // calculate the axis-aligned bbox\n      const {tl} = nbox;\n      let minx = tl.x,\n        miny = tl.y,\n        maxx = tl.x,\n        maxy = tl.y;\n\n      const {min, max} = Math;\n\n      minx = min(minx, min(nbox.tr.x, min(nbox.bl.x, nbox.br.x))) - offset;\n      miny = min(miny, min(nbox.tr.y, min(nbox.bl.y, nbox.br.y))) - offset;\n      maxx = max(maxx, max(nbox.tr.x, max(nbox.bl.x, nbox.br.x))) + offset;\n      maxy = max(maxy, max(nbox.tr.y, max(nbox.bl.y, nbox.br.y))) + offset;\n\n      nbax = minx;\n      nbay = miny;\n      nbaw = (maxx - minx);\n      nbah = (maxy - miny);\n    }\n\n    const dstr = 'M' + nbax + ',' + nbay +\n      ' L' + (nbax + nbaw) + ',' + nbay +\n      ' ' + (nbax + nbaw) + ',' + (nbay + nbah) +\n      ' ' + nbax + ',' + (nbay + nbah) + 'z';\n    selectedBox.setAttribute('d', dstr);\n\n    const xform = angle ? 'rotate(' + [angle, cx, cy].join(',') + ')' : '';\n    this.selectorGroup.setAttribute('transform', xform);\n\n    // TODO(codedread): Is this needed?\n    //  if (selected === selectedElements[0]) {\n    this.gripCoords = {\n      nw: [nbax, nbay],\n      ne: [nbax + nbaw, nbay],\n      sw: [nbax, nbay + nbah],\n      se: [nbax + nbaw, nbay + nbah],\n      n: [nbax + (nbaw) / 2, nbay],\n      w: [nbax, nbay + (nbah) / 2],\n      e: [nbax + nbaw, nbay + (nbah) / 2],\n      s: [nbax + (nbaw) / 2, nbay + nbah]\n    };\n    for (const dir in this.gripCoords) {\n      const coords = this.gripCoords[dir];\n      selectedGrips[dir].setAttribute('cx', coords[0]);\n      selectedGrips[dir].setAttribute('cy', coords[1]);\n    }\n\n    // we want to go 20 pixels in the negative transformed y direction, ignoring scale\n    mgr.rotateGripConnector.setAttribute('x1', nbax + (nbaw) / 2);\n    mgr.rotateGripConnector.setAttribute('y1', nbay);\n    mgr.rotateGripConnector.setAttribute('x2', nbax + (nbaw) / 2);\n    mgr.rotateGripConnector.setAttribute('y2', nbay - (gripRadius * 5));\n\n    mgr.rotateGrip.setAttribute('cx', nbax + (nbaw) / 2);\n    mgr.rotateGrip.setAttribute('cy', nbay - (gripRadius * 5));\n    // }\n  }\n}\n\n/**\n* Manage all selector objects (selection boxes)\n*/\nexport class SelectorManager {\n  constructor () {\n    // this will hold the <g> element that contains all selector rects/grips\n    this.selectorParentGroup = null;\n\n    // this is a special rect that is used for multi-select\n    this.rubberBandBox = null;\n\n    // this will hold objects of type Selector (see above)\n    this.selectors = [];\n\n    // this holds a map of SVG elements to their Selector object\n    this.selectorMap = {};\n\n    // this holds a reference to the grip elements\n    this.selectorGrips = {\n      nw: null,\n      n: null,\n      ne: null,\n      e: null,\n      se: null,\n      s: null,\n      sw: null,\n      w: null\n    };\n\n    this.selectorGripsGroup = null;\n    this.rotateGripConnector = null;\n    this.rotateGrip = null;\n\n    this.initGroup();\n  }\n\n  /**\n  * Resets the parent selector group element\n  */\n  initGroup () {\n    // remove old selector parent group if it existed\n    if (this.selectorParentGroup && this.selectorParentGroup.parentNode) {\n      this.selectorParentGroup.remove();\n    }\n\n    // create parent selector group and add it to svgroot\n    this.selectorParentGroup = svgFactory_.createSVGElement({\n      element: 'g',\n      attr: {id: 'selectorParentGroup'}\n    });\n    this.selectorGripsGroup = svgFactory_.createSVGElement({\n      element: 'g',\n      attr: {display: 'none'}\n    });\n    this.selectorParentGroup.append(this.selectorGripsGroup);\n    svgFactory_.svgRoot().append(this.selectorParentGroup);\n\n    this.selectorMap = {};\n    this.selectors = [];\n    this.rubberBandBox = null;\n\n    // add the corner grips\n    for (const dir in this.selectorGrips) {\n      const grip = svgFactory_.createSVGElement({\n        element: 'circle',\n        attr: {\n          id: ('selectorGrip_resize_' + dir),\n          fill: '#22C',\n          r: gripRadius,\n          style: ('cursor:' + dir + '-resize'),\n          // This expands the mouse-able area of the grips making them\n          // easier to grab with the mouse.\n          // This works in Opera and WebKit, but does not work in Firefox\n          // see https://bugzilla.mozilla.org/show_bug.cgi?id=500174\n          'stroke-width': 2,\n          'pointer-events': 'all'\n        }\n      });\n\n      $.data(grip, 'dir', dir);\n      $.data(grip, 'type', 'resize');\n      this.selectorGrips[dir] = this.selectorGripsGroup.appendChild(grip);\n    }\n\n    // add rotator elems\n    this.rotateGripConnector = this.selectorGripsGroup.appendChild(\n      svgFactory_.createSVGElement({\n        element: 'line',\n        attr: {\n          id: ('selectorGrip_rotateconnector'),\n          stroke: '#22C',\n          'stroke-width': '1'\n        }\n      })\n    );\n\n    this.rotateGrip = this.selectorGripsGroup.appendChild(\n      svgFactory_.createSVGElement({\n        element: 'circle',\n        attr: {\n          id: 'selectorGrip_rotate',\n          fill: 'lime',\n          r: gripRadius,\n          stroke: '#22C',\n          'stroke-width': 2,\n          style: 'cursor:url(' + config_.imgPath + 'rotate.png) 12 12, auto;'\n        }\n      })\n    );\n    $.data(this.rotateGrip, 'type', 'rotate');\n\n    if ($('#canvasBackground').length) { return; }\n\n    const [width, height] = config_.dimensions;\n    const canvasbg = svgFactory_.createSVGElement({\n      element: 'svg',\n      attr: {\n        id: 'canvasBackground',\n        width,\n        height,\n        x: 0,\n        y: 0,\n        overflow: (isWebkit() ? 'none' : 'visible'), // Chrome 7 has a problem with this when zooming out\n        style: 'pointer-events:none'\n      }\n    });\n\n    const rect = svgFactory_.createSVGElement({\n      element: 'rect',\n      attr: {\n        width: '100%',\n        height: '100%',\n        x: 0,\n        y: 0,\n        'stroke-width': 1,\n        stroke: '#000',\n        fill: '#FFF',\n        style: 'pointer-events:none'\n      }\n    });\n\n    // Both Firefox and WebKit are too slow with this filter region (especially at higher\n    // zoom levels) and Opera has at least one bug\n    // if (!isOpera()) rect.setAttribute('filter', 'url(#canvashadow)');\n    canvasbg.append(rect);\n    svgFactory_.svgRoot().insertBefore(canvasbg, svgFactory_.svgContent());\n    // Ok to replace above with `svgFactory_.svgContent().before(canvasbg);`?\n  }\n\n  /**\n  *\n  * @param {Element} elem - DOM element to get the selector for\n  * @param {module:utilities.BBoxObject} [bbox] - Optional bbox to use for reset (prevents duplicate getBBox call).\n  * @returns {Selector} The selector based on the given element\n  */\n  requestSelector (elem, bbox) {\n    if (elem == null) { return null; }\n\n    const N = this.selectors.length;\n    // If we've already acquired one for this element, return it.\n    if (typeof this.selectorMap[elem.id] === 'object') {\n      this.selectorMap[elem.id].locked = true;\n      return this.selectorMap[elem.id];\n    }\n    for (let i = 0; i < N; ++i) {\n      if (this.selectors[i] && !this.selectors[i].locked) {\n        this.selectors[i].locked = true;\n        this.selectors[i].reset(elem, bbox);\n        this.selectorMap[elem.id] = this.selectors[i];\n        return this.selectors[i];\n      }\n    }\n    // if we reached here, no available selectors were found, we create one\n    this.selectors[N] = new Selector(N, elem, bbox);\n    this.selectorParentGroup.append(this.selectors[N].selectorGroup);\n    this.selectorMap[elem.id] = this.selectors[N];\n    return this.selectors[N];\n  }\n\n  /**\n  * Removes the selector of the given element (hides selection box)\n  *\n  * @param {Element} elem - DOM element to remove the selector for\n  */\n  releaseSelector (elem) {\n    if (elem == null) { return; }\n    const N = this.selectors.length,\n      sel = this.selectorMap[elem.id];\n    if (!sel.locked) {\n      // TODO(codedread): Ensure this exists in this module.\n      console.log('WARNING! selector was released but was already unlocked');\n    }\n    for (let i = 0; i < N; ++i) {\n      if (this.selectors[i] && this.selectors[i] === sel) {\n        delete this.selectorMap[elem.id];\n        sel.locked = false;\n        sel.selectedElement = null;\n        sel.showGrips(false);\n\n        // remove from DOM and store reference in JS but only if it exists in the DOM\n        try {\n          sel.selectorGroup.setAttribute('display', 'none');\n        } catch (e) {}\n\n        break;\n      }\n    }\n  }\n\n  /**\n  * @returns {SVGRectElement} The rubberBandBox DOM element. This is the rectangle drawn by\n  * the user for selecting/zooming\n  */\n  getRubberBandBox () {\n    if (!this.rubberBandBox) {\n      this.rubberBandBox = this.selectorParentGroup.appendChild(\n        svgFactory_.createSVGElement({\n          element: 'rect',\n          attr: {\n            id: 'selectorRubberBand',\n            fill: '#22C',\n            'fill-opacity': 0.15,\n            stroke: '#22C',\n            'stroke-width': 0.5,\n            display: 'none',\n            style: 'pointer-events:none'\n          }\n        })\n      );\n    }\n    return this.rubberBandBox;\n  }\n}\n\n/**\n * An object that creates SVG elements for the canvas.\n *\n * @interface module:select.SVGFactory\n */\n/**\n * @function module:select.SVGFactory#createSVGElement\n * @param {module:utilities.EditorContext#addSVGElementFromJson} jsonMap\n * @returns {SVGElement}\n */\n/**\n * @function module:select.SVGFactory#svgRoot\n * @returns {SVGSVGElement}\n */\n/**\n * @function module:select.SVGFactory#svgContent\n * @returns {SVGSVGElement}\n */\n/**\n * @function module:select.SVGFactory#getCurrentZoom\n * @returns {Float}\n */\n\n/**\n * @typedef {GenericArray} module:select.Dimensions\n * @property {Integer} length 2\n * @property {Float} 0 Width\n * @property {Float} 1 Height\n */\n/**\n * @typedef {PlainObject} module:select.Config\n * @property {string} imgPath\n * @property {module:select.Dimensions} dimensions\n */\n\n/**\n * Initializes this module.\n * @function module:select.init\n * @param {module:select.Config} config - An object containing configurable parameters (imgPath)\n * @param {module:select.SVGFactory} svgFactory - An object implementing the SVGFactory interface.\n * @returns {undefined}\n */\nexport const init = function (config, svgFactory) {\n  config_ = config;\n  svgFactory_ = svgFactory;\n  selectorManager_ = new SelectorManager();\n};\n\n/**\n * @function module:select.getSelectorManager\n * @returns {module:select.SelectorManager} The SelectorManager instance.\n */\nexport const getSelectorManager = () => selectorManager_;\n","/* eslint-disable indent */\n/* globals jQuery, jsPDF */\n/**\n * Numerous tools for working with the editor's \"canvas\"\n * @module svgcanvas\n *\n * @license MIT\n *\n * @copyright 2010 Alexis Deveria, 2010 Pavol Rusnak, 2010 Jeff Schiller\n *\n */\n\n/* Dependencies:\n1. Also expects jQuery UI for `svgCanvasToString` and\n`convertToGroup` use of `:data()` selector\n*/\n\n// Todo: Obtain/adapt latest jsPDF to utilize ES Module for `jsPDF`/avoid global\n\nimport './svgpathseg.js';\nimport jqPluginSVG from './jQuery.attr.js'; // Needed for SVG attribute setting and array form with `attr`\n\nimport * as draw from './draw.js';\nimport * as pathModule from './path.js';\nimport {sanitizeSvg} from './sanitize.js';\nimport {getReverseNS, NS} from './namespaces.js';\nimport {importSetGlobal, importScript} from './external/dynamic-import-polyfill/importModule.js';\nimport {\n  text2xml, assignAttributes, cleanupElement, getElem, getUrlFromAttr,\n  findDefs, getHref, setHref, getRefElem, getRotationAngle, getPathBBox,\n  preventClickDefault, snapToGrid, walkTree, walkTreePost,\n  getBBoxOfElementAsPath, convertToPath, toXml, encode64, decode64,\n  dataURLToObjectURL, createObjectURL,\n  getVisibleElements,\n  init as utilsInit, getBBox as utilsGetBBox, getStrokedBBoxDefaultVisible\n} from './utilities.js';\nimport * as history from './history.js';\nimport {\n  transformPoint, matrixMultiply, hasMatrixTransform, transformListToTransform,\n  getMatrix, snapToAngle, isIdentity, rectsIntersect, transformBox\n} from './math.js';\nimport {\n  convertToNum, convertAttrs, convertUnit, shortFloat, getTypeMap,\n  init as unitsInit\n} from './units.js';\nimport {\n  isGecko, isChrome, isIE, isWebkit, supportsNonScalingStroke, supportsGoodTextCharPos\n} from './browser.js'; // , supportsEditableText\nimport {\n  getTransformList, resetListMap,\n  SVGTransformList as SVGEditTransformList\n} from './svgtransformlist.js';\nimport {\n  remapElement,\n  init as coordsInit\n} from './coords.js';\nimport {\n  recalculateDimensions,\n  init as recalculateInit\n} from './recalculate.js';\nimport {\n  getSelectorManager,\n  init as selectInit\n} from './select.js';\n\nconst $ = jqPluginSVG(jQuery);\nconst {\n  MoveElementCommand, InsertElementCommand, RemoveElementCommand,\n  ChangeElementCommand, BatchCommand, UndoManager, HistoryEventTypes\n} = history;\n\nif (!window.console) {\n  window.console = {};\n  window.console.log = function (str) {};\n  window.console.dir = function (str) {};\n}\n\nif (window.opera) {\n  window.console.log = function (str) { opera.postError(str); };\n  window.console.dir = function (str) {};\n}\n\n/**\n* The main SvgCanvas class that manages all SVG-related functions\n* @memberof module:svgcanvas\n*\n* @borrows module:coords.remapElement as #remapElement\n* @borrows module:recalculate.recalculateDimensions as #recalculateDimensions\n*\n* @borrows module:utilities.cleanupElement as #cleanupElement\n* @borrows module:utilities.getStrokedBBoxDefaultVisible as #getStrokedBBox\n* @borrows module:utilities.getVisibleElements as #getVisibleElements\n* @borrows module:utilities.findDefs as #findDefs\n* @borrows module:utilities.getUrlFromAttr as #getUrlFromAttr\n* @borrows module:utilities.getHref as #getHref\n* @borrows module:utilities.setHref as #setHref\n* @borrows module:utilities.getRotationAngle as #getRotationAngle\n* @borrows module:utilities.getBBox as #getBBox\n* @borrows module:utilities.getElem as #getElem\n* @borrows module:utilities.getRefElem as #getRefElem\n* @borrows module:utilities.assignAttributes as #assignAttributes\n*\n* @borrows module:SVGTransformList.getTransformList as #getTransformList\n* @borrows module:math.matrixMultiply as #matrixMultiply\n* @borrows module:math.hasMatrixTransform as #hasMatrixTransform\n* @borrows module:math.transformListToTransform as #transformListToTransform\n* @borrows module:units.convertToNum as #convertToNum\n* @borrows module:sanitize.sanitizeSvg as #sanitizeSvg\n* @borrows module:path.pathActions.linkControlPoints as #linkControlPoints\n*/\nclass SvgCanvas {\n  /**\n  * @param {HTMLElement} container - The container HTML element that should hold the SVG root element\n  * @param {module:SVGEditor.curConfig} config - An object that contains configuration data\n  */\n  constructor (container, config) {\n// Alias Namespace constants\n\n// Default configuration options\nconst curConfig = {\n  show_outside_canvas: true,\n  selectNew: true,\n  dimensions: [640, 480]\n};\n\n// Update config with new one if given\nif (config) {\n  $.extend(curConfig, config);\n}\n\n// Array with width/height of canvas\nconst {dimensions} = curConfig;\n\nconst canvas = this;\n\n// \"document\" element associated with the container (same as window.document using default svg-editor.js)\n// NOTE: This is not actually a SVG document, but an HTML document.\nconst svgdoc = container.ownerDocument;\n\n// This is a container for the document being edited, not the document itself.\n/**\n * @name module:svgcanvas~svgroot\n * @type {SVGSVGElement}\n */\nconst svgroot = svgdoc.importNode(\n  text2xml(\n    '<svg id=\"svgroot\" xmlns=\"' + NS.SVG + '\" xlinkns=\"' + NS.XLINK + '\" ' +\n      'width=\"' + dimensions[0] + '\" height=\"' + dimensions[1] + '\" x=\"' + dimensions[0] + '\" y=\"' + dimensions[1] + '\" overflow=\"visible\">' +\n      '<defs>' +\n        '<filter id=\"canvashadow\" filterUnits=\"objectBoundingBox\">' +\n          '<feGaussianBlur in=\"SourceAlpha\" stdDeviation=\"4\" result=\"blur\"/>' +\n          '<feOffset in=\"blur\" dx=\"5\" dy=\"5\" result=\"offsetBlur\"/>' +\n          '<feMerge>' +\n            '<feMergeNode in=\"offsetBlur\"/>' +\n            '<feMergeNode in=\"SourceGraphic\"/>' +\n          '</feMerge>' +\n        '</filter>' +\n      '</defs>' +\n    '</svg>'\n  ).documentElement,\n  true\n);\ncontainer.append(svgroot);\n\n/**\n * The actual element that represents the final output SVG element\n * @name module:svgcanvas~svgcontent\n * @type {SVGSVGElement}\n */\nlet svgcontent = svgdoc.createElementNS(NS.SVG, 'svg');\n\n/**\n* This function resets the svgcontent element while keeping it in the DOM.\n* @function module:svgcanvas.SvgCanvas#clearSvgContentElement\n* @returns {undefined}\n*/\nconst clearSvgContentElement = canvas.clearSvgContentElement = function () {\n  $(svgcontent).empty();\n\n  // TODO: Clear out all other attributes first?\n  $(svgcontent).attr({\n    id: 'svgcontent',\n    width: dimensions[0],\n    height: dimensions[1],\n    x: dimensions[0],\n    y: dimensions[1],\n    overflow: curConfig.show_outside_canvas ? 'visible' : 'hidden',\n    xmlns: NS.SVG,\n    'xmlns:se': NS.SE,\n    'xmlns:xlink': NS.XLINK\n  }).appendTo(svgroot);\n\n  // TODO: make this string optional and set by the client\n  const comment = svgdoc.createComment(' Created with SVG-edit - https://github.com/SVG-Edit/svgedit');\n  svgcontent.append(comment);\n};\nclearSvgContentElement();\n\n// Prefix string for element IDs\nlet idprefix = 'svg_';\n\n/**\n* Changes the ID prefix to the given value\n* @function module:svgcanvas.SvgCanvas#setIdPrefix\n* @param {string} p - String with the new prefix\n* @returns {undefined}\n*/\ncanvas.setIdPrefix = function (p) {\n  idprefix = p;\n};\n\n/**\n* Current draw.Drawing object\n* @type {module:draw.Drawing}\n* @name module:svgcanvas.SvgCanvas#current_drawing_\n*/\ncanvas.current_drawing_ = new draw.Drawing(svgcontent, idprefix);\n\n/**\n* Returns the current Drawing.\n* @function module:svgcanvas.SvgCanvas#getCurrentDrawing\n* @implements {module:draw.DrawCanvasInit#getCurrentDrawing}\n*/\nconst getCurrentDrawing = canvas.getCurrentDrawing = function () {\n  return canvas.current_drawing_;\n};\n\n/**\n* Float displaying the current zoom level (1 = 100%, .5 = 50%, etc)\n* @type {Float}\n*/\nlet currentZoom = 1;\n\n// pointer to current group (for in-group editing)\nlet currentGroup = null;\n\n// Object containing data for the currently selected styles\nconst allProperties = {\n  shape: {\n    fill: (curConfig.initFill.color === 'none' ? '' : '#') + curConfig.initFill.color,\n    fill_paint: null,\n    fill_opacity: curConfig.initFill.opacity,\n    stroke: '#' + curConfig.initStroke.color,\n    stroke_paint: null,\n    stroke_opacity: curConfig.initStroke.opacity,\n    stroke_width: curConfig.initStroke.width,\n    stroke_dasharray: 'none',\n    stroke_linejoin: 'miter',\n    stroke_linecap: 'butt',\n    opacity: curConfig.initOpacity\n  }\n};\n\nallProperties.text = $.extend(true, {}, allProperties.shape);\n$.extend(allProperties.text, {\n  fill: '#000000',\n  stroke_width: curConfig.text && curConfig.text.stroke_width,\n  font_size: curConfig.text && curConfig.text.font_size,\n  font_family: curConfig.text && curConfig.text.font_family\n});\n\n// Current shape style properties\nconst curShape = allProperties.shape;\n\n// Array with all the currently selected elements\n// default size of 1 until it needs to grow bigger\nlet selectedElements = [];\n\n/**\n* @typedef {PlainObject} module:svgcanvas.SVGAsJSON\n* @property {string} element\n* @property {PlainObject.<string, string>} attr\n* @property {module:svgcanvas.SVGAsJSON[]} children\n*/\n\n/**\n* @function module:svgcanvas.SvgCanvas#getContentElem\n* @param {Text|Element} data\n* @returns {module:svgcanvas.SVGAsJSON}\n*/\nconst getJsonFromSvgElement = this.getJsonFromSvgElement = function (data) {\n  // Text node\n  if (data.nodeType === 3) return data.nodeValue;\n\n  const retval = {\n    element: data.tagName,\n    // namespace: nsMap[data.namespaceURI],\n    attr: {},\n    children: []\n  };\n\n  // Iterate attributes\n  for (let i = 0, attr; (attr = data.attributes[i]); i++) {\n    retval.attr[attr.name] = attr.value;\n  }\n\n  // Iterate children\n  for (let i = 0, node; (node = data.childNodes[i]); i++) {\n    retval.children[i] = getJsonFromSvgElement(node);\n  }\n\n  return retval;\n};\n\n/**\n* This should really be an intersection implementing all rather than a union\n* @function module:svgcanvas.SvgCanvas#addSVGElementFromJson\n* @implements {module:utilities.EditorContext#addSVGElementFromJson|module:path.EditorContext#addSVGElementFromJson}\n*/\nconst addSVGElementFromJson = this.addSVGElementFromJson = function (data) {\n  if (typeof data === 'string') return svgdoc.createTextNode(data);\n\n  let shape = getElem(data.attr.id);\n  // if shape is a path but we need to create a rect/ellipse, then remove the path\n  const currentLayer = getCurrentDrawing().getCurrentLayer();\n  if (shape && data.element !== shape.tagName) {\n    shape.remove();\n    shape = null;\n  }\n  if (!shape) {\n    const ns = data.namespace || NS.SVG;\n    shape = svgdoc.createElementNS(ns, data.element);\n    if (currentLayer) {\n      (currentGroup || currentLayer).append(shape);\n    }\n  }\n  if (data.curStyles) {\n    assignAttributes(shape, {\n      fill: curShape.fill,\n      stroke: curShape.stroke,\n      'stroke-width': curShape.stroke_width,\n      'stroke-dasharray': curShape.stroke_dasharray,\n      'stroke-linejoin': curShape.stroke_linejoin,\n      'stroke-linecap': curShape.stroke_linecap,\n      'stroke-opacity': curShape.stroke_opacity,\n      'fill-opacity': curShape.fill_opacity,\n      opacity: curShape.opacity / 2,\n      style: 'pointer-events:inherit'\n    }, 100);\n  }\n  assignAttributes(shape, data.attr, 100);\n  cleanupElement(shape);\n\n  // Children\n  if (data.children) {\n    data.children.forEach((child) => {\n      shape.append(addSVGElementFromJson(child));\n    });\n  }\n\n  return shape;\n};\n\ncanvas.getTransformList = getTransformList;\n\ncanvas.matrixMultiply = matrixMultiply;\ncanvas.hasMatrixTransform = hasMatrixTransform;\ncanvas.transformListToTransform = transformListToTransform;\n\n/**\n* @implements {module:utilities.EditorContext#getBaseUnit}\n*/\nconst getBaseUnit = () => { return curConfig.baseUnit; };\n\n/**\n* initialize from units.js.\n* Send in an object implementing the ElementContainer interface (see units.js)\n*/\nunitsInit(\n  /**\n  * @implements {module:units.ElementContainer}\n  */\n  {\n    getBaseUnit,\n    getElement: getElem,\n    getHeight () { return svgcontent.getAttribute('height') / currentZoom; },\n    getWidth () { return svgcontent.getAttribute('width') / currentZoom; },\n    getRoundDigits () { return saveOptions.round_digits; }\n  }\n);\n\ncanvas.convertToNum = convertToNum;\n\n/**\n* This should really be an intersection implementing all rather than a union\n* @implements {module:draw.DrawCanvasInit#getSVGContent|module:utilities.EditorContext#getSVGContent}\n*/\nconst getSVGContent = () => { return svgcontent; };\n\n/**\n* Should really be an intersection with all needing to apply rather than a union\n* @function module:svgcanvas.SvgCanvas#getSelectedElements\n* @implements {module:utilities.EditorContext#getSelectedElements|module:draw.DrawCanvasInit#getSelectedElements|module:path.EditorContext#getSelectedElements}\n*/\nconst getSelectedElements = this.getSelectedElems = function () {\n  return selectedElements;\n};\n\nconst pathActions = pathModule.pathActions;\n\n/**\n* This should actually be an intersection as all interfaces should be met\n* @implements {module:utilities.EditorContext#getSVGRoot|module:recalculate.EditorContext#getSVGRoot|module:coords.EditorContext#getSVGRoot|module:path.EditorContext#getSVGRoot}\n*/\nconst getSVGRoot = () => svgroot;\n\nutilsInit(\n  /**\n  * @implements {module:utilities.EditorContext}\n  */\n  {\n    pathActions, // Ok since not modifying\n    getSVGContent,\n    addSVGElementFromJson,\n    getSelectedElements,\n    getDOMDocument () { return svgdoc; },\n    getDOMContainer () { return container; },\n    getSVGRoot,\n    // TODO: replace this mostly with a way to get the current drawing.\n    getBaseUnit,\n    getSnappingStep () { return curConfig.snappingStep; }\n  }\n);\n\ncanvas.findDefs = findDefs;\ncanvas.getUrlFromAttr = getUrlFromAttr;\ncanvas.getHref = getHref;\ncanvas.setHref = setHref;\n/* const getBBox = */ canvas.getBBox = utilsGetBBox;\ncanvas.getRotationAngle = getRotationAngle;\ncanvas.getElem = getElem;\ncanvas.getRefElem = getRefElem;\ncanvas.assignAttributes = assignAttributes;\n\nthis.cleanupElement = cleanupElement;\n\n/**\n* This should actually be an intersection not a union as all should apply\n* @implements {module:coords.EditorContext|module:path.EditorContext}\n*/\nconst getGridSnapping = () => { return curConfig.gridSnapping; };\n\ncoordsInit(\n  /**\n  * @implements {module:coords.EditorContext}\n  */\n  {\n    getDrawing () { return getCurrentDrawing(); },\n    getSVGRoot,\n    getGridSnapping\n  }\n);\nthis.remapElement = remapElement;\n\nrecalculateInit(\n  /**\n  * @implements {module:recalculate.EditorContext}\n  */\n  {\n    getSVGRoot,\n    getStartTransform () { return startTransform; },\n    setStartTransform (transform) { startTransform = transform; }\n  }\n);\nthis.recalculateDimensions = recalculateDimensions;\n\n// import from sanitize.js\nconst nsMap = getReverseNS();\ncanvas.sanitizeSvg = sanitizeSvg;\n\n/**\n* @name undoMgr\n* @memberof module:svgcanvas.SvgCanvas#\n* @type {module:history.HistoryEventHandler}\n*/\nconst undoMgr = canvas.undoMgr = new UndoManager({\n  /**\n   * @param {string} eventType One of the HistoryEvent types\n   * @param {module:history.HistoryCommand} cmd Fulfills the HistoryCommand interface\n   * @fires module:svgcanvas.SvgCanvas#event:changed\n   * @returns {undefined}\n   */\n  handleHistoryEvent (eventType, cmd) {\n    const EventTypes = HistoryEventTypes;\n    // TODO: handle setBlurOffsets.\n    if (eventType === EventTypes.BEFORE_UNAPPLY || eventType === EventTypes.BEFORE_APPLY) {\n      canvas.clearSelection();\n    } else if (eventType === EventTypes.AFTER_APPLY || eventType === EventTypes.AFTER_UNAPPLY) {\n      const elems = cmd.elements();\n      canvas.pathActions.clear();\n      call('changed', elems);\n      const cmdType = cmd.type();\n      const isApply = (eventType === EventTypes.AFTER_APPLY);\n      if (cmdType === MoveElementCommand.type()) {\n        const parent = isApply ? cmd.newParent : cmd.oldParent;\n        if (parent === svgcontent) {\n          draw.identifyLayers();\n        }\n      } else if (cmdType === InsertElementCommand.type() ||\n          cmdType === RemoveElementCommand.type()) {\n        if (cmd.parent === svgcontent) {\n          draw.identifyLayers();\n        }\n        if (cmdType === InsertElementCommand.type()) {\n          if (isApply) { restoreRefElems(cmd.elem); }\n        } else {\n          if (!isApply) { restoreRefElems(cmd.elem); }\n        }\n        if (cmd.elem.tagName === 'use') {\n          setUseData(cmd.elem);\n        }\n      } else if (cmdType === ChangeElementCommand.type()) {\n        // if we are changing layer names, re-identify all layers\n        if (cmd.elem.tagName === 'title' &&\n          cmd.elem.parentNode.parentNode === svgcontent\n        ) {\n          draw.identifyLayers();\n        }\n        const values = isApply ? cmd.newValues : cmd.oldValues;\n        // If stdDeviation was changed, update the blur.\n        if (values.stdDeviation) {\n          canvas.setBlurOffsets(cmd.elem.parentNode, values.stdDeviation);\n        }\n        // This is resolved in later versions of webkit, perhaps we should\n        // have a featured detection for correct 'use' behavior?\n        // ——————————\n        // Remove & Re-add hack for Webkit (issue 775)\n        // if (cmd.elem.tagName === 'use' && isWebkit()) {\n        //  const {elem} = cmd;\n        //  if (!elem.getAttribute('x') && !elem.getAttribute('y')) {\n        //    const parent = elem.parentNode;\n        //    const sib = elem.nextSibling;\n        //    elem.remove();\n        //    parent.insertBefore(elem, sib);\n        //    // Ok to replace above with this? `sib.before(elem);`\n        //  }\n        // }\n      }\n    }\n  }\n});\n\n/**\n* This should really be an intersection applying to all types rather than a union\n* @function module:svgcanvas~addCommandToHistory\n* @implements {module:path.EditorContext#addCommandToHistory|module:draw.DrawCanvasInit#addCommandToHistory}\n*/\nconst addCommandToHistory = function (cmd) {\n  canvas.undoMgr.addCommandToHistory(cmd);\n};\n\n/**\n* This should really be an intersection applying to all types rather than a union\n* @function module:svgcanvas.SvgCanvas#getZoom\n* @implements {module:path.EditorContext#getCurrentZoom|module:select.SVGFactory#getCurrentZoom}\n*/\nconst getCurrentZoom = this.getZoom = function () { return currentZoom; };\n\n/**\n* This method rounds the incoming value to the nearest value based on the `currentZoom`\n* @function module:svgcanvas.SvgCanvas#round\n* @implements {module:path.EditorContext#round}\n*/\nconst round = this.round = function (val) {\n  return parseInt(val * currentZoom, 10) / currentZoom;\n};\n\nselectInit(\n  curConfig,\n  /**\n  * Export to select.js\n  * @implements {module:select.SVGFactory}\n  */\n  {\n    createSVGElement (jsonMap) { return canvas.addSVGElementFromJson(jsonMap); },\n    svgRoot () { return svgroot; },\n    svgContent () { return svgcontent; },\n    getCurrentZoom\n  }\n);\n/**\n* This object manages selectors for us\n* @name module:svgcanvas.SvgCanvas#selectorManager\n* @type {module:select.SelectorManager}\n*/\nconst selectorManager = this.selectorManager = getSelectorManager();\n\n/**\n* @function module:svgcanvas.SvgCanvas#getNextId\n* @implements {module:path.EditorContext#getNextId}\n*/\nconst getNextId = canvas.getNextId = function () {\n  return getCurrentDrawing().getNextId();\n};\n\n/**\n* @function module:svgcanvas.SvgCanvas#getId\n* @implements {module:path.EditorContext#getId}\n*/\nconst getId = canvas.getId = function () {\n  return getCurrentDrawing().getId();\n};\n\n/**\n* The \"implements\" should really be an intersection applying to all types rather than a union\n* @function module:svgcanvas.SvgCanvas#call\n* @implements {module:draw.DrawCanvasInit#call|module:path.EditorContext#call}\n* @param {\"selected\"|\"changed\"|\"contextset\"|\"pointsAdded\"|\"extension_added\"|\"extensions_added\"|\"message\"|\"transition\"|\"zoomed\"|\"updateCanvas\"|\"zoomDone\"|\"saved\"|\"exported\"|\"exportedPDF\"|\"setnonce\"|\"unsetnonce\"|\"cleared\"} ev - String with the event name\n* @param {module:svgcanvas.SvgCanvas#event:GenericCanvasEvent} arg - Argument to pass through to the callback function.\n* @returns {undefined}\n*/\nconst call = function (ev, arg) {\n  if (events[ev]) {\n    return events[ev](window, arg);\n  }\n};\n\n/**\n* Clears the selection. The 'selected' handler is then optionally called.\n* This should really be an intersection applying to all types rather than a union\n* @function module:svgcanvas.SvgCanvas#clearSelection\n* @implements {module:draw.DrawCanvasInit#clearSelection|module:path.EditorContext#clearSelection}\n* @fires module:svgcanvas.SvgCanvas#event:selected\n*/\nconst clearSelection = this.clearSelection = function (noCall) {\n  selectedElements.forEach((elem) => {\n    if (elem == null) {\n      return;\n    }\n    selectorManager.releaseSelector(elem);\n  });\n  selectedElements = [];\n\n  if (!noCall) { call('selected', selectedElements); }\n};\n\n/**\n* Adds a list of elements to the selection. The 'selected' handler is then called.\n* @function module:svgcanvas.SvgCanvas#addToSelection\n* @implements {module:path.EditorContext#addToSelection}\n* @fires module:svgcanvas.SvgCanvas#event:selected\n*/\nconst addToSelection = this.addToSelection = function (elemsToAdd, showGrips) {\n  if (!elemsToAdd.length) { return; }\n  // find the first null in our selectedElements array\n\n  let j = 0;\n  while (j < selectedElements.length) {\n    if (selectedElements[j] == null) {\n      break;\n    }\n    ++j;\n  }\n\n  // now add each element consecutively\n  let i = elemsToAdd.length;\n  while (i--) {\n    let elem = elemsToAdd[i];\n    if (!elem) { continue; }\n    const bbox = utilsGetBBox(elem);\n    if (!bbox) { continue; }\n\n    if (elem.tagName === 'a' && elem.childNodes.length === 1) {\n      // Make \"a\" element's child be the selected element\n      elem = elem.firstChild;\n    }\n\n    // if it's not already there, add it\n    if (!selectedElements.includes(elem)) {\n      selectedElements[j] = elem;\n\n      // only the first selectedBBoxes element is ever used in the codebase these days\n      // if (j === 0) selectedBBoxes[0] = utilsGetBBox(elem);\n      j++;\n      const sel = selectorManager.requestSelector(elem, bbox);\n\n      if (selectedElements.length > 1) {\n        sel.showGrips(false);\n      }\n    }\n  }\n  call('selected', selectedElements);\n\n  if (showGrips || selectedElements.length === 1) {\n    selectorManager.requestSelector(selectedElements[0]).showGrips(true);\n  } else {\n    selectorManager.requestSelector(selectedElements[0]).showGrips(false);\n  }\n\n  // make sure the elements are in the correct order\n  // See: https://www.w3.org/TR/DOM-Level-3-Core/core.html#Node3-compareDocumentPosition\n\n  selectedElements.sort(function (a, b) {\n    if (a && b && a.compareDocumentPosition) {\n      return 3 - (b.compareDocumentPosition(a) & 6);\n    }\n    if (a == null) {\n      return 1;\n    }\n  });\n\n  // Make sure first elements are not null\n  while (selectedElements[0] == null) {\n    selectedElements.shift(0);\n  }\n};\n\n/**\n* @implements {module:path.EditorContext#getOpacity}\n*/\nconst getOpacity = function () {\n  return curShape.opacity;\n};\n\n/**\n* @function module:svgcanvas.SvgCanvas#getMouseTarget\n* @implements {module:path.EditorContext#getMouseTarget}\n*/\nconst getMouseTarget = this.getMouseTarget = function (evt) {\n  if (evt == null) {\n    return null;\n  }\n  let mouseTarget = evt.target;\n\n  // if it was a <use>, Opera and WebKit return the SVGElementInstance\n  if (mouseTarget.correspondingUseElement) { mouseTarget = mouseTarget.correspondingUseElement; }\n\n  // for foreign content, go up until we find the foreignObject\n  // WebKit browsers set the mouse target to the svgcanvas div\n  if ([NS.MATH, NS.HTML].includes(mouseTarget.namespaceURI) &&\n    mouseTarget.id !== 'svgcanvas'\n  ) {\n    while (mouseTarget.nodeName !== 'foreignObject') {\n      mouseTarget = mouseTarget.parentNode;\n      if (!mouseTarget) { return svgroot; }\n    }\n  }\n\n  // Get the desired mouseTarget with jQuery selector-fu\n  // If it's root-like, select the root\n  const currentLayer = getCurrentDrawing().getCurrentLayer();\n  if ([svgroot, container, svgcontent, currentLayer].includes(mouseTarget)) {\n    return svgroot;\n  }\n\n  const $target = $(mouseTarget);\n\n  // If it's a selection grip, return the grip parent\n  if ($target.closest('#selectorParentGroup').length) {\n    // While we could instead have just returned mouseTarget,\n    // this makes it easier to indentify as being a selector grip\n    return selectorManager.selectorParentGroup;\n  }\n\n  while (mouseTarget.parentNode !== (currentGroup || currentLayer)) {\n    mouseTarget = mouseTarget.parentNode;\n  }\n\n  //\n  // // go up until we hit a child of a layer\n  // while (mouseTarget.parentNode.parentNode.tagName == 'g') {\n  //   mouseTarget = mouseTarget.parentNode;\n  // }\n  // Webkit bubbles the mouse event all the way up to the div, so we\n  // set the mouseTarget to the svgroot like the other browsers\n  // if (mouseTarget.nodeName.toLowerCase() == 'div') {\n  //   mouseTarget = svgroot;\n  // }\n\n  return mouseTarget;\n};\n\n/**\n* @namespace {module:path.pathActions} pathActions\n* @memberof module:svgcanvas.SvgCanvas#\n* @see module:path.pathActions\n*/\ncanvas.pathActions = pathActions;\n/**\n* @implements {module:path.EditorContext#resetD}\n*/\nfunction resetD (p) {\n  p.setAttribute('d', pathActions.convertPath(p));\n}\npathModule.init(\n  /**\n  * @implements {module:path.EditorContext}\n  */\n  {\n    selectorManager, // Ok since not changing\n    canvas, // Ok since not changing\n    call,\n    resetD,\n    round,\n    clearSelection,\n    addToSelection,\n    addCommandToHistory,\n    remapElement,\n    addSVGElementFromJson,\n    getGridSnapping,\n    getOpacity,\n    getSelectedElements,\n    getContainer () {\n      return container;\n    },\n    setStarted (s) {\n      started = s;\n    },\n    getRubberBox () {\n      return rubberBox;\n    },\n    setRubberBox (rb) {\n      rubberBox = rb;\n      return rubberBox;\n    },\n    /**\n     * @param {boolean} closedSubpath\n     * @param {SVGCircleElement[]} grips\n     * @fires module:svgcanvas.SvgCanvas#event:pointsAdded\n     * @fires module:svgcanvas.SvgCanvas#event:selected\n     */\n    addPtsToSelection ({closedSubpath, grips}) {\n      // TODO: Correct this:\n      pathActions.canDeleteNodes = true;\n      pathActions.closed_subpath = closedSubpath;\n      call('pointsAdded', {closedSubpath, grips});\n      call('selected', grips);\n    },\n    /**\n     * @param {ChangeElementCommand} cmd\n     * @param {SVGPathElement} elem\n     * @fires module:svgcanvas.SvgCanvas#event:changed\n     * @returns {undefined}\n     */\n    endChanges ({cmd, elem}) {\n      addCommandToHistory(cmd);\n      call('changed', [elem]);\n    },\n    getCurrentZoom,\n    getId,\n    getNextId,\n    getMouseTarget,\n    getCurrentMode () {\n      return currentMode;\n    },\n    setCurrentMode (cm) {\n      currentMode = cm;\n      return currentMode;\n    },\n    getDrawnPath () {\n      return drawnPath;\n    },\n    setDrawnPath (dp) {\n      drawnPath = dp;\n      return drawnPath;\n    },\n    getSVGRoot\n  }\n);\n\n// Interface strings, usually for title elements\nconst uiStrings = {};\n\nconst visElems = 'a,circle,ellipse,foreignObject,g,image,line,path,polygon,polyline,rect,svg,text,tspan,use';\nconst refAttrs = ['clip-path', 'fill', 'filter', 'marker-end', 'marker-mid', 'marker-start', 'mask', 'stroke'];\n\nconst elData = $.data;\n\n// Animation element to change the opacity of any newly created element\nconst opacAni = document.createElementNS(NS.SVG, 'animate');\n$(opacAni).attr({\n  attributeName: 'opacity',\n  begin: 'indefinite',\n  dur: 1,\n  fill: 'freeze'\n}).appendTo(svgroot);\n\nconst restoreRefElems = function (elem) {\n  // Look for missing reference elements, restore any found\n  const attrs = $(elem).attr(refAttrs);\n  for (const o in attrs) {\n    const val = attrs[o];\n    if (val && val.startsWith('url(')) {\n      const id = getUrlFromAttr(val).substr(1);\n      const ref = getElem(id);\n      if (!ref) {\n        findDefs().append(removedElements[id]);\n        delete removedElements[id];\n      }\n    }\n  }\n\n  const childs = elem.getElementsByTagName('*');\n\n  if (childs.length) {\n    for (let i = 0, l = childs.length; i < l; i++) {\n      restoreRefElems(childs[i]);\n    }\n  }\n};\n\n// (function () {\n// TODO For Issue 208: this is a start on a thumbnail\n//  const svgthumb = svgdoc.createElementNS(NS.SVG, 'use');\n//  svgthumb.setAttribute('width', '100');\n//  svgthumb.setAttribute('height', '100');\n//  setHref(svgthumb, '#svgcontent');\n//  svgroot.append(svgthumb);\n// }());\n\n/**\n * @typedef {PlainObject} module:svgcanvas.SaveOptions\n * @property {boolean} apply\n * @property {\"embed\"} [image]\n * @property {Integer} round_digits\n */\n\n// Object to contain image data for raster images that were found encodable\nconst encodableImages = {},\n\n  // Object with save options\n  /**\n   * @type {module:svgcanvas.SaveOptions}\n   */\n  saveOptions = {round_digits: 5},\n\n  // Object with IDs for imported files, to see if one was already added\n  importIds = {},\n\n  // Current text style properties\n  curText = allProperties.text,\n\n  // Object to contain all included extensions\n  extensions = {},\n\n  // Map of deleted reference elements\n  removedElements = {};\n\nlet\n  // String with image URL of last loadable image\n  lastGoodImgUrl = curConfig.imgPath + 'logo.png',\n\n  // Boolean indicating whether or not a draw action has been started\n  started = false,\n\n  // String with an element's initial transform attribute value\n  startTransform = null,\n\n  // String indicating the current editor mode\n  currentMode = 'select',\n\n  // String with the current direction in which an element is being resized\n  currentResizeMode = 'none',\n\n  // Current general properties\n  curProperties = curShape,\n\n  // Array with selected elements' Bounding box object\n  // selectedBBoxes = new Array(1),\n\n  // The DOM element that was just selected\n  justSelected = null,\n\n  // DOM element for selection rectangle drawn by the user\n  rubberBox = null,\n\n  // Array of current BBoxes, used in getIntersectionList().\n  curBBoxes = [],\n\n  // Canvas point for the most recent right click\n  lastClickPoint = null;\n\n/**\n* @typedef {module:svgcanvas.ExtensionMouseDownStatus|module:svgcanvas.ExtensionMouseUpStatus|module:svgcanvas.ExtensionIDsUpdatedStatus|module:locale.ExtensionLocaleData[]|undefined} module:svgcanvas.ExtensionStatus\n* @tutorial ExtensionDocs\n*/\n/**\n* @callback module:svgcanvas.ExtensionVarBuilder\n* @param {string} name The name of the extension\n*/\n/**\n* @todo Consider: Should this return an array by default, so extension results aren't overwritten?\n* @todo Would be easier to document if passing in object with key of action and vars as value; could then define an interface which tied both together\n* @function module:svgcanvas.SvgCanvas#runExtensions\n* @param {\"mouseDown\"|\"mouseMove\"|\"mouseUp\"|\"zoomChanged\"|\"IDsUpdated\"|\"canvasUpdated\"|\"toolButtonStateUpdate\"|\"selectedChanged\"|\"elementTransition\"|\"elementChanged\"|\"langReady\"|\"langChanged\"|\"addLangData\"|\"onNewDocument\"|\"workareaResized\"} action\n* @param {module:svgcanvas.SvgCanvas#event:ext-mouseDown|module:svgcanvas.SvgCanvas#event:ext-mouseMove|module:svgcanvas.SvgCanvas#event:ext-mouseUp|module:svgcanvas.SvgCanvas#event:ext-zoomChanged|module:svgcanvas.SvgCanvas#event:ext-IDsUpdated|module:svgcanvas.SvgCanvas#event:ext-canvasUpdated|module:svgcanvas.SvgCanvas#event:ext-toolButtonStateUpdate|module:svgcanvas.SvgCanvas#event:ext-selectedChanged|module:svgcanvas.SvgCanvas#event:ext-elementTransition|module:svgcanvas.SvgCanvas#event:ext-elementChanged|module:svgcanvas.SvgCanvas#event:ext-langReady|module:svgcanvas.SvgCanvas#event:ext-langChanged|module:svgcanvas.SvgCanvas#event:ext-addLangData|module:svgcanvas.SvgCanvas#event:ext-onNewDocument|module:svgcanvas.SvgCanvas#event:ext-workareaResized|module:svgcanvas.ExtensionVarBuilder} [vars]\n* @param {boolean} [returnArray]\n* @returns {GenericArray.<module:svgcanvas.ExtensionStatus>|module:svgcanvas.ExtensionStatus|false} See {@tutorial ExtensionDocs} on the ExtensionStatus.\n*/\nconst runExtensions = this.runExtensions = function (action, vars, returnArray) {\n  let result = returnArray ? [] : false;\n  $.each(extensions, function (name, ext) {\n    if (ext && action in ext) {\n      if (typeof vars === 'function') {\n        vars = vars(name); // ext, action\n      }\n      if (returnArray) {\n        result.push(ext[action](vars));\n      } else {\n        result = ext[action](vars);\n      }\n    }\n  });\n  return result;\n};\n\n/**\n* @typedef {PlainObject} module:svgcanvas.ExtensionMouseDownStatus\n* @property {boolean} started Indicates that creating/editing has started\n*/\n/**\n* @typedef {PlainObject} module:svgcanvas.ExtensionMouseUpStatus\n* @property {boolean} keep Indicates if the current element should be kept\n* @property {boolean} started Indicates if editing should still be considered as \"started\"\n* @property {Element} element The element being affected\n*/\n/**\n* @typedef {PlainObject} module:svgcanvas.ExtensionIDsUpdatedStatus\n* @property {string[]} remove Contains string IDs (used by `ext-connector.js`)\n*/\n\n/**\n * @interface module:svgcanvas.ExtensionInitResponse\n * @property {module:SVGEditor.ContextTool[]|PlainObject.<string, module:SVGEditor.ContextTool>} [context_tools]\n * @property {module:SVGEditor.Button[]|PlainObject.<Integer, module:SVGEditor.Button>} [buttons]\n * @property {string} [svgicons] The location of a local SVG or SVGz file\n*/\n/**\n * @function module:svgcanvas.ExtensionInitResponse#mouseDown\n * @param {module:svgcanvas.SvgCanvas#event:ext-mouseDown} arg\n * @returns {undefined|module:svgcanvas.ExtensionMouseDownStatus}\n */\n/**\n * @function module:svgcanvas.ExtensionInitResponse#mouseMove\n * @param {module:svgcanvas.SvgCanvas#event:ext-mouseMove} arg\n * @returns {undefined}\n*/\n/**\n * @function module:svgcanvas.ExtensionInitResponse#mouseUp\n * @param {module:svgcanvas.SvgCanvas#event:ext-mouseUp} arg\n * @returns {module:svgcanvas.ExtensionMouseUpStatus}\n */\n/**\n * @function module:svgcanvas.ExtensionInitResponse#zoomChanged\n * @param {module:svgcanvas.SvgCanvas#event:ext-zoomChanged} arg\n * @returns {undefined}\n*/\n/**\n * @function module:svgcanvas.ExtensionInitResponse#IDsUpdated\n * @param {module:svgcanvas.SvgCanvas#event:ext-IDsUpdated} arg\n * @returns {module:svgcanvas.ExtensionIDsUpdatedStatus}\n */\n/**\n * @function module:svgcanvas.ExtensionInitResponse#canvasUpdated\n * @param {module:svgcanvas.SvgCanvas#event:ext-canvasUpdated} arg\n * @returns {undefined}\n*/\n/**\n * @function module:svgcanvas.ExtensionInitResponse#toolButtonStateUpdate\n * @param {module:svgcanvas.SvgCanvas#event:ext-toolButtonStateUpdate} arg\n * @returns {undefined}\n*/\n/**\n * @function module:svgcanvas.ExtensionInitResponse#selectedChanged\n * @param {module:svgcanvas.SvgCanvas#event:ext-selectedChanged} arg\n * @returns {undefined}\n*/\n/**\n * @function module:svgcanvas.ExtensionInitResponse#elementTransition\n * @param {module:svgcanvas.SvgCanvas#event:ext-elementTransition} arg\n * @returns {undefined}\n*/\n/**\n * @function module:svgcanvas.ExtensionInitResponse#elementChanged\n * @param {module:svgcanvas.SvgCanvas#event:ext-elementChanged} arg\n * @returns {undefined}\n*/\n/**\n * @function module:svgcanvas.ExtensionInitResponse#langReady\n * @param {module:svgcanvas.SvgCanvas#event:ext-langReady} arg\n * @returns {undefined}\n*/\n/**\n * @function module:svgcanvas.ExtensionInitResponse#langChanged\n * @param {module:svgcanvas.SvgCanvas#event:ext-langChanged} arg\n * @returns {undefined}\n*/\n/**\n * @function module:svgcanvas.ExtensionInitResponse#addLangData\n * @param {module:svgcanvas.SvgCanvas#event:ext-addLangData} arg\n * @returns {Promise} Resolves to {@link module:locale.ExtensionLocaleData}\n*/\n/**\n * @function module:svgcanvas.ExtensionInitResponse#onNewDocument\n * @param {module:svgcanvas.SvgCanvas#event:ext-onNewDocument} arg\n * @returns {undefined}\n*/\n/**\n * @function module:svgcanvas.ExtensionInitResponse#workareaResized\n * @param {module:svgcanvas.SvgCanvas#event:ext-workareaResized} arg\n * @returns {undefined}\n*/\n/**\n * @function module:svgcanvas.ExtensionInitResponse#callback\n * @param {module:svgcanvas.SvgCanvas#event:ext-callback} arg\n * @returns {undefined}\n*/\n\n/**\n* @callback module:svgcanvas.ExtensionInitCallback\n* @this module:SVGEditor\n* @param {module:svgcanvas.ExtensionArgumentObject} arg\n* @returns {Promise} Resolves to [ExtensionInitResponse]{@link module:svgcanvas.ExtensionInitResponse} or `undefined`\n*/\n/**\n* Add an extension to the editor\n* @function module:svgcanvas.SvgCanvas#addExtension\n* @param {string} name - String with the ID of the extension. Used internally; no need for i18n.\n* @param {module:svgcanvas.ExtensionInitCallback} [extInitFunc] - Function supplied by the extension with its data\n* @param {module:SVGEditor~ImportLocale} importLocale\n* @fires module:svgcanvas.SvgCanvas#event:extension_added\n* @throws {TypeError} If `extInitFunc` is not a function\n* @returns {Promise} Resolves to `undefined`\n*/\nthis.addExtension = async function (name, extInitFunc, importLocale) {\n  if (typeof extInitFunc !== 'function') {\n    throw new TypeError('Function argument expected for `svgcanvas.addExtension`');\n  }\n  let extObj = {};\n  if (!(name in extensions)) {\n    // Provide private vars/funcs here. Is there a better way to do this?\n    /**\n     * @typedef {module:svgcanvas.PrivateMethods} module:svgcanvas.ExtensionArgumentObject\n     * @property {SVGSVGElement} svgroot See {@link module:svgcanvas~svgroot}\n     * @property {SVGSVGElement} svgcontent See {@link module:svgcanvas~svgcontent}\n     * @property {!(string|Integer)} nonce See {@link module:draw.Drawing#getNonce}\n     * @property {module:select.SelectorManager} selectorManager\n     * @property {module:SVGEditor~ImportLocale} importLocale\n     */\n    /**\n     * @type {module:svgcanvas.ExtensionArgumentObject}\n     * @see {@link module:svgcanvas.PrivateMethods} source for the other methods/properties\n     */\n    const argObj = $.extend(canvas.getPrivateMethods(), {\n      importLocale,\n      svgroot,\n      svgcontent,\n      nonce: getCurrentDrawing().getNonce(),\n      selectorManager\n    });\n    if (extInitFunc) {\n      extObj = await extInitFunc(argObj);\n    }\n    if (extObj) {\n      extObj.name = name;\n    }\n\n    extensions[name] = extObj;\n    return call('extension_added', extObj);\n  } else {\n    console.log('Cannot add extension \"' + name + '\", an extension by that name already exists.');\n  }\n};\n\n/**\n* This method sends back an array or a NodeList full of elements that\n* intersect the multi-select rubber-band-box on the currentLayer only.\n*\n* We brute-force `getIntersectionList` for browsers that do not support it (Firefox).\n*\n* Reference:\n* Firefox does not implement `getIntersectionList()`, see {@link https://bugzilla.mozilla.org/show_bug.cgi?id=501421}\n* @function module:svgcanvas.SvgCanvas#getIntersectionList\n* @param {SVGRect} rect\n* @returns {Element[]|NodeList} Bbox elements\n*/\nconst getIntersectionList = this.getIntersectionList = function (rect) {\n  if (rubberBox == null) { return null; }\n\n  const parent = currentGroup || getCurrentDrawing().getCurrentLayer();\n\n  let rubberBBox;\n  if (!rect) {\n    rubberBBox = rubberBox.getBBox();\n    const bb = svgcontent.createSVGRect();\n\n    for (const o in rubberBBox) {\n      bb[o] = rubberBBox[o] / currentZoom;\n    }\n    rubberBBox = bb;\n  } else {\n    rubberBBox = svgcontent.createSVGRect();\n    rubberBBox.x = rect.x;\n    rubberBBox.y = rect.y;\n    rubberBBox.width = rect.width;\n    rubberBBox.height = rect.height;\n  }\n\n  let resultList = null;\n  if (!isIE) {\n    if (typeof svgroot.getIntersectionList === 'function') {\n      // Offset the bbox of the rubber box by the offset of the svgcontent element.\n      rubberBBox.x += parseInt(svgcontent.getAttribute('x'), 10);\n      rubberBBox.y += parseInt(svgcontent.getAttribute('y'), 10);\n\n      resultList = svgroot.getIntersectionList(rubberBBox, parent);\n    }\n  }\n\n  if (resultList == null || typeof resultList.item !== 'function') {\n    resultList = [];\n\n    if (!curBBoxes.length) {\n      // Cache all bboxes\n      curBBoxes = getVisibleElementsAndBBoxes(parent);\n    }\n    let i = curBBoxes.length;\n    while (i--) {\n      if (!rubberBBox.width) { continue; }\n      if (rectsIntersect(rubberBBox, curBBoxes[i].bbox)) {\n        resultList.push(curBBoxes[i].elem);\n      }\n    }\n  }\n\n  // addToSelection expects an array, but it's ok to pass a NodeList\n  // because using square-bracket notation is allowed:\n  // https://www.w3.org/TR/DOM-Level-2-Core/ecma-script-binding.html\n  return resultList;\n};\n\nthis.getStrokedBBox = getStrokedBBoxDefaultVisible;\n\nthis.getVisibleElements = getVisibleElements;\n\n/**\n* @typedef {PlainObject} ElementAndBBox\n* @property {Element} elem - The element\n* @property {module:utilities.BBoxObject} bbox - The element's BBox as retrieved from `getStrokedBBoxDefaultVisible`\n*/\n\n/**\n* Get all elements that have a BBox (excludes `<defs>`, `<title>`, etc).\n* Note that 0-opacity, off-screen etc elements are still considered \"visible\"\n* for this function\n* @function module:svgcanvas.SvgCanvas#getVisibleElementsAndBBoxes\n* @param {Element} parent - The parent DOM element to search within\n* @returns {ElementAndBBox[]} An array with objects that include:\n*/\nconst getVisibleElementsAndBBoxes = this.getVisibleElementsAndBBoxes = function (parent) {\n  if (!parent) {\n    parent = $(svgcontent).children(); // Prevent layers from being included\n  }\n  const contentElems = [];\n  $(parent).children().each(function (i, elem) {\n    if (elem.getBBox) {\n      contentElems.push({elem, bbox: getStrokedBBoxDefaultVisible([elem])});\n    }\n  });\n  return contentElems.reverse();\n};\n\n/**\n* Wrap an SVG element into a group element, mark the group as 'gsvg'\n* @function module:svgcanvas.SvgCanvas#groupSvgElem\n* @param {Element} elem - SVG element to wrap\n* @returns {undefined}\n*/\nconst groupSvgElem = this.groupSvgElem = function (elem) {\n  const g = document.createElementNS(NS.SVG, 'g');\n  elem.replaceWith(g);\n  $(g).append(elem).data('gsvg', elem)[0].id = getNextId();\n};\n\n// Set scope for these functions\n\n// Object to contain editor event names and callback functions\nconst events = {};\n\ncanvas.call = call;\n/**\n * Array of what was changed (elements, layers)\n * @event module:svgcanvas.SvgCanvas#event:changed\n * @type {Element[]}\n */\n/**\n * Array of selected elements\n * @event module:svgcanvas.SvgCanvas#event:selected\n * @type {Element[]}\n */\n/**\n * Array of selected elements\n * @event module:svgcanvas.SvgCanvas#event:transition\n * @type {Element[]}\n */\n/**\n * The Element is always `SVGGElement`?\n * If not `null`, will be the set current group element\n * @event module:svgcanvas.SvgCanvas#event:contextset\n * @type {null|Element}\n */\n/**\n * @event module:svgcanvas.SvgCanvas#event:pointsAdded\n * @type {PlainObject}\n * @property {boolean} closedSubpath\n * @property {SVGCircleElement[]} grips Grips elements\n */\n\n/**\n * @event module:svgcanvas.SvgCanvas#event:zoomed\n * @type {PlainObject}\n * @property {Float} x\n * @property {Float} y\n * @property {Float} width\n * @property {Float} height\n * @property {0.5|2} factor\n * @see module:SVGEditor.BBoxObjectWithFactor\n */\n/**\n * @event module:svgcanvas.SvgCanvas#event:updateCanvas\n * @type {PlainObject}\n * @property {false} center\n * @property {module:math.XYObject} newCtr\n */\n/**\n * @typedef {PlainObject} module:svgcanvas.ExtensionInitResponsePlusName\n * @implements {module:svgcanvas.ExtensionInitResponse}\n * @property {string} name The extension's resolved ID (whether explicit or based on file name)\n */\n/**\n * Generalized extension object response of\n * [`init()`]{@link module:svgcanvas.ExtensionInitCallback}\n * along with the name of the extension.\n * @event module:svgcanvas.SvgCanvas#event:extension_added\n * @type {module:svgcanvas.ExtensionInitResponsePlusName|undefined}\n */\n/**\n * @event module:svgcanvas.SvgCanvas#event:extensions_added\n * @type {undefined}\n*/\n/**\n * @typedef {PlainObject} module:svgcanvas.Message\n * @property {Any} data The data\n * @property {string} origin The origin\n */\n/**\n * @event module:svgcanvas.SvgCanvas#event:message\n * @type {module:svgcanvas.Message}\n */\n/**\n * SVG canvas converted to string\n * @event module:svgcanvas.SvgCanvas#event:saved\n * @type {string}\n */\n/**\n * @event module:svgcanvas.SvgCanvas#event:setnonce\n * @type {!(string|Integer)}\n */\n/**\n * @event module:svgcanvas.SvgCanvas#event:unsetnonce\n * @type {undefined}\n */\n/**\n * @event module:svgcanvas.SvgCanvas#event:zoomDone\n * @type {undefined}\n*/\n/**\n * @event module:svgcanvas.SvgCanvas#event:cleared\n * @type {undefined}\n*/\n\n/**\n * @event module:svgcanvas.SvgCanvas#event:exported\n * @type {module:svgcanvas.ImageExportedResults}\n */\n/**\n * @event module:svgcanvas.SvgCanvas#event:exportedPDF\n * @type {module:svgcanvas.PDFExportedResults}\n */\n/**\n * Creating a cover-all class until {@link https://github.com/jsdoc3/jsdoc/issues/1545} may be supported.\n * `undefined` may be returned by {@link module:svgcanvas.SvgCanvas#event:extension_added} if the extension's `init` returns `undefined` It is also the type for the following events \"zoomDone\", \"unsetnonce\", \"cleared\", and \"extensions_added\".\n * @event module:svgcanvas.SvgCanvas#event:GenericCanvasEvent\n * @type {module:svgcanvas.SvgCanvas#event:selected|module:svgcanvas.SvgCanvas#event:changed|module:svgcanvas.SvgCanvas#event:contextset|module:svgcanvas.SvgCanvas#event:pointsAdded|module:svgcanvas.SvgCanvas#event:extension_added|module:svgcanvas.SvgCanvas#event:extensions_added|module:svgcanvas.SvgCanvas#event:message|module:svgcanvas.SvgCanvas#event:transition|module:svgcanvas.SvgCanvas#event:zoomed|module:svgcanvas.SvgCanvas#event:updateCanvas|module:svgcanvas.SvgCanvas#event:saved|module:svgcanvas.SvgCanvas#event:exported|module:svgcanvas.SvgCanvas#event:exportedPDF|module:svgcanvas.SvgCanvas#event:setnonce|module:svgcanvas.SvgCanvas#event:unsetnonce|undefined}\n */\n\n/**\n* @callback module:svgcanvas.EventHandler\n* @param {external:Window} win\n* @param {module:svgcanvas.SvgCanvas#event:GenericCanvasEvent} arg\n* @listens module:svgcanvas.SvgCanvas#event:GenericCanvasEvent\n*/\n\n/**\n* Attaches a callback function to an event\n* @function module:svgcanvas.SvgCanvas#bind\n* @param {\"changed\"|\"contextset\"|\"selected\"|\"pointsAdded\"|\"extension_added\"|\"extensions_added\"|\"message\"|\"transition\"|\"zoomed\"|\"updateCanvas\"|\"zoomDone\"|\"saved\"|\"exported\"|\"exportedPDF\"|\"setnonce\"|\"unsetnonce\"|\"cleared\"} ev - String indicating the name of the event\n* @param {module:svgcanvas.EventHandler} f - The callback function to bind to the event\n* @returns {module:svgcanvas.EventHandler} The previous event\n*/\ncanvas.bind = function (ev, f) {\n  const old = events[ev];\n  events[ev] = f;\n  return old;\n};\n\n/**\n* Runs the SVG Document through the sanitizer and then updates its paths.\n* @function module:svgcanvas.SvgCanvas#prepareSvg\n* @param {XMLDocument} newDoc - The SVG DOM document\n* @returns {undefined}\n*/\nthis.prepareSvg = function (newDoc) {\n  this.sanitizeSvg(newDoc.documentElement);\n\n  // convert paths into absolute commands\n  const paths = [...newDoc.getElementsByTagNameNS(NS.SVG, 'path')];\n  paths.forEach((path) => {\n    path.setAttribute('d', pathActions.convertPath(path));\n    pathActions.fixEnd(path);\n  });\n};\n\n/**\n* Hack for Firefox bugs where text element features aren't updated or get\n* messed up. See issue 136 and issue 137.\n* This function clones the element and re-selects it.\n* @function module:svgcanvas~ffClone\n* @todo Test for this bug on load and add it to \"support\" object instead of\n* browser sniffing\n* @param {Element} elem - The (text) DOM element to clone\n* @returns {Element} Cloned element\n*/\nconst ffClone = function (elem) {\n  if (!isGecko()) { return elem; }\n  const clone = elem.cloneNode(true);\n  elem.before(clone);\n  elem.remove();\n  selectorManager.releaseSelector(elem);\n  selectedElements[0] = clone;\n  selectorManager.requestSelector(clone).showGrips(true);\n  return clone;\n};\n\n// `this.each` is deprecated, if any extension used this it can be recreated by doing this:\n// * @example $(canvas.getRootElem()).children().each(...)\n// * @function module:svgcanvas.SvgCanvas#each\n// this.each = function (cb) {\n//  $(svgroot).children().each(cb);\n// };\n\n/**\n* Removes any old rotations if present, prepends a new rotation at the\n* transformed center\n* @function module:svgcanvas.SvgCanvas#setRotationAngle\n* @param {string|Float} val - The new rotation angle in degrees\n* @param {boolean} preventUndo - Indicates whether the action should be undoable or not\n* @fires module:svgcanvas.SvgCanvas#event:changed\n* @returns {undefined}\n*/\nthis.setRotationAngle = function (val, preventUndo) {\n  // ensure val is the proper type\n  val = parseFloat(val);\n  const elem = selectedElements[0];\n  const oldTransform = elem.getAttribute('transform');\n  const bbox = utilsGetBBox(elem);\n  const cx = bbox.x + bbox.width / 2, cy = bbox.y + bbox.height / 2;\n  const tlist = getTransformList(elem);\n\n  // only remove the real rotational transform if present (i.e. at index=0)\n  if (tlist.numberOfItems > 0) {\n    const xform = tlist.getItem(0);\n    if (xform.type === 4) {\n      tlist.removeItem(0);\n    }\n  }\n  // find Rnc and insert it\n  if (val !== 0) {\n    const center = transformPoint(cx, cy, transformListToTransform(tlist).matrix);\n    const Rnc = svgroot.createSVGTransform();\n    Rnc.setRotate(val, center.x, center.y);\n    if (tlist.numberOfItems) {\n      tlist.insertItemBefore(Rnc, 0);\n    } else {\n      tlist.appendItem(Rnc);\n    }\n  } else if (tlist.numberOfItems === 0) {\n    elem.removeAttribute('transform');\n  }\n\n  if (!preventUndo) {\n    // we need to undo it, then redo it so it can be undo-able! :)\n    // TODO: figure out how to make changes to transform list undo-able cross-browser?\n    const newTransform = elem.getAttribute('transform');\n    elem.setAttribute('transform', oldTransform);\n    changeSelectedAttribute('transform', newTransform, selectedElements);\n    call('changed', selectedElements);\n  }\n  // const pointGripContainer = getElem('pathpointgrip_container');\n  // if (elem.nodeName === 'path' && pointGripContainer) {\n  //   pathActions.setPointContainerTransform(elem.getAttribute('transform'));\n  // }\n  const selector = selectorManager.requestSelector(selectedElements[0]);\n  selector.resize();\n  selector.updateGripCursors(val);\n};\n\n/**\n* Runs `recalculateDimensions` on the selected elements,\n* adding the changes to a single batch command\n* @function module:svgcanvas.SvgCanvas#recalculateAllSelectedDimensions\n* @fires module:svgcanvas.SvgCanvas#event:changed\n* @returns {undefined}\n*/\nconst recalculateAllSelectedDimensions = this.recalculateAllSelectedDimensions = function () {\n  const text = (currentResizeMode === 'none' ? 'position' : 'size');\n  const batchCmd = new BatchCommand(text);\n\n  let i = selectedElements.length;\n  while (i--) {\n    const elem = selectedElements[i];\n    // if (getRotationAngle(elem) && !hasMatrixTransform(getTransformList(elem))) { continue; }\n    const cmd = recalculateDimensions(elem);\n    if (cmd) {\n      batchCmd.addSubCommand(cmd);\n    }\n  }\n\n  if (!batchCmd.isEmpty()) {\n    addCommandToHistory(batchCmd);\n    call('changed', selectedElements);\n  }\n};\n\n/**\n * Debug tool to easily see the current matrix in the browser's console\n * @function module:svgcanvas~logMatrix\n * @param {SVGMatrix} m The matrix\n * @returns {undefined}\n */\nconst logMatrix = function (m) {\n  console.log([m.a, m.b, m.c, m.d, m.e, m.f]);\n};\n\n// Root Current Transformation Matrix in user units\nlet rootSctm = null;\n\n/**\n* Group: Selection\n*/\n\n// TODO: do we need to worry about selectedBBoxes here?\n\n/**\n* Selects only the given elements, shortcut for clearSelection(); addToSelection()\n* @function module:svgcanvas.SvgCanvas#selectOnly\n* @param {Element[]} elems - an array of DOM elements to be selected\n* @param {boolean} showGrips - Indicates whether the resize grips should be shown\n* @returns {undefined}\n*/\nconst selectOnly = this.selectOnly = function (elems, showGrips) {\n  clearSelection(true);\n  addToSelection(elems, showGrips);\n};\n\n// TODO: could use slice here to make this faster?\n// TODO: should the 'selected' handler\n\n/**\n* Removes elements from the selection.\n* @function module:svgcanvas.SvgCanvas#removeFromSelection\n* @param {Element[]} elemsToRemove - An array of elements to remove from selection\n* @returns {undefined}\n*/\n/* const removeFromSelection = */ this.removeFromSelection = function (elemsToRemove) {\n  if (selectedElements[0] == null) { return; }\n  if (!elemsToRemove.length) { return; }\n\n  // find every element and remove it from our array copy\n  const newSelectedItems = [],\n    len = selectedElements.length;\n  for (let i = 0; i < len; ++i) {\n    const elem = selectedElements[i];\n    if (elem) {\n      // keep the item\n      if (!elemsToRemove.includes(elem)) {\n        newSelectedItems.push(elem);\n      } else { // remove the item and its selector\n        selectorManager.releaseSelector(elem);\n      }\n    }\n  }\n  // the copy becomes the master now\n  selectedElements = newSelectedItems;\n};\n\n/**\n* Clears the selection, then adds all elements in the current layer to the selection.\n* @function module:svgcanvas.SvgCanvas#selectAllInCurrentLayer\n* @returns {undefined}\n*/\nthis.selectAllInCurrentLayer = function () {\n  const currentLayer = getCurrentDrawing().getCurrentLayer();\n  if (currentLayer) {\n    currentMode = 'select';\n    selectOnly($(currentGroup || currentLayer).children());\n  }\n};\n\nlet drawnPath = null;\n\n// Mouse events\n(function () {\nconst freehand = {\n  minx: null,\n  miny: null,\n  maxx: null,\n  maxy: null\n};\nconst THRESHOLD_DIST = 0.8,\n  STEP_COUNT = 10;\nlet dAttr = null,\n  startX = null,\n  startY = null,\n  rStartX = null,\n  rStartY = null,\n  initBbox = {},\n  sumDistance = 0,\n  controllPoint2 = {x: 0, y: 0},\n  controllPoint1 = {x: 0, y: 0},\n  start = {x: 0, y: 0},\n  end = {x: 0, y: 0},\n  bSpline = {x: 0, y: 0},\n  nextPos = {x: 0, y: 0},\n  parameter,\n  nextParameter;\n\nconst getBsplinePoint = function (t) {\n  const spline = {x: 0, y: 0},\n    p0 = controllPoint2,\n    p1 = controllPoint1,\n    p2 = start,\n    p3 = end,\n    S = 1.0 / 6.0,\n    t2 = t * t,\n    t3 = t2 * t;\n\n  const m = [\n    [-1, 3, -3, 1],\n    [3, -6, 3, 0],\n    [-3, 0, 3, 0],\n    [1, 4, 1, 0]\n  ];\n\n  spline.x = S * (\n    (p0.x * m[0][0] + p1.x * m[0][1] + p2.x * m[0][2] + p3.x * m[0][3]) * t3 +\n      (p0.x * m[1][0] + p1.x * m[1][1] + p2.x * m[1][2] + p3.x * m[1][3]) * t2 +\n      (p0.x * m[2][0] + p1.x * m[2][1] + p2.x * m[2][2] + p3.x * m[2][3]) * t +\n      (p0.x * m[3][0] + p1.x * m[3][1] + p2.x * m[3][2] + p3.x * m[3][3])\n  );\n  spline.y = S * (\n    (p0.y * m[0][0] + p1.y * m[0][1] + p2.y * m[0][2] + p3.y * m[0][3]) * t3 +\n      (p0.y * m[1][0] + p1.y * m[1][1] + p2.y * m[1][2] + p3.y * m[1][3]) * t2 +\n      (p0.y * m[2][0] + p1.y * m[2][1] + p2.y * m[2][2] + p3.y * m[2][3]) * t +\n      (p0.y * m[3][0] + p1.y * m[3][1] + p2.y * m[3][2] + p3.y * m[3][3])\n  );\n\n  return {\n    x: spline.x,\n    y: spline.y\n  };\n};\n/**\n * - When we are in a create mode, the element is added to the canvas but the\n *   action is not recorded until mousing up.\n * - When we are in select mode, select the element, remember the position\n *   and do nothing else\n * @param {MouseEvent} evt\n * @fires module:svgcanvas.SvgCanvas#event:ext-mouseDown\n * @returns {undefined}\n */\nconst mouseDown = function (evt) {\n  if (canvas.spaceKey || evt.button === 1) { return; }\n\n  const rightClick = evt.button === 2;\n\n  if (evt.altKey) { // duplicate when dragging\n    canvas.cloneSelectedElements(0, 0);\n  }\n\n  rootSctm = $('#svgcontent g')[0].getScreenCTM().inverse();\n\n  const pt = transformPoint(evt.pageX, evt.pageY, rootSctm),\n    mouseX = pt.x * currentZoom,\n    mouseY = pt.y * currentZoom;\n\n  evt.preventDefault();\n\n  if (rightClick) {\n    currentMode = 'select';\n    lastClickPoint = pt;\n  }\n\n  // This would seem to be unnecessary...\n  // if (!['select', 'resize'].includes(currentMode)) {\n  //   setGradient();\n  // }\n\n  let x = mouseX / currentZoom,\n    y = mouseY / currentZoom;\n  let mouseTarget = getMouseTarget(evt);\n\n  if (mouseTarget.tagName === 'a' && mouseTarget.childNodes.length === 1) {\n    mouseTarget = mouseTarget.firstChild;\n  }\n\n  // realX/y ignores grid-snap value\n  const realX = x;\n  rStartX = startX = x;\n  const realY = y;\n  rStartY = startY = y;\n\n  if (curConfig.gridSnapping) {\n    x = snapToGrid(x);\n    y = snapToGrid(y);\n    startX = snapToGrid(startX);\n    startY = snapToGrid(startY);\n  }\n\n  // if it is a selector grip, then it must be a single element selected,\n  // set the mouseTarget to that and update the mode to rotate/resize\n\n  if (mouseTarget === selectorManager.selectorParentGroup && selectedElements[0] != null) {\n    const grip = evt.target;\n    const griptype = elData(grip, 'type');\n    // rotating\n    if (griptype === 'rotate') {\n      currentMode = 'rotate';\n    // resizing\n    } else if (griptype === 'resize') {\n      currentMode = 'resize';\n      currentResizeMode = elData(grip, 'dir');\n    }\n    mouseTarget = selectedElements[0];\n  }\n\n  startTransform = mouseTarget.getAttribute('transform');\n  let i, strokeW;\n  const tlist = getTransformList(mouseTarget);\n  switch (currentMode) {\n  case 'select':\n    started = true;\n    currentResizeMode = 'none';\n    if (rightClick) { started = false; }\n\n    if (mouseTarget !== svgroot) {\n      // if this element is not yet selected, clear selection and select it\n      if (!selectedElements.includes(mouseTarget)) {\n        // only clear selection if shift is not pressed (otherwise, add\n        // element to selection)\n        if (!evt.shiftKey) {\n          // No need to do the call here as it will be done on addToSelection\n          clearSelection(true);\n        }\n        addToSelection([mouseTarget]);\n        justSelected = mouseTarget;\n        pathActions.clear();\n      }\n      // else if it's a path, go into pathedit mode in mouseup\n\n      if (!rightClick) {\n        // insert a dummy transform so if the element(s) are moved it will have\n        // a transform to use for its translate\n        for (i = 0; i < selectedElements.length; ++i) {\n          if (selectedElements[i] == null) { continue; }\n          const slist = getTransformList(selectedElements[i]);\n          if (slist.numberOfItems) {\n            slist.insertItemBefore(svgroot.createSVGTransform(), 0);\n          } else {\n            slist.appendItem(svgroot.createSVGTransform());\n          }\n        }\n      }\n    } else if (!rightClick) {\n      clearSelection();\n      currentMode = 'multiselect';\n      if (rubberBox == null) {\n        rubberBox = selectorManager.getRubberBandBox();\n      }\n      rStartX *= currentZoom;\n      rStartY *= currentZoom;\n      // console.log('p',[evt.pageX, evt.pageY]);\n      // console.log('c',[evt.clientX, evt.clientY]);\n      // console.log('o',[evt.offsetX, evt.offsetY]);\n      // console.log('s',[startX, startY]);\n\n      assignAttributes(rubberBox, {\n        x: rStartX,\n        y: rStartY,\n        width: 0,\n        height: 0,\n        display: 'inline'\n      }, 100);\n    }\n    break;\n  case 'zoom':\n    started = true;\n    if (rubberBox == null) {\n      rubberBox = selectorManager.getRubberBandBox();\n    }\n    assignAttributes(rubberBox, {\n      x: realX * currentZoom,\n      y: realX * currentZoom,\n      width: 0,\n      height: 0,\n      display: 'inline'\n    }, 100);\n    break;\n  case 'resize':\n    started = true;\n    startX = x;\n    startY = y;\n\n    // Getting the BBox from the selection box, since we know we\n    // want to orient around it\n    initBbox = utilsGetBBox($('#selectedBox0')[0]);\n    const bb = {};\n    $.each(initBbox, function (key, val) {\n      bb[key] = val / currentZoom;\n    });\n    initBbox = bb;\n\n    // append three dummy transforms to the tlist so that\n    // we can translate,scale,translate in mousemove\n    const pos = getRotationAngle(mouseTarget) ? 1 : 0;\n\n    if (hasMatrixTransform(tlist)) {\n      tlist.insertItemBefore(svgroot.createSVGTransform(), pos);\n      tlist.insertItemBefore(svgroot.createSVGTransform(), pos);\n      tlist.insertItemBefore(svgroot.createSVGTransform(), pos);\n    } else {\n      tlist.appendItem(svgroot.createSVGTransform());\n      tlist.appendItem(svgroot.createSVGTransform());\n      tlist.appendItem(svgroot.createSVGTransform());\n\n      if (supportsNonScalingStroke()) {\n        // Handle crash for newer Chrome and Safari 6 (Mobile and Desktop):\n        // https://code.google.com/p/svg-edit/issues/detail?id=904\n        // Chromium issue: https://code.google.com/p/chromium/issues/detail?id=114625\n        // TODO: Remove this workaround once vendor fixes the issue\n        const iswebkit = isWebkit();\n\n        let delayedStroke;\n        if (iswebkit) {\n          delayedStroke = function (ele) {\n            const _stroke = ele.getAttributeNS(null, 'stroke');\n            ele.removeAttributeNS(null, 'stroke');\n            // Re-apply stroke after delay. Anything higher than 1 seems to cause flicker\n            if (_stroke !== null) setTimeout(function () { ele.setAttributeNS(null, 'stroke', _stroke); }, 0);\n          };\n        }\n        mouseTarget.style.vectorEffect = 'non-scaling-stroke';\n        if (iswebkit) { delayedStroke(mouseTarget); }\n\n        const all = mouseTarget.getElementsByTagName('*'),\n          len = all.length;\n        for (i = 0; i < len; i++) {\n          if (!all[i].style) { // mathML\n            continue;\n          }\n          all[i].style.vectorEffect = 'non-scaling-stroke';\n          if (iswebkit) { delayedStroke(all[i]); }\n        }\n      }\n    }\n    break;\n  case 'fhellipse':\n  case 'fhrect':\n  case 'fhpath':\n    start.x = realX;\n    start.y = realY;\n    started = true;\n    dAttr = realX + ',' + realY + ' ';\n    strokeW = parseFloat(curShape.stroke_width) === 0 ? 1 : curShape.stroke_width;\n    addSVGElementFromJson({\n      element: 'polyline',\n      curStyles: true,\n      attr: {\n        points: dAttr,\n        id: getNextId(),\n        fill: 'none',\n        opacity: curShape.opacity / 2,\n        'stroke-linecap': 'round',\n        style: 'pointer-events:none'\n      }\n    });\n    freehand.minx = realX;\n    freehand.maxx = realX;\n    freehand.miny = realY;\n    freehand.maxy = realY;\n    break;\n  case 'image':\n    started = true;\n    const newImage = addSVGElementFromJson({\n      element: 'image',\n      attr: {\n        x,\n        y,\n        width: 0,\n        height: 0,\n        id: getNextId(),\n        opacity: curShape.opacity / 2,\n        style: 'pointer-events:inherit'\n      }\n    });\n    setHref(newImage, lastGoodImgUrl);\n    preventClickDefault(newImage);\n    break;\n  case 'square':\n    // FIXME: once we create the rect, we lose information that this was a square\n    // (for resizing purposes this could be important)\n    // Fallthrough\n  case 'rect':\n    started = true;\n    startX = x;\n    startY = y;\n    addSVGElementFromJson({\n      element: 'rect',\n      curStyles: true,\n      attr: {\n        x,\n        y,\n        width: 0,\n        height: 0,\n        id: getNextId(),\n        opacity: curShape.opacity / 2\n      }\n    });\n    break;\n  case 'line':\n    started = true;\n    strokeW = Number(curShape.stroke_width) === 0 ? 1 : curShape.stroke_width;\n    addSVGElementFromJson({\n      element: 'line',\n      curStyles: true,\n      attr: {\n        x1: x,\n        y1: y,\n        x2: x,\n        y2: y,\n        id: getNextId(),\n        stroke: curShape.stroke,\n        'stroke-width': strokeW,\n        'stroke-dasharray': curShape.stroke_dasharray,\n        'stroke-linejoin': curShape.stroke_linejoin,\n        'stroke-linecap': curShape.stroke_linecap,\n        'stroke-opacity': curShape.stroke_opacity,\n        fill: 'none',\n        opacity: curShape.opacity / 2,\n        style: 'pointer-events:none'\n      }\n    });\n    break;\n  case 'circle':\n    started = true;\n    addSVGElementFromJson({\n      element: 'circle',\n      curStyles: true,\n      attr: {\n        cx: x,\n        cy: y,\n        r: 0,\n        id: getNextId(),\n        opacity: curShape.opacity / 2\n      }\n    });\n    break;\n  case 'ellipse':\n    started = true;\n    addSVGElementFromJson({\n      element: 'ellipse',\n      curStyles: true,\n      attr: {\n        cx: x,\n        cy: y,\n        rx: 0,\n        ry: 0,\n        id: getNextId(),\n        opacity: curShape.opacity / 2\n      }\n    });\n    break;\n  case 'text':\n    started = true;\n    /* const newText = */ addSVGElementFromJson({\n      element: 'text',\n      curStyles: true,\n      attr: {\n        x,\n        y,\n        id: getNextId(),\n        fill: curText.fill,\n        'stroke-width': curText.stroke_width,\n        'font-size': curText.font_size,\n        'font-family': curText.font_family,\n        'text-anchor': 'middle',\n        'xml:space': 'preserve',\n        opacity: curShape.opacity\n      }\n    });\n    // newText.textContent = 'text';\n    break;\n  case 'path':\n    // Fall through\n  case 'pathedit':\n    startX *= currentZoom;\n    startY *= currentZoom;\n    pathActions.mouseDown(evt, mouseTarget, startX, startY);\n    started = true;\n    break;\n  case 'textedit':\n    startX *= currentZoom;\n    startY *= currentZoom;\n    textActions.mouseDown(evt, mouseTarget, startX, startY);\n    started = true;\n    break;\n  case 'rotate':\n    started = true;\n    // we are starting an undoable change (a drag-rotation)\n    canvas.undoMgr.beginUndoableChange('transform', selectedElements);\n    break;\n  default:\n    // This could occur in an extension\n    break;\n  }\n\n  /**\n   * The main (left) mouse button is held down on the canvas area\n   * @event module:svgcanvas.SvgCanvas#event:ext-mouseDown\n   * @type {PlainObject}\n   * @property {MouseEvent} event The event object\n   * @property {Float} start_x x coordinate on canvas\n   * @property {Float} start_y y coordinate on canvas\n   * @property {Element[]} selectedElements An array of the selected Elements\n  */\n  const extResult = runExtensions('mouseDown', /** @type {module:svgcanvas.SvgCanvas#event:ext-mouseDown} */ {\n    event: evt,\n    start_x: startX,\n    start_y: startY,\n    selectedElements\n  }, true);\n\n  $.each(extResult, function (i, r) {\n    if (r && r.started) {\n      started = true;\n    }\n  });\n};\n\n// in this function we do not record any state changes yet (but we do update\n// any elements that are still being created, moved or resized on the canvas)\n/**\n *\n * @param {MouseEvent} evt\n * @fires module:svgcanvas.SvgCanvas#event:transition\n * @fires module:svgcanvas.SvgCanvas#event:ext-mouseMove\n * @returns {undefined}\n */\nconst mouseMove = function (evt) {\n  if (!started) { return; }\n  if (evt.button === 1 || canvas.spaceKey) { return; }\n\n  let i, xya, c, cx, cy, dx, dy, len, angle, box,\n    selected = selectedElements[0];\n  const\n    pt = transformPoint(evt.pageX, evt.pageY, rootSctm),\n    mouseX = pt.x * currentZoom,\n    mouseY = pt.y * currentZoom,\n    shape = getElem(getId());\n\n  let realX = mouseX / currentZoom;\n  let x = realX;\n  let realY = mouseY / currentZoom;\n  let y = realY;\n\n  if (curConfig.gridSnapping) {\n    x = snapToGrid(x);\n    y = snapToGrid(y);\n  }\n\n  evt.preventDefault();\n  let tlist;\n  switch (currentMode) {\n  case 'select': {\n    // we temporarily use a translate on the element(s) being dragged\n    // this transform is removed upon mousing up and the element is\n    // relocated to the new location\n    if (selectedElements[0] !== null) {\n      dx = x - startX;\n      dy = y - startY;\n\n      if (curConfig.gridSnapping) {\n        dx = snapToGrid(dx);\n        dy = snapToGrid(dy);\n      }\n\n      if (evt.shiftKey) {\n        xya = snapToAngle(startX, startY, x, y);\n        ({x, y} = xya);\n      }\n\n      if (dx !== 0 || dy !== 0) {\n        len = selectedElements.length;\n        for (i = 0; i < len; ++i) {\n          selected = selectedElements[i];\n          if (selected == null) { break; }\n          // if (i === 0) {\n          //   const box = utilsGetBBox(selected);\n          //     selectedBBoxes[i].x = box.x + dx;\n          //     selectedBBoxes[i].y = box.y + dy;\n          // }\n\n          // update the dummy transform in our transform list\n          // to be a translate\n          const xform = svgroot.createSVGTransform();\n          tlist = getTransformList(selected);\n          // Note that if Webkit and there's no ID for this\n          // element, the dummy transform may have gotten lost.\n          // This results in unexpected behaviour\n\n          xform.setTranslate(dx, dy);\n          if (tlist.numberOfItems) {\n            tlist.replaceItem(xform, 0);\n          } else {\n            tlist.appendItem(xform);\n          }\n\n          // update our internal bbox that we're tracking while dragging\n          selectorManager.requestSelector(selected).resize();\n        }\n\n        call('transition', selectedElements);\n      }\n    }\n    break;\n  } case 'multiselect': {\n    realX *= currentZoom;\n    realY *= currentZoom;\n    assignAttributes(rubberBox, {\n      x: Math.min(rStartX, realX),\n      y: Math.min(rStartY, realY),\n      width: Math.abs(realX - rStartX),\n      height: Math.abs(realY - rStartY)\n    }, 100);\n\n    // for each selected:\n    // - if newList contains selected, do nothing\n    // - if newList doesn't contain selected, remove it from selected\n    // - for any newList that was not in selectedElements, add it to selected\n    const elemsToRemove = selectedElements.slice(), elemsToAdd = [],\n      newList = getIntersectionList();\n\n    // For every element in the intersection, add if not present in selectedElements.\n    len = newList.length;\n    for (i = 0; i < len; ++i) {\n      const intElem = newList[i];\n      // Found an element that was not selected before, so we should add it.\n      if (!selectedElements.includes(intElem)) {\n        elemsToAdd.push(intElem);\n      }\n      // Found an element that was already selected, so we shouldn't remove it.\n      const foundInd = elemsToRemove.indexOf(intElem);\n      if (foundInd !== -1) {\n        elemsToRemove.splice(foundInd, 1);\n      }\n    }\n\n    if (elemsToRemove.length > 0) {\n      canvas.removeFromSelection(elemsToRemove);\n    }\n\n    if (elemsToAdd.length > 0) {\n      canvas.addToSelection(elemsToAdd);\n    }\n\n    break;\n  } case 'resize': {\n    // we track the resize bounding box and translate/scale the selected element\n    // while the mouse is down, when mouse goes up, we use this to recalculate\n    // the shape's coordinates\n    tlist = getTransformList(selected);\n    const hasMatrix = hasMatrixTransform(tlist);\n    box = hasMatrix ? initBbox : utilsGetBBox(selected);\n    let left = box.x,\n      top = box.y,\n      {width, height} = box;\n    dx = (x - startX);\n    dy = (y - startY);\n\n    if (curConfig.gridSnapping) {\n      dx = snapToGrid(dx);\n      dy = snapToGrid(dy);\n      height = snapToGrid(height);\n      width = snapToGrid(width);\n    }\n\n    // if rotated, adjust the dx,dy values\n    angle = getRotationAngle(selected);\n    if (angle) {\n      const r = Math.sqrt(dx * dx + dy * dy),\n        theta = Math.atan2(dy, dx) - angle * Math.PI / 180.0;\n      dx = r * Math.cos(theta);\n      dy = r * Math.sin(theta);\n    }\n\n    // if not stretching in y direction, set dy to 0\n    // if not stretching in x direction, set dx to 0\n    if (!currentResizeMode.includes('n') && !currentResizeMode.includes('s')) {\n      dy = 0;\n    }\n    if (!currentResizeMode.includes('e') && !currentResizeMode.includes('w')) {\n      dx = 0;\n    }\n\n    let // ts = null,\n      tx = 0, ty = 0,\n      sy = height ? (height + dy) / height : 1,\n      sx = width ? (width + dx) / width : 1;\n    // if we are dragging on the north side, then adjust the scale factor and ty\n    if (currentResizeMode.includes('n')) {\n      sy = height ? (height - dy) / height : 1;\n      ty = height;\n    }\n\n    // if we dragging on the east side, then adjust the scale factor and tx\n    if (currentResizeMode.includes('w')) {\n      sx = width ? (width - dx) / width : 1;\n      tx = width;\n    }\n\n    // update the transform list with translate,scale,translate\n    const translateOrigin = svgroot.createSVGTransform(),\n      scale = svgroot.createSVGTransform(),\n      translateBack = svgroot.createSVGTransform();\n\n    if (curConfig.gridSnapping) {\n      left = snapToGrid(left);\n      tx = snapToGrid(tx);\n      top = snapToGrid(top);\n      ty = snapToGrid(ty);\n    }\n\n    translateOrigin.setTranslate(-(left + tx), -(top + ty));\n    if (evt.shiftKey) {\n      if (sx === 1) {\n        sx = sy;\n      } else { sy = sx; }\n    }\n    scale.setScale(sx, sy);\n\n    translateBack.setTranslate(left + tx, top + ty);\n    if (hasMatrix) {\n      const diff = angle ? 1 : 0;\n      tlist.replaceItem(translateOrigin, 2 + diff);\n      tlist.replaceItem(scale, 1 + diff);\n      tlist.replaceItem(translateBack, Number(diff));\n    } else {\n      const N = tlist.numberOfItems;\n      tlist.replaceItem(translateBack, N - 3);\n      tlist.replaceItem(scale, N - 2);\n      tlist.replaceItem(translateOrigin, N - 1);\n    }\n\n    selectorManager.requestSelector(selected).resize();\n\n    call('transition', selectedElements);\n\n    break;\n  } case 'zoom': {\n    realX *= currentZoom;\n    realY *= currentZoom;\n    assignAttributes(rubberBox, {\n      x: Math.min(rStartX * currentZoom, realX),\n      y: Math.min(rStartY * currentZoom, realY),\n      width: Math.abs(realX - rStartX * currentZoom),\n      height: Math.abs(realY - rStartY * currentZoom)\n    }, 100);\n    break;\n  } case 'text': {\n    assignAttributes(shape, {\n      x,\n      y\n    }, 1000);\n    break;\n  } case 'line': {\n    if (curConfig.gridSnapping) {\n      x = snapToGrid(x);\n      y = snapToGrid(y);\n    }\n\n    let x2 = x;\n    let y2 = y;\n\n    if (evt.shiftKey) {\n      xya = snapToAngle(startX, startY, x2, y2);\n      x2 = xya.x;\n      y2 = xya.y;\n    }\n\n    shape.setAttributeNS(null, 'x2', x2);\n    shape.setAttributeNS(null, 'y2', y2);\n    break;\n  } case 'foreignObject':\n    // fall through\n  case 'square':\n    // fall through\n  case 'rect':\n    // fall through\n  case 'image': {\n    const square = (currentMode === 'square') || evt.shiftKey;\n    let\n      w = Math.abs(x - startX),\n      h = Math.abs(y - startY);\n    let newX, newY;\n    if (square) {\n      w = h = Math.max(w, h);\n      newX = startX < x ? startX : startX - w;\n      newY = startY < y ? startY : startY - h;\n    } else {\n      newX = Math.min(startX, x);\n      newY = Math.min(startY, y);\n    }\n\n    if (curConfig.gridSnapping) {\n      w = snapToGrid(w);\n      h = snapToGrid(h);\n      newX = snapToGrid(newX);\n      newY = snapToGrid(newY);\n    }\n\n    assignAttributes(shape, {\n      width: w,\n      height: h,\n      x: newX,\n      y: newY\n    }, 1000);\n\n    break;\n  } case 'circle': {\n    c = $(shape).attr(['cx', 'cy']);\n    ({cx, cy} = c);\n    let rad = Math.sqrt((x - cx) * (x - cx) + (y - cy) * (y - cy));\n    if (curConfig.gridSnapping) {\n      rad = snapToGrid(rad);\n    }\n    shape.setAttributeNS(null, 'r', rad);\n    break;\n  } case 'ellipse': {\n    c = $(shape).attr(['cx', 'cy']);\n    ({cx, cy} = c);\n    if (curConfig.gridSnapping) {\n      x = snapToGrid(x);\n      cx = snapToGrid(cx);\n      y = snapToGrid(y);\n      cy = snapToGrid(cy);\n    }\n    shape.setAttributeNS(null, 'rx', Math.abs(x - cx));\n    const ry = Math.abs(evt.shiftKey ? (x - cx) : (y - cy));\n    shape.setAttributeNS(null, 'ry', ry);\n    break;\n  }\n  case 'fhellipse':\n  case 'fhrect': {\n    freehand.minx = Math.min(realX, freehand.minx);\n    freehand.maxx = Math.max(realX, freehand.maxx);\n    freehand.miny = Math.min(realY, freehand.miny);\n    freehand.maxy = Math.max(realY, freehand.maxy);\n  }\n  // Fallthrough\n  case 'fhpath': {\n    // dAttr += + realX + ',' + realY + ' ';\n    // shape.setAttributeNS(null, 'points', dAttr);\n    end.x = realX; end.y = realY;\n    if (controllPoint2.x && controllPoint2.y) {\n      for (i = 0; i < STEP_COUNT - 1; i++) {\n        parameter = i / STEP_COUNT;\n        nextParameter = (i + 1) / STEP_COUNT;\n        bSpline = getBsplinePoint(nextParameter);\n        nextPos = bSpline;\n        bSpline = getBsplinePoint(parameter);\n        sumDistance += Math.sqrt((nextPos.x - bSpline.x) * (nextPos.x - bSpline.x) + (nextPos.y - bSpline.y) * (nextPos.y - bSpline.y));\n        if (sumDistance > THRESHOLD_DIST) {\n          sumDistance -= THRESHOLD_DIST;\n\n          // Faster than completely re-writing the points attribute.\n          const point = svgcontent.createSVGPoint();\n          point.x = bSpline.x;\n          point.y = bSpline.y;\n          shape.points.appendItem(point);\n        }\n      }\n    }\n    controllPoint2 = {x: controllPoint1.x, y: controllPoint1.y};\n    controllPoint1 = {x: start.x, y: start.y};\n    start = {x: end.x, y: end.y};\n    break;\n  // update path stretch line coordinates\n  } case 'path': {\n  }\n  // fall through\n  case 'pathedit': {\n    x *= currentZoom;\n    y *= currentZoom;\n\n    if (curConfig.gridSnapping) {\n      x = snapToGrid(x);\n      y = snapToGrid(y);\n      startX = snapToGrid(startX);\n      startY = snapToGrid(startY);\n    }\n    if (evt.shiftKey) {\n      const {path} = pathModule;\n      let x1, y1;\n      if (path) {\n        x1 = path.dragging ? path.dragging[0] : startX;\n        y1 = path.dragging ? path.dragging[1] : startY;\n      } else {\n        x1 = startX;\n        y1 = startY;\n      }\n      xya = snapToAngle(x1, y1, x, y);\n      ({x, y} = xya);\n    }\n\n    if (rubberBox && rubberBox.getAttribute('display') !== 'none') {\n      realX *= currentZoom;\n      realY *= currentZoom;\n      assignAttributes(rubberBox, {\n        x: Math.min(rStartX * currentZoom, realX),\n        y: Math.min(rStartY * currentZoom, realY),\n        width: Math.abs(realX - rStartX * currentZoom),\n        height: Math.abs(realY - rStartY * currentZoom)\n      }, 100);\n    }\n    pathActions.mouseMove(x, y);\n\n    break;\n  } case 'textedit': {\n    x *= currentZoom;\n    y *= currentZoom;\n    // if (rubberBox && rubberBox.getAttribute('display') !== 'none') {\n    //   assignAttributes(rubberBox, {\n    //     x: Math.min(startX, x),\n    //     y: Math.min(startY, y),\n    //     width: Math.abs(x - startX),\n    //     height: Math.abs(y - startY)\n    //   }, 100);\n    // }\n\n    textActions.mouseMove(mouseX, mouseY);\n\n    break;\n  } case 'rotate': {\n    box = utilsGetBBox(selected);\n    cx = box.x + box.width / 2;\n    cy = box.y + box.height / 2;\n    const m = getMatrix(selected),\n      center = transformPoint(cx, cy, m);\n    cx = center.x;\n    cy = center.y;\n    angle = ((Math.atan2(cy - y, cx - x) * (180 / Math.PI)) - 90) % 360;\n    if (curConfig.gridSnapping) {\n      angle = snapToGrid(angle);\n    }\n    if (evt.shiftKey) { // restrict rotations to nice angles (WRS)\n      const snap = 45;\n      angle = Math.round(angle / snap) * snap;\n    }\n\n    canvas.setRotationAngle(angle < -180 ? (360 + angle) : angle, true);\n    call('transition', selectedElements);\n    break;\n  } default:\n    break;\n  }\n\n  /**\n  * The mouse has moved on the canvas area\n  * @event module:svgcanvas.SvgCanvas#event:ext-mouseMove\n  * @type {PlainObject}\n  * @property {MouseEvent} event The event object\n  * @property {Float} mouse_x x coordinate on canvas\n  * @property {Float} mouse_y y coordinate on canvas\n  * @property {Element} selected Refers to the first selected element\n  */\n  runExtensions('mouseMove', /** @type {module:svgcanvas.SvgCanvas#event:ext-mouseMove} */ {\n    event: evt,\n    mouse_x: mouseX,\n    mouse_y: mouseY,\n    selected\n  });\n}; // mouseMove()\n\n// - in create mode, the element's opacity is set properly, we create an InsertElementCommand\n// and store it on the Undo stack\n// - in move/resize mode, the element's attributes which were affected by the move/resize are\n// identified, a ChangeElementCommand is created and stored on the stack for those attrs\n// this is done in when we recalculate the selected dimensions()\n/**\n *\n * @param {MouseEvent} evt\n * @fires module:svgcanvas.SvgCanvas#event:zoomed\n * @fires module:svgcanvas.SvgCanvas#event:changed\n * @fires module:svgcanvas.SvgCanvas#event:ext-mouseUp\n * @returns {undefined}\n */\nconst mouseUp = function (evt) {\n  if (evt.button === 2) { return; }\n  const tempJustSelected = justSelected;\n  justSelected = null;\n  if (!started) { return; }\n  const pt = transformPoint(evt.pageX, evt.pageY, rootSctm),\n    mouseX = pt.x * currentZoom,\n    mouseY = pt.y * currentZoom,\n    x = mouseX / currentZoom,\n    y = mouseY / currentZoom;\n\n  let element = getElem(getId());\n  let keep = false;\n\n  const realX = x;\n  const realY = y;\n\n  // TODO: Make true when in multi-unit mode\n  const useUnit = false; // (curConfig.baseUnit !== 'px');\n  started = false;\n  let attrs, t;\n  switch (currentMode) {\n  // intentionally fall-through to select here\n  case 'resize':\n  case 'multiselect':\n    if (rubberBox != null) {\n      rubberBox.setAttribute('display', 'none');\n      curBBoxes = [];\n    }\n    currentMode = 'select';\n    // Fallthrough\n  case 'select':\n    if (selectedElements[0] != null) {\n      // if we only have one selected element\n      if (selectedElements[1] == null) {\n        // set our current stroke/fill properties to the element's\n        const selected = selectedElements[0];\n        switch (selected.tagName) {\n        case 'g':\n        case 'use':\n        case 'image':\n        case 'foreignObject':\n          break;\n        default:\n          curProperties.fill = selected.getAttribute('fill');\n          curProperties.fill_opacity = selected.getAttribute('fill-opacity');\n          curProperties.stroke = selected.getAttribute('stroke');\n          curProperties.stroke_opacity = selected.getAttribute('stroke-opacity');\n          curProperties.stroke_width = selected.getAttribute('stroke-width');\n          curProperties.stroke_dasharray = selected.getAttribute('stroke-dasharray');\n          curProperties.stroke_linejoin = selected.getAttribute('stroke-linejoin');\n          curProperties.stroke_linecap = selected.getAttribute('stroke-linecap');\n        }\n\n        if (selected.tagName === 'text') {\n          curText.font_size = selected.getAttribute('font-size');\n          curText.font_family = selected.getAttribute('font-family');\n        }\n        selectorManager.requestSelector(selected).showGrips(true);\n\n        // This shouldn't be necessary as it was done on mouseDown...\n        // call('selected', [selected]);\n      }\n      // always recalculate dimensions to strip off stray identity transforms\n      recalculateAllSelectedDimensions();\n      // if it was being dragged/resized\n      if (realX !== rStartX || realY !== rStartY) {\n        const len = selectedElements.length;\n        for (let i = 0; i < len; ++i) {\n          if (selectedElements[i] == null) { break; }\n          if (!selectedElements[i].firstChild) {\n            // Not needed for groups (incorrectly resizes elems), possibly not needed at all?\n            selectorManager.requestSelector(selectedElements[i]).resize();\n          }\n        }\n      // no change in position/size, so maybe we should move to pathedit\n      } else {\n        t = evt.target;\n        if (selectedElements[0].nodeName === 'path' && selectedElements[1] == null) {\n          pathActions.select(selectedElements[0]);\n        // if it was a path\n        // else, if it was selected and this is a shift-click, remove it from selection\n        } else if (evt.shiftKey) {\n          if (tempJustSelected !== t) {\n            canvas.removeFromSelection([t]);\n          }\n        }\n      } // no change in mouse position\n\n      // Remove non-scaling stroke\n      if (supportsNonScalingStroke()) {\n        const elem = selectedElements[0];\n        if (elem) {\n          elem.removeAttribute('style');\n          walkTree(elem, function (elem) {\n            elem.removeAttribute('style');\n          });\n        }\n      }\n    }\n    return;\n  case 'zoom':\n    if (rubberBox != null) {\n      rubberBox.setAttribute('display', 'none');\n    }\n    const factor = evt.shiftKey ? 0.5 : 2;\n    call('zoomed', {\n      x: Math.min(rStartX, realX),\n      y: Math.min(rStartY, realY),\n      width: Math.abs(realX - rStartX),\n      height: Math.abs(realY - rStartY),\n      factor\n    });\n    return;\n  case 'fhpath':\n    // Check that the path contains at least 2 points; a degenerate one-point path\n    // causes problems.\n    // Webkit ignores how we set the points attribute with commas and uses space\n    // to separate all coordinates, see https://bugs.webkit.org/show_bug.cgi?id=29870\n    sumDistance = 0;\n    controllPoint2 = {x: 0, y: 0};\n    controllPoint1 = {x: 0, y: 0};\n    start = {x: 0, y: 0};\n    end = {x: 0, y: 0};\n    const coords = element.getAttribute('points');\n    const commaIndex = coords.indexOf(',');\n    if (commaIndex >= 0) {\n      keep = coords.indexOf(',', commaIndex + 1) >= 0;\n    } else {\n      keep = coords.indexOf(' ', coords.indexOf(' ') + 1) >= 0;\n    }\n    if (keep) {\n      element = pathActions.smoothPolylineIntoPath(element);\n    }\n    break;\n  case 'line':\n    attrs = $(element).attr(['x1', 'x2', 'y1', 'y2']);\n    keep = (attrs.x1 !== attrs.x2 || attrs.y1 !== attrs.y2);\n    break;\n  case 'foreignObject':\n  case 'square':\n  case 'rect':\n  case 'image':\n    attrs = $(element).attr(['width', 'height']);\n    // Image should be kept regardless of size (use inherit dimensions later)\n    keep = (attrs.width || attrs.height) || currentMode === 'image';\n    break;\n  case 'circle':\n    keep = (element.getAttribute('r') !== '0');\n    break;\n  case 'ellipse':\n    attrs = $(element).attr(['rx', 'ry']);\n    keep = (attrs.rx || attrs.ry);\n    break;\n  case 'fhellipse':\n    if ((freehand.maxx - freehand.minx) > 0 &&\n      (freehand.maxy - freehand.miny) > 0) {\n      element = addSVGElementFromJson({\n        element: 'ellipse',\n        curStyles: true,\n        attr: {\n          cx: (freehand.minx + freehand.maxx) / 2,\n          cy: (freehand.miny + freehand.maxy) / 2,\n          rx: (freehand.maxx - freehand.minx) / 2,\n          ry: (freehand.maxy - freehand.miny) / 2,\n          id: getId()\n        }\n      });\n      call('changed', [element]);\n      keep = true;\n    }\n    break;\n  case 'fhrect':\n    if ((freehand.maxx - freehand.minx) > 0 &&\n      (freehand.maxy - freehand.miny) > 0) {\n      element = addSVGElementFromJson({\n        element: 'rect',\n        curStyles: true,\n        attr: {\n          x: freehand.minx,\n          y: freehand.miny,\n          width: (freehand.maxx - freehand.minx),\n          height: (freehand.maxy - freehand.miny),\n          id: getId()\n        }\n      });\n      call('changed', [element]);\n      keep = true;\n    }\n    break;\n  case 'text':\n    keep = true;\n    selectOnly([element]);\n    textActions.start(element);\n    break;\n  case 'path':\n    // set element to null here so that it is not removed nor finalized\n    element = null;\n    // continue to be set to true so that mouseMove happens\n    started = true;\n\n    const res = pathActions.mouseUp(evt, element, mouseX, mouseY);\n    ({element} = res);\n    ({keep} = res);\n    break;\n  case 'pathedit':\n    keep = true;\n    element = null;\n    pathActions.mouseUp(evt);\n    break;\n  case 'textedit':\n    keep = false;\n    element = null;\n    textActions.mouseUp(evt, mouseX, mouseY);\n    break;\n  case 'rotate':\n    keep = true;\n    element = null;\n    currentMode = 'select';\n    const batchCmd = canvas.undoMgr.finishUndoableChange();\n    if (!batchCmd.isEmpty()) {\n      addCommandToHistory(batchCmd);\n    }\n    // perform recalculation to weed out any stray identity transforms that might get stuck\n    recalculateAllSelectedDimensions();\n    call('changed', selectedElements);\n    break;\n  default:\n    // This could occur in an extension\n    break;\n  }\n\n  /**\n  * The main (left) mouse button is released (anywhere)\n  * @event module:svgcanvas.SvgCanvas#event:ext-mouseUp\n  * @type {PlainObject}\n  * @property {MouseEvent} event The event object\n  * @property {Float} mouse_x x coordinate on canvas\n  * @property {Float} mouse_y y coordinate on canvas\n  */\n  const extResult = runExtensions('mouseUp', /** @type {module:svgcanvas.SvgCanvas#event:ext-mouseUp} */ {\n    event: evt,\n    mouse_x: mouseX,\n    mouse_y: mouseY\n  }, true);\n\n  $.each(extResult, function (i, r) {\n    if (r) {\n      keep = r.keep || keep;\n      ({element} = r);\n      started = r.started || started;\n    }\n  });\n\n  if (!keep && element != null) {\n    getCurrentDrawing().releaseId(getId());\n    element.remove();\n    element = null;\n\n    t = evt.target;\n\n    // if this element is in a group, go up until we reach the top-level group\n    // just below the layer groups\n    // TODO: once we implement links, we also would have to check for <a> elements\n    while (t && t.parentNode && t.parentNode.parentNode && t.parentNode.parentNode.tagName === 'g') {\n      t = t.parentNode;\n    }\n    // if we are not in the middle of creating a path, and we've clicked on some shape,\n    // then go to Select mode.\n    // WebKit returns <div> when the canvas is clicked, Firefox/Opera return <svg>\n    if ((currentMode !== 'path' || !drawnPath) &&\n      t && t.parentNode &&\n      t.parentNode.id !== 'selectorParentGroup' &&\n      t.id !== 'svgcanvas' && t.id !== 'svgroot'\n    ) {\n      // switch into \"select\" mode if we've clicked on an element\n      canvas.setMode('select');\n      selectOnly([t], true);\n    }\n  } else if (element != null) {\n    /**\n    * @name module:svgcanvas.SvgCanvas#addedNew\n    * @type {boolean}\n    */\n    canvas.addedNew = true;\n\n    if (useUnit) { convertAttrs(element); }\n\n    let aniDur = 0.2;\n    let cAni;\n    if (opacAni.beginElement && parseFloat(element.getAttribute('opacity')) !== curShape.opacity) {\n      cAni = $(opacAni).clone().attr({\n        to: curShape.opacity,\n        dur: aniDur\n      }).appendTo(element);\n      try {\n        // Fails in FF4 on foreignObject\n        cAni[0].beginElement();\n      } catch (e) {}\n    } else {\n      aniDur = 0;\n    }\n\n    // Ideally this would be done on the endEvent of the animation,\n    // but that doesn't seem to be supported in Webkit\n    setTimeout(function () {\n      if (cAni) { cAni.remove(); }\n      element.setAttribute('opacity', curShape.opacity);\n      element.setAttribute('style', 'pointer-events:inherit');\n      cleanupElement(element);\n      if (currentMode === 'path') {\n        pathActions.toEditMode(element);\n      } else if (curConfig.selectNew) {\n        selectOnly([element], true);\n      }\n      // we create the insert command that is stored on the stack\n      // undo means to call cmd.unapply(), redo means to call cmd.apply()\n      addCommandToHistory(new InsertElementCommand(element));\n\n      call('changed', [element]);\n    }, aniDur * 1000);\n  }\n\n  startTransform = null;\n};\n\nconst dblClick = function (evt) {\n  const evtTarget = evt.target;\n  const parent = evtTarget.parentNode;\n\n  // Do nothing if already in current group\n  if (parent === currentGroup) { return; }\n\n  let mouseTarget = getMouseTarget(evt);\n  const {tagName} = mouseTarget;\n\n  if (tagName === 'text' && currentMode !== 'textedit') {\n    const pt = transformPoint(evt.pageX, evt.pageY, rootSctm);\n    textActions.select(mouseTarget, pt.x, pt.y);\n  }\n\n  if ((tagName === 'g' || tagName === 'a') &&\n    getRotationAngle(mouseTarget)\n  ) {\n    // TODO: Allow method of in-group editing without having to do\n    // this (similar to editing rotated paths)\n\n    // Ungroup and regroup\n    pushGroupProperties(mouseTarget);\n    mouseTarget = selectedElements[0];\n    clearSelection(true);\n  }\n  // Reset context\n  if (currentGroup) {\n    draw.leaveContext();\n  }\n\n  if ((parent.tagName !== 'g' && parent.tagName !== 'a') ||\n    parent === getCurrentDrawing().getCurrentLayer() ||\n    mouseTarget === selectorManager.selectorParentGroup\n  ) {\n    // Escape from in-group edit\n    return;\n  }\n  draw.setContext(mouseTarget);\n};\n\n// prevent links from being followed in the canvas\nconst handleLinkInCanvas = function (e) {\n  e.preventDefault();\n  return false;\n};\n\n// Added mouseup to the container here.\n// TODO(codedread): Figure out why after the Closure compiler, the window mouseup is ignored.\n$(container).mousedown(mouseDown).mousemove(mouseMove).click(handleLinkInCanvas).dblclick(dblClick).mouseup(mouseUp);\n// $(window).mouseup(mouseUp);\n\n// TODO(rafaelcastrocouto): User preference for shift key and zoom factor\n$(container).bind(\n  'mousewheel DOMMouseScroll',\n  /**\n   * @param {Event} e\n   * @fires module:svgcanvas.SvgCanvas#event:updateCanvas\n   * @fires module:svgcanvas.SvgCanvas#event:zoomDone\n   * @returns {undefined}\n   */\n  function (e) {\n    if (!e.shiftKey) { return; }\n\n    e.preventDefault();\n    const evt = e.originalEvent;\n\n    rootSctm = $('#svgcontent g')[0].getScreenCTM().inverse();\n\n    const workarea = $('#workarea');\n    const scrbar = 15;\n    const rulerwidth = curConfig.showRulers ? 16 : 0;\n\n    // mouse relative to content area in content pixels\n    const pt = transformPoint(evt.pageX, evt.pageY, rootSctm);\n\n    // full work area width in screen pixels\n    const editorFullW = workarea.width();\n    const editorFullH = workarea.height();\n\n    // work area width minus scroll and ruler in screen pixels\n    const editorW = editorFullW - scrbar - rulerwidth;\n    const editorH = editorFullH - scrbar - rulerwidth;\n\n    // work area width in content pixels\n    const workareaViewW = editorW * rootSctm.a;\n    const workareaViewH = editorH * rootSctm.d;\n\n    // content offset from canvas in screen pixels\n    const wOffset = workarea.offset();\n    const wOffsetLeft = wOffset['left'] + rulerwidth;\n    const wOffsetTop = wOffset['top'] + rulerwidth;\n\n    const delta = (evt.wheelDelta) ? evt.wheelDelta : (evt.detail) ? -evt.detail : 0;\n    if (!delta) { return; }\n\n    let factor = Math.max(3 / 4, Math.min(4 / 3, (delta)));\n\n    let wZoom, hZoom;\n    if (factor > 1) {\n      wZoom = Math.ceil(editorW / workareaViewW * factor * 100) / 100;\n      hZoom = Math.ceil(editorH / workareaViewH * factor * 100) / 100;\n    } else {\n      wZoom = Math.floor(editorW / workareaViewW * factor * 100) / 100;\n      hZoom = Math.floor(editorH / workareaViewH * factor * 100) / 100;\n    }\n    let zoomlevel = Math.min(wZoom, hZoom);\n    zoomlevel = Math.min(10, Math.max(0.01, zoomlevel));\n    if (zoomlevel === currentZoom) {\n      return;\n    }\n    factor = zoomlevel / currentZoom;\n\n    // top left of workarea in content pixels before zoom\n    const topLeftOld = transformPoint(wOffsetLeft, wOffsetTop, rootSctm);\n\n    // top left of workarea in content pixels after zoom\n    const topLeftNew = {\n      x: pt.x - (pt.x - topLeftOld.x) / factor,\n      y: pt.y - (pt.y - topLeftOld.y) / factor\n    };\n\n    // top left of workarea in canvas pixels relative to content after zoom\n    const topLeftNewCanvas = {\n      x: topLeftNew.x * zoomlevel,\n      y: topLeftNew.y * zoomlevel\n    };\n\n    // new center in canvas pixels\n    const newCtr = {\n      x: topLeftNewCanvas.x - rulerwidth + editorFullW / 2,\n      y: topLeftNewCanvas.y - rulerwidth + editorFullH / 2\n    };\n\n    canvas.setZoom(zoomlevel);\n    $('#zoom').val((zoomlevel * 100).toFixed(1));\n\n    call('updateCanvas', {center: false, newCtr});\n    call('zoomDone');\n  }\n);\n}());\n\n/**\n* Group: Text edit functions\n* Functions relating to editing text elements\n* @namespace {PlainObject} textActions\n* @memberof module:svgcanvas.SvgCanvas#\n*/\nconst textActions = canvas.textActions = (function () {\nlet curtext;\nlet textinput;\nlet cursor;\nlet selblock;\nlet blinker;\nlet chardata = [];\nlet textbb; // , transbb;\nlet matrix;\nlet lastX, lastY;\nlet allowDbl;\n\nfunction setCursor (index) {\n  const empty = (textinput.value === '');\n  $(textinput).focus();\n\n  if (!arguments.length) {\n    if (empty) {\n      index = 0;\n    } else {\n      if (textinput.selectionEnd !== textinput.selectionStart) { return; }\n      index = textinput.selectionEnd;\n    }\n  }\n\n  const charbb = chardata[index];\n  if (!empty) {\n    textinput.setSelectionRange(index, index);\n  }\n  cursor = getElem('text_cursor');\n  if (!cursor) {\n    cursor = document.createElementNS(NS.SVG, 'line');\n    assignAttributes(cursor, {\n      id: 'text_cursor',\n      stroke: '#333',\n      'stroke-width': 1\n    });\n    cursor = getElem('selectorParentGroup').appendChild(cursor);\n  }\n\n  if (!blinker) {\n    blinker = setInterval(function () {\n      const show = (cursor.getAttribute('display') === 'none');\n      cursor.setAttribute('display', show ? 'inline' : 'none');\n    }, 600);\n  }\n\n  const startPt = ptToScreen(charbb.x, textbb.y);\n  const endPt = ptToScreen(charbb.x, (textbb.y + textbb.height));\n\n  assignAttributes(cursor, {\n    x1: startPt.x,\n    y1: startPt.y,\n    x2: endPt.x,\n    y2: endPt.y,\n    visibility: 'visible',\n    display: 'inline'\n  });\n\n  if (selblock) { selblock.setAttribute('d', ''); }\n}\n\nfunction setSelection (start, end, skipInput) {\n  if (start === end) {\n    setCursor(end);\n    return;\n  }\n\n  if (!skipInput) {\n    textinput.setSelectionRange(start, end);\n  }\n\n  selblock = getElem('text_selectblock');\n  if (!selblock) {\n    selblock = document.createElementNS(NS.SVG, 'path');\n    assignAttributes(selblock, {\n      id: 'text_selectblock',\n      fill: 'green',\n      opacity: 0.5,\n      style: 'pointer-events:none'\n    });\n    getElem('selectorParentGroup').append(selblock);\n  }\n\n  const startbb = chardata[start];\n  const endbb = chardata[end];\n\n  cursor.setAttribute('visibility', 'hidden');\n\n  const tl = ptToScreen(startbb.x, textbb.y),\n    tr = ptToScreen(startbb.x + (endbb.x - startbb.x), textbb.y),\n    bl = ptToScreen(startbb.x, textbb.y + textbb.height),\n    br = ptToScreen(startbb.x + (endbb.x - startbb.x), textbb.y + textbb.height);\n\n  const dstr = 'M' + tl.x + ',' + tl.y +\n    ' L' + tr.x + ',' + tr.y +\n    ' ' + br.x + ',' + br.y +\n    ' ' + bl.x + ',' + bl.y + 'z';\n\n  assignAttributes(selblock, {\n    d: dstr,\n    display: 'inline'\n  });\n}\n\nfunction getIndexFromPoint (mouseX, mouseY) {\n  // Position cursor here\n  const pt = svgroot.createSVGPoint();\n  pt.x = mouseX;\n  pt.y = mouseY;\n\n  // No content, so return 0\n  if (chardata.length === 1) { return 0; }\n  // Determine if cursor should be on left or right of character\n  let charpos = curtext.getCharNumAtPosition(pt);\n  if (charpos < 0) {\n    // Out of text range, look at mouse coords\n    charpos = chardata.length - 2;\n    if (mouseX <= chardata[0].x) {\n      charpos = 0;\n    }\n  } else if (charpos >= chardata.length - 2) {\n    charpos = chardata.length - 2;\n  }\n  const charbb = chardata[charpos];\n  const mid = charbb.x + (charbb.width / 2);\n  if (mouseX > mid) {\n    charpos++;\n  }\n  return charpos;\n}\n\nfunction setCursorFromPoint (mouseX, mouseY) {\n  setCursor(getIndexFromPoint(mouseX, mouseY));\n}\n\nfunction setEndSelectionFromPoint (x, y, apply) {\n  const i1 = textinput.selectionStart;\n  const i2 = getIndexFromPoint(x, y);\n\n  const start = Math.min(i1, i2);\n  const end = Math.max(i1, i2);\n  setSelection(start, end, !apply);\n}\n\nfunction screenToPt (xIn, yIn) {\n  const out = {\n    x: xIn,\n    y: yIn\n  };\n\n  out.x /= currentZoom;\n  out.y /= currentZoom;\n\n  if (matrix) {\n    const pt = transformPoint(out.x, out.y, matrix.inverse());\n    out.x = pt.x;\n    out.y = pt.y;\n  }\n\n  return out;\n}\n\nfunction ptToScreen (xIn, yIn) {\n  const out = {\n    x: xIn,\n    y: yIn\n  };\n\n  if (matrix) {\n    const pt = transformPoint(out.x, out.y, matrix);\n    out.x = pt.x;\n    out.y = pt.y;\n  }\n\n  out.x *= currentZoom;\n  out.y *= currentZoom;\n\n  return out;\n}\n\n/*\n// Not currently in use\nfunction hideCursor () {\n  if (cursor) {\n    cursor.setAttribute('visibility', 'hidden');\n  }\n}\n*/\n\nfunction selectAll (evt) {\n  setSelection(0, curtext.textContent.length);\n  $(this).unbind(evt);\n}\n\nfunction selectWord (evt) {\n  if (!allowDbl || !curtext) { return; }\n\n  const ept = transformPoint(evt.pageX, evt.pageY, rootSctm),\n    mouseX = ept.x * currentZoom,\n    mouseY = ept.y * currentZoom;\n  const pt = screenToPt(mouseX, mouseY);\n\n  const index = getIndexFromPoint(pt.x, pt.y);\n  const str = curtext.textContent;\n  const first = str.substr(0, index).replace(/[a-z0-9]+$/i, '').length;\n  const m = str.substr(index).match(/^[a-z0-9]+/i);\n  const last = (m ? m[0].length : 0) + index;\n  setSelection(first, last);\n\n  // Set tripleclick\n  $(evt.target).click(selectAll);\n  setTimeout(function () {\n    $(evt.target).unbind('click', selectAll);\n  }, 300);\n}\n\nreturn /** @lends module:svgcanvas.SvgCanvas#textActions */ {\n  /**\n  * @param {Element} target\n  * @param {Float} x\n  * @param {Float} y\n  * @returns {undefined}\n  */\n  select (target, x, y) {\n    curtext = target;\n    textActions.toEditMode(x, y);\n  },\n  /**\n  * @param {Element} elem\n  * @returns {undefined}\n  */\n  start (elem) {\n    curtext = elem;\n    textActions.toEditMode();\n  },\n  /**\n  * @param {external:MouseEvent} evt\n  * @param {Element} mouseTarget\n  * @param {Float} startX\n  * @param {Float} startY\n  * @returns {undefined}\n  */\n  mouseDown (evt, mouseTarget, startX, startY) {\n    const pt = screenToPt(startX, startY);\n\n    textinput.focus();\n    setCursorFromPoint(pt.x, pt.y);\n    lastX = startX;\n    lastY = startY;\n\n    // TODO: Find way to block native selection\n  },\n  /**\n  * @param {Float} mouseX\n  * @param {Float} mouseY\n  * @returns {undefined}\n  */\n  mouseMove (mouseX, mouseY) {\n    const pt = screenToPt(mouseX, mouseY);\n    setEndSelectionFromPoint(pt.x, pt.y);\n  },\n  /**\n  * @param {external:MouseEvent}\n  * @param {Float} mouseX\n  * @param {Float} mouseY\n  * @returns {undefined}\n  */\n  mouseUp (evt, mouseX, mouseY) {\n    const pt = screenToPt(mouseX, mouseY);\n\n    setEndSelectionFromPoint(pt.x, pt.y, true);\n\n    // TODO: Find a way to make this work: Use transformed BBox instead of evt.target\n    // if (lastX === mouseX && lastY === mouseY\n    //   && !rectsIntersect(transbb, {x: pt.x, y: pt.y, width: 0, height: 0})) {\n    //   textActions.toSelectMode(true);\n    // }\n\n    if (\n      evt.target !== curtext &&\n      mouseX < lastX + 2 &&\n      mouseX > lastX - 2 &&\n      mouseY < lastY + 2 &&\n      mouseY > lastY - 2\n    ) {\n      textActions.toSelectMode(true);\n    }\n  },\n  /**\n  * @function\n  * @param {Integer} index\n  * @returns {undefined}\n  */\n  setCursor,\n  /**\n  * @param {Float} x\n  * @param {Float} y\n  * @returns {undefined}\n  */\n  toEditMode (x, y) {\n    allowDbl = false;\n    currentMode = 'textedit';\n    selectorManager.requestSelector(curtext).showGrips(false);\n    // Make selector group accept clicks\n    /* const selector = */ selectorManager.requestSelector(curtext); // Do we need this? Has side effect of setting lock, so keeping for now, but next line wasn't being used\n    // const sel = selector.selectorRect;\n\n    textActions.init();\n\n    $(curtext).css('cursor', 'text');\n\n    // if (supportsEditableText()) {\n    //   curtext.setAttribute('editable', 'simple');\n    //   return;\n    // }\n\n    if (!arguments.length) {\n      setCursor();\n    } else {\n      const pt = screenToPt(x, y);\n      setCursorFromPoint(pt.x, pt.y);\n    }\n\n    setTimeout(function () {\n      allowDbl = true;\n    }, 300);\n  },\n  /**\n  * @param {boolean|Element} selectElem\n  * @fires module:svgcanvas.SvgCanvas#event:selected\n  * @returns {undefined}\n  */\n  toSelectMode (selectElem) {\n    currentMode = 'select';\n    clearInterval(blinker);\n    blinker = null;\n    if (selblock) { $(selblock).attr('display', 'none'); }\n    if (cursor) { $(cursor).attr('visibility', 'hidden'); }\n    $(curtext).css('cursor', 'move');\n\n    if (selectElem) {\n      clearSelection();\n      $(curtext).css('cursor', 'move');\n\n      call('selected', [curtext]);\n      addToSelection([curtext], true);\n    }\n    if (curtext && !curtext.textContent.length) {\n      // No content, so delete\n      canvas.deleteSelectedElements();\n    }\n\n    $(textinput).blur();\n\n    curtext = false;\n\n    // if (supportsEditableText()) {\n    //   curtext.removeAttribute('editable');\n    // }\n  },\n  /**\n  * @param {Element} elem\n  * @returns {undefined}\n  */\n  setInputElem (elem) {\n    textinput = elem;\n    // $(textinput).blur(hideCursor);\n  },\n  /**\n  * @returns {undefined}\n  */\n  clear () {\n    if (currentMode === 'textedit') {\n      textActions.toSelectMode();\n    }\n  },\n  /**\n  * @param {Element} inputElem Not in use\n  * @returns {undefined}\n  */\n  init (inputElem) {\n    if (!curtext) { return; }\n    let i, end;\n    // if (supportsEditableText()) {\n    //   curtext.select();\n    //   return;\n    // }\n\n    if (!curtext.parentNode) {\n      // Result of the ffClone, need to get correct element\n      curtext = selectedElements[0];\n      selectorManager.requestSelector(curtext).showGrips(false);\n    }\n\n    const str = curtext.textContent;\n    const len = str.length;\n\n    const xform = curtext.getAttribute('transform');\n\n    textbb = utilsGetBBox(curtext);\n\n    matrix = xform ? getMatrix(curtext) : null;\n\n    chardata = [];\n    chardata.length = len;\n    textinput.focus();\n\n    $(curtext).unbind('dblclick', selectWord).dblclick(selectWord);\n\n    if (!len) {\n      end = {x: textbb.x + (textbb.width / 2), width: 0};\n    }\n\n    for (i = 0; i < len; i++) {\n      const start = curtext.getStartPositionOfChar(i);\n      end = curtext.getEndPositionOfChar(i);\n\n      if (!supportsGoodTextCharPos()) {\n        const offset = canvas.contentW * currentZoom;\n        start.x -= offset;\n        end.x -= offset;\n\n        start.x /= currentZoom;\n        end.x /= currentZoom;\n      }\n\n      // Get a \"bbox\" equivalent for each character. Uses the\n      // bbox data of the actual text for y, height purposes\n\n      // TODO: Decide if y, width and height are actually necessary\n      chardata[i] = {\n        x: start.x,\n        y: textbb.y, // start.y?\n        width: end.x - start.x,\n        height: textbb.height\n      };\n    }\n\n    // Add a last bbox for cursor at end of text\n    chardata.push({\n      x: end.x,\n      width: 0\n    });\n    setSelection(textinput.selectionStart, textinput.selectionEnd, true);\n  }\n};\n}());\n\n/**\n* Group: Serialization\n*/\n\n/**\n* Looks at DOM elements inside the `<defs>` to see if they are referred to,\n* removes them from the DOM if they are not.\n* @function module:svgcanvas.SvgCanvas#removeUnusedDefElems\n* @returns {Integer} The number of elements that were removed\n*/\nconst removeUnusedDefElems = this.removeUnusedDefElems = function () {\n  const defs = svgcontent.getElementsByTagNameNS(NS.SVG, 'defs');\n  if (!defs || !defs.length) { return 0; }\n\n  // if (!defs.firstChild) { return; }\n\n  const defelemUses = [];\n  let numRemoved = 0;\n  const attrs = ['fill', 'stroke', 'filter', 'marker-start', 'marker-mid', 'marker-end'];\n  const alen = attrs.length;\n\n  const allEls = svgcontent.getElementsByTagNameNS(NS.SVG, '*');\n  const allLen = allEls.length;\n\n  let i, j;\n  for (i = 0; i < allLen; i++) {\n    const el = allEls[i];\n    for (j = 0; j < alen; j++) {\n      const ref = getUrlFromAttr(el.getAttribute(attrs[j]));\n      if (ref) {\n        defelemUses.push(ref.substr(1));\n      }\n    }\n\n    // gradients can refer to other gradients\n    const href = getHref(el);\n    if (href && href.startsWith('#')) {\n      defelemUses.push(href.substr(1));\n    }\n  }\n\n  const defelems = $(defs).find('linearGradient, radialGradient, filter, marker, svg, symbol');\n  i = defelems.length;\n  while (i--) {\n    const defelem = defelems[i];\n    const {id} = defelem;\n    if (!defelemUses.includes(id)) {\n      // Not found, so remove (but remember)\n      removedElements[id] = defelem;\n      defelem.remove();\n      numRemoved++;\n    }\n  }\n\n  return numRemoved;\n};\n\n/**\n* Main function to set up the SVG content for output\n* @function module:svgcanvas.SvgCanvas#svgCanvasToString\n* @returns {string} The SVG image for output\n*/\nthis.svgCanvasToString = function () {\n  // keep calling it until there are none to remove\n  while (removeUnusedDefElems() > 0) {}\n\n  pathActions.clear(true);\n\n  // Keep SVG-Edit comment on top\n  $.each(svgcontent.childNodes, function (i, node) {\n    if (i && node.nodeType === 8 && node.data.includes('Created with')) {\n      svgcontent.firstChild.before(node);\n    }\n  });\n\n  // Move out of in-group editing mode\n  if (currentGroup) {\n    draw.leaveContext();\n    selectOnly([currentGroup]);\n  }\n\n  const nakedSvgs = [];\n\n  // Unwrap gsvg if it has no special attributes (only id and style)\n  $(svgcontent).find('g:data(gsvg)').each(function () {\n    const attrs = this.attributes;\n    let len = attrs.length;\n    for (let i = 0; i < len; i++) {\n      if (attrs[i].nodeName === 'id' || attrs[i].nodeName === 'style') {\n        len--;\n      }\n    }\n    // No significant attributes, so ungroup\n    if (len <= 0) {\n      const svg = this.firstChild;\n      nakedSvgs.push(svg);\n      $(this).replaceWith(svg);\n    }\n  });\n  const output = this.svgToString(svgcontent, 0);\n\n  // Rewrap gsvg\n  if (nakedSvgs.length) {\n    $(nakedSvgs).each(function () {\n      groupSvgElem(this);\n    });\n  }\n\n  return output;\n};\n\n/**\n* Sub function ran on each SVG element to convert it to a string as desired\n* @function module:svgcanvas.SvgCanvas#svgToString\n* @param {Element} elem - The SVG element to convert\n* @param {Integer} indent - Number of spaces to indent this tag\n* @returns {string} The given element as an SVG tag\n*/\nthis.svgToString = function (elem, indent) {\n  const out = [];\n  const unit = curConfig.baseUnit;\n  const unitRe = new RegExp('^-?[\\\\d\\\\.]+' + unit + '$');\n\n  if (elem) {\n    cleanupElement(elem);\n    const attrs = Array.from(elem.attributes);\n    let i;\n    const childs = elem.childNodes;\n    attrs.sort((a, b) => a.name > b.name ? -1 : 1);\n\n    for (i = 0; i < indent; i++) { out.push(' '); }\n    out.push('<'); out.push(elem.nodeName);\n    if (elem.id === 'svgcontent') {\n      // Process root element separately\n      const res = getResolution();\n\n      const vb = '';\n      // TODO: Allow this by dividing all values by current baseVal\n      // Note that this also means we should properly deal with this on import\n      // if (curConfig.baseUnit !== 'px') {\n      //   const unit = curConfig.baseUnit;\n      //   const unitM = getTypeMap()[unit];\n      //   res.w = shortFloat(res.w / unitM);\n      //   res.h = shortFloat(res.h / unitM);\n      //   vb = ' viewBox=\"' + [0, 0, res.w, res.h].join(' ') + '\"';\n      //   res.w += unit;\n      //   res.h += unit;\n      // }\n\n      if (unit !== 'px') {\n        res.w = convertUnit(res.w, unit) + unit;\n        res.h = convertUnit(res.h, unit) + unit;\n      }\n\n      out.push(' width=\"' + res.w + '\" height=\"' + res.h + '\"' + vb + ' xmlns=\"' + NS.SVG + '\"');\n\n      const nsuris = {};\n\n      // Check elements for namespaces, add if found\n      $(elem).find('*').andSelf().each(function () {\n        // const el = this;\n        // for some elements have no attribute\n        const uri = this.namespaceURI;\n        if (uri && !nsuris[uri] && nsMap[uri] && nsMap[uri] !== 'xmlns' && nsMap[uri] !== 'xml') {\n          nsuris[uri] = true;\n          out.push(' xmlns:' + nsMap[uri] + '=\"' + uri + '\"');\n        }\n\n        $.each(this.attributes, function (i, attr) {\n          const uri = attr.namespaceURI;\n          if (uri && !nsuris[uri] && nsMap[uri] !== 'xmlns' && nsMap[uri] !== 'xml') {\n            nsuris[uri] = true;\n            out.push(' xmlns:' + nsMap[uri] + '=\"' + uri + '\"');\n          }\n        });\n      });\n\n      i = attrs.length;\n      const attrNames = ['width', 'height', 'xmlns', 'x', 'y', 'viewBox', 'id', 'overflow'];\n      while (i--) {\n        const attr = attrs[i];\n        const attrVal = toXml(attr.value);\n\n        // Namespaces have already been dealt with, so skip\n        if (attr.nodeName.startsWith('xmlns:')) { continue; }\n\n        // only serialize attributes we don't use internally\n        if (attrVal !== '' && !attrNames.includes(attr.localName)) {\n          if (!attr.namespaceURI || nsMap[attr.namespaceURI]) {\n            out.push(' ');\n            out.push(attr.nodeName); out.push('=\"');\n            out.push(attrVal); out.push('\"');\n          }\n        }\n      }\n    } else {\n      // Skip empty defs\n      if (elem.nodeName === 'defs' && !elem.firstChild) { return; }\n\n      const mozAttrs = ['-moz-math-font-style', '_moz-math-font-style'];\n      for (i = attrs.length - 1; i >= 0; i--) {\n        const attr = attrs[i];\n        let attrVal = toXml(attr.value);\n        // remove bogus attributes added by Gecko\n        if (mozAttrs.includes(attr.localName)) { continue; }\n        if (attrVal !== '') {\n          if (attrVal.startsWith('pointer-events')) { continue; }\n          if (attr.localName === 'class' && attrVal.startsWith('se_')) { continue; }\n          out.push(' ');\n          if (attr.localName === 'd') { attrVal = pathActions.convertPath(elem, true); }\n          if (!isNaN(attrVal)) {\n            attrVal = shortFloat(attrVal);\n          } else if (unitRe.test(attrVal)) {\n            attrVal = shortFloat(attrVal) + unit;\n          }\n\n          // Embed images when saving\n          if (saveOptions.apply &&\n            elem.nodeName === 'image' &&\n            attr.localName === 'href' &&\n            saveOptions.images &&\n            saveOptions.images === 'embed'\n          ) {\n            const img = encodableImages[attrVal];\n            if (img) { attrVal = img; }\n          }\n\n          // map various namespaces to our fixed namespace prefixes\n          // (the default xmlns attribute itself does not get a prefix)\n          if (!attr.namespaceURI || attr.namespaceURI === NS.SVG || nsMap[attr.namespaceURI]) {\n            out.push(attr.nodeName); out.push('=\"');\n            out.push(attrVal); out.push('\"');\n          }\n        }\n      }\n    }\n\n    if (elem.hasChildNodes()) {\n      out.push('>');\n      indent++;\n      let bOneLine = false;\n\n      for (i = 0; i < childs.length; i++) {\n        const child = childs.item(i);\n        switch (child.nodeType) {\n        case 1: // element node\n          out.push('\\n');\n          out.push(this.svgToString(childs.item(i), indent));\n          break;\n        case 3: // text node\n          const str = child.nodeValue.replace(/^\\s+|\\s+$/g, '');\n          if (str !== '') {\n            bOneLine = true;\n            out.push(String(toXml(str)));\n          }\n          break;\n        case 4: // cdata node\n          out.push('\\n');\n          out.push(new Array(indent + 1).join(' '));\n          out.push('<![CDATA[');\n          out.push(child.nodeValue);\n          out.push(']]>');\n          break;\n        case 8: // comment\n          out.push('\\n');\n          out.push(new Array(indent + 1).join(' '));\n          out.push('<!--');\n          out.push(child.data);\n          out.push('-->');\n          break;\n        } // switch on node type\n      }\n      indent--;\n      if (!bOneLine) {\n        out.push('\\n');\n        for (i = 0; i < indent; i++) { out.push(' '); }\n      }\n      out.push('</'); out.push(elem.nodeName); out.push('>');\n    } else {\n      out.push('/>');\n    }\n  }\n  return out.join('');\n}; // end svgToString()\n\n/**\n * Function to run when image data is found\n * @callback module:svgcanvas.ImageEmbeddedCallback\n * @param {string|false} result Data URL\n * @returns {undefined}\n */\n/**\n* Converts a given image file to a data URL when possible, then runs a given callback\n* @function module:svgcanvas.SvgCanvas#embedImage\n* @param {string} src - The path/URL of the image\n* @param {module:svgcanvas.ImageEmbeddedCallback} [callback] - Function to run when image data is found\n* @returns {Promise} Resolves to Data URL (string|false)\n*/\nthis.embedImage = function (src, callback) {\n  return new Promise(function (resolve, reject) {\n    // load in the image and once it's loaded, get the dimensions\n    $(new Image()).load(function (response, status, xhr) {\n      if (status === 'error') {\n        reject(new Error('Error loading image: ' + xhr.status + ' ' + xhr.statusText));\n        return;\n      }\n      // create a canvas the same size as the raster image\n      const cvs = document.createElement('canvas');\n      cvs.width = this.width;\n      cvs.height = this.height;\n      // load the raster image into the canvas\n      cvs.getContext('2d').drawImage(this, 0, 0);\n      // retrieve the data: URL\n      try {\n        let urldata = ';svgedit_url=' + encodeURIComponent(src);\n        urldata = cvs.toDataURL().replace(';base64', urldata + ';base64');\n        encodableImages[src] = urldata;\n      } catch (e) {\n        encodableImages[src] = false;\n      }\n      lastGoodImgUrl = src;\n      if (callback) { callback(encodableImages[src]); }\n      resolve(encodableImages[src]);\n    }).attr('src', src);\n  });\n};\n\n/**\n* Sets a given URL to be a \"last good image\" URL\n* @function module:svgcanvas.SvgCanvas#setGoodImage\n* @param {string} val\n* @returns {undefined}\n*/\nthis.setGoodImage = function (val) {\n  lastGoodImgUrl = val;\n};\n\n/**\n* Does nothing by default, handled by optional widget/extension\n* @function module:svgcanvas.SvgCanvas#open\n* @returns {undefined}\n*/\nthis.open = function () {\n};\n\n/**\n* Serializes the current drawing into SVG XML text and passes it to the 'saved' handler.\n* This function also includes the XML prolog. Clients of the `SvgCanvas` bind their save\n* function to the 'saved' event.\n* @function module:svgcanvas.SvgCanvas#save\n* @param {module:svgcanvas.SaveOptions} opts\n* @fires module:svgcanvas.SvgCanvas#event:saved\n* @returns {undefined}\n*/\nthis.save = function (opts) {\n  // remove the selected outline before serializing\n  clearSelection();\n  // Update save options if provided\n  if (opts) { $.extend(saveOptions, opts); }\n  saveOptions.apply = true;\n\n  // no need for doctype, see https://jwatt.org/svg/authoring/#doctype-declaration\n  const str = this.svgCanvasToString();\n  call('saved', str);\n};\n\n/**\n* Codes only is useful for locale-independent detection\n*/\nfunction getIssues () {\n  // remove the selected outline before serializing\n  clearSelection();\n\n  // Check for known CanVG issues\n  const issues = [];\n  const issueCodes = [];\n\n  // Selector and notice\n  const issueList = {\n    feGaussianBlur: uiStrings.exportNoBlur,\n    foreignObject: uiStrings.exportNoforeignObject,\n    '[stroke-dasharray]': uiStrings.exportNoDashArray\n  };\n  const content = $(svgcontent);\n\n  // Add font/text check if Canvas Text API is not implemented\n  if (!('font' in $('<canvas>')[0].getContext('2d'))) {\n    issueList.text = uiStrings.exportNoText;\n  }\n\n  $.each(issueList, function (sel, descr) {\n    if (content.find(sel).length) {\n      issueCodes.push(sel);\n      issues.push(descr);\n    }\n  });\n  return {issues, issueCodes};\n}\n\nlet canvg;\n/**\n* @typedef {\"feGaussianBlur\"|\"foreignObject\"|\"[stroke-dasharray]\"|\"text\"} module:svgcanvas.IssueCode\n*/\n/**\n* @typedef {PlainObject} module:svgcanvas.ImageExportedResults\n* @property {string} datauri Contents as a Data URL\n* @property {string} bloburl May be the empty string\n* @property {string} svg The SVG contents as a string\n* @property {string[]} issues The localization messages of `issueCodes`\n* @property {module:svgcanvas.IssueCode[]} issueCodes CanVG issues found with the SVG\n* @property {\"PNG\"|\"JPEG\"|\"BMP\"|\"WEBP\"|\"ICO\"} type The chosen image type\n* @property {\"image/png\"|\"image/jpeg\"|\"image/bmp\"|\"image/webp\"} mimeType The image MIME type\n* @property {Float} quality A decimal between 0 and 1 (for use with JPEG or WEBP)\n* @property {string} exportWindowName A convenience for passing along a `window.name` to target a window on which the export could be added\n*/\n\n/**\n * Function to run when image data is found\n * @callback module:svgcanvas.ImageExportedCallback\n * @param {module:svgcanvas.ImageExportedResults} obj\n * @returns {undefined}\n */\n/**\n* Generates a PNG (or JPG, BMP, WEBP) Data URL based on the current image,\n* then calls \"exported\" with an object including the string, image\n* information, and any issues found\n* @function module:svgcanvas.SvgCanvas#rasterExport\n* @param {\"PNG\"|\"JPEG\"|\"BMP\"|\"WEBP\"|\"ICO\"} [imgType=\"PNG\"]\n* @param {Float} [quality] Between 0 and 1\n* @param {string} [exportWindowName]\n* @param {module:svgcanvas.ImageExportedCallback} [cb]\n* @fires module:svgcanvas.SvgCanvas#event:exported\n* @todo Confirm/fix ICO type\n* @returns {Promise} Resolves to {@link module:svgcanvas.ImageExportedResults}\n*/\nthis.rasterExport = function (imgType, quality, exportWindowName, cb) {\n  const type = imgType === 'ICO' ? 'BMP' : (imgType || 'PNG');\n  const mimeType = 'image/' + type.toLowerCase();\n  const {issues, issueCodes} = getIssues();\n  const svg = this.svgCanvasToString();\n\n  return new Promise(async (resolve, reject) => {\n    if (!canvg) {\n      ({canvg} = await importSetGlobal(curConfig.canvgPath + 'canvg.js', {\n        global: 'canvg'\n      }));\n    }\n    if (!$('#export_canvas').length) {\n      $('<canvas>', {id: 'export_canvas'}).hide().appendTo('body');\n    }\n    const c = $('#export_canvas')[0];\n    c.width = canvas.contentW;\n    c.height = canvas.contentH;\n\n    await canvg(c, svg);\n    const dataURLType = type.toLowerCase();\n    const datauri = quality\n      ? c.toDataURL('image/' + dataURLType, quality)\n      : c.toDataURL('image/' + dataURLType);\n    let bloburl;\n    function done () {\n      const obj = {\n        datauri, bloburl, svg, issues, issueCodes, type: imgType,\n        mimeType, quality, exportWindowName\n      };\n      call('exported', obj);\n      if (cb) {\n        cb(obj);\n      }\n      resolve(obj);\n    }\n    if (c.toBlob) {\n      c.toBlob((blob) => {\n        bloburl = createObjectURL(blob);\n        done();\n      }, mimeType, quality);\n      return;\n    }\n    bloburl = dataURLToObjectURL(datauri);\n    done();\n  });\n};\n/**\n * @external jsPDF\n */\n/**\n * @typedef {undefined|\"save\"|\"arraybuffer\"|\"blob\"|\"datauristring\"|\"dataurlstring\"|\"dataurlnewwindow\"|\"datauri\"|\"dataurl\"} external:jsPDF.OutputType\n * @todo Newer version to add also allows these `outputType` values \"bloburi\"|\"bloburl\" which return strings, so document here and for `outputType` of `module:svgcanvas.PDFExportedResults` below if added\n*/\n/**\n* @typedef {PlainObject} module:svgcanvas.PDFExportedResults\n* @property {string} svg The SVG PDF output\n* @property {string|ArrayBuffer|Blob|window} output The output based on the `outputType`;\n* if `undefined`, \"datauristring\", \"dataurlstring\", \"datauri\",\n* or \"dataurl\", will be a string (`undefined` gives a document, while the others\n* build as Data URLs; \"datauri\" and \"dataurl\" change the location of the current page); if\n* \"arraybuffer\", will return `ArrayBuffer`; if \"blob\", returns a `Blob`;\n* if \"dataurlnewwindow\", will change the current page's location and return a string\n* if in Safari and no window object is found; otherwise opens in, and returns, a new `window`\n* object; if \"save\", will have the same return as \"dataurlnewwindow\" if\n* `navigator.getUserMedia` support is found without `URL.createObjectURL` support; otherwise\n* returns `undefined` but attempts to save\n* @property {external:jsPDF.OutputType} outputType\n* @property {string[]} issues The human-readable localization messages of corresponding `issueCodes`\n* @property {module:svgcanvas.IssueCode[]} issueCodes\n* @property {string} exportWindowName\n*/\n\n/**\n * Function to run when PDF data is found\n * @callback module:svgcanvas.PDFExportedCallback\n * @param {module:svgcanvas.PDFExportedResults} obj\n * @returns {undefined}\n */\n/**\n* Generates a PDF based on the current image, then calls \"exportedPDF\" with\n* an object including the string, the data URL, and any issues found\n* @function module:svgcanvas.SvgCanvas#exportPDF\n* @param {string} exportWindowName\n* @param {external:jsPDF.OutputType} [outputType=\"dataurlstring\"]\n* @param {module:svgcanvas.PDFExportedCallback} cb\n* @fires module:svgcanvas.SvgCanvas#event:exportedPDF\n* @returns {Promise} Resolves to {@link module:svgcanvas.PDFExportedResults}\n*/\nthis.exportPDF = function (exportWindowName, outputType, cb) {\n  const that = this;\n  return new Promise(async (resolve, reject) => {\n    if (!window.jsPDF) {\n      // Todo: Switch to `import()` when widely supported and available (also allow customization of path)\n      await importScript([\n        // We do not currently have these paths configurable as they are\n        //   currently global-only, so not Rolled-up\n        'jspdf/underscore-min.js',\n        'jspdf/jspdf.min.js'\n      ]);\n\n      const modularVersion = !('svgEditor' in window) ||\n        !window.svgEditor ||\n        window.svgEditor.modules !== false;\n      // Todo: Switch to `import()` when widely supported and available (also allow customization of path)\n      await importScript(curConfig.jspdfPath + 'jspdf.plugin.svgToPdf.js', {\n        type: modularVersion\n          ? 'module'\n          : 'text/javascript'\n      });\n      // await importModule('jspdf/jspdf.plugin.svgToPdf.js');\n    }\n\n    const res = getResolution();\n    const orientation = res.w > res.h ? 'landscape' : 'portrait';\n    const unit = 'pt'; // curConfig.baseUnit; // We could use baseUnit, but that is presumably not intended for export purposes\n\n    // Todo: Give options to use predefined jsPDF formats like \"a4\", etc. from pull-down (with option to keep customizable)\n    const doc = jsPDF({\n      orientation,\n      unit,\n      format: [res.w, res.h]\n      // , compressPdf: true\n    });\n    const docTitle = getDocumentTitle();\n    doc.setProperties({\n      title: docTitle /* ,\n      subject: '',\n      author: '',\n      keywords: '',\n      creator: '' */\n    });\n    const {issues, issueCodes} = getIssues();\n    const svg = that.svgCanvasToString();\n    doc.addSVG(svg, 0, 0);\n\n    // doc.output('save'); // Works to open in a new\n    //  window; todo: configure this and other export\n    //  options to optionally work in this manner as\n    //  opposed to opening a new tab\n    outputType = outputType || 'dataurlstring';\n    const obj = {svg, issues, issueCodes, exportWindowName, outputType};\n    obj.output = doc.output(outputType);\n    if (cb) {\n      cb(obj);\n    }\n    resolve(obj);\n    call('exportedPDF', obj);\n  });\n};\n\n/**\n* Returns the current drawing as raw SVG XML text.\n* @function module:svgcanvas.SvgCanvas#getSvgString\n* @returns {string} The current drawing as raw SVG XML text.\n*/\nthis.getSvgString = function () {\n  saveOptions.apply = false;\n  return this.svgCanvasToString();\n};\n\n/**\n* This function determines whether to use a nonce in the prefix, when\n* generating IDs for future documents in SVG-Edit.\n* If you're controlling SVG-Edit externally, and want randomized IDs, call\n* this BEFORE calling svgCanvas.setSvgString\n* @function module:svgcanvas.SvgCanvas#randomizeIds\n* @param {boolean} [enableRandomization] If true, adds a nonce to the prefix. Thus\n* `svgCanvas.randomizeIds() <==> svgCanvas.randomizeIds(true)`\n* @returns {undefined}\n*/\nthis.randomizeIds = function (enableRandomization) {\n  if (arguments.length > 0 && enableRandomization === false) {\n    draw.randomizeIds(false, getCurrentDrawing());\n  } else {\n    draw.randomizeIds(true, getCurrentDrawing());\n  }\n};\n\n/**\n* Ensure each element has a unique ID\n* @function module:svgcanvas.SvgCanvas#uniquifyElems\n* @param {Element} g - The parent element of the tree to give unique IDs\n* @returns {undefined}\n*/\nconst uniquifyElems = this.uniquifyElems = function (g) {\n  const ids = {};\n  // TODO: Handle markers and connectors. These are not yet re-identified properly\n  // as their referring elements do not get remapped.\n  //\n  // <marker id='se_marker_end_svg_7'/>\n  // <polyline id='svg_7' se:connector='svg_1 svg_6' marker-end='url(#se_marker_end_svg_7)'/>\n  //\n  // Problem #1: if svg_1 gets renamed, we do not update the polyline's se:connector attribute\n  // Problem #2: if the polyline svg_7 gets renamed, we do not update the marker id nor the polyline's marker-end attribute\n  const refElems = ['filter', 'linearGradient', 'pattern', 'radialGradient', 'symbol', 'textPath', 'use'];\n\n  walkTree(g, function (n) {\n    // if it's an element node\n    if (n.nodeType === 1) {\n      // and the element has an ID\n      if (n.id) {\n        // and we haven't tracked this ID yet\n        if (!(n.id in ids)) {\n          // add this id to our map\n          ids[n.id] = {elem: null, attrs: [], hrefs: []};\n        }\n        ids[n.id].elem = n;\n      }\n\n      // now search for all attributes on this element that might refer\n      // to other elements\n      $.each(refAttrs, function (i, attr) {\n        const attrnode = n.getAttributeNode(attr);\n        if (attrnode) {\n          // the incoming file has been sanitized, so we should be able to safely just strip off the leading #\n          const url = getUrlFromAttr(attrnode.value),\n            refid = url ? url.substr(1) : null;\n          if (refid) {\n            if (!(refid in ids)) {\n              // add this id to our map\n              ids[refid] = {elem: null, attrs: [], hrefs: []};\n            }\n            ids[refid].attrs.push(attrnode);\n          }\n        }\n      });\n\n      // check xlink:href now\n      const href = getHref(n);\n      // TODO: what if an <image> or <a> element refers to an element internally?\n      if (href && refElems.includes(n.nodeName)) {\n        const refid = href.substr(1);\n        if (refid) {\n          if (!(refid in ids)) {\n            // add this id to our map\n            ids[refid] = {elem: null, attrs: [], hrefs: []};\n          }\n          ids[refid].hrefs.push(n);\n        }\n      }\n    }\n  });\n\n  // in ids, we now have a map of ids, elements and attributes, let's re-identify\n  for (const oldid in ids) {\n    if (!oldid) { continue; }\n    const {elem} = ids[oldid];\n    if (elem) {\n      const newid = getNextId();\n\n      // assign element its new id\n      elem.id = newid;\n\n      // remap all url() attributes\n      const {attrs} = ids[oldid];\n      let j = attrs.length;\n      while (j--) {\n        const attr = attrs[j];\n        attr.ownerElement.setAttribute(attr.name, 'url(#' + newid + ')');\n      }\n\n      // remap all href attributes\n      const hreffers = ids[oldid].hrefs;\n      let k = hreffers.length;\n      while (k--) {\n        const hreffer = hreffers[k];\n        setHref(hreffer, '#' + newid);\n      }\n    }\n  }\n};\n\n/**\n* Assigns reference data for each use element\n* @function module:svgcanvas.SvgCanvas#setUseData\n* @param {Element} parent\n* @returns {undefined}\n*/\nconst setUseData = this.setUseData = function (parent) {\n  let elems = $(parent);\n\n  if (parent.tagName !== 'use') {\n    elems = elems.find('use');\n  }\n\n  elems.each(function () {\n    const id = getHref(this).substr(1);\n    const refElem = getElem(id);\n    if (!refElem) { return; }\n    $(this).data('ref', refElem);\n    if (refElem.tagName === 'symbol' || refElem.tagName === 'svg') {\n      $(this).data('symbol', refElem).data('ref', refElem);\n    }\n  });\n};\n\n/**\n* Converts gradients from userSpaceOnUse to objectBoundingBox\n* @function module:svgcanvas.SvgCanvas#convertGradients\n* @param {Element} elem\n* @returns {undefined}\n*/\nconst convertGradients = this.convertGradients = function (elem) {\n  let elems = $(elem).find('linearGradient, radialGradient');\n  if (!elems.length && isWebkit()) {\n    // Bug in webkit prevents regular *Gradient selector search\n    elems = $(elem).find('*').filter(function () {\n      return (this.tagName.includes('Gradient'));\n    });\n  }\n\n  elems.each(function () {\n    const grad = this;\n    if ($(grad).attr('gradientUnits') === 'userSpaceOnUse') {\n      // TODO: Support more than one element with this ref by duplicating parent grad\n      const elems = $(svgcontent).find('[fill=\"url(#' + grad.id + ')\"],[stroke=\"url(#' + grad.id + ')\"]');\n      if (!elems.length) { return; }\n\n      // get object's bounding box\n      const bb = utilsGetBBox(elems[0]);\n\n      // This will occur if the element is inside a <defs> or a <symbol>,\n      // in which we shouldn't need to convert anyway.\n      if (!bb) { return; }\n\n      if (grad.tagName === 'linearGradient') {\n        const gCoords = $(grad).attr(['x1', 'y1', 'x2', 'y2']);\n\n        // If has transform, convert\n        const tlist = grad.gradientTransform.baseVal;\n        if (tlist && tlist.numberOfItems > 0) {\n          const m = transformListToTransform(tlist).matrix;\n          const pt1 = transformPoint(gCoords.x1, gCoords.y1, m);\n          const pt2 = transformPoint(gCoords.x2, gCoords.y2, m);\n\n          gCoords.x1 = pt1.x;\n          gCoords.y1 = pt1.y;\n          gCoords.x2 = pt2.x;\n          gCoords.y2 = pt2.y;\n          grad.removeAttribute('gradientTransform');\n        }\n\n        $(grad).attr({\n          x1: (gCoords.x1 - bb.x) / bb.width,\n          y1: (gCoords.y1 - bb.y) / bb.height,\n          x2: (gCoords.x2 - bb.x) / bb.width,\n          y2: (gCoords.y2 - bb.y) / bb.height\n        });\n        grad.removeAttribute('gradientUnits');\n      }\n      // else {\n      //   Note: radialGradient elements cannot be easily converted\n      //   because userSpaceOnUse will keep circular gradients, while\n      //   objectBoundingBox will x/y scale the gradient according to\n      //   its bbox.\n      //\n      //   For now we'll do nothing, though we should probably have\n      //   the gradient be updated as the element is moved, as\n      //   inkscape/illustrator do.\n      //\n      //   const gCoords = $(grad).attr(['cx', 'cy', 'r']);\n      //\n      //   $(grad).attr({\n      //     cx: (gCoords.cx - bb.x) / bb.width,\n      //     cy: (gCoords.cy - bb.y) / bb.height,\n      //     r: gCoords.r\n      //   });\n      //\n      //   grad.removeAttribute('gradientUnits');\n      // }\n    }\n  });\n};\n\n/**\n* Converts selected/given `<use>` or child SVG element to a group\n* @function module:svgcanvas.SvgCanvas#convertToGroup\n* @param {Element} elem\n* @fires module:svgcanvas.SvgCanvas#event:selected\n* @returns {undefined}\n*/\nconst convertToGroup = this.convertToGroup = function (elem) {\n  if (!elem) {\n    elem = selectedElements[0];\n  }\n  const $elem = $(elem);\n  const batchCmd = new BatchCommand();\n  let ts;\n\n  if ($elem.data('gsvg')) {\n    // Use the gsvg as the new group\n    const svg = elem.firstChild;\n    const pt = $(svg).attr(['x', 'y']);\n\n    $(elem.firstChild.firstChild).unwrap();\n    $(elem).removeData('gsvg');\n\n    const tlist = getTransformList(elem);\n    const xform = svgroot.createSVGTransform();\n    xform.setTranslate(pt.x, pt.y);\n    tlist.appendItem(xform);\n    recalculateDimensions(elem);\n    call('selected', [elem]);\n  } else if ($elem.data('symbol')) {\n    elem = $elem.data('symbol');\n\n    ts = $elem.attr('transform');\n    const pos = $elem.attr(['x', 'y']);\n\n    const vb = elem.getAttribute('viewBox');\n\n    if (vb) {\n      const nums = vb.split(' ');\n      pos.x -= +nums[0];\n      pos.y -= +nums[1];\n    }\n\n    // Not ideal, but works\n    ts += ' translate(' + (pos.x || 0) + ',' + (pos.y || 0) + ')';\n\n    const prev = $elem.prev();\n\n    // Remove <use> element\n    batchCmd.addSubCommand(new RemoveElementCommand($elem[0], $elem[0].nextSibling, $elem[0].parentNode));\n    $elem.remove();\n\n    // See if other elements reference this symbol\n    const hasMore = $(svgcontent).find('use:data(symbol)').length;\n\n    const g = svgdoc.createElementNS(NS.SVG, 'g');\n    const childs = elem.childNodes;\n\n    let i;\n    for (i = 0; i < childs.length; i++) {\n      g.append(childs[i].cloneNode(true));\n    }\n\n    // Duplicate the gradients for Gecko, since they weren't included in the <symbol>\n    if (isGecko()) {\n      const dupeGrads = $(findDefs()).children('linearGradient,radialGradient,pattern').clone();\n      $(g).append(dupeGrads);\n    }\n\n    if (ts) {\n      g.setAttribute('transform', ts);\n    }\n\n    const parent = elem.parentNode;\n\n    uniquifyElems(g);\n\n    // Put the dupe gradients back into <defs> (after uniquifying them)\n    if (isGecko()) {\n      $(findDefs()).append($(g).find('linearGradient,radialGradient,pattern'));\n    }\n\n    // now give the g itself a new id\n    g.id = getNextId();\n\n    prev.after(g);\n\n    if (parent) {\n      if (!hasMore) {\n        // remove symbol/svg element\n        const {nextSibling} = elem;\n        elem.remove();\n        batchCmd.addSubCommand(new RemoveElementCommand(elem, nextSibling, parent));\n      }\n      batchCmd.addSubCommand(new InsertElementCommand(g));\n    }\n\n    setUseData(g);\n\n    if (isGecko()) {\n      convertGradients(findDefs());\n    } else {\n      convertGradients(g);\n    }\n\n    // recalculate dimensions on the top-level children so that unnecessary transforms\n    // are removed\n    walkTreePost(g, function (n) {\n      try {\n        recalculateDimensions(n);\n      } catch (e) {\n        console.log(e);\n      }\n    });\n\n    // Give ID for any visible element missing one\n    $(g).find(visElems).each(function () {\n      if (!this.id) { this.id = getNextId(); }\n    });\n\n    selectOnly([g]);\n\n    const cm = pushGroupProperties(g, true);\n    if (cm) {\n      batchCmd.addSubCommand(cm);\n    }\n\n    addCommandToHistory(batchCmd);\n  } else {\n    console.log('Unexpected element to ungroup:', elem);\n  }\n};\n\n/**\n* This function sets the current drawing as the input SVG XML.\n* @function module:svgcanvas.SvgCanvas#setSvgString\n* @param {string} xmlString - The SVG as XML text.\n* @param {boolean} [preventUndo=false] - Indicates if we want to do the\n* changes without adding them to the undo stack - e.g. for initializing a\n* drawing on page load.\n* @fires module:svgcanvas.SvgCanvas#event:setnonce\n* @fires module:svgcanvas.SvgCanvas#event:unsetnonce\n* @fires module:svgcanvas.SvgCanvas#event:changed\n* @returns {boolean} This function returns `false` if the set was\n*     unsuccessful, `true` otherwise.\n*/\nthis.setSvgString = function (xmlString, preventUndo) {\n  try {\n    // convert string into XML document\n    const newDoc = text2xml(xmlString);\n    if (newDoc.firstElementChild &&\n      newDoc.firstElementChild.namespaceURI !== NS.SVG) {\n      return false;\n    }\n\n    this.prepareSvg(newDoc);\n\n    const batchCmd = new BatchCommand('Change Source');\n\n    // remove old svg document\n    const {nextSibling} = svgcontent;\n    const oldzoom = svgroot.removeChild(svgcontent);\n    batchCmd.addSubCommand(new RemoveElementCommand(oldzoom, nextSibling, svgroot));\n\n    // set new svg document\n    // If DOM3 adoptNode() available, use it. Otherwise fall back to DOM2 importNode()\n    if (svgdoc.adoptNode) {\n      svgcontent = svgdoc.adoptNode(newDoc.documentElement);\n    } else {\n      svgcontent = svgdoc.importNode(newDoc.documentElement, true);\n    }\n\n    svgroot.append(svgcontent);\n    const content = $(svgcontent);\n\n    canvas.current_drawing_ = new draw.Drawing(svgcontent, idprefix);\n\n    // retrieve or set the nonce\n    const nonce = getCurrentDrawing().getNonce();\n    if (nonce) {\n      call('setnonce', nonce);\n    } else {\n      call('unsetnonce');\n    }\n\n    // change image href vals if possible\n    content.find('image').each(function () {\n      const image = this;\n      preventClickDefault(image);\n      const val = getHref(this);\n      if (val) {\n        if (val.startsWith('data:')) {\n          // Check if an SVG-edit data URI\n          const m = val.match(/svgedit_url=(.*?);/);\n          if (m) {\n            const url = decodeURIComponent(m[1]);\n            $(new Image()).load(function () {\n              image.setAttributeNS(NS.XLINK, 'xlink:href', url);\n            }).attr('src', url);\n          }\n        }\n        // Add to encodableImages if it loads\n        canvas.embedImage(val);\n      }\n    });\n\n    // Wrap child SVGs in group elements\n    content.find('svg').each(function () {\n      // Skip if it's in a <defs>\n      if ($(this).closest('defs').length) { return; }\n\n      uniquifyElems(this);\n\n      // Check if it already has a gsvg group\n      const pa = this.parentNode;\n      if (pa.childNodes.length === 1 && pa.nodeName === 'g') {\n        $(pa).data('gsvg', this);\n        pa.id = pa.id || getNextId();\n      } else {\n        groupSvgElem(this);\n      }\n    });\n\n    // For Firefox: Put all paint elems in defs\n    if (isGecko()) {\n      content.find('linearGradient, radialGradient, pattern').appendTo(findDefs());\n    }\n\n    // Set ref element for <use> elements\n\n    // TODO: This should also be done if the object is re-added through \"redo\"\n    setUseData(content);\n\n    convertGradients(content[0]);\n\n    const attrs = {\n      id: 'svgcontent',\n      overflow: curConfig.show_outside_canvas ? 'visible' : 'hidden'\n    };\n\n    let percs = false;\n\n    // determine proper size\n    if (content.attr('viewBox')) {\n      const vb = content.attr('viewBox').split(' ');\n      attrs.width = vb[2];\n      attrs.height = vb[3];\n    // handle content that doesn't have a viewBox\n    } else {\n      $.each(['width', 'height'], function (i, dim) {\n        // Set to 100 if not given\n        const val = content.attr(dim) || '100%';\n\n        if (String(val).substr(-1) === '%') {\n          // Use user units if percentage given\n          percs = true;\n        } else {\n          attrs[dim] = convertToNum(dim, val);\n        }\n      });\n    }\n\n    // identify layers\n    draw.identifyLayers();\n\n    // Give ID for any visible layer children missing one\n    content.children().find(visElems).each(function () {\n      if (!this.id) { this.id = getNextId(); }\n    });\n\n    // Percentage width/height, so let's base it on visible elements\n    if (percs) {\n      const bb = getStrokedBBoxDefaultVisible();\n      attrs.width = bb.width + bb.x;\n      attrs.height = bb.height + bb.y;\n    }\n\n    // Just in case negative numbers are given or\n    // result from the percs calculation\n    if (attrs.width <= 0) { attrs.width = 100; }\n    if (attrs.height <= 0) { attrs.height = 100; }\n\n    content.attr(attrs);\n    this.contentW = attrs.width;\n    this.contentH = attrs.height;\n\n    batchCmd.addSubCommand(new InsertElementCommand(svgcontent));\n    // update root to the correct size\n    const changes = content.attr(['width', 'height']);\n    batchCmd.addSubCommand(new ChangeElementCommand(svgroot, changes));\n\n    // reset zoom\n    currentZoom = 1;\n\n    // reset transform lists\n    resetListMap();\n    clearSelection();\n    pathModule.clearData();\n    svgroot.append(selectorManager.selectorParentGroup);\n\n    if (!preventUndo) addCommandToHistory(batchCmd);\n    call('changed', [svgcontent]);\n  } catch (e) {\n    console.log(e);\n    return false;\n  }\n\n  return true;\n};\n\n/**\n* This function imports the input SVG XML as a `<symbol>` in the `<defs>`, then adds a\n* `<use>` to the current layer.\n* @function module:svgcanvas.SvgCanvas#importSvgString\n* @param {string} xmlString - The SVG as XML text.\n* @fires module:svgcanvas.SvgCanvas#event:changed\n* @returns {null|Element} This function returns null if the import was unsuccessful, or the element otherwise.\n* @todo\n* - properly handle if namespace is introduced by imported content (must add to svgcontent\n* and update all prefixes in the imported node)\n* - properly handle recalculating dimensions, `recalculateDimensions()` doesn't handle\n* arbitrary transform lists, but makes some assumptions about how the transform list\n* was obtained\n*/\nthis.importSvgString = function (xmlString) {\n  let j, ts, useEl;\n  try {\n    // Get unique ID\n    const uid = encode64(xmlString.length + xmlString).substr(0, 32);\n\n    let useExisting = false;\n    // Look for symbol and make sure symbol exists in image\n    if (importIds[uid]) {\n      if ($(importIds[uid].symbol).parents('#svgroot').length) {\n        useExisting = true;\n      }\n    }\n\n    const batchCmd = new BatchCommand('Import Image');\n    let symbol;\n    if (useExisting) {\n      ({symbol} = importIds[uid]);\n      ts = importIds[uid].xform;\n    } else {\n      // convert string into XML document\n      const newDoc = text2xml(xmlString);\n\n      this.prepareSvg(newDoc);\n\n      // import new svg document into our document\n      let svg;\n      // If DOM3 adoptNode() available, use it. Otherwise fall back to DOM2 importNode()\n      if (svgdoc.adoptNode) {\n        svg = svgdoc.adoptNode(newDoc.documentElement);\n      } else {\n        svg = svgdoc.importNode(newDoc.documentElement, true);\n      }\n\n      uniquifyElems(svg);\n\n      const innerw = convertToNum('width', svg.getAttribute('width')),\n        innerh = convertToNum('height', svg.getAttribute('height')),\n        innervb = svg.getAttribute('viewBox'),\n        // if no explicit viewbox, create one out of the width and height\n        vb = innervb ? innervb.split(' ') : [0, 0, innerw, innerh];\n      for (j = 0; j < 4; ++j) {\n        vb[j] = +(vb[j]);\n      }\n\n      // TODO: properly handle preserveAspectRatio\n      const // canvasw = +svgcontent.getAttribute('width'),\n        canvash = +svgcontent.getAttribute('height');\n      // imported content should be 1/3 of the canvas on its largest dimension\n\n      if (innerh > innerw) {\n        ts = 'scale(' + (canvash / 3) / vb[3] + ')';\n      } else {\n        ts = 'scale(' + (canvash / 3) / vb[2] + ')';\n      }\n\n      // Hack to make recalculateDimensions understand how to scale\n      ts = 'translate(0) ' + ts + ' translate(0)';\n\n      symbol = svgdoc.createElementNS(NS.SVG, 'symbol');\n      const defs = findDefs();\n\n      if (isGecko()) {\n        // Move all gradients into root for Firefox, workaround for this bug:\n        // https://bugzilla.mozilla.org/show_bug.cgi?id=353575\n        // TODO: Make this properly undo-able.\n        $(svg).find('linearGradient, radialGradient, pattern').appendTo(defs);\n      }\n\n      while (svg.firstChild) {\n        const first = svg.firstChild;\n        symbol.append(first);\n      }\n      const attrs = svg.attributes;\n      for (let i = 0; i < attrs.length; i++) {\n        const attr = attrs[i];\n        symbol.setAttribute(attr.nodeName, attr.value);\n      }\n      symbol.id = getNextId();\n\n      // Store data\n      importIds[uid] = {\n        symbol,\n        xform: ts\n      };\n\n      findDefs().append(symbol);\n      batchCmd.addSubCommand(new InsertElementCommand(symbol));\n    }\n\n    useEl = svgdoc.createElementNS(NS.SVG, 'use');\n    useEl.id = getNextId();\n    setHref(useEl, '#' + symbol.id);\n\n    (currentGroup || getCurrentDrawing().getCurrentLayer()).append(useEl);\n    batchCmd.addSubCommand(new InsertElementCommand(useEl));\n    clearSelection();\n\n    useEl.setAttribute('transform', ts);\n    recalculateDimensions(useEl);\n    $(useEl).data('symbol', symbol).data('ref', symbol);\n    addToSelection([useEl]);\n\n    // TODO: Find way to add this in a recalculateDimensions-parsable way\n    // if (vb[0] !== 0 || vb[1] !== 0) {\n    //   ts = 'translate(' + (-vb[0]) + ',' + (-vb[1]) + ') ' + ts;\n    // }\n    addCommandToHistory(batchCmd);\n    call('changed', [svgcontent]);\n  } catch (e) {\n    console.log(e);\n    return null;\n  }\n\n  // we want to return the element so we can automatically select it\n  return useEl;\n};\n\n// Could deprecate, but besides external uses, their usage makes clear that\n//  canvas is a dependency for all of these\n[\n  'identifyLayers', 'createLayer', 'cloneLayer', 'deleteCurrentLayer',\n  'setCurrentLayer', 'renameCurrentLayer', 'setCurrentLayerPosition',\n  'setLayerVisibility', 'moveSelectedToLayer', 'mergeLayer', 'mergeAllLayers',\n  'leaveContext', 'setContext'\n].forEach((prop) => {\n  canvas[prop] = draw[prop];\n});\ndraw.init(\n  /**\n  * @implements {module:draw.DrawCanvasInit}\n  */\n  {\n    pathActions,\n    getCurrentGroup () {\n      return currentGroup;\n    },\n    setCurrentGroup (cg) {\n      currentGroup = cg;\n    },\n    getSelectedElements,\n    getSVGContent,\n    undoMgr,\n    elData,\n    getCurrentDrawing,\n    clearSelection,\n    call,\n    addCommandToHistory,\n    /**\n     * @fires module:svgcanvas.SvgCanvas#event:changed\n     * @returns {undefined}\n     */\n    changeSVGContent () {\n      call('changed', [svgcontent]);\n    }\n  }\n);\n\n/**\n* Group: Document functions\n*/\n\n/**\n* Clears the current document. This is not an undoable action.\n* @function module:svgcanvas.SvgCanvas#clear\n* @fires module:svgcanvas.SvgCanvas#event:cleared\n* @returns {undefined}\n*/\nthis.clear = function () {\n  pathActions.clear();\n\n  clearSelection();\n\n  // clear the svgcontent node\n  canvas.clearSvgContentElement();\n\n  // create new document\n  canvas.current_drawing_ = new draw.Drawing(svgcontent);\n\n  // create empty first layer\n  canvas.createLayer('Layer 1');\n\n  // clear the undo stack\n  canvas.undoMgr.resetUndoStack();\n\n  // reset the selector manager\n  selectorManager.initGroup();\n\n  // reset the rubber band box\n  rubberBox = selectorManager.getRubberBandBox();\n\n  call('cleared');\n};\n\n// Alias function\nthis.linkControlPoints = pathActions.linkControlPoints;\n\n/**\n* @function module:svgcanvas.SvgCanvas#getContentElem\n* @returns {Element} The content DOM element\n*/\nthis.getContentElem = function () { return svgcontent; };\n\n/**\n* @function module:svgcanvas.SvgCanvas#getRootElem\n* @returns {SVGSVGElement} The root DOM element\n*/\nthis.getRootElem = function () { return svgroot; };\n\n/**\n* @typedef {PlainObject} DimensionsAndZoom\n* @property {Float} w Width\n* @property {Float} h Height\n* @property {Float} zoom Zoom\n*/\n\n/**\n* @function module:svgcanvas.SvgCanvas#getResolution\n* @returns {DimensionsAndZoom} The current dimensions and zoom level in an object\n*/\nconst getResolution = this.getResolution = function () {\n//    const vb = svgcontent.getAttribute('viewBox').split(' ');\n//    return {w:vb[2], h:vb[3], zoom: currentZoom};\n\n  const w = svgcontent.getAttribute('width') / currentZoom;\n  const h = svgcontent.getAttribute('height') / currentZoom;\n\n  return {\n    w,\n    h,\n    zoom: currentZoom\n  };\n};\n\n/**\n* @function module:svgcanvas.SvgCanvas#getSnapToGrid\n* @returns {boolean} The current snap to grid setting\n*/\nthis.getSnapToGrid = function () { return curConfig.gridSnapping; };\n\n/**\n* @function module:svgcanvas.SvgCanvas#getVersion\n* @returns {string} A string which describes the revision number of SvgCanvas.\n*/\nthis.getVersion = function () {\n  return 'svgcanvas.js ($Rev$)';\n};\n\n/**\n* Update interface strings with given values\n* @function module:svgcanvas.SvgCanvas#setUiStrings\n* @param {module:path.uiStrings} strs - Object with strings (see the [locales API]{@link module:locale.LocaleStrings} and the [tutorial]{@tutorial LocaleDocs})\n* @returns {undefined}\n*/\nthis.setUiStrings = function (strs) {\n  Object.assign(uiStrings, strs.notification);\n  pathModule.setUiStrings(strs);\n};\n\n/**\n* Update configuration options with given values\n* @function module:svgcanvas.SvgCanvas#setConfig\n* @param {module:SVGEditor.Config} opts - Object with options\n* @returns {undefined}\n*/\nthis.setConfig = function (opts) {\n  Object.assign(curConfig, opts);\n};\n\n/**\n* @function module:svgcanvas.SvgCanvas#getTitle\n* @param {Element} elem\n* @returns {string|undefined} the current group/SVG's title contents\n*/\nthis.getTitle = function (elem) {\n  elem = elem || selectedElements[0];\n  if (!elem) { return; }\n  elem = $(elem).data('gsvg') || $(elem).data('symbol') || elem;\n  const childs = elem.childNodes;\n  for (let i = 0; i < childs.length; i++) {\n    if (childs[i].nodeName === 'title') {\n      return childs[i].textContent;\n    }\n  }\n  return '';\n};\n\n/**\n* Sets the group/SVG's title content\n* @function module:svgcanvas.SvgCanvas#setGroupTitle\n* @param {string} val\n* @todo Combine this with `setDocumentTitle`\n* @returns {undefined}\n*/\nthis.setGroupTitle = function (val) {\n  let elem = selectedElements[0];\n  elem = $(elem).data('gsvg') || elem;\n\n  const ts = $(elem).children('title');\n\n  const batchCmd = new BatchCommand('Set Label');\n\n  let title;\n  if (!val.length) {\n    // Remove title element\n    const tsNextSibling = ts.nextSibling;\n    batchCmd.addSubCommand(new RemoveElementCommand(ts[0], tsNextSibling, elem));\n    ts.remove();\n  } else if (ts.length) {\n    // Change title contents\n    title = ts[0];\n    batchCmd.addSubCommand(new ChangeElementCommand(title, {'#text': title.textContent}));\n    title.textContent = val;\n  } else {\n    // Add title element\n    title = svgdoc.createElementNS(NS.SVG, 'title');\n    title.textContent = val;\n    $(elem).prepend(title);\n    batchCmd.addSubCommand(new InsertElementCommand(title));\n  }\n\n  addCommandToHistory(batchCmd);\n};\n\n/**\n* @function module:svgcanvas.SvgCanvas#getDocumentTitle\n* @returns {string|undefined} The current document title or an empty string if not found\n*/\nconst getDocumentTitle = this.getDocumentTitle = function () {\n  return canvas.getTitle(svgcontent);\n};\n\n/**\n* Adds/updates a title element for the document with the given name.\n* This is an undoable action\n* @function module:svgcanvas.SvgCanvas#setDocumentTitle\n* @param {string} newTitle - String with the new title\n* @returns {undefined}\n*/\nthis.setDocumentTitle = function (newTitle) {\n  const childs = svgcontent.childNodes;\n  let docTitle = false, oldTitle = '';\n\n  const batchCmd = new BatchCommand('Change Image Title');\n\n  for (let i = 0; i < childs.length; i++) {\n    if (childs[i].nodeName === 'title') {\n      docTitle = childs[i];\n      oldTitle = docTitle.textContent;\n      break;\n    }\n  }\n  if (!docTitle) {\n    docTitle = svgdoc.createElementNS(NS.SVG, 'title');\n    svgcontent.insertBefore(docTitle, svgcontent.firstChild);\n    // svgcontent.firstChild.before(docTitle); // Ok to replace above with this?\n  }\n\n  if (newTitle.length) {\n    docTitle.textContent = newTitle;\n  } else {\n    // No title given, so element is not necessary\n    docTitle.remove();\n  }\n  batchCmd.addSubCommand(new ChangeElementCommand(docTitle, {'#text': oldTitle}));\n  addCommandToHistory(batchCmd);\n};\n\n/**\n* Returns the editor's namespace URL, optionally adding it to the root element\n* @function module:svgcanvas.SvgCanvas#getEditorNS\n* @param {boolean} [add] - Indicates whether or not to add the namespace value\n* @returns {string} The editor's namespace URL\n*/\nthis.getEditorNS = function (add) {\n  if (add) {\n    svgcontent.setAttribute('xmlns:se', NS.SE);\n  }\n  return NS.SE;\n};\n\n/**\n* Changes the document's dimensions to the given size\n* @function module:svgcanvas.SvgCanvas#setResolution\n* @param {Float|\"fit\"} x - Number with the width of the new dimensions in user units.\n* Can also be the string \"fit\" to indicate \"fit to content\"\n* @param {Float} y - Number with the height of the new dimensions in user units.\n* @fires module:svgcanvas.SvgCanvas#event:changed\n* @returns {boolean} Indicates if resolution change was successful.\n* It will fail on \"fit to content\" option with no content to fit to.\n*/\nthis.setResolution = function (x, y) {\n  const res = getResolution();\n  const {w, h} = res;\n  let batchCmd;\n\n  if (x === 'fit') {\n    // Get bounding box\n    const bbox = getStrokedBBoxDefaultVisible();\n\n    if (bbox) {\n      batchCmd = new BatchCommand('Fit Canvas to Content');\n      const visEls = getVisibleElements();\n      addToSelection(visEls);\n      const dx = [], dy = [];\n      $.each(visEls, function (i, item) {\n        dx.push(bbox.x * -1);\n        dy.push(bbox.y * -1);\n      });\n\n      const cmd = canvas.moveSelectedElements(dx, dy, true);\n      batchCmd.addSubCommand(cmd);\n      clearSelection();\n\n      x = Math.round(bbox.width);\n      y = Math.round(bbox.height);\n    } else {\n      return false;\n    }\n  }\n  if (x !== w || y !== h) {\n    if (!batchCmd) {\n      batchCmd = new BatchCommand('Change Image Dimensions');\n    }\n\n    x = convertToNum('width', x);\n    y = convertToNum('height', y);\n\n    svgcontent.setAttribute('width', x);\n    svgcontent.setAttribute('height', y);\n\n    this.contentW = x;\n    this.contentH = y;\n    batchCmd.addSubCommand(new ChangeElementCommand(svgcontent, {width: w, height: h}));\n\n    svgcontent.setAttribute('viewBox', [0, 0, x / currentZoom, y / currentZoom].join(' '));\n    batchCmd.addSubCommand(new ChangeElementCommand(svgcontent, {viewBox: ['0 0', w, h].join(' ')}));\n\n    addCommandToHistory(batchCmd);\n    call('changed', [svgcontent]);\n  }\n  return true;\n};\n\n/**\n* @typedef {module:jQueryAttr.Attributes} module:svgcanvas.ElementPositionInCanvas\n* @property {Float} x\n* @property {Float} y\n*/\n\n/**\n* @function module:svgcanvas.SvgCanvas#getOffset\n* @returns {module:svgcanvas.ElementPositionInCanvas} An object with `x`, `y` values indicating the svgcontent element's\n* position in the editor's canvas.\n*/\nthis.getOffset = function () {\n  return $(svgcontent).attr(['x', 'y']);\n};\n\n/**\n * @typedef {PlainObject} module:svgcanvas.ZoomAndBBox\n * @property {Float} zoom\n * @property {module:utilities.BBoxObject} bbox\n */\n/**\n* Sets the zoom level on the canvas-side based on the given value\n* @function module:svgcanvas.SvgCanvas#setBBoxZoom\n* @param {\"selection\"|\"canvas\"|\"content\"|\"layer\"|module:SVGEditor.BBoxObjectWithFactor} val - Bounding box object to zoom to or string indicating zoom option. Note: the object value type is defined in `svg-editor.js`\n* @param {Integer} editorW - The editor's workarea box's width\n* @param {Integer} editorH - The editor's workarea box's height\n* @returns {module:svgcanvas.ZoomAndBBox|undefined}\n*/\nthis.setBBoxZoom = function (val, editorW, editorH) {\n  let spacer = 0.85;\n  let bb;\n  const calcZoom = function (bb) {\n    if (!bb) { return false; }\n    const wZoom = Math.round((editorW / bb.width) * 100 * spacer) / 100;\n    const hZoom = Math.round((editorH / bb.height) * 100 * spacer) / 100;\n    const zoom = Math.min(wZoom, hZoom);\n    canvas.setZoom(zoom);\n    return {zoom, bbox: bb};\n  };\n\n  if (typeof val === 'object') {\n    bb = val;\n    if (bb.width === 0 || bb.height === 0) {\n      const newzoom = bb.zoom ? bb.zoom : currentZoom * bb.factor;\n      canvas.setZoom(newzoom);\n      return {zoom: currentZoom, bbox: bb};\n    }\n    return calcZoom(bb);\n  }\n\n  switch (val) {\n  case 'selection':\n    if (!selectedElements[0]) { return; }\n    const selectedElems = $.map(selectedElements, function (n) { if (n) { return n; } });\n    bb = getStrokedBBoxDefaultVisible(selectedElems);\n    break;\n  case 'canvas':\n    const res = getResolution();\n    spacer = 0.95;\n    bb = {width: res.w, height: res.h, x: 0, y: 0};\n    break;\n  case 'content':\n    bb = getStrokedBBoxDefaultVisible();\n    break;\n  case 'layer':\n    bb = getStrokedBBoxDefaultVisible(getVisibleElements(getCurrentDrawing().getCurrentLayer()));\n    break;\n  default:\n    return;\n  }\n  return calcZoom(bb);\n};\n\n/**\n* The zoom level has changed. Supplies the new zoom level as a number (not percentage).\n* @event module:svgcanvas.SvgCanvas#event:ext-zoomChanged\n* @type {Float}\n*/\n/**\n* The bottom panel was updated\n* @event module:svgcanvas.SvgCanvas#event:ext-toolButtonStateUpdate\n* @type {PlainObject}\n* @property {boolean} nofill Indicates fill is disabled\n* @property {boolean} nostroke Indicates stroke is disabled\n*/\n/**\n* The element selection has changed (elements were added/removed from selection)\n* @event module:svgcanvas.SvgCanvas#event:ext-selectedChanged\n* @type {PlainObject}\n* @property {Element[]} elems Array of the newly selected elements\n* @property {Element|null} selectedElement The single selected element\n* @property {boolean} multiselected Indicates whether one or more elements were selected\n*/\n/**\n* Called when part of element is in process of changing, generally on\n* mousemove actions like rotate, move, etc.\n* @event module:svgcanvas.SvgCanvas#event:ext-elementTransition\n* @type {PlainObject}\n* @property {Element[]} elems Array of transitioning elements\n*/\n/**\n* One or more elements were changed\n* @event module:svgcanvas.SvgCanvas#event:ext-elementChanged\n* @type {PlainObject}\n* @property {Element[]} elems Array of the affected elements\n*/\n/**\n* Invoked as soon as the locale is ready\n* @event module:svgcanvas.SvgCanvas#event:ext-langReady\n* @type {PlainObject}\n* @property {string} lang The two-letter language code\n* @property {module:SVGEditor.uiStrings} uiStrings\n* @property {module:SVGEditor~ImportLocale} importLocale\n*/\n/**\n* The language was changed. Two-letter code of the new language.\n* @event module:svgcanvas.SvgCanvas#event:ext-langChanged\n* @type {string}\n*/\n/**\n* Means for an extension to add locale data. The two-letter language code.\n* @event module:svgcanvas.SvgCanvas#event:ext-addLangData\n* @type {PlainObject}\n* @property {string} lang\n* @property {module:SVGEditor~ImportLocale} importLocale\n*/\n/**\n * Called when new image is created\n * @event module:svgcanvas.SvgCanvas#event:ext-onNewDocument\n * @type {undefined}\n */\n/**\n * Called when sidepanel is resized or toggled\n * @event module:svgcanvas.SvgCanvas#event:ext-workareaResized\n * @type {undefined}\n*/\n/**\n * Called upon addition of the extension, or, if svgicons are set,\n * after the icons are ready when extension SVG icons have loaded.\n * @event module:svgcanvas.SvgCanvas#event:ext-callback\n * @type {undefined}\n*/\n\n/**\n* Sets the zoom to the given level\n* @function module:svgcanvas.SvgCanvas#setZoom\n* @param {Float} zoomLevel - Float indicating the zoom level to change to\n* @fires module:svgcanvas.SvgCanvas#event:ext-zoomChanged\n* @returns {undefined}\n*/\nthis.setZoom = function (zoomLevel) {\n  const res = getResolution();\n  svgcontent.setAttribute('viewBox', '0 0 ' + res.w / zoomLevel + ' ' + res.h / zoomLevel);\n  currentZoom = zoomLevel;\n  $.each(selectedElements, function (i, elem) {\n    if (!elem) { return; }\n    selectorManager.requestSelector(elem).resize();\n  });\n  pathActions.zoomChange();\n  runExtensions('zoomChanged', /** @type {module:svgcanvas.SvgCanvas#event:ext-zoomChanged} */ zoomLevel);\n};\n\n/**\n* @function module:svgcanvas.SvgCanvas#getMode\n* @returns {string} The current editor mode string\n*/\nthis.getMode = function () {\n  return currentMode;\n};\n\n/**\n* Sets the editor's mode to the given string\n* @function module:svgcanvas.SvgCanvas#setMode\n* @param {string} name - String with the new mode to change to\n* @returns {undefined}\n*/\nthis.setMode = function (name) {\n  pathActions.clear(true);\n  textActions.clear();\n  curProperties = (selectedElements[0] && selectedElements[0].nodeName === 'text') ? curText : curShape;\n  currentMode = name;\n};\n\n/**\n* Group: Element Styling\n*/\n\n/**\n* @typedef {PlainObject} module:svgcanvas.PaintOptions\n* @property {\"solidColor\"} type\n*/\n\n/**\n* @function module:svgcanvas.SvgCanvas#getColor\n* @param {string} type\n* @returns {string|module:svgcanvas.PaintOptions|Float|module:jGraduate~Paint} The current fill/stroke option\n*/\nthis.getColor = function (type) {\n  return curProperties[type];\n};\n\n/**\n* Change the current stroke/fill color/gradient value\n* @function module:svgcanvas.SvgCanvas#setColor\n* @param {string} type - String indicating fill or stroke\n* @param {string} val - The value to set the stroke attribute to\n* @param {boolean} preventUndo - Boolean indicating whether or not this should be an undoable option\n* @fires module:svgcanvas.SvgCanvas#event:changed\n* @returns {undefined}\n*/\nthis.setColor = function (type, val, preventUndo) {\n  curShape[type] = val;\n  curProperties[type + '_paint'] = {type: 'solidColor'};\n  const elems = [];\n  function addNonG (e) {\n    if (e.nodeName !== 'g') {\n      elems.push(e);\n    }\n  }\n  let i = selectedElements.length;\n  while (i--) {\n    const elem = selectedElements[i];\n    if (elem) {\n      if (elem.tagName === 'g') {\n        walkTree(elem, addNonG);\n      } else {\n        if (type === 'fill') {\n          if (elem.tagName !== 'polyline' && elem.tagName !== 'line') {\n            elems.push(elem);\n          }\n        } else {\n          elems.push(elem);\n        }\n      }\n    }\n  }\n  if (elems.length > 0) {\n    if (!preventUndo) {\n      changeSelectedAttribute(type, val, elems);\n      call('changed', elems);\n    } else {\n      changeSelectedAttributeNoUndo(type, val, elems);\n    }\n  }\n};\n\n/**\n* Apply the current gradient to selected element's fill or stroke\n* @function module:svgcanvas.SvgCanvas#setGradient\n* @param {\"fill\"|\"stroke\"} type - String indicating \"fill\" or \"stroke\" to apply to an element\n* @returns {undefined}\n*/\nconst setGradient = this.setGradient = function (type) {\n  if (!curProperties[type + '_paint'] || curProperties[type + '_paint'].type === 'solidColor') { return; }\n  let grad = canvas[type + 'Grad'];\n  // find out if there is a duplicate gradient already in the defs\n  const duplicateGrad = findDuplicateGradient(grad);\n  const defs = findDefs();\n  // no duplicate found, so import gradient into defs\n  if (!duplicateGrad) {\n    // const origGrad = grad;\n    grad = defs.appendChild(svgdoc.importNode(grad, true));\n    // get next id and set it on the grad\n    grad.id = getNextId();\n  } else { // use existing gradient\n    grad = duplicateGrad;\n  }\n  canvas.setColor(type, 'url(#' + grad.id + ')');\n};\n\n/**\n* Check if exact gradient already exists\n* @function module:svgcanvas~findDuplicateGradient\n* @param {SVGGradientElement} grad - The gradient DOM element to compare to others\n* @returns {SVGGradientElement} The existing gradient if found, `null` if not\n*/\nconst findDuplicateGradient = function (grad) {\n  const defs = findDefs();\n  const existingGrads = $(defs).find('linearGradient, radialGradient');\n  let i = existingGrads.length;\n  const radAttrs = ['r', 'cx', 'cy', 'fx', 'fy'];\n  while (i--) {\n    const og = existingGrads[i];\n    if (grad.tagName === 'linearGradient') {\n      if (grad.getAttribute('x1') !== og.getAttribute('x1') ||\n        grad.getAttribute('y1') !== og.getAttribute('y1') ||\n        grad.getAttribute('x2') !== og.getAttribute('x2') ||\n        grad.getAttribute('y2') !== og.getAttribute('y2')\n      ) {\n        continue;\n      }\n    } else {\n      const gradAttrs = $(grad).attr(radAttrs);\n      const ogAttrs = $(og).attr(radAttrs);\n\n      let diff = false;\n      $.each(radAttrs, function (i, attr) {\n        if (gradAttrs[attr] !== ogAttrs[attr]) { diff = true; }\n      });\n\n      if (diff) { continue; }\n    }\n\n    // else could be a duplicate, iterate through stops\n    const stops = grad.getElementsByTagNameNS(NS.SVG, 'stop');\n    const ostops = og.getElementsByTagNameNS(NS.SVG, 'stop');\n\n    if (stops.length !== ostops.length) {\n      continue;\n    }\n\n    let j = stops.length;\n    while (j--) {\n      const stop = stops[j];\n      const ostop = ostops[j];\n\n      if (stop.getAttribute('offset') !== ostop.getAttribute('offset') ||\n        stop.getAttribute('stop-opacity') !== ostop.getAttribute('stop-opacity') ||\n        stop.getAttribute('stop-color') !== ostop.getAttribute('stop-color')) {\n        break;\n      }\n    }\n\n    if (j === -1) {\n      return og;\n    }\n  } // for each gradient in defs\n\n  return null;\n};\n\n/**\n* Set a color/gradient to a fill/stroke\n* @function module:svgcanvas.SvgCanvas#setPaint\n* @param {\"fill\"|\"stroke\"} type - String with \"fill\" or \"stroke\"\n* @param {module:jGraduate.jGraduatePaintOptions} paint - The jGraduate paint object to apply\n* @returns {undefined}\n*/\nthis.setPaint = function (type, paint) {\n  // make a copy\n  const p = new $.jGraduate.Paint(paint);\n  this.setPaintOpacity(type, p.alpha / 100, true);\n\n  // now set the current paint object\n  curProperties[type + '_paint'] = p;\n  switch (p.type) {\n  case 'solidColor':\n    this.setColor(type, p.solidColor !== 'none' ? '#' + p.solidColor : 'none');\n    break;\n  case 'linearGradient':\n  case 'radialGradient':\n    canvas[type + 'Grad'] = p[p.type];\n    setGradient(type);\n    break;\n  }\n};\n\n/**\n* @function module:svgcanvas.SvgCanvas#setStrokePaint\n* @param {module:jGraduate~Paint} paint\n* @returns {undefined}\n*/\nthis.setStrokePaint = function (paint) {\n  this.setPaint('stroke', paint);\n};\n\n/**\n* @function module:svgcanvas.SvgCanvas#setFillPaint\n* @param {module:jGraduate~Paint} paint\n* @returns {undefined}\n*/\nthis.setFillPaint = function (paint) {\n  this.setPaint('fill', paint);\n};\n\n/**\n* @function module:svgcanvas.SvgCanvas#getStrokeWidth\n* @returns {Float|string} The current stroke-width value\n*/\nthis.getStrokeWidth = function () {\n  return curProperties.stroke_width;\n};\n\n/**\n* Sets the stroke width for the current selected elements.\n* When attempting to set a line's width to 0, this changes it to 1 instead\n* @function module:svgcanvas.SvgCanvas#setStrokeWidth\n* @param {Float} val - A Float indicating the new stroke width value\n* @fires module:svgcanvas.SvgCanvas#event:changed\n* @returns {undefined}\n*/\nthis.setStrokeWidth = function (val) {\n  if (val === 0 && ['line', 'path'].includes(currentMode)) {\n    canvas.setStrokeWidth(1);\n    return;\n  }\n  curProperties.stroke_width = val;\n\n  const elems = [];\n  function addNonG (e) {\n    if (e.nodeName !== 'g') {\n      elems.push(e);\n    }\n  }\n  let i = selectedElements.length;\n  while (i--) {\n    const elem = selectedElements[i];\n    if (elem) {\n      if (elem.tagName === 'g') {\n        walkTree(elem, addNonG);\n      } else {\n        elems.push(elem);\n      }\n    }\n  }\n  if (elems.length > 0) {\n    changeSelectedAttribute('stroke-width', val, elems);\n    call('changed', selectedElements);\n  }\n};\n\n/**\n* Set the given stroke-related attribute the given value for selected elements\n* @function module:svgcanvas.SvgCanvas#setStrokeAttr\n* @param {string} attr - String with the attribute name\n* @param {string|Float} val - String or number with the attribute value\n* @fires module:svgcanvas.SvgCanvas#event:changed\n* @returns {undefined}\n*/\nthis.setStrokeAttr = function (attr, val) {\n  curShape[attr.replace('-', '_')] = val;\n  const elems = [];\n\n  let i = selectedElements.length;\n  while (i--) {\n    const elem = selectedElements[i];\n    if (elem) {\n      if (elem.tagName === 'g') {\n        walkTree(elem, function (e) { if (e.nodeName !== 'g') { elems.push(e); } });\n      } else {\n        elems.push(elem);\n      }\n    }\n  }\n  if (elems.length > 0) {\n    changeSelectedAttribute(attr, val, elems);\n    call('changed', selectedElements);\n  }\n};\n\n/**\n* @typedef {PlainObject} module:svgcanvas.StyleOptions\n* @property {string} fill\n* @property {Float} fill_opacity\n* @property {string} stroke\n* @property {Float} stroke_width\n* @property {string} stroke_dasharray\n* @property {string} stroke_linejoin\n* @property {string} stroke_linecap\n* @property {Float} stroke_opacity\n* @property {Float} opacity\n*/\n\n/**\n* @function module:svgcanvas.SvgCanvas#getStyle\n* @returns {module:svgcanvas.StyleOptions} current style options\n*/\nthis.getStyle = function () {\n  return curShape;\n};\n\n/**\n* @function module:svgcanvas.SvgCanvas#getOpacity\n* @returns {Float} the current opacity\n*/\nthis.getOpacity = getOpacity;\n\n/**\n* Sets the given opacity to the current selected elements\n* @function module:svgcanvas.SvgCanvas#setOpacity\n* @param {string} val\n* @returns {undefined}\n*/\nthis.setOpacity = function (val) {\n  curShape.opacity = val;\n  changeSelectedAttribute('opacity', val);\n};\n\n/**\n* @function module:svgcanvas.SvgCanvas#getFillOpacity\n* @returns {Float} the current fill opacity\n*/\nthis.getFillOpacity = function () {\n  return curShape.fill_opacity;\n};\n\n/**\n* @function module:svgcanvas.SvgCanvas#getStrokeOpacity\n* @returns {string} the current stroke opacity\n*/\nthis.getStrokeOpacity = function () {\n  return curShape.stroke_opacity;\n};\n\n/**\n* Sets the current fill/stroke opacity\n* @function module:svgcanvas.SvgCanvas#setPaintOpacity\n* @param {string} type - String with \"fill\" or \"stroke\"\n* @param {Float} val - Float with the new opacity value\n* @param {boolean} preventUndo - Indicates whether or not this should be an undoable action\n* @returns {undefined}\n*/\nthis.setPaintOpacity = function (type, val, preventUndo) {\n  curShape[type + '_opacity'] = val;\n  if (!preventUndo) {\n    changeSelectedAttribute(type + '-opacity', val);\n  } else {\n    changeSelectedAttributeNoUndo(type + '-opacity', val);\n  }\n};\n\n/**\n* Gets the current fill/stroke opacity\n* @function module:svgcanvas.SvgCanvas#getPaintOpacity\n* @param {\"fill\"|\"stroke\"} type - String with \"fill\" or \"stroke\"\n* @returns {Float} Fill/stroke opacity\n*/\nthis.getPaintOpacity = function (type) {\n  return type === 'fill' ? this.getFillOpacity() : this.getStrokeOpacity();\n};\n\n/**\n* Gets the `stdDeviation` blur value of the given element\n* @function module:svgcanvas.SvgCanvas#getBlur\n* @param {Element} elem - The element to check the blur value for\n* @returns {string} stdDeviation blur attribute value\n*/\nthis.getBlur = function (elem) {\n  let val = 0;\n  // const elem = selectedElements[0];\n\n  if (elem) {\n    const filterUrl = elem.getAttribute('filter');\n    if (filterUrl) {\n      const blur = getElem(elem.id + '_blur');\n      if (blur) {\n        val = blur.firstChild.getAttribute('stdDeviation');\n      }\n    }\n  }\n  return val;\n};\n\n(function () {\nlet curCommand = null;\nlet filter = null;\nlet filterHidden = false;\n\n/**\n* Sets the `stdDeviation` blur value on the selected element without being undoable\n* @function module:svgcanvas.SvgCanvas#setBlurNoUndo\n* @param {Float} val - The new `stdDeviation` value\n* @returns {undefined}\n*/\ncanvas.setBlurNoUndo = function (val) {\n  if (!filter) {\n    canvas.setBlur(val);\n    return;\n  }\n  if (val === 0) {\n    // Don't change the StdDev, as that will hide the element.\n    // Instead, just remove the value for \"filter\"\n    changeSelectedAttributeNoUndo('filter', '');\n    filterHidden = true;\n  } else {\n    const elem = selectedElements[0];\n    if (filterHidden) {\n      changeSelectedAttributeNoUndo('filter', 'url(#' + elem.id + '_blur)');\n    }\n    if (isWebkit()) {\n      console.log('e', elem);\n      elem.removeAttribute('filter');\n      elem.setAttribute('filter', 'url(#' + elem.id + '_blur)');\n    }\n    changeSelectedAttributeNoUndo('stdDeviation', val, [filter.firstChild]);\n    canvas.setBlurOffsets(filter, val);\n  }\n};\n\nfunction finishChange () {\n  const bCmd = canvas.undoMgr.finishUndoableChange();\n  curCommand.addSubCommand(bCmd);\n  addCommandToHistory(curCommand);\n  curCommand = null;\n  filter = null;\n}\n\n/**\n* Sets the `x`, `y`, `width`, `height` values of the filter element in order to\n* make the blur not be clipped. Removes them if not neeeded\n* @function module:svgcanvas.SvgCanvas#setBlurOffsets\n* @param {Element} filter - The filter DOM element to update\n* @param {Float} stdDev - The standard deviation value on which to base the offset size\n* @returns {undefined}\n*/\ncanvas.setBlurOffsets = function (filter, stdDev) {\n  if (stdDev > 3) {\n    // TODO: Create algorithm here where size is based on expected blur\n    assignAttributes(filter, {\n      x: '-50%',\n      y: '-50%',\n      width: '200%',\n      height: '200%'\n    }, 100);\n  } else {\n    // Removing these attributes hides text in Chrome (see Issue 579)\n    if (!isWebkit()) {\n      filter.removeAttribute('x');\n      filter.removeAttribute('y');\n      filter.removeAttribute('width');\n      filter.removeAttribute('height');\n    }\n  }\n};\n\n/**\n* Adds/updates the blur filter to the selected element\n* @function module:svgcanvas.SvgCanvas#setBlur\n* @param {Float} val - Float with the new `stdDeviation` blur value\n* @param {boolean} complete - Whether or not the action should be completed (to add to the undo manager)\n* @returns {undefined}\n*/\ncanvas.setBlur = function (val, complete) {\n  if (curCommand) {\n    finishChange();\n    return;\n  }\n\n  // Looks for associated blur, creates one if not found\n  const elem = selectedElements[0];\n  const elemId = elem.id;\n  filter = getElem(elemId + '_blur');\n\n  val -= 0;\n\n  const batchCmd = new BatchCommand();\n\n  // Blur found!\n  if (filter) {\n    if (val === 0) {\n      filter = null;\n    }\n  } else {\n    // Not found, so create\n    const newblur = addSVGElementFromJson({ element: 'feGaussianBlur',\n      attr: {\n        in: 'SourceGraphic',\n        stdDeviation: val\n      }\n    });\n\n    filter = addSVGElementFromJson({ element: 'filter',\n      attr: {\n        id: elemId + '_blur'\n      }\n    });\n\n    filter.append(newblur);\n    findDefs().append(filter);\n\n    batchCmd.addSubCommand(new InsertElementCommand(filter));\n  }\n\n  const changes = {filter: elem.getAttribute('filter')};\n\n  if (val === 0) {\n    elem.removeAttribute('filter');\n    batchCmd.addSubCommand(new ChangeElementCommand(elem, changes));\n    return;\n  }\n\n  changeSelectedAttribute('filter', 'url(#' + elemId + '_blur)');\n  batchCmd.addSubCommand(new ChangeElementCommand(elem, changes));\n  canvas.setBlurOffsets(filter, val);\n\n  curCommand = batchCmd;\n  canvas.undoMgr.beginUndoableChange('stdDeviation', [filter ? filter.firstChild : null]);\n  if (complete) {\n    canvas.setBlurNoUndo(val);\n    finishChange();\n  }\n};\n}());\n\n/**\n* Check whether selected element is bold or not\n* @function module:svgcanvas.SvgCanvas#getBold\n* @returns {boolean} Indicates whether or not element is bold\n*/\nthis.getBold = function () {\n  // should only have one element selected\n  const selected = selectedElements[0];\n  if (selected != null && selected.tagName === 'text' &&\n    selectedElements[1] == null) {\n    return (selected.getAttribute('font-weight') === 'bold');\n  }\n  return false;\n};\n\n/**\n* Make the selected element bold or normal\n* @function module:svgcanvas.SvgCanvas#setBold\n* @param {boolean} b - Indicates bold (`true`) or normal (`false`)\n* @returns {undefined}\n*/\nthis.setBold = function (b) {\n  const selected = selectedElements[0];\n  if (selected != null && selected.tagName === 'text' &&\n    selectedElements[1] == null) {\n    changeSelectedAttribute('font-weight', b ? 'bold' : 'normal');\n  }\n  if (!selectedElements[0].textContent) {\n    textActions.setCursor();\n  }\n};\n\n/**\n* Check whether selected element is italic or not\n* @function module:svgcanvas.SvgCanvas#getItalic\n* @returns {boolean} Indicates whether or not element is italic\n*/\nthis.getItalic = function () {\n  const selected = selectedElements[0];\n  if (selected != null && selected.tagName === 'text' &&\n    selectedElements[1] == null) {\n    return (selected.getAttribute('font-style') === 'italic');\n  }\n  return false;\n};\n\n/**\n* Make the selected element italic or normal\n* @function module:svgcanvas.SvgCanvas#setItalic\n* @param {boolean} b - Indicates italic (`true`) or normal (`false`)\n* @returns {undefined}\n*/\nthis.setItalic = function (i) {\n  const selected = selectedElements[0];\n  if (selected != null && selected.tagName === 'text' &&\n    selectedElements[1] == null) {\n    changeSelectedAttribute('font-style', i ? 'italic' : 'normal');\n  }\n  if (!selectedElements[0].textContent) {\n    textActions.setCursor();\n  }\n};\n\n/**\n* @function module:svgcanvas.SvgCanvas#getFontFamily\n* @returns {string} The current font family\n*/\nthis.getFontFamily = function () {\n  return curText.font_family;\n};\n\n/**\n* Set the new font family\n* @function module:svgcanvas.SvgCanvas#setFontFamily\n* @param {string} val - String with the new font family\n* @returns {undefined}\n*/\nthis.setFontFamily = function (val) {\n  curText.font_family = val;\n  changeSelectedAttribute('font-family', val);\n  if (selectedElements[0] && !selectedElements[0].textContent) {\n    textActions.setCursor();\n  }\n};\n\n/**\n* Set the new font color\n* @function module:svgcanvas.SvgCanvas#setFontColor\n* @param {string} val - String with the new font color\n* @returns {undefined}\n*/\nthis.setFontColor = function (val) {\n  curText.fill = val;\n  changeSelectedAttribute('fill', val);\n};\n\n/**\n* @function module:svgcanvas.SvgCanvas#getFontColor\n* @returns {string} The current font color\n*/\nthis.getFontColor = function () {\n  return curText.fill;\n};\n\n/**\n* @function module:svgcanvas.SvgCanvas#getFontSize\n* @returns {Float} The current font size\n*/\nthis.getFontSize = function () {\n  return curText.font_size;\n};\n\n/**\n* Applies the given font size to the selected element\n* @function module:svgcanvas.SvgCanvas#setFontSize\n* @param {Float} val - Float with the new font size\n* @returns {undefined}\n*/\nthis.setFontSize = function (val) {\n  curText.font_size = val;\n  changeSelectedAttribute('font-size', val);\n  if (!selectedElements[0].textContent) {\n    textActions.setCursor();\n  }\n};\n\n/**\n* @function module:svgcanvas.SvgCanvas#getText\n* @returns {string} The current text (`textContent`) of the selected element\n*/\nthis.getText = function () {\n  const selected = selectedElements[0];\n  if (selected == null) { return ''; }\n  return selected.textContent;\n};\n\n/**\n* Updates the text element with the given string\n* @function module:svgcanvas.SvgCanvas#setTextContent\n* @param {string} val - String with the new text\n* @returns {undefined}\n*/\nthis.setTextContent = function (val) {\n  changeSelectedAttribute('#text', val);\n  textActions.init(val);\n  textActions.setCursor();\n};\n\n/**\n* Sets the new image URL for the selected image element. Updates its size if\n* a new URL is given\n* @function module:svgcanvas.SvgCanvas#setImageURL\n* @param {string} val - String with the image URL/path\n* @fires module:svgcanvas.SvgCanvas#event:changed\n* @returns {undefined}\n*/\nthis.setImageURL = function (val) {\n  const elem = selectedElements[0];\n  if (!elem) { return; }\n\n  const attrs = $(elem).attr(['width', 'height']);\n  let setsize = (!attrs.width || !attrs.height);\n\n  const curHref = getHref(elem);\n\n  // Do nothing if no URL change or size change\n  if (curHref !== val) {\n    setsize = true;\n  } else if (!setsize) { return; }\n\n  const batchCmd = new BatchCommand('Change Image URL');\n\n  setHref(elem, val);\n  batchCmd.addSubCommand(new ChangeElementCommand(elem, {\n    '#href': curHref\n  }));\n\n  if (setsize) {\n    $(new Image()).load(function () {\n      const changes = $(elem).attr(['width', 'height']);\n\n      $(elem).attr({\n        width: this.width,\n        height: this.height\n      });\n\n      selectorManager.requestSelector(elem).resize();\n\n      batchCmd.addSubCommand(new ChangeElementCommand(elem, changes));\n      addCommandToHistory(batchCmd);\n      call('changed', [elem]);\n    }).attr('src', val);\n  } else {\n    addCommandToHistory(batchCmd);\n  }\n};\n\n/**\n* Sets the new link URL for the selected anchor element.\n* @function module:svgcanvas.SvgCanvas#setLinkURL\n* @param {string} val - String with the link URL/path\n* @returns {undefined}\n*/\nthis.setLinkURL = function (val) {\n  let elem = selectedElements[0];\n  if (!elem) { return; }\n  if (elem.tagName !== 'a') {\n    // See if parent is an anchor\n    const parentsA = $(elem).parents('a');\n    if (parentsA.length) {\n      elem = parentsA[0];\n    } else {\n      return;\n    }\n  }\n\n  const curHref = getHref(elem);\n\n  if (curHref === val) { return; }\n\n  const batchCmd = new BatchCommand('Change Link URL');\n\n  setHref(elem, val);\n  batchCmd.addSubCommand(new ChangeElementCommand(elem, {\n    '#href': curHref\n  }));\n\n  addCommandToHistory(batchCmd);\n};\n\n/**\n* Sets the `rx` and `ry` values to the selected `rect` element to change its corner radius\n* @function module:svgcanvas.SvgCanvas#setRectRadius\n* @param {string|Float} val - The new radius\n* @fires module:svgcanvas.SvgCanvas#event:changed\n* @returns {undefined}\n*/\nthis.setRectRadius = function (val) {\n  const selected = selectedElements[0];\n  if (selected != null && selected.tagName === 'rect') {\n    const r = selected.getAttribute('rx');\n    if (r !== String(val)) {\n      selected.setAttribute('rx', val);\n      selected.setAttribute('ry', val);\n      addCommandToHistory(new ChangeElementCommand(selected, {rx: r, ry: r}, 'Radius'));\n      call('changed', [selected]);\n    }\n  }\n};\n\n/**\n* Wraps the selected element(s) in an anchor element or converts group to one\n* @function module:svgcanvas.SvgCanvas#makeHyperlink\n* @param {string} url\n* @returns {undefined}\n*/\nthis.makeHyperlink = function (url) {\n  canvas.groupSelectedElements('a', url);\n\n  // TODO: If element is a single \"g\", convert to \"a\"\n  //  if (selectedElements.length > 1 && selectedElements[1]) {\n};\n\n/**\n* @function module:svgcanvas.SvgCanvas#removeHyperlink\n* @returns {undefined}\n*/\nthis.removeHyperlink = function () {\n  canvas.ungroupSelectedElement();\n};\n\n/**\n* Group: Element manipulation\n*/\n\n/**\n* Sets the new segment type to the selected segment(s).\n* @function module:svgcanvas.SvgCanvas#setSegType\n* @param {Integer} newType - New segment type. See {@link https://www.w3.org/TR/SVG/paths.html#InterfaceSVGPathSeg} for list\n* @returns {undefined}\n*/\nthis.setSegType = function (newType) {\n  pathActions.setSegType(newType);\n};\n\n/**\n* Convert selected element to a path, or get the BBox of an element-as-path\n* @function module:svgcanvas.SvgCanvas#convertToPath\n* @todo (codedread): Remove the getBBox argument and split this function into two.\n* @param {Element} elem - The DOM element to be converted\n* @param {boolean} getBBox - Boolean on whether or not to only return the path's BBox\n* @returns {undefined|DOMRect|false|SVGPathElement|null} If the getBBox flag is true, the resulting path's bounding box object.\n* Otherwise the resulting path element is returned.\n*/\nthis.convertToPath = function (elem, getBBox) {\n  if (elem == null) {\n    const elems = selectedElements;\n    $.each(elems, function (i, elem) {\n      if (elem) { canvas.convertToPath(elem); }\n    });\n    return;\n  }\n  if (getBBox) {\n    return getBBoxOfElementAsPath(elem, addSVGElementFromJson, pathActions);\n  }\n  // TODO: Why is this applying attributes from curShape, then inside utilities.convertToPath it's pulling addition attributes from elem?\n  // TODO: If convertToPath is called with one elem, curShape and elem are probably the same; but calling with multiple is a bug or cool feature.\n  const attrs = {\n    fill: curShape.fill,\n    'fill-opacity': curShape.fill_opacity,\n    stroke: curShape.stroke,\n    'stroke-width': curShape.stroke_width,\n    'stroke-dasharray': curShape.stroke_dasharray,\n    'stroke-linejoin': curShape.stroke_linejoin,\n    'stroke-linecap': curShape.stroke_linecap,\n    'stroke-opacity': curShape.stroke_opacity,\n    opacity: curShape.opacity,\n    visibility: 'hidden'\n  };\n  return convertToPath(elem, attrs, addSVGElementFromJson, pathActions, clearSelection, addToSelection, history, addCommandToHistory);\n};\n\n/**\n* This function makes the changes to the elements. It does not add the change\n* to the history stack.\n* @param {string} attr - Attribute name\n* @param {string|Float} newValue - String or number with the new attribute value\n* @param {Element[]} elems - The DOM elements to apply the change to\n* @returns {undefined}\n*/\nconst changeSelectedAttributeNoUndo = function (attr, newValue, elems) {\n  if (currentMode === 'pathedit') {\n    // Editing node\n    pathActions.moveNode(attr, newValue);\n  }\n  elems = elems || selectedElements;\n  let i = elems.length;\n  const noXYElems = ['g', 'polyline', 'path'];\n  const goodGAttrs = ['transform', 'opacity', 'filter'];\n\n  while (i--) {\n    let elem = elems[i];\n    if (elem == null) { continue; }\n\n    // Set x,y vals on elements that don't have them\n    if ((attr === 'x' || attr === 'y') && noXYElems.includes(elem.tagName)) {\n      const bbox = getStrokedBBoxDefaultVisible([elem]);\n      const diffX = attr === 'x' ? newValue - bbox.x : 0;\n      const diffY = attr === 'y' ? newValue - bbox.y : 0;\n      canvas.moveSelectedElements(diffX * currentZoom, diffY * currentZoom, true);\n      continue;\n    }\n\n    // only allow the transform/opacity/filter attribute to change on <g> elements, slightly hacky\n    // TODO: FIXME: This doesn't seem right. Where's the body of this if statement?\n    if (elem.tagName === 'g' && goodGAttrs.includes(attr)) {}\n    let oldval = attr === '#text' ? elem.textContent : elem.getAttribute(attr);\n    if (oldval == null) { oldval = ''; }\n    if (oldval !== String(newValue)) {\n      if (attr === '#text') {\n        // const oldW = utilsGetBBox(elem).width;\n        elem.textContent = newValue;\n\n        // FF bug occurs on on rotated elements\n        if ((/rotate/).test(elem.getAttribute('transform'))) {\n          elem = ffClone(elem);\n        }\n        // Hoped to solve the issue of moving text with text-anchor=\"start\",\n        // but this doesn't actually fix it. Hopefully on the right track, though. -Fyrd\n        // const box = getBBox(elem), left = box.x, top = box.y, {width, height} = box,\n        //   dx = width - oldW, dy = 0;\n        // const angle = getRotationAngle(elem, true);\n        // if (angle) {\n        //   const r = Math.sqrt(dx * dx + dy * dy);\n        //   const theta = Math.atan2(dy, dx) - angle;\n        //   dx = r * Math.cos(theta);\n        //   dy = r * Math.sin(theta);\n        //\n        //   elem.setAttribute('x', elem.getAttribute('x') - dx);\n        //   elem.setAttribute('y', elem.getAttribute('y') - dy);\n        // }\n      } else if (attr === '#href') {\n        setHref(elem, newValue);\n      } else { elem.setAttribute(attr, newValue); }\n\n      // Go into \"select\" mode for text changes\n      // NOTE: Important that this happens AFTER elem.setAttribute() or else attributes like\n      // font-size can get reset to their old value, ultimately by svgEditor.updateContextPanel(),\n      // after calling textActions.toSelectMode() below\n      if (currentMode === 'textedit' && attr !== '#text' && elem.textContent.length) {\n        textActions.toSelectMode(elem);\n      }\n\n      // if (i === 0) {\n      //   selectedBBoxes[0] = utilsGetBBox(elem);\n      // }\n\n      // Use the Firefox ffClone hack for text elements with gradients or\n      // where other text attributes are changed.\n      if (isGecko() && elem.nodeName === 'text' && (/rotate/).test(elem.getAttribute('transform'))) {\n        if (String(newValue).startsWith('url') || (['font-size', 'font-family', 'x', 'y'].includes(attr) && elem.textContent)) {\n          elem = ffClone(elem);\n        }\n      }\n      // Timeout needed for Opera & Firefox\n      // codedread: it is now possible for this function to be called with elements\n      // that are not in the selectedElements array, we need to only request a\n      // selector if the element is in that array\n      if (selectedElements.includes(elem)) {\n        setTimeout(function () {\n          // Due to element replacement, this element may no longer\n          // be part of the DOM\n          if (!elem.parentNode) { return; }\n          selectorManager.requestSelector(elem).resize();\n        }, 0);\n      }\n      // if this element was rotated, and we changed the position of this element\n      // we need to update the rotational transform attribute\n      const angle = getRotationAngle(elem);\n      if (angle !== 0 && attr !== 'transform') {\n        const tlist = getTransformList(elem);\n        let n = tlist.numberOfItems;\n        while (n--) {\n          const xform = tlist.getItem(n);\n          if (xform.type === 4) {\n            // remove old rotate\n            tlist.removeItem(n);\n\n            const box = utilsGetBBox(elem);\n            const center = transformPoint(box.x + box.width / 2, box.y + box.height / 2, transformListToTransform(tlist).matrix);\n            const cx = center.x,\n              cy = center.y;\n            const newrot = svgroot.createSVGTransform();\n            newrot.setRotate(angle, cx, cy);\n            tlist.insertItemBefore(newrot, n);\n            break;\n          }\n        }\n      }\n    } // if oldValue != newValue\n  } // for each elem\n};\n\n/**\n* Change the given/selected element and add the original value to the history stack.\n* If you want to change all `selectedElements`, ignore the `elems` argument.\n* If you want to change only a subset of `selectedElements`, then send the\n* subset to this function in the `elems` argument.\n* @function module:svgcanvas.SvgCanvas#changeSelectedAttribute\n* @param {string} attr - String with the attribute name\n* @param {string|Float} newValue - String or number with the new attribute value\n* @param {Element[]} elems - The DOM elements to apply the change to\n* @returns {undefined}\n*/\nconst changeSelectedAttribute = this.changeSelectedAttribute = function (attr, val, elems) {\n  elems = elems || selectedElements;\n  canvas.undoMgr.beginUndoableChange(attr, elems);\n  // const i = elems.length;\n\n  changeSelectedAttributeNoUndo(attr, val, elems);\n\n  const batchCmd = canvas.undoMgr.finishUndoableChange();\n  if (!batchCmd.isEmpty()) {\n    addCommandToHistory(batchCmd);\n  }\n};\n\n/**\n* Removes all selected elements from the DOM and adds the change to the\n* history stack\n* @function module:svgcanvas.SvgCanvas#deleteSelectedElements\n* @fires module:svgcanvas.SvgCanvas#event:changed\n* @returns {undefined}\n*/\nthis.deleteSelectedElements = function () {\n  const batchCmd = new BatchCommand('Delete Elements');\n  const len = selectedElements.length;\n  const selectedCopy = []; // selectedElements is being deleted\n\n  for (let i = 0; i < len; ++i) {\n    const selected = selectedElements[i];\n    if (selected == null) { break; }\n\n    let parent = selected.parentNode;\n    let t = selected;\n\n    // this will unselect the element and remove the selectedOutline\n    selectorManager.releaseSelector(t);\n\n    // Remove the path if present.\n    pathModule.removePath_(t.id);\n\n    // Get the parent if it's a single-child anchor\n    if (parent.tagName === 'a' && parent.childNodes.length === 1) {\n      t = parent;\n      parent = parent.parentNode;\n    }\n\n    const {nextSibling} = t;\n    const elem = parent.removeChild(t);\n    selectedCopy.push(selected); // for the copy\n    batchCmd.addSubCommand(new RemoveElementCommand(elem, nextSibling, parent));\n  }\n  selectedElements = [];\n\n  if (!batchCmd.isEmpty()) { addCommandToHistory(batchCmd); }\n  call('changed', selectedCopy);\n  clearSelection();\n};\n\n/**\n* Removes all selected elements from the DOM and adds the change to the\n* history stack. Remembers removed elements on the clipboard\n* @function module:svgcanvas.SvgCanvas#cutSelectedElements\n* @returns {undefined}\n*/\nthis.cutSelectedElements = function () {\n  canvas.copySelectedElements();\n  canvas.deleteSelectedElements();\n};\n\n/**\n* Remembers the current selected elements on the clipboard\n* @function module:svgcanvas.SvgCanvas#copySelectedElements\n* @returns {undefined}\n*/\nthis.copySelectedElements = function () {\n  localStorage.setItem('svgedit_clipboard', JSON.stringify(\n    selectedElements.map(function (x) { return getJsonFromSvgElement(x); })\n  ));\n\n  $('#cmenu_canvas').enableContextMenuItems('#paste,#paste_in_place');\n};\n\n/**\n* @function module:svgcanvas.SvgCanvas#pasteElements\n* @param {\"in_place\"|\"point\"|undefined} type\n* @param {Integer|undefined} x Expected if type is \"point\"\n* @param {Integer|undefined} y Expected if type is \"point\"\n* @fires module:svgcanvas.SvgCanvas#event:changed\n* @fires module:svgcanvas.SvgCanvas#event:ext-IDsUpdated\n* @returns {undefined}\n*/\nthis.pasteElements = function (type, x, y) {\n  let clipb = JSON.parse(localStorage.getItem('svgedit_clipboard'));\n  let len = clipb.length;\n  if (!len) { return; }\n\n  const pasted = [];\n  const batchCmd = new BatchCommand('Paste elements');\n  // const drawing = getCurrentDrawing();\n  /**\n  * @typedef {PlainObject.<string, string>} module:svgcanvas.ChangedIDs\n  */\n  /**\n   * @type {module:svgcanvas.ChangedIDs}\n   */\n  const changedIDs = {};\n\n  // Recursively replace IDs and record the changes\n  function checkIDs (elem) {\n    if (elem.attr && elem.attr.id) {\n      changedIDs[elem.attr.id] = getNextId();\n      elem.attr.id = changedIDs[elem.attr.id];\n    }\n    if (elem.children) elem.children.forEach(checkIDs);\n  }\n  clipb.forEach(checkIDs);\n\n  // Give extensions like the connector extension a chance to reflect new IDs and remove invalid elements\n  /**\n  * Triggered when `pasteElements` is called from a paste action (context menu or key)\n  * @event module:svgcanvas.SvgCanvas#event:ext-IDsUpdated\n  * @type {PlainObject}\n  * @property {module:svgcanvas.SVGAsJSON[]} elems\n  * @property {module:svgcanvas.ChangedIDs} changes Maps past ID (on attribute) to current ID\n  */\n  runExtensions(\n    'IDsUpdated',\n    /** @type {module:svgcanvas.SvgCanvas#event:ext-IDsUpdated} */\n    {elems: clipb, changes: changedIDs},\n    true\n  ).forEach(function (extChanges) {\n    if (!extChanges || !('remove' in extChanges)) return;\n\n    extChanges.remove.forEach(function (removeID) {\n      clipb = clipb.filter(function (clipBoardItem) {\n        return clipBoardItem.attr.id !== removeID;\n      });\n    });\n  });\n\n  // Move elements to lastClickPoint\n  while (len--) {\n    const elem = clipb[len];\n    if (!elem) { continue; }\n\n    const copy = addSVGElementFromJson(elem);\n    pasted.push(copy);\n    batchCmd.addSubCommand(new InsertElementCommand(copy));\n\n    restoreRefElems(copy);\n  }\n\n  selectOnly(pasted);\n\n  if (type !== 'in_place') {\n    let ctrX, ctrY;\n\n    if (!type) {\n      ctrX = lastClickPoint.x;\n      ctrY = lastClickPoint.y;\n    } else if (type === 'point') {\n      ctrX = x;\n      ctrY = y;\n    }\n\n    const bbox = getStrokedBBoxDefaultVisible(pasted);\n    const cx = ctrX - (bbox.x + bbox.width / 2),\n      cy = ctrY - (bbox.y + bbox.height / 2),\n      dx = [],\n      dy = [];\n\n    $.each(pasted, function (i, item) {\n      dx.push(cx);\n      dy.push(cy);\n    });\n\n    const cmd = canvas.moveSelectedElements(dx, dy, false);\n    if (cmd) batchCmd.addSubCommand(cmd);\n  }\n\n  addCommandToHistory(batchCmd);\n  call('changed', pasted);\n};\n\n/**\n* Wraps all the selected elements in a group (`g`) element\n* @function module:svgcanvas.SvgCanvas#groupSelectedElements\n* @param {\"a\"|\"g\"} [type=\"g\"] - type of element to group into, defaults to `<g>`\n* @param {string} [urlArg]\n* @returns {undefined}\n*/\nthis.groupSelectedElements = function (type, urlArg) {\n  if (!type) { type = 'g'; }\n  let cmdStr = '';\n  let url;\n\n  switch (type) {\n  case 'a': {\n    cmdStr = 'Make hyperlink';\n    url = urlArg || '';\n    break;\n  } default: {\n    type = 'g';\n    cmdStr = 'Group Elements';\n    break;\n  }\n  }\n\n  const batchCmd = new BatchCommand(cmdStr);\n\n  // create and insert the group element\n  const g = addSVGElementFromJson({\n    element: type,\n    attr: {\n      id: getNextId()\n    }\n  });\n  if (type === 'a') {\n    setHref(g, url);\n  }\n  batchCmd.addSubCommand(new InsertElementCommand(g));\n\n  // now move all children into the group\n  let i = selectedElements.length;\n  while (i--) {\n    let elem = selectedElements[i];\n    if (elem == null) { continue; }\n\n    if (elem.parentNode.tagName === 'a' && elem.parentNode.childNodes.length === 1) {\n      elem = elem.parentNode;\n    }\n\n    const oldNextSibling = elem.nextSibling;\n    const oldParent = elem.parentNode;\n    g.append(elem);\n    batchCmd.addSubCommand(new MoveElementCommand(elem, oldNextSibling, oldParent));\n  }\n  if (!batchCmd.isEmpty()) { addCommandToHistory(batchCmd); }\n\n  // update selection\n  selectOnly([g], true);\n};\n\n/**\n* Pushes all appropriate parent group properties down to its children, then\n* removes them from the group\n* @function module:svgcanvas.SvgCanvas#pushGroupProperties\n* @param {SVGAElement|SVGGElement} g\n* @param {boolean} undoable\n* @returns {undefined}\n*/\nconst pushGroupProperties = this.pushGroupProperties = function (g, undoable) {\n  const children = g.childNodes;\n  const len = children.length;\n  const xform = g.getAttribute('transform');\n\n  const glist = getTransformList(g);\n  const m = transformListToTransform(glist).matrix;\n\n  const batchCmd = new BatchCommand('Push group properties');\n\n  // TODO: get all fill/stroke properties from the group that we are about to destroy\n  // \"fill\", \"fill-opacity\", \"fill-rule\", \"stroke\", \"stroke-dasharray\", \"stroke-dashoffset\",\n  // \"stroke-linecap\", \"stroke-linejoin\", \"stroke-miterlimit\", \"stroke-opacity\",\n  // \"stroke-width\"\n  // and then for each child, if they do not have the attribute (or the value is 'inherit')\n  // then set the child's attribute\n\n  const gangle = getRotationAngle(g);\n\n  const gattrs = $(g).attr(['filter', 'opacity']);\n  let gfilter, gblur, changes;\n  const drawing = getCurrentDrawing();\n\n  for (let i = 0; i < len; i++) {\n    const elem = children[i];\n\n    if (elem.nodeType !== 1) { continue; }\n\n    if (gattrs.opacity !== null && gattrs.opacity !== 1) {\n      // const c_opac = elem.getAttribute('opacity') || 1;\n      const newOpac = Math.round((elem.getAttribute('opacity') || 1) * gattrs.opacity * 100) / 100;\n      changeSelectedAttribute('opacity', newOpac, [elem]);\n    }\n\n    if (gattrs.filter) {\n      let cblur = this.getBlur(elem);\n      const origCblur = cblur;\n      if (!gblur) { gblur = this.getBlur(g); }\n      if (cblur) {\n        // Is this formula correct?\n        cblur = Number(gblur) + Number(cblur);\n      } else if (cblur === 0) {\n        cblur = gblur;\n      }\n\n      // If child has no current filter, get group's filter or clone it.\n      if (!origCblur) {\n        // Set group's filter to use first child's ID\n        if (!gfilter) {\n          gfilter = getRefElem(gattrs.filter);\n        } else {\n          // Clone the group's filter\n          gfilter = drawing.copyElem(gfilter);\n          findDefs().append(gfilter);\n        }\n      } else {\n        gfilter = getRefElem(elem.getAttribute('filter'));\n      }\n\n      // Change this in future for different filters\n      const suffix = (gfilter.firstChild.tagName === 'feGaussianBlur') ? 'blur' : 'filter';\n      gfilter.id = elem.id + '_' + suffix;\n      changeSelectedAttribute('filter', 'url(#' + gfilter.id + ')', [elem]);\n\n      // Update blur value\n      if (cblur) {\n        changeSelectedAttribute('stdDeviation', cblur, [gfilter.firstChild]);\n        canvas.setBlurOffsets(gfilter, cblur);\n      }\n    }\n\n    let chtlist = getTransformList(elem);\n\n    // Don't process gradient transforms\n    if (elem.tagName.includes('Gradient')) { chtlist = null; }\n\n    // Hopefully not a problem to add this. Necessary for elements like <desc/>\n    if (!chtlist) { continue; }\n\n    // Apparently <defs> can get get a transformlist, but we don't want it to have one!\n    if (elem.tagName === 'defs') { continue; }\n\n    if (glist.numberOfItems) {\n      // TODO: if the group's transform is just a rotate, we can always transfer the\n      // rotate() down to the children (collapsing consecutive rotates and factoring\n      // out any translates)\n      if (gangle && glist.numberOfItems === 1) {\n        // [Rg] [Rc] [Mc]\n        // we want [Tr] [Rc2] [Mc] where:\n        //  - [Rc2] is at the child's current center but has the\n        // sum of the group and child's rotation angles\n        //  - [Tr] is the equivalent translation that this child\n        // undergoes if the group wasn't there\n\n        // [Tr] = [Rg] [Rc] [Rc2_inv]\n\n        // get group's rotation matrix (Rg)\n        const rgm = glist.getItem(0).matrix;\n\n        // get child's rotation matrix (Rc)\n        let rcm = svgroot.createSVGMatrix();\n        const cangle = getRotationAngle(elem);\n        if (cangle) {\n          rcm = chtlist.getItem(0).matrix;\n        }\n\n        // get child's old center of rotation\n        const cbox = utilsGetBBox(elem);\n        const ceqm = transformListToTransform(chtlist).matrix;\n        const coldc = transformPoint(cbox.x + cbox.width / 2, cbox.y + cbox.height / 2, ceqm);\n\n        // sum group and child's angles\n        const sangle = gangle + cangle;\n\n        // get child's rotation at the old center (Rc2_inv)\n        const r2 = svgroot.createSVGTransform();\n        r2.setRotate(sangle, coldc.x, coldc.y);\n\n        // calculate equivalent translate\n        const trm = matrixMultiply(rgm, rcm, r2.matrix.inverse());\n\n        // set up tlist\n        if (cangle) {\n          chtlist.removeItem(0);\n        }\n\n        if (sangle) {\n          if (chtlist.numberOfItems) {\n            chtlist.insertItemBefore(r2, 0);\n          } else {\n            chtlist.appendItem(r2);\n          }\n        }\n\n        if (trm.e || trm.f) {\n          const tr = svgroot.createSVGTransform();\n          tr.setTranslate(trm.e, trm.f);\n          if (chtlist.numberOfItems) {\n            chtlist.insertItemBefore(tr, 0);\n          } else {\n            chtlist.appendItem(tr);\n          }\n        }\n      } else { // more complicated than just a rotate\n        // transfer the group's transform down to each child and then\n        // call recalculateDimensions()\n        const oldxform = elem.getAttribute('transform');\n        changes = {};\n        changes.transform = oldxform || '';\n\n        const newxform = svgroot.createSVGTransform();\n\n        // [ gm ] [ chm ] = [ chm ] [ gm' ]\n        // [ gm' ] = [ chmInv ] [ gm ] [ chm ]\n        const chm = transformListToTransform(chtlist).matrix,\n          chmInv = chm.inverse();\n        const gm = matrixMultiply(chmInv, m, chm);\n        newxform.setMatrix(gm);\n        chtlist.appendItem(newxform);\n      }\n      const cmd = recalculateDimensions(elem);\n      if (cmd) { batchCmd.addSubCommand(cmd); }\n    }\n  }\n\n  // remove transform and make it undo-able\n  if (xform) {\n    changes = {};\n    changes.transform = xform;\n    g.setAttribute('transform', '');\n    g.removeAttribute('transform');\n    batchCmd.addSubCommand(new ChangeElementCommand(g, changes));\n  }\n\n  if (undoable && !batchCmd.isEmpty()) {\n    return batchCmd;\n  }\n};\n\n/**\n* Unwraps all the elements in a selected group (`g`) element. This requires\n* significant recalculations to apply group's transforms, etc. to its children\n* @function module:svgcanvas.SvgCanvas#ungroupSelectedElement\n* @returns {undefined}\n*/\nthis.ungroupSelectedElement = function () {\n  let g = selectedElements[0];\n  if (!g) {\n    return;\n  }\n  if ($(g).data('gsvg') || $(g).data('symbol')) {\n    // Is svg, so actually convert to group\n    convertToGroup(g);\n    return;\n  }\n  if (g.tagName === 'use') {\n    // Somehow doesn't have data set, so retrieve\n    const symbol = getElem(getHref(g).substr(1));\n    $(g).data('symbol', symbol).data('ref', symbol);\n    convertToGroup(g);\n    return;\n  }\n  const parentsA = $(g).parents('a');\n  if (parentsA.length) {\n    g = parentsA[0];\n  }\n\n  // Look for parent \"a\"\n  if (g.tagName === 'g' || g.tagName === 'a') {\n    const batchCmd = new BatchCommand('Ungroup Elements');\n    const cmd = pushGroupProperties(g, true);\n    if (cmd) { batchCmd.addSubCommand(cmd); }\n\n    const parent = g.parentNode;\n    const anchor = g.nextSibling;\n    const children = new Array(g.childNodes.length);\n\n    let i = 0;\n    while (g.firstChild) {\n      let elem = g.firstChild;\n      const oldNextSibling = elem.nextSibling;\n      const oldParent = elem.parentNode;\n\n      // Remove child title elements\n      if (elem.tagName === 'title') {\n        const {nextSibling} = elem;\n        batchCmd.addSubCommand(new RemoveElementCommand(elem, nextSibling, oldParent));\n        elem.remove();\n        continue;\n      }\n\n      children[i++] = elem = parent.insertBefore(elem, anchor);\n      batchCmd.addSubCommand(new MoveElementCommand(elem, oldNextSibling, oldParent));\n    }\n\n    // remove the group from the selection\n    clearSelection();\n\n    // delete the group element (but make undo-able)\n    const gNextSibling = g.nextSibling;\n    g = parent.removeChild(g);\n    batchCmd.addSubCommand(new RemoveElementCommand(g, gNextSibling, parent));\n\n    if (!batchCmd.isEmpty()) { addCommandToHistory(batchCmd); }\n\n    // update selection\n    addToSelection(children);\n  }\n};\n\n/**\n* Repositions the selected element to the bottom in the DOM to appear on top of\n* other elements\n* @function module:svgcanvas.SvgCanvas#moveToTopSelectedElement\n* @fires module:svgcanvas.SvgCanvas#event:changed\n* @returns {undefined}\n*/\nthis.moveToTopSelectedElement = function () {\n  const [selected] = selectedElements;\n  if (selected != null) {\n    let t = selected;\n    const oldParent = t.parentNode;\n    const oldNextSibling = t.nextSibling;\n    t = t.parentNode.appendChild(t);\n    // If the element actually moved position, add the command and fire the changed\n    // event handler.\n    if (oldNextSibling !== t.nextSibling) {\n      addCommandToHistory(new MoveElementCommand(t, oldNextSibling, oldParent, 'top'));\n      call('changed', [t]);\n    }\n  }\n};\n\n/**\n* Repositions the selected element to the top in the DOM to appear under\n* other elements\n* @function module:svgcanvas.SvgCanvas#moveToBottomSelectedElement\n* @fires module:svgcanvas.SvgCanvas#event:changed\n* @returns {undefined}\n*/\nthis.moveToBottomSelectedElement = function () {\n  const [selected] = selectedElements;\n  if (selected != null) {\n    let t = selected;\n    const oldParent = t.parentNode;\n    const oldNextSibling = t.nextSibling;\n    let {firstChild} = t.parentNode;\n    if (firstChild.tagName === 'title') {\n      firstChild = firstChild.nextSibling;\n    }\n    // This can probably be removed, as the defs should not ever apppear\n    // inside a layer group\n    if (firstChild.tagName === 'defs') {\n      firstChild = firstChild.nextSibling;\n    }\n    t = t.parentNode.insertBefore(t, firstChild);\n    // If the element actually moved position, add the command and fire the changed\n    // event handler.\n    if (oldNextSibling !== t.nextSibling) {\n      addCommandToHistory(new MoveElementCommand(t, oldNextSibling, oldParent, 'bottom'));\n      call('changed', [t]);\n    }\n  }\n};\n\n/**\n* Moves the select element up or down the stack, based on the visibly\n* intersecting elements\n* @function module:svgcanvas.SvgCanvas#moveUpDownSelected\n* @param {\"Up\"|\"Down\"} dir - String that's either 'Up' or 'Down'\n* @fires module:svgcanvas.SvgCanvas#event:changed\n* @returns {undefined}\n*/\nthis.moveUpDownSelected = function (dir) {\n  const selected = selectedElements[0];\n  if (!selected) { return; }\n\n  curBBoxes = [];\n  let closest, foundCur;\n  // jQuery sorts this list\n  const list = $(getIntersectionList(getStrokedBBoxDefaultVisible([selected]))).toArray();\n  if (dir === 'Down') { list.reverse(); }\n\n  $.each(list, function () {\n    if (!foundCur) {\n      if (this === selected) {\n        foundCur = true;\n      }\n      return;\n    }\n    closest = this;\n    return false;\n  });\n  if (!closest) { return; }\n\n  const t = selected;\n  const oldParent = t.parentNode;\n  const oldNextSibling = t.nextSibling;\n  $(closest)[dir === 'Down' ? 'before' : 'after'](t);\n  // If the element actually moved position, add the command and fire the changed\n  // event handler.\n  if (oldNextSibling !== t.nextSibling) {\n    addCommandToHistory(new MoveElementCommand(t, oldNextSibling, oldParent, 'Move ' + dir));\n    call('changed', [t]);\n  }\n};\n\n/**\n* Moves selected elements on the X/Y axis\n* @function module:svgcanvas.SvgCanvas#moveSelectedElements\n* @param {Float} dx - Float with the distance to move on the x-axis\n* @param {Float} dy - Float with the distance to move on the y-axis\n* @param {boolean} undoable - Boolean indicating whether or not the action should be undoable\n* @fires module:svgcanvas.SvgCanvas#event:changed\n* @returns {BatchCommand} Batch command for the move\n*/\nthis.moveSelectedElements = function (dx, dy, undoable) {\n  // if undoable is not sent, default to true\n  // if single values, scale them to the zoom\n  if (dx.constructor !== Array) {\n    dx /= currentZoom;\n    dy /= currentZoom;\n  }\n  undoable = undoable || true;\n  const batchCmd = new BatchCommand('position');\n  let i = selectedElements.length;\n  while (i--) {\n    const selected = selectedElements[i];\n    if (selected != null) {\n      // if (i === 0) {\n      //   selectedBBoxes[0] = utilsGetBBox(selected);\n      // }\n      // const b = {};\n      // for (const j in selectedBBoxes[i]) b[j] = selectedBBoxes[i][j];\n      // selectedBBoxes[i] = b;\n\n      const xform = svgroot.createSVGTransform();\n      const tlist = getTransformList(selected);\n\n      // dx and dy could be arrays\n      if (dx.constructor === Array) {\n        // if (i === 0) {\n        //   selectedBBoxes[0].x += dx[0];\n        //   selectedBBoxes[0].y += dy[0];\n        // }\n        xform.setTranslate(dx[i], dy[i]);\n      } else {\n        // if (i === 0) {\n        //   selectedBBoxes[0].x += dx;\n        //   selectedBBoxes[0].y += dy;\n        // }\n        xform.setTranslate(dx, dy);\n      }\n\n      if (tlist.numberOfItems) {\n        tlist.insertItemBefore(xform, 0);\n      } else {\n        tlist.appendItem(xform);\n      }\n\n      const cmd = recalculateDimensions(selected);\n      if (cmd) {\n        batchCmd.addSubCommand(cmd);\n      }\n\n      selectorManager.requestSelector(selected).resize();\n    }\n  }\n  if (!batchCmd.isEmpty()) {\n    if (undoable) {\n      addCommandToHistory(batchCmd);\n    }\n    call('changed', selectedElements);\n    return batchCmd;\n  }\n};\n\n/**\n* Create deep DOM copies (clones) of all selected elements and move them slightly\n* from their originals\n* @function module:svgcanvas.SvgCanvas#cloneSelectedElements\n* @param {Float} x Float with the distance to move on the x-axis\n* @param {Float} y Float with the distance to move on the y-axis\n* @returns {undefined}\n*/\nthis.cloneSelectedElements = function (x, y) {\n  let i, elem;\n  const batchCmd = new BatchCommand('Clone Elements');\n  // find all the elements selected (stop at first null)\n  const len = selectedElements.length;\n  function sortfunction (a, b) {\n    return ($(b).index() - $(a).index()); // causes an array to be sorted numerically and ascending\n  }\n  selectedElements.sort(sortfunction);\n  for (i = 0; i < len; ++i) {\n    elem = selectedElements[i];\n    if (elem == null) { break; }\n  }\n  // use slice to quickly get the subset of elements we need\n  const copiedElements = selectedElements.slice(0, i);\n  this.clearSelection(true);\n  // note that we loop in the reverse way because of the way elements are added\n  // to the selectedElements array (top-first)\n  const drawing = getCurrentDrawing();\n  i = copiedElements.length;\n  while (i--) {\n    // clone each element and replace it within copiedElements\n    elem = copiedElements[i] = drawing.copyElem(copiedElements[i]);\n    (currentGroup || drawing.getCurrentLayer()).append(elem);\n    batchCmd.addSubCommand(new InsertElementCommand(elem));\n  }\n\n  if (!batchCmd.isEmpty()) {\n    addToSelection(copiedElements.reverse()); // Need to reverse for correct selection-adding\n    this.moveSelectedElements(x, y, false);\n    addCommandToHistory(batchCmd);\n  }\n};\n\n/**\n* Aligns selected elements\n* @function module:svgcanvas.SvgCanvas#alignSelectedElements\n* @param {string} type - String with single character indicating the alignment type\n* @param {\"selected\"|\"largest\"|\"smallest\"|\"page\"} relativeTo\n* @returns {undefined}\n*/\nthis.alignSelectedElements = function (type, relativeTo) {\n  const bboxes = []; // angles = [];\n  const len = selectedElements.length;\n  if (!len) { return; }\n  let minx = Number.MAX_VALUE, maxx = Number.MIN_VALUE,\n    miny = Number.MAX_VALUE, maxy = Number.MIN_VALUE;\n  let curwidth = Number.MIN_VALUE, curheight = Number.MIN_VALUE;\n  for (let i = 0; i < len; ++i) {\n    if (selectedElements[i] == null) { break; }\n    const elem = selectedElements[i];\n    bboxes[i] = getStrokedBBoxDefaultVisible([elem]);\n\n    // now bbox is axis-aligned and handles rotation\n    switch (relativeTo) {\n    case 'smallest':\n      if (((type === 'l' || type === 'c' || type === 'r') &&\n        (curwidth === Number.MIN_VALUE || curwidth > bboxes[i].width)) ||\n        ((type === 't' || type === 'm' || type === 'b') &&\n        (curheight === Number.MIN_VALUE || curheight > bboxes[i].height))\n      ) {\n        minx = bboxes[i].x;\n        miny = bboxes[i].y;\n        maxx = bboxes[i].x + bboxes[i].width;\n        maxy = bboxes[i].y + bboxes[i].height;\n        curwidth = bboxes[i].width;\n        curheight = bboxes[i].height;\n      }\n      break;\n    case 'largest':\n      if (((type === 'l' || type === 'c' || type === 'r') &&\n        (curwidth === Number.MIN_VALUE || curwidth < bboxes[i].width)) ||\n        ((type === 't' || type === 'm' || type === 'b') &&\n        (curheight === Number.MIN_VALUE || curheight < bboxes[i].height))\n      ) {\n        minx = bboxes[i].x;\n        miny = bboxes[i].y;\n        maxx = bboxes[i].x + bboxes[i].width;\n        maxy = bboxes[i].y + bboxes[i].height;\n        curwidth = bboxes[i].width;\n        curheight = bboxes[i].height;\n      }\n      break;\n    default: // 'selected'\n      if (bboxes[i].x < minx) { minx = bboxes[i].x; }\n      if (bboxes[i].y < miny) { miny = bboxes[i].y; }\n      if (bboxes[i].x + bboxes[i].width > maxx) { maxx = bboxes[i].x + bboxes[i].width; }\n      if (bboxes[i].y + bboxes[i].height > maxy) { maxy = bboxes[i].y + bboxes[i].height; }\n      break;\n    }\n  } // loop for each element to find the bbox and adjust min/max\n\n  if (relativeTo === 'page') {\n    minx = 0;\n    miny = 0;\n    maxx = canvas.contentW;\n    maxy = canvas.contentH;\n  }\n\n  const dx = new Array(len);\n  const dy = new Array(len);\n  for (let i = 0; i < len; ++i) {\n    if (selectedElements[i] == null) { break; }\n    // const elem = selectedElements[i];\n    const bbox = bboxes[i];\n    dx[i] = 0;\n    dy[i] = 0;\n    switch (type) {\n    case 'l': // left (horizontal)\n      dx[i] = minx - bbox.x;\n      break;\n    case 'c': // center (horizontal)\n      dx[i] = (minx + maxx) / 2 - (bbox.x + bbox.width / 2);\n      break;\n    case 'r': // right (horizontal)\n      dx[i] = maxx - (bbox.x + bbox.width);\n      break;\n    case 't': // top (vertical)\n      dy[i] = miny - bbox.y;\n      break;\n    case 'm': // middle (vertical)\n      dy[i] = (miny + maxy) / 2 - (bbox.y + bbox.height / 2);\n      break;\n    case 'b': // bottom (vertical)\n      dy[i] = maxy - (bbox.y + bbox.height);\n      break;\n    }\n  }\n  this.moveSelectedElements(dx, dy);\n};\n\n/**\n* Group: Additional editor tools\n*/\n\n/**\n* @name module:svgcanvas.SvgCanvas#contentW\n* @type {Float}\n*/\nthis.contentW = getResolution().w;\n/**\n* @name module:svgcanvas.SvgCanvas#contentH\n* @type {Float}\n*/\nthis.contentH = getResolution().h;\n\n/**\n* @typedef {PlainObject} module:svgcanvas.CanvasInfo\n* @property {Float} x - The canvas' new x coordinate\n* @property {Float} y - The canvas' new y coordinate\n* @property {string} oldX - The canvas' old x coordinate\n* @property {string} oldY - The canvas' old y coordinate\n* @property {Float} d_x - The x position difference\n* @property {Float} d_y - The y position difference\n*/\n\n/**\n* Updates the editor canvas width/height/position after a zoom has occurred\n* @function module:svgcanvas.SvgCanvas#updateCanvas\n* @param {Float} w - Float with the new width\n* @param {Float} h - Float with the new height\n* @fires module:svgcanvas.SvgCanvas#event:ext-canvasUpdated\n* @returns {module:svgcanvas.CanvasInfo}\n*/\nthis.updateCanvas = function (w, h) {\n  svgroot.setAttribute('width', w);\n  svgroot.setAttribute('height', h);\n  const bg = $('#canvasBackground')[0];\n  const oldX = svgcontent.getAttribute('x');\n  const oldY = svgcontent.getAttribute('y');\n  const x = (w / 2 - this.contentW * currentZoom / 2);\n  const y = (h / 2 - this.contentH * currentZoom / 2);\n\n  assignAttributes(svgcontent, {\n    width: this.contentW * currentZoom,\n    height: this.contentH * currentZoom,\n    x,\n    y,\n    viewBox: '0 0 ' + this.contentW + ' ' + this.contentH\n  });\n\n  assignAttributes(bg, {\n    width: svgcontent.getAttribute('width'),\n    height: svgcontent.getAttribute('height'),\n    x,\n    y\n  });\n\n  const bgImg = getElem('background_image');\n  if (bgImg) {\n    assignAttributes(bgImg, {\n      width: '100%',\n      height: '100%'\n    });\n  }\n\n  selectorManager.selectorParentGroup.setAttribute('transform', 'translate(' + x + ',' + y + ')');\n  /**\n  * Invoked upon updates to the canvas.\n  * @event module:svgcanvas.SvgCanvas#event:ext-canvasUpdated\n  * @type {PlainObject}\n  * @property {Integer} new_x\n  * @property {Integer} new_y\n  * @property {string} old_x (Of Integer)\n  * @property {string} old_y (Of Integer)\n  * @property {Integer} d_x\n  * @property {Integer} d_y\n  */\n  runExtensions(\n    'canvasUpdated',\n    /**\n     * @type {module:svgcanvas.SvgCanvas#event:ext-canvasUpdated}\n     */\n    {new_x: x, new_y: y, old_x: oldX, old_y: oldY, d_x: x - oldX, d_y: y - oldY}\n  );\n  return {x, y, old_x: oldX, old_y: oldY, d_x: x - oldX, d_y: y - oldY};\n};\n\n/**\n* Set the background of the editor (NOT the actual document)\n* @function module:svgcanvas.SvgCanvas#setBackground\n* @param {string} color - String with fill color to apply\n* @param {string} url - URL or path to image to use\n* @returns {undefined}\n*/\nthis.setBackground = function (color, url) {\n  const bg = getElem('canvasBackground');\n  const border = $(bg).find('rect')[0];\n  let bgImg = getElem('background_image');\n  border.setAttribute('fill', color);\n  if (url) {\n    if (!bgImg) {\n      bgImg = svgdoc.createElementNS(NS.SVG, 'image');\n      assignAttributes(bgImg, {\n        id: 'background_image',\n        width: '100%',\n        height: '100%',\n        preserveAspectRatio: 'xMinYMin',\n        style: 'pointer-events:none'\n      });\n    }\n    setHref(bgImg, url);\n    bg.append(bgImg);\n  } else if (bgImg) {\n    bgImg.remove();\n  }\n};\n\n/**\n* Select the next/previous element within the current layer\n* @function module:svgcanvas.SvgCanvas#cycleElement\n* @param {boolean} next - true = next and false = previous element\n* @fires module:svgcanvas.SvgCanvas#event:selected\n* @returns {undefined}\n*/\nthis.cycleElement = function (next) {\n  let num;\n  const curElem = selectedElements[0];\n  let elem = false;\n  const allElems = getVisibleElements(currentGroup || getCurrentDrawing().getCurrentLayer());\n  if (!allElems.length) { return; }\n  if (curElem == null) {\n    num = next ? allElems.length - 1 : 0;\n    elem = allElems[num];\n  } else {\n    let i = allElems.length;\n    while (i--) {\n      if (allElems[i] === curElem) {\n        num = next ? i - 1 : i + 1;\n        if (num >= allElems.length) {\n          num = 0;\n        } else if (num < 0) {\n          num = allElems.length - 1;\n        }\n        elem = allElems[num];\n        break;\n      }\n    }\n  }\n  selectOnly([elem], true);\n  call('selected', selectedElements);\n};\n\nthis.clear();\n\n/**\n* @interface module:svgcanvas.PrivateMethods\n* @type {PlainObject}\n* @property {module:svgcanvas~addCommandToHistory} addCommandToHistory\n* @property {module:history.HistoryCommand} BatchCommand\n* @property {module:history.HistoryCommand} ChangeElementCommand\n* @property {module:utilities.decode64} decode64\n* @property {module:utilities.encode64} encode64\n* @property {module:svgcanvas~ffClone} ffClone\n* @property {module:svgcanvas~findDuplicateGradient} findDuplicateGradient\n* @property {module:utilities.getPathBBox} getPathBBox\n* @property {module:units.getTypeMap} getTypeMap\n* @property {module:draw.identifyLayers} identifyLayers\n* @property {module:history.HistoryCommand} InsertElementCommand\n* @property {module:browser.isChrome} isChrome\n* @property {module:math.isIdentity} isIdentity\n* @property {module:browser.isIE} isIE\n* @property {module:svgcanvas~logMatrix} logMatrix\n* @property {module:history.HistoryCommand} MoveElementCommand\n* @property {module:namespaces.NS} NS\n* @property {module:utilities.preventClickDefault} preventClickDefault\n* @property {module:history.HistoryCommand} RemoveElementCommand\n* @property {module:SVGTransformList.SVGEditTransformList} SVGEditTransformList\n* @property {module:utilities.text2xml} text2xml\n* @property {module:math.transformBox} transformBox\n* @property {module:math.transformPoint} transformPoint\n* @property {module:utilities.walkTree} walkTree\n*/\n/**\n* @deprecated getPrivateMethods\n* Since all methods are/should be public somehow, this function should be removed;\n*  we might require `import` in place of this in the future once ES6 Modules\n*  widespread\n\n* Being able to access private methods publicly seems wrong somehow,\n* but currently appears to be the best way to allow testing and provide\n* access to them to plugins.\n* @function module:svgcanvas.SvgCanvas#getPrivateMethods\n* @returns {module:svgcanvas.PrivateMethods}\n*/\nthis.getPrivateMethods = function () {\n  const obj = {\n    addCommandToHistory,\n    BatchCommand,\n    ChangeElementCommand,\n    decode64,\n    encode64,\n    ffClone,\n    findDefs,\n    findDuplicateGradient,\n    getElem,\n    getPathBBox,\n    getTypeMap,\n    getUrlFromAttr,\n    identifyLayers: draw.identifyLayers,\n    InsertElementCommand,\n    isChrome,\n    isIdentity,\n    isIE,\n    logMatrix,\n    MoveElementCommand,\n    NS,\n    preventClickDefault,\n    RemoveElementCommand,\n    SVGEditTransformList,\n    text2xml,\n    transformBox,\n    transformPoint,\n    walkTree\n  };\n  return obj;\n};\n  } // End constructor\n} // End class\n\nexport default SvgCanvas;\n","/**\n * jGraduate 0.4\n *\n * jQuery Plugin for a gradient picker\n *\n * @module jGraduate\n * @copyright 2010 Jeff Schiller {@link http://blog.codedread.com/}, 2010 Alexis Deveria {@link http://a.deveria.com/}\n *\n * @license Apache-2.0\n * @example\n * // The Paint object is described below.\n * $.jGraduate.Paint() // constructs a 'none' color\n * @example $.jGraduate.Paint({copy: o}) // creates a copy of the paint o\n * @example $.jGraduate.Paint({hex: '#rrggbb'}) // creates a solid color paint with hex = \"#rrggbb\"\n * @example $.jGraduate.Paint({linearGradient: o, a: 50}) // creates a linear gradient paint with opacity=0.5\n * @example $.jGraduate.Paint({radialGradient: o, a: 7}) // creates a radial gradient paint with opacity=0.07\n * @example $.jGraduate.Paint({hex: '#rrggbb', linearGradient: o}) // throws an exception?\n *\n*/\n\n/**\n  * The jQuery namespace.\n  * @external jQuery\n*/\n/**\n * The jQuery plugin namespace.\n * @namespace {PlainObject} fn\n * @memberof external:jQuery\n * @see {@link http://learn.jquery.com/plugins/|jQuery Plugins}\n */\n\nconst ns = {\n  svg: 'http://www.w3.org/2000/svg',\n  xlink: 'http://www.w3.org/1999/xlink'\n};\n\nif (!window.console) {\n  window.console = {\n    log (str) {},\n    dir (str) {}\n  };\n}\n\n/**\n* Adds {@link external:jQuery.jGraduate.Paint}, {@link external:jQuery.fn.jGraduateDefaults}, {@link external:jQuery.fn.jGraduate}\n* @function module:jGraduate.jGraduate\n* @param {external:jQuery} $ The jQuery instance to wrap\n* @returns {external:jQuery}\n*/\nexport default function ($) {\n  if (!$.loadingStylesheets) {\n    $.loadingStylesheets = [];\n  }\n  const stylesheet = 'jgraduate/css/jGraduate.css';\n  if (!$.loadingStylesheets.includes(stylesheet)) {\n    $.loadingStylesheets.push(stylesheet);\n  }\n\n  /**\n  * @typedef {PlainObject} module:jGraduate.jGraduatePaintOptions\n  * @param {Float} [alpha]\n  * @param {module:jGraduate~Paint} [copy] Copy paint object\n  * @param {SVGLinearGradientElement} [linearGradient]\n  * @param {SVGRadialGradientElement} [radialGradient]\n  * @param {string} [solidColor]\n  */\n\n  /**\n  * @memberof module:jGraduate~\n  */\n  class Paint {\n    /**\n     * @param {module:jGraduate.jGraduatePaintOptions} [opt]\n    */\n    constructor (opt) {\n      const options = opt || {};\n      this.alpha = isNaN(options.alpha) ? 100 : options.alpha;\n      // copy paint object\n      if (options.copy) {\n        /**\n         * @name module:jGraduate~Paint#type\n         * @type {\"none\"|\"solidColor\"|\"linearGradient\"|\"radialGradient\"}\n         */\n        this.type = options.copy.type;\n        /**\n         * Represents opacity (0-100)\n         * @name module:jGraduate~Paint#alpha\n         * @type {Float}\n         */\n        this.alpha = options.copy.alpha;\n        /**\n         * Represents #RRGGBB hex of color\n         * @name module:jGraduate~Paint#solidColor\n         * @type {string}\n         */\n        this.solidColor = null;\n        /**\n         * @name module:jGraduate~Paint#linearGradient\n         * @type {SVGLinearGradientElement}\n         */\n        this.linearGradient = null;\n        /**\n         * @name module:jGraduate~Paint#radialGradient\n         * @type {SVGRadialGradientElement}\n         */\n        this.radialGradient = null;\n\n        switch (this.type) {\n        case 'none':\n          break;\n        case 'solidColor':\n          this.solidColor = options.copy.solidColor;\n          break;\n        case 'linearGradient':\n          this.linearGradient = options.copy.linearGradient.cloneNode(true);\n          break;\n        case 'radialGradient':\n          this.radialGradient = options.copy.radialGradient.cloneNode(true);\n          break;\n        }\n      // create linear gradient paint\n      } else if (options.linearGradient) {\n        this.type = 'linearGradient';\n        this.solidColor = null;\n        this.radialGradient = null;\n        this.linearGradient = options.linearGradient.cloneNode(true);\n      // create linear gradient paint\n      } else if (options.radialGradient) {\n        this.type = 'radialGradient';\n        this.solidColor = null;\n        this.linearGradient = null;\n        this.radialGradient = options.radialGradient.cloneNode(true);\n      // create solid color paint\n      } else if (options.solidColor) {\n        this.type = 'solidColor';\n        this.solidColor = options.solidColor;\n      // create empty paint\n      } else {\n        this.type = 'none';\n        this.solidColor = null;\n        this.linearGradient = null;\n        this.radialGradient = null;\n      }\n    }\n  }\n  /**\n  * @namespace {PlainObject} jGraduate\n  * @memberof external:jQuery\n  */\n  $.jGraduate = /** @lends external:jQuery.jGraduate */ {\n    /**\n    * @class external:jQuery.jGraduate.Paint\n    * @see module:jGraduate~Paint\n    */\n    Paint\n  };\n\n  // JSDoc doesn't show this as belonging to our `module:jGraduate.Options` type,\n  //   so we use `@see`\n  /**\n  * @namespace {module:jGraduate.Options} jGraduateDefaults\n  * @memberof external:jQuery.fn\n  */\n  $.fn.jGraduateDefaults = /** @lends external:jQuery.fn.jGraduateDefaults */ {\n    /**\n    * Creates an object with a 'none' color\n    * @type {external:jQuery.jGraduate.Paint}\n    * @see module:jGraduate.Options\n    */\n    paint: new $.jGraduate.Paint(),\n    /**\n    * @namespace\n    */\n    window: {\n      /**\n      * @type {string}\n      * @see module:jGraduate.Options\n      */\n      pickerTitle: 'Drag markers to pick a paint'\n    },\n    /**\n    * @namespace\n    */\n    images: {\n      /**\n      * @type {string}\n      * @see module:jGraduate.Options\n      */\n      clientPath: 'images/'\n    },\n    /**\n    * @type {string}\n    * @see module:jGraduate.Options\n    */\n    newstop: 'inverse' // same, inverse, black, white\n  };\n\n  const isGecko = navigator.userAgent.includes('Gecko/');\n\n  function setAttrs (elem, attrs) {\n    if (isGecko) {\n      for (const aname in attrs) elem.setAttribute(aname, attrs[aname]);\n    } else {\n      for (const aname in attrs) {\n        const val = attrs[aname], prop = elem[aname];\n        if (prop && prop.constructor === 'SVGLength') {\n          prop.baseVal.value = val;\n        } else {\n          elem.setAttribute(aname, val);\n        }\n      }\n    }\n  }\n\n  function mkElem (name, attrs, newparent) {\n    const elem = document.createElementNS(ns.svg, name);\n    setAttrs(elem, attrs);\n    if (newparent) {\n      newparent.append(elem);\n    }\n    return elem;\n  }\n\n  /**\n  * @typedef {PlainObject} module:jGraduate.ColorOpac Object may have one or both values\n  * @property {string} [color] #Hex color\n  * @property {Float} [opac] 0-1\n  */\n  /**\n  * @typedef {PlainObject} module:jGraduate.Options\n  * @property {module:jGraduate~Paint} [paint] A Paint object object describing the paint to display initially; defaults to a new instance without options (defaults to opaque white)\n  * @property {external:Window} [window]\n  * @property {string} [window.pickerTitle='Drag markers to pick a paint']\n  * @property {PlainObject} [images]\n  * @property {string} [images.clientPath='images/']\n  * @property {\"same\"|\"inverse\"|\"black\"|\"white\"|module:jGraduate.ColorOpac} [newstop=\"inverse\"]\n  */\n\n  /**\n  * @callback external:jQuery.fn.jGraduate.OkCallback\n  * @param {external:jQuery.jGraduate.Paint} paint\n  * @returns {undefined}\n  */\n  /**\n  * @callback external:jQuery.fn.jGraduate.CancelCallback\n  * @returns {undefined}\n  */\n\n  /**\n  * @function external:jQuery.fn.jGraduate\n  * @param {module:jGraduate.Options} [options]\n  * @param {external:jQuery.fn.jGraduate.OkCallback} [okCallback] Called with a Paint object when Ok is pressed\n  * @param {external:jQuery.fn.jGraduate.CancelCallback} [cancelCallback] Called with no arguments when Cancel is pressed\n  * @returns {external:jQuery}\n  */\n  $.fn.jGraduate = function (options, okCallback, cancelCallback) {\n    return this.each(function () {\n      const $this = $(this),\n        $settings = $.extend(true, {}, $.fn.jGraduateDefaults, options || {}),\n        id = $this.attr('id'),\n        idref = '#' + $this.attr('id') + ' ';\n\n      if (!idref) {\n        alert('Container element must have an id attribute to maintain unique id strings for sub-elements.');\n        return;\n      }\n\n      const okClicked = function () {\n        switch ($this.paint.type) {\n        case 'radialGradient':\n          $this.paint.linearGradient = null;\n          break;\n        case 'linearGradient':\n          $this.paint.radialGradient = null;\n          break;\n        case 'solidColor':\n          $this.paint.radialGradient = $this.paint.linearGradient = null;\n          break;\n        }\n        typeof $this.okCallback === 'function' && $this.okCallback($this.paint);\n        $this.hide();\n      };\n      const cancelClicked = function () {\n        typeof $this.cancelCallback === 'function' && $this.cancelCallback();\n        $this.hide();\n      };\n\n      $.extend(true, $this, { // public properties, methods, and callbacks\n        // make a copy of the incoming paint\n        paint: new $.jGraduate.Paint({copy: $settings.paint}),\n        okCallback: typeof okCallback === 'function' ? okCallback : null,\n        cancelCallback: typeof cancelCallback === 'function' ? cancelCallback : null\n      });\n\n      let // pos = $this.position(),\n        color = null;\n      const $win = $(window);\n\n      if ($this.paint.type === 'none') {\n        $this.paint = new $.jGraduate.Paint({solidColor: 'ffffff'});\n      }\n\n      $this.addClass('jGraduate_Picker');\n      $this.html(\n        '<ul class=\"jGraduate_tabs\">' +\n          '<li class=\"jGraduate_tab_color jGraduate_tab_current\" data-type=\"col\">Solid Color</li>' +\n          '<li class=\"jGraduate_tab_lingrad\" data-type=\"lg\">Linear Gradient</li>' +\n          '<li class=\"jGraduate_tab_radgrad\" data-type=\"rg\">Radial Gradient</li>' +\n        '</ul>' +\n        '<div class=\"jGraduate_colPick\"></div>' +\n        '<div class=\"jGraduate_gradPick\"></div>' +\n        '<div class=\"jGraduate_LightBox\"></div>' +\n        '<div id=\"' + id + '_jGraduate_stopPicker\" class=\"jGraduate_stopPicker\"></div>'\n      );\n      const colPicker = $(idref + '> .jGraduate_colPick');\n      const gradPicker = $(idref + '> .jGraduate_gradPick');\n\n      gradPicker.html(\n        '<div id=\"' + id + '_jGraduate_Swatch\" class=\"jGraduate_Swatch\">' +\n          '<h2 class=\"jGraduate_Title\">' + $settings.window.pickerTitle + '</h2>' +\n          '<div id=\"' + id + '_jGraduate_GradContainer\" class=\"jGraduate_GradContainer\"></div>' +\n          '<div id=\"' + id + '_jGraduate_StopSlider\" class=\"jGraduate_StopSlider\"></div>' +\n        '</div>' +\n        '<div class=\"jGraduate_Form jGraduate_Points jGraduate_lg_field\">' +\n          '<div class=\"jGraduate_StopSection\">' +\n            '<label class=\"jGraduate_Form_Heading\">Begin Point</label>' +\n            '<div class=\"jGraduate_Form_Section\">' +\n              '<label>x:</label>' +\n              '<input type=\"text\" id=\"' + id + '_jGraduate_x1\" size=\"3\" title=\"Enter starting x value between 0.0 and 1.0\"/>' +\n              '<label>y:</label>' +\n              '<input type=\"text\" id=\"' + id + '_jGraduate_y1\" size=\"3\" title=\"Enter starting y value between 0.0 and 1.0\"/>' +\n            '</div>' +\n          '</div>' +\n          '<div class=\"jGraduate_StopSection\">' +\n            '<label class=\"jGraduate_Form_Heading\">End Point</label>' +\n            '<div class=\"jGraduate_Form_Section\">' +\n              '<label>x:</label>' +\n              '<input type=\"text\" id=\"' + id + '_jGraduate_x2\" size=\"3\" title=\"Enter ending x value between 0.0 and 1.0\"/>' +\n              '<label>y:</label>' +\n              '<input type=\"text\" id=\"' + id + '_jGraduate_y2\" size=\"3\" title=\"Enter ending y value between 0.0 and 1.0\"/>' +\n            '</div>' +\n          '</div>' +\n        '</div>' +\n        '<div class=\"jGraduate_Form jGraduate_Points jGraduate_rg_field\">' +\n          '<div class=\"jGraduate_StopSection\">' +\n            '<label class=\"jGraduate_Form_Heading\">Center Point</label>' +\n            '<div class=\"jGraduate_Form_Section\">' +\n              '<label>x:</label>' +\n              '<input type=\"text\" id=\"' + id + '_jGraduate_cx\" size=\"3\" title=\"Enter x value between 0.0 and 1.0\"/>' +\n              '<label>y:</label>' +\n              '<input type=\"text\" id=\"' + id + '_jGraduate_cy\" size=\"3\" title=\"Enter y value between 0.0 and 1.0\"/>' +\n            '</div>' +\n          '</div>' +\n          '<div class=\"jGraduate_StopSection\">' +\n            '<label class=\"jGraduate_Form_Heading\">Focal Point</label>' +\n            '<div class=\"jGraduate_Form_Section\">' +\n              '<label>Match center: <input type=\"checkbox\" checked=\"checked\" id=\"' + id + '_jGraduate_match_ctr\"/></label><br/>' +\n              '<label>x:</label>' +\n              '<input type=\"text\" id=\"' + id + '_jGraduate_fx\" size=\"3\" title=\"Enter x value between 0.0 and 1.0\"/>' +\n              '<label>y:</label>' +\n              '<input type=\"text\" id=\"' + id + '_jGraduate_fy\" size=\"3\" title=\"Enter y value between 0.0 and 1.0\"/>' +\n            '</div>' +\n          '</div>' +\n        '</div>' +\n        '<div class=\"jGraduate_StopSection jGraduate_SpreadMethod\">' +\n          '<label class=\"jGraduate_Form_Heading\">Spread method</label>' +\n          '<div class=\"jGraduate_Form_Section\">' +\n            '<select class=\"jGraduate_spreadMethod\">' +\n              '<option value=pad selected>Pad</option>' +\n              '<option value=reflect>Reflect</option>' +\n              '<option value=repeat>Repeat</option>' +\n            '</select>' +\n          '</div>' +\n        '</div>' +\n        '<div class=\"jGraduate_Form\">' +\n          '<div class=\"jGraduate_Slider jGraduate_RadiusField jGraduate_rg_field\">' +\n            '<label class=\"prelabel\">Radius:</label>' +\n            '<div id=\"' + id + '_jGraduate_Radius\" class=\"jGraduate_SliderBar jGraduate_Radius\" title=\"Click to set radius\">' +\n              '<img id=\"' + id + '_jGraduate_RadiusArrows\" class=\"jGraduate_RadiusArrows\" src=\"' + $settings.images.clientPath + 'rangearrows2.gif\">' +\n            '</div>' +\n            '<label><input type=\"text\" id=\"' + id + '_jGraduate_RadiusInput\" size=\"3\" value=\"100\"/>%</label>' +\n          '</div>' +\n          '<div class=\"jGraduate_Slider jGraduate_EllipField jGraduate_rg_field\">' +\n            '<label class=\"prelabel\">Ellip:</label>' +\n            '<div id=\"' + id + '_jGraduate_Ellip\" class=\"jGraduate_SliderBar jGraduate_Ellip\" title=\"Click to set Ellip\">' +\n              '<img id=\"' + id + '_jGraduate_EllipArrows\" class=\"jGraduate_EllipArrows\" src=\"' + $settings.images.clientPath + 'rangearrows2.gif\">' +\n            '</div>' +\n            '<label><input type=\"text\" id=\"' + id + '_jGraduate_EllipInput\" size=\"3\" value=\"0\"/>%</label>' +\n          '</div>' +\n          '<div class=\"jGraduate_Slider jGraduate_AngleField jGraduate_rg_field\">' +\n            '<label class=\"prelabel\">Angle:</label>' +\n            '<div id=\"' + id + '_jGraduate_Angle\" class=\"jGraduate_SliderBar jGraduate_Angle\" title=\"Click to set Angle\">' +\n              '<img id=\"' + id + '_jGraduate_AngleArrows\" class=\"jGraduate_AngleArrows\" src=\"' + $settings.images.clientPath + 'rangearrows2.gif\">' +\n            '</div>' +\n            '<label><input type=\"text\" id=\"' + id + '_jGraduate_AngleInput\" size=\"3\" value=\"0\"/>deg</label>' +\n          '</div>' +\n          '<div class=\"jGraduate_Slider jGraduate_OpacField\">' +\n            '<label class=\"prelabel\">Opac:</label>' +\n            '<div id=\"' + id + '_jGraduate_Opac\" class=\"jGraduate_SliderBar jGraduate_Opac\" title=\"Click to set Opac\">' +\n              '<img id=\"' + id + '_jGraduate_OpacArrows\" class=\"jGraduate_OpacArrows\" src=\"' + $settings.images.clientPath + 'rangearrows2.gif\">' +\n            '</div>' +\n            '<label><input type=\"text\" id=\"' + id + '_jGraduate_OpacInput\" size=\"3\" value=\"100\"/>%</label>' +\n          '</div>' +\n        '</div>' +\n        '<div class=\"jGraduate_OkCancel\">' +\n          '<input type=\"button\" id=\"' + id + '_jGraduate_Ok\" class=\"jGraduate_Ok\" value=\"OK\"/>' +\n          '<input type=\"button\" id=\"' + id + '_jGraduate_Cancel\" class=\"jGraduate_Cancel\" value=\"Cancel\"/>' +\n        '</div>');\n\n      // --------------\n      // Set up all the SVG elements (the gradient, stops and rectangle)\n      const MAX = 256,\n        MARGINX = 0,\n        MARGINY = 0,\n        // STOP_RADIUS = 15 / 2,\n        SIZEX = MAX - 2 * MARGINX,\n        SIZEY = MAX - 2 * MARGINY;\n\n      const attrInput = {};\n\n      const SLIDERW = 145;\n      $('.jGraduate_SliderBar').width(SLIDERW);\n\n      const container = $('#' + id + '_jGraduate_GradContainer')[0];\n\n      const svg = mkElem('svg', {\n        id: id + '_jgraduate_svg',\n        width: MAX,\n        height: MAX,\n        xmlns: ns.svg\n      }, container);\n\n      // This wasn't working as designed\n      // let curType;\n      // curType = curType || $this.paint.type;\n\n      // if we are sent a gradient, import it\n      let curType = $this.paint.type;\n\n      let grad = $this.paint[curType];\n      let curGradient = grad;\n\n      const gradalpha = $this.paint.alpha;\n\n      const isSolid = curType === 'solidColor';\n\n      // Make any missing gradients\n      switch (curType) {\n      case 'solidColor':\n        // fall through\n      case 'linearGradient':\n        if (!isSolid) {\n          curGradient.id = id + '_lg_jgraduate_grad';\n          grad = curGradient = svg.appendChild(curGradient); // .cloneNode(true));\n        }\n        mkElem('radialGradient', {\n          id: id + '_rg_jgraduate_grad'\n        }, svg);\n        if (curType === 'linearGradient') { break; }\n        // fall through\n      case 'radialGradient':\n        if (!isSolid) {\n          curGradient.id = id + '_rg_jgraduate_grad';\n          grad = curGradient = svg.appendChild(curGradient); // .cloneNode(true));\n        }\n        mkElem('linearGradient', {\n          id: id + '_lg_jgraduate_grad'\n        }, svg);\n      }\n\n      let stopGroup; // eslint-disable-line prefer-const\n      if (isSolid) {\n        grad = curGradient = $('#' + id + '_lg_jgraduate_grad')[0];\n        color = $this.paint[curType];\n        mkStop(0, '#' + color, 1);\n\n        const type = typeof $settings.newstop;\n\n        if (type === 'string') {\n          switch ($settings.newstop) {\n          case 'same':\n            mkStop(1, '#' + color, 1);\n            break;\n\n          case 'inverse':\n            // Invert current color for second stop\n            let inverted = '';\n            for (let i = 0; i < 6; i += 2) {\n              // const ch = color.substr(i, 2);\n              let inv = (255 - parseInt(color.substr(i, 2), 16)).toString(16);\n              if (inv.length < 2) inv = 0 + inv;\n              inverted += inv;\n            }\n            mkStop(1, '#' + inverted, 1);\n            break;\n\n          case 'white':\n            mkStop(1, '#ffffff', 1);\n            break;\n\n          case 'black':\n            mkStop(1, '#000000', 1);\n            break;\n          }\n        } else if (type === 'object') {\n          const opac = ('opac' in $settings.newstop) ? $settings.newstop.opac : 1;\n          mkStop(1, ($settings.newstop.color || '#' + color), opac);\n        }\n      }\n\n      const x1 = parseFloat(grad.getAttribute('x1') || 0.0),\n        y1 = parseFloat(grad.getAttribute('y1') || 0.0),\n        x2 = parseFloat(grad.getAttribute('x2') || 1.0),\n        y2 = parseFloat(grad.getAttribute('y2') || 0.0);\n\n      const cx = parseFloat(grad.getAttribute('cx') || 0.5),\n        cy = parseFloat(grad.getAttribute('cy') || 0.5),\n        fx = parseFloat(grad.getAttribute('fx') || cx),\n        fy = parseFloat(grad.getAttribute('fy') || cy);\n\n      const previewRect = mkElem('rect', {\n        id: id + '_jgraduate_rect',\n        x: MARGINX,\n        y: MARGINY,\n        width: SIZEX,\n        height: SIZEY,\n        fill: 'url(#' + id + '_jgraduate_grad)',\n        'fill-opacity': gradalpha / 100\n      }, svg);\n\n      // stop visuals created here\n      const beginCoord = $('<div/>').attr({\n        class: 'grad_coord jGraduate_lg_field',\n        title: 'Begin Stop'\n      }).text(1).css({\n        top: y1 * MAX,\n        left: x1 * MAX\n      }).data('coord', 'start').appendTo(container);\n\n      const endCoord = beginCoord.clone().text(2).css({\n        top: y2 * MAX,\n        left: x2 * MAX\n      }).attr('title', 'End stop').data('coord', 'end').appendTo(container);\n\n      const centerCoord = $('<div/>').attr({\n        class: 'grad_coord jGraduate_rg_field',\n        title: 'Center stop'\n      }).text('C').css({\n        top: cy * MAX,\n        left: cx * MAX\n      }).data('coord', 'center').appendTo(container);\n\n      const focusCoord = centerCoord.clone().text('F').css({\n        top: fy * MAX,\n        left: fx * MAX,\n        display: 'none'\n      }).attr('title', 'Focus point').data('coord', 'focus').appendTo(container);\n\n      focusCoord[0].id = id + '_jGraduate_focusCoord';\n\n      // const coords = $(idref + ' .grad_coord');\n\n      // $(container).hover(function () {\n      //   coords.animate({\n      //     opacity: 1\n      //   }, 500);\n      // }, function () {\n      //   coords.animate({\n      //     opacity: .2\n      //   }, 500);\n      // });\n\n      let showFocus;\n      $.each(['x1', 'y1', 'x2', 'y2', 'cx', 'cy', 'fx', 'fy'], function (i, attr) {\n        const isRadial = isNaN(attr[1]);\n\n        let attrval = curGradient.getAttribute(attr);\n        if (!attrval) {\n          // Set defaults\n          if (isRadial) {\n            // For radial points\n            attrval = '0.5';\n          } else {\n            // Only x2 is 1\n            attrval = attr === 'x2' ? '1.0' : '0.0';\n          }\n        }\n\n        attrInput[attr] = $('#' + id + '_jGraduate_' + attr)\n          .val(attrval)\n          .change(function () {\n            // TODO: Support values < 0 and > 1 (zoomable preview?)\n            if (isNaN(parseFloat(this.value)) || this.value < 0) {\n              this.value = 0.0;\n            } else if (this.value > 1) {\n              this.value = 1.0;\n            }\n\n            if (!(attr[0] === 'f' && !showFocus)) {\n              if ((isRadial && curType === 'radialGradient') || (!isRadial && curType === 'linearGradient')) {\n                curGradient.setAttribute(attr, this.value);\n              }\n            }\n\n            const $elem = isRadial\n              ? attr[0] === 'c' ? centerCoord : focusCoord\n              : attr[1] === '1' ? beginCoord : endCoord;\n\n            const cssName = attr.includes('x') ? 'left' : 'top';\n\n            $elem.css(cssName, this.value * MAX);\n          }).change();\n      });\n\n      function mkStop (n, color, opac, sel, stopElem) {\n        const stop = stopElem || mkElem('stop', {'stop-color': color, 'stop-opacity': opac, offset: n}, curGradient);\n        if (stopElem) {\n          color = stopElem.getAttribute('stop-color');\n          opac = stopElem.getAttribute('stop-opacity');\n          n = stopElem.getAttribute('offset');\n        } else {\n          curGradient.append(stop);\n        }\n        if (opac === null) opac = 1;\n\n        const pickerD = 'M-6.2,0.9c3.6-4,6.7-4.3,6.7-12.4c-0.2,7.9,3.1,8.8,6.5,12.4c3.5,3.8,2.9,9.6,0,12.3c-3.1,2.8-10.4,2.7-13.2,0C-9.6,9.9-9.4,4.4-6.2,0.9z';\n\n        const pathbg = mkElem('path', {\n          d: pickerD,\n          fill: 'url(#jGraduate_trans)',\n          transform: 'translate(' + (10 + n * MAX) + ', 26)'\n        }, stopGroup);\n\n        const path = mkElem('path', {\n          d: pickerD,\n          fill: color,\n          'fill-opacity': opac,\n          transform: 'translate(' + (10 + n * MAX) + ', 26)',\n          stroke: '#000',\n          'stroke-width': 1.5\n        }, stopGroup);\n\n        $(path).mousedown(function (e) {\n          selectStop(this);\n          drag = curStop;\n          $win.mousemove(dragColor).mouseup(remDrags);\n          stopOffset = stopMakerDiv.offset();\n          e.preventDefault();\n          return false;\n        }).data('stop', stop).data('bg', pathbg).dblclick(function () {\n          $('div.jGraduate_LightBox').show();\n          const colorhandle = this;\n          let stopOpacity = +stop.getAttribute('stop-opacity') || 1;\n          let stopColor = stop.getAttribute('stop-color') || 1;\n          let thisAlpha = (parseFloat(stopOpacity) * 255).toString(16);\n          while (thisAlpha.length < 2) { thisAlpha = '0' + thisAlpha; }\n          color = stopColor.substr(1) + thisAlpha;\n          $('#' + id + '_jGraduate_stopPicker').css({left: 100, bottom: 15}).jPicker({\n            window: { title: 'Pick the start color and opacity for the gradient' },\n            images: { clientPath: $settings.images.clientPath },\n            color: { active: color, alphaSupport: true }\n          }, function (color, arg2) {\n            stopColor = color.val('hex') ? ('#' + color.val('hex')) : 'none';\n            stopOpacity = color.val('a') !== null ? color.val('a') / 256 : 1;\n            colorhandle.setAttribute('fill', stopColor);\n            colorhandle.setAttribute('fill-opacity', stopOpacity);\n            stop.setAttribute('stop-color', stopColor);\n            stop.setAttribute('stop-opacity', stopOpacity);\n            $('div.jGraduate_LightBox').hide();\n            $('#' + id + '_jGraduate_stopPicker').hide();\n          }, null, function () {\n            $('div.jGraduate_LightBox').hide();\n            $('#' + id + '_jGraduate_stopPicker').hide();\n          });\n        });\n\n        $(curGradient).find('stop').each(function () {\n          const curS = $(this);\n          if (+this.getAttribute('offset') > n) {\n            if (!color) {\n              const newcolor = this.getAttribute('stop-color');\n              const newopac = this.getAttribute('stop-opacity');\n              stop.setAttribute('stop-color', newcolor);\n              path.setAttribute('fill', newcolor);\n              stop.setAttribute('stop-opacity', newopac === null ? 1 : newopac);\n              path.setAttribute('fill-opacity', newopac === null ? 1 : newopac);\n            }\n            curS.before(stop);\n            return false;\n          }\n        });\n        if (sel) selectStop(path);\n        return stop;\n      }\n\n      function remStop () {\n        delStop.setAttribute('display', 'none');\n        const path = $(curStop);\n        const stop = path.data('stop');\n        const bg = path.data('bg');\n        $([curStop, stop, bg]).remove();\n      }\n\n      const stopMakerDiv = $('#' + id + '_jGraduate_StopSlider');\n\n      let stops, curStop, drag;\n\n      const delStop = mkElem('path', {\n        d: 'm9.75,-6l-19.5,19.5m0,-19.5l19.5,19.5',\n        fill: 'none',\n        stroke: '#D00',\n        'stroke-width': 5,\n        display: 'none'\n      }, undefined); // stopMakerSVG);\n\n      function selectStop (item) {\n        if (curStop) curStop.setAttribute('stroke', '#000');\n        item.setAttribute('stroke', 'blue');\n        curStop = item;\n        curStop.parentNode.append(curStop);\n        //   stops = $('stop');\n        //   opac_select.val(curStop.attr('fill-opacity') || 1);\n        //   root.append(delStop);\n      }\n\n      let stopOffset;\n\n      function remDrags () {\n        $win.unbind('mousemove', dragColor);\n        if (delStop.getAttribute('display') !== 'none') {\n          remStop();\n        }\n        drag = null;\n      }\n\n      let scaleX = 1, scaleY = 1, angle = 0;\n\n      let cX = cx;\n      let cY = cy;\n      function xform () {\n        const rot = angle ? 'rotate(' + angle + ',' + cX + ',' + cY + ') ' : '';\n        if (scaleX === 1 && scaleY === 1) {\n          curGradient.removeAttribute('gradientTransform');\n          // $('#ang').addClass('dis');\n        } else {\n          const x = -cX * (scaleX - 1);\n          const y = -cY * (scaleY - 1);\n          curGradient.setAttribute('gradientTransform', rot + 'translate(' + x + ',' + y + ') scale(' + scaleX + ',' + scaleY + ')');\n          // $('#ang').removeClass('dis');\n        }\n      }\n\n      function dragColor (evt) {\n        let x = evt.pageX - stopOffset.left;\n        const y = evt.pageY - stopOffset.top;\n        x = x < 10\n          ? 10\n          : x > MAX + 10\n            ? MAX + 10\n            : x;\n\n        const xfStr = 'translate(' + x + ', 26)';\n        if (y < -60 || y > 130) {\n          delStop.setAttribute('display', 'block');\n          delStop.setAttribute('transform', xfStr);\n        } else {\n          delStop.setAttribute('display', 'none');\n        }\n\n        drag.setAttribute('transform', xfStr);\n        $.data(drag, 'bg').setAttribute('transform', xfStr);\n        const stop = $.data(drag, 'stop');\n        const sX = (x - 10) / MAX;\n\n        stop.setAttribute('offset', sX);\n\n        let last = 0;\n        $(curGradient).find('stop').each(function (i) {\n          const cur = this.getAttribute('offset');\n          const t = $(this);\n          if (cur < last) {\n            t.prev().before(t);\n            stops = $(curGradient).find('stop');\n          }\n          last = cur;\n        });\n      }\n\n      const stopMakerSVG = mkElem('svg', {\n        width: '100%',\n        height: 45\n      }, stopMakerDiv[0]);\n\n      const transPattern = mkElem('pattern', {\n        width: 16,\n        height: 16,\n        patternUnits: 'userSpaceOnUse',\n        id: 'jGraduate_trans'\n      }, stopMakerSVG);\n\n      const transImg = mkElem('image', {\n        width: 16,\n        height: 16\n      }, transPattern);\n\n      const bgImage = $settings.images.clientPath + 'map-opacity.png';\n\n      transImg.setAttributeNS(ns.xlink, 'xlink:href', bgImage);\n\n      $(stopMakerSVG).click(function (evt) {\n        stopOffset = stopMakerDiv.offset();\n        const {target} = evt;\n        if (target.tagName === 'path') return;\n        let x = evt.pageX - stopOffset.left - 8;\n        x = x < 10 ? 10 : x > MAX + 10 ? MAX + 10 : x;\n        mkStop(x / MAX, 0, 0, true);\n        evt.stopPropagation();\n      });\n\n      $(stopMakerSVG).mouseover(function () {\n        stopMakerSVG.append(delStop);\n      });\n\n      stopGroup = mkElem('g', {}, stopMakerSVG);\n\n      mkElem('line', {\n        x1: 10,\n        y1: 15,\n        x2: MAX + 10,\n        y2: 15,\n        'stroke-width': 2,\n        stroke: '#000'\n      }, stopMakerSVG);\n\n      const spreadMethodOpt = gradPicker.find('.jGraduate_spreadMethod').change(function () {\n        curGradient.setAttribute('spreadMethod', $(this).val());\n      });\n\n      // handle dragging the stop around the swatch\n      let draggingCoord = null;\n\n      const onCoordDrag = function (evt) {\n        let x = evt.pageX - offset.left;\n        let y = evt.pageY - offset.top;\n\n        // clamp stop to the swatch\n        x = x < 0 ? 0 : x > MAX ? MAX : x;\n        y = y < 0 ? 0 : y > MAX ? MAX : y;\n\n        draggingCoord.css('left', x).css('top', y);\n\n        // calculate stop offset\n        const fracx = x / SIZEX;\n        const fracy = y / SIZEY;\n\n        const type = draggingCoord.data('coord');\n        const grad = curGradient;\n\n        switch (type) {\n        case 'start':\n          attrInput.x1.val(fracx);\n          attrInput.y1.val(fracy);\n          grad.setAttribute('x1', fracx);\n          grad.setAttribute('y1', fracy);\n          break;\n        case 'end':\n          attrInput.x2.val(fracx);\n          attrInput.y2.val(fracy);\n          grad.setAttribute('x2', fracx);\n          grad.setAttribute('y2', fracy);\n          break;\n        case 'center':\n          attrInput.cx.val(fracx);\n          attrInput.cy.val(fracy);\n          grad.setAttribute('cx', fracx);\n          grad.setAttribute('cy', fracy);\n          cX = fracx;\n          cY = fracy;\n          xform();\n          break;\n        case 'focus':\n          attrInput.fx.val(fracx);\n          attrInput.fy.val(fracy);\n          grad.setAttribute('fx', fracx);\n          grad.setAttribute('fy', fracy);\n          xform();\n        }\n\n        evt.preventDefault();\n      };\n\n      const onCoordUp = function () {\n        draggingCoord = null;\n        $win.unbind('mousemove', onCoordDrag).unbind('mouseup', onCoordUp);\n      };\n\n      // Linear gradient\n      // (function () {\n\n      stops = curGradient.getElementsByTagNameNS(ns.svg, 'stop');\n\n      let numstops = stops.length;\n      // if there are not at least two stops, then\n      if (numstops < 2) {\n        while (numstops < 2) {\n          curGradient.append(document.createElementNS(ns.svg, 'stop'));\n          ++numstops;\n        }\n        stops = curGradient.getElementsByTagNameNS(ns.svg, 'stop');\n      }\n\n      for (let i = 0; i < numstops; i++) {\n        mkStop(0, 0, 0, 0, stops[i]);\n      }\n\n      spreadMethodOpt.val(curGradient.getAttribute('spreadMethod') || 'pad');\n\n      let offset;\n\n      // No match, so show focus point\n      showFocus = false;\n\n      previewRect.setAttribute('fill-opacity', gradalpha / 100);\n\n      $('#' + id + ' div.grad_coord').mousedown(function (evt) {\n        evt.preventDefault();\n        draggingCoord = $(this);\n        // const sPos = draggingCoord.offset();\n        offset = draggingCoord.parent().offset();\n        $win.mousemove(onCoordDrag).mouseup(onCoordUp);\n      });\n\n      // bind GUI elements\n      $('#' + id + '_jGraduate_Ok').bind('click', function () {\n        $this.paint.type = curType;\n        $this.paint[curType] = curGradient.cloneNode(true);\n        $this.paint.solidColor = null;\n        okClicked();\n      });\n      $('#' + id + '_jGraduate_Cancel').bind('click', function (paint) {\n        cancelClicked();\n      });\n\n      if (curType === 'radialGradient') {\n        if (showFocus) {\n          focusCoord.show();\n        } else {\n          focusCoord.hide();\n          attrInput.fx.val('');\n          attrInput.fy.val('');\n        }\n      }\n\n      $('#' + id + '_jGraduate_match_ctr')[0].checked = !showFocus;\n\n      let lastfx, lastfy;\n\n      $('#' + id + '_jGraduate_match_ctr').change(function () {\n        showFocus = !this.checked;\n        focusCoord.toggle(showFocus);\n        attrInput.fx.val('');\n        attrInput.fy.val('');\n        const grad = curGradient;\n        if (!showFocus) {\n          lastfx = grad.getAttribute('fx');\n          lastfy = grad.getAttribute('fy');\n          grad.removeAttribute('fx');\n          grad.removeAttribute('fy');\n        } else {\n          const fx = lastfx || 0.5;\n          const fy = lastfy || 0.5;\n          grad.setAttribute('fx', fx);\n          grad.setAttribute('fy', fy);\n          attrInput.fx.val(fx);\n          attrInput.fy.val(fy);\n        }\n      });\n\n      stops = curGradient.getElementsByTagNameNS(ns.svg, 'stop');\n      numstops = stops.length;\n      // if there are not at least two stops, then\n      if (numstops < 2) {\n        while (numstops < 2) {\n          curGradient.append(document.createElementNS(ns.svg, 'stop'));\n          ++numstops;\n        }\n        stops = curGradient.getElementsByTagNameNS(ns.svg, 'stop');\n      }\n\n      let slider;\n\n      const setSlider = function (e) {\n        const {offset} = slider;\n        const div = slider.parent;\n        let x = (e.pageX - offset.left - parseInt(div.css('border-left-width')));\n        if (x > SLIDERW) x = SLIDERW;\n        if (x <= 0) x = 0;\n        const posx = x - 5;\n        x /= SLIDERW;\n\n        switch (slider.type) {\n        case 'radius':\n          x = Math.pow(x * 2, 2.5);\n          if (x > 0.98 && x < 1.02) x = 1;\n          if (x <= 0.01) x = 0.01;\n          curGradient.setAttribute('r', x);\n          break;\n        case 'opacity':\n          $this.paint.alpha = parseInt(x * 100);\n          previewRect.setAttribute('fill-opacity', x);\n          break;\n        case 'ellip':\n          scaleX = 1;\n          scaleY = 1;\n          if (x < 0.5) {\n            x /= 0.5; // 0.001\n            scaleX = x <= 0 ? 0.01 : x;\n          } else if (x > 0.5) {\n            x /= 0.5; // 2\n            x = 2 - x;\n            scaleY = x <= 0 ? 0.01 : x;\n          }\n          xform();\n          x -= 1;\n          if (scaleY === x + 1) {\n            x = Math.abs(x);\n          }\n          break;\n        case 'angle':\n          x = x - 0.5;\n          angle = x *= 180;\n          xform();\n          x /= 100;\n          break;\n        }\n        slider.elem.css({'margin-left': posx});\n        x = Math.round(x * 100);\n        slider.input.val(x);\n      };\n\n      let ellipVal = 0, angleVal = 0;\n\n      if (curType === 'radialGradient') {\n        const tlist = curGradient.gradientTransform.baseVal;\n        if (tlist.numberOfItems === 2) {\n          const t = tlist.getItem(0);\n          const s = tlist.getItem(1);\n          if (t.type === 2 && s.type === 3) {\n            const m = s.matrix;\n            if (m.a !== 1) {\n              ellipVal = Math.round(-(1 - m.a) * 100);\n            } else if (m.d !== 1) {\n              ellipVal = Math.round((1 - m.d) * 100);\n            }\n          }\n        } else if (tlist.numberOfItems === 3) {\n          // Assume [R][T][S]\n          const r = tlist.getItem(0);\n          const t = tlist.getItem(1);\n          const s = tlist.getItem(2);\n\n          if (r.type === 4 &&\n            t.type === 2 &&\n            s.type === 3\n          ) {\n            angleVal = Math.round(r.angle);\n            const m = s.matrix;\n            if (m.a !== 1) {\n              ellipVal = Math.round(-(1 - m.a) * 100);\n            } else if (m.d !== 1) {\n              ellipVal = Math.round((1 - m.d) * 100);\n            }\n          }\n        }\n      }\n\n      const sliders = {\n        radius: {\n          handle: '#' + id + '_jGraduate_RadiusArrows',\n          input: '#' + id + '_jGraduate_RadiusInput',\n          val: (curGradient.getAttribute('r') || 0.5) * 100\n        },\n        opacity: {\n          handle: '#' + id + '_jGraduate_OpacArrows',\n          input: '#' + id + '_jGraduate_OpacInput',\n          val: $this.paint.alpha || 100\n        },\n        ellip: {\n          handle: '#' + id + '_jGraduate_EllipArrows',\n          input: '#' + id + '_jGraduate_EllipInput',\n          val: ellipVal\n        },\n        angle: {\n          handle: '#' + id + '_jGraduate_AngleArrows',\n          input: '#' + id + '_jGraduate_AngleInput',\n          val: angleVal\n        }\n      };\n\n      $.each(sliders, function (type, data) {\n        const handle = $(data.handle);\n        handle.mousedown(function (evt) {\n          const parent = handle.parent();\n          slider = {\n            type,\n            elem: handle,\n            input: $(data.input),\n            parent,\n            offset: parent.offset()\n          };\n          $win.mousemove(dragSlider).mouseup(stopSlider);\n          evt.preventDefault();\n        });\n\n        $(data.input).val(data.val).change(function () {\n          const isRad = curType === 'radialGradient';\n          let val = +this.value;\n          let xpos = 0;\n          switch (type) {\n          case 'radius':\n            if (isRad) curGradient.setAttribute('r', val / 100);\n            xpos = (Math.pow(val / 100, 1 / 2.5) / 2) * SLIDERW;\n            break;\n\n          case 'opacity':\n            $this.paint.alpha = val;\n            previewRect.setAttribute('fill-opacity', val / 100);\n            xpos = val * (SLIDERW / 100);\n            break;\n\n          case 'ellip':\n            scaleX = scaleY = 1;\n            if (val === 0) {\n              xpos = SLIDERW * 0.5;\n              break;\n            }\n            if (val > 99.5) val = 99.5;\n            if (val > 0) {\n              scaleY = 1 - (val / 100);\n            } else {\n              scaleX = -(val / 100) - 1;\n            }\n\n            xpos = SLIDERW * ((val + 100) / 2) / 100;\n            if (isRad) xform();\n            break;\n\n          case 'angle':\n            angle = val;\n            xpos = angle / 180;\n            xpos += 0.5;\n            xpos *= SLIDERW;\n            if (isRad) xform();\n          }\n          if (xpos > SLIDERW) {\n            xpos = SLIDERW;\n          } else if (xpos < 0) {\n            xpos = 0;\n          }\n          handle.css({'margin-left': xpos - 5});\n        }).change();\n      });\n\n      const dragSlider = function (evt) {\n        setSlider(evt);\n        evt.preventDefault();\n      };\n\n      const stopSlider = function (evt) {\n        $win.unbind('mousemove', dragSlider).unbind('mouseup', stopSlider);\n        slider = null;\n      };\n\n      // --------------\n      let thisAlpha = ($this.paint.alpha * 255 / 100).toString(16);\n      while (thisAlpha.length < 2) { thisAlpha = '0' + thisAlpha; }\n      thisAlpha = thisAlpha.split('.')[0];\n      color = $this.paint.solidColor === 'none' ? '' : $this.paint.solidColor + thisAlpha;\n\n      if (!isSolid) {\n        color = stops[0].getAttribute('stop-color');\n      }\n\n      // This should be done somewhere else, probably\n      $.extend($.fn.jPicker.defaults.window, {\n        alphaSupport: true, effects: {type: 'show', speed: 0}\n      });\n\n      colPicker.jPicker(\n        {\n          window: { title: $settings.window.pickerTitle },\n          images: { clientPath: $settings.images.clientPath },\n          color: { active: color, alphaSupport: true }\n        },\n        function (color) {\n          $this.paint.type = 'solidColor';\n          $this.paint.alpha = color.val('ahex') ? Math.round((color.val('a') / 255) * 100) : 100;\n          $this.paint.solidColor = color.val('hex') ? color.val('hex') : 'none';\n          $this.paint.radialGradient = null;\n          okClicked();\n        },\n        null,\n        function () { cancelClicked(); }\n      );\n\n      const tabs = $(idref + ' .jGraduate_tabs li');\n      tabs.click(function () {\n        tabs.removeClass('jGraduate_tab_current');\n        $(this).addClass('jGraduate_tab_current');\n        $(idref + ' > div').hide();\n        const type = $(this).attr('data-type');\n        /* const container = */ $(idref + ' .jGraduate_gradPick').show();\n        if (type === 'rg' || type === 'lg') {\n          // Show/hide appropriate fields\n          $('.jGraduate_' + type + '_field').show();\n          $('.jGraduate_' + (type === 'lg' ? 'rg' : 'lg') + '_field').hide();\n\n          $('#' + id + '_jgraduate_rect')[0].setAttribute('fill', 'url(#' + id + '_' + type + '_jgraduate_grad)');\n\n          // Copy stops\n\n          curType = type === 'lg' ? 'linearGradient' : 'radialGradient';\n\n          $('#' + id + '_jGraduate_OpacInput').val($this.paint.alpha).change();\n\n          const newGrad = $('#' + id + '_' + type + '_jgraduate_grad')[0];\n\n          if (curGradient !== newGrad) {\n            const curStops = $(curGradient).find('stop');\n            $(newGrad).empty().append(curStops);\n            curGradient = newGrad;\n            const sm = spreadMethodOpt.val();\n            curGradient.setAttribute('spreadMethod', sm);\n          }\n          showFocus = type === 'rg' && curGradient.getAttribute('fx') != null && !(cx === fx && cy === fy);\n          $('#' + id + '_jGraduate_focusCoord').toggle(showFocus);\n          if (showFocus) {\n            $('#' + id + '_jGraduate_match_ctr')[0].checked = false;\n          }\n        } else {\n          $(idref + ' .jGraduate_gradPick').hide();\n          $(idref + ' .jGraduate_colPick').show();\n        }\n      });\n      $(idref + ' > div').hide();\n      tabs.removeClass('jGraduate_tab_current');\n      let tab;\n      switch ($this.paint.type) {\n      case 'linearGradient':\n        tab = $(idref + ' .jGraduate_tab_lingrad');\n        break;\n      case 'radialGradient':\n        tab = $(idref + ' .jGraduate_tab_radgrad');\n        break;\n      default:\n        tab = $(idref + ' .jGraduate_tab_color');\n        break;\n      }\n      $this.show();\n\n      // jPicker will try to show after a 0ms timeout, so need to fire this after that\n      setTimeout(() => {\n        tab.addClass('jGraduate_tab_current').click();\n      }, 10);\n    });\n  };\n  return $;\n}\n","/**\n * jPicker (Adapted from version 1.1.6)\n *\n * jQuery Plugin for Photoshop style color picker\n *\n * @module jPicker\n * @copyright (c) 2010 Christopher T. Tillman\n * Digital Magic Productions, Inc. ({@link http://www.digitalmagicpro.com/})\n * FREE to use, alter, copy, sell, and especially ENHANCE\n * @license MIT\n *\n * Painstakingly ported from John Dyers' excellent work on his own color picker based on the Prototype framework.\n *\n * John Dyers' website: {@link http://johndyer.name}\n * Color Picker page: {@link http://johndyer.name/photoshop-like-javascript-color-picker/}\n */\n\n/**\n* @external Math\n*/\n/**\n* @memberof external:Math\n* @param {Float} value\n* @param {Float} precision\n* @returns {Float}\n*/\nMath.precision = function (value, precision) {\n  if (precision === undefined) precision = 0;\n  return Math.round(value * Math.pow(10, precision)) / Math.pow(10, precision);\n};\n\n/**\n* @function module:jPicker.jPicker\n* @param {external:jQuery} $ The jQuery object to wrap (with {@link external:jQuery.loadingStylesheets}, {@link external:jQuery.fn.$.fn.jPicker}, {@link external:jQuery.fn.$.fn.jPicker.defaults})\n* @returns {external:jQuery}\n*/\nconst jPicker = function ($) {\n  if (!$.loadingStylesheets) {\n    /**\n    * @name loadingStylesheets\n    * @type {string[]}\n    * @memberof external:jQuery\n    */\n    $.loadingStylesheets = [];\n  }\n  const stylesheet = 'jgraduate/css/jPicker.css';\n  if (!$.loadingStylesheets.includes(stylesheet)) {\n    $.loadingStylesheets.push(stylesheet);\n  }\n  /**\n  * @typedef {PlainObject} module:jPicker.SliderOptions\n  * @property {external:jQuery|PlainObject} arrow\n  * @property {string} arrow.image Not in use?\n  * @property {Float} arrow.width\n  * @property {Float} arrow.height\n  * @property {PlainObject} map\n  * @property {Float} map.width\n  * @property {Float} map.height\n  */\n\n  /**\n  * Encapsulate slider functionality for the ColorMap and ColorBar -\n  * could be useful to use a jQuery UI draggable for this with certain extensions\n  * @param {external:jQuery} bar\n  * @param {module:jPicker.SliderOptions} options\n  */\n  function Slider (bar, options) {\n    const $this = this;\n    function fireChangeEvents (context) {\n      for (let i = 0; i < changeEvents.length; i++) {\n        changeEvents[i].call($this, $this, context);\n      }\n    }\n    // bind the mousedown to the bar not the arrow for quick snapping to the clicked location\n    function mouseDown (e) {\n      const off = bar.offset();\n      offset = {l: off.left | 0, t: off.top | 0};\n      clearTimeout(timeout);\n      // using setTimeout for visual updates - once the style is updated the browser will re-render internally allowing the next Javascript to run\n      timeout = setTimeout(function () {\n        setValuesFromMousePosition.call($this, e);\n      }, 0);\n      // Bind mousemove and mouseup event to the document so it responds when dragged of of the bar - we will unbind these when on mouseup to save processing\n      $(document).bind('mousemove', mouseMove).bind('mouseup', mouseUp);\n      e.preventDefault(); // don't try to select anything or drag the image to the desktop\n    }\n    // set the values as the mouse moves\n    function mouseMove (e) {\n      clearTimeout(timeout);\n      timeout = setTimeout(function () {\n        setValuesFromMousePosition.call($this, e);\n      }, 0);\n      e.stopPropagation();\n      e.preventDefault();\n      return false;\n    }\n    // unbind the document events - they aren't needed when not dragging\n    function mouseUp (e) {\n      $(document).unbind('mouseup', mouseUp).unbind('mousemove', mouseMove);\n      e.stopPropagation();\n      e.preventDefault();\n      return false;\n    }\n    // calculate mouse position and set value within the current range\n    function setValuesFromMousePosition (e) {\n      const barW = bar.w, // local copies for YUI compressor\n        barH = bar.h;\n      let locX = e.pageX - offset.l,\n        locY = e.pageY - offset.t;\n      // keep the arrow within the bounds of the bar\n      if (locX < 0) locX = 0;\n      else if (locX > barW) locX = barW;\n      if (locY < 0) locY = 0;\n      else if (locY > barH) locY = barH;\n      val.call($this, 'xy', { x: ((locX / barW) * rangeX) + minX, y: ((locY / barH) * rangeY) + minY });\n    }\n    function draw () {\n      const\n        barW = bar.w,\n        barH = bar.h,\n        arrowW = arrow.w,\n        arrowH = arrow.h;\n      let arrowOffsetX = 0,\n        arrowOffsetY = 0;\n      setTimeout(function () {\n        if (rangeX > 0) { // range is greater than zero\n          // constrain to bounds\n          if (x === maxX) arrowOffsetX = barW;\n          else arrowOffsetX = ((x / rangeX) * barW) | 0;\n        }\n        if (rangeY > 0) { // range is greater than zero\n          // constrain to bounds\n          if (y === maxY) arrowOffsetY = barH;\n          else arrowOffsetY = ((y / rangeY) * barH) | 0;\n        }\n        // if arrow width is greater than bar width, center arrow and prevent horizontal dragging\n        if (arrowW >= barW) arrowOffsetX = (barW >> 1) - (arrowW >> 1); // number >> 1 - superfast bitwise divide by two and truncate (move bits over one bit discarding lowest)\n        else arrowOffsetX -= arrowW >> 1;\n        // if arrow height is greater than bar height, center arrow and prevent vertical dragging\n        if (arrowH >= barH) arrowOffsetY = (barH >> 1) - (arrowH >> 1);\n        else arrowOffsetY -= arrowH >> 1;\n        // set the arrow position based on these offsets\n        arrow.css({ left: arrowOffsetX + 'px', top: arrowOffsetY + 'px' });\n      }, 0);\n    }\n    function val (name, value, context) {\n      const set = value !== undefined;\n      if (!set) {\n        if (name === undefined || name == null) name = 'xy';\n        switch (name.toLowerCase()) {\n        case 'x': return x;\n        case 'y': return y;\n        case 'xy':\n        default: return { x, y };\n        }\n      }\n      if (context != null && context === $this) return;\n      let changed = false;\n\n      let newX, newY;\n      if (name == null) name = 'xy';\n      switch (name.toLowerCase()) {\n      case 'x':\n        newX = (value && ((value.x && value.x | 0) || value | 0)) || 0;\n        break;\n      case 'y':\n        newY = (value && ((value.y && value.y | 0) || value | 0)) || 0;\n        break;\n      case 'xy':\n      default:\n        newX = (value && value.x && value.x | 0) || 0;\n        newY = (value && value.y && value.y | 0) || 0;\n        break;\n      }\n      if (newX != null) {\n        if (newX < minX) newX = minX;\n        else if (newX > maxX) newX = maxX;\n        if (x !== newX) {\n          x = newX;\n          changed = true;\n        }\n      }\n      if (newY != null) {\n        if (newY < minY) newY = minY;\n        else if (newY > maxY) newY = maxY;\n        if (y !== newY) {\n          y = newY;\n          changed = true;\n        }\n      }\n      changed && fireChangeEvents.call($this, context || $this);\n    }\n    function range (name, value) {\n      const set = value !== undefined;\n      if (!set) {\n        if (name === undefined || name == null) name = 'all';\n        switch (name.toLowerCase()) {\n        case 'minx': return minX;\n        case 'maxx': return maxX;\n        case 'rangex': return { minX, maxX, rangeX };\n        case 'miny': return minY;\n        case 'maxy': return maxY;\n        case 'rangey': return { minY, maxY, rangeY };\n        case 'all':\n        default: return { minX, maxX, rangeX, minY, maxY, rangeY };\n        }\n      }\n      let // changed = false,\n        newMinX,\n        newMaxX,\n        newMinY,\n        newMaxY;\n      if (name == null) name = 'all';\n      switch (name.toLowerCase()) {\n      case 'minx':\n        newMinX = (value && ((value.minX && value.minX | 0) || value | 0)) || 0;\n        break;\n      case 'maxx':\n        newMaxX = (value && ((value.maxX && value.maxX | 0) || value | 0)) || 0;\n        break;\n      case 'rangex':\n        newMinX = (value && value.minX && value.minX | 0) || 0;\n        newMaxX = (value && value.maxX && value.maxX | 0) || 0;\n        break;\n      case 'miny':\n        newMinY = (value && ((value.minY && value.minY | 0) || value | 0)) || 0;\n        break;\n      case 'maxy':\n        newMaxY = (value && ((value.maxY && value.maxY | 0) || value | 0)) || 0;\n        break;\n      case 'rangey':\n        newMinY = (value && value.minY && value.minY | 0) || 0;\n        newMaxY = (value && value.maxY && value.maxY | 0) || 0;\n        break;\n      case 'all':\n      default:\n        newMinX = (value && value.minX && value.minX | 0) || 0;\n        newMaxX = (value && value.maxX && value.maxX | 0) || 0;\n        newMinY = (value && value.minY && value.minY | 0) || 0;\n        newMaxY = (value && value.maxY && value.maxY | 0) || 0;\n        break;\n      }\n      if (newMinX != null && minX !== newMinX) {\n        minX = newMinX;\n        rangeX = maxX - minX;\n      }\n      if (newMaxX != null && maxX !== newMaxX) {\n        maxX = newMaxX;\n        rangeX = maxX - minX;\n      }\n      if (newMinY != null && minY !== newMinY) {\n        minY = newMinY;\n        rangeY = maxY - minY;\n      }\n      if (newMaxY != null && maxY !== newMaxY) {\n        maxY = newMaxY;\n        rangeY = maxY - minY;\n      }\n    }\n    function bind (callback) {\n      if (typeof callback === 'function') changeEvents.push(callback);\n    }\n    function unbind (callback) {\n      if (typeof callback !== 'function') return;\n      let i;\n      while ((i = changeEvents.includes(callback))) changeEvents.splice(i, 1);\n    }\n    function destroy () {\n      // unbind all possible events and null objects\n      $(document).unbind('mouseup', mouseUp).unbind('mousemove', mouseMove);\n      bar.unbind('mousedown', mouseDown);\n      bar = null;\n      arrow = null;\n      changeEvents = null;\n    }\n    let offset,\n      timeout,\n      x = 0,\n      y = 0,\n      minX = 0,\n      maxX = 100,\n      rangeX = 100,\n      minY = 0,\n      maxY = 100,\n      rangeY = 100,\n      arrow = bar.find('img:first'), // the arrow image to drag\n      changeEvents = [];\n\n    $.extend(true, $this, // public properties, methods, and event bindings - these we need to access from other controls\n      {\n        val,\n        range,\n        bind,\n        unbind,\n        destroy\n      }\n    );\n    // initialize this control\n    arrow.src = options.arrow && options.arrow.image;\n    arrow.w = (options.arrow && options.arrow.width) || arrow.width();\n    arrow.h = (options.arrow && options.arrow.height) || arrow.height();\n    bar.w = (options.map && options.map.width) || bar.width();\n    bar.h = (options.map && options.map.height) || bar.height();\n    // bind mousedown event\n    bar.bind('mousedown', mouseDown);\n    bind.call($this, draw);\n  }\n  // controls for all the input elements for the typing in color values\n  function ColorValuePicker (picker, color, bindedHex, alphaPrecision) {\n    const $this = this; // private properties and methods\n    const inputs = picker.find('td.Text input');\n    // input box key down - use arrows to alter color\n    function keyDown (e) {\n      if (e.target.value === '' && e.target !== hex.get(0) && ((bindedHex != null && e.target !== bindedHex.get(0)) || bindedHex == null)) return;\n      if (!validateKey(e)) return e;\n      switch (e.target) {\n      case red.get(0):\n        switch (e.keyCode) {\n        case 38:\n          red.val(setValueInRange.call($this, (red.val() << 0) + 1, 0, 255));\n          color.val('r', red.val(), e.target);\n          return false;\n        case 40:\n          red.val(setValueInRange.call($this, (red.val() << 0) - 1, 0, 255));\n          color.val('r', red.val(), e.target);\n          return false;\n        }\n        break;\n      case green.get(0):\n        switch (e.keyCode) {\n        case 38:\n          green.val(setValueInRange.call($this, (green.val() << 0) + 1, 0, 255));\n          color.val('g', green.val(), e.target);\n          return false;\n        case 40:\n          green.val(setValueInRange.call($this, (green.val() << 0) - 1, 0, 255));\n          color.val('g', green.val(), e.target);\n          return false;\n        }\n        break;\n      case blue.get(0):\n        switch (e.keyCode) {\n        case 38:\n          blue.val(setValueInRange.call($this, (blue.val() << 0) + 1, 0, 255));\n          color.val('b', blue.val(), e.target);\n          return false;\n        case 40:\n          blue.val(setValueInRange.call($this, (blue.val() << 0) - 1, 0, 255));\n          color.val('b', blue.val(), e.target);\n          return false;\n        }\n        break;\n      case alpha && alpha.get(0):\n        switch (e.keyCode) {\n        case 38:\n          alpha.val(setValueInRange.call($this, parseFloat(alpha.val()) + 1, 0, 100));\n          color.val('a', Math.precision((alpha.val() * 255) / 100, alphaPrecision), e.target);\n          return false;\n        case 40:\n          alpha.val(setValueInRange.call($this, parseFloat(alpha.val()) - 1, 0, 100));\n          color.val('a', Math.precision((alpha.val() * 255) / 100, alphaPrecision), e.target);\n          return false;\n        }\n        break;\n      case hue.get(0):\n        switch (e.keyCode) {\n        case 38:\n          hue.val(setValueInRange.call($this, (hue.val() << 0) + 1, 0, 360));\n          color.val('h', hue.val(), e.target);\n          return false;\n        case 40:\n          hue.val(setValueInRange.call($this, (hue.val() << 0) - 1, 0, 360));\n          color.val('h', hue.val(), e.target);\n          return false;\n        }\n        break;\n      case saturation.get(0):\n        switch (e.keyCode) {\n        case 38:\n          saturation.val(setValueInRange.call($this, (saturation.val() << 0) + 1, 0, 100));\n          color.val('s', saturation.val(), e.target);\n          return false;\n        case 40:\n          saturation.val(setValueInRange.call($this, (saturation.val() << 0) - 1, 0, 100));\n          color.val('s', saturation.val(), e.target);\n          return false;\n        }\n        break;\n      case value.get(0):\n        switch (e.keyCode) {\n        case 38:\n          value.val(setValueInRange.call($this, (value.val() << 0) + 1, 0, 100));\n          color.val('v', value.val(), e.target);\n          return false;\n        case 40:\n          value.val(setValueInRange.call($this, (value.val() << 0) - 1, 0, 100));\n          color.val('v', value.val(), e.target);\n          return false;\n        }\n        break;\n      }\n    }\n    // input box key up - validate value and set color\n    function keyUp (e) {\n      if (e.target.value === '' && e.target !== hex.get(0) &&\n        ((bindedHex != null && e.target !== bindedHex.get(0)) ||\n        bindedHex == null)) return;\n      if (!validateKey(e)) return e;\n      switch (e.target) {\n      case red.get(0):\n        red.val(setValueInRange.call($this, red.val(), 0, 255));\n        color.val('r', red.val(), e.target);\n        break;\n      case green.get(0):\n        green.val(setValueInRange.call($this, green.val(), 0, 255));\n        color.val('g', green.val(), e.target);\n        break;\n      case blue.get(0):\n        blue.val(setValueInRange.call($this, blue.val(), 0, 255));\n        color.val('b', blue.val(), e.target);\n        break;\n      case alpha && alpha.get(0):\n        alpha.val(setValueInRange.call($this, alpha.val(), 0, 100));\n        color.val('a', Math.precision((alpha.val() * 255) / 100, alphaPrecision), e.target);\n        break;\n      case hue.get(0):\n        hue.val(setValueInRange.call($this, hue.val(), 0, 360));\n        color.val('h', hue.val(), e.target);\n        break;\n      case saturation.get(0):\n        saturation.val(setValueInRange.call($this, saturation.val(), 0, 100));\n        color.val('s', saturation.val(), e.target);\n        break;\n      case value.get(0):\n        value.val(setValueInRange.call($this, value.val(), 0, 100));\n        color.val('v', value.val(), e.target);\n        break;\n      case hex.get(0):\n        hex.val(hex.val().replace(/[^a-fA-F0-9]/g, '').toLowerCase().substring(0, 6));\n        bindedHex && bindedHex.val(hex.val());\n        color.val('hex', hex.val() !== '' ? hex.val() : null, e.target);\n        break;\n      case bindedHex && bindedHex.get(0):\n        bindedHex.val(bindedHex.val().replace(/[^a-fA-F0-9]/g, '').toLowerCase().substring(0, 6));\n        hex.val(bindedHex.val());\n        color.val('hex', bindedHex.val() !== '' ? bindedHex.val() : null, e.target);\n        break;\n      case ahex && ahex.get(0):\n        ahex.val(ahex.val().replace(/[^a-fA-F0-9]/g, '').toLowerCase().substring(0, 2));\n        color.val('a', ahex.val() != null ? parseInt(ahex.val(), 16) : null, e.target);\n        break;\n      }\n    }\n    // input box blur - reset to original if value empty\n    function blur (e) {\n      if (color.val() != null) {\n        switch (e.target) {\n        case red.get(0): red.val(color.val('r')); break;\n        case green.get(0): green.val(color.val('g')); break;\n        case blue.get(0): blue.val(color.val('b')); break;\n        case alpha && alpha.get(0): alpha.val(Math.precision((color.val('a') * 100) / 255, alphaPrecision)); break;\n        case hue.get(0): hue.val(color.val('h')); break;\n        case saturation.get(0): saturation.val(color.val('s')); break;\n        case value.get(0): value.val(color.val('v')); break;\n        case hex.get(0):\n        case bindedHex && bindedHex.get(0):\n          hex.val(color.val('hex'));\n          bindedHex && bindedHex.val(color.val('hex'));\n          break;\n        case ahex && ahex.get(0): ahex.val(color.val('ahex').substring(6)); break;\n        }\n      }\n    }\n    function validateKey (e) {\n      switch (e.keyCode) {\n      case 9:\n      case 16:\n      case 29:\n      case 37:\n      case 39:\n        return false;\n      case 'c'.charCodeAt():\n      case 'v'.charCodeAt():\n        if (e.ctrlKey) return false;\n      }\n      return true;\n    }\n    // constrain value within range\n    function setValueInRange (value, min, max) {\n      if (value === '' || isNaN(value)) return min;\n      if (value > max) return max;\n      if (value < min) return min;\n      return value;\n    }\n    function colorChanged (ui, context) {\n      const all = ui.val('all');\n      if (context !== red.get(0)) red.val(all != null ? all.r : '');\n      if (context !== green.get(0)) green.val(all != null ? all.g : '');\n      if (context !== blue.get(0)) blue.val(all != null ? all.b : '');\n      if (alpha && context !== alpha.get(0)) alpha.val(all != null ? Math.precision((all.a * 100) / 255, alphaPrecision) : '');\n      if (context !== hue.get(0)) hue.val(all != null ? all.h : '');\n      if (context !== saturation.get(0)) saturation.val(all != null ? all.s : '');\n      if (context !== value.get(0)) value.val(all != null ? all.v : '');\n      if (context !== hex.get(0) && ((bindedHex && context !== bindedHex.get(0)) || !bindedHex)) hex.val(all != null ? all.hex : '');\n      if (bindedHex && context !== bindedHex.get(0) && context !== hex.get(0)) bindedHex.val(all != null ? all.hex : '');\n      if (ahex && context !== ahex.get(0)) ahex.val(all != null ? all.ahex.substring(6) : '');\n    }\n    function destroy () {\n      // unbind all events and null objects\n      red.add(green).add(blue).add(alpha).add(hue).add(saturation).add(value).add(hex).add(bindedHex).add(ahex).unbind('keyup', keyUp).unbind('blur', blur);\n      red.add(green).add(blue).add(alpha).add(hue).add(saturation).add(value).unbind('keydown', keyDown);\n      color.unbind(colorChanged);\n      red = null;\n      green = null;\n      blue = null;\n      alpha = null;\n      hue = null;\n      saturation = null;\n      value = null;\n      hex = null;\n      ahex = null;\n    }\n    let\n      red = inputs.eq(3),\n      green = inputs.eq(4),\n      blue = inputs.eq(5),\n      alpha = inputs.length > 7 ? inputs.eq(6) : null,\n      hue = inputs.eq(0),\n      saturation = inputs.eq(1),\n      value = inputs.eq(2),\n      hex = inputs.eq(inputs.length > 7 ? 7 : 6),\n      ahex = inputs.length > 7 ? inputs.eq(8) : null;\n    $.extend(true, $this, {\n      // public properties and methods\n      destroy\n    });\n    red.add(green).add(blue).add(alpha).add(hue).add(saturation).add(value).add(hex).add(bindedHex).add(ahex).bind('keyup', keyUp).bind('blur', blur);\n    red.add(green).add(blue).add(alpha).add(hue).add(saturation).add(value).bind('keydown', keyDown);\n    color.bind(colorChanged);\n  }\n\n  /**\n  * @typedef {PlainObject} module:jPicker.JPickerInit\n  * @property {Integer} a\n  * @property {Integer} b\n  * @property {Integer} g\n  * @property {Integer} h\n  * @property {Integer} r\n  * @property {Integer} s\n  * @property {Integer} v\n  * @property {string} hex\n  * @property {string} ahex\n  */\n\n  /**\n  * @namespace {PlainObject} jPicker\n  * @memberof external:jQuery\n  */\n  $.jPicker = /** @lends external:jQuery.jPicker */ {\n    /**\n    * Array holding references to each active instance of the jPicker control\n    * @type {external:jQuery.fn.$.fn.jPicker[]}\n    */\n    List: [],\n    /**\n    * Color object - we will be able to assign by any color space type or\n    * retrieve any color space info.\n    * We want this public so we can optionally assign new color objects to\n    * initial values using inputs other than a string hex value (also supported)\n    * Note: JSDoc didn't document when expressed here as an ES6 Class.\n    * @namespace\n    * @class\n    * @memberof external:jQuery.jPicker\n    * @param {module:jPicker.JPickerInit} init\n    */\n    Color: function (init) {\n      const $this = this;\n      function fireChangeEvents (context) {\n        for (let i = 0; i < changeEvents.length; i++) changeEvents[i].call($this, $this, context);\n      }\n      function val (name, value, context) {\n        // Kind of ugly\n        const set = Boolean(value);\n        if (set && value.ahex === '') value.ahex = '00000000';\n        if (!set) {\n          if (name === undefined || name == null || name === '') name = 'all';\n          if (r == null) return null;\n          switch (name.toLowerCase()) {\n          case 'ahex': return ColorMethods.rgbaToHex({ r, g, b, a });\n          case 'hex': return val('ahex').substring(0, 6);\n          case 'all': return { r, g, b, a, h, s, v, hex: val.call($this, 'hex'), ahex: val.call($this, 'ahex') };\n          default:\n            let ret = {};\n            for (let i = 0; i < name.length; i++) {\n              switch (name.charAt(i)) {\n              case 'r':\n                if (name.length === 1) ret = r;\n                else ret.r = r;\n                break;\n              case 'g':\n                if (name.length === 1) ret = g;\n                else ret.g = g;\n                break;\n              case 'b':\n                if (name.length === 1) ret = b;\n                else ret.b = b;\n                break;\n              case 'a':\n                if (name.length === 1) ret = a;\n                else ret.a = a;\n                break;\n              case 'h':\n                if (name.length === 1) ret = h;\n                else ret.h = h;\n                break;\n              case 's':\n                if (name.length === 1) ret = s;\n                else ret.s = s;\n                break;\n              case 'v':\n                if (name.length === 1) ret = v;\n                else ret.v = v;\n                break;\n              }\n            }\n            return !name.length ? val.call($this, 'all') : ret;\n          }\n        }\n        if (context != null && context === $this) return;\n        if (name == null) name = '';\n\n        let changed = false;\n        if (value == null) {\n          if (r != null) {\n            r = null;\n            changed = true;\n          }\n          if (g != null) {\n            g = null;\n            changed = true;\n          }\n          if (b != null) {\n            b = null;\n            changed = true;\n          }\n          if (a != null) {\n            a = null;\n            changed = true;\n          }\n          if (h != null) {\n            h = null;\n            changed = true;\n          }\n          if (s != null) {\n            s = null;\n            changed = true;\n          }\n          if (v != null) {\n            v = null;\n            changed = true;\n          }\n          changed && fireChangeEvents.call($this, context || $this);\n          return;\n        }\n        switch (name.toLowerCase()) {\n        case 'ahex':\n        case 'hex':\n          const ret = ColorMethods.hexToRgba((value && (value.ahex || value.hex)) || value || 'none');\n          val.call($this, 'rgba', { r: ret.r, g: ret.g, b: ret.b, a: name === 'ahex' ? ret.a : a != null ? a : 255 }, context);\n          break;\n        default:\n          if (value && (value.ahex != null || value.hex != null)) {\n            val.call($this, 'ahex', value.ahex || value.hex || '00000000', context);\n            return;\n          }\n          const newV = {};\n          let rgb = false, hsv = false;\n          if (value.r !== undefined && !name.includes('r')) name += 'r';\n          if (value.g !== undefined && !name.includes('g')) name += 'g';\n          if (value.b !== undefined && !name.includes('b')) name += 'b';\n          if (value.a !== undefined && !name.includes('a')) name += 'a';\n          if (value.h !== undefined && !name.includes('h')) name += 'h';\n          if (value.s !== undefined && !name.includes('s')) name += 's';\n          if (value.v !== undefined && !name.includes('v')) name += 'v';\n          for (let i = 0; i < name.length; i++) {\n            switch (name.charAt(i)) {\n            case 'r':\n              if (hsv) continue;\n              rgb = true;\n              newV.r = (value && value.r && value.r | 0) || (value && value | 0) || 0;\n              if (newV.r < 0) newV.r = 0;\n              else if (newV.r > 255) newV.r = 255;\n              if (r !== newV.r) {\n                ({r} = newV);\n                changed = true;\n              }\n              break;\n            case 'g':\n              if (hsv) continue;\n              rgb = true;\n              newV.g = (value && value.g && value.g | 0) || (value && value | 0) || 0;\n              if (newV.g < 0) newV.g = 0;\n              else if (newV.g > 255) newV.g = 255;\n              if (g !== newV.g) {\n                ({g} = newV);\n                changed = true;\n              }\n              break;\n            case 'b':\n              if (hsv) continue;\n              rgb = true;\n              newV.b = (value && value.b && value.b | 0) || (value && value | 0) || 0;\n              if (newV.b < 0) newV.b = 0;\n              else if (newV.b > 255) newV.b = 255;\n              if (b !== newV.b) {\n                ({b} = newV);\n                changed = true;\n              }\n              break;\n            case 'a':\n              newV.a = value && value.a != null ? value.a | 0 : value != null ? value | 0 : 255;\n              if (newV.a < 0) newV.a = 0;\n              else if (newV.a > 255) newV.a = 255;\n              if (a !== newV.a) {\n                ({a} = newV);\n                changed = true;\n              }\n              break;\n            case 'h':\n              if (rgb) continue;\n              hsv = true;\n              newV.h = (value && value.h && value.h | 0) || (value && value | 0) || 0;\n              if (newV.h < 0) newV.h = 0;\n              else if (newV.h > 360) newV.h = 360;\n              if (h !== newV.h) {\n                ({h} = newV);\n                changed = true;\n              }\n              break;\n            case 's':\n              if (rgb) continue;\n              hsv = true;\n              newV.s = value && value.s != null ? value.s | 0 : value != null ? value | 0 : 100;\n              if (newV.s < 0) newV.s = 0;\n              else if (newV.s > 100) newV.s = 100;\n              if (s !== newV.s) {\n                ({s} = newV);\n                changed = true;\n              }\n              break;\n            case 'v':\n              if (rgb) continue;\n              hsv = true;\n              newV.v = value && value.v != null ? value.v | 0 : value != null ? value | 0 : 100;\n              if (newV.v < 0) newV.v = 0;\n              else if (newV.v > 100) newV.v = 100;\n              if (v !== newV.v) {\n                ({v} = newV);\n                changed = true;\n              }\n              break;\n            }\n          }\n          if (changed) {\n            if (rgb) {\n              r = r || 0;\n              g = g || 0;\n              b = b || 0;\n              const ret = ColorMethods.rgbToHsv({ r, g, b });\n              ({h, s, v} = ret);\n            } else if (hsv) {\n              h = h || 0;\n              s = s != null ? s : 100;\n              v = v != null ? v : 100;\n              const ret = ColorMethods.hsvToRgb({ h, s, v });\n              ({r, g, b} = ret);\n            }\n            a = a != null ? a : 255;\n            fireChangeEvents.call($this, context || $this);\n          }\n          break;\n        }\n      }\n      function bind (callback) {\n        if (typeof callback === 'function') changeEvents.push(callback);\n      }\n      function unbind (callback) {\n        if (typeof callback !== 'function') return;\n        let i;\n        while ((i = changeEvents.includes(callback))) {\n          changeEvents.splice(i, 1);\n        }\n      }\n      function destroy () {\n        changeEvents = null;\n      }\n      let r, g, b, a, h, s, v, changeEvents = [];\n\n      $.extend(true, $this, {\n        // public properties and methods\n        val,\n        bind,\n        unbind,\n        destroy\n      });\n      if (init) {\n        if (init.ahex != null) {\n          val('ahex', init);\n        } else if (init.hex != null) {\n          val(\n            (init.a != null ? 'a' : '') + 'hex',\n            init.a != null\n              ? {ahex: init.hex + ColorMethods.intToHex(init.a)}\n              : init\n          );\n        } else if (init.r != null && init.g != null && init.b != null) {\n          val('rgb' + (init.a != null ? 'a' : ''), init);\n        } else if (init.h != null && init.s != null && init.v != null) {\n          val('hsv' + (init.a != null ? 'a' : ''), init);\n        }\n      }\n    },\n    /**\n    * color conversion methods  - make public to give use to external scripts\n    * @namespace\n    */\n    ColorMethods: {\n      /**\n      * @typedef {PlainObject} module:jPicker.RGBA\n      * @property {Integer} r\n      * @property {Integer} g\n      * @property {Integer} b\n      * @property {Integer} a\n      */\n      /**\n      * @typedef {PlainObject} module:jPicker.RGB\n      * @property {Integer} r\n      * @property {Integer} g\n      * @property {Integer} b\n      */\n      /**\n      * @param {string} hex\n      * @returns {module:jPicker.RGBA}\n      */\n      hexToRgba (hex) {\n        if (hex === '' || hex === 'none') return { r: null, g: null, b: null, a: null };\n        hex = this.validateHex(hex);\n        let r = '00', g = '00', b = '00', a = '255';\n        if (hex.length === 6) hex += 'ff';\n        if (hex.length > 6) {\n          r = hex.substring(0, 2);\n          g = hex.substring(2, 4);\n          b = hex.substring(4, 6);\n          a = hex.substring(6, hex.length);\n        } else {\n          if (hex.length > 4) {\n            r = hex.substring(4, hex.length);\n            hex = hex.substring(0, 4);\n          }\n          if (hex.length > 2) {\n            g = hex.substring(2, hex.length);\n            hex = hex.substring(0, 2);\n          }\n          if (hex.length > 0) b = hex.substring(0, hex.length);\n        }\n        return {\n          r: this.hexToInt(r), g: this.hexToInt(g), b: this.hexToInt(b), a: this.hexToInt(a)\n        };\n      },\n      /**\n      * @param {string} hex\n      * @returns {string}\n      */\n      validateHex (hex) {\n        // if (typeof hex === 'object') return '';\n        hex = hex.toLowerCase().replace(/[^a-f0-9]/g, '');\n        if (hex.length > 8) hex = hex.substring(0, 8);\n        return hex;\n      },\n      /**\n      * @param {module:jPicker.RGBA} rgba\n      * @returns {string}\n      */\n      rgbaToHex (rgba) {\n        return this.intToHex(rgba.r) + this.intToHex(rgba.g) + this.intToHex(rgba.b) + this.intToHex(rgba.a);\n      },\n      /**\n      * @param {Integer} dec\n      * @returns {string}\n      */\n      intToHex (dec) {\n        let result = (dec | 0).toString(16);\n        if (result.length === 1) result = ('0' + result);\n        return result.toLowerCase();\n      },\n      /**\n      * @param {string} hex\n      * @returns {Integer}\n      */\n      hexToInt (hex) {\n        return parseInt(hex, 16);\n      },\n      /**\n      * @typedef {PlainObject} module:jPicker.HSV\n      * @property {Integer} h\n      * @property {Integer} s\n      * @property {Integer} v\n      */\n      /**\n      * @param {module:jPicker.RGB} rgb\n      * @returns {module:jPicker.HSV}\n      */\n      rgbToHsv (rgb) {\n        const r = rgb.r / 255, g = rgb.g / 255, b = rgb.b / 255, hsv = { h: 0, s: 0, v: 0 };\n        let min = 0, max = 0;\n        if (r >= g && r >= b) {\n          max = r;\n          min = g > b ? b : g;\n        } else if (g >= b && g >= r) {\n          max = g;\n          min = r > b ? b : r;\n        } else {\n          max = b;\n          min = g > r ? r : g;\n        }\n        hsv.v = max;\n        hsv.s = max ? (max - min) / max : 0;\n        let delta;\n        if (!hsv.s) hsv.h = 0;\n        else {\n          delta = max - min;\n          if (r === max) hsv.h = (g - b) / delta;\n          else if (g === max) hsv.h = 2 + (b - r) / delta;\n          else hsv.h = 4 + (r - g) / delta;\n          hsv.h = parseInt(hsv.h * 60);\n          if (hsv.h < 0) hsv.h += 360;\n        }\n        hsv.s = (hsv.s * 100) | 0;\n        hsv.v = (hsv.v * 100) | 0;\n        return hsv;\n      },\n      /**\n      * @param {module:jPicker.HSV} hsv\n      * @returns {module:jPicker.RGB}\n      */\n      hsvToRgb (hsv) {\n        const rgb = {r: 0, g: 0, b: 0, a: 100};\n        let {h, s, v} = hsv;\n        if (s === 0) {\n          if (v === 0) rgb.r = rgb.g = rgb.b = 0;\n          else rgb.r = rgb.g = rgb.b = (v * 255 / 100) | 0;\n        } else {\n          if (h === 360) h = 0;\n          h /= 60;\n          s = s / 100;\n          v = v / 100;\n          const i = h | 0,\n            f = h - i,\n            p = v * (1 - s),\n            q = v * (1 - (s * f)),\n            t = v * (1 - (s * (1 - f)));\n          switch (i) {\n          case 0:\n            rgb.r = v;\n            rgb.g = t;\n            rgb.b = p;\n            break;\n          case 1:\n            rgb.r = q;\n            rgb.g = v;\n            rgb.b = p;\n            break;\n          case 2:\n            rgb.r = p;\n            rgb.g = v;\n            rgb.b = t;\n            break;\n          case 3:\n            rgb.r = p;\n            rgb.g = q;\n            rgb.b = v;\n            break;\n          case 4:\n            rgb.r = t;\n            rgb.g = p;\n            rgb.b = v;\n            break;\n          case 5:\n            rgb.r = v;\n            rgb.g = p;\n            rgb.b = q;\n            break;\n          }\n          rgb.r = (rgb.r * 255) | 0;\n          rgb.g = (rgb.g * 255) | 0;\n          rgb.b = (rgb.b * 255) | 0;\n        }\n        return rgb;\n      }\n    }\n  };\n  const {Color, List, ColorMethods} = $.jPicker; // local copies for YUI compressor\n  /**\n   * @function external:jQuery.fn.jPicker\n   * @see {@link external:jQuery.fn.$.fn.jPicker}\n   */\n  /**\n  * While it would seem this should specify the name `jPicker` for JSDoc, that doesn't\n  *   get us treated as a function as well as a namespace (even with `@function name`),\n  *   so we use an approach to add a redundant `$.fn.` in the name.\n  * @namespace\n  * @memberof external:jQuery.fn\n  * @param {external:jQuery.fn.jPickerOptions} options\n  * @returns {external:jQuery}\n  */\n  $.fn.jPicker = function (options) {\n    const $arguments = arguments;\n    return this.each(function () {\n      const $this = this, settings = $.extend(true, {}, $.fn.jPicker.defaults, options); // local copies for YUI compressor\n      if ($($this).get(0).nodeName.toLowerCase() === 'input') { // Add color picker icon if binding to an input element and bind the events to the input\n        $.extend(true, settings, {\n          window: {\n            bindToInput: true,\n            expandable: true,\n            input: $($this)\n          }\n        });\n        if ($($this).val() === '') {\n          settings.color.active = new Color({ hex: null });\n          settings.color.current = new Color({ hex: null });\n        } else if (ColorMethods.validateHex($($this).val())) {\n          settings.color.active = new Color({ hex: $($this).val(), a: settings.color.active.val('a') });\n          settings.color.current = new Color({ hex: $($this).val(), a: settings.color.active.val('a') });\n        }\n      }\n      if (settings.window.expandable) {\n        $($this).after('<span class=\"jPicker\"><span class=\"Icon\"><span class=\"Color\">&nbsp;</span><span class=\"Alpha\">&nbsp;</span><span class=\"Image\" title=\"Click To Open Color Picker\">&nbsp;</span><span class=\"Container\">&nbsp;</span></span></span>');\n      } else {\n        settings.window.liveUpdate = false; // Basic control binding for inline use - You will need to override the liveCallback or commitCallback function to retrieve results\n      }\n      const isLessThanIE7 = parseFloat(navigator.appVersion.split('MSIE')[1]) < 7 && document.body.filters; // needed to run the AlphaImageLoader function for IE6\n      // set color mode and update visuals for the new color mode\n      /**\n       *\n       * @param {\"h\"|\"s\"|\"v\"|\"r\"|\"g\"|\"b\"|\"a\"} colorMode [description]\n       * @throws {Error} Invalid mode\n       */\n      function setColorMode (colorMode) {\n        const {active} = color, // local copies for YUI compressor\n          // {clientPath} = images,\n          hex = active.val('hex');\n        let rgbMap, rgbBar;\n        settings.color.mode = colorMode;\n        switch (colorMode) {\n        case 'h':\n          setTimeout(function () {\n            setBG.call($this, colorMapDiv, 'transparent');\n            setImgLoc.call($this, colorMapL1, 0);\n            setAlpha.call($this, colorMapL1, 100);\n            setImgLoc.call($this, colorMapL2, 260);\n            setAlpha.call($this, colorMapL2, 100);\n            setBG.call($this, colorBarDiv, 'transparent');\n            setImgLoc.call($this, colorBarL1, 0);\n            setAlpha.call($this, colorBarL1, 100);\n            setImgLoc.call($this, colorBarL2, 260);\n            setAlpha.call($this, colorBarL2, 100);\n            setImgLoc.call($this, colorBarL3, 260);\n            setAlpha.call($this, colorBarL3, 100);\n            setImgLoc.call($this, colorBarL4, 260);\n            setAlpha.call($this, colorBarL4, 100);\n            setImgLoc.call($this, colorBarL6, 260);\n            setAlpha.call($this, colorBarL6, 100);\n          }, 0);\n          colorMap.range('all', { minX: 0, maxX: 100, minY: 0, maxY: 100 });\n          colorBar.range('rangeY', { minY: 0, maxY: 360 });\n          if (active.val('ahex') == null) break;\n          colorMap.val('xy', { x: active.val('s'), y: 100 - active.val('v') }, colorMap);\n          colorBar.val('y', 360 - active.val('h'), colorBar);\n          break;\n        case 's':\n          setTimeout(function () {\n            setBG.call($this, colorMapDiv, 'transparent');\n            setImgLoc.call($this, colorMapL1, -260);\n            setImgLoc.call($this, colorMapL2, -520);\n            setImgLoc.call($this, colorBarL1, -260);\n            setImgLoc.call($this, colorBarL2, -520);\n            setImgLoc.call($this, colorBarL6, 260);\n            setAlpha.call($this, colorBarL6, 100);\n          }, 0);\n          colorMap.range('all', { minX: 0, maxX: 360, minY: 0, maxY: 100 });\n          colorBar.range('rangeY', { minY: 0, maxY: 100 });\n          if (active.val('ahex') == null) break;\n          colorMap.val('xy', { x: active.val('h'), y: 100 - active.val('v') }, colorMap);\n          colorBar.val('y', 100 - active.val('s'), colorBar);\n          break;\n        case 'v':\n          setTimeout(function () {\n            setBG.call($this, colorMapDiv, '000000');\n            setImgLoc.call($this, colorMapL1, -780);\n            setImgLoc.call($this, colorMapL2, 260);\n            setBG.call($this, colorBarDiv, hex);\n            setImgLoc.call($this, colorBarL1, -520);\n            setImgLoc.call($this, colorBarL2, 260);\n            setAlpha.call($this, colorBarL2, 100);\n            setImgLoc.call($this, colorBarL6, 260);\n            setAlpha.call($this, colorBarL6, 100);\n          }, 0);\n          colorMap.range('all', { minX: 0, maxX: 360, minY: 0, maxY: 100 });\n          colorBar.range('rangeY', { minY: 0, maxY: 100 });\n          if (active.val('ahex') == null) break;\n          colorMap.val('xy', { x: active.val('h'), y: 100 - active.val('s') }, colorMap);\n          colorBar.val('y', 100 - active.val('v'), colorBar);\n          break;\n        case 'r':\n          rgbMap = -1040;\n          rgbBar = -780;\n          colorMap.range('all', { minX: 0, maxX: 255, minY: 0, maxY: 255 });\n          colorBar.range('rangeY', { minY: 0, maxY: 255 });\n          if (active.val('ahex') == null) break;\n          colorMap.val('xy', { x: active.val('b'), y: 255 - active.val('g') }, colorMap);\n          colorBar.val('y', 255 - active.val('r'), colorBar);\n          break;\n        case 'g':\n          rgbMap = -1560;\n          rgbBar = -1820;\n          colorMap.range('all', { minX: 0, maxX: 255, minY: 0, maxY: 255 });\n          colorBar.range('rangeY', { minY: 0, maxY: 255 });\n          if (active.val('ahex') == null) break;\n          colorMap.val('xy', { x: active.val('b'), y: 255 - active.val('r') }, colorMap);\n          colorBar.val('y', 255 - active.val('g'), colorBar);\n          break;\n        case 'b':\n          rgbMap = -2080;\n          rgbBar = -2860;\n          colorMap.range('all', { minX: 0, maxX: 255, minY: 0, maxY: 255 });\n          colorBar.range('rangeY', { minY: 0, maxY: 255 });\n          if (active.val('ahex') == null) break;\n          colorMap.val('xy', { x: active.val('r'), y: 255 - active.val('g') }, colorMap);\n          colorBar.val('y', 255 - active.val('b'), colorBar);\n          break;\n        case 'a':\n          setTimeout(function () {\n            setBG.call($this, colorMapDiv, 'transparent');\n            setImgLoc.call($this, colorMapL1, -260);\n            setImgLoc.call($this, colorMapL2, -520);\n            setImgLoc.call($this, colorBarL1, 260);\n            setImgLoc.call($this, colorBarL2, 260);\n            setAlpha.call($this, colorBarL2, 100);\n            setImgLoc.call($this, colorBarL6, 0);\n            setAlpha.call($this, colorBarL6, 100);\n          }, 0);\n          colorMap.range('all', { minX: 0, maxX: 360, minY: 0, maxY: 100 });\n          colorBar.range('rangeY', { minY: 0, maxY: 255 });\n          if (active.val('ahex') == null) break;\n          colorMap.val('xy', { x: active.val('h'), y: 100 - active.val('v') }, colorMap);\n          colorBar.val('y', 255 - active.val('a'), colorBar);\n          break;\n        default:\n          throw new Error('Invalid Mode');\n        }\n        switch (colorMode) {\n        case 'h':\n          break;\n        case 's':\n        case 'v':\n        case 'a':\n          setTimeout(function () {\n            setAlpha.call($this, colorMapL1, 100);\n            setAlpha.call($this, colorBarL1, 100);\n            setImgLoc.call($this, colorBarL3, 260);\n            setAlpha.call($this, colorBarL3, 100);\n            setImgLoc.call($this, colorBarL4, 260);\n            setAlpha.call($this, colorBarL4, 100);\n          }, 0);\n          break;\n        case 'r':\n        case 'g':\n        case 'b':\n          setTimeout(function () {\n            setBG.call($this, colorMapDiv, 'transparent');\n            setBG.call($this, colorBarDiv, 'transparent');\n            setAlpha.call($this, colorBarL1, 100);\n            setAlpha.call($this, colorMapL1, 100);\n            setImgLoc.call($this, colorMapL1, rgbMap);\n            setImgLoc.call($this, colorMapL2, rgbMap - 260);\n            setImgLoc.call($this, colorBarL1, rgbBar - 780);\n            setImgLoc.call($this, colorBarL2, rgbBar - 520);\n            setImgLoc.call($this, colorBarL3, rgbBar);\n            setImgLoc.call($this, colorBarL4, rgbBar - 260);\n            setImgLoc.call($this, colorBarL6, 260);\n            setAlpha.call($this, colorBarL6, 100);\n          }, 0);\n          break;\n        }\n        if (active.val('ahex') == null) return;\n        activeColorChanged.call($this, active);\n      }\n      // Update color when user changes text values\n      function activeColorChanged (ui, context) {\n        if (context == null || (context !== colorBar && context !== colorMap)) positionMapAndBarArrows.call($this, ui, context);\n        setTimeout(function () {\n          updatePreview.call($this, ui);\n          updateMapVisuals.call($this, ui);\n          updateBarVisuals.call($this, ui);\n        }, 0);\n      }\n      // user has dragged the ColorMap pointer\n      function mapValueChanged (ui, context) {\n        const {active} = color;\n        if (context !== colorMap && active.val() == null) return;\n        const xy = ui.val('all');\n        switch (settings.color.mode) {\n        case 'h':\n          active.val('sv', { s: xy.x, v: 100 - xy.y }, context);\n          break;\n        case 's':\n        case 'a':\n          active.val('hv', { h: xy.x, v: 100 - xy.y }, context);\n          break;\n        case 'v':\n          active.val('hs', { h: xy.x, s: 100 - xy.y }, context);\n          break;\n        case 'r':\n          active.val('gb', { g: 255 - xy.y, b: xy.x }, context);\n          break;\n        case 'g':\n          active.val('rb', { r: 255 - xy.y, b: xy.x }, context);\n          break;\n        case 'b':\n          active.val('rg', { r: xy.x, g: 255 - xy.y }, context);\n          break;\n        }\n      }\n      // user has dragged the ColorBar slider\n      function colorBarValueChanged (ui, context) {\n        const {active} = color;\n        if (context !== colorBar && active.val() == null) return;\n        switch (settings.color.mode) {\n        case 'h':\n          active.val('h', { h: 360 - ui.val('y') }, context);\n          break;\n        case 's':\n          active.val('s', { s: 100 - ui.val('y') }, context);\n          break;\n        case 'v':\n          active.val('v', { v: 100 - ui.val('y') }, context);\n          break;\n        case 'r':\n          active.val('r', { r: 255 - ui.val('y') }, context);\n          break;\n        case 'g':\n          active.val('g', { g: 255 - ui.val('y') }, context);\n          break;\n        case 'b':\n          active.val('b', { b: 255 - ui.val('y') }, context);\n          break;\n        case 'a':\n          active.val('a', 255 - ui.val('y'), context);\n          break;\n        }\n      }\n      // position map and bar arrows to match current color\n      function positionMapAndBarArrows (ui, context) {\n        if (context !== colorMap) {\n          switch (settings.color.mode) {\n          case 'h':\n            const sv = ui.val('sv');\n            colorMap.val('xy', { x: sv != null ? sv.s : 100, y: 100 - (sv != null ? sv.v : 100) }, context);\n            break;\n          case 's':\n          case 'a':\n            const hv = ui.val('hv');\n            colorMap.val('xy', { x: (hv && hv.h) || 0, y: 100 - (hv != null ? hv.v : 100) }, context);\n            break;\n          case 'v':\n            const hs = ui.val('hs');\n            colorMap.val('xy', { x: (hs && hs.h) || 0, y: 100 - (hs != null ? hs.s : 100) }, context);\n            break;\n          case 'r':\n            const bg = ui.val('bg');\n            colorMap.val('xy', { x: (bg && bg.b) || 0, y: 255 - ((bg && bg.g) || 0) }, context);\n            break;\n          case 'g':\n            const br = ui.val('br');\n            colorMap.val('xy', { x: (br && br.b) || 0, y: 255 - ((br && br.r) || 0) }, context);\n            break;\n          case 'b':\n            const rg = ui.val('rg');\n            colorMap.val('xy', { x: (rg && rg.r) || 0, y: 255 - ((rg && rg.g) || 0) }, context);\n            break;\n          }\n        }\n        if (context !== colorBar) {\n          switch (settings.color.mode) {\n          case 'h':\n            colorBar.val('y', 360 - (ui.val('h') || 0), context);\n            break;\n          case 's':\n            const s = ui.val('s');\n            colorBar.val('y', 100 - (s != null ? s : 100), context);\n            break;\n          case 'v':\n            const v = ui.val('v');\n            colorBar.val('y', 100 - (v != null ? v : 100), context);\n            break;\n          case 'r':\n            colorBar.val('y', 255 - (ui.val('r') || 0), context);\n            break;\n          case 'g':\n            colorBar.val('y', 255 - (ui.val('g') || 0), context);\n            break;\n          case 'b':\n            colorBar.val('y', 255 - (ui.val('b') || 0), context);\n            break;\n          case 'a':\n            const a = ui.val('a');\n            colorBar.val('y', 255 - (a != null ? a : 255), context);\n            break;\n          }\n        }\n      }\n      function updatePreview (ui) {\n        try {\n          const all = ui.val('all');\n          activePreview.css({ backgroundColor: (all && '#' + all.hex) || 'transparent' });\n          setAlpha.call($this, activePreview, (all && Math.precision((all.a * 100) / 255, 4)) || 0);\n        } catch (e) { }\n      }\n      function updateMapVisuals (ui) {\n        switch (settings.color.mode) {\n        case 'h':\n          setBG.call($this, colorMapDiv, new Color({ h: ui.val('h') || 0, s: 100, v: 100 }).val('hex'));\n          break;\n        case 's':\n        case 'a':\n          const s = ui.val('s');\n          setAlpha.call($this, colorMapL2, 100 - (s != null ? s : 100));\n          break;\n        case 'v':\n          const v = ui.val('v');\n          setAlpha.call($this, colorMapL1, v != null ? v : 100);\n          break;\n        case 'r':\n          setAlpha.call($this, colorMapL2, Math.precision((ui.val('r') || 0) / 255 * 100, 4));\n          break;\n        case 'g':\n          setAlpha.call($this, colorMapL2, Math.precision((ui.val('g') || 0) / 255 * 100, 4));\n          break;\n        case 'b':\n          setAlpha.call($this, colorMapL2, Math.precision((ui.val('b') || 0) / 255 * 100));\n          break;\n        }\n        const a = ui.val('a');\n        setAlpha.call($this, colorMapL3, Math.precision(((255 - (a || 0)) * 100) / 255, 4));\n      }\n      function updateBarVisuals (ui) {\n        switch (settings.color.mode) {\n        case 'h':\n          const a = ui.val('a');\n          setAlpha.call($this, colorBarL5, Math.precision(((255 - (a || 0)) * 100) / 255, 4));\n          break;\n        case 's':\n          const hva = ui.val('hva'),\n            saturatedColor = new Color({ h: (hva && hva.h) || 0, s: 100, v: hva != null ? hva.v : 100 });\n          setBG.call($this, colorBarDiv, saturatedColor.val('hex'));\n          setAlpha.call($this, colorBarL2, 100 - (hva != null ? hva.v : 100));\n          setAlpha.call($this, colorBarL5, Math.precision(((255 - ((hva && hva.a) || 0)) * 100) / 255, 4));\n          break;\n        case 'v':\n          const hsa = ui.val('hsa'),\n            valueColor = new Color({ h: (hsa && hsa.h) || 0, s: hsa != null ? hsa.s : 100, v: 100 });\n          setBG.call($this, colorBarDiv, valueColor.val('hex'));\n          setAlpha.call($this, colorBarL5, Math.precision(((255 - ((hsa && hsa.a) || 0)) * 100) / 255, 4));\n          break;\n        case 'r':\n        case 'g':\n        case 'b':\n          const rgba = ui.val('rgba');\n          let hValue = 0, vValue = 0;\n          if (settings.color.mode === 'r') {\n            hValue = (rgba && rgba.b) || 0;\n            vValue = (rgba && rgba.g) || 0;\n          } else if (settings.color.mode === 'g') {\n            hValue = (rgba && rgba.b) || 0;\n            vValue = (rgba && rgba.r) || 0;\n          } else if (settings.color.mode === 'b') {\n            hValue = (rgba && rgba.r) || 0;\n            vValue = (rgba && rgba.g) || 0;\n          }\n          const middle = vValue > hValue ? hValue : vValue;\n          setAlpha.call($this, colorBarL2, hValue > vValue ? Math.precision(((hValue - vValue) / (255 - vValue)) * 100, 4) : 0);\n          setAlpha.call($this, colorBarL3, vValue > hValue ? Math.precision(((vValue - hValue) / (255 - hValue)) * 100, 4) : 0);\n          setAlpha.call($this, colorBarL4, Math.precision((middle / 255) * 100, 4));\n          setAlpha.call($this, colorBarL5, Math.precision(((255 - ((rgba && rgba.a) || 0)) * 100) / 255, 4));\n          break;\n        case 'a': {\n          const a = ui.val('a');\n          setBG.call($this, colorBarDiv, ui.val('hex') || '000000');\n          setAlpha.call($this, colorBarL5, a != null ? 0 : 100);\n          setAlpha.call($this, colorBarL6, a != null ? 100 : 0);\n          break;\n        }\n        }\n      }\n      function setBG (el, c) {\n        el.css({backgroundColor: (c && c.length === 6 && '#' + c) || 'transparent'});\n      }\n      function setImg (img, src) {\n        if (isLessThanIE7 && (src.includes('AlphaBar.png') || src.includes('Bars.png') || src.includes('Maps.png'))) {\n          img.attr('pngSrc', src);\n          img.css({ backgroundImage: 'none', filter: 'progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\\'' + src + '\\', sizingMethod=\\'scale\\')' });\n        } else img.css({ backgroundImage: 'url(\\'' + src + '\\')' });\n      }\n      function setImgLoc (img, y) {\n        img.css({ top: y + 'px' });\n      }\n      function setAlpha (obj, alpha) {\n        obj.css({ visibility: alpha > 0 ? 'visible' : 'hidden' });\n        if (alpha > 0 && alpha < 100) {\n          if (isLessThanIE7) {\n            const src = obj.attr('pngSrc');\n            if (src != null && (\n              src.includes('AlphaBar.png') || src.includes('Bars.png') || src.includes('Maps.png')\n            )) {\n              obj.css({ filter: 'progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\\'' + src + '\\', sizingMethod=\\'scale\\') progid:DXImageTransform.Microsoft.Alpha(opacity=' + alpha + ')' });\n            } else obj.css({ opacity: Math.precision(alpha / 100, 4) });\n          } else obj.css({ opacity: Math.precision(alpha / 100, 4) });\n        } else if (alpha === 0 || alpha === 100) {\n          if (isLessThanIE7) {\n            const src = obj.attr('pngSrc');\n            if (src != null && (\n              src.includes('AlphaBar.png') || src.includes('Bars.png') || src.includes('Maps.png')\n            )) {\n              obj.css({ filter: 'progid:DXImageTransform.Microsoft.AlphaImageLoader(src=\\'' + src + '\\', sizingMethod=\\'scale\\')' });\n            } else obj.css({ opacity: '' });\n          } else obj.css({ opacity: '' });\n        }\n      }\n      // revert color to original color when opened\n      function revertColor () {\n        color.active.val('ahex', color.current.val('ahex'));\n      }\n      // commit the color changes\n      function commitColor () {\n        color.current.val('ahex', color.active.val('ahex'));\n      }\n      function radioClicked (e) {\n        $(this).parents('tbody:first').find('input:radio[value!=\"' + e.target.value + '\"]').removeAttr('checked');\n        setColorMode.call($this, e.target.value);\n      }\n      function currentClicked () {\n        revertColor.call($this);\n      }\n      function cancelClicked () {\n        revertColor.call($this);\n        settings.window.expandable && hide.call($this);\n        typeof cancelCallback === 'function' && cancelCallback.call($this, color.active, cancelButton);\n      }\n      function okClicked () {\n        commitColor.call($this);\n        settings.window.expandable && hide.call($this);\n        typeof commitCallback === 'function' && commitCallback.call($this, color.active, okButton);\n      }\n      function iconImageClicked () {\n        show.call($this);\n      }\n      function currentColorChanged (ui, context) {\n        const hex = ui.val('hex');\n        currentPreview.css({ backgroundColor: (hex && '#' + hex) || 'transparent' });\n        setAlpha.call($this, currentPreview, Math.precision(((ui.val('a') || 0) * 100) / 255, 4));\n      }\n      function expandableColorChanged (ui, context) {\n        const hex = ui.val('hex');\n        const va = ui.val('va');\n        iconColor.css({ backgroundColor: (hex && '#' + hex) || 'transparent' });\n        setAlpha.call($this, iconAlpha, Math.precision(((255 - ((va && va.a) || 0)) * 100) / 255, 4));\n        if (settings.window.bindToInput && settings.window.updateInputColor) {\n          settings.window.input.css({\n            backgroundColor: (hex && '#' + hex) || 'transparent',\n            color: va == null || va.v > 75 ? '#000000' : '#ffffff'\n          });\n        }\n      }\n      function moveBarMouseDown (e) {\n        // const {element} = settings.window, // local copies for YUI compressor\n        //     {page} = settings.window;\n        elementStartX = parseInt(container.css('left'));\n        elementStartY = parseInt(container.css('top'));\n        pageStartX = e.pageX;\n        pageStartY = e.pageY;\n        // bind events to document to move window - we will unbind these on mouseup\n        $(document).bind('mousemove', documentMouseMove).bind('mouseup', documentMouseUp);\n        e.preventDefault(); // prevent attempted dragging of the column\n      }\n      function documentMouseMove (e) {\n        container.css({ left: elementStartX - (pageStartX - e.pageX) + 'px', top: elementStartY - (pageStartY - e.pageY) + 'px' });\n        if (settings.window.expandable && !$.support.boxModel) container.prev().css({ left: container.css('left'), top: container.css('top') });\n        e.stopPropagation();\n        e.preventDefault();\n        return false;\n      }\n      function documentMouseUp (e) {\n        $(document).unbind('mousemove', documentMouseMove).unbind('mouseup', documentMouseUp);\n        e.stopPropagation();\n        e.preventDefault();\n        return false;\n      }\n      function quickPickClicked (e) {\n        e.preventDefault();\n        e.stopPropagation();\n        color.active.val('ahex', $(this).attr('title') || null, e.target);\n        return false;\n      }\n      function show () {\n        color.current.val('ahex', color.active.val('ahex'));\n        function attachIFrame () {\n          if (!settings.window.expandable || $.support.boxModel) return;\n          const table = container.find('table:first');\n          container.before('<iframe/>');\n          container.prev().css({width: table.width(), height: container.height(), opacity: 0, position: 'absolute', left: container.css('left'), top: container.css('top')});\n        }\n        if (settings.window.expandable) {\n          $(document.body).children('div.jPicker.Container').css({zIndex: 10});\n          container.css({zIndex: 20});\n        }\n        switch (settings.window.effects.type) {\n        case 'fade':\n          container.fadeIn(settings.window.effects.speed.show, attachIFrame);\n          break;\n        case 'slide':\n          container.slideDown(settings.window.effects.speed.show, attachIFrame);\n          break;\n        case 'show':\n        default:\n          container.show(settings.window.effects.speed.show, attachIFrame);\n          break;\n        }\n      }\n      function hide () {\n        function removeIFrame () {\n          if (settings.window.expandable) container.css({ zIndex: 10 });\n          if (!settings.window.expandable || $.support.boxModel) return;\n          container.prev().remove();\n        }\n        switch (settings.window.effects.type) {\n        case 'fade':\n          container.fadeOut(settings.window.effects.speed.hide, removeIFrame);\n          break;\n        case 'slide':\n          container.slideUp(settings.window.effects.speed.hide, removeIFrame);\n          break;\n        case 'show':\n        default:\n          container.hide(settings.window.effects.speed.hide, removeIFrame);\n          break;\n        }\n      }\n      function initialize () {\n        const win = settings.window,\n          popup = win.expandable ? $($this).next().find('.Container:first') : null;\n        container = win.expandable ? $('<div/>') : $($this);\n        container.addClass('jPicker Container');\n        if (win.expandable) container.hide();\n        container.get(0).onselectstart = function (event) { if (event.target.nodeName.toLowerCase() !== 'input') return false; };\n        // inject html source code - we are using a single table for this control - I know tables are considered bad, but it takes care of equal height columns and\n        // this control really is tabular data, so I believe it is the right move\n        const all = color.active.val('all');\n        if (win.alphaPrecision < 0) win.alphaPrecision = 0;\n        else if (win.alphaPrecision > 2) win.alphaPrecision = 2;\n        const controlHtml = '<table class=\"jPicker\" cellpadding=\"0\" cellspacing=\"0\"><tbody>' + (win.expandable ? '<tr><td class=\"Move\" colspan=\"5\">&nbsp;</td></tr>' : '') + '<tr><td rowspan=\"9\"><h2 class=\"Title\">' + (win.title || localization.text.title) + '</h2><div class=\"Map\"><span class=\"Map1\">&nbsp;</span><span class=\"Map2\">&nbsp;</span><span class=\"Map3\">&nbsp;</span><img src=\"' + images.clientPath + images.colorMap.arrow.file + '\" class=\"Arrow\"/></div></td><td rowspan=\"9\"><div class=\"Bar\"><span class=\"Map1\">&nbsp;</span><span class=\"Map2\">&nbsp;</span><span class=\"Map3\">&nbsp;</span><span class=\"Map4\">&nbsp;</span><span class=\"Map5\">&nbsp;</span><span class=\"Map6\">&nbsp;</span><img src=\"' + images.clientPath + images.colorBar.arrow.file + '\" class=\"Arrow\"/></div></td><td colspan=\"2\" class=\"Preview\">' + localization.text.newColor + '<div><span class=\"Active\" title=\"' + localization.tooltips.colors.newColor + '\">&nbsp;</span><span class=\"Current\" title=\"' + localization.tooltips.colors.currentColor + '\">&nbsp;</span></div>' + localization.text.currentColor + '</td><td rowspan=\"9\" class=\"Button\"><input type=\"button\" class=\"Ok\" value=\"' + localization.text.ok + '\" title=\"' + localization.tooltips.buttons.ok + '\"/><input type=\"button\" class=\"Cancel\" value=\"' + localization.text.cancel + '\" title=\"' + localization.tooltips.buttons.cancel + '\"/><hr/><div class=\"Grid\">&nbsp;</div></td></tr><tr class=\"Hue\"><td class=\"Radio\"><label title=\"' + localization.tooltips.hue.radio + '\"><input type=\"radio\" value=\"h\"' + (settings.color.mode === 'h' ? ' checked=\"checked\"' : '') + '/>H:</label></td><td class=\"Text\"><input type=\"text\" maxlength=\"3\" value=\"' + (all != null ? all.h : '') + '\" title=\"' + localization.tooltips.hue.textbox + '\"/>&nbsp;&deg;</td></tr><tr class=\"Saturation\"><td class=\"Radio\"><label title=\"' + localization.tooltips.saturation.radio + '\"><input type=\"radio\" value=\"s\"' + (settings.color.mode === 's' ? ' checked=\"checked\"' : '') + '/>S:</label></td><td class=\"Text\"><input type=\"text\" maxlength=\"3\" value=\"' + (all != null ? all.s : '') + '\" title=\"' + localization.tooltips.saturation.textbox + '\"/>&nbsp;%</td></tr><tr class=\"Value\"><td class=\"Radio\"><label title=\"' + localization.tooltips.value.radio + '\"><input type=\"radio\" value=\"v\"' + (settings.color.mode === 'v' ? ' checked=\"checked\"' : '') + '/>V:</label><br/><br/></td><td class=\"Text\"><input type=\"text\" maxlength=\"3\" value=\"' + (all != null ? all.v : '') + '\" title=\"' + localization.tooltips.value.textbox + '\"/>&nbsp;%<br/><br/></td></tr><tr class=\"Red\"><td class=\"Radio\"><label title=\"' + localization.tooltips.red.radio + '\"><input type=\"radio\" value=\"r\"' + (settings.color.mode === 'r' ? ' checked=\"checked\"' : '') + '/>R:</label></td><td class=\"Text\"><input type=\"text\" maxlength=\"3\" value=\"' + (all != null ? all.r : '') + '\" title=\"' + localization.tooltips.red.textbox + '\"/></td></tr><tr class=\"Green\"><td class=\"Radio\"><label title=\"' + localization.tooltips.green.radio + '\"><input type=\"radio\" value=\"g\"' + (settings.color.mode === 'g' ? ' checked=\"checked\"' : '') + '/>G:</label></td><td class=\"Text\"><input type=\"text\" maxlength=\"3\" value=\"' + (all != null ? all.g : '') + '\" title=\"' + localization.tooltips.green.textbox + '\"/></td></tr><tr class=\"Blue\"><td class=\"Radio\"><label title=\"' + localization.tooltips.blue.radio + '\"><input type=\"radio\" value=\"b\"' + (settings.color.mode === 'b' ? ' checked=\"checked\"' : '') + '/>B:</label></td><td class=\"Text\"><input type=\"text\" maxlength=\"3\" value=\"' + (all != null ? all.b : '') + '\" title=\"' + localization.tooltips.blue.textbox + '\"/></td></tr><tr class=\"Alpha\"><td class=\"Radio\">' + (win.alphaSupport ? '<label title=\"' + localization.tooltips.alpha.radio + '\"><input type=\"radio\" value=\"a\"' + (settings.color.mode === 'a' ? ' checked=\"checked\"' : '') + '/>A:</label>' : '&nbsp;') + '</td><td class=\"Text\">' + (win.alphaSupport ? '<input type=\"text\" maxlength=\"' + (3 + win.alphaPrecision) + '\" value=\"' + (all != null ? Math.precision((all.a * 100) / 255, win.alphaPrecision) : '') + '\" title=\"' + localization.tooltips.alpha.textbox + '\"/>&nbsp;%' : '&nbsp;') + '</td></tr><tr class=\"Hex\"><td colspan=\"2\" class=\"Text\"><label title=\"' + localization.tooltips.hex.textbox + '\">#:<input type=\"text\" maxlength=\"6\" class=\"Hex\" value=\"' + (all != null ? all.hex : '') + '\"/></label>' + (win.alphaSupport ? '<input type=\"text\" maxlength=\"2\" class=\"AHex\" value=\"' + (all != null ? all.ahex.substring(6) : '') + '\" title=\"' + localization.tooltips.hex.alpha + '\"/></td>' : '&nbsp;') + '</tr></tbody></table>';\n        if (win.expandable) {\n          container.html(controlHtml);\n          if (!$(document.body).children('div.jPicker.Container').length) {\n            $(document.body).prepend(container);\n          } else {\n            $(document.body).children('div.jPicker.Container:last').after(container);\n          }\n          container.mousedown(\n            function () {\n              $(document.body).children('div.jPicker.Container').css({zIndex: 10});\n              container.css({zIndex: 20});\n            });\n          container.css( // positions must be set and display set to absolute before source code injection or IE will size the container to fit the window\n            {\n              left:\n                win.position.x === 'left'\n                  ? (popup.offset().left - 530 - (win.position.y === 'center' ? 25 : 0)) + 'px'\n                  : win.position.x === 'center'\n                    ? (popup.offset().left - 260) + 'px'\n                    : win.position.x === 'right'\n                      ? (popup.offset().left - 10 + (win.position.y === 'center' ? 25 : 0)) + 'px'\n                      : win.position.x === 'screenCenter'\n                        ? (($(document).width() >> 1) - 260) + 'px'\n                        : (popup.offset().left + parseInt(win.position.x)) + 'px',\n              position: 'absolute',\n              top: win.position.y === 'top'\n                ? (popup.offset().top - 312) + 'px'\n                : win.position.y === 'center'\n                  ? (popup.offset().top - 156) + 'px'\n                  : win.position.y === 'bottom'\n                    ? (popup.offset().top + 25) + 'px'\n                    : (popup.offset().top + parseInt(win.position.y)) + 'px'\n            });\n        } else {\n          container = $($this);\n          container.html(controlHtml);\n        }\n        // initialize the objects to the source code just injected\n        const tbody = container.find('tbody:first');\n        colorMapDiv = tbody.find('div.Map:first');\n        colorBarDiv = tbody.find('div.Bar:first');\n        const MapMaps = colorMapDiv.find('span');\n        const BarMaps = colorBarDiv.find('span');\n        colorMapL1 = MapMaps.filter('.Map1:first');\n        colorMapL2 = MapMaps.filter('.Map2:first');\n        colorMapL3 = MapMaps.filter('.Map3:first');\n        colorBarL1 = BarMaps.filter('.Map1:first');\n        colorBarL2 = BarMaps.filter('.Map2:first');\n        colorBarL3 = BarMaps.filter('.Map3:first');\n        colorBarL4 = BarMaps.filter('.Map4:first');\n        colorBarL5 = BarMaps.filter('.Map5:first');\n        colorBarL6 = BarMaps.filter('.Map6:first');\n        // create color pickers and maps\n        colorMap = new Slider(colorMapDiv,\n          {\n            map: {\n              width: images.colorMap.width,\n              height: images.colorMap.height\n            },\n            arrow: {\n              image: images.clientPath + images.colorMap.arrow.file,\n              width: images.colorMap.arrow.width,\n              height: images.colorMap.arrow.height\n            }\n          }\n        );\n        colorMap.bind(mapValueChanged);\n        colorBar = new Slider(colorBarDiv,\n          {\n            map: {\n              width: images.colorBar.width,\n              height: images.colorBar.height\n            },\n            arrow: {\n              image: images.clientPath + images.colorBar.arrow.file,\n              width: images.colorBar.arrow.width,\n              height: images.colorBar.arrow.height\n            }\n          }\n        );\n        colorBar.bind(colorBarValueChanged);\n        colorPicker = new ColorValuePicker(\n          tbody,\n          color.active,\n          win.expandable && win.bindToInput ? win.input : null, win.alphaPrecision\n        );\n        const hex = all != null ? all.hex : null,\n          preview = tbody.find('.Preview'),\n          button = tbody.find('.Button');\n        activePreview = preview.find('.Active:first').css({ backgroundColor: (hex && '#' + hex) || 'transparent' });\n        currentPreview = preview.find('.Current:first').css({ backgroundColor: (hex && '#' + hex) || 'transparent' }).bind('click', currentClicked);\n        setAlpha.call($this, currentPreview, Math.precision(color.current.val('a') * 100) / 255, 4);\n        okButton = button.find('.Ok:first').bind('click', okClicked);\n        cancelButton = button.find('.Cancel:first').bind('click', cancelClicked);\n        grid = button.find('.Grid:first');\n        setTimeout(function () {\n          setImg.call($this, colorMapL1, images.clientPath + 'Maps.png');\n          setImg.call($this, colorMapL2, images.clientPath + 'Maps.png');\n          setImg.call($this, colorMapL3, images.clientPath + 'map-opacity.png');\n          setImg.call($this, colorBarL1, images.clientPath + 'Bars.png');\n          setImg.call($this, colorBarL2, images.clientPath + 'Bars.png');\n          setImg.call($this, colorBarL3, images.clientPath + 'Bars.png');\n          setImg.call($this, colorBarL4, images.clientPath + 'Bars.png');\n          setImg.call($this, colorBarL5, images.clientPath + 'bar-opacity.png');\n          setImg.call($this, colorBarL6, images.clientPath + 'AlphaBar.png');\n          setImg.call($this, preview.find('div:first'), images.clientPath + 'preview-opacity.png');\n        }, 0);\n        tbody.find('td.Radio input').bind('click', radioClicked);\n        // initialize quick list\n        if (color.quickList && color.quickList.length > 0) {\n          let html = '';\n          for (let i = 0; i < color.quickList.length; i++) {\n            /* if default colors are hex strings, change them to color objects */\n            if ((typeof (color.quickList[i])).toString().toLowerCase() === 'string') color.quickList[i] = new Color({ hex: color.quickList[i] });\n            const alpha = color.quickList[i].val('a');\n            let ahex = color.quickList[i].val('ahex');\n            if (!win.alphaSupport && ahex) ahex = ahex.substring(0, 6) + 'ff';\n            const quickHex = color.quickList[i].val('hex');\n            if (!ahex) ahex = '00000000';\n            html += '<span class=\"QuickColor\"' + ((ahex && ' title=\"#' + ahex + '\"') || 'none') + ' style=\"background-color:' + ((quickHex && '#' + quickHex) || '') + ';' + (quickHex ? '' : 'background-image:url(' + images.clientPath + 'NoColor.png)') + (win.alphaSupport && alpha && alpha < 255 ? ';opacity:' + Math.precision(alpha / 255, 4) + ';filter:Alpha(opacity=' + Math.precision(alpha / 2.55, 4) + ')' : '') + '\">&nbsp;</span>';\n          }\n          setImg.call($this, grid, images.clientPath + 'bar-opacity.png');\n          grid.html(html);\n          grid.find('.QuickColor').click(quickPickClicked);\n        }\n        setColorMode.call($this, settings.color.mode);\n        color.active.bind(activeColorChanged);\n        typeof liveCallback === 'function' && color.active.bind(liveCallback);\n        color.current.bind(currentColorChanged);\n        // bind to input\n        if (win.expandable) {\n          $this.icon = popup.parents('.Icon:first');\n          iconColor = $this.icon.find('.Color:first').css({ backgroundColor: (hex && '#' + hex) || 'transparent' });\n          iconAlpha = $this.icon.find('.Alpha:first');\n          setImg.call($this, iconAlpha, images.clientPath + 'bar-opacity.png');\n          setAlpha.call($this, iconAlpha, Math.precision(((255 - (all != null ? all.a : 0)) * 100) / 255, 4));\n          iconImage = $this.icon.find('.Image:first').css({\n            backgroundImage: 'url(\\'' + images.clientPath + images.picker.file + '\\')'\n          }).bind('click', iconImageClicked);\n          if (win.bindToInput && win.updateInputColor) {\n            win.input.css({\n              backgroundColor: (hex && '#' + hex) || 'transparent',\n              color: all == null || all.v > 75 ? '#000000' : '#ffffff'\n            });\n          }\n          moveBar = tbody.find('.Move:first').bind('mousedown', moveBarMouseDown);\n          color.active.bind(expandableColorChanged);\n        } else show.call($this);\n      }\n      function destroy () {\n        container.find('td.Radio input').unbind('click', radioClicked);\n        currentPreview.unbind('click', currentClicked);\n        cancelButton.unbind('click', cancelClicked);\n        okButton.unbind('click', okClicked);\n        if (settings.window.expandable) {\n          iconImage.unbind('click', iconImageClicked);\n          moveBar.unbind('mousedown', moveBarMouseDown);\n          $this.icon = null;\n        }\n        container.find('.QuickColor').unbind('click', quickPickClicked);\n        colorMapDiv = null;\n        colorBarDiv = null;\n        colorMapL1 = null;\n        colorMapL2 = null;\n        colorMapL3 = null;\n        colorBarL1 = null;\n        colorBarL2 = null;\n        colorBarL3 = null;\n        colorBarL4 = null;\n        colorBarL5 = null;\n        colorBarL6 = null;\n        colorMap.destroy();\n        colorMap = null;\n        colorBar.destroy();\n        colorBar = null;\n        colorPicker.destroy();\n        colorPicker = null;\n        activePreview = null;\n        currentPreview = null;\n        okButton = null;\n        cancelButton = null;\n        grid = null;\n        commitCallback = null;\n        cancelCallback = null;\n        liveCallback = null;\n        container.html('');\n        for (let i = 0; i < List.length; i++) {\n          if (List[i] === $this) {\n            List.splice(i, 1);\n          }\n        }\n      }\n      const {images, localization} = settings; // local copies for YUI compressor\n      const color = {\n        active: (typeof settings.color.active).toString().toLowerCase() === 'string'\n          ? new Color({ahex: !settings.window.alphaSupport && settings.color.active\n            ? settings.color.active.substring(0, 6) + 'ff'\n            : settings.color.active\n          })\n          : new Color({ahex: !settings.window.alphaSupport &&\n              settings.color.active.val('ahex')\n            ? settings.color.active.val('ahex').substring(0, 6) + 'ff'\n            : settings.color.active.val('ahex')\n          }),\n        current: (typeof settings.color.active).toString().toLowerCase() === 'string'\n          ? new Color({ahex: !settings.window.alphaSupport && settings.color.active\n            ? settings.color.active.substring(0, 6) + 'ff'\n            : settings.color.active})\n          : new Color({ahex: !settings.window.alphaSupport &&\n              settings.color.active.val('ahex')\n            ? settings.color.active.val('ahex').substring(0, 6) + 'ff'\n            : settings.color.active.val('ahex')\n          }),\n        quickList: settings.color.quickList\n      };\n\n      let elementStartX = null, // Used to record the starting css positions for dragging the control\n        elementStartY = null,\n        pageStartX = null, // Used to record the mousedown coordinates for dragging the control\n        pageStartY = null,\n        container = null,\n        colorMapDiv = null,\n        colorBarDiv = null,\n        colorMapL1 = null, // different layers of colorMap and colorBar\n        colorMapL2 = null,\n        colorMapL3 = null,\n        colorBarL1 = null,\n        colorBarL2 = null,\n        colorBarL3 = null,\n        colorBarL4 = null,\n        colorBarL5 = null,\n        colorBarL6 = null,\n        colorMap = null, // color maps\n        colorBar = null,\n        colorPicker = null,\n        activePreview = null, // color boxes above the radio buttons\n        currentPreview = null,\n        okButton = null,\n        cancelButton = null,\n        grid = null, // preset colors grid\n        iconColor = null, // iconColor for popup icon\n        iconAlpha = null, // iconAlpha for popup icon\n        iconImage = null, // iconImage popup icon\n        moveBar = null, // drag bar\n        commitCallback = typeof $arguments[1] === 'function' ? $arguments[1] : null,\n        liveCallback = typeof $arguments[2] === 'function' ? $arguments[2] : null,\n        cancelCallback = typeof $arguments[3] === 'function' ? $arguments[3] : null;\n\n      $.extend(true, $this, {\n        // public properties, methods, and callbacks\n        commitCallback, // commitCallback function can be overridden to return the selected color to a method you specify when the user clicks \"OK\"\n        liveCallback, // liveCallback function can be overridden to return the selected color to a method you specify in live mode (continuous update)\n        cancelCallback, // cancelCallback function can be overridden to a method you specify when the user clicks \"Cancel\"\n        color,\n        show,\n        hide,\n        destroy // destroys this control entirely, removing all events and objects, and removing itself from the List\n      });\n      List.push($this);\n      setTimeout(function () {\n        initialize.call($this);\n      }, 0);\n    });\n  };\n  /**\n  * @typedef {PlainObject} external:jQuery.fn.jPickerOptionsIconInfo\n  * @property {string} file Color Map/Color Bar/Color Picker arrow icon\n  * @property {Float} width\n  * @property {Float} height\n  */\n  /**\n  * @typedef {PlainObject} external:jQuery.fn.jPickerOptionsImagesDimensionsArrow\n  * @property {Float} width\n  * @property {Float} height\n  * @property {external:jQuery.fn.jPickerOptionsIconInfo} arrow\n  */\n  /**\n  * @typedef {PlainObject} external:jQuery.fn.jPickerOptionsRadioTextboxLocale\n  * @property {string} radio\n  * @property {string} textbox\n  */\n  /**\n  * @typedef {PlainObject} external:jQuery.fn.jPickerOptions\n  * @property {PlainObject} window\n  * @property {string|null} window.title Any title for the jPicker window itself - displays\n  * \"Drag Markers To Pick A Color\" if left null\n  * @property {PlainObject} window.effects\n  * @property {\"slide\"|\"show\"|\"fade\"} window.effects.type Effect used to show/hide an expandable picker\n  * @property {PlainObject} window.effects.speed\n  * @property {\"fast\"|\"slow\"|Float} window.effects.speed.show Duration of \"show\" effect. Time in milliseconds.\n  * @property {\"fast\"|\"slow\"|Float} window.effects.speed.hide Duration of \"hide\" effect. Time in milliseconds\n  * @property {PlainObject} window.position\n  * @property {\"left\"|\"center\"|\"right\"|\"screenCenter\"|Float} window.position.x Relative px value\n  * @property {\"top\"|\"bottom\"|\"center\"|Float} window.position.y Relative px value\n  * @property {boolean} window.expandable Defaults to large static picker - set to `true` to make an expandable\n  * picker (small icon with popup) - set automatically when binded to input element\n  * @property {boolean} window.liveUpdate Set `false` if you want the user to have to click \"OK\" before the\n  * binded input box updates values (always `true` for expandable picker)\n  * @property {boolean} window.alphaSupport Set to `true` to enable alpha picking\n  * @property {Float} window.alphaPrecision Set decimal precision for alpha percentage display - hex codes do\n  * not map directly to percentage integers - range 0-2\n  * @property {boolean} window.updateInputColor Set to `false` to prevent binded input colors from changing\n  * @property {PlainObject} color\n  * @property {\"h\"|\"s\"|\"v\"|\"r\"|\"g\"|\"b\"|\"a\"} color.mode Symbols stand for \"h\" (hue), \"s\" (saturation), \"v\" (value), \"r\" (red), \"g\" (green), \"b\" (blue), \"a\" (alpha)\n  * @property {Color|string} color.active Strings are HEX values (e.g. #ffc000) WITH OR WITHOUT the \"#\" prefix\n  * @property {Color[]|string[]} color.quickList The quick pick color list\n  * Strings are HEX values (e.g. #ffc000) WITH OR WITHOUT the \"#\" prefix\n  * @property {PlainObject} images\n  * @property {string} images.clientPath Path to image files\n  * @property {external:jQuery.fn.jPickerOptionsImagesDimensionsArrow} images.colorMap\n  * @property {external:jQuery.fn.jPickerOptionsImagesDimensionsArrow} images.colorBar\n  * @property {external:jQuery.fn.jPickerOptionsIconInfo} images.picker\n  * @property {PlainObject} localization alter these to change the text presented by the picker (e.g. different language)\n  * @property {PlainObject} localization.text\n  * @property {string} localization.text.title\n  * @property {string} localization.text.newColor\n  * @property {string} localization.text.currentColor\n  * @property {string} localization.text.ok\n  * @property {string} localization.text.cancel\n  * @property {PlainObject} localization.tooltips\n  * @property {PlainObject} localization.tooltips.colors\n  * @property {string} localization.tooltips.colors.newColor\n  * @property {string} localization.tooltips.colors.currentColor\n  * @property {PlainObject} localization.tooltips.buttons\n  * @property {string} localization.tooltips.buttons.ok\n  * @property {string} localization.tooltips.buttons.cancel\n  * @property {external:jQuery.fn.jPickerOptionsRadioTextboxLocale} localization.tooltips.hue\n  * @property {external:jQuery.fn.jPickerOptionsRadioTextboxLocale} localization.tooltips.saturation\n  * @property {external:jQuery.fn.jPickerOptionsRadioTextboxLocale} localization.tooltips.value\n  * @property {external:jQuery.fn.jPickerOptionsRadioTextboxLocale} localization.tooltips.red\n  * @property {external:jQuery.fn.jPickerOptionsRadioTextboxLocale} localization.tooltips.green\n  * @property {external:jQuery.fn.jPickerOptionsRadioTextboxLocale} localization.tooltips.blue\n  * @property {external:jQuery.fn.jPickerOptionsRadioTextboxLocale} localization.tooltips.alpha\n  * @property {PlainObject} localization.tooltips.hex\n  * @property {string} localization.tooltips.hex.textbox\n  * @property {string} localization.tooltips.hex.alpha\n  */\n  /**\n  * jPicker defaults - you can change anything in this section (such as the\n  * clientPath to your images) without fear of breaking the program\n  * @namespace {external:jQuery.fn.jPickerOptions} defaults\n  * @memberof external:jQuery.fn.$.fn.jPicker\n  * @borrows external:jQuery.fn.jPickerOptions as external:jQuery.fn.jPicker.defaults\n  * @see Source for all of the values\n  */\n  $.fn.jPicker.defaults = {\n    window: {\n      title: null,\n      effects: {\n        type: 'slide',\n        speed: {\n          show: 'slow',\n          hide: 'fast'\n        }\n      },\n      position: {\n        x: 'screenCenter',\n        y: 'top'\n      },\n      expandable: false,\n      liveUpdate: true,\n      alphaSupport: false,\n      alphaPrecision: 0,\n      updateInputColor: true\n    },\n    color: {\n      mode: 'h',\n      active: new Color({ahex: '#ffcc00ff'}),\n      quickList: [\n        new Color({ h: 360, s: 33, v: 100 }),\n        new Color({ h: 360, s: 66, v: 100 }),\n        new Color({ h: 360, s: 100, v: 100 }),\n        new Color({ h: 360, s: 100, v: 75 }),\n        new Color({ h: 360, s: 100, v: 50 }),\n        new Color({ h: 180, s: 0, v: 100 }),\n        new Color({ h: 30, s: 33, v: 100 }),\n        new Color({ h: 30, s: 66, v: 100 }),\n        new Color({ h: 30, s: 100, v: 100 }),\n        new Color({ h: 30, s: 100, v: 75 }),\n        new Color({ h: 30, s: 100, v: 50 }),\n        new Color({ h: 180, s: 0, v: 90 }),\n        new Color({ h: 60, s: 33, v: 100 }),\n        new Color({ h: 60, s: 66, v: 100 }),\n        new Color({ h: 60, s: 100, v: 100 }),\n        new Color({ h: 60, s: 100, v: 75 }),\n        new Color({ h: 60, s: 100, v: 50 }),\n        new Color({ h: 180, s: 0, v: 80 }),\n        new Color({ h: 90, s: 33, v: 100 }),\n        new Color({ h: 90, s: 66, v: 100 }),\n        new Color({ h: 90, s: 100, v: 100 }),\n        new Color({ h: 90, s: 100, v: 75 }),\n        new Color({ h: 90, s: 100, v: 50 }),\n        new Color({ h: 180, s: 0, v: 70 }),\n        new Color({ h: 120, s: 33, v: 100 }),\n        new Color({ h: 120, s: 66, v: 100 }),\n        new Color({ h: 120, s: 100, v: 100 }),\n        new Color({ h: 120, s: 100, v: 75 }),\n        new Color({ h: 120, s: 100, v: 50 }),\n        new Color({ h: 180, s: 0, v: 60 }),\n        new Color({ h: 150, s: 33, v: 100 }),\n        new Color({ h: 150, s: 66, v: 100 }),\n        new Color({ h: 150, s: 100, v: 100 }),\n        new Color({ h: 150, s: 100, v: 75 }),\n        new Color({ h: 150, s: 100, v: 50 }),\n        new Color({ h: 180, s: 0, v: 50 }),\n        new Color({ h: 180, s: 33, v: 100 }),\n        new Color({ h: 180, s: 66, v: 100 }),\n        new Color({ h: 180, s: 100, v: 100 }),\n        new Color({ h: 180, s: 100, v: 75 }),\n        new Color({ h: 180, s: 100, v: 50 }),\n        new Color({ h: 180, s: 0, v: 40 }),\n        new Color({ h: 210, s: 33, v: 100 }),\n        new Color({ h: 210, s: 66, v: 100 }),\n        new Color({ h: 210, s: 100, v: 100 }),\n        new Color({ h: 210, s: 100, v: 75 }),\n        new Color({ h: 210, s: 100, v: 50 }),\n        new Color({ h: 180, s: 0, v: 30 }),\n        new Color({ h: 240, s: 33, v: 100 }),\n        new Color({ h: 240, s: 66, v: 100 }),\n        new Color({ h: 240, s: 100, v: 100 }),\n        new Color({ h: 240, s: 100, v: 75 }),\n        new Color({ h: 240, s: 100, v: 50 }),\n        new Color({ h: 180, s: 0, v: 20 }),\n        new Color({ h: 270, s: 33, v: 100 }),\n        new Color({ h: 270, s: 66, v: 100 }),\n        new Color({ h: 270, s: 100, v: 100 }),\n        new Color({ h: 270, s: 100, v: 75 }),\n        new Color({ h: 270, s: 100, v: 50 }),\n        new Color({ h: 180, s: 0, v: 10 }),\n        new Color({ h: 300, s: 33, v: 100 }),\n        new Color({ h: 300, s: 66, v: 100 }),\n        new Color({ h: 300, s: 100, v: 100 }),\n        new Color({ h: 300, s: 100, v: 75 }),\n        new Color({ h: 300, s: 100, v: 50 }),\n        new Color({ h: 180, s: 0, v: 0 }),\n        new Color({ h: 330, s: 33, v: 100 }),\n        new Color({ h: 330, s: 66, v: 100 }),\n        new Color({ h: 330, s: 100, v: 100 }),\n        new Color({ h: 330, s: 100, v: 75 }),\n        new Color({ h: 330, s: 100, v: 50 }),\n        new Color()\n      ]\n    },\n    images: {\n      clientPath: '/jPicker/images/',\n      colorMap: {\n        width: 256,\n        height: 256,\n        arrow: {\n          file: 'mappoint.gif',\n          width: 15,\n          height: 15\n        }\n      },\n      colorBar: {\n        width: 20,\n        height: 256,\n        arrow: {\n          file: 'rangearrows.gif',\n          width: 20,\n          height: 7\n        }\n      },\n      picker: {\n        file: 'picker.gif',\n        width: 25,\n        height: 24\n      }\n    },\n    localization: {\n      text: {\n        title: 'Drag Markers To Pick A Color',\n        newColor: 'new',\n        currentColor: 'current',\n        ok: 'OK',\n        cancel: 'Cancel'\n      },\n      tooltips: {\n        colors: {\n          newColor: 'New Color - Press &ldquo;OK&rdquo; To Commit',\n          currentColor: 'Click To Revert To Original Color'\n        },\n        buttons: {\n          ok: 'Commit To This Color Selection',\n          cancel: 'Cancel And Revert To Original Color'\n        },\n        hue: {\n          radio: 'Set To &ldquo;Hue&rdquo; Color Mode',\n          textbox: 'Enter A &ldquo;Hue&rdquo; Value (0-360&deg;)'\n        },\n        saturation: {\n          radio: 'Set To &ldquo;Saturation&rdquo; Color Mode',\n          textbox: 'Enter A &ldquo;Saturation&rdquo; Value (0-100%)'\n        },\n        value: {\n          radio: 'Set To &ldquo;Value&rdquo; Color Mode',\n          textbox: 'Enter A &ldquo;Value&rdquo; Value (0-100%)'\n        },\n        red: {\n          radio: 'Set To &ldquo;Red&rdquo; Color Mode',\n          textbox: 'Enter A &ldquo;Red&rdquo; Value (0-255)'\n        },\n        green: {\n          radio: 'Set To &ldquo;Green&rdquo; Color Mode',\n          textbox: 'Enter A &ldquo;Green&rdquo; Value (0-255)'\n        },\n        blue: {\n          radio: 'Set To &ldquo;Blue&rdquo; Color Mode',\n          textbox: 'Enter A &ldquo;Blue&rdquo; Value (0-255)'\n        },\n        alpha: {\n          radio: 'Set To &ldquo;Alpha&rdquo; Color Mode',\n          textbox: 'Enter A &ldquo;Alpha&rdquo; Value (0-100)'\n        },\n        hex: {\n          textbox: 'Enter A &ldquo;Hex&rdquo; Color Value (#000000-#ffffff)',\n          alpha: 'Enter A &ldquo;Alpha&rdquo; Value (#00-#ff)'\n        }\n      }\n    }\n  };\n  return $;\n};\n\nexport default jPicker;\n","/* globals jQuery */\n/**\n * Localizing script for SVG-edit UI\n * @module locale\n * @license MIT\n *\n * @copyright 2010 Narendra Sisodya\n * @copyright 2010 Alexis Deveria\n *\n */\n\n/**\n * Used, for example, in the ImageLibs extension, to present libraries (with name/URL/description) in order\n * @typedef {GenericArray.<module:locale.LocaleStrings>} module:locale.LocaleArray\n*/\n/**\n * The string keys of the object are two-letter language codes\n * @tutorial LocaleDocs\n * @typedef {PlainObject.<string, string|module:locale.LocaleStrings|module:locale.LocaleArray>} module:locale.LocaleStrings\n */\n// keyed to an array of objects with \"id\" and \"title\" or \"textContent\" properties\n/**\n * @typedef {PlainObject.<string, string>} module:locale.LocaleSelectorValue\n */\n\nimport {importSetGlobalDefault} from '../external/dynamic-import-polyfill/importModule.js';\n\nconst $ = jQuery;\n\nlet langParam;\n\n/**\n* @param {\"content\"|\"title\"} type\n* @param {module:locale.LocaleSelectorValue} obj\n* @param {boolean} ids\n* @returns {undefined}\n*/\nexport const setStrings = function (type, obj, ids) {\n  // Root element to look for element from\n  const parent = $('#svg_editor').parent();\n  Object.entries(obj).forEach(([sel, val]) => {\n    if (!val) { console.log(sel); }\n\n    if (ids) { sel = '#' + sel; }\n    const $elem = parent.find(sel);\n    if ($elem.length) {\n      const elem = parent.find(sel)[0];\n\n      switch (type) {\n      case 'content':\n        for (let i = 0, node; (node = elem.childNodes[i]); i++) {\n          if (node.nodeType === 3 && node.textContent.trim()) {\n            node.textContent = val;\n            break;\n          }\n        }\n        break;\n\n      case 'title':\n        elem.title = val;\n        break;\n      }\n    } else {\n      console.log('Missing: ' + sel);\n    }\n  });\n};\n\n/**\n* The \"data\" property is generally set to an an array of objects with\n* \"id\" and \"title\" or \"textContent\" properties\n* @typedef {PlainObject} module:locale.AddLangExtensionLocaleData\n* @property {module:locale.LocaleStrings[]} data See {@tutorial LocaleDocs}\n*/\n\n/**\n* @interface module:locale.LocaleEditorInit\n*/\n/**\n * @function module:locale.LocaleEditorInit#addLangData\n * @param {string} langParam\n * @returns {module:locale.AddLangExtensionLocaleData}\n*/\n\nlet editor_;\n/**\n* @function init\n* @memberof module:locale\n* @param {module:locale.LocaleEditorInit} editor\n* @returns {undefined}\n*/\nexport const init = (editor) => {\n  editor_ = editor;\n};\n\n/**\n* @typedef {PlainObject} module:locale.LangAndData\n* @property {string} langParam\n* @property {module:locale.LocaleStrings} langData\n*/\n\n/**\n* @function module:locale.readLang\n* @param {module:locale.LocaleStrings} langData See {@tutorial LocaleDocs}\n* @fires module:svgcanvas.SvgCanvas#event:ext-addLangData\n* @returns {Promise} Resolves to [`LangAndData`]{@link module:locale.LangAndData}\n*/\nexport const readLang = async function (langData) {\n  const more = await editor_.addLangData(langParam);\n  $.each(more, function (i, m) {\n    if (m.data) {\n      langData = $.merge(langData, m.data);\n    }\n  });\n\n  // Old locale file, do nothing for now.\n  if (!langData.tools) { return; }\n\n  const {\n    tools,\n    // misc,\n    properties, config, layers, common, ui\n  } = langData;\n\n  setStrings('content', {\n    // copyrightLabel: misc.powered_by, // Currently commented out in svg-editor.html\n    curve_segments: properties.curve_segments,\n    fitToContent: tools.fitToContent,\n    fit_to_all: tools.fit_to_all,\n    fit_to_canvas: tools.fit_to_canvas,\n    fit_to_layer_content: tools.fit_to_layer_content,\n    fit_to_sel: tools.fit_to_sel,\n\n    icon_large: config.icon_large,\n    icon_medium: config.icon_medium,\n    icon_small: config.icon_small,\n    icon_xlarge: config.icon_xlarge,\n    image_opt_embed: config.image_opt_embed,\n    image_opt_ref: config.image_opt_ref,\n    includedImages: config.included_images,\n\n    largest_object: tools.largest_object,\n\n    layersLabel: layers.layers,\n    page: tools.page,\n    relativeToLabel: tools.relativeTo,\n    selLayerLabel: layers.move_elems_to,\n    selectedPredefined: config.select_predefined,\n\n    selected_objects: tools.selected_objects,\n    smallest_object: tools.smallest_object,\n    straight_segments: properties.straight_segments,\n\n    svginfo_bg_url: config.editor_img_url + ':',\n    svginfo_bg_note: config.editor_bg_note,\n    svginfo_change_background: config.background,\n    svginfo_dim: config.doc_dims,\n    svginfo_editor_prefs: config.editor_prefs,\n    svginfo_height: common.height,\n    svginfo_icons: config.icon_size,\n    svginfo_image_props: config.image_props,\n    svginfo_lang: config.language,\n    svginfo_title: config.doc_title,\n    svginfo_width: common.width,\n\n    tool_docprops_cancel: common.cancel,\n    tool_docprops_save: common.ok,\n\n    tool_source_cancel: common.cancel,\n    tool_source_save: common.ok,\n\n    tool_prefs_cancel: common.cancel,\n    tool_prefs_save: common.ok,\n\n    sidepanel_handle: layers.layers.split('').join(' '),\n\n    tool_clear: tools.new_doc,\n    tool_docprops: tools.docprops,\n    tool_export: tools.export_img,\n    tool_import: tools.import_doc,\n    tool_open: tools.open_doc,\n    tool_save: tools.save_doc,\n\n    svginfo_units_rulers: config.units_and_rulers,\n    svginfo_rulers_onoff: config.show_rulers,\n    svginfo_unit: config.base_unit,\n\n    svginfo_grid_settings: config.grid,\n    svginfo_snap_onoff: config.snapping_onoff,\n    svginfo_snap_step: config.snapping_stepsize,\n    svginfo_grid_color: config.grid_color\n  }, true);\n\n  // Context menus\n  const opts = {};\n  $.each(['cut', 'copy', 'paste', 'paste_in_place', 'delete', 'group', 'ungroup', 'move_front', 'move_up', 'move_down', 'move_back'], function () {\n    opts['#cmenu_canvas a[href=\"#' + this + '\"]'] = tools[this];\n  });\n\n  $.each(['dupe', 'merge_down', 'merge_all'], function () {\n    opts['#cmenu_layers a[href=\"#' + this + '\"]'] = layers[this];\n  });\n\n  opts['#cmenu_layers a[href=\"#delete\"]'] = layers.del;\n\n  setStrings('content', opts);\n\n  setStrings('title', {\n    align_relative_to: tools.align_relative_to,\n    circle_cx: properties.circle_cx,\n    circle_cy: properties.circle_cy,\n    circle_r: properties.circle_r,\n    cornerRadiusLabel: properties.corner_radius,\n    ellipse_cx: properties.ellipse_cx,\n    ellipse_cy: properties.ellipse_cy,\n    ellipse_rx: properties.ellipse_rx,\n    ellipse_ry: properties.ellipse_ry,\n    fill_color: properties.fill_color,\n    font_family: properties.font_family,\n    idLabel: properties.id,\n    image_height: properties.image_height,\n    image_url: properties.image_url,\n    image_width: properties.image_width,\n    layer_delete: layers.del,\n    layer_down: layers.move_down,\n    layer_new: layers['new'],\n    layer_rename: layers.rename,\n    layer_moreopts: common.more_opts,\n    layer_up: layers.move_up,\n    line_x1: properties.line_x1,\n    line_x2: properties.line_x2,\n    line_y1: properties.line_y1,\n    line_y2: properties.line_y2,\n    linecap_butt: properties.linecap_butt,\n    linecap_round: properties.linecap_round,\n    linecap_square: properties.linecap_square,\n    linejoin_bevel: properties.linejoin_bevel,\n    linejoin_miter: properties.linejoin_miter,\n    linejoin_round: properties.linejoin_round,\n    main_icon: tools.main_menu,\n    palette: ui.palette_info,\n    zoom_panel: ui.zoom_level,\n    path_node_x: properties.node_x,\n    path_node_y: properties.node_y,\n    rect_height_tool: properties.rect_height,\n    rect_width_tool: properties.rect_width,\n    seg_type: properties.seg_type,\n    selLayerNames: layers.move_selected,\n    selected_x: properties.pos_x,\n    selected_y: properties.pos_y,\n    stroke_color: properties.stroke_color,\n    stroke_style: properties.stroke_style,\n    stroke_width: properties.stroke_width,\n    svginfo_title: config.doc_title,\n    text: properties.text_contents,\n    toggle_stroke_tools: ui.toggle_stroke_tools,\n    tool_add_subpath: tools.add_subpath,\n    tool_alignbottom: tools.align_bottom,\n    tool_aligncenter: tools.align_center,\n    tool_alignleft: tools.align_left,\n    tool_alignmiddle: tools.align_middle,\n    tool_alignright: tools.align_right,\n    tool_aligntop: tools.align_top,\n    tool_angle: properties.angle,\n    tool_blur: properties.blur,\n    tool_bold: properties.bold,\n    tool_circle: tools.mode_circle,\n    tool_clone: tools.clone,\n    tool_clone_multi: tools.clone,\n    tool_delete: tools.del,\n    tool_delete_multi: tools.del,\n    tool_ellipse: tools.mode_ellipse,\n    tool_fhellipse: tools.mode_fhellipse,\n    tool_fhpath: tools.mode_fhpath,\n    tool_fhrect: tools.mode_fhrect,\n    tool_font_size: properties.font_size,\n    tool_group_elements: tools.group_elements,\n    tool_make_link: tools.make_link,\n    tool_link_url: tools.set_link_url,\n    tool_image: tools.mode_image,\n    tool_italic: properties.italic,\n    tool_line: tools.mode_line,\n    tool_move_bottom: tools.move_bottom,\n    tool_move_top: tools.move_top,\n    tool_node_clone: tools.node_clone,\n    tool_node_delete: tools.node_delete,\n    tool_node_link: tools.node_link,\n    tool_opacity: properties.opacity,\n    tool_openclose_path: tools.openclose_path,\n    tool_path: tools.mode_path,\n    tool_position: tools.align_to_page,\n    tool_rect: tools.mode_rect,\n    tool_redo: tools.redo,\n    tool_reorient: tools.reorient_path,\n    tool_select: tools.mode_select,\n    tool_source: tools.source_save,\n    tool_square: tools.mode_square,\n    tool_text: tools.mode_text,\n    tool_topath: tools.to_path,\n    tool_undo: tools.undo,\n    tool_ungroup: tools.ungroup,\n    tool_wireframe: tools.wireframe_mode,\n    tool_zoom: tools.mode_zoom,\n    url_notice: tools.no_embed\n\n  }, true);\n\n  return {langParam, langData};\n};\n\n/**\n* @function module:locale.putLocale\n* @param {string} givenParam\n* @param {string[]} goodLangs\n* @param {{langPath: string}} conf\n* @fires module:svgcanvas.SvgCanvas#event:ext-addLangData\n* @fires module:svgcanvas.SvgCanvas#event:ext-langReady\n* @fires module:svgcanvas.SvgCanvas#event:ext-langChanged\n* @returns {Promise} Resolves to result of {@link module:locale.readLang}\n*/\nexport const putLocale = async function (givenParam, goodLangs, conf) {\n  if (givenParam) {\n    langParam = givenParam;\n  } else {\n    langParam = $.pref('lang');\n    if (!langParam) {\n      if (navigator.userLanguage) { // Explorer\n        langParam = navigator.userLanguage;\n      } else if (navigator.language) { // FF, Opera, ...\n        langParam = navigator.language;\n      }\n    }\n\n    console.log('Lang: ' + langParam);\n\n    // Set to English if language is not in list of good langs\n    if (!goodLangs.includes(langParam) && langParam !== 'test') {\n      langParam = 'en';\n    }\n\n    // don't bother on first run if language is English\n    // The following line prevents setLang from running\n    //    extensions which depend on updated uiStrings,\n    //    so commenting it out.\n    // if (langParam.startsWith('en')) {return;}\n  }\n\n  const url = conf.langPath + 'lang.' + langParam + '.js';\n  return readLang(\n    // Todo: Replace this with `return import(url);` when\n    //   `import()` widely supported\n    await importSetGlobalDefault(url, {\n      global: 'svgEditorLang_' + langParam.replace(/-/g, '_')\n    })\n  );\n};\n","/* globals jQuery */\n\nimport './touch.js';\nimport {NS} from './namespaces.js';\nimport {isWebkit, isGecko, isIE, isMac, isTouch} from './browser.js';\nimport * as Utils from './utilities.js';\nimport {getTypeMap, convertUnit, isValidUnit} from './units.js';\nimport {\n  hasCustomHandler, getCustomHandler, injectExtendedContextMenuItemsIntoDom\n} from './contextmenu.js';\nimport {importSetGlobalDefault} from './external/dynamic-import-polyfill/importModule.js';\n\nimport SvgCanvas from './svgcanvas.js';\nimport Layer from './layer.js';\n\nimport jqPluginJSHotkeys from './js-hotkeys/jquery.hotkeys.min.js';\nimport jqPluginBBQ from './jquerybbq/jquery.bbq.min.js';\nimport jqPluginSVGIcons from './svgicons/jQuery.svgIcons.js';\nimport jqPluginJGraduate from './jgraduate/jQuery.jGraduate.js';\nimport jqPluginSpinBtn from './spinbtn/jQuery.SpinButton.js';\nimport jqPluginSVG from './jQuery.attr.js'; // Needed for SVG attribute setting and array form with `attr`\nimport jqPluginContextMenu from './contextmenu/jQuery.contextMenu.js';\nimport jqPluginJPicker from './jgraduate/jQuery.jPicker.js';\nimport {\n  readLang, putLocale,\n  setStrings,\n  init as localeInit\n} from './locale/locale.js';\nimport loadStylesheets from './external/load-stylesheets/index-es.js';\n\n/**\n* The main module for the visual SVG Editor\n*\n* @license MIT\n*\n* @copyright 2010 Alexis Deveria\n* 2010 Pavol Rusnak\n* 2010 Jeff Schiller\n* 2010 Narendra Sisodiya\n* 2014 Brett Zamir\n* @exports module:SVGEditor\n* @borrows module:locale.putLocale as putLocale\n* @borrows module:locale.readLang as readLang\n* @borrows module:locale.setStrings as setStrings\n*/\nconst editor = {};\n\nconst $ = [\n  jqPluginJSHotkeys, jqPluginBBQ, jqPluginSVGIcons, jqPluginJGraduate,\n  jqPluginSpinBtn, jqPluginSVG, jqPluginContextMenu, jqPluginJPicker\n].reduce(($, cb) => cb($), jQuery);\n\n/*\nif (!$.loadingStylesheets) {\n  $.loadingStylesheets = [];\n}\n*/\nconst stylesheet = 'svg-editor.css';\nif (!$.loadingStylesheets.includes(stylesheet)) {\n  $.loadingStylesheets.push(stylesheet);\n}\nconst favicon = 'images/logo.png';\nif ($.loadingStylesheets.some((item) => {\n  return !Array.isArray(item) || item[0] !== favicon;\n})) {\n  $.loadingStylesheets.push([favicon, {favicon: true}]);\n}\n\n// EDITOR PROPERTIES: (defined below)\n//    curPrefs, curConfig, canvas, storage, uiStrings\n//\n// STATE MAINTENANCE PROPERTIES\n/**\n* @type {Float}\n*/\neditor.tool_scale = 1; // Dependent on icon size, so any use to making configurable instead? Used by `jQuery.SpinButton.js`\n/**\n* @type {Integer}\n*/\neditor.exportWindowCt = 0;\n/**\n* @type {boolean}\n*/\neditor.langChanged = false;\n/**\n* @type {boolean}\n*/\neditor.showSaveWarning = false;\n/**\n* @type {boolean}\n*/\neditor.storagePromptClosed = false; // For use with ext-storage.js\n\nconst callbacks = [],\n  /**\n  * @typedef {\"s\"|\"m\"|\"l\"|\"xl\"|Float} module:SVGEditor.IconSize\n  */\n  /**\n  * Preferences\n  * @interface module:SVGEditor.Prefs\n  * @property {string} [lang=\"en\"] Two-letter language code. The language must exist in the Editor Preferences language list. Defaults to \"en\" if `locale.js` detection does not detect another language.\n  * @property {module:SVGEditor.IconSize} [iconsize=\"s\"|\"m\"] Size of the toolbar icons. Will default to 's' if the window height is smaller than the minimum height and 'm' otherwise.\n  * @property {string} [bkgd_color=\"#FFF\"] Color hex for canvas background color. Defaults to white.\n  * @property {string} [bkgd_url=\"\"] Background raster image URL. This image will fill the background of the document; useful for tracing purposes.\n  * @property {\"embed\"|\"ref\"} [img_save=\"embed\"] Defines whether included raster images should be saved as Data URIs when possible, or as URL references. Settable in the Document Properties dialog.\n  * @property {boolean} [save_notice_done=false] Used to track alert status\n  * @property {boolean} [export_notice_done=false] Used to track alert status\n  * @todo `save_notice_done` and `export_notice_done` should be changed to flags rather than preferences\n  */\n  /**\n  * @namespace {module:SVGEditor.Prefs} defaultPrefs\n  * @memberof module:SVGEditor~\n  * @implements {module:SVGEditor.Prefs}\n  */\n  // The iteration algorithm for defaultPrefs does not currently support array/objects\n  defaultPrefs = /** @lends module:SVGEditor~defaultPrefs */ {\n    // EDITOR OPTIONS (DIALOG)\n    /**\n    * Default to \"en\" if locale.js detection does not detect another language\n    */\n    lang: '',\n    /**\n    * Will default to 's' if the window height is smaller than the minimum height and\n    * 'm' otherwise\n    */\n    iconsize: '',\n    bkgd_color: '#FFF',\n    bkgd_url: '',\n    // DOCUMENT PROPERTIES (DIALOG)\n    img_save: 'embed',\n    // ALERT NOTICES\n    // Only shows in UI as far as alert notices, but useful to remember, so keeping as pref\n    save_notice_done: false,\n    export_notice_done: false\n  },\n  /**\n  * @name module:SVGEditor~defaultExtensions\n  * @type {string[]}\n  */\n  defaultExtensions = [\n    'ext-connector.js',\n    'ext-eyedropper.js',\n    'ext-grid.js',\n    'ext-imagelib.js',\n    'ext-markers.js',\n    'ext-overview_window.js',\n    'ext-panning.js',\n    'ext-polygon.js',\n    'ext-shapes.js',\n    'ext-star.js',\n    'ext-storage.js'\n  ],\n  /**\n  * @typedef {\"@default\"|string} module:SVGEditor.Stylesheet `@default` will automatically load all of the default CSS paths for SVGEditor\n  */\n  /**\n  * @typedef {GenericArray} module:SVGEditor.XYDimensions\n  * @property {Integer} length 2\n  * @property {Float} 0\n  * @property {Float} 1\n  */\n  /**\n  * @tutorial ConfigOptions\n  * @interface module:SVGEditor.Config\n  * @property {string} [canvasName=\"default\"] Used to namespace storage provided via `ext-storage.js`; you can use this if you wish to have multiple independent instances of SVG Edit on the same domain\n  * @property {boolean} [no_save_warning=false] If `true`, prevents the warning dialog box from appearing when closing/reloading the page. Mostly useful for testing.\n  * @property {string} [imgPath=\"images/\"] The path where the SVG icons are located, with trailing slash. Note that as of version 2.7, this is not configurable by URL for security reasons.\n  * @property {string} [langPath=\"locale/\"] The path where the language files are located, with trailing slash. Default will be changed to `../dist/locale/` if this is a modular load. Note that as of version 2.7, this is not configurable by URL for security reasons.\n  * @property {string} [extPath=\"extensions/\"] The path used for extension files, with trailing slash. Default will be changed to `../dist/extensions/` if this is a modular load. Note that as of version 2.7, this is not configurable by URL for security reasons.\n  * @property {string} [canvgPath=\"canvg/\"] The path used for `canvg` files, with trailing slash. Default will be changed to `../dist/` if this is a modular load.\n  * @property {string} [jspdfPath=\"jspdf/\"] The path used for `jsPDF` files, with trailing slash. Default will be changed to `../dist/` if this is a modular load.\n  * @property {string} [extIconsPath=\"extensions/\"] The path used for extension icons, with trailing slash.\n  * @property {string} [jGraduatePath=\"jgraduate/images/\"] The path where jGraduate images are located. Note that as of version 2.7, this is not configurable by URL for security reasons.\n  * @property {boolean} [preventAllURLConfig=false] Set to `true` to override the ability for URLs to set non-content configuration (including extension config). Must be set early, i.e., in `svgedit-config-iife.js`; extension loading is too late!\n  * @property {boolean} [preventURLContentLoading=false] Set to `true` to override the ability for URLs to set URL-based SVG content. Must be set early, i.e., in `svgedit-config-iife.js`; extension loading is too late!\n  * @property {boolean} [lockExtensions=false] Set to `true` to override the ability for URLs to set their own extensions; disallowed in URL setting. There is no need for this when `preventAllURLConfig` is used. Must be set early, i.e., in `svgedit-config-iife.js`; extension loading is too late!\n  * @property {boolean} [noDefaultExtensions=false] If set to `true`, prohibits automatic inclusion of default extensions (though \"extensions\" can still be used to add back any desired default extensions along with any other extensions). This can only be meaningfully used in `svgedit-config-iife.js` or in the URL\n  * @property {boolean} [noStorageOnLoad=false] Some interaction with `ext-storage.js`; prevent even the loading of previously saved local storage.\n  * @property {boolean} [forceStorage=false] Some interaction with `ext-storage.js`; strongly discouraged from modification as it bypasses user privacy by preventing them from choosing whether to keep local storage or not (and may be required by law in some regions)\n  * @property {boolean} [emptyStorageOnDecline=false] Used by `ext-storage.js`; empty any prior storage if the user declines to store\n  * @property {string[]} [extensions=module:SVGEditor~defaultExtensions] Extensions to load on startup. Use an array in `setConfig` and comma separated file names in the URL. Extension names must begin with \"ext-\". Note that as of version 2.7, paths containing \"/\", \"\\\", or \":\", are disallowed for security reasons. Although previous versions of this list would entirely override the default list, as of version 2.7, the defaults will always be added to this explicit list unless the configuration `noDefaultExtensions` is included.\n  * @property {module:SVGEditor.Stylesheet[]} [stylesheets=[\"@default\"]] An array of required stylesheets to load in parallel; include the value `\"@default\"` within this array to ensure all default stylesheets are loaded.\n  * @property {string[]} [allowedOrigins=[]] Used by `ext-xdomain-messaging.js` to indicate which origins are permitted for cross-domain messaging (e.g., between the embedded editor and main editor code). Besides explicit domains, one might add '' to allow all domains (not recommended for privacy/data integrity of your user's content!), `window.location.origin` for allowing the same origin (should be safe if you trust all apps on your domain), 'null' to allow `file://` URL usage\n  * @property {null|PlainObject} [colorPickerCSS=null] Object of CSS properties mapped to values (for jQuery) to apply to the color picker. See {@link http://api.jquery.com/css/#css-properties}. A `null` value (the default) will cause the CSS to default to `left` with a position equal to that of the `fill_color` or `stroke_color` element minus 140, and a `bottom` equal to 40\n  * @property {string} [paramurl] This was available via URL only. Allowed an un-encoded URL within the query string (use \"url\" or \"source\" with a data: URI instead)\n  * @property {Float} [canvas_expansion=3] The minimum area visible outside the canvas, as a multiple of the image dimensions. The larger the number, the more one can scroll outside the canvas.\n  * @property {PlainObject} [initFill] Init fill properties\n  * @property {string} [initFill.color=\"FF0000\"] The initial fill color. Must be a hex code string. Defaults to solid red.\n  * @property {Float} [initFill.opacity=1] The initial fill opacity. Must be a number between 0 and 1\n  * @property {PlainObject} [initStroke] Init stroke properties\n  * @property {Float} [initStroke.width=5] The initial stroke width. Must be a positive number.\n  * @property {string} [initStroke.color=\"000000\"] The initial stroke color. Must be a hex code. Defaults to solid black.\n  * @property {Float} [initStroke.opacity=1] The initial stroke opacity. Must be a number between 0 and 1.\n  * @property {PlainObject} text Text style properties\n  * @property {Float} [text.stroke_width=0] Text stroke width\n  * @property {Float} [text.font_size=24] Text font size\n  * @property {string} [text.font_family=\"serif\"] Text font family\n  * @property {Float} [initOpacity=1] Initial opacity (multiplied by 100)\n  * @property {module:SVGEditor.XYDimensions} [dimensions=[640, 480]] The default width/height of a new document. Use an array in `setConfig` (e.g., `[800, 600]`) and comma separated numbers in the URL.\n  * @property {boolean} [gridSnapping=false] Enable snap to grid by default. Set in Editor Options.\n  * @property {string} [gridColor=\"#000\"] Accepts hex, e.g., '#000'. Set in Editor Options. Defaults to black.\n  * @property {string} [baseUnit=\"px\"] Set in Editor Options.\n  * @property {Float} [snappingStep=10] Set the default grid snapping value. Set in Editor Options.\n  * @property {boolean} [showRulers=true] Initial state of ruler display (v2.6). Set in Editor Options.\n  * @property {string} [initTool=\"select\"] The initially selected tool. Must be either the ID of the button for the tool, or the ID without `tool_` prefix (e.g., \"select\").\n  * @property {boolean} [wireframe=false] Start in wireframe mode\n  * @property {boolean} [showlayers=false] Open the layers side-panel by default.\n  * @property {\"new\"|\"same\"} [exportWindowType=\"new\"] Can be \"new\" or \"same\" to indicate whether new windows will be generated for each export; the `window.name` of the export window is namespaced based on the `canvasName` (and incremented if \"new\" is selected as the type). Introduced 2.8.\n  * @property {boolean} [showGrid=false] Set by `ext-grid.js`; determines whether or not to show the grid by default\n  * @property {boolean} [show_outside_canvas=true] Defines whether or not elements outside the canvas should be visible. Set and used in `svgcanvas.js`.\n  * @property {boolean} [selectNew=true] If true, will replace the selection with the current element and automatically select element objects (when not in \"path\" mode) after they are created, showing their grips (v2.6). Set and used in `svgcanvas.js` (`mouseUp`).\n  * @todo Some others could be preferences as well (e.g., preventing URL changing of extensions, defaultExtensions, stylesheets, colorPickerCSS); Change the following to preferences and add pref controls where missing to the UI (e.g., `canvas_expansion`, `initFill`, `initStroke`, `text`, `initOpacity`, `dimensions`, `initTool`, `wireframe`, `showlayers`, `gridSnapping`, `gridColor`, `baseUnit`, `snappingStep`, `showRulers`, `exportWindowType`, `showGrid`, `show_outside_canvas`, `selectNew`)?\n  */\n  /**\n  * @namespace {module:SVGEditor.Config} defaultConfig\n  * @memberof module:SVGEditor~\n  * @implements {module:SVGEditor.Config}\n  */\n  defaultConfig = {\n    canvasName: 'default',\n    canvas_expansion: 3,\n    initFill: {\n      color: 'FF0000', // solid red\n      opacity: 1\n    },\n    initStroke: {\n      width: 5,\n      color: '000000', // solid black\n      opacity: 1\n    },\n    text: {\n      stroke_width: 0,\n      font_size: 24,\n      font_family: 'serif'\n    },\n    initOpacity: 1,\n    colorPickerCSS: null, // Defaults to 'left' with a position equal to that of the fill_color or stroke_color element minus 140, and a 'bottom' equal to 40\n    initTool: 'select',\n    exportWindowType: 'new', // 'same' (todo: also support 'download')\n    wireframe: false,\n    showlayers: false,\n    no_save_warning: false,\n    // PATH CONFIGURATION\n    // The following path configuration items are disallowed in the URL (as should any future path configurations)\n    imgPath: 'images/',\n    langPath: 'locale/', // Default will be changed if this is a modular load\n    extPath: 'extensions/', // Default will be changed if this is a modular load\n    canvgPath: 'canvg/', // Default will be changed if this is a modular load\n    jspdfPath: 'jspdf/', // Default will be changed if this is a modular load\n    extIconsPath: 'extensions/',\n    jGraduatePath: 'jgraduate/images/',\n    // DOCUMENT PROPERTIES\n    // Change the following to a preference (already in the Document Properties dialog)?\n    dimensions: [640, 480],\n    // EDITOR OPTIONS\n    // Change the following to preferences (already in the Editor Options dialog)?\n    gridSnapping: false,\n    gridColor: '#000',\n    baseUnit: 'px',\n    snappingStep: 10,\n    showRulers: true,\n    // URL BEHAVIOR CONFIGURATION\n    preventAllURLConfig: false,\n    preventURLContentLoading: false,\n    // EXTENSION CONFIGURATION (see also preventAllURLConfig)\n    lockExtensions: false, // Disallowed in URL setting\n    noDefaultExtensions: false, // noDefaultExtensions can only be meaningfully used in `svgedit-config-iife.js` or in the URL\n    // EXTENSION-RELATED (GRID)\n    showGrid: false, // Set by ext-grid.js\n    // EXTENSION-RELATED (STORAGE)\n    noStorageOnLoad: false, // Some interaction with ext-storage.js; prevent even the loading of previously saved local storage\n    forceStorage: false, // Some interaction with ext-storage.js; strongly discouraged from modification as it bypasses user privacy by preventing them from choosing whether to keep local storage or not\n    emptyStorageOnDecline: false // Used by ext-storage.js; empty any prior storage if the user declines to store\n  },\n  /**\n  * LOCALE\n  * @name module:SVGEditor.uiStrings\n  * @type {PlainObject}\n  */\n  uiStrings = editor.uiStrings = {};\n\nlet svgCanvas, urldata,\n  isReady = false,\n  customExportImage = false,\n  customExportPDF = false,\n  curPrefs = {},\n  // Note: The difference between Prefs and Config is that Prefs\n  //   can be changed in the UI and are stored in the browser,\n  //   while config cannot\n  curConfig = {\n    // We do not put on defaultConfig to simplify object copying\n    //   procedures (we obtain instead from defaultExtensions)\n    extensions: [],\n    stylesheets: [],\n    /**\n    * Can use window.location.origin to indicate the current\n    * origin. Can contain a '*' to allow all domains or 'null' (as\n    * a string) to support all file:// URLs. Cannot be set by\n    * URL for security reasons (not safe, at least for\n    * privacy or data integrity of SVG content).\n    * Might have been fairly safe to allow\n    *   `new URL(window.location.href).origin` by default but\n    *   avoiding it ensures some more security that even third\n    *   party apps on the same domain also cannot communicate\n    *   with this app by default.\n    * For use with ext-xdomain-messaging.js\n    * @todo We might instead make as a user-facing preference.\n    */\n    allowedOrigins: []\n  };\n\nfunction loadSvgString (str, callback) {\n  const success = svgCanvas.setSvgString(str) !== false;\n  callback = callback || $.noop;\n  if (success) {\n    callback(true); // eslint-disable-line standard/no-callback-literal\n  } else {\n    $.alert(uiStrings.notification.errorLoadingSVG, function () {\n      callback(false); // eslint-disable-line standard/no-callback-literal\n    });\n  }\n}\n\n/**\n * @function module:SVGEditor~getImportLocale\n * @param {string} defaultLang\n * @param {string} defaultName\n * @returns {module:SVGEditor~ImportLocale}\n */\nfunction getImportLocale ({defaultLang, defaultName}) {\n  /**\n   * @function module:SVGEditor~ImportLocale\n   * @param {string} [name] Defaults to `defaultName` of {@link module:SVGEditor~getImportLocale}\n   * @param {string} [lang=defaultLang] Defaults to `defaultLang` of {@link module:SVGEditor~getImportLocale}\n   * @returns {Promise} Resolves to {@link module:locale.LocaleStrings}\n   */\n  return async function importLocale ({name = defaultName, lang = defaultLang} = {}) {\n    async function importLocale (lang) {\n      const url = `${curConfig.extPath}ext-locale/${name}/${lang}.js`;\n      return importSetGlobalDefault(url, {\n        global: `svgEditorExtensionLocale_${name}_${lang}`\n      });\n    }\n    try {\n      return importLocale(lang);\n    } catch (err) {\n      return importLocale('en');\n    }\n  };\n}\n\n/**\n* EXPORTS\n*/\n\n/**\n* Store and retrieve preferences\n* @param {string} key The preference name to be retrieved or set\n* @param {string} [val] The value. If the value supplied is missing or falsey, no change to the preference will be made.\n* @returns {string} If val is missing or falsey, the value of the previously stored preference will be returned.\n* @todo Can we change setting on the jQuery namespace (onto editor) to avoid conflicts?\n* @todo Review whether any remaining existing direct references to\n*  getting `curPrefs` can be changed to use `$.pref()` getting to ensure\n*  `defaultPrefs` fallback (also for sake of `allowInitialUserOverride`); specifically, `bkgd_color` could be changed so that\n*  the pref dialog has a button to auto-calculate background, but otherwise uses `$.pref()` to be able to get default prefs\n*  or overridable settings\n*/\n$.pref = function (key, val) {\n  if (val) {\n    curPrefs[key] = val;\n    /**\n    * @name curPrefs\n    * @memberof module:SVGEditor\n    * @implements {module:SVGEditor.Prefs}\n    */\n    editor.curPrefs = curPrefs; // Update exported value\n    return;\n  }\n  return (key in curPrefs) ? curPrefs[key] : defaultPrefs[key];\n};\n\n/*\n* EDITOR PUBLIC METHODS\n// Todo: Sort these methods per invocation order, ideally with init at the end\n// Todo: Prevent execution until init executes if dependent on it?\n*/\neditor.putLocale = putLocale;\neditor.readLang = readLang;\neditor.setStrings = setStrings;\n\n/**\n* Where permitted, sets canvas and/or `defaultPrefs` based on previous\n*  storage. This will override URL settings (for security reasons) but\n*  not `svgedit-config-iife.js` configuration (unless initial user\n*  overriding is explicitly permitted there via `allowInitialUserOverride`).\n* @todo Split `allowInitialUserOverride` into `allowOverrideByURL` and\n*  `allowOverrideByUserStorage` so `svgedit-config-iife.js` can disallow some\n*  individual items for URL setting but allow for user storage AND/OR\n*  change URL setting so that it always uses a different namespace,\n*  so it won't affect pre-existing user storage (but then if users saves\n*  that, it will then be subject to tampering\n* @returns {undefined}\n*/\neditor.loadContentAndPrefs = function () {\n  if (!curConfig.forceStorage &&\n    (curConfig.noStorageOnLoad ||\n        !document.cookie.match(/(?:^|;\\s*)store=(?:prefsAndContent|prefsOnly)/)\n    )\n  ) {\n    return;\n  }\n\n  // LOAD CONTENT\n  if (editor.storage && // Cookies do not have enough available memory to hold large documents\n    (curConfig.forceStorage ||\n      (!curConfig.noStorageOnLoad &&\n        document.cookie.match(/(?:^|;\\s*)store=prefsAndContent/))\n    )\n  ) {\n    const name = 'svgedit-' + curConfig.canvasName;\n    const cached = editor.storage.getItem(name);\n    if (cached) {\n      editor.loadFromString(cached);\n    }\n  }\n\n  // LOAD PREFS\n  for (const key in defaultPrefs) {\n    if (defaultPrefs.hasOwnProperty(key)) { // It's our own config, so we don't need to iterate up the prototype chain\n      const storeKey = 'svg-edit-' + key;\n      if (editor.storage) {\n        const val = editor.storage.getItem(storeKey);\n        if (val) {\n          defaultPrefs[key] = String(val); // Convert to string for FF (.value fails in Webkit)\n        }\n      } else if (window.widget) {\n        defaultPrefs[key] = window.widget.preferenceForKey(storeKey);\n      } else {\n        const result = document.cookie.match(new RegExp('(?:^|;\\\\s*)' + Utils.regexEscape(encodeURIComponent(storeKey)) + '=([^;]+)'));\n        defaultPrefs[key] = result ? decodeURIComponent(result[1]) : '';\n      }\n    }\n  }\n};\n\n/**\n* Allows setting of preferences or configuration (including extensions).\n* @param {module:SVGEditor.Config|module:SVGEditor.Prefs} opts The preferences or configuration (including extensions). See the tutorial on {@tutorial ConfigOptions} for info on config and preferences.\n* @param {PlainObject} [cfgCfg] Describes configuration which applies to the\n*    particular batch of supplied options\n* @param {boolean} [cfgCfg.allowInitialUserOverride=false] Set to true if you wish\n*  to allow initial overriding of settings by the user via the URL\n*  (if permitted) or previously stored preferences (if permitted);\n*  note that it will be too late if you make such calls in extension\n*  code because the URL or preference storage settings will\n*   have already taken place.\n* @param {boolean} [cfgCfg.overwrite=true] Set to false if you wish to\n*  prevent the overwriting of prior-set preferences or configuration\n*  (URL settings will always follow this requirement for security\n*  reasons, so `svgedit-config-iife.js` settings cannot be overridden unless it\n*  explicitly permits via `allowInitialUserOverride` but extension config\n*  can be overridden as they will run after URL settings). Should\n*   not be needed in `svgedit-config-iife.js`.\n* @returns {undefined}\n*/\neditor.setConfig = function (opts, cfgCfg) {\n  cfgCfg = cfgCfg || {};\n  function extendOrAdd (cfgObj, key, val) {\n    if (cfgObj[key] && typeof cfgObj[key] === 'object') {\n      $.extend(true, cfgObj[key], val);\n    } else {\n      cfgObj[key] = val;\n    }\n  }\n  $.each(opts, function (key, val) {\n    if (opts.hasOwnProperty(key)) {\n      // Only allow prefs defined in defaultPrefs\n      if (defaultPrefs.hasOwnProperty(key)) {\n        if (cfgCfg.overwrite === false && (\n          curConfig.preventAllURLConfig ||\n          curPrefs.hasOwnProperty(key)\n        )) {\n          return;\n        }\n        if (cfgCfg.allowInitialUserOverride === true) {\n          defaultPrefs[key] = val;\n        } else {\n          $.pref(key, val);\n        }\n      } else if (['extensions', 'stylesheets', 'allowedOrigins'].includes(key)) {\n        if (cfgCfg.overwrite === false &&\n          (\n            curConfig.preventAllURLConfig ||\n            ['allowedOrigins', 'stylesheets'].includes(key) ||\n            (key === 'extensions' && curConfig.lockExtensions)\n          )\n        ) {\n          return;\n        }\n        curConfig[key] = curConfig[key].concat(val); // We will handle any dupes later\n      // Only allow other curConfig if defined in defaultConfig\n      } else if (defaultConfig.hasOwnProperty(key)) {\n        if (cfgCfg.overwrite === false && (\n          curConfig.preventAllURLConfig ||\n          curConfig.hasOwnProperty(key)\n        )) {\n          return;\n        }\n        // Potentially overwriting of previously set config\n        if (curConfig.hasOwnProperty(key)) {\n          if (cfgCfg.overwrite === false) {\n            return;\n          }\n          extendOrAdd(curConfig, key, val);\n        } else {\n          if (cfgCfg.allowInitialUserOverride === true) {\n            extendOrAdd(defaultConfig, key, val);\n          } else {\n            if (defaultConfig[key] && typeof defaultConfig[key] === 'object') {\n              curConfig[key] = {};\n              $.extend(true, curConfig[key], val); // Merge properties recursively, e.g., on initFill, initStroke objects\n            } else {\n              curConfig[key] = val;\n            }\n          }\n        }\n      }\n    }\n  });\n  /**\n  * @name curConfig\n  * @memberof module:SVGEditor\n  * @implements {module:SVGEditor.Config}\n  */\n  editor.curConfig = curConfig; // Update exported value\n};\n\n/**\n* All methods are optional\n* @interface module:SVGEditor.CustomHandler\n* @type {PlainObject}\n*/\n/**\n* Its responsibilities are:\n*  - invoke a file chooser dialog in 'open' mode\n*  - let user pick a SVG file\n*  - calls [svgCanvas.setSvgString()]{@link module:svgcanvas.SvgCanvas#setSvgString} with the string contents of that file.\n* Not passed any parameters.\n* @function module:SVGEditor.CustomHandler#open\n* @returns {undefined}\n*/\n/**\n* Its responsibilities are:\n*  - accept the string contents of the current document\n*  - invoke a file chooser dialog in 'save' mode\n*  - save the file to location chosen by the user\n* @function module:SVGEditor.CustomHandler#save\n* @param {external:Window} win\n* @param {module:svgcanvas.SvgCanvas#event:saved} svgStr A string of the SVG\n* @listens module:svgcanvas.SvgCanvas#event:saved\n* @returns {undefined}\n*/\n/**\n* Its responsibilities (with regard to the object it is supplied in its 2nd argument) are:\n*  - inform user of any issues supplied via the \"issues\" property\n*  - convert the \"svg\" property SVG string into an image for export;\n*    utilize the properties \"type\" (currently 'PNG', 'JPEG', 'BMP',\n*    'WEBP', 'PDF'), \"mimeType\", and \"quality\" (for 'JPEG' and 'WEBP'\n*    types) to determine the proper output.\n* @function module:SVGEditor.CustomHandler#exportImage\n* @param {external:Window} win\n* @param {module:svgcanvas.SvgCanvas#event:exported} data\n* @listens module:svgcanvas.SvgCanvas#event:exported\n* @returns {undefined}\n*/\n/**\n* @function module:SVGEditor.CustomHandler#exportPDF\n* @param {external:Window} win\n* @param {module:svgcanvas.SvgCanvas#event:exportedPDF} data\n* @listens module:svgcanvas.SvgCanvas#event:exportedPDF\n* @returns {undefined}\n*/\n\n/**\n* Allows one to override default SVGEdit `open`, `save`, and\n* `export` editor behaviors.\n* @param {module:SVGEditor.CustomHandler} opts Extension mechanisms may call `setCustomHandlers` with three functions: `opts.open`, `opts.save`, and `opts.exportImage`\n* @returns {undefined}\n*/\neditor.setCustomHandlers = function (opts) {\n  editor.ready(function () {\n    if (opts.open) {\n      $('#tool_open > input[type=\"file\"]').remove();\n      $('#tool_open').show();\n      svgCanvas.open = opts.open;\n    }\n    if (opts.save) {\n      editor.showSaveWarning = false;\n      svgCanvas.bind('saved', opts.save);\n    }\n    if (opts.exportImage) {\n      customExportImage = opts.exportImage;\n      svgCanvas.bind('exported', customExportImage); // canvg and our RGBColor will be available to the method\n    }\n    if (opts.exportPDF) {\n      customExportPDF = opts.exportPDF;\n      svgCanvas.bind('exportedPDF', customExportPDF); // jsPDF and our RGBColor will be available to the method\n    }\n  });\n};\n\n/**\n* @param {boolean} arg\n* @returns {undefined}\n*/\neditor.randomizeIds = function (arg) {\n  return svgCanvas.randomizeIds(arg);\n};\n\n/**\n* Auto-run after a Promise microtask\n* @returns {undefined}\n*/\neditor.init = function () {\n  const modularVersion = !('svgEditor' in window) ||\n    !window.svgEditor ||\n    window.svgEditor.modules !== false;\n  if (!modularVersion) {\n    Object.assign(defaultConfig, {\n      langPath: '../dist/locale/',\n      extPath: '../dist/extensions/',\n      canvgPath: '../dist/',\n      jspdfPath: '../dist/'\n    });\n  }\n\n  // const host = location.hostname,\n  //  onWeb = host && host.includes('.');\n  // Some FF versions throw security errors here when directly accessing\n  try {\n    if ('localStorage' in window) { // && onWeb removed so Webkit works locally\n      /**\n      * The built-in interface implemented by `localStorage`\n      * @external Storage\n      */\n      /**\n      * @name storage\n      * @memberof module:SVGEditor\n      * @type {external:Storage}\n      */\n      editor.storage = localStorage;\n    }\n  } catch (err) {}\n\n  // Todo: Avoid const-defined functions and group functions together, etc. where possible\n  const goodLangs = [];\n  $('#lang_select option').each(function () {\n    goodLangs.push(this.value);\n  });\n\n  function setupCurPrefs () {\n    curPrefs = $.extend(true, {}, defaultPrefs, curPrefs); // Now safe to merge with priority for curPrefs in the event any are already set\n    // Export updated prefs\n    editor.curPrefs = curPrefs;\n  }\n  function setupCurConfig () {\n    curConfig = $.extend(true, {}, defaultConfig, curConfig); // Now safe to merge with priority for curConfig in the event any are already set\n\n    // Now deal with extensions and other array config\n    if (!curConfig.noDefaultExtensions) {\n      curConfig.extensions = curConfig.extensions.concat(defaultExtensions);\n    }\n    // ...and remove any dupes\n    ['extensions', 'stylesheets', 'allowedOrigins'].forEach(function (cfg) {\n      curConfig[cfg] = $.grep(curConfig[cfg], function (n, i) { // Supposedly faster than filter per http://amandeep1986.blogspot.hk/2015/02/jquery-grep-vs-js-filter.html\n        return i === curConfig[cfg].indexOf(n);\n      });\n    });\n    // Export updated config\n    editor.curConfig = curConfig;\n  }\n  (() => {\n    // Load config/data from URL if given\n    let src, qstr;\n    urldata = $.deparam.querystring(true);\n    if (!$.isEmptyObject(urldata)) {\n      if (urldata.dimensions) {\n        urldata.dimensions = urldata.dimensions.split(',');\n      }\n\n      if (urldata.bkgd_color) {\n        urldata.bkgd_color = '#' + urldata.bkgd_color;\n      }\n\n      if (urldata.extensions) {\n        // For security reasons, disallow cross-domain or cross-folder extensions via URL\n        urldata.extensions = urldata.extensions.match(/[:/\\\\]/) ? '' : urldata.extensions.split(',');\n      }\n\n      // Disallowing extension paths via URL for\n      // security reasons, even for same-domain\n      // ones given potential to interact in undesirable\n      // ways with other script resources\n      [\n        'extPath', 'imgPath', 'extIconsPath', 'canvgPath',\n        'langPath', 'jGraduatePath', 'jspdfPath'\n      ].forEach(function (pathConfig) {\n        if (urldata[pathConfig]) {\n          delete urldata[pathConfig];\n        }\n      });\n\n      editor.setConfig(urldata, {overwrite: false}); // Note: source and url (as with storagePrompt later) are not set on config but are used below\n\n      setupCurConfig();\n\n      if (!curConfig.preventURLContentLoading) {\n        src = urldata.source;\n        qstr = $.param.querystring();\n        if (!src) { // urldata.source may have been null if it ended with '='\n          if (qstr.includes('source=data:')) {\n            src = qstr.match(/source=(data:[^&]*)/)[1];\n          }\n        }\n        if (src) {\n          if (src.startsWith('data:')) {\n            editor.loadFromDataURI(src);\n          } else {\n            editor.loadFromString(src);\n          }\n          return;\n        }\n        if (urldata.url) {\n          editor.loadFromURL(urldata.url);\n          return;\n        }\n      }\n      if (!urldata.noStorageOnLoad || curConfig.forceStorage) {\n        editor.loadContentAndPrefs();\n      }\n    } else {\n      setupCurConfig();\n      editor.loadContentAndPrefs();\n    }\n    setupCurPrefs();\n  })();\n\n  /**\n  * Called internally\n  * @param {string|Element|external:jQuery} elem\n  * @param {string|external:jQuery} iconId\n  * @param {Float} forcedSize Not in use\n  * @returns {undefined}\n  */\n  const setIcon = editor.setIcon = function (elem, iconId, forcedSize) {\n    const icon = (typeof iconId === 'string') ? $.getSvgIcon(iconId, true) : iconId.clone();\n    if (!icon) {\n      console.log('NOTE: Icon image missing: ' + iconId);\n      return;\n    }\n    $(elem).empty().append(icon);\n  };\n\n  /**\n   * @fires module:svgcanvas.SvgCanvas#event:ext-addLangData\n   * @fires module:svgcanvas.SvgCanvas#event:ext-langReady\n   * @fires module:svgcanvas.SvgCanvas#event:ext-langChanged\n   * @fires module:svgcanvas.SvgCanvas#event:extensions_added\n   * @returns {Promise} Resolves to result of {@link module:locale.readLang}\n   */\n  const extAndLocaleFunc = async function () {\n    // const lang = ('lang' in curPrefs) ? curPrefs.lang : null;\n    const {langParam, langData} = await editor.putLocale(null, goodLangs, curConfig);\n    setLang(langParam, langData);\n\n    try {\n      await Promise.all(\n        curConfig.extensions.map(async (extname) => {\n          const extName = extname.match(/^ext-(.+)\\.js/);\n          if (!extName) { // Ensure URL cannot specify some other unintended file in the extPath\n            return;\n          }\n          const url = curConfig.extPath + extname;\n          // Todo: Replace this with `return import(url);` when\n          //   `import()` widely supported\n          /**\n           * @tutorial ExtensionDocs\n           * @typedef {PlainObject} module:SVGEditor.ExtensionObject\n           * @property {string} [name] Name of the extension. Used internally; no need for i18n. Defaults to extension name without beginning \"ext-\" or ending \".js\".\n           * @property {module:svgcanvas.ExtensionInitCallback} [init]\n           */\n          try {\n            /**\n             * @type {module:SVGEditor.ExtensionObject}\n             */\n            const imported = await importSetGlobalDefault(url, {\n              global: 'svgEditorExtension_' + extName[1].replace(/-/g, '_')\n            });\n            const {name = extName[1], init} = imported;\n            const importLocale = getImportLocale({defaultLang: langParam, defaultName: name});\n            return editor.addExtension(name, (init && init.bind(editor)), importLocale);\n          } catch (err) {\n            console.log(err);\n            console.error('Extension failed to load: ' + extname + '; ' + err);\n          }\n        })\n      );\n      svgCanvas.bind('extensions_added',\n        /**\n        * @param {external:Window} win\n        * @param {module:svgcanvas.SvgCanvas#event:extensions_added} data\n        * @listens module:svgcanvas.SvgCanvas#event:extensions_added\n        * @returns {undefined}\n        */\n        (win, data) => {\n          extensionsAdded = true;\n          Actions.setAll();\n\n          $('.flyout_arrow_horiz:empty').each(function () {\n            $(this).append($.getSvgIcon('arrow_right', true).width(5).height(5));\n          });\n          messageQueue.forEach(\n            /**\n             * @param {module:svgcanvas.SvgCanvas#event:message} messageObj\n             * @fires module:svgcanvas.SvgCanvas#event:message\n             * @returns {undefined}\n             */\n            (messageObj) => {\n              svgCanvas.call('message', messageObj);\n            }\n          );\n        }\n      );\n      svgCanvas.call('extensions_added');\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const stateObj = {tool_scale: editor.tool_scale};\n\n  const setFlyoutPositions = function () {\n    $('.tools_flyout').each(function () {\n      const shower = $('#' + this.id + '_show');\n      const {left, top} = shower.offset();\n      const w = shower.outerWidth();\n      $(this).css({left: (left + w) * editor.tool_scale, top});\n    });\n  };\n\n  const uaPrefix = (function () {\n    const regex = /^(Moz|Webkit|Khtml|O|ms|Icab)(?=[A-Z])/;\n    const someScript = document.getElementsByTagName('script')[0];\n    for (const prop in someScript.style) {\n      if (regex.test(prop)) {\n        // test is faster than match, so it's better to perform\n        // that on the lot and match only when necessary\n        return prop.match(regex)[0];\n      }\n    }\n    // Nothing found so far?\n    if ('WebkitOpacity' in someScript.style) { return 'Webkit'; }\n    if ('KhtmlOpacity' in someScript.style) { return 'Khtml'; }\n\n    return '';\n  }());\n\n  const scaleElements = function (elems, scale) {\n    // const prefix = '-' + uaPrefix.toLowerCase() + '-'; // Currently unused\n    const sides = ['top', 'left', 'bottom', 'right'];\n\n    elems.each(function () {\n      // Handled in CSS\n      // this.style[uaPrefix + 'Transform'] = 'scale(' + scale + ')';\n      const el = $(this);\n      const w = el.outerWidth() * (scale - 1);\n      const h = el.outerHeight() * (scale - 1);\n      // const margins = {}; // Currently unused\n\n      for (let i = 0; i < 4; i++) {\n        const s = sides[i];\n        let cur = el.data('orig_margin-' + s);\n        if (cur == null) {\n          cur = parseInt(el.css('margin-' + s), 10);\n          // Cache the original margin\n          el.data('orig_margin-' + s, cur);\n        }\n        let val = cur * scale;\n        if (s === 'right') {\n          val += w;\n        } else if (s === 'bottom') {\n          val += h;\n        }\n\n        el.css('margin-' + s, val);\n        // el.css('outline', '1px solid red');\n      }\n    });\n  };\n\n  /**\n  * Called internally.\n  * @param {module:SVGEditor.IconSize} size\n  * @returns {undefined}\n  */\n  const setIconSize = editor.setIconSize = function (size) {\n    // const elems = $('.tool_button, .push_button, .tool_button_current, .disabled, .icon_label, #url_notice, #tool_open');\n    const selToscale = '#tools_top .toolset, #editor_panel > *, #history_panel > *,' +\n  '        #main_button, #tools_left > *, #path_node_panel > *, #multiselected_panel > *,' +\n  '        #g_panel > *, #tool_font_size > *, .tools_flyout';\n\n    const elems = $(selToscale);\n\n    let scale = 1;\n    if (typeof size === 'number') {\n      scale = size;\n    } else {\n      const iconSizes = {s: 0.75, m: 1, l: 1.25, xl: 1.5};\n      scale = iconSizes[size];\n    }\n\n    stateObj.tool_scale = editor.tool_scale = scale;\n\n    setFlyoutPositions();\n    // $('.tools_flyout').each(function () {\n    //   const pos = $(this).position();\n    //   console.log($(this), pos.left+(34 * scale));\n    //   $(this).css({left: pos.left+(34 * scale), top: pos.top+(77 * scale)});\n    //   console.log('l', $(this).css('left'));\n    // });\n    //\n    // const scale = .75;\n\n    const hiddenPs = elems.parents(':hidden');\n    hiddenPs.css('visibility', 'hidden').show();\n    scaleElements(elems, scale);\n    hiddenPs.css('visibility', 'visible').hide();\n    // return;\n\n    $.pref('iconsize', size);\n    $('#iconsize').val(size);\n\n    // Change icon size\n    // $('.tool_button, .push_button, .tool_button_current, .disabled, .icon_label, #url_notice, #tool_open')\n    // .find('> svg, > img').each(function () {\n    //   this.setAttribute('width',size_num);\n    //   this.setAttribute('height',size_num);\n    // });\n    //\n    // $.resizeSvgIcons({\n    //   '.flyout_arrow_horiz > svg, .flyout_arrow_horiz > img': size_num / 5,\n    //   '#logo > svg, #logo > img': size_num * 1.3,\n    //   '#tools_bottom .icon_label > *': (size_num === 16 ? 18 : size_num * .75)\n    // });\n    // if (size != 's') {\n    //   $.resizeSvgIcons({'#layerbuttons svg, #layerbuttons img': size_num * .6});\n    // }\n\n    // Note that all rules will be prefixed with '#svg_editor' when parsed\n    const cssResizeRules = {\n      // '.tool_button,\\\n      // .push_button,\\\n      // .tool_button_current,\\\n      // .push_button_pressed,\\\n      // .disabled,\\\n      // .icon_label,\\\n      // .tools_flyout .tool_button': {\n      //   width: {s: '16px', l: '32px', xl: '48px'},\n      //   height: {s: '16px', l: '32px', xl: '48px'},\n      //   padding: {s: '1px', l: '2px', xl: '3px'}\n      // },\n      // '.tool_sep': {\n      //   height: {s: '16px', l: '32px', xl: '48px'},\n      //   margin: {s: '2px 2px', l: '2px 5px', xl: '2px 8px'}\n      // },\n      // '#main_icon': {\n      //   width: {s: '31px', l: '53px', xl: '75px'},\n      //   height: {s: '22px', l: '42px', xl: '64px'}\n      // },\n      '#tools_top': {\n        left: 50 + $('#main_button').width(),\n        height: 72\n      },\n      '#tools_left': {\n        width: 31,\n        top: 74\n      },\n      'div#workarea': {\n        left: 38,\n        top: 74\n      }\n      // '#tools_bottom': {\n      //   left: {s: '27px', l: '46px', xl: '65px'},\n      //   height: {s: '58px', l: '98px', xl: '145px'}\n      // },\n      // '#color_tools': {\n      //   'border-spacing': {s: '0 1px'},\n      //   'margin-top': {s: '-1px'}\n      // },\n      // '#color_tools .icon_label': {\n      //   width: {l:'43px', xl: '60px'}\n      // },\n      // '.color_tool': {\n      //   height: {s: '20px'}\n      // },\n      // '#tool_opacity': {\n      //   top: {s: '1px'},\n      //   height: {s: 'auto', l:'auto', xl:'auto'}\n      // },\n      // '#tools_top input, #tools_bottom input': {\n      //   'margin-top': {s: '2px', l: '4px', xl: '5px'},\n      //   height: {s: 'auto', l: 'auto', xl: 'auto'},\n      //   border: {s: '1px solid #555', l: 'auto', xl: 'auto'},\n      //   'font-size': {s: '.9em', l: '1.2em', xl: '1.4em'}\n      // },\n      // '#zoom_panel': {\n      //   'margin-top': {s: '3px', l: '4px', xl: '5px'}\n      // },\n      // '#copyright, #tools_bottom .label': {\n      //   'font-size': {l: '1.5em', xl: '2em'},\n      //   'line-height': {s: '15px'}\n      // },\n      // '#tools_bottom_2': {\n      //   width: {l: '295px', xl: '355px'},\n      //   top: {s: '4px'}\n      // },\n      // '#tools_top > div, #tools_top': {\n      //   'line-height': {s: '17px', l: '34px', xl: '50px'}\n      // },\n      // '.dropdown button': {\n      //   height: {s: '18px', l: '34px', xl: '40px'},\n      //   'line-height': {s: '18px', l: '34px', xl: '40px'},\n      //   'margin-top': {s: '3px'}\n      // },\n      // '#tools_top label, #tools_bottom label': {\n      //   'font-size': {s: '1em', l: '1.5em', xl: '2em'},\n      //   height: {s: '25px', l: '42px', xl: '64px'}\n      // },\n      // 'div.toolset': {\n      //   height: {s: '25px', l: '42px', xl: '64px'}\n      // },\n      // '#tool_bold, #tool_italic': {\n      //   'font-size': {s: '1.5em', l: '3em', xl: '4.5em'}\n      // },\n      // '#sidepanels': {\n      //   top: {s: '50px', l: '88px', xl: '125px'},\n      //   bottom: {s: '51px', l: '68px', xl: '65px'}\n      // },\n      // '#layerbuttons': {\n      //   width: {l: '130px', xl: '175px'},\n      //   height: {l: '24px', xl: '30px'}\n      // },\n      // '#layerlist': {\n      //   width: {l: '128px', xl: '150px'}\n      // },\n      // '.layer_button': {\n      //   width: {l: '19px', xl: '28px'},\n      //   height: {l: '19px', xl: '28px'}\n      // },\n      // 'input.spin-button': {\n      //   'background-image': {l: 'url('images/spinbtn_updn_big.png')', xl: 'url('images/spinbtn_updn_big.png')'},\n      //   'background-position': {l: '100% -5px', xl: '100% -2px'},\n      //   'padding-right': {l: '24px', xl: '24px' }\n      // },\n      // 'input.spin-button.up': {\n      //   'background-position': {l: '100% -45px', xl: '100% -42px'}\n      // },\n      // 'input.spin-button.down': {\n      //   'background-position': {l: '100% -85px', xl: '100% -82px'}\n      // },\n      // '#position_opts': {\n      //   width: {all: (size_num*4) +'px'}\n      // }\n    };\n\n    let ruleElem = $('#tool_size_rules');\n    if (!ruleElem.length) {\n      ruleElem = $('<style id=\"tool_size_rules\"></style>').appendTo('head');\n    } else {\n      ruleElem.empty();\n    }\n\n    if (size !== 'm') {\n      let styleStr = '';\n      $.each(cssResizeRules, function (selector, rules) {\n        selector = '#svg_editor ' + selector.replace(/,/g, ', #svg_editor');\n        styleStr += selector + '{';\n        $.each(rules, function (prop, values) {\n          let val;\n          if (typeof values === 'number') {\n            val = (values * scale) + 'px';\n          } else if (values[size] || values.all) {\n            val = (values[size] || values.all);\n          }\n          styleStr += (prop + ':' + val + ';');\n        });\n        styleStr += '}';\n      });\n      // this.style[uaPrefix + 'Transform'] = 'scale(' + scale + ')';\n      const prefix = '-' + uaPrefix.toLowerCase() + '-';\n      styleStr += (selToscale + '{' + prefix + 'transform: scale(' + scale + ');}' +\n        ' #svg_editor div.toolset .toolset {' + prefix + 'transform: scale(1); margin: 1px !important;}' + // Hack for markers\n        ' #svg_editor .ui-slider {' + prefix + 'transform: scale(' + (1 / scale) + ');}' // Hack for sliders\n      );\n      ruleElem.text(styleStr);\n    }\n\n    setFlyoutPositions();\n  };\n  $.svgIcons(curConfig.imgPath + 'svg_edit_icons.svg', {\n    w: 24, h: 24,\n    id_match: false,\n    no_img: !isWebkit(), // Opera & Firefox 4 gives odd behavior w/images\n    fallback_path: curConfig.imgPath,\n    fallback: {\n      logo: 'logo.png',\n\n      select: 'select.png',\n      select_node: 'select_node.png',\n\n      square: 'square.png',\n      rect: 'rect.png',\n      fh_rect: 'freehand-square.png',\n      circle: 'circle.png',\n      ellipse: 'ellipse.png',\n      fh_ellipse: 'freehand-circle.png',\n      pencil: 'fhpath.png',\n      pen: 'line.png',\n      text: 'text.png',\n      path: 'path.png',\n      add_subpath: 'add_subpath.png',\n      close_path: 'closepath.png',\n      open_path: 'openpath.png',\n\n      image: 'image.png',\n      zoom: 'zoom.png',\n\n      arrow_right: 'flyouth.png',\n      arrow_right_big: 'arrow_right_big.png',\n      arrow_down: 'dropdown.gif',\n      fill: 'fill.png',\n      stroke: 'stroke.png',\n      opacity: 'opacity.png',\n\n      new_image: 'clear.png',\n      save: 'save.png',\n      export: 'export.png',\n      open: 'open.png',\n      import: 'import.png',\n      docprops: 'document-properties.png',\n      source: 'source.png',\n      wireframe: 'wireframe.png',\n\n      undo: 'undo.png',\n      redo: 'redo.png',\n\n      clone: 'clone.png',\n      delete: 'delete.png',\n      go_up: 'go-up.png',\n      go_down: 'go-down.png',\n      context_menu: 'context_menu.png',\n      move_bottom: 'move_bottom.png',\n      move_top: 'move_top.png',\n      to_path: 'to_path.png',\n      link_controls: 'link_controls.png',\n      reorient: 'reorient.png',\n      group_elements: 'shape_group_elements.png',\n\n      ungroup: 'shape_ungroup.png',\n      unlink_use: 'unlink_use.png',\n      width: 'width.png',\n      height: 'height.png',\n      c_radius: 'c_radius.png',\n      angle: 'angle.png',\n      blur: 'blur.png',\n      fontsize: 'fontsize.png',\n      align: 'align.png',\n\n      align_left: 'align-left.png',\n      align_center: 'align-center.png',\n      align_right: 'align-right.png',\n      align_top: 'align-top.png',\n      align_middle: 'align-middle.png',\n      align_bottom: 'align-bottom.png',\n\n      linecap_butt: 'linecap_butt.png',\n      linecap_square: 'linecap_square.png',\n      linecap_round: 'linecap_round.png',\n      linejoin_miter: 'linejoin_miter.png',\n      linejoin_bevel: 'linejoin_bevel.png',\n      linejoin_round: 'linejoin_round.png',\n      eye: 'eye.png',\n      no_color: 'no_color.png',\n\n      ok: 'save.png',\n      cancel: 'cancel.png',\n      warning: 'warning.png',\n\n      node_delete: 'node_delete.png',\n      node_clone: 'node_clone.png',\n\n      globe_link: 'globe_link.png'\n    },\n    placement: {\n      '#logo': 'logo',\n\n      '#tool_clear div,#layer_new': 'new_image',\n      '#tool_save div': 'save',\n      '#tool_export div': 'export',\n      '#tool_open div div': 'open',\n      '#tool_import div div': 'import',\n      '#tool_source': 'source',\n      '#tool_docprops > div': 'docprops',\n      '#tool_wireframe': 'wireframe',\n\n      '#tool_undo': 'undo',\n      '#tool_redo': 'redo',\n\n      '#tool_select': 'select',\n      '#tool_fhpath': 'pencil',\n      '#tool_line': 'pen',\n      '#tool_rect,#tools_rect_show': 'rect',\n      '#tool_square': 'square',\n      '#tool_fhrect': 'fh_rect',\n      '#tool_ellipse,#tools_ellipse_show': 'ellipse',\n      '#tool_circle': 'circle',\n      '#tool_fhellipse': 'fh_ellipse',\n      '#tool_path': 'path',\n      '#tool_text,#layer_rename': 'text',\n      '#tool_image': 'image',\n      '#tool_zoom': 'zoom',\n\n      '#tool_clone,#tool_clone_multi': 'clone',\n      '#tool_node_clone': 'node_clone',\n      '#layer_delete,#tool_delete,#tool_delete_multi': 'delete',\n      '#tool_node_delete': 'node_delete',\n      '#tool_add_subpath': 'add_subpath',\n      '#tool_openclose_path': 'open_path',\n      '#tool_move_top': 'move_top',\n      '#tool_move_bottom': 'move_bottom',\n      '#tool_topath': 'to_path',\n      '#tool_node_link': 'link_controls',\n      '#tool_reorient': 'reorient',\n      '#tool_group_elements': 'group_elements',\n      '#tool_ungroup': 'ungroup',\n      '#tool_unlink_use': 'unlink_use',\n\n      '#tool_alignleft, #tool_posleft': 'align_left',\n      '#tool_aligncenter, #tool_poscenter': 'align_center',\n      '#tool_alignright, #tool_posright': 'align_right',\n      '#tool_aligntop, #tool_postop': 'align_top',\n      '#tool_alignmiddle, #tool_posmiddle': 'align_middle',\n      '#tool_alignbottom, #tool_posbottom': 'align_bottom',\n      '#cur_position': 'align',\n\n      '#linecap_butt,#cur_linecap': 'linecap_butt',\n      '#linecap_round': 'linecap_round',\n      '#linecap_square': 'linecap_square',\n\n      '#linejoin_miter,#cur_linejoin': 'linejoin_miter',\n      '#linejoin_round': 'linejoin_round',\n      '#linejoin_bevel': 'linejoin_bevel',\n\n      '#url_notice': 'warning',\n\n      '#layer_up': 'go_up',\n      '#layer_down': 'go_down',\n      '#layer_moreopts': 'context_menu',\n      '#layerlist td.layervis': 'eye',\n\n      '#tool_source_save,#tool_docprops_save,#tool_prefs_save': 'ok',\n      '#tool_source_cancel,#tool_docprops_cancel,#tool_prefs_cancel': 'cancel',\n\n      '#rwidthLabel, #iwidthLabel': 'width',\n      '#rheightLabel, #iheightLabel': 'height',\n      '#cornerRadiusLabel span': 'c_radius',\n      '#angleLabel': 'angle',\n      '#linkLabel,#tool_make_link,#tool_make_link_multi': 'globe_link',\n      '#zoomLabel': 'zoom',\n      '#tool_fill label': 'fill',\n      '#tool_stroke .icon_label': 'stroke',\n      '#group_opacityLabel': 'opacity',\n      '#blurLabel': 'blur',\n      '#font_sizeLabel': 'fontsize',\n\n      '.flyout_arrow_horiz': 'arrow_right',\n      '.dropdown button, #main_button .dropdown': 'arrow_down',\n      '#palette .palette_item:first, #fill_bg, #stroke_bg': 'no_color'\n    },\n    resize: {\n      '#logo .svg_icon': 28,\n      '.flyout_arrow_horiz .svg_icon': 5,\n      '.layer_button .svg_icon, #layerlist td.layervis .svg_icon': 14,\n      '.dropdown button .svg_icon': 7,\n      '#main_button .dropdown .svg_icon': 9,\n      '.palette_item:first .svg_icon': 15,\n      '#fill_bg .svg_icon, #stroke_bg .svg_icon': 16,\n      '.toolbar_button button .svg_icon': 16,\n      '.stroke_tool div div .svg_icon': 20,\n      '#tools_bottom label .svg_icon': 18\n    },\n    callback (icons) {\n      $('.toolbar_button button > svg, .toolbar_button button > img').each(function () {\n        $(this).parent().prepend(this);\n      });\n\n      const tleft = $('#tools_left');\n\n      let minHeight;\n      if (tleft.length) {\n        minHeight = tleft.offset().top + tleft.outerHeight();\n      }\n\n      const size = $.pref('iconsize');\n      editor.setIconSize(size || ($(window).height() < minHeight ? 's' : 'm'));\n\n      // Look for any missing flyout icons from plugins\n      $('.tools_flyout').each(function () {\n        const shower = $('#' + this.id + '_show');\n        const sel = shower.attr('data-curopt');\n        // Check if there's an icon here\n        if (!shower.children('svg, img').length) {\n          const clone = $(sel).children().clone();\n          if (clone.length) {\n            clone[0].removeAttribute('style'); // Needed for Opera\n            shower.append(clone);\n          }\n        }\n      });\n\n      function getStylesheetPriority (stylesheet) {\n        switch (stylesheet) {\n        case 'jgraduate/css/jPicker.css':\n          return 1;\n        case 'jgraduate/css/jGraduate.css':\n          return 2;\n        case 'svg-editor.css':\n          return 3;\n        case 'spinbtn/jQuery.SpinButton.css':\n          return 4;\n        default:\n          return Infinity;\n        }\n      }\n      let stylesheets = $.loadingStylesheets.sort((a, b) => {\n        const priorityA = getStylesheetPriority(a);\n        const priorityB = getStylesheetPriority(b);\n        if (priorityA === priorityB) {\n          return 0;\n        }\n        return priorityA > priorityB;\n      });\n      if (curConfig.stylesheets.length) {\n        // Ensure a copy with unique items\n        stylesheets = [...new Set(curConfig.stylesheets)];\n        const idx = stylesheets.indexOf('@default');\n        if (idx > -1) {\n          stylesheets.splice(idx, 1, ...$.loadingStylesheets);\n        }\n      }\n      loadStylesheets(stylesheets, {acceptErrors: ({stylesheetURL, reject, resolve}) => {\n        if ($.loadingStylesheets.includes(stylesheetURL)) {\n          reject(new Error(`Missing expected stylesheet: ${stylesheetURL}`));\n          return;\n        }\n        resolve();\n      }}).then(() => {\n        $('#svg_container')[0].style.visibility = 'visible';\n        editor.runCallbacks();\n      });\n    }\n  });\n\n  /**\n  * @name module:SVGEditor.canvas\n  * @type {module:svgcanvas.SvgCanvas}\n  */\n  editor.canvas = svgCanvas = new SvgCanvas(\n    document.getElementById('svgcanvas'),\n    curConfig\n  );\n  const palette = [ // Todo: Make into configuration item?\n      '#000000', '#3f3f3f', '#7f7f7f', '#bfbfbf', '#ffffff',\n      '#ff0000', '#ff7f00', '#ffff00', '#7fff00',\n      '#00ff00', '#00ff7f', '#00ffff', '#007fff',\n      '#0000ff', '#7f00ff', '#ff00ff', '#ff007f',\n      '#7f0000', '#7f3f00', '#7f7f00', '#3f7f00',\n      '#007f00', '#007f3f', '#007f7f', '#003f7f',\n      '#00007f', '#3f007f', '#7f007f', '#7f003f',\n      '#ffaaaa', '#ffd4aa', '#ffffaa', '#d4ffaa',\n      '#aaffaa', '#aaffd4', '#aaffff', '#aad4ff',\n      '#aaaaff', '#d4aaff', '#ffaaff', '#ffaad4'\n    ],\n    modKey = (isMac() ? 'meta+' : 'ctrl+'), // ⌘\n    path = svgCanvas.pathActions,\n    {undoMgr} = svgCanvas,\n    workarea = $('#workarea'),\n    canvMenu = $('#cmenu_canvas'),\n    // layerMenu = $('#cmenu_layers'), // Unused\n    paintBox = {fill: null, stroke: null};\n\n  let resizeTimer, curScrollPos;\n  let exportWindow = null,\n    defaultImageURL = curConfig.imgPath + 'logo.png',\n    zoomInIcon = 'crosshair',\n    zoomOutIcon = 'crosshair',\n    uiContext = 'toolbars';\n\n  // For external openers\n  (function () {\n    // let the opener know SVG Edit is ready (now that config is set up)\n    const w = window.opener || window.parent;\n    if (w) {\n      try {\n        /**\n         * Triggered on a containing `document` (of `window.opener`\n         * or `window.parent`) when the editor is loaded.\n         * @event module:SVGEditor#event:svgEditorReadyEvent\n         * @type {Event}\n         * @property {true} bubbles\n         * @property {true} cancelable\n         */\n        /**\n         * @name module:SVGEditor.svgEditorReadyEvent\n         * @type {module:SVGEditor#event:svgEditorReadyEvent}\n         */\n        const svgEditorReadyEvent = new w.CustomEvent('svgEditorReady', {\n          bubbles: true,\n          cancelable: true\n        });\n        w.document.documentElement.dispatchEvent(svgEditorReadyEvent);\n      } catch (e) {}\n    }\n  }());\n\n  // This sets up alternative dialog boxes. They mostly work the same way as\n  // their UI counterparts, expect instead of returning the result, a callback\n  // needs to be included that returns the result as its first parameter.\n  // In the future we may want to add additional types of dialog boxes, since\n  // they should be easy to handle this way.\n  (function () {\n    $('#dialog_container').draggable({\n      cancel: '#dialog_content, #dialog_buttons *',\n      containment: 'window'\n    }).css('position', 'absolute');\n    const box = $('#dialog_box'),\n      btnHolder = $('#dialog_buttons'),\n      dialogContent = $('#dialog_content'),\n      dbox = function (type, msg, callback, defaultVal, opts, changeCb, checkbox) {\n        dialogContent.html('<p>' + msg.replace(/\\n/g, '</p><p>') + '</p>')\n          .toggleClass('prompt', (type === 'prompt'));\n        btnHolder.empty();\n\n        const ok = $('<input type=\"button\" value=\"' + uiStrings.common.ok + '\">').appendTo(btnHolder);\n\n        if (type !== 'alert') {\n          $('<input type=\"button\" value=\"' + uiStrings.common.cancel + '\">')\n            .appendTo(btnHolder)\n            .click(function () {\n              box.hide();\n              if (callback) {\n                callback(false); // eslint-disable-line standard/no-callback-literal\n              }\n            });\n        }\n\n        let ctrl, chkbx;\n        if (type === 'prompt') {\n          ctrl = $('<input type=\"text\">').prependTo(btnHolder);\n          ctrl.val(defaultVal || '');\n          ctrl.bind('keydown', 'return', function () { ok.click(); });\n        } else if (type === 'select') {\n          const div = $('<div style=\"text-align:center;\">');\n          ctrl = $('<select>').appendTo(div);\n          if (checkbox) {\n            const label = $('<label>').text(checkbox.label);\n            chkbx = $('<input type=\"checkbox\">').appendTo(label);\n            chkbx.val(checkbox.value);\n            if (checkbox.tooltip) {\n              label.attr('title', checkbox.tooltip);\n            }\n            chkbx.prop('checked', !!checkbox.checked);\n            div.append($('<div>').append(label));\n          }\n          $.each(opts || [], function (opt, val) {\n            if (typeof val === 'object') {\n              ctrl.append($('<option>').val(val.value).html(val.text));\n            } else {\n              ctrl.append($('<option>').html(val));\n            }\n          });\n          dialogContent.append(div);\n          if (defaultVal) {\n            ctrl.val(defaultVal);\n          }\n          if (changeCb) {\n            ctrl.bind('change', 'return', changeCb);\n          }\n          ctrl.bind('keydown', 'return', function () { ok.click(); });\n        } else if (type === 'process') {\n          ok.hide();\n        }\n\n        box.show();\n\n        ok.click(function () {\n          box.hide();\n          const resp = (type === 'prompt' || type === 'select') ? ctrl.val() : true;\n          if (callback) {\n            if (chkbx) {\n              callback(resp, chkbx.prop('checked'));\n            } else {\n              callback(resp);\n            }\n          }\n        }).focus();\n\n        if (type === 'prompt' || type === 'select') {\n          ctrl.focus();\n        }\n      };\n\n    $.alert = function (msg, cb) { dbox('alert', msg, cb); };\n    $.confirm = function (msg, cb) { dbox('confirm', msg, cb); };\n    $.process_cancel = function (msg, cb) { dbox('process', msg, cb); };\n    $.prompt = function (msg, txt, cb) { dbox('prompt', msg, cb, txt); };\n    $.select = function (msg, opts, cb, changeCb, txt, checkbox) { dbox('select', msg, cb, txt, opts, changeCb, checkbox); };\n  }());\n\n  const setSelectMode = function () {\n    const curr = $('.tool_button_current');\n    if (curr.length && curr[0].id !== 'tool_select') {\n      curr.removeClass('tool_button_current').addClass('tool_button');\n      $('#tool_select').addClass('tool_button_current').removeClass('tool_button');\n      $('#styleoverrides').text('#svgcanvas svg *{cursor:move;pointer-events:all} #svgcanvas svg{cursor:default}');\n    }\n    svgCanvas.setMode('select');\n    workarea.css('cursor', 'auto');\n  };\n\n  // used to make the flyouts stay on the screen longer the very first time\n  // const flyoutspeed = 1250; // Currently unused\n  // let textBeingEntered = false; // Currently unused\n  const origTitle = $('title:first').text();\n  // Make [1,2,5] array\n  const rIntervals = [];\n  for (let i = 0.1; i < 1E5; i *= 10) {\n    rIntervals.push(i);\n    rIntervals.push(2 * i);\n    rIntervals.push(5 * i);\n  }\n\n  // This function highlights the layer passed in (by fading out the other layers)\n  // if no layer is passed in, this function restores the other layers\n  const toggleHighlightLayer = function (layerNameToHighlight) {\n    let i;\n    const curNames = [], numLayers = svgCanvas.getCurrentDrawing().getNumLayers();\n    for (i = 0; i < numLayers; i++) {\n      curNames[i] = svgCanvas.getCurrentDrawing().getLayerName(i);\n    }\n\n    if (layerNameToHighlight) {\n      for (i = 0; i < numLayers; ++i) {\n        if (curNames[i] !== layerNameToHighlight) {\n          svgCanvas.getCurrentDrawing().setLayerOpacity(curNames[i], 0.5);\n        }\n      }\n    } else {\n      for (i = 0; i < numLayers; ++i) {\n        svgCanvas.getCurrentDrawing().setLayerOpacity(curNames[i], 1.0);\n      }\n    }\n  };\n\n  const populateLayers = function () {\n    svgCanvas.clearSelection();\n    const layerlist = $('#layerlist tbody').empty();\n    const selLayerNames = $('#selLayerNames').empty();\n    const drawing = svgCanvas.getCurrentDrawing();\n    const currentLayerName = drawing.getCurrentLayerName();\n    const icon = $.getSvgIcon('eye');\n    let layer = svgCanvas.getCurrentDrawing().getNumLayers();\n    // we get the layers in the reverse z-order (the layer rendered on top is listed first)\n    while (layer--) {\n      const name = drawing.getLayerName(layer);\n      const layerTr = $('<tr class=\"layer\">').toggleClass('layersel', name === currentLayerName);\n      const layerVis = $('<td class=\"layervis\">').toggleClass('layerinvis', !drawing.getLayerVisibility(name));\n      const layerName = $('<td class=\"layername\">' + name + '</td>');\n      layerlist.append(layerTr.append(layerVis, layerName));\n      selLayerNames.append('<option value=\"' + name + '\">' + name + '</option>');\n    }\n    if (icon !== undefined) {\n      const copy = icon.clone();\n      $('td.layervis', layerlist).append(copy);\n      $.resizeSvgIcons({'td.layervis .svg_icon': 14});\n    }\n    // handle selection of layer\n    $('#layerlist td.layername')\n      .mouseup(function (evt) {\n        $('#layerlist tr.layer').removeClass('layersel');\n        $(this.parentNode).addClass('layersel');\n        svgCanvas.setCurrentLayer(this.textContent);\n        evt.preventDefault();\n      })\n      .mouseover(function () {\n        toggleHighlightLayer(this.textContent);\n      })\n      .mouseout(function () {\n        toggleHighlightLayer();\n      });\n    $('#layerlist td.layervis').click(function () {\n      const row = $(this.parentNode).prevAll().length;\n      const name = $('#layerlist tr.layer:eq(' + row + ') td.layername').text();\n      const vis = $(this).hasClass('layerinvis');\n      svgCanvas.setLayerVisibility(name, vis);\n      $(this).toggleClass('layerinvis');\n    });\n\n    // if there were too few rows, let's add a few to make it not so lonely\n    let num = 5 - $('#layerlist tr.layer').size();\n    while (num-- > 0) {\n      // FIXME: there must a better way to do this\n      layerlist.append('<tr><td style=\"color:white\">_</td><td/></tr>');\n    }\n  };\n\n  let editingsource = false;\n  let origSource = '';\n  const showSourceEditor = function (e, forSaving) {\n    if (editingsource) { return; }\n\n    editingsource = true;\n    origSource = svgCanvas.getSvgString();\n    $('#save_output_btns').toggle(!!forSaving);\n    $('#tool_source_back').toggle(!forSaving);\n    $('#svg_source_textarea').val(origSource);\n    $('#svg_source_editor').fadeIn();\n    $('#svg_source_textarea').focus();\n  };\n\n  let selectedElement = null;\n  let multiselected = false;\n\n  const togglePathEditMode = function (editmode, elems) {\n    $('#path_node_panel').toggle(editmode);\n    $('#tools_bottom_2,#tools_bottom_3').toggle(!editmode);\n    if (editmode) {\n      // Change select icon\n      $('.tool_button_current').removeClass('tool_button_current').addClass('tool_button');\n      $('#tool_select').addClass('tool_button_current').removeClass('tool_button');\n      setIcon('#tool_select', 'select_node');\n      multiselected = false;\n      if (elems.length) {\n        selectedElement = elems[0];\n      }\n    } else {\n      setTimeout(() => {\n        setIcon('#tool_select', 'select');\n      }, 1000);\n    }\n  };\n\n  /**\n   * @type {module:svgcanvas.EventHandler}\n   * @param {external:Window} wind\n   * @param {module:svgcanvas.SvgCanvas#event:saved} svg The SVG source\n   * @listens module:svgcanvas.SvgCanvas#event:saved\n   * @returns {undefined}\n   */\n  const saveHandler = function (wind, svg) {\n    editor.showSaveWarning = false;\n\n    // by default, we add the XML prolog back, systems integrating SVG-edit (wikis, CMSs)\n    // can just provide their own custom save handler and might not want the XML prolog\n    svg = '<?xml version=\"1.0\"?>\\n' + svg;\n\n    // IE9 doesn't allow standalone Data URLs\n    // https://connect.microsoft.com/IE/feedback/details/542600/data-uri-images-fail-when-loaded-by-themselves\n    if (isIE()) {\n      showSourceEditor(0, true);\n      return;\n    }\n\n    // Since saving SVGs by opening a new window was removed in Chrome use artificial link-click\n    // https://stackoverflow.com/questions/45603201/window-is-not-allowed-to-navigate-top-frame-navigations-to-data-urls\n    const a = document.createElement('a');\n    a.href = 'data:image/svg+xml;base64,' + Utils.encode64(svg);\n    a.download = 'icon.svg';\n\n    a.click();\n\n    // Alert will only appear the first time saved OR the\n    //   first time the bug is encountered\n    let done = $.pref('save_notice_done');\n    if (done !== 'all') {\n      let note = uiStrings.notification.saveFromBrowser.replace('%s', 'SVG');\n      // Check if FF and has <defs/>\n      if (isGecko()) {\n        if (svg.includes('<defs')) {\n          // warning about Mozilla bug #308590 when applicable (seems to be fixed now in Feb 2013)\n          note += '\\n\\n' + uiStrings.notification.defsFailOnSave;\n          $.pref('save_notice_done', 'all');\n          done = 'all';\n        } else {\n          $.pref('save_notice_done', 'part');\n        }\n      } else {\n        $.pref('save_notice_done', 'all');\n      }\n      if (done !== 'part') {\n        alert(note);\n      }\n    }\n  };\n\n  /**\n   * @param {external:Window} win\n   * @param {module:svgcanvas.SvgCanvas#event:exported} data\n   * @listens module:svgcanvas.SvgCanvas#event:exported\n   * @returns {undefined}\n   */\n  const exportHandler = function (win, data) {\n    const {issues, exportWindowName} = data;\n\n    if (exportWindowName) {\n      exportWindow = window.open(Utils.blankPageObjectURL || '', exportWindowName); // A hack to get the window via JSON-able name without opening a new one\n    }\n\n    if (!exportWindow || exportWindow.closed) {\n      $.alert(uiStrings.notification.popupWindowBlocked);\n      return;\n    }\n\n    exportWindow.location.href = data.bloburl || data.datauri;\n    const done = $.pref('export_notice_done');\n    if (done !== 'all') {\n      let note = uiStrings.notification.saveFromBrowser.replace('%s', data.type);\n\n      // Check if there are issues\n      if (issues.length) {\n        const pre = '\\n \\u2022 ';\n        note += ('\\n\\n' + uiStrings.notification.noteTheseIssues + pre + issues.join(pre));\n      }\n\n      // Note that this will also prevent the notice even though new issues may appear later.\n      // May want to find a way to deal with that without annoying the user\n      $.pref('export_notice_done', 'all');\n      exportWindow.alert(note);\n    }\n  };\n\n  const operaRepaint = function () {\n    // Repaints canvas in Opera. Needed for stroke-dasharray change as well as fill change\n    if (!window.opera) {\n      return;\n    }\n    $('<p/>').hide().appendTo('body').remove();\n  };\n\n  function setStrokeOpt (opt, changeElem) {\n    const {id} = opt;\n    const bits = id.split('_');\n    const pre = bits[0];\n    const val = bits[1];\n\n    if (changeElem) {\n      svgCanvas.setStrokeAttr('stroke-' + pre, val);\n    }\n    operaRepaint();\n    setIcon('#cur_' + pre, id, 20);\n    $(opt).addClass('current').siblings().removeClass('current');\n  }\n\n  /**\n  * This is a common function used when a tool has been clicked (chosen)\n  * It does several common things:\n  * - removes the `tool_button_current` class from whatever tool currently has it\n  * - hides any flyouts\n  * - adds the `tool_button_current` class to the button passed in\n  * @function module:SVGEDitor.toolButtonClick\n  * @param {string|Element} button The DOM element or string selector representing the toolbar button\n  * @param {boolean} noHiding Whether not to hide any flyouts\n  * @returns {boolean} Whether the button was disabled or not\n  */\n  const toolButtonClick = editor.toolButtonClick = function (button, noHiding) {\n    if ($(button).hasClass('disabled')) { return false; }\n    if ($(button).parent().hasClass('tools_flyout')) { return true; }\n    const fadeFlyouts = 'normal';\n    if (!noHiding) {\n      $('.tools_flyout').fadeOut(fadeFlyouts);\n    }\n    $('#styleoverrides').text('');\n    workarea.css('cursor', 'auto');\n    $('.tool_button_current').removeClass('tool_button_current').addClass('tool_button');\n    $(button).addClass('tool_button_current').removeClass('tool_button');\n    return true;\n  };\n\n  /**\n  * Unless the select toolbar button is disabled, sets the button\n  * and sets the select mode and cursor styles.\n  * @function module:SVGEditor.clickSelect\n  * @returns {undefined}\n  */\n  const clickSelect = editor.clickSelect = function () {\n    if (toolButtonClick('#tool_select')) {\n      svgCanvas.setMode('select');\n      $('#styleoverrides').text('#svgcanvas svg *{cursor:move;pointer-events:all}, #svgcanvas svg{cursor:default}');\n    }\n  };\n\n  /**\n  * Set a selected image's URL\n  * @function module:SVGEditor.setImageURL\n  * @param {string} url\n  * @returns {undefined}\n  */\n  const setImageURL = editor.setImageURL = function (url) {\n    if (!url) {\n      url = defaultImageURL;\n    }\n    svgCanvas.setImageURL(url);\n    $('#image_url').val(url);\n\n    if (url.startsWith('data:')) {\n      // data URI found\n      $('#image_url').hide();\n      $('#change_image_url').show();\n    } else {\n      // regular URL\n      svgCanvas.embedImage(url, function (dataURI) {\n        // Couldn't embed, so show warning\n        $('#url_notice').toggle(!dataURI);\n        defaultImageURL = url;\n      });\n      $('#image_url').show();\n      $('#change_image_url').hide();\n    }\n  };\n\n  function setBackground (color, url) {\n    // if (color == $.pref('bkgd_color') && url == $.pref('bkgd_url')) { return; }\n    $.pref('bkgd_color', color);\n    $.pref('bkgd_url', url);\n\n    // This should be done in svgcanvas.js for the borderRect fill\n    svgCanvas.setBackground(color, url);\n  }\n\n  function promptImgURL ({cancelDeletes = false} = {}) {\n    let curhref = svgCanvas.getHref(selectedElement);\n    curhref = curhref.startsWith('data:') ? '' : curhref;\n    $.prompt(uiStrings.notification.enterNewImgURL, curhref, function (url) {\n      if (url) {\n        setImageURL(url);\n      } else if (cancelDeletes) {\n        svgCanvas.deleteSelectedElements();\n      }\n    });\n  }\n\n  const setInputWidth = function (elem) {\n    const w = Math.min(Math.max(12 + elem.value.length * 6, 50), 300);\n    $(elem).width(w);\n  };\n\n  function updateRulers (scanvas, zoom) {\n    if (!zoom) { zoom = svgCanvas.getZoom(); }\n    if (!scanvas) { scanvas = $('#svgcanvas'); }\n\n    let d, i;\n    const limit = 30000;\n    const contentElem = svgCanvas.getContentElem();\n    const units = getTypeMap();\n    const unit = units[curConfig.baseUnit]; // 1 = 1px\n\n    // draw x ruler then y ruler\n    for (d = 0; d < 2; d++) {\n      const isX = (d === 0);\n      const dim = isX ? 'x' : 'y';\n      const lentype = isX ? 'width' : 'height';\n      const contentDim = Number(contentElem.getAttribute(dim));\n\n      const $hcanvOrig = $('#ruler_' + dim + ' canvas:first');\n\n      // Bit of a hack to fully clear the canvas in Safari & IE9\n      const $hcanv = $hcanvOrig.clone();\n      $hcanvOrig.replaceWith($hcanv);\n\n      const hcanv = $hcanv[0];\n\n      // Set the canvas size to the width of the container\n      let rulerLen = scanvas[lentype]();\n      const totalLen = rulerLen;\n      hcanv.parentNode.style[lentype] = totalLen + 'px';\n      let ctx = hcanv.getContext('2d');\n      let ctxArr, num, ctxArrNum;\n\n      ctx.fillStyle = 'rgb(200,0,0)';\n      ctx.fillRect(0, 0, hcanv.width, hcanv.height);\n\n      // Remove any existing canvasses\n      $hcanv.siblings().remove();\n\n      // Create multiple canvases when necessary (due to browser limits)\n      if (rulerLen >= limit) {\n        ctxArrNum = parseInt(rulerLen / limit, 10) + 1;\n        ctxArr = [];\n        ctxArr[0] = ctx;\n        let copy;\n        for (i = 1; i < ctxArrNum; i++) {\n          hcanv[lentype] = limit;\n          copy = hcanv.cloneNode(true);\n          hcanv.parentNode.append(copy);\n          ctxArr[i] = copy.getContext('2d');\n        }\n\n        copy[lentype] = rulerLen % limit;\n\n        // set copy width to last\n        rulerLen = limit;\n      }\n\n      hcanv[lentype] = rulerLen;\n\n      const uMulti = unit * zoom;\n\n      // Calculate the main number interval\n      const rawM = 50 / uMulti;\n      let multi = 1;\n      for (i = 0; i < rIntervals.length; i++) {\n        num = rIntervals[i];\n        multi = num;\n        if (rawM <= num) {\n          break;\n        }\n      }\n\n      const bigInt = multi * uMulti;\n\n      ctx.font = '9px sans-serif';\n\n      let rulerD = ((contentDim / uMulti) % multi) * uMulti;\n      let labelPos = rulerD - bigInt;\n      // draw big intervals\n      let ctxNum = 0;\n      while (rulerD < totalLen) {\n        labelPos += bigInt;\n        // const realD = rulerD - contentDim; // Currently unused\n\n        const curD = Math.round(rulerD) + 0.5;\n        if (isX) {\n          ctx.moveTo(curD, 15);\n          ctx.lineTo(curD, 0);\n        } else {\n          ctx.moveTo(15, curD);\n          ctx.lineTo(0, curD);\n        }\n\n        num = (labelPos - contentDim) / uMulti;\n        let label;\n        if (multi >= 1) {\n          label = Math.round(num);\n        } else {\n          const decs = String(multi).split('.')[1].length;\n          label = num.toFixed(decs);\n        }\n\n        // Change 1000s to Ks\n        if (label !== 0 && label !== 1000 && label % 1000 === 0) {\n          label = (label / 1000) + 'K';\n        }\n\n        if (isX) {\n          ctx.fillText(label, rulerD + 2, 8);\n        } else {\n          // draw label vertically\n          const str = String(label).split('');\n          for (i = 0; i < str.length; i++) {\n            ctx.fillText(str[i], 1, (rulerD + 9) + i * 9);\n          }\n        }\n\n        const part = bigInt / 10;\n        // draw the small intervals\n        for (i = 1; i < 10; i++) {\n          let subD = Math.round(rulerD + part * i) + 0.5;\n          if (ctxArr && subD > rulerLen) {\n            ctxNum++;\n            ctx.stroke();\n            if (ctxNum >= ctxArrNum) {\n              i = 10;\n              rulerD = totalLen;\n              continue;\n            }\n            ctx = ctxArr[ctxNum];\n            rulerD -= limit;\n            subD = Math.round(rulerD + part * i) + 0.5;\n          }\n\n          // odd lines are slighly longer\n          const lineNum = (i % 2) ? 12 : 10;\n          if (isX) {\n            ctx.moveTo(subD, 15);\n            ctx.lineTo(subD, lineNum);\n          } else {\n            ctx.moveTo(15, subD);\n            ctx.lineTo(lineNum, subD);\n          }\n        }\n        rulerD += bigInt;\n      }\n      ctx.strokeStyle = '#000';\n      ctx.stroke();\n    }\n  }\n\n  /**\n  * @function module:SVGEditor.updateCanvas\n  * @param {boolean} center\n  * @param {module:math.XYObject} newCtr\n  * @returns {undefined}\n  */\n  const updateCanvas = editor.updateCanvas = function (center, newCtr) {\n    const zoom = svgCanvas.getZoom();\n    const wArea = workarea;\n    const cnvs = $('#svgcanvas');\n\n    let w = workarea.width(), h = workarea.height();\n    const wOrig = w, hOrig = h;\n    const oldCtr = {\n      x: wArea[0].scrollLeft + wOrig / 2,\n      y: wArea[0].scrollTop + hOrig / 2\n    };\n    const multi = curConfig.canvas_expansion;\n    w = Math.max(wOrig, svgCanvas.contentW * zoom * multi);\n    h = Math.max(hOrig, svgCanvas.contentH * zoom * multi);\n\n    if (w === wOrig && h === hOrig) {\n      workarea.css('overflow', 'hidden');\n    } else {\n      workarea.css('overflow', 'scroll');\n    }\n\n    const oldCanY = cnvs.height() / 2;\n    const oldCanX = cnvs.width() / 2;\n    cnvs.width(w).height(h);\n    const newCanY = h / 2;\n    const newCanX = w / 2;\n    const offset = svgCanvas.updateCanvas(w, h);\n\n    const ratio = newCanX / oldCanX;\n\n    const scrollX = w / 2 - wOrig / 2;\n    const scrollY = h / 2 - hOrig / 2;\n\n    if (!newCtr) {\n      const oldDistX = oldCtr.x - oldCanX;\n      const newX = newCanX + oldDistX * ratio;\n\n      const oldDistY = oldCtr.y - oldCanY;\n      const newY = newCanY + oldDistY * ratio;\n\n      newCtr = {\n        x: newX,\n        y: newY\n      };\n    } else {\n      newCtr.x += offset.x;\n      newCtr.y += offset.y;\n    }\n\n    if (center) {\n      // Go to top-left for larger documents\n      if (svgCanvas.contentW > wArea.width()) {\n        // Top-left\n        workarea[0].scrollLeft = offset.x - 10;\n        workarea[0].scrollTop = offset.y - 10;\n      } else {\n        // Center\n        wArea[0].scrollLeft = scrollX;\n        wArea[0].scrollTop = scrollY;\n      }\n    } else {\n      wArea[0].scrollLeft = newCtr.x - wOrig / 2;\n      wArea[0].scrollTop = newCtr.y - hOrig / 2;\n    }\n    if (curConfig.showRulers) {\n      updateRulers(cnvs, zoom);\n      workarea.scroll();\n    }\n    if (urldata.storagePrompt !== true && !editor.storagePromptClosed) {\n      $('#dialog_box').hide();\n    }\n  };\n\n  /**\n   * @fires module:svgcanvas.SvgCanvas#event:ext-toolButtonStateUpdate\n   * @returns {undefined}\n   */\n  const updateToolButtonState = function () {\n    let index, button;\n    const bNoFill = (svgCanvas.getColor('fill') === 'none');\n    const bNoStroke = (svgCanvas.getColor('stroke') === 'none');\n    const buttonsNeedingStroke = ['#tool_fhpath', '#tool_line'];\n    const buttonsNeedingFillAndStroke = ['#tools_rect .tool_button', '#tools_ellipse .tool_button', '#tool_text', '#tool_path'];\n    if (bNoStroke) {\n      for (index in buttonsNeedingStroke) {\n        button = buttonsNeedingStroke[index];\n        if ($(button).hasClass('tool_button_current')) {\n          clickSelect();\n        }\n        $(button).addClass('disabled');\n      }\n    } else {\n      for (index in buttonsNeedingStroke) {\n        button = buttonsNeedingStroke[index];\n        $(button).removeClass('disabled');\n      }\n    }\n\n    if (bNoStroke && bNoFill) {\n      for (index in buttonsNeedingFillAndStroke) {\n        button = buttonsNeedingFillAndStroke[index];\n        if ($(button).hasClass('tool_button_current')) {\n          clickSelect();\n        }\n        $(button).addClass('disabled');\n      }\n    } else {\n      for (index in buttonsNeedingFillAndStroke) {\n        button = buttonsNeedingFillAndStroke[index];\n        $(button).removeClass('disabled');\n      }\n    }\n\n    svgCanvas.runExtensions('toolButtonStateUpdate', /** @type {module:svgcanvas.SvgCanvas#event:ext-toolButtonStateUpdate} */ {\n      nofill: bNoFill,\n      nostroke: bNoStroke\n    });\n\n    // Disable flyouts if all inside are disabled\n    $('.tools_flyout').each(function () {\n      const shower = $('#' + this.id + '_show');\n      let hasEnabled = false;\n      $(this).children().each(function () {\n        if (!$(this).hasClass('disabled')) {\n          hasEnabled = true;\n        }\n      });\n      shower.toggleClass('disabled', !hasEnabled);\n    });\n\n    operaRepaint();\n  };\n\n  // Updates the toolbar (colors, opacity, etc) based on the selected element\n  // This function also updates the opacity and id elements that are in the context panel\n  const updateToolbar = function () {\n    let i, len;\n    if (selectedElement != null) {\n      switch (selectedElement.tagName) {\n      case 'use':\n      case 'image':\n      case 'foreignObject':\n        break;\n      case 'g':\n      case 'a':\n        // Look for common styles\n        const childs = selectedElement.getElementsByTagName('*');\n        let gWidth = null;\n        for (i = 0, len = childs.length; i < len; i++) {\n          const swidth = childs[i].getAttribute('stroke-width');\n\n          if (i === 0) {\n            gWidth = swidth;\n          } else if (gWidth !== swidth) {\n            gWidth = null;\n          }\n        }\n\n        $('#stroke_width').val(gWidth === null ? '' : gWidth);\n\n        paintBox.fill.update(true);\n        paintBox.stroke.update(true);\n\n        break;\n      default:\n        paintBox.fill.update(true);\n        paintBox.stroke.update(true);\n\n        $('#stroke_width').val(selectedElement.getAttribute('stroke-width') || 1);\n        $('#stroke_style').val(selectedElement.getAttribute('stroke-dasharray') || 'none');\n\n        let attr = selectedElement.getAttribute('stroke-linejoin') || 'miter';\n\n        if ($('#linejoin_' + attr).length) {\n          setStrokeOpt($('#linejoin_' + attr)[0]);\n        }\n\n        attr = selectedElement.getAttribute('stroke-linecap') || 'butt';\n\n        if ($('#linecap_' + attr).length) {\n          setStrokeOpt($('#linecap_' + attr)[0]);\n        }\n      }\n    }\n\n    // All elements including image and group have opacity\n    if (selectedElement != null) {\n      const opacPerc = (selectedElement.getAttribute('opacity') || 1.0) * 100;\n      $('#group_opacity').val(opacPerc);\n      $('#opac_slider').slider('option', 'value', opacPerc);\n      $('#elem_id').val(selectedElement.id);\n      $('#elem_class').val(selectedElement.getAttribute('class'));\n    }\n\n    updateToolButtonState();\n  };\n\n  // updates the context panel tools based on the selected element\n  const updateContextPanel = function () {\n    let elem = selectedElement;\n    // If element has just been deleted, consider it null\n    if (elem != null && !elem.parentNode) { elem = null; }\n    const currentLayerName = svgCanvas.getCurrentDrawing().getCurrentLayerName();\n    const currentMode = svgCanvas.getMode();\n    const unit = curConfig.baseUnit !== 'px' ? curConfig.baseUnit : null;\n\n    const isNode = currentMode === 'pathedit'; // elem ? (elem.id && elem.id.startsWith('pathpointgrip')) : false;\n    const menuItems = $('#cmenu_canvas li');\n    $('#selected_panel, #multiselected_panel, #g_panel, #rect_panel, #circle_panel,' +\n      '#ellipse_panel, #line_panel, #text_panel, #image_panel, #container_panel,' +\n      ' #use_panel, #a_panel').hide();\n    if (elem != null) {\n      const elname = elem.nodeName;\n      // If this is a link with no transform and one child, pretend\n      // its child is selected\n      // if (elname === 'a') { // && !$(elem).attr('transform')) {\n      //   elem = elem.firstChild;\n      // }\n\n      const angle = svgCanvas.getRotationAngle(elem);\n      $('#angle').val(angle);\n\n      const blurval = svgCanvas.getBlur(elem);\n      $('#blur').val(blurval);\n      $('#blur_slider').slider('option', 'value', blurval);\n\n      if (svgCanvas.addedNew) {\n        if (elname === 'image' && svgCanvas.getMode() === 'image') {\n          // Prompt for URL if not a data URL\n          if (!svgCanvas.getHref(elem).startsWith('data:')) {\n            promptImgURL({cancelDeletes: true});\n          }\n        }\n        /* else if (elname == 'text') {\n          // TODO: Do something here for new text\n        } */\n      }\n\n      if (!isNode && currentMode !== 'pathedit') {\n        $('#selected_panel').show();\n        // Elements in this array already have coord fields\n        if (['line', 'circle', 'ellipse'].includes(elname)) {\n          $('#xy_panel').hide();\n        } else {\n          let x, y;\n\n          // Get BBox vals for g, polyline and path\n          if (['g', 'polyline', 'path'].includes(elname)) {\n            const bb = svgCanvas.getStrokedBBox([elem]);\n            if (bb) {\n              ({x, y} = bb);\n            }\n          } else {\n            x = elem.getAttribute('x');\n            y = elem.getAttribute('y');\n          }\n\n          if (unit) {\n            x = convertUnit(x);\n            y = convertUnit(y);\n          }\n\n          $('#selected_x').val(x || 0);\n          $('#selected_y').val(y || 0);\n          $('#xy_panel').show();\n        }\n\n        // Elements in this array cannot be converted to a path\n        const noPath = !['image', 'text', 'path', 'g', 'use'].includes(elname);\n        $('#tool_topath').toggle(noPath);\n        $('#tool_reorient').toggle(elname === 'path');\n        $('#tool_reorient').toggleClass('disabled', angle === 0);\n      } else {\n        const point = path.getNodePoint();\n        $('#tool_add_subpath').removeClass('push_button_pressed').addClass('tool_button');\n        $('#tool_node_delete').toggleClass('disabled', !path.canDeleteNodes);\n\n        // Show open/close button based on selected point\n        setIcon('#tool_openclose_path', path.closed_subpath ? 'open_path' : 'close_path');\n\n        if (point) {\n          const segType = $('#seg_type');\n          if (unit) {\n            point.x = convertUnit(point.x);\n            point.y = convertUnit(point.y);\n          }\n          $('#path_node_x').val(point.x);\n          $('#path_node_y').val(point.y);\n          if (point.type) {\n            segType.val(point.type).removeAttr('disabled');\n          } else {\n            segType.val(4).attr('disabled', 'disabled');\n          }\n        }\n        return;\n      }\n\n      // update contextual tools here\n      const panels = {\n        g: [],\n        a: [],\n        rect: ['rx', 'width', 'height'],\n        image: ['width', 'height'],\n        circle: ['cx', 'cy', 'r'],\n        ellipse: ['cx', 'cy', 'rx', 'ry'],\n        line: ['x1', 'y1', 'x2', 'y2'],\n        text: [],\n        use: []\n      };\n\n      const {tagName} = elem;\n\n      // if ($(elem).data('gsvg')) {\n      //   $('#g_panel').show();\n      // }\n\n      let linkHref = null;\n      if (tagName === 'a') {\n        linkHref = svgCanvas.getHref(elem);\n        $('#g_panel').show();\n      }\n\n      if (elem.parentNode.tagName === 'a') {\n        if (!$(elem).siblings().length) {\n          $('#a_panel').show();\n          linkHref = svgCanvas.getHref(elem.parentNode);\n        }\n      }\n\n      // Hide/show the make_link buttons\n      $('#tool_make_link, #tool_make_link').toggle(!linkHref);\n\n      if (linkHref) {\n        $('#link_url').val(linkHref);\n      }\n\n      if (panels[tagName]) {\n        const curPanel = panels[tagName];\n\n        $('#' + tagName + '_panel').show();\n\n        $.each(curPanel, function (i, item) {\n          let attrVal = elem.getAttribute(item);\n          if (curConfig.baseUnit !== 'px' && elem[item]) {\n            const bv = elem[item].baseVal.value;\n            attrVal = convertUnit(bv);\n          }\n          $('#' + tagName + '_' + item).val(attrVal || 0);\n        });\n\n        if (tagName === 'text') {\n          $('#text_panel').css('display', 'inline');\n          $('#tool_font_size').css('display', 'inline');\n          if (svgCanvas.getItalic()) {\n            $('#tool_italic').addClass('push_button_pressed').removeClass('tool_button');\n          } else {\n            $('#tool_italic').removeClass('push_button_pressed').addClass('tool_button');\n          }\n          if (svgCanvas.getBold()) {\n            $('#tool_bold').addClass('push_button_pressed').removeClass('tool_button');\n          } else {\n            $('#tool_bold').removeClass('push_button_pressed').addClass('tool_button');\n          }\n          $('#font_family').val(elem.getAttribute('font-family'));\n          $('#font_size').val(elem.getAttribute('font-size'));\n          $('#text').val(elem.textContent);\n          if (svgCanvas.addedNew) {\n            // Timeout needed for IE9\n            setTimeout(function () {\n              $('#text').focus().select();\n            }, 100);\n          }\n        // text\n        } else if (tagName === 'image' && svgCanvas.getMode() === 'image') {\n          setImageURL(svgCanvas.getHref(elem));\n        // image\n        } else if (tagName === 'g' || tagName === 'use') {\n          $('#container_panel').show();\n          const title = svgCanvas.getTitle();\n          const label = $('#g_title')[0];\n          label.value = title;\n          setInputWidth(label);\n          $('#g_title').prop('disabled', tagName === 'use');\n        }\n      }\n      menuItems[(tagName === 'g' ? 'en' : 'dis') + 'ableContextMenuItems']('#ungroup');\n      menuItems[((tagName === 'g' || !multiselected) ? 'dis' : 'en') + 'ableContextMenuItems']('#group');\n    // if (elem != null)\n    } else if (multiselected) {\n      $('#multiselected_panel').show();\n      menuItems\n        .enableContextMenuItems('#group')\n        .disableContextMenuItems('#ungroup');\n    } else {\n      menuItems.disableContextMenuItems('#delete,#cut,#copy,#group,#ungroup,#move_front,#move_up,#move_down,#move_back');\n    }\n\n    // update history buttons\n    $('#tool_undo').toggleClass('disabled', undoMgr.getUndoStackSize() === 0);\n    $('#tool_redo').toggleClass('disabled', undoMgr.getRedoStackSize() === 0);\n\n    svgCanvas.addedNew = false;\n\n    if ((elem && !isNode) || multiselected) {\n      // update the selected elements' layer\n      $('#selLayerNames').removeAttr('disabled').val(currentLayerName);\n\n      // Enable regular menu options\n      canvMenu.enableContextMenuItems('#delete,#cut,#copy,#move_front,#move_up,#move_down,#move_back');\n    } else {\n      $('#selLayerNames').attr('disabled', 'disabled');\n    }\n  };\n\n  const updateWireFrame = function () {\n    // Test support\n    if (supportsNonSS) { return; }\n\n    const rule = '#workarea.wireframe #svgcontent * { stroke-width: ' + 1 / svgCanvas.getZoom() + 'px; }';\n    $('#wireframe_rules').text(workarea.hasClass('wireframe') ? rule : '');\n  };\n\n  let curContext = '';\n\n  const updateTitle = function (title) {\n    title = title || svgCanvas.getDocumentTitle();\n    const newTitle = origTitle + (title ? ': ' + title : '');\n\n    // Remove title update with current context info, isn't really necessary\n    // if (curContext) {\n    //   new_title = new_title + curContext;\n    // }\n    $('title:first').text(newTitle);\n  };\n\n  // called when we've selected a different element\n  /**\n  *\n  * @param {external:Window} win\n  * @param {module:svgcanvas.SvgCanvas#event:selected} elems Array of elements that were selected\n  * @listens module:svgcanvas.SvgCanvas#event:selected\n  * @fires module:svgcanvas.SvgCanvas#event:ext-selectedChanged\n  * @returns {undefined}\n  */\n  const selectedChanged = function (win, elems) {\n    const mode = svgCanvas.getMode();\n    if (mode === 'select') {\n      setSelectMode();\n    }\n    const isNode = mode === 'pathedit';\n    // if elems[1] is present, then we have more than one element\n    selectedElement = (elems.length === 1 || elems[1] == null ? elems[0] : null);\n    multiselected = (elems.length >= 2 && elems[1] != null);\n    if (selectedElement != null) {\n      // unless we're already in always set the mode of the editor to select because\n      // upon creation of a text element the editor is switched into\n      // select mode and this event fires - we need our UI to be in sync\n\n      if (!isNode) {\n        updateToolbar();\n      }\n    } // if (elem != null)\n\n    // Deal with pathedit mode\n    togglePathEditMode(isNode, elems);\n    updateContextPanel();\n    svgCanvas.runExtensions('selectedChanged', /** @type {module:svgcanvas.SvgCanvas#event:ext-selectedChanged} */ {\n      elems,\n      selectedElement,\n      multiselected\n    });\n  };\n\n  // Call when part of element is in process of changing, generally\n  // on mousemove actions like rotate, move, etc.\n  /**\n   * @param {external:Window} win\n   * @param {module:svgcanvas.SvgCanvas#event:transition} elems\n   * @listens module:svgcanvas.SvgCanvas#event:transition\n   * @fires module:svgcanvas.SvgCanvas#event:ext-elementTransition\n   * @returns {undefined}\n   */\n  const elementTransition = function (win, elems) {\n    const mode = svgCanvas.getMode();\n    const elem = elems[0];\n\n    if (!elem) {\n      return;\n    }\n\n    multiselected = (elems.length >= 2 && elems[1] != null);\n    // Only updating fields for single elements for now\n    if (!multiselected) {\n      switch (mode) {\n      case 'rotate':\n        const ang = svgCanvas.getRotationAngle(elem);\n        $('#angle').val(ang);\n        $('#tool_reorient').toggleClass('disabled', ang === 0);\n        break;\n\n      // TODO: Update values that change on move/resize, etc\n      // case 'select':\n      // case 'resize':\n      //   break;\n      }\n    }\n    svgCanvas.runExtensions('elementTransition', /** @type {module:svgcanvas.SvgCanvas#event:ext-elementTransition} */ {\n      elems\n    });\n  };\n\n  /**\n   * Test whether an element is a layer or not.\n   * @param {SVGGElement} elem - The SVGGElement to test.\n   * @returns {boolean} True if the element is a layer\n   */\n  function isLayer (elem) {\n    return elem && elem.tagName === 'g' && Layer.CLASS_REGEX.test(elem.getAttribute('class'));\n  }\n\n  // called when any element has changed\n  /**\n   * @param {external:Window} win\n   * @param {module:svgcanvas.SvgCanvas#event:changed} elems\n   * @listens module:svgcanvas.SvgCanvas#event:changed\n   * @fires module:svgcanvas.SvgCanvas#event:ext-elementChanged\n   * @returns {undefined}\n   */\n  const elementChanged = function (win, elems) {\n    const mode = svgCanvas.getMode();\n    if (mode === 'select') {\n      setSelectMode();\n    }\n\n    for (let i = 0; i < elems.length; ++i) {\n      const elem = elems[i];\n\n      const isSvgElem = (elem && elem.tagName === 'svg');\n      if (isSvgElem || isLayer(elem)) {\n        populateLayers();\n        // if the element changed was the svg, then it could be a resolution change\n        if (isSvgElem) {\n          updateCanvas();\n        }\n      // Update selectedElement if element is no longer part of the image.\n      // This occurs for the text elements in Firefox\n      } else if (elem && selectedElement && selectedElement.parentNode == null) {\n        // || elem && elem.tagName == \"path\" && !multiselected) { // This was added in r1430, but not sure why\n        selectedElement = elem;\n      }\n    }\n\n    editor.showSaveWarning = true;\n\n    // we update the contextual panel with potentially new\n    // positional/sizing information (we DON'T want to update the\n    // toolbar here as that creates an infinite loop)\n    // also this updates the history buttons\n\n    // we tell it to skip focusing the text control if the\n    // text element was previously in focus\n    updateContextPanel();\n\n    // In the event a gradient was flipped:\n    if (selectedElement && mode === 'select') {\n      paintBox.fill.update();\n      paintBox.stroke.update();\n    }\n\n    svgCanvas.runExtensions('elementChanged', /** @type {module:svgcanvas.SvgCanvas#event:ext-elementChanged} */ {\n      elems\n    });\n  };\n\n  /**\n   * @returns {undefined}\n   */\n  const zoomDone = function () {\n    updateWireFrame();\n    // updateCanvas(); // necessary?\n  };\n\n  /**\n  * @typedef {PlainObject} module:SVGEditor.BBoxObjectWithFactor (like `DOMRect`)\n  * @property {Float} x\n  * @property {Float} y\n  * @property {Float} width\n  * @property {Float} height\n  * @property {Float} [factor] Needed if width or height are 0\n  * @property {Float} [zoom]\n  * @see module:svgcanvas.SvgCanvas#event:zoomed\n  */\n\n  /**\n  * @function module:svgcanvas.SvgCanvas#zoomChanged\n  * @param {external:Window} win\n  * @param {module:svgcanvas.SvgCanvas#event:zoomed} bbox\n  * @param {boolean} autoCenter\n  * @listens module:svgcanvas.SvgCanvas#event:zoomed\n  * @returns {undefined}\n  */\n  const zoomChanged = svgCanvas.zoomChanged = function (win, bbox, autoCenter) {\n    const scrbar = 15,\n      // res = svgCanvas.getResolution(), // Currently unused\n      wArea = workarea;\n    // const canvasPos = $('#svgcanvas').position(); // Currently unused\n    const zInfo = svgCanvas.setBBoxZoom(bbox, wArea.width() - scrbar, wArea.height() - scrbar);\n    if (!zInfo) { return; }\n    const zoomlevel = zInfo.zoom,\n      bb = zInfo.bbox;\n\n    if (zoomlevel < 0.001) {\n      changeZoom({value: 0.1});\n      return;\n    }\n\n    $('#zoom').val((zoomlevel * 100).toFixed(1));\n\n    if (autoCenter) {\n      updateCanvas();\n    } else {\n      updateCanvas(false, {x: bb.x * zoomlevel + (bb.width * zoomlevel) / 2, y: bb.y * zoomlevel + (bb.height * zoomlevel) / 2});\n    }\n\n    if (svgCanvas.getMode() === 'zoom' && bb.width) {\n      // Go to select if a zoom box was drawn\n      setSelectMode();\n    }\n\n    zoomDone();\n  };\n\n  const changeZoom = function (ctl) {\n    const zoomlevel = ctl.value / 100;\n    if (zoomlevel < 0.001) {\n      ctl.value = 0.1;\n      return;\n    }\n    const zoom = svgCanvas.getZoom();\n    const wArea = workarea;\n\n    zoomChanged(window, {\n      width: 0,\n      height: 0,\n      // center pt of scroll position\n      x: (wArea[0].scrollLeft + wArea.width() / 2) / zoom,\n      y: (wArea[0].scrollTop + wArea.height() / 2) / zoom,\n      zoom: zoomlevel\n    }, true);\n  };\n\n  $('#cur_context_panel').delegate('a', 'click', function () {\n    const link = $(this);\n    if (link.attr('data-root')) {\n      svgCanvas.leaveContext();\n    } else {\n      svgCanvas.setContext(link.text());\n    }\n    svgCanvas.clearSelection();\n    return false;\n  });\n\n  /**\n   * @param {external:Window} win\n   * @param {module:svgcanvas.SvgCanvas#event:contextset} context\n   * @listens module:svgcanvas.SvgCanvas#event:contextset\n   * @returns {undefined}\n   */\n  const contextChanged = function (win, context) {\n    let linkStr = '';\n    if (context) {\n      let str = '';\n      linkStr = '<a href=\"#\" data-root=\"y\">' + svgCanvas.getCurrentDrawing().getCurrentLayerName() + '</a>';\n\n      $(context).parentsUntil('#svgcontent > g').andSelf().each(function () {\n        if (this.id) {\n          str += ' > ' + this.id;\n          if (this !== context) {\n            linkStr += ' > <a href=\"#\">' + this.id + '</a>';\n          } else {\n            linkStr += ' > ' + this.id;\n          }\n        }\n      });\n\n      curContext = str;\n    } else {\n      curContext = null;\n    }\n    $('#cur_context_panel').toggle(!!context).html(linkStr);\n\n    updateTitle();\n  };\n\n  // Makes sure the current selected paint is available to work with\n  const prepPaints = function () {\n    paintBox.fill.prep();\n    paintBox.stroke.prep();\n  };\n\n  const flyoutFuncs = {};\n\n  const setFlyoutTitles = function () {\n    $('.tools_flyout').each(function () {\n      const shower = $('#' + this.id + '_show');\n      if (shower.data('isLibrary')) {\n        return;\n      }\n\n      const tooltips = $(this).children().map(function () {\n        return this.title;\n      }).get();\n      shower[0].title = tooltips.join(' / ');\n    });\n  };\n\n  const allHolders = {};\n  /**\n   * @param {Object.<string, module:SVGEditor.ToolButton>} holders Key is a selector\n   * @returns {undefined}\n   */\n  const setupFlyouts = function (holders) {\n    $.each(holders, function (holdSel, btnOpts) {\n      if (!allHolders[holdSel]) {\n        allHolders[holdSel] = [];\n      }\n      allHolders[holdSel].push(...btnOpts);\n\n      const buttons = $(holdSel).children().not('.tool_button_evt_handled');\n      const showSel = holdSel + '_show';\n      const shower = $(showSel);\n      let def = false;\n      buttons.addClass('tool_button tool_button_evt_handled')\n        .unbind('click mousedown mouseup') // may not be necessary\n        .each(function () {\n          // Get this button's options\n          const idSel = '#' + this.getAttribute('id');\n          const [i, opts] = Object.entries(btnOpts).find(([i, {sel}]) => {\n            return sel === idSel;\n          });\n\n          // Remember the function that goes with this ID\n          flyoutFuncs[opts.sel] = opts.fn;\n\n          if (opts.isDefault) { def = i; }\n\n          /**\n           * Clicking the icon in flyout should set this set's icon\n           * @param {Event} ev\n           * @returns {undefined}\n           */\n          const flyoutAction = function (ev) {\n            let options = opts;\n            // Find the currently selected tool if comes from keystroke\n            if (ev.type === 'keydown') {\n              const flyoutIsSelected = $(options.parent + '_show').hasClass('tool_button_current');\n              const currentOperation = $(options.parent + '_show').attr('data-curopt');\n              Object.entries(holders[opts.parent]).some(([i, tool]) => {\n                if (tool.sel !== currentOperation) {\n                  return;\n                }\n                if (!ev.shiftKey || !flyoutIsSelected) {\n                  options = tool;\n                } else {\n                  // If flyout is selected, allow shift key to iterate through subitems\n                  i = parseInt(i, 10);\n                  // Use `allHolders` to include both extension `includeWith` and toolbarButtons\n                  options = allHolders[opts.parent][i + 1] ||\n                    holders[opts.parent][0];\n                }\n                return true;\n              });\n            }\n            if ($(this).hasClass('disabled')) { return false; }\n            if (toolButtonClick(showSel)) {\n              options.fn();\n            }\n            let icon;\n            if (options.icon) {\n              icon = $.getSvgIcon(options.icon, true);\n            } else {\n              icon = $(options.sel).children().eq(0).clone();\n            }\n\n            icon[0].setAttribute('width', shower.width());\n            icon[0].setAttribute('height', shower.height());\n            shower.children(':not(.flyout_arrow_horiz)').remove();\n            shower.append(icon).attr('data-curopt', options.sel); // This sets the current mode\n          };\n\n          $(this).mouseup(flyoutAction);\n\n          if (opts.key) {\n            $(document).bind('keydown', opts.key[0] + ' shift+' + opts.key[0], flyoutAction);\n          }\n        });\n\n      if (def) {\n        shower.attr('data-curopt', btnOpts[def].sel);\n      } else if (!shower.attr('data-curopt')) {\n        // Set first as default\n        shower.attr('data-curopt', btnOpts[0].sel);\n      }\n\n      let timer;\n      const pos = $(showSel).position();\n\n      // Clicking the \"show\" icon should set the current mode\n      shower.mousedown(function (evt) {\n        if (shower.hasClass('disabled')) {\n          return false;\n        }\n        const holder = $(holdSel);\n        const l = pos.left + 34;\n        const w = holder.width() * -1;\n        const time = holder.data('shown_popop') ? 200 : 0;\n        timer = setTimeout(function () {\n          // Show corresponding menu\n          if (!shower.data('isLibrary')) {\n            holder.css('left', w).show().animate({\n              left: l\n            }, 150);\n          } else {\n            holder.css('left', l).show();\n          }\n          holder.data('shown_popop', true);\n        }, time);\n        evt.preventDefault();\n      }).mouseup(function (evt) {\n        clearTimeout(timer);\n        const opt = $(this).attr('data-curopt');\n        // Is library and popped up, so do nothing\n        if (shower.data('isLibrary') && $(showSel.replace('_show', '')).is(':visible')) {\n          toolButtonClick(showSel, true);\n          return;\n        }\n        if (toolButtonClick(showSel) && flyoutFuncs[opt]) {\n          flyoutFuncs[opt]();\n        }\n      });\n      // $('#tools_rect').mouseleave(function () { $('#tools_rect').fadeOut(); });\n    });\n    setFlyoutTitles();\n    setFlyoutPositions();\n  };\n\n  const makeFlyoutHolder = function (id, child) {\n    const div = $('<div>', {\n      class: 'tools_flyout',\n      id\n    }).appendTo('#svg_editor').append(child);\n\n    return div;\n  };\n\n  // TODO: Combine this with addDropDown or find other way to optimize\n  const addAltDropDown = function (elem, list, callback, opts) {\n    const button = $(elem);\n    const {dropUp} = opts;\n    list = $(list);\n    if (dropUp) {\n      $(elem).addClass('dropup');\n    }\n    list.find('li').bind('mouseup', function () {\n      if (opts.seticon) {\n        setIcon('#cur_' + button[0].id, $(this).children());\n        $(this).addClass('current').siblings().removeClass('current');\n      }\n      callback.apply(this, arguments);\n    });\n\n    let onButton = false;\n    $(window).mouseup(function (evt) {\n      if (!onButton) {\n        button.removeClass('down');\n        list.hide();\n        list.css({top: 0, left: 0});\n      }\n      onButton = false;\n    });\n\n    // const height = list.height(); // Currently unused\n    button.bind('mousedown', function () {\n      const off = button.offset();\n      if (dropUp) {\n        off.top -= list.height();\n        off.left += 8;\n      } else {\n        off.top += button.height();\n      }\n      list.offset(off);\n\n      if (!button.hasClass('down')) {\n        list.show();\n        onButton = true;\n      } else {\n        // CSS position must be reset for Webkit\n        list.hide();\n        list.css({top: 0, left: 0});\n      }\n      button.toggleClass('down');\n    }).hover(function () {\n      onButton = true;\n    }).mouseout(function () {\n      onButton = false;\n    });\n\n    if (opts.multiclick) {\n      list.mousedown(function () {\n        onButton = true;\n      });\n    }\n  };\n\n  const extsPreLang = [];\n  /**\n   * @param {external:Window} win\n   * @param {module:svgcanvas.SvgCanvas#event:extension_added} ext\n   * @listens module:svgcanvas.SvgCanvas#event:extension_added\n   * @returns {Promise} Resolves to `undefined`\n   */\n  const extAdded = function (win, ext) {\n    if (!ext) {\n      return;\n    }\n    let cbCalled = false;\n    let resizeDone = false;\n\n    if (ext.langReady) {\n      if (editor.langChanged) { // We check for this since the \"lang\" pref could have been set by storage\n        const lang = $.pref('lang');\n        ext.langReady({\n          lang,\n          uiStrings,\n          importLocale: getImportLocale({defaultLang: lang, defaultName: ext.name})\n        });\n      } else {\n        extsPreLang.push(ext);\n      }\n    }\n\n    function prepResize () {\n      if (resizeTimer) {\n        clearTimeout(resizeTimer);\n        resizeTimer = null;\n      }\n      if (!resizeDone) {\n        resizeTimer = setTimeout(function () {\n          resizeDone = true;\n          setIconSize($.pref('iconsize'));\n        }, 50);\n      }\n    }\n\n    const runCallback = function () {\n      if (ext.callback && !cbCalled) {\n        cbCalled = true;\n        ext.callback.call(editor);\n      }\n    };\n\n    const btnSelects = [];\n\n    /**\n    * @typedef {PlainObject} module:SVGEditor.ContextTool\n    * @property {string} panel The ID of the existing panel to which the tool is being added. Required.\n    * @property {string} id The ID of the actual tool element. Required.\n    * @property {PlainObject.<string, external:jQuery.Function>|PlainObject.<\"change\", external:jQuery.Function>} events DOM event names keyed to associated functions. Example: `{change () { alert('Option was changed') } }`. \"change\" event is one specifically handled for the \"button-select\" type. Required.\n    * @property {string} title The tooltip text that will appear when the user hovers over the tool. Required.\n    * @property {\"tool_button\"|\"select\"|\"button-select\"|\"input\"|string} type The type of tool being added. Expected.\n    * @property {PlainObject.<string, string>} [options] List of options and their labels for select tools. Example: `{1: 'One', 2: 'Two', all: 'All' }`. Required by \"select\" tools.\n    * @property {string} [container_id] The ID to be given to the tool's container element.\n    * @property {string} [defval] Default value\n    * @property {string|Integer} [colnum] Added as part of the option list class.\n    * @property {string} [label] Label associated with the tool, visible in the UI\n    * @property {Integer} [size] Value of the \"size\" attribute of the tool input\n    * @property {module:jQuerySpinButton.SpinButtonConfig} [spindata] When added to a tool of type \"input\", this tool becomes a \"spinner\" which allows the number to be in/decreased.\n    */\n    if (ext.context_tools) {\n      $.each(ext.context_tools, function (i, tool) {\n        // Add select tool\n        const contId = tool.container_id ? (' id=\"' + tool.container_id + '\"') : '';\n\n        let panel = $('#' + tool.panel);\n        // create the panel if it doesn't exist\n        if (!panel.length) {\n          panel = $('<div>', {id: tool.panel}).appendTo('#tools_top');\n        }\n\n        let html;\n        // TODO: Allow support for other types, or adding to existing tool\n        switch (tool.type) {\n        case 'tool_button':\n          html = '<div class=\"tool_button\">' + tool.id + '</div>';\n          const div = $(html).appendTo(panel);\n          if (tool.events) {\n            $.each(tool.events, function (evt, func) {\n              $(div).bind(evt, func);\n            });\n          }\n          break;\n        case 'select':\n          html = '<label' + contId + '>' +\n            '<select id=\"' + tool.id + '\">';\n          $.each(tool.options, function (val, text) {\n            const sel = (val === tool.defval) ? ' selected' : '';\n            html += '<option value=\"' + val + '\"' + sel + '>' + text + '</option>';\n          });\n          html += '</select></label>';\n          // Creates the tool, hides & adds it, returns the select element\n          const sel = $(html).appendTo(panel).find('select');\n\n          $.each(tool.events, function (evt, func) {\n            $(sel).bind(evt, func);\n          });\n          break;\n        case 'button-select':\n          html = '<div id=\"' + tool.id + '\" class=\"dropdown toolset\" title=\"' + tool.title + '\">' +\n            '<div id=\"cur_' + tool.id + '\" class=\"icon_label\"></div><button></button></div>';\n\n          const list = $('<ul id=\"' + tool.id + '_opts\"></ul>').appendTo('#option_lists');\n\n          if (tool.colnum) {\n            list.addClass('optcols' + tool.colnum);\n          }\n\n          // Creates the tool, hides & adds it, returns the select element\n          /* const dropdown = */ $(html).appendTo(panel).children();\n\n          btnSelects.push({\n            elem: ('#' + tool.id),\n            list: ('#' + tool.id + '_opts'),\n            title: tool.title,\n            callback: tool.events.change,\n            cur: ('#cur_' + tool.id)\n          });\n\n          break;\n        case 'input':\n          html = '<label' + contId + '>' +\n            '<span id=\"' + tool.id + '_label\">' +\n            tool.label + ':</span>' +\n            '<input id=\"' + tool.id + '\" title=\"' + tool.title +\n            '\" size=\"' + (tool.size || '4') + '\" value=\"' + (tool.defval || '') + '\" type=\"text\"/></label>';\n\n          // Creates the tool, hides & adds it, returns the select element\n\n          // Add to given tool.panel\n          const inp = $(html).appendTo(panel).find('input');\n\n          if (tool.spindata) {\n            inp.SpinButton(tool.spindata);\n          }\n\n          if (tool.events) {\n            $.each(tool.events, function (evt, func) {\n              inp.bind(evt, func);\n            });\n          }\n          break;\n\n        default:\n          break;\n        }\n      });\n    }\n\n    const {svgicons} = ext;\n    if (ext.buttons) {\n      const fallbackObj = {},\n        placementObj = {},\n        holders = {};\n\n      /**\n      * @typedef {GenericArray} module:SVGEditor.KeyArray\n      * @property {string} 0 The key to bind (on `keydown`)\n      * @property {boolean} 1 Whether to `preventDefault` on the `keydown` event\n      * @property {boolean} 2 Not apparently in use (NoDisableInInput)\n      */\n      /**\n       * @typedef {string|module:SVGEditor.KeyArray} module:SVGEditor.Key\n       */\n      /**\n      * @typedef {PlainObject} module:SVGEditor.Button\n      * @property {string} id A unique identifier for this button. If SVG icons are used, this must match the ID used in the icon file. Required.\n      * @property {\"mode_flyout\"|\"mode\"|\"context\"|\"app_menu\"} type Type of button. Required.\n      * @property {string} title The tooltip text that will appear when the user hovers over the icon. Required.\n      * @property {PlainObject.<string, external:jQuery.Function>|PlainObject.<\"click\", external:jQuery.Function>} events DOM event names with associated functions. Example: `{click () { alert('Button was clicked') } }`. Click is used with `includeWith` and `type` of \"mode_flyout\" (and \"mode\"); any events may be added if `list` is not present. Expected.\n      * @property {string} panel The ID of the context panel to be included, if type is \"context\". Required only if type is \"context\".\n      * @property {string} icon The file path to the raster version of the icon image source. Required only if no `svgicons` is supplied from [ExtensionInitResponse]{@link module:svgcanvas.ExtensionInitResponse}.\n      * @property {string} [svgicon] If absent, will utilize the button \"id\"; used to set \"placement\" on the `svgIcons` call\n      * @property {string} [list] Points to the \"id\" of a `context_tools` item of type \"button-select\" into which the button will be added as a panel list item\n      * @property {Integer} [position] The numeric index for placement; defaults to last position (as of the time of extension addition) if not present. For use with {@link http://api.jquery.com/eq/}.\n      * @property {boolean} [isDefault] Whether or not the button is the default. Used with `list`.\n      * @property {PlainObject} [includeWith] Object with flyout menu data\n      * @property {boolean} [includeWith.isDefault] Indicates whether button is default in flyout list or not.\n      * @property {string} includeWith.button jQuery selector of the existing button to be joined. Example: '#tool_line'. Required if `includeWith` is used.\n      * @property {\"last\"|Integer} [includeWith.position] Position of icon in flyout list; will be added to end if not indicated. Integer is for use with {@link http://api.jquery.com/eq/}.\n      * @property {module:SVGEditor.Key} [key] The key to bind to the button\n      */\n      // Add buttons given by extension\n      $.each(ext.buttons, function (i, /** @type {module:SVGEditor.Button} */ btn) {\n        let {id} = btn;\n        let num = i;\n        // Give button a unique ID\n        while ($('#' + id).length) {\n          id = btn.id + '_' + (++num);\n        }\n\n        let icon;\n        if (!svgicons) {\n          icon = $('<img src=\"' + btn.icon + '\">');\n        } else {\n          fallbackObj[id] = btn.icon;\n          const svgicon = btn.svgicon || btn.id;\n          if (btn.type === 'app_menu') {\n            placementObj['#' + id + ' > div'] = svgicon;\n          } else {\n            placementObj['#' + id] = svgicon;\n          }\n        }\n\n        let cls, parent;\n\n        // Set button up according to its type\n        switch (btn.type) {\n        case 'mode_flyout':\n        case 'mode':\n          cls = 'tool_button';\n          parent = '#tools_left';\n          break;\n        case 'context':\n          cls = 'tool_button';\n          parent = '#' + btn.panel;\n          // create the panel if it doesn't exist\n          if (!$(parent).length) {\n            $('<div>', {id: btn.panel}).appendTo('#tools_top');\n          }\n          break;\n        case 'app_menu':\n          cls = '';\n          parent = '#main_menu ul';\n          break;\n        }\n        let flyoutHolder, curH, showBtn, refData, refBtn;\n        const button = $((btn.list || btn.type === 'app_menu') ? '<li/>' : '<div/>')\n          .attr('id', id)\n          .attr('title', btn.title)\n          .addClass(cls);\n        if (!btn.includeWith && !btn.list) {\n          if ('position' in btn) {\n            if ($(parent).children().eq(btn.position).length) {\n              $(parent).children().eq(btn.position).before(button);\n            } else {\n              $(parent).children().last().before(button);\n            }\n          } else {\n            button.appendTo(parent);\n          }\n\n          if (btn.type === 'mode_flyout') {\n          // Add to flyout menu / make flyout menu\n            // const opts = btn.includeWith;\n            // // opts.button, default, position\n            refBtn = $(button);\n\n            flyoutHolder = refBtn.parent();\n            // Create a flyout menu if there isn't one already\n            let tlsId;\n            if (!refBtn.parent().hasClass('tools_flyout')) {\n              // Create flyout placeholder\n              tlsId = refBtn[0].id.replace('tool_', 'tools_');\n              showBtn = refBtn.clone()\n                .attr('id', tlsId + '_show')\n                .append($('<div>', {class: 'flyout_arrow_horiz'}));\n\n              refBtn.before(showBtn);\n\n              // Create a flyout div\n              flyoutHolder = makeFlyoutHolder(tlsId, refBtn);\n              flyoutHolder.data('isLibrary', true);\n              showBtn.data('isLibrary', true);\n            }\n            // refData = Actions.getButtonData(opts.button);\n\n            placementObj['#' + tlsId + '_show'] = btn.id;\n            // TODO: Find way to set the current icon using the iconloader if this is not default\n\n            // Include data for extension button as well as ref button\n            curH = holders['#' + flyoutHolder[0].id] = [{\n              sel: '#' + id,\n              fn: btn.events.click,\n              icon: btn.id,\n              // key: btn.key,\n              isDefault: true\n            }]; // , refData\n            //\n            // // {sel:'#tool_rect', fn: clickRect, evt: 'mouseup', key: 4, parent: '#tools_rect', icon: 'rect'}\n            //\n            // const pos = ('position' in opts)?opts.position:'last';\n            // const len = flyoutHolder.children().length;\n            //\n            // // Add at given position or end\n            // if (!isNaN(pos) && pos >= 0 && pos < len) {\n            //   flyoutHolder.children().eq(pos).before(button);\n            // } else {\n            //   flyoutHolder.append(button);\n            //   curH.reverse();\n            // }\n          } else if (btn.type === 'app_menu') {\n            button.append('<div>').append(btn.title);\n          }\n        } else if (btn.list) {\n          // Add button to list\n          button.addClass('push_button');\n          $('#' + btn.list + '_opts').append(button);\n          if (btn.isDefault) {\n            $('#cur_' + btn.list).append(button.children().clone());\n            const svgicon = btn.svgicon || btn.id;\n            placementObj['#cur_' + btn.list] = svgicon;\n          }\n        } else if (btn.includeWith) {\n          // Add to flyout menu / make flyout menu\n          const opts = btn.includeWith;\n          // opts.button, default, position\n          refBtn = $(opts.button);\n\n          flyoutHolder = refBtn.parent();\n          // Create a flyout menu if there isn't one already\n          let tlsId;\n          if (!refBtn.parent().hasClass('tools_flyout')) {\n            // Create flyout placeholder\n            tlsId = refBtn[0].id.replace('tool_', 'tools_');\n            showBtn = refBtn.clone()\n              .attr('id', tlsId + '_show')\n              .append($('<div>', {class: 'flyout_arrow_horiz'}));\n\n            refBtn.before(showBtn);\n            // Create a flyout div\n            flyoutHolder = makeFlyoutHolder(tlsId, refBtn);\n          }\n\n          refData = Actions.getButtonData(opts.button);\n\n          if (opts.isDefault) {\n            placementObj['#' + tlsId + '_show'] = btn.id;\n          }\n          // TODO: Find way to set the current icon using the iconloader if this is not default\n\n          // Include data for extension button as well as ref button\n          curH = holders['#' + flyoutHolder[0].id] = [{\n            sel: '#' + id,\n            fn: btn.events.click,\n            icon: btn.id,\n            key: btn.key,\n            isDefault: Boolean(btn.includeWith && btn.includeWith.isDefault)\n          }, refData];\n\n          // {sel:'#tool_rect', fn: clickRect, evt: 'mouseup', key: 4, parent: '#tools_rect', icon: 'rect'}\n\n          const pos = ('position' in opts) ? opts.position : 'last';\n          const len = flyoutHolder.children().length;\n\n          // Add at given position or end\n          if (!isNaN(pos) && pos >= 0 && pos < len) {\n            flyoutHolder.children().eq(pos).before(button);\n          } else {\n            flyoutHolder.append(button);\n            curH.reverse();\n          }\n        }\n\n        if (!svgicons) {\n          button.append(icon);\n        }\n\n        if (!btn.list) {\n          // Add given events to button\n          $.each(btn.events, function (name, func) {\n            if (name === 'click' && btn.type === 'mode') {\n              if (btn.includeWith) {\n                button.bind(name, func);\n              } else {\n                button.bind(name, function () {\n                  if (toolButtonClick(button)) {\n                    func();\n                  }\n                });\n              }\n              if (btn.key) {\n                $(document).bind('keydown', btn.key, func);\n                if (btn.title) {\n                  button.attr('title', btn.title + ' [' + btn.key + ']');\n                }\n              }\n            } else {\n              button.bind(name, func);\n            }\n          });\n        }\n\n        setupFlyouts(holders);\n      });\n\n      $.each(btnSelects, function () {\n        addAltDropDown(this.elem, this.list, this.callback, {seticon: true});\n      });\n\n      if (svgicons) {\n        return new Promise((resolve, reject) => {\n          $.svgIcons(svgicons, {\n            w: 24, h: 24,\n            id_match: false,\n            no_img: (!isWebkit()),\n            fallback: fallbackObj,\n            placement: placementObj,\n            callback (icons) {\n              // Non-ideal hack to make the icon match the current size\n              // if (curPrefs.iconsize && curPrefs.iconsize !== 'm') {\n              if ($.pref('iconsize') !== 'm') {\n                prepResize();\n              }\n              runCallback();\n              resolve();\n            }\n          });\n        });\n      }\n    }\n    return runCallback();\n  };\n\n  const getPaint = function (color, opac, type) {\n    // update the editor's fill paint\n    const opts = { alpha: opac };\n    if (color.startsWith('url(#')) {\n      let refElem = svgCanvas.getRefElem(color);\n      if (refElem) {\n        refElem = refElem.cloneNode(true);\n      } else {\n        refElem = $('#' + type + '_color defs *')[0];\n      }\n      opts[refElem.tagName] = refElem;\n    } else if (color.startsWith('#')) {\n      opts.solidColor = color.substr(1);\n    } else {\n      opts.solidColor = 'none';\n    }\n    return new $.jGraduate.Paint(opts);\n  };\n\n  // $('#text').focus(function () { textBeingEntered = true; });\n  // $('#text').blur(function () { textBeingEntered = false; });\n\n  // bind the selected event to our function that handles updates to the UI\n  svgCanvas.bind('selected', selectedChanged);\n  svgCanvas.bind('transition', elementTransition);\n  svgCanvas.bind('changed', elementChanged);\n  svgCanvas.bind('saved', saveHandler);\n  svgCanvas.bind('exported', exportHandler);\n  svgCanvas.bind('exportedPDF', function (win, data) {\n    const {exportWindowName} = data;\n    if (exportWindowName) {\n      exportWindow = window.open('', exportWindowName); // A hack to get the window via JSON-able name without opening a new one\n    }\n    if (!exportWindow || exportWindow.closed) {\n      $.alert(uiStrings.notification.popupWindowBlocked);\n      return;\n    }\n    exportWindow.location.href = data.output;\n  });\n  svgCanvas.bind('zoomed', zoomChanged);\n  svgCanvas.bind('zoomDone', zoomDone);\n  svgCanvas.bind(\n    'updateCanvas',\n    /**\n     * @param {external:Window} win\n     * @param {false} center\n     * @param {module:math.XYObject} newCtr\n     * @listens module:svgcanvas.SvgCanvas#event:updateCanvas\n     * @returns {undefined}\n     */\n    function (win, {center, newCtr}) {\n      updateCanvas(center, newCtr);\n    }\n  );\n  svgCanvas.bind('contextset', contextChanged);\n  svgCanvas.bind('extension_added', extAdded);\n  svgCanvas.textActions.setInputElem($('#text')[0]);\n\n  let str = '<div class=\"palette_item\" data-rgb=\"none\"></div>';\n  $.each(palette, function (i, item) {\n    str += '<div class=\"palette_item\" style=\"background-color: ' + item + ';\" data-rgb=\"' + item + '\"></div>';\n  });\n  $('#palette').append(str);\n\n  // Set up editor background functionality\n  // TODO add checkerboard as \"pattern\"\n  const colorBlocks = ['#FFF', '#888', '#000']; // ,'url(data:image/gif;base64,R0lGODlhEAAQAIAAAP%2F%2F%2F9bW1iH5BAAAAAAALAAAAAAQABAAAAIfjG%2Bgq4jM3IFLJgpswNly%2FXkcBpIiVaInlLJr9FZWAQA7)'];\n  str = '';\n  $.each(colorBlocks, function () {\n    str += '<div class=\"color_block\" style=\"background-color:' + this + ';\"></div>';\n  });\n  $('#bg_blocks').append(str);\n  const blocks = $('#bg_blocks div');\n  const curBg = 'cur_background';\n  blocks.each(function () {\n    const blk = $(this);\n    blk.click(function () {\n      blocks.removeClass(curBg);\n      $(this).addClass(curBg);\n    });\n  });\n\n  setBackground($.pref('bkgd_color'), $.pref('bkgd_url'));\n\n  $('#image_save_opts input').val([$.pref('img_save')]);\n\n  const changeRectRadius = function (ctl) {\n    svgCanvas.setRectRadius(ctl.value);\n  };\n\n  const changeFontSize = function (ctl) {\n    svgCanvas.setFontSize(ctl.value);\n  };\n\n  const changeStrokeWidth = function (ctl) {\n    let val = ctl.value;\n    if (val === 0 && selectedElement && ['line', 'polyline'].includes(selectedElement.nodeName)) {\n      val = ctl.value = 1;\n    }\n    svgCanvas.setStrokeWidth(val);\n  };\n\n  const changeRotationAngle = function (ctl) {\n    svgCanvas.setRotationAngle(ctl.value);\n    $('#tool_reorient').toggleClass('disabled', parseInt(ctl.value, 10) === 0);\n  };\n\n  const changeOpacity = function (ctl, val) {\n    if (val == null) { val = ctl.value; }\n    $('#group_opacity').val(val);\n    if (!ctl || !ctl.handle) {\n      $('#opac_slider').slider('option', 'value', val);\n    }\n    svgCanvas.setOpacity(val / 100);\n  };\n\n  const changeBlur = function (ctl, val, noUndo) {\n    if (val == null) { val = ctl.value; }\n    $('#blur').val(val);\n    let complete = false;\n    if (!ctl || !ctl.handle) {\n      $('#blur_slider').slider('option', 'value', val);\n      complete = true;\n    }\n    if (noUndo) {\n      svgCanvas.setBlurNoUndo(val);\n    } else {\n      svgCanvas.setBlur(val, complete);\n    }\n  };\n\n  $('#stroke_style').change(function () {\n    svgCanvas.setStrokeAttr('stroke-dasharray', $(this).val());\n    operaRepaint();\n  });\n\n  $('#stroke_linejoin').change(function () {\n    svgCanvas.setStrokeAttr('stroke-linejoin', $(this).val());\n    operaRepaint();\n  });\n\n  // Lose focus for select elements when changed (Allows keyboard shortcuts to work better)\n  $('select').change(function () { $(this).blur(); });\n\n  // fired when user wants to move elements to another layer\n  let promptMoveLayerOnce = false;\n  $('#selLayerNames').change(function () {\n    const destLayer = this.options[this.selectedIndex].value;\n    const confirmStr = uiStrings.notification.QmoveElemsToLayer.replace('%s', destLayer);\n    const moveToLayer = function (ok) {\n      if (!ok) { return; }\n      promptMoveLayerOnce = true;\n      svgCanvas.moveSelectedToLayer(destLayer);\n      svgCanvas.clearSelection();\n      populateLayers();\n    };\n    if (destLayer) {\n      if (promptMoveLayerOnce) {\n        moveToLayer(true);\n      } else {\n        $.confirm(confirmStr, moveToLayer);\n      }\n    }\n  });\n\n  $('#font_family').change(function () {\n    svgCanvas.setFontFamily(this.value);\n  });\n\n  $('#seg_type').change(function () {\n    svgCanvas.setSegType($(this).val());\n  });\n\n  $('#text').bind('keyup input', function () {\n    svgCanvas.setTextContent(this.value);\n  });\n\n  $('#image_url').change(function () {\n    setImageURL(this.value);\n  });\n\n  $('#link_url').change(function () {\n    if (this.value.length) {\n      svgCanvas.setLinkURL(this.value);\n    } else {\n      svgCanvas.removeHyperlink();\n    }\n  });\n\n  $('#g_title').change(function () {\n    svgCanvas.setGroupTitle(this.value);\n  });\n\n  $('.attr_changer').change(function () {\n    const attr = this.getAttribute('data-attr');\n    let val = this.value;\n    const valid = isValidUnit(attr, val, selectedElement);\n\n    if (!valid) {\n      $.alert(uiStrings.notification.invalidAttrValGiven);\n      this.value = selectedElement.getAttribute(attr);\n      return false;\n    }\n\n    if (attr !== 'id' && attr !== 'class') {\n      if (isNaN(val)) {\n        val = svgCanvas.convertToNum(attr, val);\n      } else if (curConfig.baseUnit !== 'px') {\n        // Convert unitless value to one with given unit\n\n        const unitData = getTypeMap();\n\n        if (selectedElement[attr] || svgCanvas.getMode() === 'pathedit' || attr === 'x' || attr === 'y') {\n          val *= unitData[curConfig.baseUnit];\n        }\n      }\n    }\n\n    // if the user is changing the id, then de-select the element first\n    // change the ID, then re-select it with the new ID\n    if (attr === 'id') {\n      const elem = selectedElement;\n      svgCanvas.clearSelection();\n      elem.id = val;\n      svgCanvas.addToSelection([elem], true);\n    } else {\n      svgCanvas.changeSelectedAttribute(attr, val);\n    }\n    this.blur();\n  });\n\n  // Prevent selection of elements when shift-clicking\n  $('#palette').mouseover(function () {\n    const inp = $('<input type=\"hidden\">');\n    $(this).append(inp);\n    inp.focus().remove();\n  });\n\n  $('.palette_item').mousedown(function (evt) {\n    // shift key or right click for stroke\n    const picker = evt.shiftKey || evt.button === 2 ? 'stroke' : 'fill';\n    let color = $(this).data('rgb');\n    let paint;\n\n    // Webkit-based browsers returned 'initial' here for no stroke\n    if (color === 'none' || color === 'transparent' || color === 'initial') {\n      color = 'none';\n      paint = new $.jGraduate.Paint();\n    } else {\n      paint = new $.jGraduate.Paint({alpha: 100, solidColor: color.substr(1)});\n    }\n\n    paintBox[picker].setPaint(paint);\n    svgCanvas.setColor(picker, color);\n\n    if (color !== 'none' && svgCanvas.getPaintOpacity(picker) !== 1) {\n      svgCanvas.setPaintOpacity(picker, 1.0);\n    }\n    updateToolButtonState();\n  }).bind('contextmenu', function (e) { e.preventDefault(); });\n\n  $('#toggle_stroke_tools').on('click', function () {\n    $('#tools_bottom').toggleClass('expanded');\n  });\n\n  (function () {\n    const wArea = workarea[0];\n\n    let lastX = null, lastY = null,\n      panning = false, keypan = false;\n\n    $('#svgcanvas').bind('mousemove mouseup', function (evt) {\n      if (panning === false) { return; }\n\n      wArea.scrollLeft -= (evt.clientX - lastX);\n      wArea.scrollTop -= (evt.clientY - lastY);\n\n      lastX = evt.clientX;\n      lastY = evt.clientY;\n\n      if (evt.type === 'mouseup') { panning = false; }\n      return false;\n    }).mousedown(function (evt) {\n      if (evt.button === 1 || keypan === true) {\n        panning = true;\n        lastX = evt.clientX;\n        lastY = evt.clientY;\n        return false;\n      }\n    });\n\n    $(window).mouseup(function () {\n      panning = false;\n    });\n\n    $(document).bind('keydown', 'space', function (evt) {\n      svgCanvas.spaceKey = keypan = true;\n      evt.preventDefault();\n    }).bind('keyup', 'space', function (evt) {\n      evt.preventDefault();\n      svgCanvas.spaceKey = keypan = false;\n    }).bind('keydown', 'shift', function (evt) {\n      if (svgCanvas.getMode() === 'zoom') {\n        workarea.css('cursor', zoomOutIcon);\n      }\n    }).bind('keyup', 'shift', function (evt) {\n      if (svgCanvas.getMode() === 'zoom') {\n        workarea.css('cursor', zoomInIcon);\n      }\n    });\n\n    /**\n    * @param {boolean} active\n    * @returns {undefined}\n    */\n    editor.setPanning = function (active) {\n      svgCanvas.spaceKey = keypan = active;\n    };\n  }());\n\n  (function () {\n    const button = $('#main_icon');\n    const overlay = $('#main_icon span');\n    const list = $('#main_menu');\n\n    let onButton = false;\n    let height = 0;\n    let jsHover = true;\n    let setClick = false;\n\n    /*\n    // Currently unused\n    const hideMenu = function () {\n      list.fadeOut(200);\n    };\n    */\n\n    $(window).mouseup(function (evt) {\n      if (!onButton) {\n        button.removeClass('buttondown');\n        // do not hide if it was the file input as that input needs to be visible\n        // for its change event to fire\n        if (evt.target.tagName !== 'INPUT') {\n          list.fadeOut(200);\n        } else if (!setClick) {\n          setClick = true;\n          $(evt.target).click(function () {\n            list.css('margin-left', '-9999px').show();\n          });\n        }\n      }\n      onButton = false;\n    }).mousedown(function (evt) {\n      // $('.contextMenu').hide();\n      const islib = $(evt.target).closest('div.tools_flyout, .contextMenu').length;\n      if (!islib) {\n        $('.tools_flyout:visible,.contextMenu').fadeOut(250);\n      }\n    });\n\n    overlay.bind('mousedown', function () {\n      if (!button.hasClass('buttondown')) {\n        // Margin must be reset in case it was changed before;\n        list.css('margin-left', 0).show();\n        if (!height) {\n          height = list.height();\n        }\n        // Using custom animation as slideDown has annoying 'bounce effect'\n        list.css('height', 0).animate({\n          height\n        }, 200);\n        onButton = true;\n      } else {\n        list.fadeOut(200);\n      }\n      button.toggleClass('buttondown buttonup');\n    }).hover(function () {\n      onButton = true;\n    }).mouseout(function () {\n      onButton = false;\n    });\n\n    const listItems = $('#main_menu li');\n\n    // Check if JS method of hovering needs to be used (Webkit bug)\n    listItems.mouseover(function () {\n      jsHover = ($(this).css('background-color') === 'rgba(0, 0, 0, 0)');\n\n      listItems.unbind('mouseover');\n      if (jsHover) {\n        listItems.mouseover(function () {\n          this.style.backgroundColor = '#FFC';\n        }).mouseout(function () {\n          this.style.backgroundColor = 'transparent';\n          return true;\n        });\n      }\n    });\n  }());\n  // Made public for UI customization.\n  // TODO: Group UI functions into a public editor.ui interface.\n  /**\n   * See {@link http://api.jquery.com/bind/#bind-eventType-eventData-handler}\n   * @callback module:SVGEditor.DropDownCallback\n   * @param {external:jQuery.Event} ev See {@link http://api.jquery.com/Types/#Event}\n   * @listens external:jQuery.Event\n   * @returns {undefined|boolean} Calls `preventDefault()` and `stopPropagation()`\n  */\n  /**\n   * @param {Element|string} elem DOM Element or selector\n   * @param {module:SVGEditor.DropDownCallback} callback Mouseup callback\n   * @param {boolean} dropUp\n   * @returns {undefined}\n  */\n  editor.addDropDown = function (elem, callback, dropUp) {\n    if (!$(elem).length) { return; } // Quit if called on non-existent element\n    const button = $(elem).find('button');\n    const list = $(elem).find('ul').attr('id', $(elem)[0].id + '-list');\n    if (dropUp) {\n      $(elem).addClass('dropup');\n    } else {\n      // Move list to place where it can overflow container\n      $('#option_lists').append(list);\n    }\n    list.find('li').bind('mouseup', callback);\n\n    let onButton = false;\n    $(window).mouseup(function (evt) {\n      if (!onButton) {\n        button.removeClass('down');\n        list.hide();\n      }\n      onButton = false;\n    });\n\n    button.bind('mousedown', function () {\n      if (!button.hasClass('down')) {\n        if (!dropUp) {\n          const pos = $(elem).position();\n          list.css({\n            top: pos.top + 24,\n            left: pos.left - 10\n          });\n        }\n        list.show();\n        onButton = true;\n      } else {\n        list.hide();\n      }\n      button.toggleClass('down');\n    }).hover(function () {\n      onButton = true;\n    }).mouseout(function () {\n      onButton = false;\n    });\n  };\n\n  editor.addDropDown('#font_family_dropdown', function () {\n    $('#font_family').val($(this).text()).change();\n  });\n\n  editor.addDropDown('#opacity_dropdown', function () {\n    if ($(this).find('div').length) { return; }\n    const perc = parseInt($(this).text().split('%')[0], 10);\n    changeOpacity(false, perc);\n  }, true);\n\n  // For slider usage, see: http://jqueryui.com/demos/slider/\n  $('#opac_slider').slider({\n    start () {\n      $('#opacity_dropdown li:not(.special)').hide();\n    },\n    stop () {\n      $('#opacity_dropdown li').show();\n      $(window).mouseup();\n    },\n    slide (evt, ui) {\n      changeOpacity(ui);\n    }\n  });\n\n  editor.addDropDown('#blur_dropdown', $.noop);\n\n  let slideStart = false;\n  $('#blur_slider').slider({\n    max: 10,\n    step: 0.1,\n    stop (evt, ui) {\n      slideStart = false;\n      changeBlur(ui);\n      $('#blur_dropdown li').show();\n      $(window).mouseup();\n    },\n    start () {\n      slideStart = true;\n    },\n    slide (evt, ui) {\n      changeBlur(ui, null, slideStart);\n    }\n  });\n\n  editor.addDropDown('#zoom_dropdown', function () {\n    const item = $(this);\n    const val = item.data('val');\n    if (val) {\n      zoomChanged(window, val);\n    } else {\n      changeZoom({value: parseFloat(item.text())});\n    }\n  }, true);\n\n  addAltDropDown('#stroke_linecap', '#linecap_opts', function () {\n    setStrokeOpt(this, true);\n  }, {dropUp: true});\n\n  addAltDropDown('#stroke_linejoin', '#linejoin_opts', function () {\n    setStrokeOpt(this, true);\n  }, {dropUp: true});\n\n  addAltDropDown('#tool_position', '#position_opts', function () {\n    const letter = this.id.replace('tool_pos', '').charAt(0);\n    svgCanvas.alignSelectedElements(letter, 'page');\n  }, {multiclick: true});\n\n  /*\n\n  When a flyout icon is selected\n    (if flyout) {\n    - Change the icon\n    - Make pressing the button run its stuff\n    }\n    - Run its stuff\n\n  When its shortcut key is pressed\n    - If not current in list, do as above\n    , else:\n    - Just run its stuff\n\n  */\n\n  // Unfocus text input when workarea is mousedowned.\n  (function () {\n    let inp;\n    const unfocus = function () {\n      $(inp).blur();\n    };\n\n    $('#svg_editor').find('button, select, input:not(#text)').focus(function () {\n      inp = this;\n      uiContext = 'toolbars';\n      workarea.mousedown(unfocus);\n    }).blur(function () {\n      uiContext = 'canvas';\n      workarea.unbind('mousedown', unfocus);\n      // Go back to selecting text if in textedit mode\n      if (svgCanvas.getMode() === 'textedit') {\n        $('#text').focus();\n      }\n    });\n  }());\n\n  const clickFHPath = function () {\n    if (toolButtonClick('#tool_fhpath')) {\n      svgCanvas.setMode('fhpath');\n    }\n  };\n\n  const clickLine = function () {\n    if (toolButtonClick('#tool_line')) {\n      svgCanvas.setMode('line');\n    }\n  };\n\n  const clickSquare = function () {\n    if (toolButtonClick('#tool_square')) {\n      svgCanvas.setMode('square');\n    }\n  };\n\n  const clickRect = function () {\n    if (toolButtonClick('#tool_rect')) {\n      svgCanvas.setMode('rect');\n    }\n  };\n\n  const clickFHRect = function () {\n    if (toolButtonClick('#tool_fhrect')) {\n      svgCanvas.setMode('fhrect');\n    }\n  };\n\n  const clickCircle = function () {\n    if (toolButtonClick('#tool_circle')) {\n      svgCanvas.setMode('circle');\n    }\n  };\n\n  const clickEllipse = function () {\n    if (toolButtonClick('#tool_ellipse')) {\n      svgCanvas.setMode('ellipse');\n    }\n  };\n\n  const clickFHEllipse = function () {\n    if (toolButtonClick('#tool_fhellipse')) {\n      svgCanvas.setMode('fhellipse');\n    }\n  };\n\n  const clickImage = function () {\n    if (toolButtonClick('#tool_image')) {\n      svgCanvas.setMode('image');\n    }\n  };\n\n  const clickZoom = function () {\n    if (toolButtonClick('#tool_zoom')) {\n      svgCanvas.setMode('zoom');\n      workarea.css('cursor', zoomInIcon);\n    }\n  };\n\n  const zoomImage = function (multiplier) {\n    const res = svgCanvas.getResolution();\n    multiplier = multiplier ? res.zoom * multiplier : 1;\n    // setResolution(res.w * multiplier, res.h * multiplier, true);\n    $('#zoom').val(multiplier * 100);\n    svgCanvas.setZoom(multiplier);\n    zoomDone();\n    updateCanvas(true);\n  };\n\n  const dblclickZoom = function () {\n    if (toolButtonClick('#tool_zoom')) {\n      zoomImage();\n      setSelectMode();\n    }\n  };\n\n  const clickText = function () {\n    if (toolButtonClick('#tool_text')) {\n      svgCanvas.setMode('text');\n    }\n  };\n\n  const clickPath = function () {\n    if (toolButtonClick('#tool_path')) {\n      svgCanvas.setMode('path');\n    }\n  };\n\n  // Delete is a contextual tool that only appears in the ribbon if\n  // an element has been selected\n  const deleteSelected = function () {\n    if (selectedElement != null || multiselected) {\n      svgCanvas.deleteSelectedElements();\n    }\n  };\n\n  const cutSelected = function () {\n    if (selectedElement != null || multiselected) {\n      svgCanvas.cutSelectedElements();\n    }\n  };\n\n  const copySelected = function () {\n    if (selectedElement != null || multiselected) {\n      svgCanvas.copySelectedElements();\n    }\n  };\n\n  const pasteInCenter = function () {\n    const zoom = svgCanvas.getZoom();\n    const x = (workarea[0].scrollLeft + workarea.width() / 2) / zoom - svgCanvas.contentW;\n    const y = (workarea[0].scrollTop + workarea.height() / 2) / zoom - svgCanvas.contentH;\n    svgCanvas.pasteElements('point', x, y);\n  };\n\n  const moveToTopSelected = function () {\n    if (selectedElement != null) {\n      svgCanvas.moveToTopSelectedElement();\n    }\n  };\n\n  const moveToBottomSelected = function () {\n    if (selectedElement != null) {\n      svgCanvas.moveToBottomSelectedElement();\n    }\n  };\n\n  const moveUpDownSelected = function (dir) {\n    if (selectedElement != null) {\n      svgCanvas.moveUpDownSelected(dir);\n    }\n  };\n\n  const convertToPath = function () {\n    if (selectedElement != null) {\n      svgCanvas.convertToPath();\n    }\n  };\n\n  const reorientPath = function () {\n    if (selectedElement != null) {\n      path.reorient();\n    }\n  };\n\n  const makeHyperlink = function () {\n    if (selectedElement != null || multiselected) {\n      $.prompt(uiStrings.notification.enterNewLinkURL, 'http://', function (url) {\n        if (url) { svgCanvas.makeHyperlink(url); }\n      });\n    }\n  };\n\n  const moveSelected = function (dx, dy) {\n    if (selectedElement != null || multiselected) {\n      if (curConfig.gridSnapping) {\n        // Use grid snap value regardless of zoom level\n        const multi = svgCanvas.getZoom() * curConfig.snappingStep;\n        dx *= multi;\n        dy *= multi;\n      }\n      svgCanvas.moveSelectedElements(dx, dy);\n    }\n  };\n\n  const linkControlPoints = function () {\n    $('#tool_node_link').toggleClass('push_button_pressed tool_button');\n    const linked = $('#tool_node_link').hasClass('push_button_pressed');\n    path.linkControlPoints(linked);\n  };\n\n  const clonePathNode = function () {\n    if (path.getNodePoint()) {\n      path.clonePathNode();\n    }\n  };\n\n  const deletePathNode = function () {\n    if (path.getNodePoint()) {\n      path.deletePathNode();\n    }\n  };\n\n  const addSubPath = function () {\n    const button = $('#tool_add_subpath');\n    const sp = !button.hasClass('push_button_pressed');\n    button.toggleClass('push_button_pressed tool_button');\n    path.addSubPath(sp);\n  };\n\n  const opencloseSubPath = function () {\n    path.opencloseSubPath();\n  };\n\n  const selectNext = function () {\n    svgCanvas.cycleElement(1);\n  };\n\n  const selectPrev = function () {\n    svgCanvas.cycleElement(0);\n  };\n\n  const rotateSelected = function (cw, step) {\n    if (selectedElement == null || multiselected) { return; }\n    if (!cw) { step *= -1; }\n    const angle = parseFloat($('#angle').val()) + step;\n    svgCanvas.setRotationAngle(angle);\n    updateContextPanel();\n  };\n\n  /**\n   * @fires module:svgcanvas.SvgCanvas#event:ext-onNewDocument\n   * @returns {undefined}\n   */\n  const clickClear = function () {\n    const [x, y] = curConfig.dimensions;\n    $.confirm(uiStrings.notification.QwantToClear, function (ok) {\n      if (!ok) { return; }\n      setSelectMode();\n      svgCanvas.clear();\n      svgCanvas.setResolution(x, y);\n      updateCanvas(true);\n      zoomImage();\n      populateLayers();\n      updateContextPanel();\n      prepPaints();\n      svgCanvas.runExtensions('onNewDocument');\n    });\n  };\n\n  const clickBold = function () {\n    svgCanvas.setBold(!svgCanvas.getBold());\n    updateContextPanel();\n    return false;\n  };\n\n  const clickItalic = function () {\n    svgCanvas.setItalic(!svgCanvas.getItalic());\n    updateContextPanel();\n    return false;\n  };\n\n  const clickSave = function () {\n    // In the future, more options can be provided here\n    const saveOpts = {\n      images: $.pref('img_save'),\n      round_digits: 6\n    };\n    svgCanvas.save(saveOpts);\n  };\n\n  let loadingURL;\n  const clickExport = function () {\n    $.select('Select an image type for export: ', [\n      // See http://kangax.github.io/jstests/toDataUrl_mime_type_test/ for a useful list of MIME types and browser support\n      // 'ICO', // Todo: Find a way to preserve transparency in SVG-Edit if not working presently and do full packaging for x-icon; then switch back to position after 'PNG'\n      'PNG',\n      'JPEG', 'BMP', 'WEBP', 'PDF'\n    ], function (imgType) { // todo: replace hard-coded msg with uiStrings.notification.\n      if (!imgType) {\n        return;\n      }\n      // Open placeholder window (prevents popup)\n      let exportWindowName;\n      function openExportWindow () {\n        const str = uiStrings.notification.loadingImage;\n        if (curConfig.exportWindowType === 'new') {\n          editor.exportWindowCt++;\n        }\n        exportWindowName = curConfig.canvasName + editor.exportWindowCt;\n        let popHTML, popURL;\n        if (loadingURL) {\n          popURL = loadingURL;\n        } else {\n          popHTML = `<!DOCTYPE html><html>\n            <head>\n              <meta charset=\"utf-8\">\n              <title>${str}</title>\n            </head>\n            <body><h1>${str}</h1></body>\n          <html>`;\n          if (typeof URL && URL.createObjectURL) {\n            const blob = new Blob([popHTML], {type: 'text/html'});\n            popURL = URL.createObjectURL(blob);\n          } else {\n            popURL = 'data:text/html;base64;charset=utf-8,' + Utils.encode64(popHTML);\n          }\n          loadingURL = popURL;\n        }\n        exportWindow = window.open(popURL, exportWindowName);\n      }\n      if (imgType === 'PDF') {\n        if (!customExportPDF) {\n          openExportWindow();\n        }\n        svgCanvas.exportPDF(exportWindowName);\n      } else {\n        if (!customExportImage) {\n          openExportWindow();\n        }\n        const quality = parseInt($('#image-slider').val(), 10) / 100;\n        svgCanvas.rasterExport(imgType, quality, exportWindowName);\n      }\n    }, function () {\n      const sel = $(this);\n      if (sel.val() === 'JPEG' || sel.val() === 'WEBP') {\n        if (!$('#image-slider').length) {\n          $(`<div><label>${uiStrings.ui.quality}\n              <input id=\"image-slider\"\n                type=\"range\" min=\"1\" max=\"100\" value=\"92\" />\n            </label></div>`).appendTo(sel.parent());\n        }\n      } else {\n        $('#image-slider').parent().remove();\n      }\n    });\n  };\n\n  // by default, svgCanvas.open() is a no-op.\n  // it is up to an extension mechanism (opera widget, etc)\n  // to call setCustomHandlers() which will make it do something\n  const clickOpen = function () {\n    svgCanvas.open();\n  };\n\n  const clickImport = function () {\n  };\n\n  const clickUndo = function () {\n    if (undoMgr.getUndoStackSize() > 0) {\n      undoMgr.undo();\n      populateLayers();\n    }\n  };\n\n  const clickRedo = function () {\n    if (undoMgr.getRedoStackSize() > 0) {\n      undoMgr.redo();\n      populateLayers();\n    }\n  };\n\n  const clickGroup = function () {\n    // group\n    if (multiselected) {\n      svgCanvas.groupSelectedElements();\n    // ungroup\n    } else if (selectedElement) {\n      svgCanvas.ungroupSelectedElement();\n    }\n  };\n\n  const clickClone = function () {\n    svgCanvas.cloneSelectedElements(20, 20);\n  };\n\n  const clickAlign = function () {\n    const letter = this.id.replace('tool_align', '').charAt(0);\n    svgCanvas.alignSelectedElements(letter, $('#align_relative_to').val());\n  };\n\n  const clickWireframe = function () {\n    $('#tool_wireframe').toggleClass('push_button_pressed tool_button');\n    workarea.toggleClass('wireframe');\n\n    if (supportsNonSS) { return; }\n    let wfRules = $('#wireframe_rules');\n    if (!wfRules.length) {\n      wfRules = $('<style id=\"wireframe_rules\"></style>').appendTo('head');\n    } else {\n      wfRules.empty();\n    }\n\n    updateWireFrame();\n  };\n\n  $('#svg_docprops_container, #svg_prefs_container').draggable({\n    cancel: 'button,fieldset',\n    containment: 'window'\n  }).css('position', 'absolute');\n\n  let docprops = false;\n  let preferences = false;\n\n  const showDocProperties = function () {\n    if (docprops) { return; }\n    docprops = true;\n\n    // This selects the correct radio button by using the array notation\n    $('#image_save_opts input').val([$.pref('img_save')]);\n\n    // update resolution option with actual resolution\n    const res = svgCanvas.getResolution();\n    if (curConfig.baseUnit !== 'px') {\n      res.w = convertUnit(res.w) + curConfig.baseUnit;\n      res.h = convertUnit(res.h) + curConfig.baseUnit;\n    }\n\n    $('#canvas_width').val(res.w);\n    $('#canvas_height').val(res.h);\n    $('#canvas_title').val(svgCanvas.getDocumentTitle());\n\n    $('#svg_docprops').show();\n  };\n\n  const showPreferences = function () {\n    if (preferences) { return; }\n    preferences = true;\n    $('#main_menu').hide();\n\n    // Update background color with current one\n    const blocks = $('#bg_blocks div');\n    const curBg = 'cur_background';\n    const canvasBg = curPrefs.bkgd_color;\n    const url = $.pref('bkgd_url');\n    blocks.each(function () {\n      const blk = $(this);\n      const isBg = blk.css('background-color') === canvasBg;\n      blk.toggleClass(curBg, isBg);\n      if (isBg) { $('#canvas_bg_url').removeClass(curBg); }\n    });\n    if (!canvasBg) { blocks.eq(0).addClass(curBg); }\n    if (url) {\n      $('#canvas_bg_url').val(url);\n    }\n    $('#grid_snapping_on').prop('checked', curConfig.gridSnapping);\n    $('#grid_snapping_step').attr('value', curConfig.snappingStep);\n    $('#grid_color').attr('value', curConfig.gridColor);\n\n    $('#svg_prefs').show();\n  };\n\n  const hideSourceEditor = function () {\n    $('#svg_source_editor').hide();\n    editingsource = false;\n    $('#svg_source_textarea').blur();\n  };\n\n  const saveSourceEditor = function () {\n    if (!editingsource) { return; }\n\n    const saveChanges = function () {\n      svgCanvas.clearSelection();\n      hideSourceEditor();\n      zoomImage();\n      populateLayers();\n      updateTitle();\n      prepPaints();\n    };\n\n    if (!svgCanvas.setSvgString($('#svg_source_textarea').val())) {\n      $.confirm(uiStrings.notification.QerrorsRevertToSource, function (ok) {\n        if (!ok) { return false; }\n        saveChanges();\n      });\n    } else {\n      saveChanges();\n    }\n    setSelectMode();\n  };\n\n  const hideDocProperties = function () {\n    $('#svg_docprops').hide();\n    $('#canvas_width,#canvas_height').removeAttr('disabled');\n    $('#resolution')[0].selectedIndex = 0;\n    $('#image_save_opts input').val([$.pref('img_save')]);\n    docprops = false;\n  };\n\n  const hidePreferences = function () {\n    $('#svg_prefs').hide();\n    preferences = false;\n  };\n\n  const saveDocProperties = function () {\n    // set title\n    const newTitle = $('#canvas_title').val();\n    updateTitle(newTitle);\n    svgCanvas.setDocumentTitle(newTitle);\n\n    // update resolution\n    const width = $('#canvas_width'), w = width.val();\n    const height = $('#canvas_height'), h = height.val();\n\n    if (w !== 'fit' && !isValidUnit('width', w)) {\n      $.alert(uiStrings.notification.invalidAttrValGiven);\n      width.parent().addClass('error');\n      return false;\n    }\n\n    width.parent().removeClass('error');\n\n    if (h !== 'fit' && !isValidUnit('height', h)) {\n      $.alert(uiStrings.notification.invalidAttrValGiven);\n      height.parent().addClass('error');\n      return false;\n    }\n\n    height.parent().removeClass('error');\n\n    if (!svgCanvas.setResolution(w, h)) {\n      $.alert(uiStrings.notification.noContentToFitTo);\n      return false;\n    }\n\n    // Set image save option\n    $.pref('img_save', $('#image_save_opts :checked').val());\n    updateCanvas();\n    hideDocProperties();\n  };\n\n  /**\n  * Save user preferences based on current values in the UI\n  * @function module:SVGEditor.savePreferences\n  * @returns {undefined}\n  */\n  const savePreferences = editor.savePreferences = function () {\n    // Set background\n    const color = $('#bg_blocks div.cur_background').css('background-color') || '#FFF';\n    setBackground(color, $('#canvas_bg_url').val());\n\n    // set language\n    const lang = $('#lang_select').val();\n    if (lang !== $.pref('lang')) {\n      editor.putLocale(lang, goodLangs, curConfig);\n    }\n\n    // set icon size\n    setIconSize($('#iconsize').val());\n\n    // set grid setting\n    curConfig.gridSnapping = $('#grid_snapping_on')[0].checked;\n    curConfig.snappingStep = $('#grid_snapping_step').val();\n    curConfig.gridColor = $('#grid_color').val();\n    curConfig.showRulers = $('#show_rulers')[0].checked;\n\n    $('#rulers').toggle(curConfig.showRulers);\n    if (curConfig.showRulers) { updateRulers(); }\n    curConfig.baseUnit = $('#base_unit').val();\n\n    svgCanvas.setConfig(curConfig);\n\n    updateCanvas();\n    hidePreferences();\n  };\n\n  let resetScrollPos = $.noop;\n\n  const cancelOverlays = function () {\n    $('#dialog_box').hide();\n    if (!editingsource && !docprops && !preferences) {\n      if (curContext) {\n        svgCanvas.leaveContext();\n      }\n      return;\n    }\n\n    if (editingsource) {\n      if (origSource !== $('#svg_source_textarea').val()) {\n        $.confirm(uiStrings.notification.QignoreSourceChanges, function (ok) {\n          if (ok) { hideSourceEditor(); }\n        });\n      } else {\n        hideSourceEditor();\n      }\n    } else if (docprops) {\n      hideDocProperties();\n    } else if (preferences) {\n      hidePreferences();\n    }\n    resetScrollPos();\n  };\n\n  const winWh = {width: $(window).width(), height: $(window).height()};\n\n  // Fix for Issue 781: Drawing area jumps to top-left corner on window resize (IE9)\n  if (isIE()) {\n    (() => {\n      resetScrollPos = function () {\n        if (workarea[0].scrollLeft === 0 && workarea[0].scrollTop === 0) {\n          workarea[0].scrollLeft = curScrollPos.left;\n          workarea[0].scrollTop = curScrollPos.top;\n        }\n      };\n\n      curScrollPos = {\n        left: workarea[0].scrollLeft,\n        top: workarea[0].scrollTop\n      };\n\n      $(window).resize(resetScrollPos);\n      editor.ready(function () {\n        // TODO: Find better way to detect when to do this to minimize\n        // flickering effect\n        setTimeout(function () {\n          resetScrollPos();\n        }, 500);\n      });\n\n      workarea.scroll(function () {\n        curScrollPos = {\n          left: workarea[0].scrollLeft,\n          top: workarea[0].scrollTop\n        };\n      });\n    })();\n  }\n\n  $(window).resize(function (evt) {\n    $.each(winWh, function (type, val) {\n      const curval = $(window)[type]();\n      workarea[0]['scroll' + (type === 'width' ? 'Left' : 'Top')] -= (curval - val) / 2;\n      winWh[type] = curval;\n    });\n    setFlyoutPositions();\n  });\n\n  (() => {\n    workarea.scroll(function () {\n      // TODO: jQuery's scrollLeft/Top() wouldn't require a null check\n      if ($('#ruler_x').length) {\n        $('#ruler_x')[0].scrollLeft = workarea[0].scrollLeft;\n      }\n      if ($('#ruler_y').length) {\n        $('#ruler_y')[0].scrollTop = workarea[0].scrollTop;\n      }\n    });\n  })();\n\n  $('#url_notice').click(function () {\n    $.alert(this.title);\n  });\n\n  $('#change_image_url').click(promptImgURL);\n\n  // added these event handlers for all the push buttons so they\n  // behave more like buttons being pressed-in and not images\n  (function () {\n    const toolnames = ['clear', 'open', 'save', 'source', 'delete', 'delete_multi', 'paste', 'clone', 'clone_multi', 'move_top', 'move_bottom'];\n    const curClass = 'tool_button_current';\n\n    let allTools = '';\n\n    $.each(toolnames, function (i, item) {\n      allTools += (i ? ',' : '') + '#tool_' + item;\n    });\n\n    $(allTools).mousedown(function () {\n      $(this).addClass(curClass);\n    }).bind('mousedown mouseout', function () {\n      $(this).removeClass(curClass);\n    });\n\n    $('#tool_undo, #tool_redo').mousedown(function () {\n      if (!$(this).hasClass('disabled')) { $(this).addClass(curClass); }\n    }).bind('mousedown mouseout', function () {\n      $(this).removeClass(curClass);\n    });\n  }());\n\n  // switch modifier key in tooltips if mac\n  // NOTE: This code is not used yet until I can figure out how to successfully bind ctrl/meta\n  // in Opera and Chrome\n  if (isMac() && !window.opera) {\n    const shortcutButtons = ['tool_clear', 'tool_save', 'tool_source', 'tool_undo', 'tool_redo', 'tool_clone'];\n    let i = shortcutButtons.length;\n    while (i--) {\n      const button = document.getElementById(shortcutButtons[i]);\n      if (button) {\n        const {title} = button;\n        const index = title.indexOf('Ctrl+');\n        button.title = [title.substr(0, index), 'Cmd+', title.substr(index + 5)].join('');\n      }\n    }\n  }\n\n  // TODO: go back to the color boxes having white background-color and then setting\n  //  background-image to none.png (otherwise partially transparent gradients look weird)\n  const colorPicker = function (elem) {\n    const picker = elem.attr('id') === 'stroke_color' ? 'stroke' : 'fill';\n    // const opacity = (picker == 'stroke' ? $('#stroke_opacity') : $('#fill_opacity'));\n    const title = picker === 'stroke'\n      ? uiStrings.ui.pick_stroke_paint_opacity\n      : uiStrings.ui.pick_fill_paint_opacity;\n    // let wasNone = false; // Currently unused\n    const pos = elem.offset();\n    let {paint} = paintBox[picker];\n    $('#color_picker')\n      .draggable({\n        cancel: '.jGraduate_tabs, .jGraduate_colPick, .jGraduate_gradPick, .jPicker',\n        containment: 'window'\n      })\n      .css(curConfig.colorPickerCSS || {left: pos.left - 140, bottom: 40})\n      .jGraduate(\n        {\n          paint,\n          window: { pickerTitle: title },\n          images: { clientPath: curConfig.jGraduatePath },\n          newstop: 'inverse'\n        },\n        function (p) {\n          paint = new $.jGraduate.Paint(p);\n          paintBox[picker].setPaint(paint);\n          svgCanvas.setPaint(picker, paint);\n          $('#color_picker').hide();\n        },\n        function () {\n          $('#color_picker').hide();\n        }\n      );\n  };\n\n  const PaintBox = function (container, type) {\n    let paintColor, paintOpacity;\n    const cur = curConfig[type === 'fill' ? 'initFill' : 'initStroke'];\n    // set up gradients to be used for the buttons\n    const svgdocbox = new DOMParser().parseFromString(\n      `<svg xmlns=\"http://www.w3.org/2000/svg\">\n        <rect width=\"16.5\" height=\"16.5\"\n          fill=\"#${cur.color}\" opacity=\"${cur.opacity}\"/>\n        <defs><linearGradient id=\"gradbox_\"/></defs>\n      </svg>`,\n      'text/xml'\n    );\n\n    let docElem = svgdocbox.documentElement;\n    docElem = $(container)[0].appendChild(document.importNode(docElem, true));\n    docElem.setAttribute('width', 16.5);\n\n    this.rect = docElem.firstElementChild;\n    this.defs = docElem.getElementsByTagName('defs')[0];\n    this.grad = this.defs.firstElementChild;\n    this.paint = new $.jGraduate.Paint({solidColor: cur.color});\n    this.type = type;\n\n    this.setPaint = function (paint, apply) {\n      this.paint = paint;\n\n      const ptype = paint.type;\n      const opac = paint.alpha / 100;\n\n      let fillAttr = 'none';\n      switch (ptype) {\n      case 'solidColor':\n        fillAttr = (paint[ptype] !== 'none') ? '#' + paint[ptype] : paint[ptype];\n        break;\n      case 'linearGradient':\n      case 'radialGradient':\n        this.grad.remove();\n        this.grad = this.defs.appendChild(paint[ptype]);\n        const id = this.grad.id = 'gradbox_' + this.type;\n        fillAttr = 'url(#' + id + ')';\n        break;\n      }\n\n      this.rect.setAttribute('fill', fillAttr);\n      this.rect.setAttribute('opacity', opac);\n\n      if (apply) {\n        svgCanvas.setColor(this.type, paintColor, true);\n        svgCanvas.setPaintOpacity(this.type, paintOpacity, true);\n      }\n    };\n\n    this.update = function (apply) {\n      if (!selectedElement) { return; }\n\n      const {type} = this;\n      switch (selectedElement.tagName) {\n      case 'use':\n      case 'image':\n      case 'foreignObject':\n        // These elements don't have fill or stroke, so don't change\n        // the current value\n        return;\n      case 'g':\n      case 'a': {\n        const childs = selectedElement.getElementsByTagName('*');\n\n        let gPaint = null;\n        for (let i = 0, len = childs.length; i < len; i++) {\n          const elem = childs[i];\n          const p = elem.getAttribute(type);\n          if (i === 0) {\n            gPaint = p;\n          } else if (gPaint !== p) {\n            gPaint = null;\n            break;\n          }\n        }\n\n        if (gPaint === null) {\n          // No common color, don't update anything\n          paintColor = null;\n          return;\n        }\n        paintColor = gPaint;\n        paintOpacity = 1;\n        break;\n      } default:\n        paintOpacity = parseFloat(selectedElement.getAttribute(type + '-opacity'));\n        if (isNaN(paintOpacity)) {\n          paintOpacity = 1.0;\n        }\n\n        const defColor = type === 'fill' ? 'black' : 'none';\n        paintColor = selectedElement.getAttribute(type) || defColor;\n      }\n\n      if (apply) {\n        svgCanvas.setColor(type, paintColor, true);\n        svgCanvas.setPaintOpacity(type, paintOpacity, true);\n      }\n\n      paintOpacity *= 100;\n\n      const paint = getPaint(paintColor, paintOpacity, type);\n      // update the rect inside #fill_color/#stroke_color\n      this.setPaint(paint);\n    };\n\n    this.prep = function () {\n      const ptype = this.paint.type;\n\n      switch (ptype) {\n      case 'linearGradient':\n      case 'radialGradient':\n        const paint = new $.jGraduate.Paint({copy: this.paint});\n        svgCanvas.setPaint(type, paint);\n        break;\n      }\n    };\n  };\n\n  paintBox.fill = new PaintBox('#fill_color', 'fill');\n  paintBox.stroke = new PaintBox('#stroke_color', 'stroke');\n\n  $('#stroke_width').val(curConfig.initStroke.width);\n  $('#group_opacity').val(curConfig.initOpacity * 100);\n\n  // Use this SVG elem to test vectorEffect support\n  const testEl = paintBox.fill.rect.cloneNode(false);\n  testEl.setAttribute('style', 'vector-effect:non-scaling-stroke');\n  const supportsNonSS = (testEl.style.vectorEffect === 'non-scaling-stroke');\n  testEl.removeAttribute('style');\n  const svgdocbox = paintBox.fill.rect.ownerDocument;\n  // Use this to test support for blur element. Seems to work to test support in Webkit\n  const blurTest = svgdocbox.createElementNS(NS.SVG, 'feGaussianBlur');\n  if (blurTest.stdDeviationX === undefined) {\n    $('#tool_blur').hide();\n  }\n  $(blurTest).remove();\n\n  // Test for zoom icon support\n  (function () {\n    const pre = '-' + uaPrefix.toLowerCase() + '-zoom-';\n    const zoom = pre + 'in';\n    workarea.css('cursor', zoom);\n    if (workarea.css('cursor') === zoom) {\n      zoomInIcon = zoom;\n      zoomOutIcon = pre + 'out';\n    }\n    workarea.css('cursor', 'auto');\n  }());\n\n  // Test for embedImage support (use timeout to not interfere with page load)\n  setTimeout(function () {\n    svgCanvas.embedImage('images/logo.png', function (datauri) {\n      if (!datauri) {\n        // Disable option\n        $('#image_save_opts [value=embed]').attr('disabled', 'disabled');\n        $('#image_save_opts input').val(['ref']);\n        $.pref('img_save', 'ref');\n        $('#image_opt_embed').css('color', '#666').attr('title', uiStrings.notification.featNotSupported);\n      }\n    });\n  }, 1000);\n\n  $('#fill_color, #tool_fill .icon_label').click(function () {\n    colorPicker($('#fill_color'));\n    updateToolButtonState();\n  });\n\n  $('#stroke_color, #tool_stroke .icon_label').click(function () {\n    colorPicker($('#stroke_color'));\n    updateToolButtonState();\n  });\n\n  $('#group_opacityLabel').click(function () {\n    $('#opacity_dropdown button').mousedown();\n    $(window).mouseup();\n  });\n\n  $('#zoomLabel').click(function () {\n    $('#zoom_dropdown button').mousedown();\n    $(window).mouseup();\n  });\n\n  $('#tool_move_top').mousedown(function (evt) {\n    $('#tools_stacking').show();\n    evt.preventDefault();\n  });\n\n  $('.layer_button').mousedown(function () {\n    $(this).addClass('layer_buttonpressed');\n  }).mouseout(function () {\n    $(this).removeClass('layer_buttonpressed');\n  }).mouseup(function () {\n    $(this).removeClass('layer_buttonpressed');\n  });\n\n  $('.push_button').mousedown(function () {\n    if (!$(this).hasClass('disabled')) {\n      $(this).addClass('push_button_pressed').removeClass('push_button');\n    }\n  }).mouseout(function () {\n    $(this).removeClass('push_button_pressed').addClass('push_button');\n  }).mouseup(function () {\n    $(this).removeClass('push_button_pressed').addClass('push_button');\n  });\n\n  // ask for a layer name\n  $('#layer_new').click(function () {\n    let uniqName,\n      i = svgCanvas.getCurrentDrawing().getNumLayers();\n    do {\n      uniqName = uiStrings.layers.layer + ' ' + (++i);\n    } while (svgCanvas.getCurrentDrawing().hasLayer(uniqName));\n\n    $.prompt(uiStrings.notification.enterUniqueLayerName, uniqName, function (newName) {\n      if (!newName) { return; }\n      if (svgCanvas.getCurrentDrawing().hasLayer(newName)) {\n        $.alert(uiStrings.notification.dupeLayerName);\n        return;\n      }\n      svgCanvas.createLayer(newName);\n      updateContextPanel();\n      populateLayers();\n    });\n  });\n\n  function deleteLayer () {\n    if (svgCanvas.deleteCurrentLayer()) {\n      updateContextPanel();\n      populateLayers();\n      // This matches what SvgCanvas does\n      // TODO: make this behavior less brittle (svg-editor should get which\n      // layer is selected from the canvas and then select that one in the UI)\n      $('#layerlist tr.layer').removeClass('layersel');\n      $('#layerlist tr.layer:first').addClass('layersel');\n    }\n  }\n\n  function cloneLayer () {\n    const name = svgCanvas.getCurrentDrawing().getCurrentLayerName() + ' copy';\n\n    $.prompt(uiStrings.notification.enterUniqueLayerName, name, function (newName) {\n      if (!newName) { return; }\n      if (svgCanvas.getCurrentDrawing().hasLayer(newName)) {\n        $.alert(uiStrings.notification.dupeLayerName);\n        return;\n      }\n      svgCanvas.cloneLayer(newName);\n      updateContextPanel();\n      populateLayers();\n    });\n  }\n\n  function mergeLayer () {\n    if ($('#layerlist tr.layersel').index() === svgCanvas.getCurrentDrawing().getNumLayers() - 1) {\n      return;\n    }\n    svgCanvas.mergeLayer();\n    updateContextPanel();\n    populateLayers();\n  }\n\n  function moveLayer (pos) {\n    const total = svgCanvas.getCurrentDrawing().getNumLayers();\n\n    let curIndex = $('#layerlist tr.layersel').index();\n    if (curIndex > 0 || curIndex < total - 1) {\n      curIndex += pos;\n      svgCanvas.setCurrentLayerPosition(total - curIndex - 1);\n      populateLayers();\n    }\n  }\n\n  $('#layer_delete').click(deleteLayer);\n\n  $('#layer_up').click(() => {\n    moveLayer(-1);\n  });\n\n  $('#layer_down').click(() => {\n    moveLayer(1);\n  });\n\n  $('#layer_rename').click(function () {\n    // const curIndex = $('#layerlist tr.layersel').prevAll().length; // Currently unused\n    const oldName = $('#layerlist tr.layersel td.layername').text();\n    $.prompt(uiStrings.notification.enterNewLayerName, '', function (newName) {\n      if (!newName) { return; }\n      if (oldName === newName || svgCanvas.getCurrentDrawing().hasLayer(newName)) {\n        $.alert(uiStrings.notification.layerHasThatName);\n        return;\n      }\n\n      svgCanvas.renameCurrentLayer(newName);\n      populateLayers();\n    });\n  });\n\n  const SIDEPANEL_MAXWIDTH = 300;\n  const SIDEPANEL_OPENWIDTH = 150;\n  let sidedrag = -1, sidedragging = false, allowmove = false;\n\n  /**\n   * @param {Float} delta\n   * @fires module:svgcanvas.SvgCanvas#event:ext-workareaResized\n   * @returns {undefined}\n   */\n  const changeSidePanelWidth = function (delta) {\n    const rulerX = $('#ruler_x');\n    $('#sidepanels').width('+=' + delta);\n    $('#layerpanel').width('+=' + delta);\n    rulerX.css('right', parseInt(rulerX.css('right'), 10) + delta);\n    workarea.css('right', parseInt(workarea.css('right'), 10) + delta);\n    svgCanvas.runExtensions('workareaResized');\n  };\n\n  const resizeSidePanel = function (evt) {\n    if (!allowmove) { return; }\n    if (sidedrag === -1) { return; }\n    sidedragging = true;\n    let deltaX = sidedrag - evt.pageX;\n    let sideWidth = $('#sidepanels').width();\n    if (sideWidth + deltaX > SIDEPANEL_MAXWIDTH) {\n      deltaX = SIDEPANEL_MAXWIDTH - sideWidth;\n      sideWidth = SIDEPANEL_MAXWIDTH;\n    } else if (sideWidth + deltaX < 2) {\n      deltaX = 2 - sideWidth;\n      sideWidth = 2;\n    }\n    if (deltaX === 0) { return; }\n    sidedrag -= deltaX;\n    changeSidePanelWidth(deltaX);\n  };\n\n  /**\n   * If width is non-zero, then fully close it, otherwise fully open it\n   * @param {boolean} close Forces the side panel closed\n   * @returns {undefined}\n   */\n  const toggleSidePanel = function (close) {\n    const w = $('#sidepanels').width();\n    const deltaX = (w > 2 || close ? 2 : SIDEPANEL_OPENWIDTH) - w;\n    changeSidePanelWidth(deltaX);\n  };\n\n  $('#sidepanel_handle')\n    .mousedown(function (evt) {\n      sidedrag = evt.pageX;\n      $(window).mousemove(resizeSidePanel);\n      allowmove = false;\n      // Silly hack for Chrome, which always runs mousemove right after mousedown\n      setTimeout(function () {\n        allowmove = true;\n      }, 20);\n    })\n    .mouseup(function (evt) {\n      if (!sidedragging) { toggleSidePanel(); }\n      sidedrag = -1;\n      sidedragging = false;\n    });\n\n  $(window).mouseup(function () {\n    sidedrag = -1;\n    sidedragging = false;\n    $('#svg_editor').unbind('mousemove', resizeSidePanel);\n  });\n\n  populateLayers();\n\n  // function changeResolution (x,y) {\n  //   const {zoom} = svgCanvas.getResolution();\n  //   setResolution(x * zoom, y * zoom);\n  // }\n\n  const centerCanvas = () => {\n    // this centers the canvas vertically in the workarea (horizontal handled in CSS)\n    workarea.css('line-height', workarea.height() + 'px');\n  };\n\n  $(window).bind('load resize', centerCanvas);\n\n  function stepFontSize (elem, step) {\n    const origVal = Number(elem.value);\n    const sugVal = origVal + step;\n    const increasing = sugVal >= origVal;\n    if (step === 0) { return origVal; }\n\n    if (origVal >= 24) {\n      if (increasing) {\n        return Math.round(origVal * 1.1);\n      }\n      return Math.round(origVal / 1.1);\n    }\n    if (origVal <= 1) {\n      if (increasing) {\n        return origVal * 2;\n      }\n      return origVal / 2;\n    }\n    return sugVal;\n  }\n\n  function stepZoom (elem, step) {\n    const origVal = Number(elem.value);\n    if (origVal === 0) { return 100; }\n    const sugVal = origVal + step;\n    if (step === 0) { return origVal; }\n\n    if (origVal >= 100) {\n      return sugVal;\n    }\n    if (sugVal >= origVal) {\n      return origVal * 2;\n    }\n    return origVal / 2;\n  }\n\n  // function setResolution (w, h, center) {\n  //   updateCanvas();\n  //   // w -= 0; h -= 0;\n  //   // $('#svgcanvas').css({width: w, height: h});\n  //   // $('#canvas_width').val(w);\n  //   // $('#canvas_height').val(h);\n  //   //\n  //   // if (center) {\n  //   //   const wArea = workarea;\n  //   //   const scrollY = h/2 - wArea.height()/2;\n  //   //   const scrollX = w/2 - wArea.width()/2;\n  //   //   wArea[0].scrollTop = scrollY;\n  //   //   wArea[0].scrollLeft = scrollX;\n  //   // }\n  // }\n\n  $('#resolution').change(function () {\n    const wh = $('#canvas_width,#canvas_height');\n    if (!this.selectedIndex) {\n      if ($('#canvas_width').val() === 'fit') {\n        wh.removeAttr('disabled').val(100);\n      }\n    } else if (this.value === 'content') {\n      wh.val('fit').attr('disabled', 'disabled');\n    } else {\n      const dims = this.value.split('x');\n      $('#canvas_width').val(dims[0]);\n      $('#canvas_height').val(dims[1]);\n      wh.removeAttr('disabled');\n    }\n  });\n\n  // Prevent browser from erroneously repopulating fields\n  $('input,select').attr('autocomplete', 'off');\n\n  /**\n   * Associate all button actions as well as non-button keyboard shortcuts\n   * @namespace {PlainObject} module:SVGEditor~Actions\n   */\n  const Actions = (function () {\n    /**\n    * @typedef {PlainObject} module:SVGEditor.ToolButton\n    * @property {string} sel The CSS selector for the tool\n    * @property {external:jQuery.Function} fn A handler to be attached to the `evt`\n    * @property {string} evt The event for which the `fn` listener will be added\n    * @property {module:SVGEditor.Key} [key] [key, preventDefault, NoDisableInInput]\n    * @property {string} [parent] Selector\n    * @property {boolean} [hidekey] Whether to show key value in title\n    * @property {string} [icon] The button ID\n    * @property {boolean} isDefault For flyout holders\n    */\n    /**\n     *\n     * @name module:SVGEditor~ToolButtons\n     * @type {module:SVGEditor.ToolButton[]}\n     */\n    const toolButtons = [\n      {sel: '#tool_select', fn: clickSelect, evt: 'click', key: ['V', true]},\n      {sel: '#tool_fhpath', fn: clickFHPath, evt: 'click', key: ['Q', true]},\n      {sel: '#tool_line', fn: clickLine, evt: 'click', key: ['L', true], parent: '#tools_line', prepend: true},\n      {sel: '#tool_rect', fn: clickRect, evt: 'mouseup',\n        key: ['R', true], parent: '#tools_rect', icon: 'rect'},\n      {sel: '#tool_square', fn: clickSquare, evt: 'mouseup',\n        parent: '#tools_rect', icon: 'square'},\n      {sel: '#tool_fhrect', fn: clickFHRect, evt: 'mouseup',\n        parent: '#tools_rect', icon: 'fh_rect'},\n      {sel: '#tool_ellipse', fn: clickEllipse, evt: 'mouseup',\n        key: ['E', true], parent: '#tools_ellipse', icon: 'ellipse'},\n      {sel: '#tool_circle', fn: clickCircle, evt: 'mouseup',\n        parent: '#tools_ellipse', icon: 'circle'},\n      {sel: '#tool_fhellipse', fn: clickFHEllipse, evt: 'mouseup',\n        parent: '#tools_ellipse', icon: 'fh_ellipse'},\n      {sel: '#tool_path', fn: clickPath, evt: 'click', key: ['P', true]},\n      {sel: '#tool_text', fn: clickText, evt: 'click', key: ['T', true]},\n      {sel: '#tool_image', fn: clickImage, evt: 'mouseup'},\n      {sel: '#tool_zoom', fn: clickZoom, evt: 'mouseup', key: ['Z', true]},\n      {sel: '#tool_clear', fn: clickClear, evt: 'mouseup', key: ['N', true]},\n      {sel: '#tool_save', fn () {\n        if (editingsource) {\n          saveSourceEditor();\n        } else {\n          clickSave();\n        }\n      }, evt: 'mouseup', key: ['S', true]},\n      {sel: '#tool_export', fn: clickExport, evt: 'mouseup'},\n      {sel: '#tool_open', fn: clickOpen, evt: 'mouseup', key: ['O', true]},\n      {sel: '#tool_import', fn: clickImport, evt: 'mouseup'},\n      {sel: '#tool_source', fn: showSourceEditor, evt: 'click', key: ['U', true]},\n      {sel: '#tool_wireframe', fn: clickWireframe, evt: 'click', key: ['F', true]},\n      {sel: '#tool_source_cancel,.overlay,#tool_docprops_cancel,#tool_prefs_cancel',\n        fn: cancelOverlays, evt: 'click', key: ['esc', false, false], hidekey: true},\n      {sel: '#tool_source_save', fn: saveSourceEditor, evt: 'click'},\n      {sel: '#tool_docprops_save', fn: saveDocProperties, evt: 'click'},\n      {sel: '#tool_docprops', fn: showDocProperties, evt: 'mouseup'},\n      {sel: '#tool_prefs_save', fn: savePreferences, evt: 'click'},\n      {sel: '#tool_prefs_option', fn () { showPreferences(); return false; }, evt: 'mouseup'},\n      {sel: '#tool_delete,#tool_delete_multi', fn: deleteSelected,\n        evt: 'click', key: ['del/backspace', true]},\n      {sel: '#tool_reorient', fn: reorientPath, evt: 'click'},\n      {sel: '#tool_node_link', fn: linkControlPoints, evt: 'click'},\n      {sel: '#tool_node_clone', fn: clonePathNode, evt: 'click'},\n      {sel: '#tool_node_delete', fn: deletePathNode, evt: 'click'},\n      {sel: '#tool_openclose_path', fn: opencloseSubPath, evt: 'click'},\n      {sel: '#tool_add_subpath', fn: addSubPath, evt: 'click'},\n      {sel: '#tool_move_top', fn: moveToTopSelected, evt: 'click', key: 'ctrl+shift+]'},\n      {sel: '#tool_move_bottom', fn: moveToBottomSelected, evt: 'click', key: 'ctrl+shift+['},\n      {sel: '#tool_topath', fn: convertToPath, evt: 'click'},\n      {sel: '#tool_make_link,#tool_make_link_multi', fn: makeHyperlink, evt: 'click'},\n      {sel: '#tool_undo', fn: clickUndo, evt: 'click'},\n      {sel: '#tool_redo', fn: clickRedo, evt: 'click'},\n      {sel: '#tool_clone,#tool_clone_multi', fn: clickClone, evt: 'click', key: ['D', true]},\n      {sel: '#tool_group_elements', fn: clickGroup, evt: 'click', key: ['G', true]},\n      {sel: '#tool_ungroup', fn: clickGroup, evt: 'click'},\n      {sel: '#tool_unlink_use', fn: clickGroup, evt: 'click'},\n      {sel: '[id^=tool_align]', fn: clickAlign, evt: 'click'},\n      // these two lines are required to make Opera work properly with the flyout mechanism\n      // {sel: '#tools_rect_show', fn: clickRect, evt: 'click'},\n      // {sel: '#tools_ellipse_show', fn: clickEllipse, evt: 'click'},\n      {sel: '#tool_bold', fn: clickBold, evt: 'mousedown'},\n      {sel: '#tool_italic', fn: clickItalic, evt: 'mousedown'},\n      {sel: '#sidepanel_handle', fn: toggleSidePanel, key: ['X']},\n      {sel: '#copy_save_done', fn: cancelOverlays, evt: 'click'},\n\n      // Shortcuts not associated with buttons\n\n      {key: 'ctrl+left', fn () { rotateSelected(0, 1); }},\n      {key: 'ctrl+right', fn () { rotateSelected(1, 1); }},\n      {key: 'ctrl+shift+left', fn () { rotateSelected(0, 5); }},\n      {key: 'ctrl+shift+right', fn () { rotateSelected(1, 5); }},\n      {key: 'shift+O', fn: selectPrev},\n      {key: 'shift+P', fn: selectNext},\n      {key: [modKey + 'up', true], fn () { zoomImage(2); }},\n      {key: [modKey + 'down', true], fn () { zoomImage(0.5); }},\n      {key: [modKey + ']', true], fn () { moveUpDownSelected('Up'); }},\n      {key: [modKey + '[', true], fn () { moveUpDownSelected('Down'); }},\n      {key: ['up', true], fn () { moveSelected(0, -1); }},\n      {key: ['down', true], fn () { moveSelected(0, 1); }},\n      {key: ['left', true], fn () { moveSelected(-1, 0); }},\n      {key: ['right', true], fn () { moveSelected(1, 0); }},\n      {key: 'shift+up', fn () { moveSelected(0, -10); }},\n      {key: 'shift+down', fn () { moveSelected(0, 10); }},\n      {key: 'shift+left', fn () { moveSelected(-10, 0); }},\n      {key: 'shift+right', fn () { moveSelected(10, 0); }},\n      {key: ['alt+up', true], fn () { svgCanvas.cloneSelectedElements(0, -1); }},\n      {key: ['alt+down', true], fn () { svgCanvas.cloneSelectedElements(0, 1); }},\n      {key: ['alt+left', true], fn () { svgCanvas.cloneSelectedElements(-1, 0); }},\n      {key: ['alt+right', true], fn () { svgCanvas.cloneSelectedElements(1, 0); }},\n      {key: ['alt+shift+up', true], fn () { svgCanvas.cloneSelectedElements(0, -10); }},\n      {key: ['alt+shift+down', true], fn () { svgCanvas.cloneSelectedElements(0, 10); }},\n      {key: ['alt+shift+left', true], fn () { svgCanvas.cloneSelectedElements(-10, 0); }},\n      {key: ['alt+shift+right', true], fn () { svgCanvas.cloneSelectedElements(10, 0); }},\n      {key: 'A', fn () { svgCanvas.selectAllInCurrentLayer(); }},\n\n      // Standard shortcuts\n      {key: modKey + 'z', fn: clickUndo},\n      {key: modKey + 'shift+z', fn: clickRedo},\n      {key: modKey + 'y', fn: clickRedo},\n\n      {key: modKey + 'x', fn: cutSelected},\n      {key: modKey + 'c', fn: copySelected},\n      {key: modKey + 'v', fn: pasteInCenter}\n    ];\n\n    // Tooltips not directly associated with a single function\n    const keyAssocs = {\n      '4/Shift+4': '#tools_rect_show',\n      '5/Shift+5': '#tools_ellipse_show'\n    };\n\n    return { /** @lends module:SVGEditor~Actions */\n      /**\n       * @returns {undefined}\n       */\n      setAll () {\n        const flyouts = {};\n\n        $.each(toolButtons, function (i, opts) {\n          // Bind function to button\n          let btn;\n          if (opts.sel) {\n            btn = $(opts.sel);\n            if (!btn.length) { return true; } // Skip if markup does not exist\n            if (opts.evt) {\n              if (isTouch() && opts.evt === 'click') {\n                opts.evt = 'mousedown';\n              }\n              btn[opts.evt](opts.fn);\n            }\n\n            // Add to parent flyout menu, if able to be displayed\n            if (opts.parent && $(opts.parent + '_show').length) {\n              let fH = $(opts.parent);\n              if (!fH.length) {\n                fH = makeFlyoutHolder(opts.parent.substr(1));\n              }\n              if (opts.prepend) {\n                btn[0].style.margin = 'initial';\n              }\n              fH[opts.prepend ? 'prepend' : 'append'](btn);\n\n              if (!Array.isArray(flyouts[opts.parent])) {\n                flyouts[opts.parent] = [];\n              }\n              flyouts[opts.parent].push(opts);\n            }\n          }\n\n          // Bind function to shortcut key\n          if (opts.key) {\n            // Set shortcut based on options\n            let keyval,\n              // disInInp = true,\n              pd = false;\n            if (Array.isArray(opts.key)) {\n              keyval = opts.key[0];\n              if (opts.key.length > 1) { pd = opts.key[1]; }\n              // if (opts.key.length > 2) { disInInp = opts.key[2]; }\n            } else {\n              keyval = opts.key;\n            }\n            keyval += '';\n\n            const {fn} = opts;\n            $.each(keyval.split('/'), function (i, key) {\n              $(document).bind('keydown', key, function (e) {\n                fn();\n                if (pd) {\n                  e.preventDefault();\n                }\n                // Prevent default on ALL keys?\n                return false;\n              });\n            });\n\n            // Put shortcut in title\n            if (opts.sel && !opts.hidekey && btn.attr('title')) {\n              const newTitle = btn.attr('title').split('[')[0] + ' (' + keyval + ')';\n              keyAssocs[keyval] = opts.sel;\n              // Disregard for menu items\n              if (!btn.parents('#main_menu').length) {\n                btn.attr('title', newTitle);\n              }\n            }\n          }\n        });\n\n        // Setup flyouts\n        setupFlyouts(flyouts);\n\n        // Misc additional actions\n\n        // Make 'return' keypress trigger the change event\n        $('.attr_changer, #image_url').bind('keydown', 'return',\n          function (evt) {\n            $(this).change();\n            evt.preventDefault();\n          }\n        );\n\n        $(window).bind('keydown', 'tab', function (e) {\n          if (uiContext === 'canvas') {\n            e.preventDefault();\n            selectNext();\n          }\n        }).bind('keydown', 'shift+tab', function (e) {\n          if (uiContext === 'canvas') {\n            e.preventDefault();\n            selectPrev();\n          }\n        });\n\n        $('#tool_zoom').dblclick(dblclickZoom);\n      },\n      /**\n       * @returns {undefined}\n       */\n      setTitles () {\n        $.each(keyAssocs, function (keyval, sel) {\n          const menu = ($(sel).parents('#main_menu').length);\n\n          $(sel).each(function () {\n            let t;\n            if (menu) {\n              t = $(this).text().split(' [')[0];\n            } else {\n              t = this.title.split(' [')[0];\n            }\n            let keyStr = '';\n            // Shift+Up\n            $.each(keyval.split('/'), function (i, key) {\n              const modBits = key.split('+');\n              let mod = '';\n              if (modBits.length > 1) {\n                mod = modBits[0] + '+';\n                key = modBits[1];\n              }\n              keyStr += (i ? '/' : '') + mod + (uiStrings['key_' + key] || key);\n            });\n            if (menu) {\n              this.lastChild.textContent = t + ' [' + keyStr + ']';\n            } else {\n              this.title = t + ' [' + keyStr + ']';\n            }\n          });\n        });\n      },\n      /**\n       * @param {string} sel Selector to match\n       * @returns {module:SVGEditor.ToolButton}\n       */\n      getButtonData (sel) {\n        return Object.values(toolButtons).find((btn) => {\n          return btn.sel === sel;\n        });\n      }\n    };\n  }());\n\n  // Select given tool\n  editor.ready(function () {\n    let tool;\n    const itool = curConfig.initTool,\n      container = $('#tools_left, #svg_editor .tools_flyout'),\n      preTool = container.find('#tool_' + itool),\n      regTool = container.find('#' + itool);\n    if (preTool.length) {\n      tool = preTool;\n    } else if (regTool.length) {\n      tool = regTool;\n    } else {\n      tool = $('#tool_select');\n    }\n    tool.click().mouseup();\n\n    if (curConfig.wireframe) {\n      $('#tool_wireframe').click();\n    }\n\n    if (curConfig.showlayers) {\n      toggleSidePanel();\n    }\n\n    $('#rulers').toggle(!!curConfig.showRulers);\n\n    if (curConfig.showRulers) {\n      $('#show_rulers')[0].checked = true;\n    }\n\n    if (curConfig.baseUnit) {\n      $('#base_unit').val(curConfig.baseUnit);\n    }\n\n    if (curConfig.gridSnapping) {\n      $('#grid_snapping_on')[0].checked = true;\n    }\n\n    if (curConfig.snappingStep) {\n      $('#grid_snapping_step').val(curConfig.snappingStep);\n    }\n\n    if (curConfig.gridColor) {\n      $('#grid_color').val(curConfig.gridColor);\n    }\n  });\n\n  // init SpinButtons\n  $('#rect_rx').SpinButton({min: 0, max: 1000, stateObj, callback: changeRectRadius});\n  $('#stroke_width').SpinButton({min: 0, max: 99, smallStep: 0.1, stateObj, callback: changeStrokeWidth});\n  $('#angle').SpinButton({min: -180, max: 180, step: 5, stateObj, callback: changeRotationAngle});\n  $('#font_size').SpinButton({min: 0.001, stepfunc: stepFontSize, stateObj, callback: changeFontSize});\n  $('#group_opacity').SpinButton({min: 0, max: 100, step: 5, stateObj, callback: changeOpacity});\n  $('#blur').SpinButton({min: 0, max: 10, step: 0.1, stateObj, callback: changeBlur});\n  $('#zoom').SpinButton({min: 0.001, max: 10000, step: 50, stepfunc: stepZoom, stateObj, callback: changeZoom})\n    // Set default zoom\n    .val(svgCanvas.getZoom() * 100);\n\n  $('#workarea').contextMenu(\n    {\n      menu: 'cmenu_canvas',\n      inSpeed: 0\n    },\n    function (action, el, pos) {\n      switch (action) {\n      case 'delete':\n        deleteSelected();\n        break;\n      case 'cut':\n        cutSelected();\n        break;\n      case 'copy':\n        copySelected();\n        break;\n      case 'paste':\n        svgCanvas.pasteElements();\n        break;\n      case 'paste_in_place':\n        svgCanvas.pasteElements('in_place');\n        break;\n      case 'group':\n      case 'group_elements':\n        svgCanvas.groupSelectedElements();\n        break;\n      case 'ungroup':\n        svgCanvas.ungroupSelectedElement();\n        break;\n      case 'move_front':\n        moveToTopSelected();\n        break;\n      case 'move_up':\n        moveUpDownSelected('Up');\n        break;\n      case 'move_down':\n        moveUpDownSelected('Down');\n        break;\n      case 'move_back':\n        moveToBottomSelected();\n        break;\n      default:\n        if (hasCustomHandler(action)) {\n          getCustomHandler(action).call();\n        }\n        break;\n      }\n    }\n  );\n\n  const lmenuFunc = function (action, el, pos) {\n    switch (action) {\n    case 'dupe':\n      cloneLayer();\n      break;\n    case 'delete':\n      deleteLayer();\n      break;\n    case 'merge_down':\n      mergeLayer();\n      break;\n    case 'merge_all':\n      svgCanvas.mergeAllLayers();\n      updateContextPanel();\n      populateLayers();\n      break;\n    }\n  };\n\n  $('#layerlist').contextMenu(\n    {\n      menu: 'cmenu_layers',\n      inSpeed: 0\n    },\n    lmenuFunc\n  );\n\n  $('#layer_moreopts').contextMenu(\n    {\n      menu: 'cmenu_layers',\n      inSpeed: 0,\n      allowLeft: true\n    },\n    lmenuFunc\n  );\n\n  $('.contextMenu li').mousedown(function (ev) {\n    ev.preventDefault();\n  });\n\n  $('#cmenu_canvas li').disableContextMenu();\n  canvMenu.enableContextMenuItems('#delete,#cut,#copy');\n\n  function enableOrDisableClipboard () {\n    let svgeditClipboard;\n    try {\n      svgeditClipboard = localStorage.getItem('svgedit_clipboard');\n    } catch (err) {}\n    canvMenu[(svgeditClipboard ? 'en' : 'dis') + 'ableContextMenuItems'](\n      '#paste,#paste_in_place'\n    );\n  }\n  enableOrDisableClipboard();\n\n  window.addEventListener('storage', function (e) {\n    if (e.key !== 'svgedit_clipboard') { return; }\n\n    enableOrDisableClipboard();\n  });\n\n  window.addEventListener('beforeunload', function (e) {\n    // Suppress warning if page is empty\n    if (undoMgr.getUndoStackSize() === 0) {\n      editor.showSaveWarning = false;\n    }\n\n    // showSaveWarning is set to 'false' when the page is saved.\n    if (!curConfig.no_save_warning && editor.showSaveWarning) {\n      // Browser already asks question about closing the page\n      e.returnValue = uiStrings.notification.unsavedChanges; // Firefox needs this when beforeunload set by addEventListener (even though message is not used)\n      return uiStrings.notification.unsavedChanges;\n    }\n  }, false);\n\n  /**\n  * Expose the uiStrings\n  * @function module:SVGEditor.canvas.getUIStrings\n  * @returns {module:SVGEditor.uiStrings}\n  */\n  editor.canvas.getUIStrings = function () {\n    return uiStrings;\n  };\n\n  /**\n  * @callback module:SVGEditor.OpenPrepCallback\n  * @param {boolean} noChanges\n  * @returns {undefined}\n  */\n  /**\n  * @param {module:SVGEditor.OpenPrepCallback} func Confirmation dialog callback\n  * @returns {undefined}\n  */\n  editor.openPrep = function (func) {\n    $('#main_menu').hide();\n    if (undoMgr.getUndoStackSize() === 0) {\n      func(true);\n    } else {\n      $.confirm(uiStrings.notification.QwantToOpen, func);\n    }\n  };\n\n  function onDragEnter (e) {\n    e.stopPropagation();\n    e.preventDefault();\n    // and indicator should be displayed here, such as \"drop files here\"\n  }\n\n  function onDragOver (e) {\n    e.stopPropagation();\n    e.preventDefault();\n  }\n\n  function onDragLeave (e) {\n    e.stopPropagation();\n    e.preventDefault();\n    // hypothetical indicator should be removed here\n  }\n  // Use HTML5 File API: http://www.w3.org/TR/FileAPI/\n  // if browser has HTML5 File API support, then we will show the open menu item\n  // and provide a file input to click. When that change event fires, it will\n  // get the text contents of the file and send it to the canvas\n  if (window.FileReader) {\n    const importImage = function (e) {\n      $.process_cancel(uiStrings.notification.loadingImage);\n      e.stopPropagation();\n      e.preventDefault();\n      $('#workarea').removeAttr('style');\n      $('#main_menu').hide();\n      const file = (e.type === 'drop') ? e.dataTransfer.files[0] : this.files[0];\n      if (!file) {\n        $('#dialog_box').hide();\n        return;\n      }\n      /* if (file.type === 'application/pdf') { // Todo: Handle PDF imports\n\n      }\n      else */\n      if (file.type.includes('image')) {\n        // Detected an image\n        // svg handling\n        let reader;\n        if (file.type.includes('svg')) {\n          reader = new FileReader();\n          reader.onloadend = function (e) {\n            const newElement = svgCanvas.importSvgString(e.target.result, true);\n            svgCanvas.ungroupSelectedElement();\n            svgCanvas.ungroupSelectedElement();\n            svgCanvas.groupSelectedElements();\n            svgCanvas.alignSelectedElements('m', 'page');\n            svgCanvas.alignSelectedElements('c', 'page');\n            // highlight imported element, otherwise we get strange empty selectbox\n            svgCanvas.selectOnly([newElement]);\n            $('#dialog_box').hide();\n          };\n          reader.readAsText(file);\n        } else {\n          // bitmap handling\n          reader = new FileReader();\n          reader.onloadend = function (e) {\n            // let's insert the new image until we know its dimensions\n            const insertNewImage = function (width, height) {\n              const newImage = svgCanvas.addSVGElementFromJson({\n                element: 'image',\n                attr: {\n                  x: 0,\n                  y: 0,\n                  width,\n                  height,\n                  id: svgCanvas.getNextId(),\n                  style: 'pointer-events:inherit'\n                }\n              });\n              svgCanvas.setHref(newImage, e.target.result);\n              svgCanvas.selectOnly([newImage]);\n              svgCanvas.alignSelectedElements('m', 'page');\n              svgCanvas.alignSelectedElements('c', 'page');\n              updateContextPanel();\n              $('#dialog_box').hide();\n            };\n            // create dummy img so we know the default dimensions\n            let imgWidth = 100;\n            let imgHeight = 100;\n            const img = new Image();\n            img.src = e.target.result;\n            img.style.opacity = 0;\n            img.onload = function () {\n              imgWidth = img.offsetWidth;\n              imgHeight = img.offsetHeight;\n              insertNewImage(imgWidth, imgHeight);\n            };\n          };\n          reader.readAsDataURL(file);\n        }\n      }\n    };\n\n    workarea[0].addEventListener('dragenter', onDragEnter, false);\n    workarea[0].addEventListener('dragover', onDragOver, false);\n    workarea[0].addEventListener('dragleave', onDragLeave, false);\n    workarea[0].addEventListener('drop', importImage, false);\n\n    const open = $('<input type=\"file\">').change(function () {\n      const f = this;\n      editor.openPrep(function (ok) {\n        if (!ok) { return; }\n        svgCanvas.clear();\n        if (f.files.length === 1) {\n          $.process_cancel(uiStrings.notification.loadingImage);\n          const reader = new FileReader();\n          reader.onloadend = function (e) {\n            loadSvgString(e.target.result);\n            updateCanvas();\n          };\n          reader.readAsText(f.files[0]);\n        }\n      });\n    });\n    $('#tool_open').show().prepend(open);\n\n    const imgImport = $('<input type=\"file\">').change(importImage);\n    $('#tool_import').show().prepend(imgImport);\n  }\n\n  // $(function () {\n  updateCanvas(true);\n  // });\n\n  //  const revnums = 'svg-editor.js ($Rev$) ';\n  //  revnums += svgCanvas.getVersion();\n  //  $('#copyright')[0].setAttribute('title', revnums);\n\n  /**\n  * @function module:SVGEditor.setLang\n  * @param {string} lang The language code\n  * @param {module:locale.LocaleStrings} allStrings See {@tutorial LocaleDocs}\n  * @fires module:svgcanvas.SvgCanvas#event:ext-langReady\n  * @fires module:svgcanvas.SvgCanvas#event:ext-langChanged\n  * @returns {undefined}\n  */\n  const setLang = editor.setLang = function (lang, allStrings) {\n    editor.langChanged = true;\n    $.pref('lang', lang);\n    $('#lang_select').val(lang);\n    if (!allStrings) {\n      return;\n    }\n    $.extend(uiStrings, allStrings);\n\n    // const notif = allStrings.notification; // Currently unused\n    // $.extend will only replace the given strings\n    const oldLayerName = $('#layerlist tr.layersel td.layername').text();\n    const renameLayer = (oldLayerName === uiStrings.common.layer + ' 1');\n\n    svgCanvas.setUiStrings(allStrings);\n    Actions.setTitles();\n\n    if (renameLayer) {\n      svgCanvas.renameCurrentLayer(uiStrings.common.layer + ' 1');\n      populateLayers();\n    }\n\n    // In case extensions loaded before the locale, now we execute a callback on them\n    if (extsPreLang.length) {\n      while (extsPreLang.length) {\n        const ext = extsPreLang.shift();\n        ext.langReady({\n          lang,\n          uiStrings,\n          importLocale: getImportLocale({defaultLang: lang, defaultName: ext.name})\n        });\n      }\n    } else {\n      svgCanvas.runExtensions('langReady', /** @type {module:svgcanvas.SvgCanvas#event:ext-langReady} */ {lang, uiStrings});\n    }\n    svgCanvas.runExtensions('langChanged', /** @type {module:svgcanvas.SvgCanvas#event:ext-langChanged} */ lang);\n\n    // Update flyout tooltips\n    setFlyoutTitles();\n\n    // Copy title for certain tool elements\n    const elems = {\n      '#stroke_color': '#tool_stroke .icon_label, #tool_stroke .color_block',\n      '#fill_color': '#tool_fill label, #tool_fill .color_block',\n      '#linejoin_miter': '#cur_linejoin',\n      '#linecap_butt': '#cur_linecap'\n    };\n\n    $.each(elems, function (source, dest) {\n      $(dest).attr('title', $(source)[0].title);\n    });\n\n    // Copy alignment titles\n    $('#multiselected_panel div[id^=tool_align]').each(function () {\n      $('#tool_pos' + this.id.substr(10))[0].title = this.title;\n    });\n  };\n  localeInit(\n    /**\n    * @implements {module:locale.LocaleEditorInit}\n    */\n    {\n      /**\n      * Gets an array of results from extensions with a `addLangData` method\n      * returning an object with a `data` property set to its locales (to be\n      * merged with regular locales)\n      * @param {string} langParam\n      * @fires module:svgcanvas.SvgCanvas#event:ext-addLangData\n      * @todo Can we forego this in favor of `langReady` (or forego `langReady`)?\n      * @returns {module:locale.AddLangExtensionLocaleData[]}\n      */\n      addLangData (langParam) {\n        return svgCanvas.runExtensions(\n          'addLangData',\n          /**\n           * @function\n           * @type {module:svgcanvas.ExtensionVarBuilder}\n           * @param {string} defaultLang\n           * @param {string} defaultName\n           * @returns {module:svgcanvas.SvgCanvas#event:ext-addLangData}\n           */\n          (name) => { // We pass in a function as we don't know the extension name here when defining this `addLangData` method\n            return {\n              lang: langParam,\n              importLocale: getImportLocale({defaultLang: langParam, defaultName: name})\n            };\n          },\n          true\n        );\n      },\n      curConfig\n    }\n  );\n  // Load extensions\n  // Bit of a hack to run extensions in local Opera/IE9\n  if (document.location.protocol === 'file:') {\n    setTimeout(extAndLocaleFunc, 100);\n  } else {\n    // Returns a promise (if we wanted to fire 'extensions-loaded' event, potentially useful to hide interface as some extension locales are only available after this)\n    extAndLocaleFunc();\n  }\n};\n\n/**\n* @callback module:SVGEditor.ReadyCallback\n* @returns {undefined}\n*/\n/**\n* Queues a callback to be invoked when the editor is ready (or\n*   to be invoked immediately if it is already ready--i.e.,\n*   if `svgEditor.runCallbacks` has been run)\n* @param {module:SVGEditor.ReadyCallback} cb Callback to be queued to invoke\n* @returns {undefined}\n*/\neditor.ready = function (cb) {\n  if (!isReady) {\n    callbacks.push(cb);\n  } else {\n    cb();\n  }\n};\n\n/**\n* Invokes the callbacks previous set by `svgEditor.ready`\n* @returns {undefined}\n*/\neditor.runCallbacks = function () {\n  callbacks.forEach((cb) => {\n    cb();\n  });\n  isReady = true;\n};\n\n/**\n* @param {string} str The SVG string to load\n* @returns {undefined}\n*/\neditor.loadFromString = function (str) {\n  editor.ready(function () {\n    loadSvgString(str);\n  });\n};\n\n/**\n* Not presently in use\n* @param {PlainObject} featList\n* @returns {undefined}\n*/\neditor.disableUI = function (featList) {\n  // $(function () {\n  //   $('#tool_wireframe, #tool_image, #main_button, #tool_source, #sidepanels').remove();\n  //   $('#tools_top').css('left', 5);\n  // });\n};\n\n/**\n * @callback module:SVGEditor.URLLoadCallback\n * @param {boolean} success\n * @returns {undefined}\n */\n/**\n* @param {string} url URL from which to load an SVG string via Ajax\n* @param {PlainObject} [opts] May contain properties: `cache`, `callback`\n* @param {boolean} opts.cache\n* @param {module:SVGEditor.URLLoadCallback} opts.callback Invoked with `true` or `false` depending on success\n* @returns {undefined}\n*/\neditor.loadFromURL = function (url, opts) {\n  if (!opts) { opts = {}; }\n\n  const {cache, callback: cb} = opts;\n\n  editor.ready(function () {\n    $.ajax({\n      url,\n      dataType: 'text',\n      cache: !!cache,\n      beforeSend () {\n        $.process_cancel(uiStrings.notification.loadingImage);\n      },\n      success (str) {\n        loadSvgString(str, cb);\n      },\n      error (xhr, stat, err) {\n        if (xhr.status !== 404 && xhr.responseText) {\n          loadSvgString(xhr.responseText, cb);\n        } else {\n          $.alert(uiStrings.notification.URLloadFail + ': \\n' + err, cb);\n        }\n      },\n      complete () {\n        $('#dialog_box').hide();\n      }\n    });\n  });\n};\n\n/**\n* @param {string} str The Data URI to base64-decode (if relevant) and load\n* @returns {undefined}\n*/\neditor.loadFromDataURI = function (str) {\n  editor.ready(function () {\n    let base64 = false;\n    let pre = str.match(/^data:image\\/svg\\+xml;base64,/);\n    if (pre) {\n      base64 = true;\n    } else {\n      pre = str.match(/^data:image\\/svg\\+xml(?:;(?:utf8)?)?,/);\n    }\n    if (pre) {\n      pre = pre[0];\n    }\n    const src = str.slice(pre.length);\n    loadSvgString(base64 ? Utils.decode64(src) : decodeURIComponent(src));\n  });\n};\n\n/**\n * @param {string} name Used internally; no need for i18n.\n * @param {module:svgcanvas.ExtensionInitCallback} init Config to be invoked on this module\n * @param {module:SVGEditor~ImportLocale} importLocale Importer defaulting to pth with current extension name and locale\n * @throws {Error} If called too early\n * @returns {Promise} Resolves to `undefined`\n*/\neditor.addExtension = function (name, init, importLocale) {\n  // Note that we don't want this on editor.ready since some extensions\n  // may want to run before then (like server_opensave).\n  // $(function () {\n  if (!svgCanvas) {\n    throw new Error('Extension added too early');\n  }\n  return svgCanvas.addExtension.call(this, name, init, importLocale);\n  // });\n};\n\n// Defer injection to wait out initial menu processing. This probably goes\n//    away once all context menu behavior is brought to context menu.\neditor.ready(() => {\n  injectExtendedContextMenuItemsIntoDom();\n});\n\nlet extensionsAdded = false;\nconst messageQueue = [];\n/**\n * @param {Any} data\n * @param {string} origin\n * @fires module:svgcanvas.SvgCanvas#event:message\n * @returns {undefined}\n */\nconst messageListener = ({data, origin}) => {\n  // console.log('data, origin, extensionsAdded', data, origin, extensionsAdded);\n  const messageObj = {data, origin};\n  if (!extensionsAdded) {\n    messageQueue.push(messageObj);\n  } else {\n    // Extensions can handle messages at this stage with their own\n    //  canvas `message` listeners\n    svgCanvas.call('message', messageObj);\n  }\n};\nwindow.addEventListener('message', messageListener);\n\n// Run init once DOM is loaded\n// jQuery(editor.init);\nPromise.resolve().then(() => {\n  // We wait a micro-task to let the svgEditor variable be defined for module checks\n  editor.init();\n});\n\nexport default editor;\n","// Todo: Update: https://github.com/jeresig/jquery.hotkeys\n/*\n * jQuery Hotkeys Plugin\n * Copyright 2010, John Resig\n * Dual licensed under the MIT or GPL Version 2 licenses.\n *\n * http://github.com/jeresig/jquery.hotkeys\n *\n * Based upon the plugin by Tzury Bar Yochay:\n * http://github.com/tzuryby/hotkeys\n *\n * Original idea by:\n * Binny V A, http://www.openjs.com/scripts/events/keyboard_shortcuts/\n*/\n\nexport default function(b){b.hotkeys={version:\"0.8\",specialKeys:{8:\"backspace\",9:\"tab\",13:\"return\",16:\"shift\",17:\"ctrl\",18:\"alt\",19:\"pause\",20:\"capslock\",27:\"esc\",32:\"space\",33:\"pageup\",34:\"pagedown\",35:\"end\",36:\"home\",37:\"left\",38:\"up\",39:\"right\",40:\"down\",45:\"insert\",46:\"del\",96:\"0\",97:\"1\",98:\"2\",99:\"3\",100:\"4\",101:\"5\",102:\"6\",103:\"7\",104:\"8\",105:\"9\",106:\"*\",107:\"+\",109:\"-\",110:\".\",111:\"/\",112:\"f1\",113:\"f2\",114:\"f3\",115:\"f4\",116:\"f5\",117:\"f6\",118:\"f7\",119:\"f8\",120:\"f9\",121:\"f10\",122:\"f11\",123:\"f12\",144:\"numlock\",145:\"scroll\",191:\"/\",224:\"meta\",219:\"[\",221:\"]\"},shiftNums:{\"`\":\"~\",\"1\":\"!\",\"2\":\"@\",\"3\":\"#\",\"4\":\"$\",\"5\":\"%\",\"6\":\"^\",\"7\":\"&\",\"8\":\"*\",\"9\":\"(\",\"0\":\")\",\"-\":\"_\",\"=\":\"+\",\";\":\": \",\"'\":'\"',\",\":\"<\",\".\":\">\",\"/\":\"?\",\"\\\\\":\"|\"}};function a(d){if(typeof d.data!==\"string\"){return}var c=d.handler,e=d.data.toLowerCase().split(\" \");d.handler=function(n){if(this!==n.target&&(/textarea|select/i.test(n.target.nodeName)||n.target.type===\"text\")){return}var h=n.type!==\"keypress\"&&b.hotkeys.specialKeys[n.which],o=String.fromCharCode(n.which).toLowerCase(),k,m=\"\",g={};if(n.altKey&&h!==\"alt\"){m+=\"alt+\"}if(n.ctrlKey&&h!==\"ctrl\"){m+=\"ctrl+\"}if(n.metaKey&&!n.ctrlKey&&h!==\"meta\"){m+=\"meta+\"}if(n.shiftKey&&h!==\"shift\"){m+=\"shift+\"}if(h){g[m+h]=true}else{g[m+o]=true;g[m+b.hotkeys.shiftNums[o]]=true;if(m===\"shift+\"){g[b.hotkeys.shiftNums[o]]=true}}for(var j=0,f=e.length;j<f;j++){if(g[e[j]]){return c.apply(this,arguments)}}}}b.each([\"keydown\",\"keyup\",\"keypress\"],function(){b.event.special[this]={add:a}})\n\nreturn b;\n}\n","/*\n * Todo: Update to latest at https://github.com/cowboy/jquery-bbq ?\n * jQuery BBQ: Back Button & Query Library - v1.2.1 - 2/17/2010\n * http://benalman.com/projects/jquery-bbq-plugin/\n *\n * Copyright (c) 2010 \"Cowboy\" Ben Alman\n * Dual licensed under the MIT and GPL licenses.\n * http://benalman.com/about/license/\n */\n\n// For sake of modules, added this wrapping export and changed `this` to `window`\nexport default function (jQuery) {\n\n(function($,p){var i,m=Array.prototype.slice,r=decodeURIComponent,a=$.param,c,l,v,b=$.bbq=$.bbq||{},q,u,j,e=$.event.special,d=\"hashchange\",A=\"querystring\",D=\"fragment\",y=\"elemUrlAttr\",g=\"location\",k=\"href\",t=\"src\",x=/^.*\\?|#.*$/g,w=/^.*\\#/,h,C={};function E(F){return typeof F===\"string\"}function B(G){var F=m.call(arguments,1);return function(){return G.apply(this,F.concat(m.call(arguments)))}}function n(F){return F.replace(/^[^#]*#?(.*)$/,\"$1\")}function o(F){return F.replace(/(?:^[^?#]*\\?([^#]*).*$)?.*/,\"$1\")}function f(H,M,F,I,G){var O,L,K,N,J;if(I!==i){K=F.match(H?/^([^#]*)\\#?(.*)$/:/^([^#?]*)\\??([^#]*)(#?.*)/);J=K[3]||\"\";if(G===2&&E(I)){L=I.replace(H?w:x,\"\")}else{N=l(K[2]);I=E(I)?l[H?D:A](I):I;L=G===2?I:G===1?$.extend({},I,N):$.extend({},N,I);L=a(L);if(H){L=L.replace(h,r)}}O=K[1]+(H?\"#\":L||!K[1]?\"?\":\"\")+L+J}else{O=M(F!==i?F:p[g][k])}return O}a[A]=B(f,0,o);a[D]=c=B(f,1,n);c.noEscape=function(G){G=G||\"\";var F=$.map(G.split(\"\"),encodeURIComponent);h=new RegExp(F.join(\"|\"),\"g\")};c.noEscape(\",/\");$.deparam=l=function(I,F){var H={},G={\"true\":!0,\"false\":!1,\"null\":null};$.each(I.replace(/\\+/g,\" \").split(\"&\"),function(L,Q){var K=Q.split(\"=\"),P=r(K[0]),J,O=H,M=0,R=P.split(\"][\"),N=R.length-1;if(/\\[/.test(R[0])&&/\\]$/.test(R[N])){R[N]=R[N].replace(/\\]$/,\"\");R=R.shift().split(\"[\").concat(R);N=R.length-1}else{N=0}if(K.length===2){J=r(K[1]);if(F){J=J&&!isNaN(J)?+J:J===\"undefined\"?i:G[J]!==i?G[J]:J}if(N){for(;M<=N;M++){P=R[M]===\"\"?O.length:R[M];O=O[P]=M<N?O[P]||(R[M+1]&&isNaN(R[M+1])?{}:[]):J}}else{if($.isArray(H[P])){H[P].push(J)}else{if(H[P]!==i){H[P]=[H[P],J]}else{H[P]=J}}}}else{if(P){H[P]=F?i:\"\"}}});return H};function z(H,F,G){if(F===i||typeof F===\"boolean\"){G=F;F=a[H?D:A]()}else{F=E(F)?F.replace(H?w:x,\"\"):F}return l(F,G)}l[A]=B(z,0);l[D]=v=B(z,1);$[y]||($[y]=function(F){return $.extend(C,F)})({a:k,base:k,iframe:t,img:t,input:t,form:\"action\",link:k,script:t});j=$[y];function s(I,G,H,F){if(!E(H)&&typeof H!==\"object\"){F=H;H=G;G=i}return this.each(function(){var L=$(this),J=G||j()[(this.nodeName||\"\").toLowerCase()]||\"\",K=J&&L.attr(J)||\"\";L.attr(J,a[I](K,H,F))})}$.fn[A]=B(s,A);$.fn[D]=B(s,D);b.pushState=q=function(I,F){if(E(I)&&/^#/.test(I)&&F===i){F=2}var H=I!==i,G=c(p[g][k],H?I:{},H?F:2);p[g][k]=G+(/#/.test(G)?\"\":\"#\")};b.getState=u=function(F,G){return F===i||typeof F===\"boolean\"?v(F):v(G)[F]};b.removeState=function(F){var G={};if(F!==i){G=u();$.each($.isArray(F)?F:arguments,function(I,H){delete G[H]})}q(G,2)};e[d]=$.extend(e[d],{add:function(F){var H;function G(J){var I=J[D]=c();J.getState=function(K,L){return K===i||typeof K===\"boolean\"?l(I,K):l(I,L)[K]};H.apply(this,arguments)}if($.isFunction(F)){H=F;return G}else{H=F.handler;F.handler=G}}})})(jQuery,window);\n/*\n * jQuery hashchange event - v1.2 - 2/11/2010\n * http://benalman.com/projects/jquery-hashchange-plugin/\n *\n * Copyright (c) 2010 \"Cowboy\" Ben Alman\n * Dual licensed under the MIT and GPL licenses.\n * http://benalman.com/about/license/\n */\n(function($,i,b){var j,k=$.event.special,c=\"location\",d=\"hashchange\",l=\"href\",f=$.browser,g=document.documentMode,h=f.msie&&(g===b||g<8),e=\"on\"+d in i&&!h;function a(m){m=m||i[c][l];return m.replace(/^[^#]*#?(.*)$/,\"$1\")}$[d+\"Delay\"]=100;k[d]=$.extend(k[d],{setup:function(){if(e){return false}$(j.start)},teardown:function(){if(e){return false}$(j.stop)}});j=(function(){var m={},r,n,o,q;function p(){o=q=function(s){return s};if(h){n=$('<iframe src=\"javascript:0\"/>').hide().insertAfter(\"body\")[0].contentWindow;q=function(){return a(n.document[c][l])};o=function(u,s){if(u!==s){var t=n.document;t.open().close();t[c].hash=\"#\"+u}};o(a())}}m.start=function(){if(r){return}var t=a();o||p();(function s(){var v=a(),u=q(t);if(v!==t){o(t=v,u);$(i).trigger(d)}else{if(u!==t){i[c][l]=i[c][l].replace(/#.*/,\"\")+\"#\"+u}}r=setTimeout(s,$[d+\"Delay\"])})()};m.stop=function(){if(!n){r&&clearTimeout(r);r=0}};return m})()})(jQuery,window);\n\nreturn jQuery;\n}\n","/**\n * SVG Icon Loader 2.0\n *\n * jQuery Plugin for loading SVG icons from a single file\n *\n * Adds {@link external:jQuery.svgIcons}, {@link external:jQuery.getSvgIcon}, {@link external:jQuery.resizeSvgIcons}\n *\n * How to use:\n\n1. Create the SVG master file that includes all icons:\n\nThe master SVG icon-containing file is an SVG file that contains\n`<g>` elements. Each `<g>` element should contain the markup of an SVG\nicon. The `<g>` element has an ID that should\ncorrespond with the ID of the HTML element used on the page that should contain\nor optionally be replaced by the icon. Additionally, one empty element should be\nadded at the end with id \"svg_eof\".\n\n2. Optionally create fallback raster images for each SVG icon.\n\n3. Include the jQuery and the SVG Icon Loader scripts on your page.\n\n4. Run `$.svgIcons()` when the document is ready. See its signature\n\n5. To access an icon at a later point without using the callback, use this:\n  `$.getSvgIcon(id (string), uniqueClone (boolean))`;\n\nThis will return the icon (as jQuery object) with a given ID.\n\n6. To resize icons at a later point without using the callback, use this:\n  `$.resizeSvgIcons(resizeOptions)` (use the same way as the \"resize\" parameter)\n *\n * @module jQuerySVGIcons\n * @license MIT\n * @copyright (c) 2009 Alexis Deveria\n * {@link http://a.deveria.com}\n * @example usage #1:\n\n$(function() {\n  $.svgIcons('my_icon_set.svg'); // The SVG file that contains all icons\n  // No options have been set, so all icons will automatically be inserted\n  // into HTML elements that match the same IDs.\n});\n\n* @example usage #2:\n\n$(function() {\n  $.svgIcons('my_icon_set.svg', { // The SVG file that contains all icons\n    callback (icons) { // Custom callback function that sets click\n                  // events for each icon\n      $.each(icons, function(id, icon) {\n        icon.click(function() {\n          alert('You clicked on the icon with id ' + id);\n        });\n      });\n    }\n  }); //The SVG file that contains all icons\n});\n\n* @example usage #3:\n\n$(function() {\n  $.svgIcons('my_icon_set.svgz', { // The SVGZ file that contains all icons\n    w: 32,  // All icons will be 32px wide\n    h: 32,  // All icons will be 32px high\n    fallback_path: 'icons/',  // All fallback files can be found here\n    fallback: {\n      '#open_icon': 'open.png',  // The \"open.png\" will be appended to the\n                    // HTML element with ID \"open_icon\"\n      '#close_icon': 'close.png',\n      '#save_icon': 'save.png'\n    },\n    placement: {'.open_icon','open'}, // The \"open\" icon will be added\n                    // to all elements with class \"open_icon\"\n    resize () {\n      '#save_icon .svg_icon': 64  // The \"save\" icon will be resized to 64 x 64px\n    },\n\n    callback (icons) { // Sets background color for \"close\" icon\n      icons['close'].css('background','red');\n    },\n\n    svgz: true // Indicates that an SVGZ file is being used\n\n  })\n});\n*/\n\n/**\n* @callback module:jQuerySVGIcons.SVGIconsLoadedCallback\n* @param {PlainObject.<string, external:jQuery>} svgIcons IDs keyed to jQuery objects of images\n*/\n\n/**\n * @function module:jQuerySVGIcons.jQuerySVGIcons\n * @param {external:jQuery} $ Its keys include all icon IDs and the values, the icon as a jQuery object\n*/\nexport default function ($) {\n  const svgIcons = {};\n\n  let fixIDs;\n  /**\n  * @function external:jQuery.svgIcons\n  * @param {string} file The location of a local SVG or SVGz file\n  * @param {PlainObject} [options]\n  * @param {Float} [options.w] The icon widths\n  * @param {Float} [options.h] The icon heights\n  * @param {PlainObject.<string, string>} [options.fallback] List of raster images with each\n    key being the SVG icon ID to replace, and the value the image file name\n  * @param {string} [options.fallback_path] The path to use for all images\n    listed under \"fallback\"\n  * @param {boolean} [options.replace] If set to `true`, HTML elements will be replaced by,\n    rather than include the SVG icon.\n  * @param {PlainObject.<string, string>} [options.placement] List with selectors for keys and SVG icon ids\n    as values. This provides a custom method of adding icons.\n  * @param {PlainObject.<string, module:jQuerySVGIcons.Size>} [options.resize] List with selectors for keys and numbers\n    as values. This allows an easy way to resize specific icons.\n  * @param {module:jQuerySVGIcons.SVGIconsLoadedCallback} [options.callback] A function to call when all icons have been loaded.\n  * @param {boolean} [options.id_match=true] Automatically attempt to match SVG icon ids with\n    corresponding HTML id\n  * @param {boolean} [options.no_img] Prevent attempting to convert the icon into an `<img>`\n    element (may be faster, help for browser consistency)\n  * @param {boolean} [options.svgz] Indicate that the file is an SVGZ file, and thus not to\n    parse as XML. SVGZ files add compression benefits, but getting data from\n    them fails in Firefox 2 and older.\n  */\n  $.svgIcons = function (file, opts = {}) {\n    const svgns = 'http://www.w3.org/2000/svg',\n      xlinkns = 'http://www.w3.org/1999/xlink',\n      iconW = opts.w || 24,\n      iconH = opts.h || 24;\n    let elems, svgdoc, testImg,\n      iconsMade = false, dataLoaded = false, loadAttempts = 0;\n    const isOpera = !!window.opera,\n      // ua = navigator.userAgent,\n      // isSafari = (ua.includes('Safari/') && !ua.includes('Chrome/')),\n      dataPre = 'data:image/svg+xml;charset=utf-8;base64,';\n\n    let dataEl;\n    if (opts.svgz) {\n      dataEl = $('<object data=\"' + file + '\" type=image/svg+xml>').appendTo('body').hide();\n      try {\n        svgdoc = dataEl[0].contentDocument;\n        dataEl.load(getIcons);\n        getIcons(0, true); // Opera will not run \"load\" event if file is already cached\n      } catch (err1) {\n        useFallback();\n      }\n    } else {\n      const parser = new DOMParser();\n      $.ajax({\n        url: file,\n        dataType: 'string',\n        success (data) {\n          if (!data) {\n            $(useFallback);\n            return;\n          }\n          svgdoc = parser.parseFromString(data, 'text/xml');\n          $(function () {\n            getIcons('ajax');\n          });\n        },\n        error (err) {\n          // TODO: Fix Opera widget icon bug\n          if (window.opera) {\n            $(function () {\n              useFallback();\n            });\n          } else {\n            if (err.responseText) {\n              svgdoc = parser.parseFromString(err.responseText, 'text/xml');\n\n              if (!svgdoc.childNodes.length) {\n                $(useFallback);\n              }\n              $(function () {\n                getIcons('ajax');\n              });\n            } else {\n              $(useFallback);\n            }\n          }\n        }\n      });\n    }\n\n    function getIcons (evt, noWait) {\n      if (evt !== 'ajax') {\n        if (dataLoaded) return;\n        // Webkit sometimes says svgdoc is undefined, other times\n        // it fails to load all nodes. Thus we must make sure the \"eof\"\n        // element is loaded.\n        svgdoc = dataEl[0].contentDocument; // Needed again for Webkit\n        const isReady = (svgdoc && svgdoc.getElementById('svg_eof'));\n        if (!isReady && !(noWait && isReady)) {\n          loadAttempts++;\n          if (loadAttempts < 50) {\n            setTimeout(getIcons, 20);\n          } else {\n            useFallback();\n            dataLoaded = true;\n          }\n          return;\n        }\n        dataLoaded = true;\n      }\n\n      elems = $(svgdoc.firstChild).children(); // .getElementsByTagName('foreignContent');\n\n      if (!opts.no_img) {\n        const testSrc = dataPre + 'PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIyNzUiIGhlaWdodD0iMjc1Ij48L3N2Zz4%3D';\n\n        testImg = $(new Image()).attr({\n          src: testSrc,\n          width: 0,\n          height: 0\n        }).appendTo('body')\n          .load(function () {\n            // Safari 4 crashes, Opera and Chrome don't\n            makeIcons(true);\n          }).error(function () {\n            makeIcons();\n          });\n      } else {\n        setTimeout(function () {\n          if (!iconsMade) makeIcons();\n        }, 500);\n      }\n    }\n\n    function setIcon (target, icon, id, setID) {\n      if (isOpera) icon.css('visibility', 'hidden');\n      if (opts.replace) {\n        if (setID) icon.attr('id', id);\n        const cl = target.attr('class');\n        if (cl) icon.attr('class', 'svg_icon ' + cl);\n        target.replaceWith(icon);\n      } else {\n        target.append(icon);\n      }\n      if (isOpera) {\n        setTimeout(function () {\n          icon.removeAttr('style');\n        }, 1);\n      }\n    }\n\n    let holder;\n    function addIcon (icon, id) {\n      if (opts.id_match === undefined || opts.id_match !== false) {\n        setIcon(holder, icon, id, true);\n      }\n      svgIcons[id] = icon;\n    }\n\n    function makeIcons (toImage, fallback) {\n      if (iconsMade) return;\n      if (opts.no_img) toImage = false;\n\n      let tempHolder;\n      if (toImage) {\n        tempHolder = $(document.createElement('div'));\n        tempHolder.hide().appendTo('body');\n      }\n      if (fallback) {\n        const path = opts.fallback_path || '';\n        $.each(fallback, function (id, imgsrc) {\n          holder = $('#' + id);\n          const icon = $(new Image())\n            .attr({\n              class: 'svg_icon',\n              src: path + imgsrc,\n              width: iconW,\n              height: iconH,\n              alt: 'icon'\n            });\n\n          addIcon(icon, id);\n        });\n      } else {\n        const len = elems.length;\n        for (let i = 0; i < len; i++) {\n          const elem = elems[i];\n          const {id} = elem;\n          if (id === 'svg_eof') break;\n          holder = $('#' + id);\n          const svgroot = document.createElementNS(svgns, 'svg');\n          // Per https://www.w3.org/TR/xml-names11/#defaulting, the namespace for\n          // attributes should have no value.\n          svgroot.setAttributeNS(null, 'viewBox', [0, 0, iconW, iconH].join(' '));\n\n          let svg = elem.getElementsByTagNameNS(svgns, 'svg')[0];\n\n          // Make flexible by converting width/height to viewBox\n          const w = svg.getAttribute('width');\n          const h = svg.getAttribute('height');\n          svg.removeAttribute('width');\n          svg.removeAttribute('height');\n\n          const vb = svg.getAttribute('viewBox');\n          if (!vb) {\n            svg.setAttribute('viewBox', [0, 0, w, h].join(' '));\n          }\n\n          // Not using jQuery to be a bit faster\n          svgroot.setAttribute('xmlns', svgns);\n          svgroot.setAttribute('width', iconW);\n          svgroot.setAttribute('height', iconH);\n          svgroot.setAttribute('xmlns:xlink', xlinkns);\n          svgroot.setAttribute('class', 'svg_icon');\n\n          // Without cloning, Firefox will make another GET request.\n          // With cloning, causes issue in Opera/Win/Non-EN\n          if (!isOpera) svg = svg.cloneNode(true);\n\n          svgroot.append(svg);\n\n          let icon;\n          if (toImage) {\n            tempHolder.empty().append(svgroot);\n            const str = dataPre + encode64(unescape(encodeURIComponent(new XMLSerializer().serializeToString(svgroot))));\n            icon = $(new Image())\n              .attr({class: 'svg_icon', src: str});\n          } else {\n            icon = fixIDs($(svgroot), i);\n          }\n          addIcon(icon, id);\n        }\n      }\n\n      if (opts.placement) {\n        $.each(opts.placement, function (sel, id) {\n          if (!svgIcons[id]) return;\n          $(sel).each(function (i) {\n            let copy = svgIcons[id].clone();\n            if (i > 0 && !toImage) copy = fixIDs(copy, i, true);\n            setIcon($(this), copy, id);\n          });\n        });\n      }\n      if (!fallback) {\n        if (toImage) tempHolder.remove();\n        if (dataEl) dataEl.remove();\n        if (testImg) testImg.remove();\n      }\n      if (opts.resize) $.resizeSvgIcons(opts.resize);\n      iconsMade = true;\n\n      if (opts.callback) opts.callback(svgIcons);\n    }\n\n    fixIDs = function (svgEl, svgNum, force) {\n      const defs = svgEl.find('defs');\n      if (!defs.length) return svgEl;\n\n      let idElems;\n      if (isOpera) {\n        idElems = defs.find('*').filter(function () {\n          return !!this.id;\n        });\n      } else {\n        idElems = defs.find('[id]');\n      }\n\n      const allElems = svgEl[0].getElementsByTagName('*'), len = allElems.length;\n\n      idElems.each(function (i) {\n        const {id} = this;\n        /*\n        const noDupes = ($(svgdoc).find('#' + id).length <= 1);\n        if (isOpera) noDupes = false; // Opera didn't clone svgEl, so not reliable\n        if(!force && noDupes) return;\n        */\n        const newId = 'x' + id + svgNum + i;\n        this.id = newId;\n\n        const oldVal = 'url(#' + id + ')';\n        const newVal = 'url(#' + newId + ')';\n\n        // Selector method, possibly faster but fails in Opera / jQuery 1.4.3\n        //  svgEl.find('[fill=\"url(#' + id + ')\"]').each(function() {\n        //    this.setAttribute('fill', 'url(#' + newId + ')');\n        //  }).end().find('[stroke=\"url(#' + id + ')\"]').each(function() {\n        //    this.setAttribute('stroke', 'url(#' + newId + ')');\n        //  }).end().find('use').each(function() {\n        //    if(this.getAttribute('xlink:href') == '#' + id) {\n        //      this.setAttributeNS(xlinkns,'href','#' + newId);\n        //    }\n        //  }).end().find('[filter=\"url(#' + id + ')\"]').each(function() {\n        //    this.setAttribute('filter', 'url(#' + newId + ')');\n        //  });\n\n        for (i = 0; i < len; i++) {\n          const elem = allElems[i];\n          if (elem.getAttribute('fill') === oldVal) {\n            elem.setAttribute('fill', newVal);\n          }\n          if (elem.getAttribute('stroke') === oldVal) {\n            elem.setAttribute('stroke', newVal);\n          }\n          if (elem.getAttribute('filter') === oldVal) {\n            elem.setAttribute('filter', newVal);\n          }\n        }\n      });\n      return svgEl;\n    };\n\n    function useFallback () {\n      if (file.includes('.svgz')) {\n        const regFile = file.replace('.svgz', '.svg');\n        if (window.console) {\n          console.log('.svgz failed, trying with .svg');\n        }\n        $.svgIcons(regFile, opts);\n      } else if (opts.fallback) {\n        makeIcons(false, opts.fallback);\n      }\n    }\n\n    function encode64 (input) {\n      // base64 strings are 4/3 larger than the original string\n      if (window.btoa) return window.btoa(input);\n      const _keyStr = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=';\n      const output = new Array(Math.floor((input.length + 2) / 3) * 4);\n\n      let i = 0, p = 0;\n      do {\n        const chr1 = input.charCodeAt(i++);\n        const chr2 = input.charCodeAt(i++);\n        const chr3 = input.charCodeAt(i++);\n\n        const enc1 = chr1 >> 2;\n        const enc2 = ((chr1 & 3) << 4) | (chr2 >> 4);\n\n        let enc3 = ((chr2 & 15) << 2) | (chr3 >> 6);\n        let enc4 = chr3 & 63;\n        if (isNaN(chr2)) {\n          enc3 = enc4 = 64;\n        } else if (isNaN(chr3)) {\n          enc4 = 64;\n        }\n\n        output[p++] = _keyStr.charAt(enc1);\n        output[p++] = _keyStr.charAt(enc2);\n        output[p++] = _keyStr.charAt(enc3);\n        output[p++] = _keyStr.charAt(enc4);\n      } while (i < input.length);\n\n      return output.join('');\n    }\n  };\n\n  /**\n  * @function external:jQuery.getSvgIcon\n  * @param {string} id\n  * @param {boolean} uniqueClone Whether to clone\n  * @returns {external:jQuery} The icon (optionally cloned)\n  */\n  $.getSvgIcon = function (id, uniqueClone) {\n    let icon = svgIcons[id];\n    if (uniqueClone && icon) {\n      icon = fixIDs(icon, 0, true).clone(true);\n    }\n    return icon;\n  };\n\n  /**\n  * @typedef {GenericArray} module:jQuerySVGIcons.Dimensions\n  * @property {Integer} length 2\n  * @property {Float} 0 Width\n  * @property {Float} 1 Height\n  */\n\n  /**\n  * If a Float is used, it will represent width and height. Arrays contain the width and height.\n  * @typedef {module:jQuerySVGIcons.Dimensions|Float} module:jQuerySVGIcons.Size\n  */\n\n  /**\n  * @function external:jQuery.resizeSvgIcons\n  * @param {PlainObject.<string, module:jQuerySVGIcons.Size>} obj Object with selectors as keys. The values are sizes.\n  * @returns {undefined}\n  */\n  $.resizeSvgIcons = function (obj) {\n    // FF2 and older don't detect .svg_icon, so we change it detect svg elems instead\n    const changeSel = !$('.svg_icon:first').length;\n    $.each(obj, function (sel, size) {\n      const arr = Array.isArray(size);\n      const w = arr ? size[0] : size,\n        h = arr ? size[1] : size;\n      if (changeSel) {\n        sel = sel.replace(/\\.svg_icon/g, 'svg');\n      }\n      $(sel).each(function () {\n        this.setAttribute('width', w);\n        this.setAttribute('height', h);\n        if (window.opera && window.widget) {\n          this.parentNode.style.width = w + 'px';\n          this.parentNode.style.height = h + 'px';\n        }\n      });\n    });\n  };\n  return $;\n}\n","/**\n * SpinButton control\n *\n * Adds bells and whistles to any ordinary textbox to\n * make it look and feel like a SpinButton Control.\n *\n * Supplies {@link external:jQuery.fn.SpinButton} (and also {@link external:jQuery.loadingStylesheets})\n *\n * Originally written by George Adamson, Software Unity (george.jquery@softwareunity.com) August 2006.\n * - Added min/max options\n * - Added step size option\n * - Added bigStep (page up/down) option\n *\n * Modifications made by Mark Gibson, (mgibson@designlinks.net) September 2006:\n * - Converted to jQuery plugin\n * - Allow limited or unlimited min/max values\n * - Allow custom class names, and add class to input element\n * - Removed global vars\n * - Reset (to original or through config) when invalid value entered\n * - Repeat whilst holding mouse button down (with initial pause, like keyboard repeat)\n * - Support mouse wheel in Firefox\n * - Fix double click in IE\n * - Refactored some code and renamed some vars\n *\n * Modifications by Jeff Schiller, June 2009:\n * - provide callback function for when the value changes based on the following\n *   {@link https://www.mail-archive.com/jquery-en@googlegroups.com/msg36070.html}\n *\n * Modifications by Jeff Schiller, July 2009:\n * - improve styling for widget in Opera\n * - consistent key-repeat handling cross-browser\n *\n * Modifications by Alexis Deveria, October 2009:\n * - provide \"stepfunc\" callback option to allow custom function to run when changing a value\n * - Made adjustValue(0) only run on certain keyup events, not all.\n *\n * Tested in IE6, Opera9, Firefox 1.5\n *\n * | Version | Date | Author | Notes\n * |---------|------|--------|------|\n * | v1.0 | 11 Aug 2006 | George Adamson | First release\n * | v1.1 | Aug 2006 | George Adamson | Minor enhancements\n * | v1.2 | 27 Sep 2006 | Mark Gibson | Major enhancements\n * | v1.3a | 28 Sep 2006 | George Adamson | Minor enhancements\n * | v1.4 | 18 Jun 2009 | Jeff Schiller | Added callback function\n * | v1.5 | 06 Jul 2009 | Jeff Schiller | Fixes for Opera.\n * | v1.6 | 13 Oct 2009 | Alexis Deveria | Added stepfunc function\n * | v1.7 | 21 Oct 2009 | Alexis Deveria | Minor fixes.<br />Fast-repeat for keys and live updating as you type.\n * | v1.8 | 12 Jan 2010 | Benjamin Thomas | Fixes for mouseout behavior.<br />Added smallStep\n * | v1.9 | 20 May 2018 | Brett Zamir | Avoid SVGEdit dependency via `stateObj` config;<br />convert to ES6 module |\n * @module jQuerySpinButton\n * @example\n\n  // Create group of settings to initialise spinbutton(s). (Optional)\n  const myOptions = {\n    min: 0, // Set lower limit.\n    max: 100, // Set upper limit.\n    step: 1, // Set increment size.\n    smallStep: 0.5, // Set shift-click increment size.\n    stateObj: {tool_scale: 1}, // Object to allow passing in live-updating scale\n    spinClass: mySpinBtnClass, // CSS class to style the spinbutton. (Class also specifies url of the up/down button image.)\n    upClass: mySpinUpClass, // CSS class for style when mouse over up button.\n    downClass: mySpinDnClass // CSS class for style when mouse over down button.\n  };\n\n  $(function () {\n    // Initialise INPUT element(s) as SpinButtons: (passing options if desired)\n    $(\"#myInputElement\").SpinButton(myOptions);\n  });\n */\n/**\n * @function module:jQuerySpinButton.jQuerySpinButton\n * @param {external:jQuery} $ The jQuery object to which to add the plug-in\n * @returns {external:jQuery}\n*/\nexport default function ($) {\n  if (!$.loadingStylesheets) {\n    $.loadingStylesheets = [];\n  }\n  const stylesheet = 'spinbtn/jQuery.SpinButton.css';\n  if (!$.loadingStylesheets.includes(stylesheet)) {\n    $.loadingStylesheets.push(stylesheet);\n  }\n  /**\n  * @callback module:jQuerySpinButton.StepCallback\n  * @param {external:jQuery} thisArg Value of `this`\n  */\n  /**\n  * @callback module:jQuerySpinButton.ValueCallback\n  * @param {external:jQuery} thisArg Value of `this`\n  * @param {Float} value Value that was changed\n  */\n  /**\n   * @typedef {PlainObject} module:jQuerySpinButton.SpinButtonConfig\n   * @property {Float} min Set lower limit\n   * @property {Float} max Set upper limit.\n   * @property {Float} step Set increment size.\n   * @property {module:jQuerySpinButton.StepCallback} stepfunc Custom function to run when changing a value; called with `this` of object and the value to adjust\n   * @property {module:jQuerySpinButton.ValueCallback} callback Called after value adjusted (with `this` of object)\n   * @property {Float} smallStep Set shift-click increment size.\n   * @property {PlainObject} stateObj Object to allow passing in live-updating scale\n   * @property {Float} stateObj.tool_scale\n   * @property {string} spinClass CSS class to style the spinbutton. (Class also specifies url of the up/down button image.)\n   * @property {string} upClass CSS class for style when mouse over up button.\n   * @property {string} downClass CSS class for style when mouse over down button.\n   * @property {Float} page Value to be adjusted on page up/page down\n   * @property {Float} reset Reset value when invalid value entered\n   * @property {Float} delay Millisecond delay\n   * @property {Float} interval Millisecond interval\n  */\n  /**\n  * @function external:jQuery.fn.SpinButton\n  * @param {module:jQuerySpinButton.SpinButtonConfig} cfg\n  * @returns {external:jQuery}\n  */\n  $.fn.SpinButton = function (cfg) {\n    cfg = cfg || {};\n    function coord (el, prop) {\n      const b = document.body;\n\n      let c = el[prop];\n      while ((el = el.offsetParent) && (el !== b)) {\n        if (!$.browser.msie || (el.currentStyle.position !== 'relative')) {\n          c += el[prop];\n        }\n      }\n\n      return c;\n    }\n\n    return this.each(function () {\n      this.repeating = false;\n\n      // Apply specified options or defaults:\n      // (Ought to refactor this some day to use $.extend() instead)\n      this.spinCfg = {\n        // min: cfg.min ? Number(cfg.min) : null,\n        // max: cfg.max ? Number(cfg.max) : null,\n        min: !isNaN(parseFloat(cfg.min)) ? Number(cfg.min) : null, // Fixes bug with min:0\n        max: !isNaN(parseFloat(cfg.max)) ? Number(cfg.max) : null,\n        step: cfg.step ? Number(cfg.step) : 1,\n        stepfunc: cfg.stepfunc || false,\n        page: cfg.page ? Number(cfg.page) : 10,\n        upClass: cfg.upClass || 'up',\n        downClass: cfg.downClass || 'down',\n        reset: cfg.reset || this.value,\n        delay: cfg.delay ? Number(cfg.delay) : 500,\n        interval: cfg.interval ? Number(cfg.interval) : 100,\n        _btn_width: 20,\n        _direction: null,\n        _delay: null,\n        _repeat: null,\n        callback: cfg.callback || null\n      };\n\n      // if a smallStep isn't supplied, use half the regular step\n      this.spinCfg.smallStep = cfg.smallStep || this.spinCfg.step / 2;\n\n      this.adjustValue = function (i) {\n        let v;\n        if (isNaN(this.value)) {\n          v = this.spinCfg.reset;\n        } else if (typeof this.spinCfg.stepfunc === 'function') {\n          v = this.spinCfg.stepfunc(this, i);\n        } else {\n          // weirdest JavaScript bug ever: 5.1 + 0.1 = 5.199999999\n          v = Number((Number(this.value) + Number(i)).toFixed(5));\n        }\n        if (this.spinCfg.min !== null) { v = Math.max(v, this.spinCfg.min); }\n        if (this.spinCfg.max !== null) { v = Math.min(v, this.spinCfg.max); }\n        this.value = v;\n        if (typeof this.spinCfg.callback === 'function') { this.spinCfg.callback(this); }\n      };\n\n      $(this)\n        .addClass(cfg.spinClass || 'spin-button')\n\n        .mousemove(function (e) {\n          // Determine which button mouse is over, or not (spin direction):\n          const x = e.pageX || e.x;\n          const y = e.pageY || e.y;\n          const el = e.target;\n          const scale = cfg.stateObj.tool_scale || 1;\n          const height = $(el).height() / 2;\n\n          const direction =\n            (x > coord(el, 'offsetLeft') +\n              el.offsetWidth * scale - this.spinCfg._btn_width)\n              ? ((y < coord(el, 'offsetTop') + height * scale) ? 1 : -1) : 0;\n\n          if (direction !== this.spinCfg._direction) {\n            // Style up/down buttons:\n            switch (direction) {\n            case 1: // Up arrow:\n              $(this).removeClass(this.spinCfg.downClass).addClass(this.spinCfg.upClass);\n              break;\n            case -1: // Down arrow:\n              $(this).removeClass(this.spinCfg.upClass).addClass(this.spinCfg.downClass);\n              break;\n            default: // Mouse is elsewhere in the textbox\n              $(this).removeClass(this.spinCfg.upClass).removeClass(this.spinCfg.downClass);\n            }\n\n            // Set spin direction:\n            this.spinCfg._direction = direction;\n          }\n        })\n\n        .mouseout(function () {\n          // Reset up/down buttons to their normal appearance when mouse moves away:\n          $(this).removeClass(this.spinCfg.upClass).removeClass(this.spinCfg.downClass);\n          this.spinCfg._direction = null;\n          window.clearInterval(this.spinCfg._repeat);\n          window.clearTimeout(this.spinCfg._delay);\n        })\n\n        .mousedown(function (e) {\n          if (e.button === 0 && this.spinCfg._direction !== 0) {\n            // Respond to click on one of the buttons:\n            const stepSize = e.shiftKey ? this.spinCfg.smallStep : this.spinCfg.step;\n\n            const adjust = () => {\n              this.adjustValue(this.spinCfg._direction * stepSize);\n            };\n\n            adjust();\n\n            // Initial delay before repeating adjustment\n            this.spinCfg._delay = window.setTimeout(() => {\n              adjust();\n              // Repeat adjust at regular intervals\n              this.spinCfg._repeat = window.setInterval(adjust, this.spinCfg.interval);\n            }, this.spinCfg.delay);\n          }\n        })\n\n        .mouseup(function (e) {\n          // Cancel repeating adjustment\n          window.clearInterval(this.spinCfg._repeat);\n          window.clearTimeout(this.spinCfg._delay);\n        })\n\n        .dblclick(function (e) {\n          if ($.browser.msie) {\n            this.adjustValue(this.spinCfg._direction * this.spinCfg.step);\n          }\n        })\n\n        .keydown(function (e) {\n          // Respond to up/down arrow keys.\n          switch (e.keyCode) {\n          case 38: this.adjustValue(this.spinCfg.step); break; // Up\n          case 40: this.adjustValue(-this.spinCfg.step); break; // Down\n          case 33: this.adjustValue(this.spinCfg.page); break; // PageUp\n          case 34: this.adjustValue(-this.spinCfg.page); break; // PageDown\n          }\n        })\n\n        /*\n        http://unixpapa.com/js/key.html describes the current state-of-affairs for\n        key repeat events:\n        - Safari 3.1 changed their model so that keydown is reliably repeated going forward\n        - Firefox and Opera still only repeat the keypress event, not the keydown\n        */\n        .keypress(function (e) {\n          if (this.repeating) {\n            // Respond to up/down arrow keys.\n            switch (e.keyCode) {\n            case 38: this.adjustValue(this.spinCfg.step); break; // Up\n            case 40: this.adjustValue(-this.spinCfg.step); break; // Down\n            case 33: this.adjustValue(this.spinCfg.page); break; // PageUp\n            case 34: this.adjustValue(-this.spinCfg.page); break; // PageDown\n            }\n          // we always ignore the first keypress event (use the keydown instead)\n          } else {\n            this.repeating = true;\n          }\n        })\n\n        // clear the 'repeating' flag\n        .keyup(function (e) {\n          this.repeating = false;\n          switch (e.keyCode) {\n          case 38: // Up\n          case 40: // Down\n          case 33: // PageUp\n          case 34: // PageDown\n          case 13: this.adjustValue(0); break; // Enter/Return\n          }\n        })\n\n        .bind('mousewheel', function (e) {\n          // Respond to mouse wheel in IE. (It returns up/dn motion in multiples of 120)\n          if (e.wheelDelta >= 120) {\n            this.adjustValue(this.spinCfg.step);\n          } else if (e.wheelDelta <= -120) {\n            this.adjustValue(-this.spinCfg.step);\n          }\n\n          e.preventDefault();\n        })\n\n        .change(function (e) {\n          this.adjustValue(0);\n        });\n\n      if (this.addEventListener) {\n        // Respond to mouse wheel in Firefox\n        this.addEventListener('DOMMouseScroll', function (e) {\n          if (e.detail > 0) {\n            this.adjustValue(-this.spinCfg.step);\n          } else if (e.detail < 0) {\n            this.adjustValue(this.spinCfg.step);\n          }\n\n          e.preventDefault();\n        }, false);\n      }\n    });\n  };\n  return $;\n}\n","/**\n * jQuery Context Menu Plugin\n * Cory S.N. LaViska\n * A Beautiful Site ({@link https://abeautifulsite.net/})\n * Modified by Alexis Deveria\n *\n * More info: {@link https://abeautifulsite.net/2008/09/jquery-context-menu-plugin/}\n *\n * @module jQueryContextMenu\n * @todo Update to latest version and adapt (and needs jQuery update as well): {@link https://github.com/swisnl/jQuery-contextMenu}\n * @version 1.01\n *\n * @license\n * Terms of Use\n *\n * This plugin is dual-licensed under the GNU General Public License\n *   and the MIT License and is copyright A Beautiful Site, LLC.\n *\n*/\nimport {isMac} from '../browser.js';\n\n/**\n* @callback module:jQueryContextMenu.jQueryContextMenuCallback\n* @param {string} href The `href` value after the first character (for bypassing an initial `#`)\n* @param {external:jQuery} srcElement The wrapped jQuery srcElement\n* @param {{x: Float, y: Float, docX: Float, docY: Float}} coords\n*/\n\n/**\n* @typedef {PlainObject} module:jQueryContextMenu.jQueryContextMenuConfig\n* @property {string} menu\n* @property {Float} inSpeed\n* @property {Float} outSpeed\n* @property {boolean} allowLeft\n*/\n\n/**\n* Adds {@link external:jQuery.fn.contextMenu}, {@link external:jQuery.fn.disableContextMenuItems}, {@link external:jQuery.fn.enableContextMenuItems}, {@link external:jQuery.fn.disableContextMenu}, {@link external:jQuery.fn.enableContextMenu}, {@link external:jQuery.fn.destroyContextMenu}\n* @function module:jQueryContextMenu.jQueryContextMenu\n* @param {external:jQuery} $ The jQuery object to wrap (with `contextMenu`, `disableContextMenuItems`, `enableContextMenuItems`, `disableContextMenu`, `enableContextMenu`, `destroyContextMenu`)\n* @returns {external:jQuery}\n*/\nfunction jQueryContextMenu ($) {\n  const win = $(window);\n  const doc = $(document);\n\n  $.extend($.fn, {\n    /**\n    * @memberof external:jQuery.fn\n    * @param {module:jQueryContextMenu.jQueryContextMenuConfig} o\n    * @param {module:jQueryContextMenu.jQueryContextMenuCallback} callback\n    * @returns {external:jQuery}\n    */\n    contextMenu (o, callback) {\n      // Defaults\n      if (o.menu === undefined) return false;\n      if (o.inSpeed === undefined) o.inSpeed = 150;\n      if (o.outSpeed === undefined) o.outSpeed = 75;\n      // 0 needs to be -1 for expected results (no fade)\n      if (o.inSpeed === 0) o.inSpeed = -1;\n      if (o.outSpeed === 0) o.outSpeed = -1;\n      // Loop each context menu\n      $(this).each(function () {\n        const el = $(this);\n        const offset = $(el).offset();\n\n        const menu = $('#' + o.menu);\n\n        // Add contextMenu class\n        menu.addClass('contextMenu');\n        // Simulate a true right click\n        $(this).bind('mousedown', function (e) {\n          const evt = e;\n          $(this).mouseup(function (e) {\n            const srcElement = $(this);\n            srcElement.unbind('mouseup');\n            if (evt.button === 2 || o.allowLeft ||\n              (evt.ctrlKey && isMac())) {\n              e.stopPropagation();\n              // Hide context menus that may be showing\n              $('.contextMenu').hide();\n              // Get this context menu\n\n              if (el.hasClass('disabled')) return false;\n\n              // Detect mouse position\n              let x = e.pageX, y = e.pageY;\n\n              const xOff = win.width() - menu.width(),\n                yOff = win.height() - menu.height();\n\n              if (x > xOff - 15) x = xOff - 15;\n              if (y > yOff - 30) y = yOff - 30; // 30 is needed to prevent scrollbars in FF\n\n              // Show the menu\n              doc.unbind('click');\n              menu.css({ top: y, left: x }).fadeIn(o.inSpeed);\n              // Hover events\n              menu.find('A').mouseover(function () {\n                menu.find('LI.hover').removeClass('hover');\n                $(this).parent().addClass('hover');\n              }).mouseout(function () {\n                menu.find('LI.hover').removeClass('hover');\n              });\n\n              // Keyboard\n              doc.keypress(function (e) {\n                switch (e.keyCode) {\n                case 38: // up\n                  if (!menu.find('LI.hover').length) {\n                    menu.find('LI:last').addClass('hover');\n                  } else {\n                    menu.find('LI.hover').removeClass('hover').prevAll('LI:not(.disabled)').eq(0).addClass('hover');\n                    if (!menu.find('LI.hover').length) menu.find('LI:last').addClass('hover');\n                  }\n                  break;\n                case 40: // down\n                  if (!menu.find('LI.hover').length) {\n                    menu.find('LI:first').addClass('hover');\n                  } else {\n                    menu.find('LI.hover').removeClass('hover').nextAll('LI:not(.disabled)').eq(0).addClass('hover');\n                    if (!menu.find('LI.hover').length) menu.find('LI:first').addClass('hover');\n                  }\n                  break;\n                case 13: // enter\n                  menu.find('LI.hover A').trigger('click');\n                  break;\n                case 27: // esc\n                  doc.trigger('click');\n                  break;\n                }\n              });\n\n              // When items are selected\n              menu.find('A').unbind('mouseup');\n              menu.find('LI:not(.disabled) A').mouseup(function () {\n                doc.unbind('click').unbind('keypress');\n                $('.contextMenu').hide();\n                // Callback\n                if (callback) {\n                  callback($(this).attr('href').substr(1), $(srcElement), {x: x - offset.left, y: y - offset.top, docX: x, docY: y});\n                }\n                return false;\n              });\n\n              // Hide bindings\n              setTimeout(function () { // Delay for Mozilla\n                doc.click(function () {\n                  doc.unbind('click').unbind('keypress');\n                  menu.fadeOut(o.outSpeed);\n                  return false;\n                });\n              }, 0);\n            }\n          });\n        });\n\n        // Disable text selection\n        if ($.browser.mozilla) {\n          $('#' + o.menu).each(function () { $(this).css({MozUserSelect: 'none'}); });\n        } else if ($.browser.msie) {\n          $('#' + o.menu).each(function () { $(this).bind('selectstart.disableTextSelect', function () { return false; }); });\n        } else {\n          $('#' + o.menu).each(function () { $(this).bind('mousedown.disableTextSelect', function () { return false; }); });\n        }\n        // Disable browser context menu (requires both selectors to work in IE/Safari + FF/Chrome)\n        $(el).add($('UL.contextMenu')).bind('contextmenu', function () { return false; });\n      });\n      return $(this);\n    },\n\n    /**\n    * Disable context menu items on the fly\n    * @memberof external:jQuery.fn\n    * @param {undefined|string} o Comma-separated\n    * @returns {external:jQuery}\n    */\n    disableContextMenuItems (o) {\n      if (o === undefined) {\n        // Disable all\n        $(this).find('LI').addClass('disabled');\n        return $(this);\n      }\n      $(this).each(function () {\n        if (o !== undefined) {\n          const d = o.split(',');\n          for (let i = 0; i < d.length; i++) {\n            $(this).find('A[href=\"' + d[i] + '\"]').parent().addClass('disabled');\n          }\n        }\n      });\n      return $(this);\n    },\n\n    /**\n    * Enable context menu items on the fly\n    * @memberof external:jQuery.fn\n    * @param {undefined|string} o Comma-separated\n    * @returns {external:jQuery}\n    */\n    enableContextMenuItems (o) {\n      if (o === undefined) {\n        // Enable all\n        $(this).find('LI.disabled').removeClass('disabled');\n        return $(this);\n      }\n      $(this).each(function () {\n        if (o !== undefined) {\n          const d = o.split(',');\n          for (let i = 0; i < d.length; i++) {\n            $(this).find('A[href=\"' + d[i] + '\"]').parent().removeClass('disabled');\n          }\n        }\n      });\n      return $(this);\n    },\n\n    /**\n    * Disable context menu(s)\n    * @memberof external:jQuery.fn\n    * @returns {external:jQuery}\n    */\n    disableContextMenu () {\n      $(this).each(function () {\n        $(this).addClass('disabled');\n      });\n      return $(this);\n    },\n\n    /**\n    * Enable context menu(s)\n    * @memberof external:jQuery.fn\n    * @returns {external:jQuery}\n    */\n    enableContextMenu () {\n      $(this).each(function () {\n        $(this).removeClass('disabled');\n      });\n      return $(this);\n    },\n\n    /**\n    * Destroy context menu(s)\n    * @memberof external:jQuery.fn\n    * @returns {external:jQuery}\n    */\n    destroyContextMenu () {\n      // Destroy specified context menus\n      $(this).each(function () {\n        // Disable action\n        $(this).unbind('mousedown').unbind('mouseup');\n      });\n      return $(this);\n    }\n  });\n  return $;\n}\n\nexport default jQueryContextMenu;\n","function loadStylesheets(stylesheets, {\n    before: beforeDefault, after: afterDefault, favicon: faviconDefault,\n    canvas: canvasDefault, image: imageDefault = true,\n    acceptErrors\n} = {}) {\n    stylesheets = Array.isArray(stylesheets) ? stylesheets : [stylesheets];\n\n    function setupLink(stylesheetURL) {\n        let options = {};\n        if (Array.isArray(stylesheetURL)) {\n            [stylesheetURL, options = {}] = stylesheetURL;\n        }\n        let { favicon = faviconDefault } = options;\n        const {\n            before = beforeDefault,\n            after = afterDefault,\n            canvas = canvasDefault,\n            image = imageDefault\n        } = options;\n        function addLink() {\n            if (before) {\n                before.before(link);\n            } else if (after) {\n                after.after(link);\n            } else {\n                document.head.appendChild(link);\n            }\n        }\n\n        const link = document.createElement('link');\n        return new Promise((resolve, reject) => {\n            let rej = reject;\n            if (acceptErrors) {\n                rej = typeof acceptErrors === 'function' ? error => {\n                    acceptErrors({ error, stylesheetURL, options, resolve, reject });\n                } : resolve;\n            }\n            if (stylesheetURL.endsWith('.css')) {\n                favicon = false;\n            } else if (stylesheetURL.endsWith('.ico')) {\n                favicon = true;\n            }\n            if (favicon) {\n                link.rel = 'shortcut icon';\n                link.type = 'image/x-icon';\n\n                if (image === false) {\n                    link.href = stylesheetURL;\n                    addLink();\n                    resolve(link);\n                    return;\n                }\n\n                const cnv = document.createElement('canvas');\n                cnv.width = 16;\n                cnv.height = 16;\n                const context = cnv.getContext('2d');\n                const img = document.createElement('img');\n                img.addEventListener('error', error => {\n                    reject(error);\n                });\n                img.addEventListener('load', () => {\n                    context.drawImage(img, 0, 0);\n                    link.href = canvas ? cnv.toDataURL('image/x-icon') : stylesheetURL;\n                    addLink();\n                    resolve(link);\n                });\n                img.src = stylesheetURL;\n                return;\n            }\n            link.rel = 'stylesheet';\n            link.type = 'text/css';\n            link.href = stylesheetURL;\n            addLink();\n            link.addEventListener('error', error => {\n                rej(error);\n            });\n            link.addEventListener('load', () => {\n                resolve(link);\n            });\n        });\n    }\n\n    return Promise.all(stylesheets.map(setupLink));\n}\n\nexport default loadStylesheets;\n"],"names":["touchHandler","ev","changedTouches","first","type","screenX","screenY","clientX","clientY","simulatedEvent","MouseEvent","window","length","target","dispatchEvent","preventDefault","document","addEventListener","NS","getReverseNS","reverseNS","entries","forEach","name","URI","toLowerCase","SVGPathSeg","typeAsLetter","owningPathSegList","pathSegType","pathSegTypeAsLetter","_owningPathSegList","this","segmentChanged","prototype","classname","PATHSEG_UNKNOWN","PATHSEG_CLOSEPATH","PATHSEG_MOVETO_ABS","PATHSEG_MOVETO_REL","PATHSEG_LINETO_ABS","PATHSEG_LINETO_REL","PATHSEG_CURVETO_CUBIC_ABS","PATHSEG_CURVETO_CUBIC_REL","PATHSEG_CURVETO_QUADRATIC_ABS","PATHSEG_CURVETO_QUADRATIC_REL","PATHSEG_ARC_ABS","PATHSEG_ARC_REL","PATHSEG_LINETO_HORIZONTAL_ABS","PATHSEG_LINETO_HORIZONTAL_REL","PATHSEG_LINETO_VERTICAL_ABS","PATHSEG_LINETO_VERTICAL_REL","PATHSEG_CURVETO_CUBIC_SMOOTH_ABS","PATHSEG_CURVETO_CUBIC_SMOOTH_REL","PATHSEG_CURVETO_QUADRATIC_SMOOTH_ABS","PATHSEG_CURVETO_QUADRATIC_SMOOTH_REL","SVGPathSegClosePath","undefined","SVGPathSegMovetoAbs","x","y","_x","_y","defineProperties","_segmentChanged","SVGPathSegMovetoRel","SVGPathSegLinetoAbs","SVGPathSegLinetoRel","SVGPathSegCurvetoCubicAbs","x1","y1","x2","y2","_x1","_y1","_x2","_y2","SVGPathSegCurvetoCubicRel","SVGPathSegCurvetoQuadraticAbs","SVGPathSegCurvetoQuadraticRel","SVGPathSegArcAbs","r1","r2","angle","largeArcFlag","sweepFlag","_r1","_r2","_angle","_largeArcFlag","_sweepFlag","SVGPathSegArcRel","SVGPathSegLinetoHorizontalAbs","defineProperty","SVGPathSegLinetoHorizontalRel","SVGPathSegLinetoVerticalAbs","SVGPathSegLinetoVerticalRel","SVGPathSegCurvetoCubicSmoothAbs","SVGPathSegCurvetoCubicSmoothRel","SVGPathSegCurvetoQuadraticSmoothAbs","SVGPathSegCurvetoQuadraticSmoothRel","createSVGPathSegClosePath","createSVGPathSegMovetoAbs","createSVGPathSegMovetoRel","createSVGPathSegLinetoAbs","createSVGPathSegLinetoRel","createSVGPathSegCurvetoCubicAbs","createSVGPathSegCurvetoCubicRel","createSVGPathSegCurvetoQuadraticAbs","createSVGPathSegCurvetoQuadraticRel","createSVGPathSegArcAbs","createSVGPathSegArcRel","createSVGPathSegLinetoHorizontalAbs","createSVGPathSegLinetoHorizontalRel","createSVGPathSegLinetoVerticalAbs","createSVGPathSegLinetoVerticalRel","createSVGPathSegCurvetoCubicSmoothAbs","createSVGPathSegCurvetoCubicSmoothRel","createSVGPathSegCurvetoQuadraticSmoothAbs","createSVGPathSegCurvetoQuadraticSmoothRel","SVGPathElement","getPathSegAtLength","distance","isFinite","Error","measurementElement","createElementNS","setAttribute","getAttribute","lastPathSegment","pathSegList","numberOfItems","removeItem","getTotalLength","SVGPathSegList","pathElement","_pathElement","_list","_parsePath","_mutationObserverConfig","attributes","attributeFilter","_pathElementMutationObserver","MutationObserver","_updateListFromPathMutations","bind","observe","takeRecords","mutationRecords","hasPathMutations","record","attributeName","disconnect","_pathSegArrayAsString","pathSeg","_writeListToPath","_checkPathSynchronizedToList","newItem","index","isNaN","_checkValidIndex","clone","splice","item","push","string","Builder","Source","_string","_currentIndex","_endIndex","_previousCommand","_skipOptionalSpaces","character","_isCurrentSpace","charAt","lookahead","_pathSegTypeFromChar","previousCommand","hasMoreData","command","peekSegmentType","exponent","integer","frac","decimal","sign","expsign","startIndex","startIntPartIndex","scanIntPartIndex","multiplier","number","Math","pow","_skipOptionalSpacesOrDelimiter","flag","flagChar","_nextCommandHelper","_parseNumber","points","arcAngle","arcLarge","_parseArcFlag","arcSweep","builder","source","initialCommandIsMoveTo","parseSegment","appendSegment","pathSegArray","_asPathString","_pathSegList","rect","$","jQuery","userAgent","SVG","createSVGRect","navigator","svg","isOpera_","opera","isWebkit_","includes","isGecko_","isIE_","isChrome_","isMac_","isTouch_","supportsSelectors_","querySelector","supportsXpath_","evaluate","supportsPathReplaceItem_","path","seglist","seg","replaceItem","err","supportsPathInsertItemBefore_","insertItemBefore","supportsGoodTextCharPos_","svgroot","svgcontent","documentElement","append","text","textContent","pos","getStartPositionOfChar","remove","supportsPathBBox_","bbox","getBBox","height","supportsHVLineContainerBBox_","path2","g","width","supportsNonScalingStroke_","retValue","cloneNode","alert","style","vectorEffect","supportsNativeSVGTransformLists_","rxform","transform","baseVal","t1","createSVGTransform","appendItem","getItem","SVGTransform","matrix","a","b","c","d","e","f","isOpera","isWebkit","isGecko","isIE","isChrome","isMac","isTouch","supportsHVLineContainerBBox","supportsNonScalingStroke","proxied","fn","attr","key","value","len","apply","arguments","i","elem","namespaceURI","Array","isArray","obj","j","aname","Object","val","transformToString","xform","m","join","cx","cy","K","listMap_","SVGTransformList","_elem","_xforms","_update","tstr","createSVGMatrix","_init","str","re","match","replace","bits","split","valBits","valArr","letters","mtx","values","parseFloat","fname","toUpperCase","slice","_removeFromOtherLists","found","id","tl","code","newxforms","removeElementFromListMap","getTransformList","t","gradientTransform","patternTransform","wAttrs","hAttrs","unitAttrs","elementContainer_","typeMap_","getTypeMap","shortFloat","digits","getRoundDigits","toFixed","convertUnit","unit","getBaseUnit","setUnitAttr","convertToNum","substr","num","getWidth","getHeight","sqrt","isValidUnit","selectedElement","keys","some","RegExp","test","result","getElement","HistoryEventTypes","Command","MoveElementCommand","oldNextSibling","oldParent","tagName","newNextSibling","nextSibling","newParent","parentNode","handler","handleHistoryEvent","BEFORE_APPLY","insertBefore","AFTER_APPLY","BEFORE_UNAPPLY","AFTER_UNAPPLY","InsertElementCommand","parent","_this2","removeChild","RemoveElementCommand","console","log","ChangeElementCommand","attrs","newValues","oldValues","getHref","bChangedTransform","removeAttribute","getRotationAngle","rotate","BatchCommand","stack","unapply","elems","cmd","thisElems","elements","UndoManager","historyEventHandler","handler_","undoStackPointer","undoStack","undoChangeStackPointer","undoableChangeStack","getText","attrName","p","changeset","batchCmd","changes","addSubCommand","transformPoint","isIdentity","matrixMultiply","args","reduceRight","prev","m1","multiply","abs","hasMatrixTransform","tlist","transformBox","l","w","h","tr","bl","br","minx","min","maxx","max","miny","transformListToTransform","createSVGTransformFromMatrix","parseInt","temp","mtom","getMatrix","snapToAngle","snap","PI","dx","dy","atan2","dist","snapangle","round","cos","sin","rectsIntersect","segData","uiStrings","setUiStrings","strs","assign","ui","pathFuncs","linkControlPts","pathData","editorContext_","init","editorContext","each","s","newseg","list","arr","curSeg","clear","getGripPt","altPt","out","currentZoom","getCurrentZoom","getPointFromGrip","pt","imatrix","addPointGrip","pointGripContainer","getGripContainer","pointGrip","getElem","atts","pathNodeTooltip","appendChild","dblclick","setSegType","addCtrlGrip","pathCtrlPtTooltip","getCtrlLine","ctrlLine","getControlPoints","cpt","segItems","segs","gpt","replacePathSeg","pts","pth","segList","getSegSelector","update","segItem","segLine","map","prop","smoothControlPoints","ct1","ct2","nct1","getSVGRoot","createSVGPoint","nct2","anglea","angleb","angleBetween","angleDiff","newAnglea","newAngleb","Segment","selected","ctrlpts","ptgrip","segsel","hasOwnProperty","showCtrlPts","selectCtrls","getPointGrip","full","curPts","next","nextPts","mate","anum","newType","Path","selected_pts","find","first_seg","segment","startI","nextSeg","prevSeg","startSeg","addGrip","call","newX","newY","p0x","p1x","p2x","p01x","p12x","p0y","p1y","p2y","p01y","p12y","show","closed","eachSeg","indexOf","select","last_d","selectPt","move","moveCtrl","dragctrl","setLinked","storeD","selPt","cur","Number","curX","curY","prevX","prevY","olditem","old","diffX","diffY","setType","endChanges","ctrlNum","clearSelection","addPtsToSelection","inverse","resetD","indexes","sort","grips","closedSubpath","subpathIsClosed","getPath_","removePath_","newcx","newcy","oldcx","oldcy","getRotVals","r","theta","recalcRotatedPath","currentPath","oldbox","oldbbox","box","rvals","cVals1","cVals2","Rnc","setRotate","pathMap","convertPath","toRel","curx","cury","lastM","letter","pathDSegment","morePoints","lastPoint","pnt","subpath","newPoint","firstCtrl","hasMoved","pathActions","evt","mouseTarget","startX","startY","getCurrentMode","curPt","cur_pt","dragging","shiftKey","removePtFromSelection","startsWith","parts","rubberBox","getRubberBox","setRubberBox","selectorManager","getRubberBandBox","mouseX","mouseY","stretchy","getGridSnapping","snapToGrid","drawnPath","getDrawnPath","FUZZ","clickOnPoint","px","py","getId","newpath","sSeg","absX","absY","endseg","setDrawnPath","setStarted","remapElement","newD","origD","toEditMode","contains","getContainer","getMouseTarget","last","lastx","lasty","xya","dAttr","addSVGElementFromJson","getNextId","getOpacity","mpt","movePts","rbb","ptBb","sel","pointGrip1","pointGrip2","ptX","ptY","altX","altY","lastX","lastY","element","lastPt","toSelectMode","setCurrentMode","utilsGetBBox","selPath","addToSelection","on","getSelectedElements","resetOrientation","addCommandToHistory","nodeName","n","bb","attrVal","grad","getRefElem","pt1","pt2","gCoords","newgrad","linkPoints","selPts","nums","addSeg","openPt","startItem","closer","zSeg","canDeleteNodes","deleteSeg","cleanup","remItems","count","nprev","prevType","canvas","deleteSelectedElements","cp","N","curpos","prevCtlPt","end","newpts","prevArr","v","newValue","diff","fixEnd","jqPluginSVG","KEYSTR","visElemsArr","domdoc_","domcontainer_","svgroot_","toXml","encode64","input","encodeUTF8","btoa","output","floor","chr1","charCodeAt","chr2","chr3","enc1","enc2","enc3","enc4","decode64","atob","decodeUTF8","String","fromCharCode","argString","decodeURIComponent","escape","unescape","encodeURIComponent","dataURLToObjectURL","dataurl","Uint8Array","Blob","URL","createObjectURL","mime","bstr","u8arr","blob","blankPageObjectURL","text2xml","sXML","dXML","DOMParser","ActiveXObject","async","loadXML","parseFromString","e2","walkTree","cbFn","nodeType","childNodes","getUrlFromAttr","substring","getAttributeNS","XLINK","setHref","setAttributeNS","findDefs","svgElement","getSVGContent","defs","getElementsByTagNameNS","ownerDocument","firstChild","getPathBBox","tot","bounds","start","P0","P1","P2","P3","calc","b2ac","t2","groupBBFix","ref","data","matched","ret","copy","children","filter","issue","getStrokedBBox","geSelectedElements","elname","extent","getExtentOfChar","getComputedTextLength","fo","closest","getPathDFromSegments","pathSegments","singleChar","getPathDFromElement","rx","ry","getExtraAttributesForConvertToPath","getBBoxOfElementAsPath","eltrans","before","getBBoxWithTransform","getRotationAngleFromTransformList","hasMatrixXForm","goodBb","angleModulo90","bBoxCanBeOptimizedOverNativeGetBBox","aabox","getStrokeOffsetForBBox","sw","fullBb","maxX","maxY","minX","minY","offset","curBb","getVisibleElements","contentElems","reverse","getStrokedBBoxDefaultVisible","toRad","singleNodeValue","assignAttributes","suspendLength","unitCheck","ns","XML","cleanupElement","defaults","stepSize","getSnappingStep","preventClickDefault","img","click","contextMenuExtensions","injectExtendedContextMenuItemIntoDom","menuItem","shortcut","label","addScriptAtts","script","url","config","importSetGlobal","returnDefault","global","svgEditor","modules","importModule","importScript","Promise","all","u","resolve","reject","createElement","destructor","onerror","onload","src","defer","head","vector","random","toString","revokeObjectURL","loader","href","toAbsoluteURL","Layer","group","svgElem","name_","group_","svgdoc","layerTitle","after","visible","expected","opacity","child","hrService","previousName","title","getTitleElement","empty","changeElement","#text","addLayerClass","classes","CLASS_REGEX","CLASS_NAME","HistoryRecordingService","undoManager","undoManager_","currentBatchCommand_","batchCommandStack_","batchCommand","pop","addCommand_","NO_HISTORY","visElems","RandomizeModes","randIds","LET_DOCUMENT_DECIDE","disabledElems","historyRecordingService","canvas_","undoMgr","getNewLayerName","existingLayerNames","Drawing","optIdPrefix","svgElem_","obj_num","idPrefix","releasedNums","all_layers","layer_map","current_layer","nonce_","SE","NEVER_RANDOMIZE","ALWAYS_RANDOMIZE","setNonce","XMLNS","oldObjNum","restoreOldObjNum","getElem_","front","getNumLayers","getName","getGroup","layer","finalName","oldName","setName","newpos","layerCount","oldpos","currentGroup","refGroup","identifyLayers","setCurrentLayer","getLayerName","prevGroup","startBatchCommand","layerNextSibling","removeElement","localName","moveElement","removeGroup","endBatchCommand","mergeLayer","deactivate","activate","oldLayerGroup","numchildren","orphans","layernames","childgroups","querySelectorAll","appendChildren","insertElement","ch","copyElem","layerName","isVisible","bVisible","setVisible","setOpacity","el","self","newEl","fixedD","nodeValue","utilCopyElem","randomizeIds","enableRandomization","currentDrawing","getNonce","clearNonce","getCurrentDrawing","leaveContext","orig","elData","setCurrentGroup","setContext","parentsUntil","andSelf","siblings","opac","getCurrentGroup","newLayer","createLayer","cloneLayer","currentLayer","getCurrentLayer","deleteCurrentLayer","newName","drawing","setCurrentLayerName","newPos","setCurrentLayerPosition","prevVisibility","getLayerVisibility","setLayerVisibility","oldDisplay","display","getLayerByName","selElems","oldLayer","changeSVGContent","mergeAllLayers","REVERSE_NS","svgWhiteList_","svgWhiteListNS_","elt","attNS","att","sanitizeSvg","node","doc","allowedAttrs","allowedAttrsNS","seAttrs","attrLocalName","attrNsURI","removeAttributeNS","props","styleAttrName","trim","styleAttrVal","hasChildNodes","remap","scalew","scaleh","doSnapping","finishUp","o","getDrawing","elName","chlist","mt","setMatrix","existing","tNew","tbox","gsvg","pstr","firstseg","currentpt","dstr","context_","updateClipPath","tx","ty","cpXform","newxlate","setTranslate","recalculateDimensions","k","noi","mxs","mNew","initial","extend","getStartTransform","oldcenter","newcenter","gangle","rm","operation","firstM","oldStartTransform","tm","sm","tmn","childTlist","setStartTransform","e2t","t2n","s2","translateOrigin","scale","translateBack","setScale","T_M","mInv","M2","clipPathsDone","uses","useElem","usexlate","newRot","em","e2m","avg","roldt","rold","rnew","rnewInv","extrat","fill","paint","gtlist","gmatrix","mStr","oldxlate","meq","meqInv","tspanChanges","svgFactory_","config_","selectorManager_","gripRadius","Selector","locked","selectorGroup","createSVGElement","selectorRect","gripCoords","reset","resize","dir","dirArr","steps","selectorGrips","shift","bShow","selectorGripsGroup","hasGrips","updateGripCursors","selectedBox","mgr","selectedGrips","strokedBbox","nbox","nbax","nbay","nbaw","nbah","rot","svgRoot","rotm","maxy","coords","rotateGripConnector","rotateGrip","SelectorManager","selectorParentGroup","rubberBandBox","selectors","selectorMap","initGroup","grip","imgPath","dimensions","canvasbg","svgContent","babelHelpers.typeof","showGrips","history","postError","SvgCanvas","container","curConfig","importNode","clearSvgContentElement","show_outside_canvas","appendTo","comment","createComment","idprefix","setIdPrefix","current_drawing_","draw","allProperties","initFill","color","initStroke","initOpacity","shape","stroke_width","font_size","font_family","curShape","selectedElements","getJsonFromSvgElement","retval","createTextNode","namespace","curStyles","stroke","stroke_dasharray","stroke_linejoin","stroke_linecap","stroke_opacity","fill_opacity","baseUnit","elementContainer","body","inch","saveOptions","round_digits","getSelectedElems","pathModule","snappingStep","getDOMDocument","getDOMContainer","gridSnapping","startTransform","nsMap","eventType","EventTypes","cmdType","isApply","stdDeviation","setBlurOffsets","getZoom","svgFactory","jsonMap","arg","events","noCall","releaseSelector","elemsToAdd","requestSelector","compareDocumentPosition","correspondingUseElement","MATH","HTML","rb","closed_subpath","currentMode","cm","dp","refAttrs","opacAni","restoreRefElems","removedElements","childs","getElementsByTagName","encodableImages","runExtensions","action","vars","returnArray","extensions","ext","addExtension","extInitFunc","importLocale","TypeError","getPrivateMethods","argObj","extObj","getIntersectionList","rubberBBox","resultList","curBBoxes","getVisibleElementsAndBBoxes","groupSvgElem","replaceWith","prepareSvg","newDoc","ffClone","setRotationAngle","preventUndo","oldTransform","center","newTransform","selector","recalculateAllSelectedDimensions","currentResizeMode","isEmpty","logMatrix","rootSctm","selectOnly","removeFromSelection","elemsToRemove","newSelectedItems","selectAllInCurrentLayer","freehand","rStartX","rStartY","initBbox","sumDistance","controllPoint2","controllPoint1","bSpline","nextPos","parameter","getBsplinePoint","spline","p0","p1","p2","p3","t3","mousedown","spaceKey","button","rightClick","altKey","cloneSelectedElements","getScreenCTM","pageX","pageY","realX","realY","griptype","strokeW","slist","iswebkit","delayedStroke","ele","_stroke","setTimeout","newImage","lastGoodImgUrl","curText","mouseDown","beginUndoableChange","extResult","started","mousemove","newList","intElem","foundInd","hasMatrix","top","sy","sx","left","square","rad","STEP_COUNT","point","mouseMove","mouseup","tempJustSelected","justSelected","keep","factor","commaIndex","smoothPolylineIntoPath","res","mouseUp","finishUndoableChange","addedNew","aniDur","cAni","beginElement","selectNew","releaseId","setMode","originalEvent","workarea","rulerwidth","showRulers","editorFullW","editorFullH","editorW","editorH","workareaViewW","workareaViewH","wOffset","wOffsetLeft","wOffsetTop","delta","wheelDelta","detail","wZoom","hZoom","ceil","zoomlevel","topLeftOld","newCtr","setZoom","textActions","curtext","textinput","cursor","selblock","blinker","chardata","textbb","allowDbl","setCursor","focus","selectionEnd","selectionStart","charbb","setSelectionRange","setInterval","startPt","ptToScreen","endPt","setSelection","skipInput","startbb","endbb","getIndexFromPoint","charpos","getCharNumAtPosition","setCursorFromPoint","setEndSelectionFromPoint","i1","i2","screenToPt","xIn","yIn","selectAll","unbind","selectWord","ept","css","selectElem","blur","inputElem","getEndPositionOfChar","contentW","removeUnusedDefElems","defelemUses","numRemoved","alen","allEls","allLen","defelems","defelem","getIssues","issues","issueCodes","issueList","exportNoBlur","exportNoforeignObject","exportNoDashArray","content","getContext","exportNoText","descr","svgCanvasToString","nakedSvgs","svgToString","indent","unitRe","from","getResolution","nsuris","uri","attrNames","mozAttrs","images","bOneLine","embedImage","callback","Image","load","response","status","xhr","cvs","drawImage","urldata","toDataURL","statusText","setGoodImage","open","save","opts","canvg","rasterExport","imgType","quality","exportWindowName","cb","mimeType","done","bloburl","canvgPath","hide","contentH","dataURLType","toBlob","datauri","exportPDF","outputType","that","jsPDF","jspdfPath","modularVersion","getDocumentTitle","setProperties","docTitle","addSVG","getSvgString","uniquifyElems","ids","refElems","oldid","hrefs","attrnode","getAttributeNode","refid","newid","ownerElement","hreffers","hreffer","setUseData","refElem","convertGradients","convertToGroup","$elem","ts","unwrap","removeData","vb","hasMore","dupeGrads","pushGroupProperties","setSvgString","xmlString","firstElementChild","oldzoom","adoptNode","nonce","image","pa","percs","dim","importSvgString","useEl","uid","useExisting","importIds","symbol","parents","innerw","innerh","innervb","canvash","cg","resetUndoStack","linkControlPoints","getContentElem","getRootElem","getSnapToGrid","getVersion","notification","setConfig","getTitle","setGroupTitle","prepend","tsNextSibling","setDocumentTitle","newTitle","oldTitle","getEditorNS","add","setResolution","visEls","moveSelectedElements","viewBox","getOffset","setBBoxZoom","spacer","calcZoom","zoom","newzoom","selectedElems","zoomLevel","zoomChange","getMode","getColor","curProperties","setColor","addNonG","setGradient","duplicateGrad","findDuplicateGradient","existingGrads","radAttrs","og","gradAttrs","ogAttrs","stops","ostops","stop","ostop","setPaint","jGraduate","Paint","setPaintOpacity","alpha","solidColor","setStrokePaint","setFillPaint","getStrokeWidth","setStrokeWidth","setStrokeAttr","getStyle","getFillOpacity","getStrokeOpacity","getPaintOpacity","getBlur","curCommand","filterHidden","finishChange","bCmd","setBlurNoUndo","setBlur","stdDev","complete","elemId","newblur","getBold","setBold","getItalic","setItalic","getFontFamily","setFontFamily","setFontColor","getFontColor","getFontSize","setFontSize","setTextContent","setImageURL","setsize","curHref","setLinkURL","parentsA","setRectRadius","makeHyperlink","groupSelectedElements","removeHyperlink","ungroupSelectedElement","convertToPath","changeSelectedAttributeNoUndo","moveNode","noXYElems","goodGAttrs","oldval","newrot","changeSelectedAttribute","selectedCopy","cutSelectedElements","copySelectedElements","setItem","JSON","stringify","enableContextMenuItems","pasteElements","clipb","parse","localStorage","pasted","changedIDs","checkIDs","extChanges","removeID","clipBoardItem","ctrX","ctrY","lastClickPoint","urlArg","cmdStr","undoable","glist","gattrs","gfilter","gblur","newOpac","cblur","origCblur","suffix","chtlist","rgm","rcm","cangle","cbox","ceqm","coldc","sangle","trm","oldxform","newxform","chm","chmInv","gm","anchor","gNextSibling","moveToTopSelectedElement","moveToBottomSelectedElement","moveUpDownSelected","foundCur","toArray","constructor","copiedElements","alignSelectedElements","relativeTo","bboxes","MAX_VALUE","MIN_VALUE","curwidth","curheight","updateCanvas","bg","oldX","oldY","bgImg","new_x","new_y","old_x","old_y","d_x","d_y","setBackground","border","cycleElement","curElem","allElems","precision","langParam","setStrings","editor_","readLang","langData","addLangData","more","merge","tools","properties","layers","common","curve_segments","fitToContent","fit_to_all","fit_to_canvas","fit_to_layer_content","fit_to_sel","icon_large","icon_medium","icon_small","icon_xlarge","image_opt_embed","image_opt_ref","included_images","largest_object","page","move_elems_to","select_predefined","selected_objects","smallest_object","straight_segments","editor_img_url","editor_bg_note","background","doc_dims","editor_prefs","icon_size","image_props","language","doc_title","cancel","ok","new_doc","docprops","export_img","import_doc","open_doc","save_doc","units_and_rulers","show_rulers","base_unit","grid","snapping_onoff","snapping_stepsize","grid_color","del","align_relative_to","circle_cx","circle_cy","circle_r","corner_radius","ellipse_cx","ellipse_cy","ellipse_rx","ellipse_ry","fill_color","image_height","image_url","image_width","move_down","rename","more_opts","move_up","line_x1","line_x2","line_y1","line_y2","linecap_butt","linecap_round","linecap_square","linejoin_bevel","linejoin_miter","linejoin_round","main_menu","palette_info","zoom_level","node_x","node_y","rect_height","rect_width","seg_type","move_selected","pos_x","pos_y","stroke_color","stroke_style","text_contents","toggle_stroke_tools","add_subpath","align_bottom","align_center","align_left","align_middle","align_right","align_top","bold","mode_circle","mode_ellipse","mode_fhellipse","mode_fhpath","mode_fhrect","group_elements","make_link","set_link_url","mode_image","italic","mode_line","move_bottom","move_top","node_clone","node_delete","node_link","openclose_path","mode_path","align_to_page","mode_rect","redo","reorient_path","mode_select","source_save","mode_square","mode_text","to_path","undo","ungroup","wireframe_mode","mode_zoom","no_embed","putLocale","givenParam","goodLangs","conf","pref","userLanguage","langPath","importSetGlobalDefault","editor","hotkeys","specialKeys","which","ctrlKey","metaKey","shiftNums","version","8","9","13","16","17","18","19","20","27","32","33","34","35","36","37","38","39","40","45","46","96","97","98","99","100","101","102","103","104","105","106","107","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","144","145","191","224","219","221","`","1","2","3","4","5","6","7","0","-","=",";","'",",",".","/","\\","event","special","q","param","bbq","A","D","C","E","F","B","G","concat","H","M","I","O","L","J","z","noEscape","deparam","true","false","null","Q","P","R","base","iframe","form","link","pushState","getState","removeState","isFunction","browser","documentMode","msie","setup","teardown","insertAfter","contentWindow","close","hash","trigger","clearTimeout","svgIcons","fixIDs","file","svgns","xlinkns","iconW","iconH","testImg","iconsMade","dataLoaded","loadAttempts","dataEl","svgz","contentDocument","getIcons","err1","parser","ajax","useFallback","responseText","noWait","isReady","getElementById","no_img","makeIcons","testSrc","dataPre","error","setIcon","icon","setID","cl","removeAttr","holder","addIcon","id_match","toImage","fallback","tempHolder","fallback_path","imgsrc","XMLSerializer","serializeToString","class","placement","resizeSvgIcons","regFile","_keyStr","svgEl","svgNum","force","idElems","newId","oldVal","newVal","getSvgIcon","uniqueClone","changeSel","size","widget","loadingStylesheets","opt","options","linearGradient","radialGradient","jGraduateDefaults","mkElem","newparent","okCallback","cancelCallback","$this","$settings","idref","okClicked","cancelClicked","$win","addClass","html","colPicker","gradPicker","pickerTitle","clientPath","MAX","SIZEY","attrInput","curType","curGradient","gradalpha","isSolid","stopGroup","newstop","inverted","inv","fx","fy","previewRect","SIZEX","beginCoord","endCoord","centerCoord","focusCoord","showFocus","isRadial","attrval","change","cssName","stopMakerDiv","curStop","drag","delStop","stopOffset","scaleX","scaleY","cX","cY","stopMakerSVG","transImg","bgImage","xlink","stopPropagation","mouseover","spreadMethodOpt","draggingCoord","onCoordDrag","fracx","fracy","onCoordUp","numstops","checked","lastfx","lastfy","toggle","slider","ellipVal","angleVal","sliders","handle","dragSlider","stopSlider","isRad","xpos","SLIDERW","margin-left","div","posx","thisAlpha","jPicker","effects","speed","active","alphaSupport","tabs","removeClass","newGrad","curStops","tab","mkStop","stopElem","stop-color","stop-opacity","pickerD","pathbg","dragColor","remDrags","colorhandle","stopOpacity","stopColor","bottom","arg2","curS","newcolor","newopac","selectStop","xfStr","sX","SpinButton","cfg","coord","offsetParent","currentStyle","position","repeating","spinCfg","step","stepfunc","upClass","downClass","delay","interval","smallStep","adjustValue","spinClass","stateObj","tool_scale","direction","offsetWidth","_btn_width","_direction","mouseout","clearInterval","_repeat","_delay","adjust","_this","keydown","keyCode","keypress","keyup","win","menu","inSpeed","outSpeed","srcElement","allowLeft","hasClass","xOff","yOff","fadeIn","prevAll","eq","nextAll","docX","docY","fadeOut","mozilla","MozUserSelect","Slider","bar","off","timeout","setValuesFromMousePosition","barW","locX","locY","barH","rangeX","rangeY","context","changed","changeEvents","arrow","newMaxX","newMinY","newMaxY","newMinX","arrowW","arrowH","arrowOffsetX","arrowOffsetY","fireChangeEvents","set","Boolean","ahex","ColorMethods","rgbaToHex","hex","hexToRgba","newV","rgb","hsv","rgbToHsv","hsvToRgb","intToHex","validateHex","hexToInt","rgba","dec","Color","List","$arguments","settings","get","current","expandable","liveUpdate","isLessThanIE7","appVersion","filters","setColorMode","colorMode","rgbMap","rgbBar","mode","colorMapDiv","colorMapL1","colorMapL2","colorBarDiv","colorBarL1","colorBarL2","colorBarL3","colorBarL4","colorBarL6","range","colorMap","colorBar","activeColorChanged","sv","hv","hs","rg","backgroundColor","activePreview","colorMapL3","colorBarL5","hva","saturatedColor","hsa","valueColor","hValue","vValue","middle","mapValueChanged","xy","colorBarValueChanged","setBG","setImg","backgroundImage","setImgLoc","setAlpha","visibility","revertColor","radioClicked","currentClicked","cancelButton","commitCallback","okButton","iconImageClicked","currentColorChanged","currentPreview","expandableColorChanged","va","iconAlpha","bindToInput","updateInputColor","moveBarMouseDown","documentMouseMove","documentMouseUp","elementStartX","pageStartX","elementStartY","pageStartY","support","boxModel","quickPickClicked","attachIFrame","table","zIndex","slideDown","removeIFrame","slideUp","initialize","popup","onselectstart","alphaPrecision","controlHtml","localization","newColor","tooltips","colors","currentColor","buttons","hue","radio","textbox","saturation","red","green","blue","tbody","MapMaps","BarMaps","picker","bindedHex","inputs","keyDown","validateKey","setValueInRange","keyUp","colorChanged","preview","quickList","quickHex","liveCallback","colorPicker","destroy","reduce","favicon","exportWindowCt","langChanged","showSaveWarning","storagePromptClosed","callbacks","defaultPrefs","defaultExtensions","defaultConfig","svgCanvas","customExportImage","customExportPDF","curPrefs","loadSvgString","success","noop","errorLoadingSVG","getImportLocale","defaultLang","defaultName","lang","extPath","loadContentAndPrefs","forceStorage","noStorageOnLoad","cookie","storage","canvasName","cached","loadFromString","storeKey","preferenceForKey","cfgCfg","extendOrAdd","cfgObj","overwrite","preventAllURLConfig","allowInitialUserOverride","lockExtensions","setCustomHandlers","ready","exportImage","setupCurConfig","noDefaultExtensions","grep","qstr","querystring","isEmptyObject","bkgd_color","pathConfig","preventURLContentLoading","loadFromDataURI","loadFromURL","iconId","forcedSize","extAndLocaleFunc","extname","extName","imported","setAll","messageObj","setFlyoutPositions","shower","outerWidth","uaPrefix","regex","someScript","setIconSize","selToscale","xl","hiddenPs","sides","outerHeight","cssResizeRules","ruleElem","styleStr","rules","prefix","icons","tleft","minHeight","getStylesheetPriority","stylesheet","Infinity","stylesheets","priorityA","priorityB","idx","Set","beforeDefault","afterDefault","faviconDefault","canvasDefault","imageDefault","acceptErrors","stylesheetURL","addLink","rej","endsWith","rel","cnv","then","runCallbacks","modKey","canvMenu","paintBox","resizeTimer","curScrollPos","exportWindow","defaultImageURL","zoomInIcon","zoomOutIcon","uiContext","opener","svgEditorReadyEvent","CustomEvent","draggable","btnHolder","dialogContent","dbox","msg","defaultVal","changeCb","checkbox","toggleClass","ctrl","chkbx","prependTo","tooltip","resp","confirm","process_cancel","prompt","txt","setSelectMode","curr","origTitle","rIntervals","toggleHighlightLayer","layerNameToHighlight","curNames","numLayers","setLayerOpacity","populateLayers","layerlist","selLayerNames","currentLayerName","getCurrentLayerName","layerTr","layerVis","td.layervis .svg_icon","row","vis","editingsource","origSource","showSourceEditor","forSaving","multiselected","operaRepaint","setStrokeOpt","changeElem","pre","toolButtonClick","noHiding","clickSelect","dataURI","promptImgURL","cancelDeletes","curhref","enterNewImgURL","updateRulers","scanvas","contentElem","isX","lentype","contentDim","$hcanvOrig","$hcanv","hcanv","rulerLen","totalLen","ctx","ctxArr","ctxArrNum","fillStyle","fillRect","uMulti","rawM","multi","bigInt","font","rulerD","labelPos","ctxNum","curD","moveTo","lineTo","decs","fillText","part","subD","lineNum","strokeStyle","wArea","cnvs","wOrig","hOrig","oldCtr","scrollLeft","scrollTop","canvas_expansion","oldCanY","oldCanX","newCanY","newCanX","ratio","scrollX","scrollY","scroll","storagePrompt","updateToolButtonState","bNoFill","bNoStroke","buttonsNeedingStroke","buttonsNeedingFillAndStroke","hasEnabled","updateContextPanel","isNode","menuItems","blurval","getNodePoint","segType","noPath","panels","linkHref","curPanel","bv","disableContextMenuItems","getUndoStackSize","getRedoStackSize","updateWireFrame","supportsNonSS","rule","curContext","updateTitle","isLayer","zoomDone","zoomChanged","autoCenter","zInfo","changeZoom","ctl","delegate","prepPaints","prep","flyoutFuncs","setFlyoutTitles","allHolders","setupFlyouts","holders","holdSel","btnOpts","not","showSel","def","idSel","isDefault","flyoutAction","flyoutIsSelected","currentOperation","tool","timer","time","animate","is","makeFlyoutHolder","addAltDropDown","dropUp","seticon","onButton","hover","multiclick","extsPreLang","gWidth","swidth","opacPerc","editmode","ang","isSvgElem","wind","Utils","download","note","saveFromBrowser","defsFailOnSave","location","noteTheseIssues","popupWindowBlocked","linkStr","cbCalled","resizeDone","langReady","runCallback","btnSelects","context_tools","contId","container_id","panel","func","defval","colnum","inp","spindata","svgicons","fallbackObj","placementObj","btn","svgicon","cls","flyoutHolder","curH","showBtn","refData","refBtn","includeWith","tlsId","Actions","getButtonData","setInputElem","blocks","changeOpacity","changeBlur","noUndo","panning","keypan","promptMoveLayerOnce","destLayer","selectedIndex","confirmStr","QmoveElemsToLayer","moveToLayer","moveSelectedToLayer","invalidAttrValGiven","unitData","setPanning","overlay","jsHover","setClick","listItems","addDropDown","perc","unfocus","slideStart","clickFHPath","clickLine","clickSquare","clickRect","clickFHRect","clickCircle","clickEllipse","clickFHEllipse","clickImage","clickZoom","zoomImage","dblclickZoom","clickText","clickPath","deleteSelected","cutSelected","copySelected","pasteInCenter","moveToTopSelected","moveToBottomSelected","reorientPath","reorient","enterNewLinkURL","moveSelected","linked","clonePathNode","deletePathNode","addSubPath","sp","opencloseSubPath","selectNext","selectPrev","rotateSelected","cw","clickClear","QwantToClear","clickBold","clickItalic","loadingURL","clickExport","openExportWindow","loadingImage","exportWindowType","popHTML","popURL","clickOpen","clickImport","clickUndo","clickRedo","clickGroup","clickClone","clickAlign","clickWireframe","wfRules","curClass","allTools","preferences","showDocProperties","hideSourceEditor","saveSourceEditor","saveChanges","QerrorsRevertToSource","hideDocProperties","hidePreferences","saveDocProperties","noContentToFitTo","savePreferences","gridColor","resetScrollPos","cancelOverlays","QignoreSourceChanges","winWh","curval","shortcutButtons","pick_stroke_paint_opacity","pick_fill_paint_opacity","colorPickerCSS","jGraduatePath","PaintBox","paintColor","paintOpacity","docElem","ptype","fillAttr","gPaint","defColor","getPaint","testEl","blurTest","deleteLayer","moveLayer","total","curIndex","stdDeviationX","featNotSupported","uniqName","hasLayer","enterUniqueLayerName","dupeLayerName","enterNewLayerName","layerHasThatName","renameCurrentLayer","sidedrag","sidedragging","allowmove","changeSidePanelWidth","rulerX","resizeSidePanel","deltaX","sideWidth","toggleSidePanel","wh","dims","toolButtons","keyAssocs","saveOpts","hidekey","curBg","canvasBg","blk","isBg","flyouts","fH","margin","keyval","pd","keyStr","modBits","mod","lastChild","itool","initTool","preTool","regTool","wireframe","showlayers","origVal","sugVal","increasing","contextMenu","handlerKey","lmenuFunc","enableOrDisableClipboard","svgeditClipboard","disableContextMenu","no_save_warning","returnValue","unsavedChanges","getUIStrings","openPrep","QwantToOpen","FileReader","importImage","dataTransfer","files","reader","onloadend","newElement","readAsText","imgWidth","imgHeight","offsetHeight","readAsDataURL","imgImport","setLang","allStrings","renameLayer","setTitles","dest","protocol","disableUI","featList","cache","stat","URLloadFail","base64","extensionsAdded","messageQueue","origin"],"mappings":"qLACA,SAASA,EAAcC,OACdC,EAAkBD,EAAlBC,eACLC,EAAQD,EAAe,GAErBE,EAAO,UACHH,EAAGG,UACN,eAAqB,YAAa,UAClC,cAAoB,YAAa,UACjC,aAAmB,UAAW,yBAI5BC,EAAsCF,EAAtCE,QAASC,EAA6BH,EAA7BG,QAASC,EAAoBJ,EAApBI,QAASC,EAAWL,EAAXK,QAC5BC,EAAiB,IAAIC,WAAWN,YAE3B,cACG,OAENO,cACE,YAECL,UAASC,UAASC,mBAElB,UACD,YACE,WACD,SACD,gBACO,OAEbN,EAAeU,OAAS,MACpBC,OAAOC,cAAcL,KACxBM,kBAIPC,SAASC,iBAAiB,aAAcjB,GAAc,GACtDgB,SAASC,iBAAiB,YAAajB,GAAc,GACrDgB,SAASC,iBAAiB,WAAYjB,GAAc,GACpDgB,SAASC,iBAAiB,cAAejB,GAAc,m+DC5B1CkB,QACL,oCACA,wCACF,qCACC,mCACE,mCACF,6CACE,iCAOIC,EAAe,eACpBC,mBACCC,QAAQH,GAAII,QAAQ,yBAAEC,OAAMC,SACvBA,GAAOD,EAAKE,gBAEjBL,ICtBT,gBACM,eAAgBT,QAAS,KAEvBe,wBACStB,EAAMuB,EAAcC,kBAC1BC,YAAczB,OACd0B,oBAAsBH,OACtBI,mBAAqBH,sDAItBI,KAAKD,yBACFA,mBAAmBE,eAAeD,iBAIlCE,UAAUC,UAAY,eAEtBC,gBAAkB,IAClBC,kBAAoB,IACpBC,mBAAqB,IACrBC,mBAAqB,IACrBC,mBAAqB,IACrBC,mBAAqB,IACrBC,0BAA4B,IAC5BC,0BAA4B,IAC5BC,8BAAgC,IAChCC,8BAAgC,IAChCC,gBAAkB,KAClBC,gBAAkB,KAClBC,8BAAgC,KAChCC,8BAAgC,KAChCC,4BAA8B,KAC9BC,4BAA8B,KAC9BC,iCAAmC,KACnCC,iCAAmC,KACnCC,qCAAuC,KACvCC,qCAAuC,OAE5CC,yBACS5B,6EACLF,EAAWW,kBAAmB,IAAKT,eAFXF,+CAIX,8EACKM,KAAKF,2DACb,IAAI0B,OAAoBC,YAGtCC,yBACS9B,EAAmB+B,EAAGC,4EAC3BlC,EAAWY,mBAAoB,IAAKV,aACrCiC,GAAKF,IACLG,GAAKF,eAJoBlC,+CAMX,8EACKM,KAAKF,oBAAsB,IAAME,KAAK6B,GAAK,IAAM7B,KAAK8B,0CAC9D,IAAIJ,OAAoBD,EAAWzB,KAAK6B,GAAI7B,KAAK8B,oBAE9DC,iBAAiBL,EAAoBxB,oCAExBF,KAAK6B,iBAAYF,QAAUE,GAAKF,EAAG3B,KAAKgC,+BAAkC,4BAG1EhC,KAAK8B,iBAAYF,QAAUE,GAAKF,EAAG5B,KAAKgC,+BAAkC,SAIxFC,yBACSrC,EAAmB+B,EAAGC,4EAC3BlC,EAAWa,mBAAoB,IAAKX,aACrCiC,GAAKF,IACLG,GAAKF,eAJoBlC,+CAMX,8EACKM,KAAKF,oBAAsB,IAAME,KAAK6B,GAAK,IAAM7B,KAAK8B,0CAC9D,IAAIG,OAAoBR,EAAWzB,KAAK6B,GAAI7B,KAAK8B,oBAE9DC,iBAAiBE,EAAoB/B,oCACrBF,KAAK6B,iBAAYF,QAAUE,GAAKF,EAAG3B,KAAKgC,+BAAkC,4BAC1EhC,KAAK8B,iBAAYF,QAAUE,GAAKF,EAAG5B,KAAKgC,+BAAkC,SAG3FE,yBACStC,EAAmB+B,EAAGC,4EAC3BlC,EAAWc,mBAAoB,IAAKZ,aACrCiC,GAAKF,IACLG,GAAKF,eAJoBlC,+CAMX,8EACKM,KAAKF,oBAAsB,IAAME,KAAK6B,GAAK,IAAM7B,KAAK8B,0CAC9D,IAAII,OAAoBT,EAAWzB,KAAK6B,GAAI7B,KAAK8B,oBAE9DC,iBAAiBG,EAAoBhC,oCACrBF,KAAK6B,iBAAYF,QAAUE,GAAKF,EAAG3B,KAAKgC,+BAAkC,4BAC1EhC,KAAK8B,iBAAYF,QAAUE,GAAKF,EAAG5B,KAAKgC,+BAAkC,SAG3FG,yBACSvC,EAAmB+B,EAAGC,4EAC3BlC,EAAWe,mBAAoB,IAAKb,aACrCiC,GAAKF,IACLG,GAAKF,eAJoBlC,+CAMX,8EACKM,KAAKF,oBAAsB,IAAME,KAAK6B,GAAK,IAAM7B,KAAK8B,0CAC9D,IAAIK,OAAoBV,EAAWzB,KAAK6B,GAAI7B,KAAK8B,oBAE9DC,iBAAiBI,EAAoBjC,oCACrBF,KAAK6B,iBAAYF,QAAUE,GAAKF,EAAG3B,KAAKgC,+BAAkC,4BAC1EhC,KAAK8B,iBAAYF,QAAUE,GAAKF,EAAG5B,KAAKgC,+BAAkC,SAG3FI,yBACSxC,EAAmB+B,EAAGC,EAAGS,EAAIC,EAAIC,EAAIC,4EAC1C9C,EAAWgB,0BAA2B,IAAKd,aAC5CiC,GAAKF,IACLG,GAAKF,IACLa,IAAMJ,IACNK,IAAMJ,IACNK,IAAMJ,IACNK,IAAMJ,eARyB9C,+CAUjB,oFACKM,KAAKF,oBAAsB,IAAME,KAAKyC,IAAM,IAAMzC,KAAK0C,IAAM,IAAM1C,KAAK2C,IAAM,IAAM3C,KAAK4C,IAAM,IAAM5C,KAAK6B,GAAK,IAAM7B,KAAK8B,0CAClI,IAAIM,OAA0BX,EAAWzB,KAAK6B,GAAI7B,KAAK8B,GAAI9B,KAAKyC,IAAKzC,KAAK0C,IAAK1C,KAAK2C,IAAK3C,KAAK4C,qBAE3Gb,iBAAiBK,EAA0BlC,oCAC3BF,KAAK6B,iBAAYF,QAAUE,GAAKF,EAAG3B,KAAKgC,+BAAkC,4BAC1EhC,KAAK8B,iBAAYF,QAAUE,GAAKF,EAAG5B,KAAKgC,+BAAkC,6BACzEhC,KAAKyC,kBAAaJ,QAAWI,IAAMJ,EAAIrC,KAAKgC,+BAAkC,6BAC9EhC,KAAK0C,kBAAaJ,QAAWI,IAAMJ,EAAItC,KAAKgC,+BAAkC,6BAC9EhC,KAAK2C,kBAAaJ,QAAWI,IAAMJ,EAAIvC,KAAKgC,+BAAkC,6BAC9EhC,KAAK4C,kBAAaJ,QAAWI,IAAMJ,EAAIxC,KAAKgC,+BAAkC,SAGhGa,yBACSjD,EAAmB+B,EAAGC,EAAGS,EAAIC,EAAIC,EAAIC,4EAC1C9C,EAAWiB,0BAA2B,IAAKf,aAC5CiC,GAAKF,IACLG,GAAKF,IACLa,IAAMJ,IACNK,IAAMJ,IACNK,IAAMJ,IACNK,IAAMJ,eARyB9C,+CAUjB,oFACKM,KAAKF,oBAAsB,IAAME,KAAKyC,IAAM,IAAMzC,KAAK0C,IAAM,IAAM1C,KAAK2C,IAAM,IAAM3C,KAAK4C,IAAM,IAAM5C,KAAK6B,GAAK,IAAM7B,KAAK8B,0CAClI,IAAIe,OAA0BpB,EAAWzB,KAAK6B,GAAI7B,KAAK8B,GAAI9B,KAAKyC,IAAKzC,KAAK0C,IAAK1C,KAAK2C,IAAK3C,KAAK4C,qBAE3Gb,iBAAiBc,EAA0B3C,oCAC3BF,KAAK6B,iBAAYF,QAAUE,GAAKF,EAAG3B,KAAKgC,+BAAkC,4BAC1EhC,KAAK8B,iBAAYF,QAAUE,GAAKF,EAAG5B,KAAKgC,+BAAkC,6BACzEhC,KAAKyC,kBAAaJ,QAAWI,IAAMJ,EAAIrC,KAAKgC,+BAAkC,6BAC9EhC,KAAK0C,kBAAaJ,QAAWI,IAAMJ,EAAItC,KAAKgC,+BAAkC,6BAC9EhC,KAAK2C,kBAAaJ,QAAWI,IAAMJ,EAAIvC,KAAKgC,+BAAkC,6BAC9EhC,KAAK4C,kBAAaJ,QAAWI,IAAMJ,EAAIxC,KAAKgC,+BAAkC,SAGhGc,yBACSlD,EAAmB+B,EAAGC,EAAGS,EAAIC,4EAClC5C,EAAWkB,8BAA+B,IAAKhB,aAChDiC,GAAKF,IACLG,GAAKF,IACLa,IAAMJ,IACNK,IAAMJ,eAN6B5C,+CAQrB,wFACKM,KAAKF,oBAAsB,IAAME,KAAKyC,IAAM,IAAMzC,KAAK0C,IAAM,IAAM1C,KAAK6B,GAAK,IAAM7B,KAAK8B,0CAChG,IAAIgB,OAA8BrB,EAAWzB,KAAK6B,GAAI7B,KAAK8B,GAAI9B,KAAKyC,IAAKzC,KAAK0C,qBAE3FX,iBAAiBe,EAA8B5C,oCAC/BF,KAAK6B,iBAAYF,QAAUE,GAAKF,EAAG3B,KAAKgC,+BAAkC,4BAC1EhC,KAAK8B,iBAAYF,QAAUE,GAAKF,EAAG5B,KAAKgC,+BAAkC,6BACzEhC,KAAKyC,kBAAaJ,QAAWI,IAAMJ,EAAIrC,KAAKgC,+BAAkC,6BAC9EhC,KAAK0C,kBAAaJ,QAAWI,IAAMJ,EAAItC,KAAKgC,+BAAkC,SAGhGe,yBACSnD,EAAmB+B,EAAGC,EAAGS,EAAIC,4EAClC5C,EAAWmB,8BAA+B,IAAKjB,aAChDiC,GAAKF,IACLG,GAAKF,IACLa,IAAMJ,IACNK,IAAMJ,eAN6B5C,+CAQrB,wFACKM,KAAKF,oBAAsB,IAAME,KAAKyC,IAAM,IAAMzC,KAAK0C,IAAM,IAAM1C,KAAK6B,GAAK,IAAM7B,KAAK8B,0CAChG,IAAIiB,OAA8BtB,EAAWzB,KAAK6B,GAAI7B,KAAK8B,GAAI9B,KAAKyC,IAAKzC,KAAK0C,qBAE3FX,iBAAiBgB,EAA8B7C,oCAC/BF,KAAK6B,iBAAYF,QAAUE,GAAKF,EAAG3B,KAAKgC,+BAAkC,4BAC1EhC,KAAK8B,iBAAYF,QAAUE,GAAKF,EAAG5B,KAAKgC,+BAAkC,6BACzEhC,KAAKyC,kBAAaJ,QAAWI,IAAMJ,EAAIrC,KAAKgC,+BAAkC,6BAC9EhC,KAAK0C,kBAAaJ,QAAWI,IAAMJ,EAAItC,KAAKgC,+BAAkC,SAGhGgB,yBACSpD,EAAmB+B,EAAGC,EAAGqB,EAAIC,EAAIC,EAAOC,EAAcC,4EAC3D3D,EAAWoB,gBAAiB,IAAKlB,aAClCiC,GAAKF,IACLG,GAAKF,IACL0B,IAAML,IACNM,IAAML,IACNM,OAASL,IACTM,cAAgBL,IAChBM,WAAaL,eATS3D,+CAWR,2EACKM,KAAKF,oBAAsB,IAAME,KAAKsD,IAAM,IAAMtD,KAAKuD,IAAM,IAAMvD,KAAKwD,OAAS,KAAOxD,KAAKyD,cAAgB,IAAM,KAAO,KAAOzD,KAAK0D,WAAa,IAAM,KAAO,IAAM1D,KAAK6B,GAAK,IAAM7B,KAAK8B,0CACnM,IAAIkB,OAAiBvB,EAAWzB,KAAK6B,GAAI7B,KAAK8B,GAAI9B,KAAKsD,IAAKtD,KAAKuD,IAAKvD,KAAKwD,OAAQxD,KAAKyD,cAAezD,KAAK0D,4BAEzH3B,iBAAiBiB,EAAiB9C,oCAClBF,KAAK6B,iBAAYF,QAAUE,GAAKF,EAAG3B,KAAKgC,+BAAkC,4BAC1EhC,KAAK8B,iBAAYF,QAAUE,GAAKF,EAAG5B,KAAKgC,+BAAkC,6BACzEhC,KAAKsD,kBAAaL,QAAWK,IAAML,EAAIjD,KAAKgC,+BAAkC,6BAC9EhC,KAAKuD,kBAAaL,QAAWK,IAAML,EAAIlD,KAAKgC,+BAAkC,gCAC3EhC,KAAKwD,qBAAgBL,QAAcK,OAASL,EAAOnD,KAAKgC,+BAAkC,uCACnFhC,KAAKyD,4BAAuBL,QAAqBK,cAAgBL,EAAcpD,KAAKgC,+BAAkC,oCACzHhC,KAAK0D,yBAAoBL,QAAkBK,WAAaL,EAAWrD,KAAKgC,+BAAkC,SAGnI2B,yBACS/D,EAAmB+B,EAAGC,EAAGqB,EAAIC,EAAIC,EAAOC,EAAcC,4EAC3D3D,EAAWqB,gBAAiB,IAAKnB,aAClCiC,GAAKF,IACLG,GAAKF,IACL0B,IAAML,IACNM,IAAML,IACNM,OAASL,IACTM,cAAgBL,IAChBM,WAAaL,eATS3D,+CAWR,2EACKM,KAAKF,oBAAsB,IAAME,KAAKsD,IAAM,IAAMtD,KAAKuD,IAAM,IAAMvD,KAAKwD,OAAS,KAAOxD,KAAKyD,cAAgB,IAAM,KAAO,KAAOzD,KAAK0D,WAAa,IAAM,KAAO,IAAM1D,KAAK6B,GAAK,IAAM7B,KAAK8B,0CACnM,IAAI6B,OAAiBlC,EAAWzB,KAAK6B,GAAI7B,KAAK8B,GAAI9B,KAAKsD,IAAKtD,KAAKuD,IAAKvD,KAAKwD,OAAQxD,KAAKyD,cAAezD,KAAK0D,4BAEzH3B,iBAAiB4B,EAAiBzD,oCAClBF,KAAK6B,iBAAYF,QAAUE,GAAKF,EAAG3B,KAAKgC,+BAAkC,4BAC1EhC,KAAK8B,iBAAYF,QAAUE,GAAKF,EAAG5B,KAAKgC,+BAAkC,6BACzEhC,KAAKsD,kBAAaL,QAAWK,IAAML,EAAIjD,KAAKgC,+BAAkC,6BAC9EhC,KAAKuD,kBAAaL,QAAWK,IAAML,EAAIlD,KAAKgC,+BAAkC,gCAC3EhC,KAAKwD,qBAAgBL,QAAcK,OAASL,EAAOnD,KAAKgC,+BAAkC,uCACnFhC,KAAKyD,4BAAuBL,QAAqBK,cAAgBL,EAAcpD,KAAKgC,+BAAkC,oCACzHhC,KAAK0D,yBAAoBL,QAAkBK,WAAaL,EAAWrD,KAAKgC,+BAAkC,SAGnI4B,yBACShE,EAAmB+B,4EACxBjC,EAAWsB,8BAA+B,IAAKpB,aAChDiC,GAAKF,eAH8BjC,+CAKrB,wFACKM,KAAKF,oBAAsB,IAAME,KAAK6B,0CAC9C,IAAI+B,OAA8BnC,EAAWzB,KAAK6B,oBAE/DgC,eAAeD,EAA8B1D,UAAW,2BAAuBF,KAAK6B,iBAAYF,QAAUE,GAAKF,EAAG3B,KAAKgC,+BAAkC,QAE1J8B,yBACSlE,EAAmB+B,4EACxBjC,EAAWuB,8BAA+B,IAAKrB,aAChDiC,GAAKF,eAH8BjC,+CAKrB,wFACKM,KAAKF,oBAAsB,IAAME,KAAK6B,0CAC9C,IAAIiC,OAA8BrC,EAAWzB,KAAK6B,oBAE/DgC,eAAeC,EAA8B5D,UAAW,2BAAuBF,KAAK6B,iBAAYF,QAAUE,GAAKF,EAAG3B,KAAKgC,+BAAkC,QAE1J+B,yBACSnE,EAAmBgC,4EACxBlC,EAAWwB,4BAA6B,IAAKtB,aAC9CkC,GAAKF,eAH4BlC,+CAKnB,sFACKM,KAAKF,oBAAsB,IAAME,KAAK8B,0CAC9C,IAAIiC,OAA4BtC,EAAWzB,KAAK8B,oBAE7D+B,eAAeE,EAA4B7D,UAAW,2BAAuBF,KAAK8B,iBAAYF,QAAUE,GAAKF,EAAG5B,KAAKgC,+BAAkC,QAExJgC,yBACSpE,EAAmBgC,4EACxBlC,EAAWyB,4BAA6B,IAAKvB,aAC9CkC,GAAKF,eAH4BlC,+CAKnB,sFACKM,KAAKF,oBAAsB,IAAME,KAAK8B,0CAC9C,IAAIkC,OAA4BvC,EAAWzB,KAAK8B,oBAE7D+B,eAAeG,EAA4B9D,UAAW,2BAAuBF,KAAK8B,iBAAYF,QAAUE,GAAKF,EAAG5B,KAAKgC,+BAAkC,QAExJiC,yBACSrE,EAAmB+B,EAAGC,EAAGW,EAAIC,4EAClC9C,EAAW0B,iCAAkC,IAAKxB,aACnDiC,GAAKF,IACLG,GAAKF,IACLe,IAAMJ,IACNK,IAAMJ,eAN+B9C,+CAQvB,0FACKM,KAAKF,oBAAsB,IAAME,KAAK2C,IAAM,IAAM3C,KAAK4C,IAAM,IAAM5C,KAAK6B,GAAK,IAAM7B,KAAK8B,0CAChG,IAAImC,OAAgCxC,EAAWzB,KAAK6B,GAAI7B,KAAK8B,GAAI9B,KAAK2C,IAAK3C,KAAK4C,qBAE7Fb,iBAAiBkC,EAAgC/D,oCACjCF,KAAK6B,iBAAYF,QAAUE,GAAKF,EAAG3B,KAAKgC,+BAAkC,4BAC1EhC,KAAK8B,iBAAYF,QAAUE,GAAKF,EAAG5B,KAAKgC,+BAAkC,6BACzEhC,KAAK2C,kBAAaJ,QAAWI,IAAMJ,EAAIvC,KAAKgC,+BAAkC,6BAC9EhC,KAAK4C,kBAAaJ,QAAWI,IAAMJ,EAAIxC,KAAKgC,+BAAkC,SAGhGkC,yBACStE,EAAmB+B,EAAGC,EAAGW,EAAIC,4EAClC9C,EAAW2B,iCAAkC,IAAKzB,aACnDiC,GAAKF,IACLG,GAAKF,IACLe,IAAMJ,IACNK,IAAMJ,eAN+B9C,+CAQvB,0FACKM,KAAKF,oBAAsB,IAAME,KAAK2C,IAAM,IAAM3C,KAAK4C,IAAM,IAAM5C,KAAK6B,GAAK,IAAM7B,KAAK8B,0CAChG,IAAIoC,OAAgCzC,EAAWzB,KAAK6B,GAAI7B,KAAK8B,GAAI9B,KAAK2C,IAAK3C,KAAK4C,qBAE7Fb,iBAAiBmC,EAAgChE,oCACjCF,KAAK6B,iBAAYF,QAAUE,GAAKF,EAAG3B,KAAKgC,+BAAkC,4BAC1EhC,KAAK8B,iBAAYF,QAAUE,GAAKF,EAAG5B,KAAKgC,+BAAkC,6BACzEhC,KAAK2C,kBAAaJ,QAAWI,IAAMJ,EAAIvC,KAAKgC,+BAAkC,6BAC9EhC,KAAK4C,kBAAaJ,QAAWI,IAAMJ,EAAIxC,KAAKgC,+BAAkC,SAGhGmC,yBACSvE,EAAmB+B,EAAGC,4EAC3BlC,EAAW4B,qCAAsC,IAAK1B,aACvDiC,GAAKF,IACLG,GAAKF,eAJoClC,+CAM3B,8FACKM,KAAKF,oBAAsB,IAAME,KAAK6B,GAAK,IAAM7B,KAAK8B,0CAC9D,IAAIqC,OAAoC1C,EAAWzB,KAAK6B,GAAI7B,KAAK8B,oBAE9EC,iBAAiBoC,EAAoCjE,oCACrCF,KAAK6B,iBAAYF,QAAUE,GAAKF,EAAG3B,KAAKgC,+BAAkC,4BAC1EhC,KAAK8B,iBAAYF,QAAUE,GAAKF,EAAG5B,KAAKgC,+BAAkC,SAG3FoC,yBACSxE,EAAmB+B,EAAGC,4EAC3BlC,EAAW6B,qCAAsC,IAAK3B,aACvDiC,GAAKF,IACLG,GAAKF,eAJoClC,+CAM3B,8FACKM,KAAKF,oBAAsB,IAAME,KAAK6B,GAAK,IAAM7B,KAAK8B,0CAC9D,IAAIsC,OAAoC3C,EAAWzB,KAAK6B,GAAI7B,KAAK8B,oBAE9EC,iBAAiBqC,EAAoClE,oCACrCF,KAAK6B,iBAAYF,QAAUE,GAAKF,EAAG3B,KAAKgC,+BAAkC,4BAC1EhC,KAAK8B,iBAAYF,QAAUE,GAAKF,EAAG5B,KAAKgC,+BAAkC,oBAKlF9B,UAAUmE,0BAA4B,kBAAqB,IAAI7C,OAAoBC,mBACnFvB,UAAUoE,0BAA4B,SAAU3C,EAAGC,UAAY,IAAIF,OAAoBD,EAAWE,EAAGC,mBACrG1B,UAAUqE,0BAA4B,SAAU5C,EAAGC,UAAY,IAAIK,OAAoBR,EAAWE,EAAGC,mBACrG1B,UAAUsE,0BAA4B,SAAU7C,EAAGC,UAAY,IAAIM,OAAoBT,EAAWE,EAAGC,mBACrG1B,UAAUuE,0BAA4B,SAAU9C,EAAGC,UAAY,IAAIO,OAAoBV,EAAWE,EAAGC,mBACrG1B,UAAUwE,gCAAkC,SAAU/C,EAAGC,EAAGS,EAAIC,EAAIC,EAAIC,UAAa,IAAIJ,OAA0BX,EAAWE,EAAGC,EAAGS,EAAIC,EAAIC,EAAIC,mBAChJtC,UAAUyE,gCAAkC,SAAUhD,EAAGC,EAAGS,EAAIC,EAAIC,EAAIC,UAAa,IAAIK,OAA0BpB,EAAWE,EAAGC,EAAGS,EAAIC,EAAIC,EAAIC,mBAChJtC,UAAU0E,oCAAsC,SAAUjD,EAAGC,EAAGS,EAAIC,UAAa,IAAIQ,OAA8BrB,EAAWE,EAAGC,EAAGS,EAAIC,mBACxIpC,UAAU2E,oCAAsC,SAAUlD,EAAGC,EAAGS,EAAIC,UAAa,IAAIS,OAA8BtB,EAAWE,EAAGC,EAAGS,EAAIC,mBACxIpC,UAAU4E,uBAAyB,SAAUnD,EAAGC,EAAGqB,EAAIC,EAAIC,EAAOC,EAAcC,UAAoB,IAAIL,OAAiBvB,EAAWE,EAAGC,EAAGqB,EAAIC,EAAIC,EAAOC,EAAcC,mBACvKnD,UAAU6E,uBAAyB,SAAUpD,EAAGC,EAAGqB,EAAIC,EAAIC,EAAOC,EAAcC,UAAoB,IAAIM,OAAiBlC,EAAWE,EAAGC,EAAGqB,EAAIC,EAAIC,EAAOC,EAAcC,mBACvKnD,UAAU8E,oCAAsC,SAAUrD,UAAY,IAAIiC,OAA8BnC,EAAWE,mBACnHzB,UAAU+E,oCAAsC,SAAUtD,UAAY,IAAImC,OAA8BrC,EAAWE,mBACnHzB,UAAUgF,kCAAoC,SAAUtD,UAAY,IAAImC,OAA4BtC,EAAWG,mBAC/G1B,UAAUiF,kCAAoC,SAAUvD,UAAY,IAAIoC,OAA4BvC,EAAWG,mBAC/G1B,UAAUkF,sCAAwC,SAAUzD,EAAGC,EAAGW,EAAIC,UAAa,IAAIyB,OAAgCxC,EAAWE,EAAGC,EAAGW,EAAIC,mBAC5ItC,UAAUmF,sCAAwC,SAAU1D,EAAGC,EAAGW,EAAIC,UAAa,IAAI0B,OAAgCzC,EAAWE,EAAGC,EAAGW,EAAIC,mBAC5ItC,UAAUoF,0CAA4C,SAAU3D,EAAGC,UAAY,IAAIuC,OAAoC1C,EAAWE,EAAGC,mBACrI1B,UAAUqF,0CAA4C,SAAU5D,EAAGC,UAAY,IAAIwC,OAAoC3C,EAAWE,EAAGC,IAE9I,uBAAwB4D,eAAetF,2BAI5BA,UAAUuF,mBAAqB,SAAUC,WACrCjE,IAAbiE,IAA2BC,SAASD,SAChC,IAAIE,MAAM,0BAGZC,EAAqB7G,SAAS8G,gBAAgB,6BAA8B,UAC/DC,aAAa,IAAK/F,KAAKgG,aAAa,UACnDC,EAAkBJ,EAAmBK,YAAYC,cAAgB,KAGjEF,GAAmB,SACd,IAGN,MACkBC,YAAYE,WAAWH,GACtCP,EAAWG,EAAmBQ,iCAI3BJ,EAAkB,UACpBA,WAIJvG,WAAaA,SACb8B,oBAAsBA,SACtBE,oBAAsBA,SACtBO,oBAAsBA,SACtBC,oBAAsBA,SACtBC,oBAAsBA,SACtBC,0BAA4BA,SAC5BS,0BAA4BA,SAC5BC,8BAAgCA,SAChCC,8BAAgCA,SAChCC,iBAAmBA,SACnBW,iBAAmBA,SACnBC,8BAAgCA,SAChCE,8BAAgCA,SAChCC,4BAA8BA,SAC9BC,4BAA8BA,SAC9BC,gCAAkCA,SAClCC,gCAAkCA,SAClCC,oCAAsCA,SACtCC,oCAAsCA,OAQzC,mBAAoBzF,QAAa,eAAgB2H,eAAepG,WAAY,KAE1EoG,wBACSC,kBACNC,aAAeD,OACfE,MAAQzG,KAAK0G,WAAW1G,KAAKwG,aAAaR,aAAa,WAGvDW,yBAA2BC,YAAY,EAAMC,iBAAkB,WAC/DC,6BAA+B,IAAIC,iBAAiB/G,KAAKgH,6BAA6BC,KAAKjH,YAC3F8G,6BAA6BI,QAAQlH,KAAKwG,aAAcxG,KAAK2G,+FAM7DK,6BAA6BhH,KAAK8G,6BAA6BK,oEAGxCC,MACvBpH,KAAKwG,kBAGNa,GAAmB,IACP/H,QAAQ,SAACgI,GACM,MAAzBA,EAAOC,mBACU,KAGnBF,SACGZ,MAAQzG,KAAK0G,WAAW1G,KAAKwG,aAAaR,aAAa,wDAMzDc,6BAA6BU,kBAC7BhB,aAAaT,aAAa,IAAKO,EAAemB,sBAAsBzH,KAAKyG,aACzEK,6BAA6BI,QAAQlH,KAAKwG,aAAcxG,KAAK2G,gEAIpDe,QACTC,wDAIAC,oCAEAnB,MAAMnH,QAAQ,SAACoI,KACV3H,mBAAqB,YAE1B0G,cACAkB,sDAGKE,eACLD,oCAEAnB,OAASoB,KACN9H,mBAAqBC,UACxB2H,mBACEE,2CAGSC,MACZC,MAAMD,IAAUA,EAAQ,GAAKA,GAAS9H,KAAKmG,oBACvC,IAAIP,MAAM,kDAIXkC,eACFF,oCAEAI,iBAAiBF,GACf9H,KAAKyG,MAAMqB,4CAGFD,EAASC,eACpBF,+BAGDE,EAAQ9H,KAAKmG,kBACPnG,KAAKmG,eAEX0B,EAAQ9H,uBAEA8H,EAAQI,cAEfxB,MAAMyB,OAAOJ,EAAO,EAAGD,KACpB9H,mBAAqBC,UACxB2H,mBACEE,sCAGIA,EAASC,eACfF,+BAEDC,EAAQ9H,uBAEA8H,EAAQI,cAEfD,iBAAiBF,QACjBrB,MAAMqB,GAASD,IACZ9H,mBAAqBC,UACxB2H,mBACEE,qCAGGC,QACLF,oCAEAI,iBAAiBF,OAChBK,EAAOnI,KAAKyG,MAAMqB,eACnBrB,MAAMyB,OAAOJ,EAAO,QACpBH,mBACEQ,qCAGGN,eACLD,+BAEDC,EAAQ9H,uBAEA8H,EAAQI,cAEfxB,MAAM2B,KAAKP,KACR9H,mBAAqBC,UAExB2H,mBACEE,qCAIGQ,OACLA,IAAWA,EAAOzJ,oBAIjBgB,EAAoBI,KAEpBsI,yCAEGpC,+DAEQwB,QACRxB,YAAYkC,KAAKV,YAIpBa,wBACSF,kBACNG,QAAUH,OACVI,cAAgB,OAChBC,UAAY1I,KAAKwI,QAAQ5J,YACzB+J,iBAAmBjJ,WAAWU,qBAE9BwI,8EAGCC,EAAY7I,KAAKwI,QAAQxI,KAAKyI,sBAC7BI,GAAa,MAAsB,MAAdA,GAAmC,OAAdA,GAAoC,OAAdA,GAAoC,OAAdA,GAAoC,OAAdA,sDAI5G7I,KAAKyI,cAAgBzI,KAAK0I,WAAa1I,KAAK8I,wBAC5CL,uBAEAzI,KAAKyI,cAAgBzI,KAAK0I,2EAI7B1I,KAAKyI,cAAgBzI,KAAK0I,YAAc1I,KAAK8I,mBAAiE,MAA5C9I,KAAKwI,QAAQO,OAAO/I,KAAKyI,kBAG3FzI,KAAK4I,uBACH5I,KAAKyI,cAAgBzI,KAAK0I,WAAyD,MAA5C1I,KAAKwI,QAAQO,OAAO/I,KAAKyI,sBAC7DA,qBACAG,uBAGF5I,KAAKyI,cAAgBzI,KAAK0I,wDAI1B1I,KAAKyI,cAAgBzI,KAAK0I,wDAI3BM,EAAYhJ,KAAKwI,QAAQxI,KAAKyI,sBAC7BzI,KAAKiJ,qBAAqBD,gDAGbA,UACZA,OACH,QACA,WACItJ,WAAWW,sBACf,WACIX,WAAWY,uBACf,WACIZ,WAAWa,uBACf,WACIb,WAAWc,uBACf,WACId,WAAWe,uBACf,WACIf,WAAWgB,8BACf,WACIhB,WAAWiB,8BACf,WACIjB,WAAWkB,kCACf,WACIlB,WAAWmB,kCACf,WACInB,WAAWoB,oBACf,WACIpB,WAAWqB,oBACf,WACIrB,WAAWsB,kCACf,WACItB,WAAWuB,kCACf,WACIvB,WAAWwB,gCACf,WACIxB,WAAWyB,gCACf,WACIzB,WAAW0B,qCACf,WACI1B,WAAW2B,qCACf,WACI3B,WAAW4B,yCACf,WACI5B,WAAW6B,oDAEX7B,WAAWU,4DAIF4I,EAAWE,UAEV,MAAdF,GAAmC,MAAdA,GAAmC,MAAdA,GAAsBA,GAAa,KAAOA,GAAa,MAASE,IAAoBxJ,WAAWW,kBACxI6I,IAAoBxJ,WAAWY,mBAC1BZ,WAAWc,mBAEhB0I,IAAoBxJ,WAAWa,mBAC1Bb,WAAWe,mBAEbyI,EAEFxJ,WAAWU,qEAKbJ,KAAKmJ,qBACD,MAEHC,EAAUpJ,KAAKqJ,yBAEdD,IAAY1J,WAAWY,oBAAsB8I,IAAY1J,WAAWa,8DAMvE+I,EAAW,EACXC,EAAU,EACVC,EAAO,EACPC,EAAU,EACVC,EAAO,EACPC,EAAU,EAERC,EAAa5J,KAAKyI,sBAEnBG,sBAGD5I,KAAKyI,cAAgBzI,KAAK0I,WAAyD,MAA5C1I,KAAKwI,QAAQO,OAAO/I,KAAKyI,oBAC7DA,gBACIzI,KAAKyI,cAAgBzI,KAAK0I,WAAyD,MAA5C1I,KAAKwI,QAAQO,OAAO/I,KAAKyI,sBACpEA,mBACG,KAGNzI,KAAKyI,gBAAkBzI,KAAK0I,YAAe1I,KAAKwI,QAAQO,OAAO/I,KAAKyI,eAAiB,KAAOzI,KAAKwI,QAAQO,OAAO/I,KAAKyI,eAAiB,MAAoD,MAA5CzI,KAAKwI,QAAQO,OAAO/I,KAAKyI,yBAMrKoB,EAAoB7J,KAAKyI,cACxBzI,KAAKyI,cAAgBzI,KAAK0I,WAAa1I,KAAKwI,QAAQO,OAAO/I,KAAKyI,gBAAkB,KAAOzI,KAAKwI,QAAQO,OAAO/I,KAAKyI,gBAAkB,UACpIA,mBAGHzI,KAAKyI,gBAAkBoB,UACrBC,EAAmB9J,KAAKyI,cAAgB,EACxCsB,EAAa,EACVD,GAAoBD,MACdE,GAAc/J,KAAKwI,QAAQO,OAAOe,KAAsB,QACrD,MAKd9J,KAAKyI,cAAgBzI,KAAK0I,WAAyD,MAA5C1I,KAAKwI,QAAQO,OAAO/I,KAAKyI,eAAwB,SACrFA,gBAGDzI,KAAKyI,eAAiBzI,KAAK0I,WAAa1I,KAAKwI,QAAQO,OAAO/I,KAAKyI,eAAiB,KAAOzI,KAAKwI,QAAQO,OAAO/I,KAAKyI,eAAiB,gBAGhIzI,KAAKyI,cAAgBzI,KAAK0I,WAAa1I,KAAKwI,QAAQO,OAAO/I,KAAKyI,gBAAkB,KAAOzI,KAAKwI,QAAQO,OAAO/I,KAAKyI,gBAAkB,QACjI,OACIzI,KAAKwI,QAAQO,OAAO/I,KAAKyI,eAAiB,KAAOe,OACxDf,eAAiB,KAKtBzI,KAAKyI,gBAAkBmB,GAAc5J,KAAKyI,cAAgB,EAAIzI,KAAK0I,YAA0D,MAA5C1I,KAAKwI,QAAQO,OAAO/I,KAAKyI,gBAAsE,MAA5CzI,KAAKwI,QAAQO,OAAO/I,KAAKyI,iBAA4E,MAAhDzI,KAAKwI,QAAQO,OAAO/I,KAAKyI,cAAgB,IAA8D,MAAhDzI,KAAKwI,QAAQO,OAAO/I,KAAKyI,cAAgB,GAAa,SACnSA,gBAG2C,MAA5CzI,KAAKwI,QAAQO,OAAO/I,KAAKyI,oBACtBA,gBACgD,MAA5CzI,KAAKwI,QAAQO,OAAO/I,KAAKyI,sBAC7BA,mBACM,GAITzI,KAAKyI,eAAiBzI,KAAK0I,WAAa1I,KAAKwI,QAAQO,OAAO/I,KAAKyI,eAAiB,KAAOzI,KAAKwI,QAAQO,OAAO/I,KAAKyI,eAAiB,gBAIhIzI,KAAKyI,cAAgBzI,KAAK0I,WAAa1I,KAAKwI,QAAQO,OAAO/I,KAAKyI,gBAAkB,KAAOzI,KAAKwI,QAAQO,OAAO/I,KAAKyI,gBAAkB,QAC7H,MACCzI,KAAKwI,QAAQO,OAAO/I,KAAKyI,eAAiB,SAClDA,oBAILuB,EAAST,EAAUE,QACbC,EAENJ,OACQW,KAAKC,IAAI,GAAIP,EAAUL,IAG/BM,IAAe5J,KAAKyI,0BAInB0B,iCAEEH,gDAIHhK,KAAKyI,eAAiBzI,KAAK0I,gBAG3B0B,GAAO,EACLC,EAAWrK,KAAKwI,QAAQO,OAAO/I,KAAKyI,oBACzB,MAAb4B,KACK,MACF,CAAA,GAAiB,MAAbA,YACF,cAKJF,iCACEC,8CAIDpB,EAAYhJ,KAAKwI,QAAQxI,KAAKyI,eAChCW,EAAUpJ,KAAKiJ,qBAAqBD,MACpCI,IAAY1J,WAAWU,gBAAiB,IAEtCJ,KAAK2I,mBAAqBjJ,WAAWU,uBAChC,WAECJ,KAAKsK,mBAAmBtB,EAAWhJ,KAAK2I,qBAClCjJ,WAAWU,uBAClB,eAGJqI,4BAGFE,iBAAmBS,EAEhBA,QACH1J,WAAWa,0BACP,IAAI0B,oBAAoBrC,EAAmBI,KAAKuK,eAAgBvK,KAAKuK,qBACzE7K,WAAWY,0BACP,IAAIoB,oBAAoB9B,EAAmBI,KAAKuK,eAAgBvK,KAAKuK,qBACzE7K,WAAWe,0BACP,IAAI0B,oBAAoBvC,EAAmBI,KAAKuK,eAAgBvK,KAAKuK,qBACzE7K,WAAWc,0BACP,IAAI0B,oBAAoBtC,EAAmBI,KAAKuK,eAAgBvK,KAAKuK,qBACzE7K,WAAWuB,qCACP,IAAI6C,8BAA8BlE,EAAmBI,KAAKuK,qBAC9D7K,WAAWsB,qCACP,IAAI4C,8BAA8BhE,EAAmBI,KAAKuK,qBAC9D7K,WAAWyB,mCACP,IAAI6C,4BAA4BpE,EAAmBI,KAAKuK,qBAC5D7K,WAAWwB,mCACP,IAAI6C,4BAA4BnE,EAAmBI,KAAKuK,qBAC5D7K,WAAWW,8BACTuI,sBACE,IAAIpH,oBAAoB5B,QAC5BF,WAAWiB,8BACR6J,GAAUnI,GAAIrC,KAAKuK,eAAgBjI,GAAItC,KAAKuK,eAAgBhI,GAAIvC,KAAKuK,eAAgB/H,GAAIxC,KAAKuK,eAAgB5I,EAAG3B,KAAKuK,eAAgB3I,EAAG5B,KAAKuK,uBAC7I,IAAI1H,0BAA0BjD,EAAmB4K,EAAO7I,EAAG6I,EAAO5I,EAAG4I,EAAOnI,GAAImI,EAAOlI,GAAIkI,EAAOjI,GAAIiI,EAAOhI,IACpH,KAAK9C,WAAWgB,8BACV8J,GAAUnI,GAAIrC,KAAKuK,eAAgBjI,GAAItC,KAAKuK,eAAgBhI,GAAIvC,KAAKuK,eAAgB/H,GAAIxC,KAAKuK,eAAgB5I,EAAG3B,KAAKuK,eAAgB3I,EAAG5B,KAAKuK,uBAC7I,IAAInI,0BAA0BxC,EAAmB4K,EAAO7I,EAAG6I,EAAO5I,EAAG4I,EAAOnI,GAAImI,EAAOlI,GAAIkI,EAAOjI,GAAIiI,EAAOhI,IACpH,KAAK9C,WAAW2B,qCACVmJ,GAAUjI,GAAIvC,KAAKuK,eAAgB/H,GAAIxC,KAAKuK,eAAgB5I,EAAG3B,KAAKuK,eAAgB3I,EAAG5B,KAAKuK,uBAC3F,IAAIrG,gCAAgCtE,EAAmB4K,EAAO7I,EAAG6I,EAAO5I,EAAG4I,EAAOjI,GAAIiI,EAAOhI,IACpG,KAAK9C,WAAW0B,qCACVoJ,GAAUjI,GAAIvC,KAAKuK,eAAgB/H,GAAIxC,KAAKuK,eAAgB5I,EAAG3B,KAAKuK,eAAgB3I,EAAG5B,KAAKuK,uBAC3F,IAAItG,gCAAgCrE,EAAmB4K,EAAO7I,EAAG6I,EAAO5I,EAAG4I,EAAOjI,GAAIiI,EAAOhI,IACpG,KAAK9C,WAAWmB,kCACV2J,GAAUnI,GAAIrC,KAAKuK,eAAgBjI,GAAItC,KAAKuK,eAAgB5I,EAAG3B,KAAKuK,eAAgB3I,EAAG5B,KAAKuK,uBAC3F,IAAIxH,8BAA8BnD,EAAmB4K,EAAO7I,EAAG6I,EAAO5I,EAAG4I,EAAOnI,GAAImI,EAAOlI,IAClG,KAAK5C,WAAWkB,kCACV4J,GAAUnI,GAAIrC,KAAKuK,eAAgBjI,GAAItC,KAAKuK,eAAgB5I,EAAG3B,KAAKuK,eAAgB3I,EAAG5B,KAAKuK,uBAC3F,IAAIzH,8BAA8BlD,EAAmB4K,EAAO7I,EAAG6I,EAAO5I,EAAG4I,EAAOnI,GAAImI,EAAOlI,SAC/F5C,WAAW6B,4CACP,IAAI6C,oCAAoCxE,EAAmBI,KAAKuK,eAAgBvK,KAAKuK,qBACzF7K,WAAW4B,4CACP,IAAI6C,oCAAoCvE,EAAmBI,KAAKuK,eAAgBvK,KAAKuK,qBACzF7K,WAAWqB,oBACRyJ,GAAUnI,GAAIrC,KAAKuK,eAAgBjI,GAAItC,KAAKuK,eAAgBE,SAAUzK,KAAKuK,eAAgBG,SAAU1K,KAAK2K,gBAAiBC,SAAU5K,KAAK2K,gBAAiBhJ,EAAG3B,KAAKuK,eAAgB3I,EAAG5B,KAAKuK,uBAC1L,IAAI5G,iBAAiB/D,EAAmB4K,EAAO7I,EAAG6I,EAAO5I,EAAG4I,EAAOnI,GAAImI,EAAOlI,GAAIkI,EAAOC,SAAUD,EAAOE,SAAUF,EAAOI,UAClI,KAAKlL,WAAWoB,oBACV0J,GAAUnI,GAAIrC,KAAKuK,eAAgBjI,GAAItC,KAAKuK,eAAgBE,SAAUzK,KAAKuK,eAAgBG,SAAU1K,KAAK2K,gBAAiBC,SAAU5K,KAAK2K,gBAAiBhJ,EAAG3B,KAAKuK,eAAgB3I,EAAG5B,KAAKuK,uBAC1L,IAAIvH,iBAAiBpD,EAAmB4K,EAAO7I,EAAG6I,EAAO5I,EAAG4I,EAAOnI,GAAImI,EAAOlI,GAAIkI,EAAOC,SAAUD,EAAOE,SAAUF,EAAOI,UAClI,cACM,IAAIhF,MAAM,oCAKhBiF,EAAU,IAAIvC,EACdwC,EAAS,IAAIvC,EAAOF,OAErByC,EAAOC,uCAGLD,EAAO3B,eAAe,KACrBzB,EAAUoD,EAAOE,mBAClBtD,aAGGuD,cAAcvD,UAGjBmD,EAAQ3E,uBAIJhG,UAAUC,UAAY,wBAE9B0D,eAAeyC,EAAepG,UAAW,4CAEvC0H,+BACE5H,KAAKyG,MAAM7H,oBAER,MAGC6I,sBAAwB,SAAUyD,OAC3C7C,EAAS,GACTlK,GAAQ,WACCmB,QAAQ,SAACoI,GAChBvJ,MACM,KACEuJ,EAAQyD,oBAER,IAAMzD,EAAQyD,kBAGrB9C,UAKFtG,iBAAiByD,eAAetF,8CAG5BF,KAAKoL,oBACHA,aAAe,IAAI9E,EAAetG,OAElCA,KAAKoL,0BAEF,gDAG2BpL,KAAKkG,yBAA4B,8CACnClG,KAAKkG,yBAA4B,wDACvBlG,KAAKkG,yBAA4B,YAE7EI,eAAiBA,GAj7B1B,GCMA,IAyHM+E,EAzHAC,EAAIC,OAYHC,KATExM,SAAS8G,iBAAqB9G,SAAS8G,gBAAgB5G,EAAGuM,IAAK,OAAOC,cAS3DC,UAAbH,WACDI,EAAM5M,SAAS8G,gBAAgB5G,EAAGuM,IAAK,OAGvCI,IAAalN,OAAOmN,MACpBC,EAAYP,EAAUQ,SAAS,eAC/BC,EAAWT,EAAUQ,SAAS,UAC9BE,EAAQV,EAAUQ,SAAS,QAC3BG,EAAYX,EAAUQ,SAAS,WAE/BI,GADaZ,EAAUQ,SAAS,WACvBR,EAAUQ,SAAS,cAC5BK,EAAW,iBAAkB1N,OAE7B2N,IACGV,EAAIW,cAGPC,IACGxN,SAASyN,SAIZC,EAA4B,eAC5BC,EAAO3N,SAAS8G,gBAAgB5G,EAAGuM,IAAK,UACzC1F,aAAa,IAAK,kBACjB6G,EAAUD,EAAKzG,YACf2G,EAAMF,EAAKnI,0BAA0B,EAAG,gBAEpCsI,YAAYD,EAAK,IAClB,EACP,MAAOE,WACF,EAT2B,GAY5BC,EAAiC,eACjCL,EAAO3N,SAAS8G,gBAAgB5G,EAAGuM,IAAK,UACzC1F,aAAa,IAAK,kBACjB6G,EAAUD,EAAKzG,YACf2G,EAAMF,EAAKnI,0BAA0B,EAAG,gBAEpCyI,iBAAiBJ,EAAK,IACvB,EACP,MAAOE,WACF,EATgC,GAajCG,EAA4B,eAC5BC,EAAUnO,SAAS8G,gBAAgB5G,EAAGuM,IAAK,OAC3C2B,EAAapO,SAAS8G,gBAAgB5G,EAAGuM,IAAK,gBAC3C4B,gBAAgBC,OAAOH,KACrBpH,aAAa,IAAK,KACrBuH,OAAOF,OACTG,EAAOvO,SAAS8G,gBAAgB5G,EAAGuM,IAAK,UACzC+B,YAAc,MACRF,OAAOC,OACZE,EAAMF,EAAKG,uBAAuB,GAAG/L,WACnCgM,SACQ,IAARF,EAX0B,GAc5BG,EAAqB,eACrBR,EAAapO,SAAS8G,gBAAgB5G,EAAGuM,IAAK,gBAC3C4B,gBAAgBC,OAAOF,OAC1BT,EAAO3N,SAAS8G,gBAAgB5G,EAAGuM,IAAK,UACzC1F,aAAa,IAAK,0BACZuH,OAAOX,OACZkB,EAAOlB,EAAKmB,mBACPH,SACHE,EAAKE,OAAS,GAAKF,EAAKE,OAAS,EARd,GAYrBC,EAAgC,eAChCZ,EAAapO,SAAS8G,gBAAgB5G,EAAGuM,IAAK,gBAC3C4B,gBAAgBC,OAAOF,OAC1BT,EAAO3N,SAAS8G,gBAAgB5G,EAAGuM,IAAK,UACzC1F,aAAa,IAAK,iBACjBkI,EAAQjP,SAAS8G,gBAAgB5G,EAAGuM,IAAK,UACzC1F,aAAa,IAAK,iBAClBmI,EAAIlP,SAAS8G,gBAAgB5G,EAAGuM,IAAK,OACzC6B,OAAOX,EAAMsB,KACJX,OAAOY,OACZL,EAAOK,EAAEJ,mBACJH,SAEY,KAAfE,EAAKM,MAbyB,GAmChCC,GAdyB,eAEzB/C,EAAOrM,SAAS8G,gBAAgB5G,EAAGuM,IAAK,UACzC1F,aAAa,IAAK,QAEjBsI,GADQhD,EAAKiD,WAAU,GACJtI,aAAa,KAAKgG,SAAS,KAC/CqC,KAEDE,MAAM,iLARqB,IAezBlD,EAAOrM,SAAS8G,gBAAgB5G,EAAGuM,IAAK,SACzC1F,aAAa,QAAS,oCACQ,uBAA5BsF,EAAKmD,MAAMC,cAGdC,EAAoC,eAElCC,EADO3P,SAAS8G,gBAAgB5G,EAAGuM,IAAK,QAC1BmD,UAAUC,QACxBC,EAAKlD,EAAImD,uBACRC,WAAWF,OACZ7L,EAAK0L,EAAOM,QAAQ,UAEnBhM,aAAciM,cAAgBJ,aAAcI,cAClDjM,EAAG7E,OAAS0Q,EAAG1Q,MAAQ6E,EAAGE,QAAU2L,EAAG3L,OACvCF,EAAGkM,OAAOC,IAAMN,EAAGK,OAAOC,GAC1BnM,EAAGkM,OAAOE,IAAMP,EAAGK,OAAOE,GAC1BpM,EAAGkM,OAAOG,IAAMR,EAAGK,OAAOG,GAC1BrM,EAAGkM,OAAOI,IAAMT,EAAGK,OAAOI,GAC1BtM,EAAGkM,OAAOK,IAAMV,EAAGK,OAAOK,GAC1BvM,EAAGkM,OAAOM,IAAMX,EAAGK,OAAOM,EAda,GAuB3BC,EAAU,kBAAM7D,GAKhB8D,EAAW,kBAAM5D,GAKjB6D,EAAU,kBAAM3D,GAKhB4D,EAAO,kBAAM3D,GAKb4D,EAAW,kBAAM3D,GAUjB4D,EAAQ,kBAAM3D,GAKd4D,EAAU,kBAAM3D,GAoChB4D,EAA8B,kBAAMjC,GAwBpCkC,EAA2B,kBAAM9B,GC/O/B,WAAU9C,OACjB6E,EAAU7E,EAAE8E,GAAGC,cAWnBD,GAAGC,KAAO,SAAUC,EAAKC,OACnBC,EAAMxQ,KAAKpB,WACZ4R,SAAcL,EAAQM,MAAMzQ,KAAM0Q,eAClC,IAAIC,EAAI,EAAGA,EAAIH,IAAOG,EAAG,KACtBC,EAAO5Q,KAAK2Q,MAdZ,+BAgBFC,EAAKC,oBAkCAV,EAAQM,MAAMzQ,KAAM0Q,mBAhCbjP,IAAV8O,IACGxK,aAAauK,EAAKC,QAClB,GAAIO,MAAMC,QAAQT,GAAM,SAEvBU,KACFC,EAAIX,EAAI1R,OAELqS,KAAK,KACJC,EAAQZ,EAAIW,GACdZ,EAAOO,EAAK5K,aAAakL,IAEzBb,GAAiB,MAATA,OACHtI,MAAMsI,GAAQA,EAAQA,EAAO,KAElCa,GAASb,SAERW,KAEU,qBAARV,gBAAAA,IAMJ,KACDD,EAAOO,EAAK5K,aAAasK,UACzBD,GAAiB,MAATA,OACHtI,MAAMsI,GAAQA,EAAQA,EAAO,GAE/BA,yCATmBc,OAAO9R,QAAQiR,kDAAM,wBAAnC/Q,OAAM6R,SACXrL,aAAaxG,EAAM6R,yFAczBpR,MAEFsL,ECjET,IAAM6B,EAAUnO,SAAS8G,gBAAgB5G,EAAGuM,IAAK,OAGjD,SAAS4F,EAAmBC,OACpBC,EAAID,EAAMnC,OACZ5B,EAAO,UACH+D,EAAMlT,WACT,IACI,WAAamT,EAAEnC,EAAGmC,EAAElC,EAAGkC,EAAEjC,EAAGiC,EAAEhC,EAAGgC,EAAE/B,EAAG+B,EAAE9B,GAAG+B,KAAK,KAAO,eAE3D,IACI,aAAeD,EAAE/B,EAAI,IAAM+B,EAAE9B,EAAI,eAErC,IACC8B,EAAEnC,IAAMmC,EAAEhC,EACL,SAAWgC,EAAEnC,EAAI,IAEjB,SAAWmC,EAAEnC,EAAI,IAAMmC,EAAEhC,EAAI,eAGnC,MACCkC,EAAK,EACLC,EAAK,KAEW,IAAhBJ,EAAMnO,MAAa,KACfwO,EAAI,EAAIJ,EAAEnC,KACVuC,EAAIJ,EAAE9B,EAAI8B,EAAElC,EAAIkC,EAAE/B,IAAMmC,EAAIA,EAAIJ,EAAElC,EAAIkC,EAAElC,MACxCkC,EAAE/B,EAAI+B,EAAElC,EAAIqC,GAAMC,IAEnB,UAAYL,EAAMnO,MAAQ,IAAMsO,EAAK,IAAMC,EAAK,WAIlDnE,EAMT,IAAIqE,KAkESC,wBAIEjB,kBACNkB,MAAQlB,GAAQ,UAChBmB,gBAEAC,QAAU,eACTC,EAAO,GACgB9E,EAAQ+E,sBAC9B,IAAIvB,EAAI,EAAGA,EAAI3Q,KAAKmG,gBAAiBwK,EAAG,IAEnCU,EADMrR,KAAKyG,MAAMwI,QAAQ0B,IACE,SAEhCmB,MAAM/L,aAAa,YAAakM,SAElCxL,MAAQzG,UACRmS,MAAQ,sBAEPC,EAAMpS,KAAK8R,MAAM9L,aAAa,gBAC7BoM,UAGCC,EAAK,yDACPd,GAAI,EACDA,KACDa,EAAIE,MAAMD,KACRD,EAAIG,QAAQF,EAAI,IAClBd,GAAKA,EAAE,mBAEHiB,EADIjB,EAAE,GACGkB,MAAM,SACflT,EAAOiT,EAAK,GACZE,EAAUF,EAAK,GAAGF,MAAM,mBACtB,GAAKI,EAAQ,GAAGH,QAAQ,SAAU,YACpCI,EAASD,EAAQ,GAAGD,MAAM,SAC1BG,EAAU,SAASH,MAAM,IACzBI,EAAM1F,EAAQ+E,yBACbY,OAAOH,GAAQrT,QAAQ,SAAU6I,EAAMwI,KACrCA,GAAKoC,WAAW5K,GACV,WAAT5I,MACEqT,EAAQjC,IAAMgC,EAAOhC,UAGvBW,EAAQnE,EAAQ4B,qBAChBiE,EAAQ,MAAQzT,EAAKwJ,OAAO,GAAGkK,cAAgB1T,EAAK2T,MAAM,GAC1DJ,EAAkB,WAATvT,GAAqBsT,GAAOF,EAE9B,UAATpT,GAAsC,IAAlBuT,EAAOlU,SACtBwJ,KAAK0K,EAAO,IACD,cAATvT,GAA0C,IAAlBuT,EAAOlU,SACjCwJ,KAAK,GACM,WAAT7I,GAAuC,IAAlBuT,EAAOlU,UAC9BwJ,KAAK,EAAG,KAEX4K,GAAOvC,MAAMa,EAAOwB,KACrBrM,MAAMuI,WAAWsC,YAIvB6B,sBAAwB,SAAUhL,MACjCA,EAAM,KAGJiL,GAAQ,MACP,IAAMC,KAAMzB,EAAU,SACnB0B,EAAK1B,EAASyB,GACX1C,EAAI,EAAGH,EAAM8C,EAAGvB,QAAQnT,OAAQ+R,EAAIH,IAAOG,KAC9C2C,EAAGvB,QAAQpB,KAAOxI,EAAM,IAClB,IACL/B,WAAWuK,YAIdyC,gBAOLjN,cAAgB,iDAMhBA,cAAgB,OAChB4L,8CAOKlK,QACL1B,cAAgB,OAChBgN,sBAAsBtL,QACtBkK,SAAWlK,mCAQTC,MACHA,EAAQ9H,KAAKmG,eAAiB2B,GAAS,SAClC9H,KAAK+R,QAAQjK,OAEhBiF,EAAM,IAAInH,MAAM,iDAClB2N,KAAO,EACLxG,2CAQUlF,EAASC,OACrBuG,EAAW,QACXvG,GAAS,KACPA,EAAQ9H,KAAKmG,cAAe,MACzBgN,sBAAsBtL,OACrB2L,EAAY,IAAI1C,MAAM9Q,KAAKmG,cAAgB,GAE7CwK,aACCA,EAAI,EAAGA,EAAI7I,IAAS6I,IACbA,GAAK3Q,KAAK+R,QAAQpB,KAEpBA,GAAK9I,MACV,IAAIoJ,EAAIN,EAAI,EAAGA,EAAI3Q,KAAKmG,gBAAiB8K,IAAKN,IACvCM,GAAKjR,KAAK+R,QAAQpB,QAEzBxK,qBACA4L,QAAUyB,IACJ3L,OACNpB,MAAMuL,iBAEAhS,KAAKyG,MAAMuI,WAAWnH,UAG9BwG,sCAQIxG,EAASC,OAChBuG,EAAW,YACXvG,EAAQ9H,KAAKmG,eAAiB2B,GAAS,SACpCqL,sBAAsBtL,QACtBkK,QAAQjK,GAASD,IACXA,OACNpB,MAAMuL,WAEN3D,qCAQGvG,MACNA,EAAQ9H,KAAKmG,eAAiB2B,GAAS,EAAG,KACtCuG,EAAWrO,KAAK+R,QAAQjK,GACxB0L,EAAY,IAAI1C,MAAM9Q,KAAKmG,cAAgB,GAC7CwK,aACCA,EAAI,EAAGA,EAAI7I,IAAS6I,IACbA,GAAK3Q,KAAK+R,QAAQpB,OAEzB,IAAIM,EAAIN,EAAGM,EAAIjR,KAAKmG,cAAgB,IAAK8K,IAAKN,IACvCM,GAAKjR,KAAK+R,QAAQpB,EAAI,eAE7BxK,qBACA4L,QAAUyB,OACV/M,MAAMuL,UACJ3D,MAEHtB,EAAM,IAAInH,MAAM,iDAClB2N,KAAO,EACLxG,qCAOIlF,eACLsL,sBAAsBtL,QACtBkK,QAAQ3J,KAAKP,QACb1B,qBACAM,MAAMuL,UACJnK,WAkBA4L,EAA2B,SAAU7C,GAC1CA,EAAKyC,IAAMzB,EAAShB,EAAKyC,YACpBzB,EAAShB,EAAKyC,KAWZK,EAAmB,SAAU9C,OFhFQlC,EEiFX,KAC7B2E,EAAKzC,EAAKyC,IAAM,OAClBM,EAAI/B,EAASyB,UACZM,GAAY,SAAPN,MACCA,GAAM,IAAIxB,EAAiBjB,KAC3ByC,GAAIlB,UACTP,EAASyB,IAERM,SAEL/C,EAAKhC,UACAgC,EAAKhC,UAAUC,QAEpB+B,EAAKgD,kBACAhD,EAAKgD,kBAAkB/E,QAE5B+B,EAAKiD,iBACAjD,EAAKiD,iBAAiBhF,QAGxB,MCpWHiF,GAAU,IAAK,KAAM,KAAM,KAAM,SACjCC,GAAU,IAAK,KAAM,KAAM,KAAM,UACjCC,GAAa,IAAK,iBAAaF,EAAWC,GAgB5CE,SAGAC,KAkFSC,EAAa,kBACjBD,GAmBIE,GAAa,SAAbA,EAAuBhD,OAC5BiD,EAASJ,EAAkBK,wBAC5BvM,MAAMqJ,GAIPN,MAAMC,QAAQK,GACTgD,EAAWhD,EAAI,IAAM,IAAMgD,EAAWhD,EAAI,IAE5C2B,WAAW3B,GAAKmD,QAAQF,GAAU,KAL5BjD,GAAKmD,QAAQF,IAafG,GAAc,SAAUpD,EAAKqD,YACjCA,GAAQR,EAAkBS,cAI1BN,GAAWhD,EAAM8C,EAASO,KAYtBE,GAAc,SAAU/D,EAAMP,EAAMe,KAgC1CrL,aAAasK,EAAMe,IAkDbwD,GAAe,SAAUvE,EAAMe,OAErCrJ,MAAMqJ,UAAeA,EAAM,KACT,MAAnBA,EAAIyD,QAAQ,GAAY,KAEpBC,EAAM1D,EAAIyD,OAAO,EAAGzD,EAAIxS,OAAS,GAAK,IACtCuP,EAAQ8F,EAAkBc,WAC1BhH,EAASkG,EAAkBe,mBAE7BlB,EAAO9H,SAASqE,GACXyE,EAAM3G,EAEX4F,EAAO/H,SAASqE,GACXyE,EAAM/G,EAER+G,EAAM7K,KAAKgL,KAAM9G,EAAQA,EAAUJ,EAASA,GAAW9D,KAAKgL,KAAK,OAEpER,EAAOrD,EAAIyD,QAAQ,UACbzD,EAAIyD,OAAO,EAAGzD,EAAIxS,OAAS,GAE1BsV,EAASO,IAUXS,GAAc,SAAU7E,EAAMe,EAAK+D,MAC1CnB,EAAUhI,SAASqE,UAEhBtI,MAAMqJ,OAILA,EAAI3R,cACH0R,OAAOiE,KAAKlB,GAAUmB,KAAK,SAACZ,UACtB,IAAIa,OAAO,eAAiBb,EAAO,KACpCc,KAAKnE,SAGN,OAATf,EAAe,KAIbmF,GAAS,UAML5E,EAAOqD,EAAkBwB,WAAWrE,KACxB,MAARR,GAAgBA,IAASuE,EACnC,MAAO3F,WACFgG,SAEF,GCtSIE,iBACG,2BACD,6BACG,+BACD,iBAQXC,wFAKK3V,KAAKuN,cA4EHqI,0BACEhF,EAAMiF,EAAgBC,EAAWvI,uFAEvCqD,KAAOA,IACPrD,KAAOA,EAAQ,QAAUqD,EAAKmF,QAAU,OAASxI,EAAS,QAAUqD,EAAKmF,UACzEF,eAAiBA,IACjBC,UAAYA,IACZE,eAAiBpF,EAAKqF,cACtBC,UAAYtF,EAAKuF,wBARcR,4CAW7B,mEASFS,GAEDA,KACMC,mBAAmBX,GAAkBY,aAActW,WAGxD4Q,KAAO5Q,KAAKkW,UAAUK,aAAavW,KAAK4Q,KAAM5Q,KAAKgW,gBAEpDI,KACMC,mBAAmBX,GAAkBc,YAAaxW,sCAUrDoW,GACHA,KACMC,mBAAmBX,GAAkBe,eAAgBzW,WAG1D4Q,KAAO5Q,KAAK8V,UAAUS,aAAavW,KAAK4Q,KAAM5Q,KAAK6V,gBAEpDO,KACMC,mBAAmBX,GAAkBgB,cAAe1W,gDAQtDA,KAAK4Q,eAGjBgF,GAAmBxX,KAAOwX,GAAmB1V,UAAU9B,SAS1CuY,0BACE/F,EAAMrD,uFAEZqD,KAAOA,IACPrD,KAAOA,GAAS,UAAYqD,EAAKmF,UACjCa,OAAShG,EAAKuF,aACdF,YAAcY,EAAKjG,KAAKqF,yBANSN,4CAU/B,qEASFS,GACDA,KACMC,mBAAmBX,GAAkBY,aAActW,WAGxD4Q,KAAO5Q,KAAK4W,OAAOL,aAAavW,KAAK4Q,KAAM5Q,KAAKiW,aAEjDG,KACMC,mBAAmBX,GAAkBc,YAAaxW,sCAUrDoW,GACHA,KACMC,mBAAmBX,GAAkBe,eAAgBzW,WAG1D4W,OAAS5W,KAAK4Q,KAAKuF,gBACnBvF,KAAO5Q,KAAK4Q,KAAKuF,WAAWW,YAAY9W,KAAK4Q,MAE9CwF,KACMC,mBAAmBX,GAAkBgB,cAAe1W,gDAQtDA,KAAK4Q,eAGjB+F,GAAqBvY,KAAOuY,GAAqBzW,UAAU9B,SAU9C2Y,0BACEnG,EAAMiF,EAAgBC,EAAWvI,uFAEvCqD,KAAOA,IACPrD,KAAOA,GAAS,UAAYqD,EAAKmF,UACjCE,YAAcJ,IACde,OAASd,IAGWlF,gBATa+E,4CAY/B,qEASFS,GACDA,KACMC,mBAAmBX,GAAkBY,aAActW,QAGpCA,KAAK4Q,WACzBgG,OAAS5W,KAAK4Q,KAAKuF,gBACnBvF,KAAO5Q,KAAK4W,OAAOE,YAAY9W,KAAK4Q,MAErCwF,KACMC,mBAAmBX,GAAkBc,YAAaxW,sCAUrDoW,GACHA,KACMC,mBAAmBX,GAAkBe,eAAgBzW,QAGtCA,KAAK4Q,MACN,MAApB5Q,KAAKiW,aACHtX,OAAOqY,iBACDC,IAAI,0CAGXL,OAAOL,aAAavW,KAAK4Q,KAAM5Q,KAAKiW,aAErCG,KACMC,mBAAmBX,GAAkBgB,cAAe1W,gDAQtDA,KAAK4Q,eAGjBmG,GAAqB3Y,KAAO2Y,GAAqB7W,UAAU9B,SAiB9C8Y,0BACEtG,EAAMuG,EAAO5J,kFAMnB,IAAM8C,OAJNO,KAAOA,IACPrD,KAAOA,EAAQ,UAAYqD,EAAKmF,QAAU,IAAMxI,EAAS,UAAYqD,EAAKmF,UAC1EqB,eACAC,UAAYF,EACEA,IAEVC,UAAU/G,GADJ,UAATA,EACqBO,EAAKpD,YACV,UAAT6C,EACciH,GAAQ1G,GAERA,EAAK5K,aAAaqK,uBAbPsF,4CAkB/B,qEASFS,GACDA,KACMC,mBAAmBX,GAAkBY,aAActW,UAGzDuX,GAAoB,MACnB,IAAMlH,KAAQrQ,KAAKoX,UAClBpX,KAAKoX,UAAU/G,GACJ,UAATA,OACGO,KAAKpD,YAAcxN,KAAKoX,UAAU/G,GACrB,UAATA,KACDrQ,KAAK4Q,KAAM5Q,KAAKoX,UAAU/G,SAE7BO,KAAK7K,aAAasK,EAAMrQ,KAAKoX,UAAU/G,IAGjC,UAATA,OACGO,KAAKpD,YAAc,SAEnBoD,KAAK7K,aAAasK,EAAM,SACxBO,KAAK4G,gBAAgBnH,IAIjB,cAATA,OAA4C,OAI7CkH,EAAmB,KAChBpU,EAAQsU,GAAiBzX,KAAK4Q,SAChCzN,EAAO,KACH0K,EAAO7N,KAAK4Q,KAAK9C,UAGjB4J,GAAU,UAAWvU,EAAO,IAFvB0K,EAAKlM,EAAIkM,EAAKM,MAAQ,EAEU,IADpCN,EAAKjM,EAAIiM,EAAKE,OAAS,EACsB,KAAKyD,KAAK,IAC1DkG,IAAW1X,KAAK4Q,KAAK5K,aAAa,mBAC/B4K,KAAK7K,aAAa,YAAa2R,WAKtCtB,KACMC,mBAAmBX,GAAkBc,YAAaxW,OAGrD,kCASAoW,GACHA,KACMC,mBAAmBX,GAAkBe,eAAgBzW,UAG3DuX,GAAoB,MACnB,IAAMlH,KAAQrQ,KAAKqX,UAClBrX,KAAKqX,UAAUhH,GACJ,UAATA,OACGO,KAAKpD,YAAcxN,KAAKqX,UAAUhH,GACrB,UAATA,KACDrQ,KAAK4Q,KAAM5Q,KAAKqX,UAAUhH,SAE7BO,KAAK7K,aAAasK,EAAMrQ,KAAKqX,UAAUhH,IAGjC,UAATA,OACGO,KAAKpD,YAAc,QAEnBoD,KAAK4G,gBAAgBnH,GAGjB,cAATA,OAA4C,OAG7CkH,EAAmB,KAChBpU,EAAQsU,GAAiBzX,KAAK4Q,SAChCzN,EAAO,KACH0K,EAAO7N,KAAK4Q,KAAK9C,UAGjB4J,GAAU,UAAWvU,EAAO,IAFvB0K,EAAKlM,EAAIkM,EAAKM,MAAQ,EAEU,IADpCN,EAAKjM,EAAIiM,EAAKE,OAAS,EACsB,KAAKyD,KAAK,IAC1DkG,IAAW1X,KAAK4Q,KAAK5K,aAAa,mBAC/B4K,KAAK7K,aAAa,YAAa2R,aAMjB1X,KAAK4Q,MAE1BwF,KACMC,mBAAmBX,GAAkBgB,cAAe1W,OAGvD,4CAOCA,KAAK4Q,eAGjBsG,GAAqB9Y,KAAO8Y,GAAqBhX,UAAU9B,SAU9CuZ,0BAIEpK,uFAENA,KAAOA,GAAQ,kBACfqK,sBAPyBjC,4CAWvB,6DASFS,GACDA,KACMC,mBAAmBX,GAAkBY,aAActW,cAGvDwQ,EAAMxQ,KAAK4X,MAAMhZ,OACd+R,EAAI,EAAGA,EAAIH,IAAOG,OACpBiH,MAAMjH,GAAGF,MAAM2F,GAGlBA,KACMC,mBAAmBX,GAAkBc,YAAaxW,sCAUrDoW,GACHA,KACMC,mBAAmBX,GAAkBe,eAAgBzW,UAG1D,IAAI2Q,EAAI3Q,KAAK4X,MAAMhZ,OAAS,EAAG+R,GAAK,EAAGA,SACrCiH,MAAMjH,GAAGkH,QAAQzB,GAGpBA,KACMC,mBAAmBX,GAAkBgB,cAAe1W,iDASxD8X,KACFC,EAAM/X,KAAK4X,MAAMhZ,OACdmZ,aACCC,EAAYhY,KAAK4X,MAAMG,GAAKE,WAC9BrH,EAAOoH,EAAUpZ,OACdgS,KACAkH,EAAM9L,SAASgM,EAAUpH,OAAgBxI,KAAK4P,EAAUpH,WAG1DkH,wCAOMC,QACRH,MAAMxP,KAAK2P,4CAOR/X,KAAK4X,MAAMhZ,gBAGvB+Y,GAAavZ,KAAOuZ,GAAazX,UAAU9B,SAK9B8Z,yBAIEC,kBACNC,SAAWD,GAAuB,UAClCE,iBAAmB,OACnBC,kBAIAC,wBAA0B,OAC1BC,+EAQAF,kBACAD,iBAAmB,oDAOjBrY,KAAKqY,mEAOLrY,KAAKsY,UAAU1Z,OAASoB,KAAKqY,yEAO7BrY,KAAKqY,iBAAmB,EAAIrY,KAAKsY,UAAUtY,KAAKqY,iBAAmB,GAAGI,UAAY,2DAOlFzY,KAAKqY,iBAAmBrY,KAAKsY,UAAU1Z,OAASoB,KAAKsY,UAAUtY,KAAKqY,kBAAkBI,UAAY,kCAQrGzY,KAAKqY,iBAAmB,GACdrY,KAAKsY,YAAYtY,KAAKqY,kBAC9BR,QAAQ7X,KAAKoY,yCASfpY,KAAKqY,iBAAmBrY,KAAKsY,UAAU1Z,QAAUoB,KAAKsY,UAAU1Z,OAAS,GAC/DoB,KAAKsY,UAAUtY,KAAKqY,oBAC5B5H,MAAMzQ,KAAKoY,sDASEL,GAQf/X,KAAKqY,iBAAmBrY,KAAKsY,UAAU1Z,QAAUoB,KAAKsY,UAAU1Z,OAAS,SACtE0Z,UAAYtY,KAAKsY,UAAUpQ,OAAO,EAAGlI,KAAKqY,wBAE5CC,UAAUlQ,KAAK2P,QACfM,iBAAmBrY,KAAKsY,UAAU1Z,mDAapB8Z,EAAUZ,WACvBa,IAAM3Y,KAAKuY,uBACb5H,EAAImH,EAAMlZ,OACRyY,EAAY,IAAIvG,MAAMH,GAAIsH,EAAW,IAAInH,MAAMH,GAC9CA,KAAK,KACJC,EAAOkH,EAAMnH,GACP,MAARC,MACKD,GAAKC,IACJD,GAAKC,EAAK5K,aAAa0S,SAE9BF,oBAAoBG,8FAcnBA,EAAI3Y,KAAKuY,yBACTK,EAAY5Y,KAAKwY,oBAAoBG,GACpCD,EAAYE,EAAZF,SACDG,EAAW,IAAIlB,GAAa,UAAYe,GAC1C/H,EAAIiI,EAAUX,SAASrZ,OACpB+R,KAAK,KACJC,EAAOgI,EAAUX,SAAStH,MACpB,MAARC,OACEkI,OACEJ,GAAYE,EAAUvB,UAAU1G,GACpCmI,EAAQJ,KAAc9H,EAAK5K,aAAa0S,MACjCK,cAAc,IAAI7B,GAAqBtG,EAAMkI,EAASJ,iBAG9DF,oBAAoBG,GAAK,KACvBE,iLCpqBLjN,GAAM5M,SAAS8G,gBAAgB5G,EAAGuM,IAAK,OAWhCuN,GAAiB,SAAUrX,EAAGC,EAAG2P,UACpC5P,EAAG4P,EAAEnC,EAAIzN,EAAI4P,EAAEjC,EAAI1N,EAAI2P,EAAE/B,EAAG5N,EAAG2P,EAAElC,EAAI1N,EAAI4P,EAAEhC,EAAI3N,EAAI2P,EAAE9B,IAUlDwJ,GAAa,SAAU1H,UAClB,IAARA,EAAEnC,GAAmB,IAARmC,EAAElC,GAAmB,IAARkC,EAAEjC,GAAmB,IAARiC,EAAEhC,GAAmB,IAARgC,EAAE/B,GAAmB,IAAR+B,EAAE9B,GAUhEyJ,GAAiB,sCAAaC,6CACnC5H,EAAI4H,EAAKC,YAAY,SAACC,EAAMC,UACzBA,EAAGC,SAASF,YAGjBpP,KAAKuP,IAAIjI,EAAEnC,GAzCC,UAyCmBA,EAAI,GACnCnF,KAAKuP,IAAIjI,EAAElC,GA1CC,UA0CmBA,EAAI,GACnCpF,KAAKuP,IAAIjI,EAAEjC,GA3CC,UA2CmBA,EAAI,GACnCrF,KAAKuP,IAAIjI,EAAEhC,GA5CC,UA4CmBA,EAAI,GACnCtF,KAAKuP,IAAIjI,EAAE/B,GA7CC,UA6CmBA,EAAI,GACnCvF,KAAKuP,IAAIjI,EAAE9B,GA9CC,UA8CmBA,EAAI,GAEhC8B,GASIkI,GAAqB,SAAUC,OACrCA,SAAgB,UACjB5E,EAAM4E,EAAMvT,cACT2O,KAAO,KACNxD,EAAQoI,EAAMzK,QAAQ6F,MACT,IAAfxD,EAAMlT,OAAe6a,GAAW3H,EAAMnC,eAAkB,SAEvD,GA0BIwK,GAAe,SAAUC,EAAGjG,EAAGkG,EAAGC,EAAGvI,OAC1C+B,EAAK0F,GAAeY,EAAGjG,EAAGpC,GAC9BwI,EAAKf,GAAgBY,EAAIC,EAAIlG,EAAGpC,GAChCyI,EAAKhB,GAAeY,EAAIjG,EAAImG,EAAIvI,GAChC0I,EAAKjB,GAAgBY,EAAIC,EAAKlG,EAAImG,EAAIvI,GAEtC2I,EAAOjQ,KAAKkQ,IAAI7G,EAAG3R,EAAGoY,EAAGpY,EAAGqY,EAAGrY,EAAGsY,EAAGtY,GACrCyY,EAAOnQ,KAAKoQ,IAAI/G,EAAG3R,EAAGoY,EAAGpY,EAAGqY,EAAGrY,EAAGsY,EAAGtY,GACrC2Y,EAAOrQ,KAAKkQ,IAAI7G,EAAG1R,EAAGmY,EAAGnY,EAAGoY,EAAGpY,EAAGqY,EAAGrY,uCAShCsY,IACAI,QACKF,EAAOF,SAVVjQ,KAAKoQ,IAAI/G,EAAG1R,EAAGmY,EAAGnY,EAAGoY,EAAGpY,EAAGqY,EAAGrY,GAWnB0Y,KAiBTC,GAA2B,SAAUb,EAAOS,EAAKE,MAC/C,MAATX,SAEK9N,GAAI4O,6BAA6B5O,GAAIsG,wBAExCiI,GAAO,IACPE,GAAQX,EAAMvT,cAAgB,KAC9BsU,SAASN,EAAK,QACdM,SAASJ,EAAK,KACL,KAAQK,EAAOL,EAAKA,EAAMF,EAAKA,EAAMO,UAChDnJ,EAAI3F,GAAIsG,kBACHvB,EAAIwJ,EAAKxJ,GAAK0J,IAAO1J,EAAG,KAEzBgK,EAAQhK,GAAK,GAAKA,EAAI+I,EAAMvT,cAC9BuT,EAAMzK,QAAQ0B,GAAGxB,OACjBvD,GAAIsG,oBACJgH,GAAe3H,EAAGoJ,UAEjB/O,GAAI4O,6BAA6BjJ,IAS7BqJ,GAAY,SAAUhK,OAC3B8I,EAAQhG,EAAiB9C,UACxB2J,GAAyBb,GAAOvK,QAa5B0L,GAAc,SAAUxY,EAAIC,EAAIC,EAAIC,OACzCsY,EAAO7Q,KAAK8Q,GAAK,EACjBC,EAAKzY,EAAKF,EACV4Y,EAAKzY,EAAKF,EACVa,EAAQ8G,KAAKiR,MAAMD,EAAID,GACvBG,EAAOlR,KAAKgL,KAAK+F,EAAKA,EAAKC,EAAKA,GAChCG,EAAYnR,KAAKoR,MAAMlY,EAAQ2X,GAAQA,WAGxCzY,EAAK8Y,EAAOlR,KAAKqR,IAAIF,KACrB9Y,EAAK6Y,EAAOlR,KAAKsR,IAAIH,KACrBA,IAWMI,GAAiB,SAAUvY,EAAIC,UACnCA,EAAGvB,EAAKsB,EAAGtB,EAAIsB,EAAGkL,OACtBjL,EAAGvB,EAAIuB,EAAGiL,MAASlL,EAAGtB,GACvBuB,EAAGtB,EAAKqB,EAAGrB,EAAIqB,EAAG8K,QACjB7K,EAAGtB,EAAIsB,EAAG6K,OAAU9K,EAAGrB,GCjMtB0J,GAAIC,OAEJkQ,OACA,IAAK,QACL,IAAK,QACL,IAAK,IAAK,KAAM,KAAM,KAAM,SAC5B,IAAK,IAAK,KAAM,UACf,IAAK,IAAK,KAAM,KAAM,QAAS,eAAgB,iBAC/C,SACA,SACA,IAAK,IAAK,KAAM,UAChB,IAAK,MASNC,MAMOC,GAAe,SAAUC,UAC7BC,OAAOH,GAAWE,EAAKE,KAG5BC,MAEAC,IAAiB,EAIjBC,MAgBOtP,GAAO,KAEduP,GAAiB,KA6JRC,GAAO,SAAUC,MACXA,MAEJ,EAAG,gBAGdC,MAFqB,SAAU,SAAU,eAAgB,mBAAoB,MAC7E,mBAAoB,iBAAkB,qBAAsB,0BACxC,SAAU1L,EAAG2L,MACvBlU,KAAKkU,EAAI,UACTlU,KAAKkU,EAAI,UAWVrP,GAAmB,SAAU2D,EAAM2L,EAAQzU,OAEhD0U,EAAO5L,EAAK1K,eNpC8B8G,IMuCzCC,iBAAiBsP,EAAQzU,gBAG1B0I,EAAMgM,EAAKrW,cACXsW,KACG9L,EAAI,EAAGA,EAAIH,EAAKG,IAAK,KACtB+L,EAASF,EAAKvN,QAAQ0B,KACxBvI,KAAKsU,KAENC,YACA,IAAIhM,EAAI,EAAGA,EAAIH,EAAKG,IACnBA,IAAM7I,KACHkH,WAAWuN,KAEbvN,WAAWyN,EAAI9L,MAwBXiM,GAAY,SAAU/P,EAAKgQ,OAC/BlQ,EAAQE,EAARF,KACHmQ,KACCD,EAAQA,EAAMlb,EAAIkL,EAAI1E,KAAKxG,IAC3Bkb,EAAQA,EAAMjb,EAAIiL,EAAI1E,KAAKvG,GAG5B+K,EAAKwC,WACI6J,GAAe8D,EAAInb,EAAGmb,EAAIlb,EAAG+K,EAAKwC,aAIzC4N,EAAcb,GAAec,0BAC/Brb,GAAKob,IACLnb,GAAKmb,EAEFD,GASIG,GAAmB,SAAUC,EAAIvQ,OACtCmQ,KACDI,EAAGvb,IACHub,EAAGtb,GAGJ+K,EAAKwC,WACF6J,GAAe8D,EAAInb,EAAGmb,EAAIlb,EAAG+K,EAAKwQ,WACnCxb,EAAIub,EAAGvb,IACPC,EAAIsb,EAAGtb,OAGPmb,EAAcb,GAAec,0BAC/Brb,GAAKob,IACLnb,GAAKmb,EAEFD,GAYIM,GAAe,SAAUtV,EAAOnG,EAAGC,OAExCyb,EAAqBC,KAEvBC,EAAYC,GAAQ,iBAAmB1V,OAEtCyV,EAAW,GACFve,SAAS8G,gBAAgB5G,EAAGuM,IAAK,cACvCgS,MACA,iBAAmB3V,UACd,SACN,OACG,cACE,sBACQ,SACR,aACD,sBAEL,oBAAqB4T,OAClB,eAAiBA,GAAUgC,oBAEjBH,EAAWE,KAChBJ,EAAmBM,YAAYJ,GAE9BjS,GAAE,kBAAoBxD,GAC9B8V,SAAS,WACRjR,OACGkR,sBAIPlc,GAAKC,MAEU2b,MACX5b,KACAC,UACK,WAGN2b,GAOID,GAAmB,eAC1BhO,EAAIkO,GAAQ,2BACXlO,OACYkO,GAAQ,uBACZG,YAAY3e,SAAS8G,gBAAgB5G,EAAGuM,IAAK,OACtD4H,GAAK,kCAEF/D,GAUIwO,GAAc,SAAUzK,OAC/BkK,EAAYC,GAAQ,iBAAmBnK,MACvCkK,SAAoBA,IAEZve,SAAS8G,gBAAgB5G,EAAGuM,IAAK,cACvCgS,MACA,iBAAmBpK,UACd,SACN,OACG,cACE,sBACQ,SACR,aACD,4BAEL,sBAAuBqI,OACpB,eAAiBA,GAAUqC,sBAEjBR,EAAWE,QACTnQ,OAAOiQ,GACnBA,GAQIS,GAAc,SAAU3K,OAC/B4K,EAAWT,GAAQ,YAAcnK,UACjC4K,MAEOjf,SAAS8G,gBAAgB5G,EAAGuM,IAAK,WAC3BwS,MACX,YAAc5K,SACV,sBACQ,QACT,6BAEU/F,OAAO2Q,GACnBA,IA8BIC,GAAmB,SAAUrR,OACjC1E,EAAe0E,EAAf1E,KAAML,EAAS+E,EAAT/E,WACP,OAAQK,GAAW,OAAQA,UAAgB,SAC3CgW,KAC2Bb,aAK3Bc,GAFOzR,GAAK0R,KAAKvW,EAAQ,GAAGK,KAEVA,GAEfwI,EAAI,EAAGA,EAAI,EAAGA,IAAK,KACpB0C,EAAKvL,EAAQ,IAAM6I,EAEnBsN,EAAWE,EAAI,IAAMxN,EAAI,SAAWqN,GAAY3K,GAEhD6J,EAAKN,GAAU/P,GAAMlL,EAAGwG,EAAK,IAAMwI,GAAI/O,EAAGuG,EAAK,IAAMwI,KACrD2N,EAAM1B,GAAU/P,GAAMlL,EAAGyc,EAASzN,EAAI,GAAGhP,EAAGC,EAAGwc,EAASzN,EAAI,GAAG/O,OAEpDqc,MACXf,EAAGvb,KACHub,EAAGtb,KACH0c,EAAI3c,KACJ2c,EAAI1c,UACC,aAGP,IAAM+O,EAAI,SAAWsN,MAGnBV,EAAYY,EAAI,IAAMxN,GAAKmN,GAAYzK,MAE5BkK,MACXL,EAAGvb,KACHub,EAAGtb,UACE,aAEP,IAAM+O,GAAK4M,SAEVY,GAWII,GAAiB,SAAUngB,EAAM0J,EAAO0W,EAAK5N,OAClD6N,EAAM7N,GAAQjE,GAAKiE,KAGnB/D,EAAM4R,EADC,mBAAqB1C,GAAU3d,IACtBqS,MAAMgO,EAAKD,MNnUU9R,IMsUrCxG,YAAY4G,YAAYD,EAAK/E,OAC5B,SACC4W,EAAUD,EAAIvY,YACdsK,EAAMkO,EAAQvY,cACdsW,KACG9L,EAAI,EAAGA,EAAIH,EAAKG,IAAK,KACtB+L,EAASgC,EAAQzP,QAAQ0B,KAC3BvI,KAAKsU,KAEHC,YACH,IAAIhM,EAAI,EAAGA,EAAIH,EAAKG,IACnBA,IAAM7I,IACAkH,WAAWnC,KAEXmC,WAAWyN,EAAI9L,MAYlBgO,GAAiB,SAAU9R,EAAK+R,OA1RTxgB,EAAMygB,EA2RjC/W,EAAS+E,EAAT/E,MACHgX,EAAUtB,GAAQ,WAAa1V,OAC9BgX,EAAS,KACNzB,EAAqBC,OAEjBte,SAAS8G,gBAAgB5G,EAAGuM,IAAK,WAC1BqT,MACX,WAAahX,UACR,YACH,cACE,sBACQ,QACT,wBACJ,eAEcwF,OAAOwR,MAGxBF,EAAQ,KACHvF,EAAQxM,EAARwM,SACFA,WACKtT,aAAa,UAAW,QACzB+Y,MAGH5B,EAAKN,GAAUvD,MAEN,EAAG,GAAI6D,EAAGvb,EAAGub,EAAGtb,GAAIkd,WAE7BN,GAxT0BpgB,EAwTTyO,EAAIzO,KAxTWygB,EAwTLhS,EAAI1E,KAvTzBsT,GAAQrd,GACT2gB,IAAI,SAACC,UACTH,EAAQG,MAsTNrO,EAAI,EAAGA,EAAI6N,EAAI5f,OAAQ+R,GAAK,EAAG,KAChCuM,EAAKN,GAAU/P,GAAMlL,EAAG6c,EAAI7N,GAAI/O,EAAG4c,EAAI7N,EAAI,OAC7CA,GAAKuM,EAAGvb,IACRgP,EAAI,GAAKuM,EAAGtb,KAGHiL,EAAIzO,KAAM,EAAGogB,EAAKM,UAE5BA,GAiBIG,GAAsB,SAAUC,EAAKC,EAAKjC,OAE/C7a,EAAK6c,EAAIvd,EAAIub,EAAGvb,EACpBW,EAAK4c,EAAItd,EAAIsb,EAAGtb,EAChBW,EAAK4c,EAAIxd,EAAIub,EAAGvb,EAChBa,EAAK2c,EAAIvd,EAAIsb,EAAGtb,OAEN,IAAPS,GAAmB,IAAPC,GAAqB,IAAPC,GAAmB,IAAPC,GAAW,KAElDS,EAAKgH,KAAKgL,KAAK5S,EAAKA,EAAKC,EAAKA,GAC9BY,EAAK+G,KAAKgL,KAAK1S,EAAKA,EAAKC,EAAKA,GAC9B4c,EAAOlD,GAAemD,aAAaC,iBACnCC,EAAOrD,GAAemD,aAAaC,iBACjCE,EAASvV,KAAKiR,MAAM5Y,EAAID,GAC1Bod,EAASxV,KAAKiR,MAAM1Y,EAAID,GACtBid,EAAS,OAAe,EAAIvV,KAAK8Q,IACjC0E,EAAS,OAAe,EAAIxV,KAAK8Q,QAE/B2E,EAAezV,KAAKuP,IAAIgG,EAASC,GACrCE,EAAY1V,KAAKuP,IAAIvP,KAAK8Q,GAAK2E,GAAgB,EAE7CE,SAAWC,gBACXL,EAASC,EAAS,KACRC,EAAezV,KAAK8Q,GAAMyE,EAASG,EAAcH,EAASG,IAC1DD,EAAezV,KAAK8Q,GAAM0E,EAASE,EAAcF,EAASE,MAE1DD,EAAezV,KAAK8Q,GAAMyE,EAASG,EAAcH,EAASG,IAC1DD,EAAezV,KAAK8Q,GAAM0E,EAASE,EAAcF,EAASE,KAInEhe,EAAIsB,EAAKgH,KAAKqR,IAAIsE,GAAa1C,EAAGvb,IAClCC,EAAIqB,EAAKgH,KAAKsR,IAAIqE,GAAa1C,EAAGtb,IAClCD,EAAIuB,EAAK+G,KAAKqR,IAAIuE,GAAa3C,EAAGvb,IAClCC,EAAIsB,EAAK+G,KAAKsR,IAAIsE,GAAa3C,EAAGtb,GAE/Bwd,EAAMG,KAQLO,yBAMEhY,EAAOK,kBACb4X,UAAW,OACXjY,MAAQA,OACRK,KAAOA,OACP/J,KAAO+J,EAAKtI,iBAEZmgB,gBACAC,OAAS,UACTC,OAAS,mDAOHte,OACN,IAAM+O,KAAK3Q,KAAKggB,QACfhgB,KAAKggB,QAAQG,eAAexP,SACzBqP,QAAQrP,GAAG5K,aAAa,UAAWnE,EAAI,SAAW,4CAShDA,MACT,kBAAoB5B,KAAK8H,MAAQ,sBAAwB9H,KAAK8H,MAAQ,MACrEuI,KAAK,OAAQzO,EAAI,OAAS,qCAOzBA,GACA5B,KAAKigB,cACFA,OAAOla,aAAa,UAAWnE,EAAI,SAAW,aAC9Cse,OAAOna,aAAa,UAAWnE,EAAI,SAAW,aAE9Cwe,YAAYxe,mCAQbA,GACF5B,KAAKigB,cACFA,OAAOla,aAAa,SAAUnE,EAAI,OAAS,aAC3Cse,OAAOna,aAAa,UAAWnE,EAAI,SAAW,QAC/C5B,KAAKggB,cACFK,YAAYze,QAEdme,SAAWne,0CAQbqe,OAlRmB,SAAUpT,EAAK+R,OAClC9W,EAAS+E,EAAT/E,MACDyV,EAAYH,GAAatV,MAE3B8W,EAAQ,KACJ1B,EAAKN,GAAU/P,MACJ0Q,MACXL,EAAGvb,KACHub,EAAGtb,UACE,kBAIN2b,EAqQS+C,CAAatgB,MAAM,QAC5BggB,QAAU9B,GAAiBle,WAC3BkgB,OAASvB,GAAe3e,MAAM,kCAO7BugB,MACFvgB,KAAKigB,OAAQ,KACT/C,EAAKN,GAAU5c,SACJA,KAAKigB,WAChB/C,EAAGvb,KACHub,EAAGtb,OAGM5B,MAAM,GAEjBA,KAAKggB,UACHO,SACGpY,KAAOwE,GAAKiE,KAAK1K,YAAY+I,QAAQjP,KAAK8H,YAC1C1J,KAAO4B,KAAKmI,KAAKtI,gBAEPG,qCAWjBgb,EAAIC,OACD9S,EAAQnI,KAARmI,KAEDqY,EAASxgB,KAAKggB,SACf7X,EAAKxG,GAAKqZ,EAAI7S,EAAKvG,GAAKqZ,EACzB9S,EAAK9F,GAAI8F,EAAK7F,GAAI6F,EAAK5F,IAAMyY,EAAI7S,EAAK3F,IAAMyY,IAE3C9S,EAAKxG,GAAKqZ,EAAI7S,EAAKvG,GAAKqZ,SAEdjb,KAAK5B,KAAM4B,KAAK8H,MAAO0Y,GAElCxgB,KAAKygB,MAAQzgB,KAAKygB,KAAKT,QAAS,KAC5BS,EAAOzgB,KAAKygB,KAAKtY,KACjBuY,GAAWD,EAAK9e,EAAG8e,EAAK7e,EAC5B6e,EAAKpe,IAAM2Y,EAAIyF,EAAKne,IAAM2Y,EAAIwF,EAAKle,GAAIke,EAAKje,OAC/BxC,KAAKygB,KAAKriB,KAAM4B,KAAKygB,KAAK3Y,MAAO4Y,MAG9C1gB,KAAK2gB,KAAM,KAGNxY,EAAQnI,KAAK2gB,KAAbxY,KACDqW,GAAOrW,EAAKxG,GAAKqZ,EAAI7S,EAAKvG,GAAKqZ,MACtBjb,KAAK2gB,KAAKviB,KAAM4B,KAAK2gB,KAAK7Y,MAAO0W,QAI7CI,QAAO,GACR5e,KAAKygB,WAAaA,KAAK7B,QAAO,qCAOzB9J,OACLjI,SAAK+T,SAAM1D,YACH,IAARpI,EAAW,MACN,MACD9U,KAAKygB,eAENzgB,KAAKmI,SACL,MACE,MACDnI,KAAKqZ,eAENxM,EAAI1E,SAGJA,EAAQ0E,EAAR1E,OACF,IAAMyY,GAAQ1D,EAAGvb,GAAKub,EAAGvb,EAAI3B,KAAKmI,KAAK,IAAM2M,MAC7C,IAAM8L,GAAQ1D,EAAGtb,GAAKsb,EAAGtb,EAAI5B,KAAKmI,KAAK,IAAM2M,QAE5C0J,GAAOrW,EAAKxG,EAAGwG,EAAKvG,EACxBuG,EAAK9F,GAAI8F,EAAK7F,GACd6F,EAAK5F,GAAI4F,EAAK3F,OAEDqK,EAAIzO,KAAMyO,EAAI/E,MAAO0W,KAChCI,QAAO,oCASH9J,EAAKkG,EAAIC,OACV9S,EAAQnI,KAARmI,OACF,IAAM2M,IAAQkG,IACd,IAAMlG,IAAQmG,MAEbuD,GAAOrW,EAAKxG,EAAGwG,EAAKvG,EACxBuG,EAAK9F,GAAI8F,EAAK7F,GAAI6F,EAAK5F,GAAI4F,EAAK3F,OAEnBxC,KAAK5B,KAAM4B,KAAK8H,MAAO0W,QACjCI,QAAO,mCAOLiC,EAASrC,MACDqC,EAAS7gB,KAAK8H,MAAO0W,QAC/BpgB,KAAOyiB,OACP1Y,KAAOwE,GAAKiE,KAAK1K,YAAY+I,QAAQjP,KAAK8H,YAC1CsY,YAAwB,IAAZS,QACZb,QAAU9B,GAAiBle,WAC3B4e,QAAO,YAOHkC,yBAKElQ,iBACNA,GAAyB,SAAjBA,EAAKmF,cACV,IAAInQ,MAAM,+DAGbgL,KAAOA,OACPyN,aACA0C,mBACE/gB,UAEFmc,mDAWHmB,MAAoB0D,KAAK,KAAK3E,KAAK,cACjCrc,MAAMqQ,KAAK,UAAW,cAGpBqO,EAAU1e,KAAK4Q,KAAK1K,YACpBsK,EAAMkO,EAAQvY,mBACfkY,aACA0C,qBACAE,UAAY,SAGZ,IAAItQ,EAAI,EAAGA,EAAIH,EAAKG,IAAK,KACtBxI,EAAOuW,EAAQzP,QAAQ0B,GACvBuQ,EAAU,IAAIpB,GAAQnP,EAAGxI,KACvBwE,KAAO3M,UACVqe,KAAKjW,KAAK8Y,WAGV7C,EAAQre,KAARqe,KAEH8C,EAAS,KACJxQ,EAAI,EAAGA,EAAIH,EAAKG,IAAK,KACtB9D,EAAMwR,EAAK1N,GACXyQ,EAAWzQ,EAAI,GAAMH,EAAM,KAAO6N,EAAK1N,EAAI,GAC3C0Q,EAAW1Q,EAAI,EAAK,EAAI,KAAO0N,EAAK1N,EAAI,MAC7B,IAAb9D,EAAIzO,KAAY,IACdijB,GAA4B,IAAjBA,EAAQjjB,KAAY,KAG3BkjB,EAAWjD,EAAK8C,KACbV,KAAOpC,EAAK8C,EAAS,KACrBV,KAAKpH,KAAOiI,IACZC,YAGF5Q,OACJ,GAAIyQ,GAA4B,IAAjBA,EAAQhjB,OAGxBqiB,KAAOpC,EAAK8C,EAAS,KAGrBV,KAAKpH,KAAOxM,IACZ8T,KAAOtC,EAAK8C,KACZI,UACkB,MAAlBvhB,KAAKihB,iBACFA,UAAYpU,QAEd,GAAKuU,EAeY,IAAbvU,EAAIzO,SAETmjB,UAGAH,GAA4B,IAAjBA,EAAQhjB,SACjBqiB,KAAOW,IACPX,KAAKpH,KAAOxM,YArBD,IAAbA,EAAIzO,KAAY,KAGZkjB,EAAWjD,EAAK8C,KACbV,KAAOpC,EAAK8C,EAAS,KACrBV,KAAKpH,KAAOiI,IACZC,YACLA,UAECvhB,KAAKihB,iBAEHA,UAAY5C,EAAK8C,YAcvBnhB,qCAaAoQ,WACDI,EAAMxQ,KAAKqe,KAAKzf,OACb+R,EAAI,EAAGA,EAAIH,EAAKG,IAAK,KAEhB,IADAP,EAAGoR,KAAKxhB,KAAKqe,KAAK1N,GAAIA,yCAS9B7I,OAEA+E,EAAM7M,KAAKqe,KAAKvW,MACjB+E,EAAIwM,UAEFA,EAAQxM,EAARwM,KACHkD,SAAQkF,SAAMC,gBACV7U,EAAI1E,KAAKtI,kBACZ,KACKgN,EAAI1E,KAAKxG,EAAI0X,EAAKlR,KAAKxG,GAAK,KAC5BkL,EAAI1E,KAAKvG,EAAIyX,EAAKlR,KAAKvG,GAAK,IAC3B5B,KAAK4Q,KAAKpM,0BAA0Bid,EAAMC,SAEnD,KAAK,MAECC,GAAOtI,EAAKlR,KAAKxG,EAAIkL,EAAI1E,KAAK9F,IAAM,EACpCuf,GAAO/U,EAAI1E,KAAK9F,GAAKwK,EAAI1E,KAAK5F,IAAM,EACpCsf,GAAOhV,EAAI1E,KAAK5F,GAAKsK,EAAI1E,KAAKxG,GAAK,EACnCmgB,GAAQH,EAAMC,GAAO,EACrBG,GAAQH,EAAMC,GAAO,KACnBC,EAAOC,GAAQ,MACjBC,GAAO3I,EAAKlR,KAAKvG,EAAIiL,EAAI1E,KAAK7F,IAAM,EACpC2f,GAAOpV,EAAI1E,KAAK7F,GAAKuK,EAAI1E,KAAK3F,IAAM,EACpC0f,GAAOrV,EAAI1E,KAAK3F,GAAKqK,EAAI1E,KAAKvG,GAAK,EACnCugB,GAAQH,EAAMC,GAAO,EACrBG,GAAQH,EAAMC,GAAO,KACnBC,EAAOC,GAAQ,IACdpiB,KAAK4Q,KAAKlM,gCAAgC+c,EAAMC,EAAMC,EAAKK,EAAKF,EAAMK,OACzE3D,GAAO3R,EAAI1E,KAAKxG,EAAGkL,EAAI1E,KAAKvG,EAAGmgB,EAAMK,EAAMP,EAAKK,MACvCrV,EAAIzO,KAAM0J,EAAO0W,MAKjBxe,KAAK4Q,KAAM2L,EAAQzU,sCAO3BA,OACH+E,EAAM7M,KAAKqe,KAAKvW,GAChB0U,EAAOxc,KAAK4Q,KAAK1K,cAEnBmc,MAAK,OACF5B,EAAQ5T,EAAR4T,QACH5T,EAAI8T,KAAM,KAENzD,GAAMuD,EAAKtY,KAAKxG,EAAG8e,EAAKtY,KAAKvG,MACpB,EAAG6e,EAAK3Y,MAAOoV,MAGf,EAAGrQ,EAAI/E,MAAOoV,KAExB9W,WAAWyG,EAAI8T,KAAK7Y,YACpB,GAAK+E,EAAIwM,OAOTjT,WAAW0B,OAPI,KAGdoV,GAAMuD,EAAKtY,KAAKxG,EAAG8e,EAAKtY,KAAKvG,MACpB,EAAGiL,EAAI4T,KAAK3Y,MAAOoV,KAC7B9W,WAAW0B,4CAUHA,OACXwa,GAAS,YAERC,QAAQ,SAAU5R,UACjBA,GAAK7I,GACS,IAAd9H,KAAK5B,OAIS,IAAd4B,KAAK5B,SAEE,GACF,aAIJkkB,gDAOcxa,OACf2F,EAAMzN,KAAK+gB,aAAayB,QAAQ1a,IACzB,IAAT2F,SAGC4Q,KAAKvW,GAAO2a,QAAO,QACnB1B,aAAa7Y,OAAOuF,EAAK,kDAOzB8U,QAAQ,gBAENE,QAAO,UAET1B,sDAOA2B,OAAS1iB,KAAK4Q,KAAK5K,aAAa,kCAOjCpE,eAEC2gB,QAAQ,gBAENF,KAAKzgB,KAERA,QACG+gB,SAAS3iB,KAAKihB,UAAUnZ,OAExB9H,qCASAgb,EAAIC,WACPtK,EAAI3Q,KAAK+gB,aAAaniB,OACnB+R,KAAK,CACE3Q,KAAKqe,KAAKre,KAAK+gB,aAAapQ,IACpCiS,KAAK5H,EAAIC,qCASPD,EAAIC,OACNpO,EAAM7M,KAAKqe,KAAKre,KAAK+gB,aAAa,MACpC8B,SAAS7iB,KAAK8iB,SAAU9H,EAAIC,GAC5Be,MACE+G,UAAU/iB,KAAK8iB,6CAQXjC,QACLmC,iBACDrS,EAAI3Q,KAAK+gB,aAAaniB,OACtB2O,SACGoD,KAAK,KACJsS,EAAQjjB,KAAK+gB,aAAapQ,GAG1BuS,EAAMljB,KAAKqe,KAAK4E,GACf5J,EAAQ6J,EAAR7J,QACFA,OAEAwH,IACI,6BAKgB,IAFPqC,EAAI9kB,KAEQ,EAAI,IAGxB+kB,OAAOtC,OAEXuC,EAAOF,EAAI/a,KAAKxG,EAChB0hB,EAAOH,EAAI/a,KAAKvG,EAChB0hB,EAAQjK,EAAKlR,KAAKxG,EAClB4hB,EAAQlK,EAAKlR,KAAKvG,EACpB4I,gBACIqW,QACH,KACCqC,EAAIM,QAAS,KACTC,EAAMP,EAAIM,WACNJ,EAAMC,EAAMI,EAAIphB,GAAIohB,EAAInhB,GAAImhB,EAAIlhB,GAAIkhB,EAAIjhB,QAC7C,KACCkhB,EAAQN,EAAOE,EACfK,EAAQN,EAAOE,KAaXH,EAAMC,EAJFC,EAASI,EAAQ,EACjBH,EAASI,EAAQ,EACjBP,EAAQM,EAAQ,EAChBL,EAAQM,EAAQ,SAIhC,KAAK,KACKP,EAAMC,KAGZG,QAAUN,EAAI/a,OAKhByb,QAAQ/C,EAASrW,OAElBqZ,WAAWtW,oCAQR2P,EAAI4G,QACPC,iBACK,MAAN7G,QACGqF,QAAQ,SAAU5R,GAEjB3Q,KAAKqZ,SACF1I,UAINqT,kBAAkB9G,GACnB4G,SACGhB,SAAWgB,EAEZ9H,SACGqC,KAAKnB,GAAI6F,UAAUe,yCAUrBlT,EAAQ5Q,KAAR4Q,YACH6G,GAAiB7G,SACdzB,OAASyL,GAAUhK,QACnBuM,QAAUnd,KAAKmP,OAAO8U,iBAEtB9U,OAAS,UACTgO,QAAU,WAGZoF,QAAQ,SAAU5R,QAChBxI,KAAOyI,EAAK1K,YAAY+I,QAAQ0B,QAChCiO,WAGA5e,wCAOGuN,GACNoC,QAA6BuU,OAAOlkB,KAAK4Q,UACvCmH,EAAM,IAAIb,GAAqBlX,KAAK4Q,MAAOrB,EAAGvP,KAAK0iB,QAASnV,MACnDsW,YAAY9L,MAAKnH,KAAM5Q,KAAK4Q,iDAO1BuT,GACZrT,MAAMC,QAAQoT,QAAuBA,QACrC,IAAIxT,EAAI,EAAGA,EAAIwT,EAAQvlB,OAAQ+R,IAAK,KACjC7I,EAAQqc,EAAQxT,GACV3Q,KAAKqe,KAAKvW,GACdmY,SACDjgB,KAAK+gB,aAAa/U,SAASlE,IAAUA,GAAS,QAC5CiZ,aAAa3Y,KAAKN,QAIxBiZ,aAAaqD,WACdzT,EAAI3Q,KAAK+gB,aAAaniB,OACpBylB,WACAzlB,OAAS+R,EAERA,KAAK,KACJuM,EAAKld,KAAK+gB,aAAapQ,GACvB9D,EAAM7M,KAAKqe,KAAKnB,KAClBuF,QAAO,KACL9R,GAAK9D,EAAIoT,WAGXqE,EAAgBtkB,KAAKukB,gBAAgBvkB,KAAK+gB,aAAa,OAC9CiD,mBAAmBK,QAAOC,2BAShCE,GAAW,SAAU5T,OAC5B+H,EAAIsD,GAASrL,EAAKyC,WACjBsF,MACCsD,GAASrL,EAAKyC,IAAM,IAAIyN,GAAKlQ,IAE5B+H,GAQI8L,GAAc,SAAUpR,GAC/BA,KAAM4I,WAAmBA,GAAS5I,IAGpCqR,UAAOC,UAAOC,UAAOC,UAAO1hB,UAE1B2hB,GAAa,SAAUnjB,EAAGC,OAC1BoZ,EAAKrZ,EAAIijB,GACT3J,EAAKrZ,EAAIijB,GAGTE,EAAI9a,KAAKgL,KAAK+F,EAAKA,EAAKC,EAAKA,GAC7B+J,EAAQ/a,KAAKiR,MAAMD,EAAID,GAAM7X,YAC5B4hB,EAAI9a,KAAKqR,IAAI0J,GAASJ,KACtBG,EAAI9a,KAAKsR,IAAIyJ,GAASH,MAMrBH,MACAC,KAEF1a,KAAKgL,KAAK+F,EAAKA,EAAKC,EAAKA,KACrBhR,KAAKiR,MAAMD,EAAID,GAAM7X,IAErBxB,EAAGojB,EAAI9a,KAAKqR,IAAI0J,GAASN,KAC5BK,EAAI9a,KAAKsR,IAAIyJ,GAASL,KAchBM,GAAoB,eACzBC,EAAcvY,GAAKiE,WACjB6G,GAAiByN,GAAa,QAGhCC,EAASxY,GAAKyY,WACZD,EAAOxjB,EAAIwjB,EAAOhX,MAAQ,KAC1BgX,EAAOvjB,EAAIujB,EAAOpX,OAAS,MAC/BsX,EAAMvX,GAAQoX,MACVG,EAAI1jB,EAAI0jB,EAAIlX,MAAQ,KACpBkX,EAAIzjB,EAAIyjB,EAAItX,OAAS,MAGvBiN,EAAK0J,GAAQE,GACjB3J,EAAK0J,GAAQE,GACbE,EAAI9a,KAAKgL,KAAK+F,EAAKA,EAAKC,EAAKA,GAC7B+J,EAAQ/a,KAAKiR,MAAMD,EAAID,GAAM7X,MAEvB4hB,EAAI9a,KAAKqR,IAAI0J,GAASJ,MACtBG,EAAI9a,KAAKsR,IAAIyJ,GAASH,WAExBrI,EAAO0I,EAAYhf,YAErByK,EAAI6L,EAAKrW,cACNwK,GAAG,IACH,MACC9D,EAAM2P,EAAKvN,QAAQ0B,GACvBvS,EAAOyO,EAAIhN,eACA,IAATzB,OAEEknB,EAAQR,GAAWjY,EAAIlL,EAAGkL,EAAIjL,GAClC4I,GAAU8a,EAAM3jB,EAAG2jB,EAAM1jB,MACb,MAAViL,EAAIxK,IAAwB,MAAVwK,EAAItK,GAAY,KAC9BgjB,EAAST,GAAWjY,EAAIxK,GAAIwK,EAAIvK,IAChCkjB,EAASV,GAAWjY,EAAItK,GAAIsK,EAAIrK,MAC/B0F,OAAOsC,EAAO5L,OAAQ,EAAG2mB,EAAO5jB,EAAG4jB,EAAO3jB,EAAG4jB,EAAO7jB,EAAG6jB,EAAO5jB,MAExDxD,EAAMuS,EAAGnG,MAGpBsD,GAAQoX,OAKRO,EAAMvJ,GAAemD,aAAatQ,qBACtC2K,EAAQhG,EAAiBwR,KACvBQ,UAAmB,IAARviB,GAAgB8G,KAAK8Q,GAAK2J,GAAOC,MAC1C7X,YAAY2Y,EAAK,KAoEnBE,IAAW,EAAG,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACpE,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAUxBC,GAAc,SAAUjZ,EAAMkZ,WACnCnH,EAAU/R,EAAKzG,YACfsK,EAAMkO,EAAQvY,cAChB2f,EAAO,EAAGC,EAAO,EACjBxW,EAAI,GACJyW,EAAQ,KAEHrV,EAAI,EAAGA,EAAIH,IAAOG,EAAG,KACtB9D,EAAM6R,EAAQzP,QAAQ0B,GAExBhP,EAAIkL,EAAIlL,GAAK,EACfC,EAAIiL,EAAIjL,GAAK,EACbS,EAAKwK,EAAIxK,IAAM,EACfC,EAAKuK,EAAIvK,IAAM,EACfC,EAAKsK,EAAItK,IAAM,EACfC,EAAKqK,EAAIrK,IAAM,EAEXpE,EAAOyO,EAAIhN,YACbomB,EAASN,GAAQvnB,GAAM,MAAQynB,EAAQ,QAAU,SAAW,iBAExDznB,QACH,KACE,IACD4nB,IAAUH,MACLG,EAAM,KACNA,EAAM,eAGZ,MACEF,OAEF,GACCD,MACMlkB,IACC,WAEJmkB,IAEI,QAGNI,GAAaD,IAAUtkB,EAAGokB,gBAE5B,MACEA,OAEF,GACCF,MACMjkB,IACC,WAEJmkB,IAEI,QAGNG,GAAaD,IAAUH,EAAMlkB,gBAE/B,OACA,OACA,MACEkkB,KACAC,OAEF,OACA,OACA,GACCF,MACMlkB,KACAC,SAEHkkB,OACAC,GAIM,IAAT3nB,GAAuB,IAATA,OAAuB0nB,EAAMC,OAE1CG,GAAaD,IAAUtkB,EAAGC,gBAE5B,KACEkkB,EAAMzjB,GAAMyjB,EAAMvjB,GAAMujB,KACxBC,EAAMzjB,GAAMyjB,EAAMvjB,GAAMujB,OAE1B,EACCF,MACMlkB,KACAC,IAEGS,GAAMyjB,EAAMvjB,GAAMujB,EAClBxjB,GAAMyjB,EAAMvjB,GAAMujB,OADxBD,OACAC,MAIFG,GAAaD,IAAU5jB,EAAIC,IAAMC,EAAIC,IAAMb,EAAGC,gBAEhD,KACEkkB,EAAMzjB,GAAMyjB,KACZC,EAAMzjB,GAAMyjB,OAEd,EACCF,MACMlkB,KACAC,IAEGS,GAAMyjB,EACNxjB,GAAMyjB,OADZD,OACAC,MAIFG,GAAaD,IAAU5jB,EAAIC,IAAMX,EAAGC,gBAEtC,MACEkkB,KACAC,OAEF,GACCF,MACMlkB,KACAC,SAEHkkB,OACAC,MAIFG,GAAaD,IAAUpZ,EAAI5J,GAAI4J,EAAI3J,MACtC2J,EAAI1J,MACH0J,EAAIzJ,aAAe,EAAI,EACvByJ,EAAIxJ,UAAY,EAAI,IACnB1B,EAAGC,eAEJ,MACEkkB,EAAMvjB,GAAMujB,KACZC,EAAMvjB,GAAMujB,OAEd,GACCF,MACMlkB,KACAC,IAEGW,GAAMujB,EACNtjB,GAAMujB,OADZD,OACAC,MAIFG,GAAaD,IAAU1jB,EAAIC,IAAMb,EAAGC,aAItC2N,GAYT,SAAS2W,GAAcD,EAAQzb,EAAQ2b,EAAYC,MAC/C/J,KAAK7R,EAAQ,SAAUmG,EAAG0V,KACnB1V,GAAKyD,GAAWiS,SAErBnF,EAAU+E,EAASzb,EAAOgH,KAAK,YAC/B2U,OACS,IAAMA,EAAW3U,KAAK,MAE/B4U,OACS,IAAMhS,GAAWgS,IAEvBlF,EASF,IACDoF,GACAC,GAAUC,GAEVtB,GACAuB,GALOC,IACPJ,IAAU,EACVC,UAAUC,UAEVtB,GAAc,KACduB,IAAW,sBAwFFE,EAAKC,EAAaC,EAAQC,OAC/BzT,YACoC,SAApC6I,GAAe6K,qBA+Ldpa,OAEAqW,aAGDgE,YACqB,sBAFjBL,EAAI9nB,OAAVwU,IAEKwB,OAAO,EAAG,IAA0B,GAEjClI,GAAKsa,OAASxM,SAASpH,EAAGwB,OAAO,IAAK,OACzCqS,UAAYL,EAAQC,OACnBja,EAAMF,GAAK0R,KAAK2I,GAIjBL,EAAIQ,SAKEta,EAAIkT,YACRqH,sBAAsBJ,MAEtBhD,kBAAkBgD,KAPnBra,GAAKoU,aAAaniB,QAAU,IAAMiO,EAAIkT,cACnCgE,oBAEFC,kBAAkBgD,SAMpB,GAAI3T,EAAGgU,WAAW,kBAAmB,IACrCH,UAAYL,EAAQC,OAEnBQ,EAAQjU,EAAGZ,MAAM,KAAK,GAAGA,MAAM,OAC7B0Q,OAAOmE,EAAM,QACfxD,EAAUX,OAAOmE,EAAM,OACxB3E,SAASqE,EAAOlD,OAIlBnX,GAAKua,SAAU,KACdK,EAAYrL,GAAesL,eACd,MAAbD,MACUrL,GAAeuL,aACzBvL,GAAewL,gBAAgBC,yBAG7B5K,EAAcb,GAAec,oBAClBuK,KACZV,EAAS9J,IACT+J,EAAS/J,QACL,SACC,UACC,UACR,gBA9OC6K,EAASf,EACTgB,EAASf,EAEP/J,EAAcb,GAAec,iBAC/Brb,EAAIimB,EAAS7K,EACfnb,EAAIimB,EAAS9K,EACb+K,EAAWtK,GAAQ,yBACT7b,EAAGC,GAEXsa,GAAe6L,sBACbC,GAAWrmB,KACXqmB,GAAWpmB,KACNomB,GAAWJ,KACXI,GAAWH,IAGjBC,MACQ9oB,SAAS8G,gBAAgB5G,EAAGuM,IAAK,WAC3Bqc,MACX,2BACI,sBACQ,WACV,WAEGtK,GAAQ,uBAAuBG,YAAYmK,MAE/C/hB,aAAa,UAAW,cAG7B+B,SAEAmgB,EAAY/L,GAAegM,kBAC1BD,EAeE,SAECrb,EAAUqb,EAAU/hB,YACtByK,EAAI/D,EAAQzG,cACVgiB,EAAO,EAAIpL,EACbqL,GAAe,EACZzX,GAAG,SAEFxI,EAAOyE,EAAQqC,QAAQ0B,GACvB0X,EAAKlgB,EAAKxG,EAAG2mB,EAAKngB,EAAKvG,KAEzBD,GAAM0mB,EAAKF,GAASxmB,GAAM0mB,EAAKF,GACjCvmB,GAAM0mB,EAAKH,GAASvmB,GAAM0mB,EAAKH,EAC/B,IACe,WAMdjM,GAAeqM,WAGRlV,OAENmV,EAAUhL,GAAQnK,GACpBkJ,SACAkM,SACEjY,EAAM5D,EAAQzG,iBAGhBiiB,EAAc,IAKZzX,GAAK,GAAKH,GAAO,EAAG,KAEhBkY,EAAO9b,EAAQqC,QAAQ,GAAGtN,EAC1BgnB,EAAO/b,EAAQqC,QAAQ,GAAGrN,IAGP,OADlBkmB,EAAS5hB,YAAY+I,QAAQ,IAC3BpP,YACEooB,EAAUzjB,0BAA0BkkB,EAAMC,GAE1CV,EAAUvjB,gCACjBgkB,EACAC,EACAF,EAAKpmB,GAAK0a,EACV0L,EAAKnmB,GAAKya,EACV2L,EACAC,OAIEC,EAASX,EAAU5jB,8BACjB2K,WAAWuN,KACXvN,WAAW4Z,QACd,GAAIpY,EAAM,SACR,QAGPsX,GAAUna,WAIAuO,GAAe2M,aAAa,SACzBC,YAAW,GAEtBxC,GAAS,CACP3Z,GAAKwC,WACQ4Z,aAAaP,KAAa7b,GAAKwC,OAAO8U,eAGjD+E,EAAOR,EAAQxiB,aAAa,KAC5BijB,EAAQ3d,GAAEqB,GAAKiE,MAAMP,KAAK,eAC9B1D,GAAKiE,MAAMP,KAAK,IAAK4Y,EAAQD,MAC7BR,GAAS7a,SACPhB,GAAKwC,qBAIG+Z,WAAWvc,GAAKiE,SACvB+R,YACE,OAGJ,KAEArX,GAAE6d,SACLjN,GAAekN,eACflN,GAAemN,eAAe1C,mBAGtB1P,IAAI,2BACL,MAGHnC,EAAMmT,EAAU/hB,YAAYC,cAC5BmjB,EAAOrB,EAAU/hB,YAAY+I,QAAQ6F,EAAM,GAC3CyU,EAAQD,EAAK3nB,EAAG6nB,EAAQF,EAAK1nB,KAE/B+kB,EAAIQ,SAAU,KACVsC,EAAM5O,GAAY0O,EAAOC,EAAO7nB,EAAGC,KAC/B6nB,EAAR9nB,IAAQ8nB,EAAL7nB,IAKkB,OADlBkmB,EAAS5hB,YAAY+I,QAAQ,IAC3BpP,YACEooB,EAAUzjB,0BACjB0X,GAAeb,MAAM1Z,GACrBua,GAAeb,MAAMzZ,IAGdqmB,EAAUvjB,gCACjBwX,GAAeb,MAAM1Z,GACrBua,GAAeb,MAAMzZ,GACrB6mB,EAAKpmB,GAAK0a,EACV0L,EAAKnmB,GAAKya,EACV0L,EAAKlmB,GAAKwa,EACV0L,EAAKjmB,GAAKua,KAIJ7W,YAAY8I,WAAWuN,MAE5BQ,KACAA,IAGIhX,aAAa,KAAM,IAAKpE,EAAGC,EAAGD,EAAGC,GAAG4P,KAAK,QAC1CsD,EACJwR,QAAoB3Z,GAAK0R,KAAKzf,WACrBkJ,EAAOnG,EAAGC,QArJX,KACR8nB,EAAQ,IAAM/nB,EAAI,IAAMC,EAAI,MACtBsa,GAAe2M,aAAa3M,GAAeyN,+BAC5C,kBACE,UAEND,KACCxN,GAAe0N,oBACV1N,GAAe2N,aAAe,QAIlC9jB,aAAa,KAAM,IAAK6hB,EAAQC,EAAQD,EAAQC,GAAQrW,KAAK,QAC9D8U,GAAU3Z,GAAK0R,KAAKzf,OAAS,KACxBkJ,EAAO8f,EAAQC,yBAwMvBD,EAAQC,OACX9K,EAAcb,GAAec,qBACxB,MACLiL,EAAY/L,GAAegM,kBACO,SAApChM,GAAe6K,oBA2Efpa,GAAKua,SAAU,KACXhK,EAAKD,MACNtQ,GAAKua,SAAS,KACdva,GAAKua,SAAS,IAChBva,IACGmd,EAAM7M,MACP2K,IACAC,GACFlb,IACG+W,EAAQoG,EAAInoB,EAAIub,EAAGvb,EACnBgiB,EAAQmG,EAAIloB,EAAIsb,EAAGtb,KACpBslB,UAAYU,EAAQC,GAErBlb,GAAKmW,YACFD,SAASa,EAAOC,MAEhBoG,QAAQrG,EAAOC,WAGjB5C,mBACAwB,QAAQ,SAAU5R,MACT3Q,KACHygB,MADGzgB,KACUqZ,UAIhB2Q,EADY9N,GAAesL,eACX1Z,UAEhBoP,EAAKN,GAPC5c,MAQNiqB,KACD/M,EAAGvb,IACHub,EAAGtb,QACC,SACC,GAGJsoB,EAAM1O,GAAewO,EAAKC,QAE3BxH,OAAOyH,GAERA,MAAYnJ,aAAa3Y,KAnBjBpI,KAmB0B8H,mBAlHnCmgB,aACCrb,EAAUqb,EAAU/hB,YACpB4B,EAAQ8E,EAAQzG,cAAgB,KAElCogB,GAAU,KAKN4D,EAAarM,GAAY,OACzBsM,EAAatM,GAAY,SAGpB/X,aAAa,KAAM6hB,KACnB7hB,aAAa,KAAM8hB,KACnB9hB,aAAa,UAAW,cAE7BskB,EAAM9D,GAAS,GACf+D,EAAM/D,GAAS,GAMfgE,EAAQF,GAAOA,EAFRzC,EAAS7K,GAGhByN,EAAQF,GAAOA,EAFRzC,EAAS9K,KAIXhX,aAAa,KAAMwkB,EAAOxN,KAC1BhX,aAAa,KAAMykB,EAAOzN,KAC1BhX,aAAa,UAAW,cAE7BkY,EAAWD,GAAY,SACZC,MACX2J,KACAC,KACA0C,EAAOxN,KACPyN,EAAOzN,UACF,WAGG,IAAVjV,MACW8f,EAAQC,OAChB,KACCyB,EAAO1c,EAAQqC,QAAQnH,EAAQ,GACjC2iB,EAAQnB,EAAK3nB,EACb+oB,EAAQpB,EAAK1nB,EAEQ,IAArB0nB,EAAKzpB,gBACG4qB,EAAQnB,EAAK/mB,MACbmoB,EAAQpB,EAAK9mB,IACdgkB,OACDA,GAAU,GAAKzJ,IACfyJ,GAAU,GAAKzJ,MAEV,EAAGjV,GAAQuiB,EAAKC,EAAKG,EAAOC,EAAOH,EAAMC,GAAOvC,QAE5D,KACCH,EAAWtK,GAAQ,wBACrBsK,EAAU,KACNzO,EAAOzM,EAAQqC,QAAQnH,MACJ,IAArBuR,EAAKxZ,YAAmB,KACpByjB,EAAQjK,EAAK1X,GAAK0X,EAAK1X,EAAI0X,EAAK9W,IAChCghB,EAAQlK,EAAKzX,GAAKyX,EAAKzX,EAAIyX,EAAK7W,OACvB,EAAG,GAAIolB,EAAQC,EAAQvE,EAAQvG,EAAawG,EAAQxG,EAAa6K,EAAQC,GAASC,QACxFtB,MACM,EAAG,GAAIoB,EAAQC,EAAQrB,GAAU,GAAIA,GAAU,GAAIoB,EAAQC,GAASC,MAEpE,EAAG,GAAIF,EAAQC,GAASC,wBA0DxCnB,EAAKgE,EAAS/C,EAAQC,OACvBI,EAAY/L,GAAegM,kBAEO,SAApChM,GAAe6K,2BACN,KACNkB,MACOzK,GAAQtB,GAAeqM,YAClBO,YAAW,MACd,aAIN,iBAMJvB,EAAYrL,GAAesL,kBAC7B7a,GAAKua,SAAU,KACX0D,EAASje,GAAKsa,UAEfC,UAAW,KACXpE,UAAW,KACXlE,SAED6H,OACG5C,WAAW,sBAGb8C,EAAIQ,UAAaV,OACf9D,SAASiI,QAEPrD,GAAmD,SAAtCA,EAAUvhB,aAAa,cAEnCD,aAAa,UAAW,QAE9BwhB,EAAUvhB,aAAa,UAAY,GAAKuhB,EAAUvhB,aAAa,WAAa,MAClE6kB,aAAalE,EAAI9nB,YAKnBgsB,aAAalE,EAAI9nB,YAEpB,uBAMD8rB,MACHnG,GAASmG,MACDG,eAAe,eACf/G,oBACV1B,MAAK,GAAMzD,YACXwG,QAAU2F,GAAape,GAAKiE,UACvB,yBAOEA,OACNoa,EAAWpa,IAASjE,GAAKiE,QAChBka,eAAe,aACzBzI,MAAK,OACI,KACC0B,iBAEXpX,GAAKwC,aAKL6b,OACaxJ,KAAK,YAAa5Q,OAClBqa,gBAAgBra,IAAO,yBAO9Bsa,GACNA,MAGaJ,eAAe,YACpB,OAEEnO,OAAM,MACNuM,WAAWvc,GAAKiE,wBAOxB/R,GACFqmB,KAAgBrmB,MACNqqB,WAAWrqB,MACRisB,eAAe,gBAGhBjsB,2BAQV+R,EAAOsL,GAAeiP,sBAAsB,MAC7Cva,GAES,IADA6G,GAAiB7G,QAGzBiI,EAAW,IAAIlB,GAAa,iBAC5BmB,KACDlI,EAAK5K,aAAa,eACV4K,EAAK5K,aAAa,gBAEtB+S,cAAc,IAAI7B,GAAqBtG,EAAMkI,OACvCiL,sBACVqH,iBAAiBxa,MAEPya,oBAAoBxS,MAG1BjI,GAAMyR,MAAK,GAAOlT,OAAS,UAE/BwN,WAEUsO,gBAAgBra,IAAO,MACvB4Q,KAAK,UAAWtF,GAAeiP,wCAOzCxd,OACCsa,EAAY/L,GAAegM,qBACnB,KACVD,EAAW,KACPrX,EAAO4M,GAAQtB,GAAeqM,YAClC/K,GAAQ,sBAAsB7P,YAC9BiD,GAAMjD,YACN6P,GAAQ,4BAA4BwD,KAAK,KAAK3Q,KAAK,UAAW,WACpD,QACGwY,aAAa,SACbC,YAAW,OACmB,aAApC5M,GAAe6K,uBACnB8D,eAEHle,OAAawP,OAAOkG,MAAK,8BAMb5D,MACL,MAAPA,GAAgC,SAAjBA,EAAI6M,gBAA8B,MAC/C5R,EAAQhG,EAAiB+K,GACzBlN,EAAIgJ,GAAyBb,GAAOvK,SACpCwN,UACFnF,gBAAgB,qBACdkH,EAAUD,EAAIvY,YAOdsK,EAAMkO,EAAQvY,yBAQXwK,OACD9D,EAAM6R,EAAQzP,QAAQ0B,GACtBvS,EAAOyO,EAAIhN,eACJ,IAATzB,uBACEogB,QACJnC,MAAM,GAAI,EAAG,GAAI,SAAUpL,EAAGsa,OACxB5pB,EAAIkL,EAAI,IAAM0e,GAAI3pB,EAAIiL,EAAI,IAAM0e,WAC5B9pB,IAANE,QAAyBF,IAANG,EAAiB,KAChCsb,EAAKlE,GAAerX,EAAGC,EAAG2P,KAC5BrJ,OAAOsW,EAAI5f,OAAQ,EAAGse,EAAGvb,EAAGub,EAAGtb,SAGxBxD,EAAMuS,EAAG6N,EAAKC,IAZtB9N,EAAI,EAAGA,EAAIH,IAAOG,IAAlBA,IAh4Bc,SAAUC,EAAMW,WACrCia,EAAKT,GAAana,GACfD,EAAI,EAAGA,EAAI,EAAGA,IAAK,KACpBvS,EAAa,IAANuS,EAAU,OAAS,SAC1B8a,EAAU7a,EAAK5K,aAAa5H,MAC9BqtB,GAAWA,EAAQpE,WAAW,QAAS,KACnCqE,EAAOC,GAAWF,MACH,mBAAjBC,EAAK3V,QAA8B,KACjC1T,EAAKqpB,EAAK1lB,aAAa,OAAS,EAChC1D,EAAKopB,EAAK1lB,aAAa,OAAS,EAChCzD,EAAKmpB,EAAK1lB,aAAa,OAAS,EAChCxD,EAAKkpB,EAAK1lB,aAAa,OAAS,IAG9BwlB,EAAGrd,MAAQ9L,EAAMmpB,EAAG7pB,IACpB6pB,EAAGzd,OAASzL,EAAMkpB,EAAG5pB,IACrB4pB,EAAGrd,MAAQ5L,EAAMipB,EAAG7pB,IACpB6pB,EAAGzd,OAASvL,EAAMgpB,EAAG5pB,MAGrBgqB,EAAM5S,GAAe3W,EAAIC,EAAIiP,GAC7Bsa,EAAM7S,GAAezW,EAAIC,EAAI+O,GAG7Bua,OAEEzpB,IAAMupB,EAAIjqB,EAAI6pB,EAAG7pB,GAAK6pB,EAAGrd,QACzB7L,IAAMspB,EAAIhqB,EAAI4pB,EAAG5pB,GAAK4pB,EAAGzd,SACzBxL,IAAMspB,EAAIlqB,EAAI6pB,EAAG7pB,GAAK6pB,EAAGrd,QACzB3L,IAAMqpB,EAAIjqB,EAAI4pB,EAAG5pB,GAAK4pB,EAAGzd,WAE3Bge,EAAUL,EAAKpd,WAAU,MAC7Byd,GAAS1b,KAAKyb,KAERzY,GAAK6I,GAAe0N,iBACjBtc,OAAOye,KACbhmB,aAAa3H,EAAM,QAAU2tB,EAAQ1Y,GAAK,SA22BnCoL,EAAKlN,0BAMqB,aAApC2K,GAAe6K,qBACZnI,sCAaDqE,EAAQtW,GAAKoU,aAAaniB,OAAS+N,GAAKoU,aAAa,GAAK,EAE1DlU,EAAMF,GAAK0R,KAAK4E,YAEjBpW,EAAI1E,KAAKxG,IACTkL,EAAI1E,KAAKvG,OACNiL,EAAIzO,kCAOK4tB,MACIA,+BAMhBhJ,iBAECiJ,EAAStf,GAAKoU,aAGhBpQ,EAAIsb,EAAOrtB,OACTstB,KAECvb,KAAK,KACJuM,EAAK+O,EAAOtb,MACbwb,OAAOjP,KAEP9U,KAAK8U,EAAKvM,KACVvI,KAAK8U,EAAKvM,EAAI,MAEhBwL,OAAO6H,kBAAkBkI,MAEzBrI,WAAW,uDAMVoI,EAAStf,GAAKoU,gBAEE,IAAlBkL,EAAOrtB,YAEJgS,EAAQjE,GAARiE,KACD4L,EAAO5L,EAAK1K,YAIZ4B,EAAQmkB,EAAO,GAEjBG,EAAS,KACTC,EAAY,WAGX9J,QAAQ,SAAU5R,UACH,IAAd3Q,KAAK5B,MAAcuS,GAAK7I,MACd9H,KAAKmI,MAEfwI,GAAK7I,IACS,IAAd9H,KAAK5B,QAEEuS,GACF,GAES,IAAd3Q,KAAK5B,SAEE,GACF,aAIG,MAAVguB,MAEOzf,GAAK0R,KAAKzf,OAAS,IAGf,IAAXwtB,EAAkB,KAId7P,EAAS3L,EAAKpM,0BAA0B6nB,EAAU1qB,EAAG0qB,EAAUzqB,GAE/D0qB,EAAS1b,EAAKvM,mCAChB+nB,IAAWzf,GAAK0R,KAAKzf,OAAS,KAC3BoQ,WAAWuN,KACXvN,WAAWsd,QAEC1b,EAAM0b,EAAQF,MACdxb,EAAM2L,EAAQ6P,YAG5BjQ,OAAOwG,SAASyJ,EAAS,MAUpBzf,GAAK0R,KAAKvW,GAEd6Y,cACDva,WAAW0B,KACX1B,WAAW0B,WACXqU,OAAOwG,SAAS7a,EAAQ,WAI3Bke,SAAOuG,SAGF5b,EAAI,EAAGA,EAAI6L,EAAKrW,cAAewK,IAAK,KACrCxI,EAAOqU,EAAKvN,QAAQ0B,MAED,IAArBxI,EAAKtI,cAEC8Q,OACH,GAAIA,IAAM7I,IAEV1B,WAAW4f,QAEX,GAAyB,IAArB7d,EAAKtI,aAAqBiI,EAAQ6I,EAAG,GAEvCA,EAAI,IACNvK,WAAWuK,kBAKhBmE,EAAOhN,EAAQke,EAAS,EAErBlR,QACYlE,EAAM4L,EAAKvN,QAAQ+W,GAAQuG,OAGxCrP,EAAKV,EAAKvN,QAAQ+W,MAGT,EAAGA,GAAQ9I,EAAGvb,EAAGub,EAAGtb,OAI9Bua,OAAOwG,SAAS,kCAMhB+D,GAAY8F,mBACZxJ,iBAECiJ,EAAStf,GAAKoU,aAEhBpQ,EAAIsb,EAAOrtB,OACR+R,KAAK,KACJuM,EAAK+O,EAAOtb,MACb8b,UAAUvP,MAID,SAAVwP,QACEhO,EAAU/R,GAAKiE,KAAK1K,YACtBsK,EAAMkO,EAAQvY,cAEZwmB,EAAW,SAAUlf,EAAKmf,QACvBA,OACGxmB,WAAWqH,OAInB+C,GAAO,SAAY,OAEhBA,KAAO,KACNrI,EAAOuW,EAAQzP,QAAQuB,MACJ,IAArBrI,EAAKtI,YAAmB,KACpBwZ,EAAOqF,EAAQzP,QAAQuB,EAAM,GAC7Bqc,EAAQnO,EAAQzP,QAAQuB,EAAM,MACX,IAArB6I,EAAKxZ,YAAmB,GACjB2Q,EAAM,EAAG,aAGb,GAA0B,IAAtBqc,EAAMhtB,YAAmB,GACzB2Q,EAAM,EAAG,mBAIf,GAAyB,IAArBrI,EAAKtI,aACV2Q,EAAM,EAAG,KACLsc,EAAWpO,EAAQzP,QAAQuB,EAAM,GAAG3Q,eAEzB,IAAbitB,EAAgB,GACTtc,EAAM,EAAG,aAIb,GAAiB,IAAbsc,GAAkBpO,EAAQvY,cAAgB,IAAMqK,EAAK,GACrDA,EAAK,sBAOf,KAML7D,GAAKiE,KAAK1K,YAAYC,eAAiB,YAC7B0kB,aAAale,GAAKiE,cACfmc,OAAOC,+BAInB7Q,UACA4H,iBAIDplB,OAAOmN,MAAO,KACVmhB,EAAK3hB,GAAEqB,GAAKiE,QACfP,KAAK,IAAK4c,EAAG5c,KAAK,SAElBwT,WAAW,gDAx4BW,SAAU8G,OACnCha,SACGnG,EAAUmgB,EAAVngB,OACD0iB,EAAI1iB,EAAOrE,iBACb+mB,GAAK,EAAG,KAcNC,EAAS3iB,EAAOyE,QAAQ,GAAIme,EAAY,KACxC7d,WACFnH,MAAM,IAAK+kB,EAAOxrB,EAAG,IAAKwrB,EAAOvrB,EAAG,MAAM4P,KAAK,KAC5Cb,EAAI,EAAGA,GAAMuc,EAAI,EAAIvc,GAAK,EAAG,KAC5BuO,EAAM1U,EAAOyE,QAAQ0B,GACnBwO,EAAM3U,EAAOyE,QAAQ0B,EAAI,GACzB0c,EAAM7iB,EAAOyE,QAAQ0B,EAAI,MAI3Byc,EAAW,KACPE,EAASrO,GAAoBmO,EAAWlO,EAAKiO,MAC/CG,GAA4B,IAAlBA,EAAO1uB,OAAc,KAC3B2uB,EAAUhe,EAAEA,EAAE3Q,OAAS,GAAG6T,MAAM,OAC9B,GAAK6a,EAAO,GAAG3rB,IACf,GAAK2rB,EAAO,GAAG1rB,IACrB2N,EAAE3Q,OAAS,GAAK2uB,EAAQ/b,KAAK,OACzB8b,EAAO,MAIfllB,MAAM8W,EAAIvd,EAAGud,EAAItd,EAAGud,EAAIxd,EAAGwd,EAAIvd,EAAGyrB,EAAI1rB,EAAG0rB,EAAIzrB,GAAG4P,KAAK,QAE9C6b,IACGlO,QAGZ/W,KAAK,KACAuI,EAAIuc,GAAG,KACNhQ,EAAK1S,EAAOyE,QAAQ0B,KACxBvI,MAAM8U,EAAGvb,EAAGub,EAAGtb,GAAG4P,KAAK,YAGvBjC,EAAEiC,KAAK,OAGD0K,GAAeyN,+BACd,kBACE,WAELzN,GAAeqM,iBAEb,iBAKLoC,uBAm1BK6C,MACL3P,WAAW2P,sBAORnd,EAAMod,OACRxB,EAAStf,GAAKoU,gBACfkL,EAAOrtB,WAEPokB,aAGCnW,EAAMF,GAAK0R,KAAK4N,EAAO,IACvByB,GAAQ/rB,EAAG,EAAGC,EAAG,KAClByO,GAAQod,EAAW5gB,EAAI1E,KAAKkI,KAE7BuS,KAAK8K,EAAK/rB,EAAG+rB,EAAK9rB,MACjBiiB,WAAW,qCAMVjT,WAIA8N,EAAU9N,EAAK1K,YACfsK,EAAMkO,EAAQvY,cAChB6f,SACKrV,EAAI,EAAGA,EAAIH,IAAOG,EAAG,KACtBxI,EAAOuW,EAAQzP,QAAQ0B,MACJ,IAArBxI,EAAKtI,gBACCsI,GAGe,IAArBA,EAAKtI,YAAmB,KACpBwZ,EAAOqF,EAAQzP,QAAQ0B,EAAI,MAC7B0I,EAAK1X,IAAMqkB,EAAMrkB,GAAK0X,EAAKzX,IAAMokB,EAAMpkB,EAAG,KAEtC2a,EAAS3L,EAAKpM,0BAA0BwhB,EAAMrkB,EAAGqkB,EAAMpkB,MAC5CgP,EAAM2L,EAAQ5L,MAEnBgd,OAAO/c,WAKrBjB,QAA6BuU,OAAOtT,qBCrlFxCtF,GAAIsiB,EAAYriB,QAGhBsiB,GAAS,oEAITC,GADW,4FACYrb,MAAM,KAG/ByJ,GAAiB,KACjB6R,GAAU,KACVC,GAAgB,KAChBC,GAAW,KA0EFC,GAAQ,SAAU9b,UAGtBA,EAAIG,QAAQ,KAAM,SAASA,QAAQ,KAAM,QAAQA,QAAQ,KAAM,QAAQA,QAAQ,KAAM,UAAUA,QAAQ,IAAK,WA2BxG4b,GAAW,SAAUC,QAExBC,GAAWD,GAEfzvB,OAAO2vB,YACF3vB,OAAO2vB,KAAKF,OAEfG,OACC3vB,OAA8C,EAArCqL,KAAKukB,OAAOJ,EAAMxvB,OAAS,GAAK,OAE5C+R,EAAI,EAAGgI,EAAI,IACZ,KACK8V,EAAOL,EAAMM,WAAW/d,KACxBge,EAAOP,EAAMM,WAAW/d,KACxBie,EAAOR,EAAMM,WAAW/d,KAExBke,EAAOJ,GAAQ,EACfK,GAAgB,EAAPL,IAAa,EAAME,GAAQ,EAEtCI,GAAgB,GAAPJ,IAAc,EAAMC,GAAQ,EACrCI,EAAc,GAAPJ,EAEP7mB,MAAM4mB,KACDK,EAAO,GACLjnB,MAAM6mB,OACR,MAGFjW,KAAOkV,GAAO9kB,OAAO8lB,KACrBlW,KAAOkV,GAAO9kB,OAAO+lB,KACrBnW,KAAOkV,GAAO9kB,OAAOgmB,KACrBpW,KAAOkV,GAAO9kB,OAAOimB,SACrBre,EAAIyd,EAAMxvB,eAEZ2vB,EAAO/c,KAAK,KASRyd,GAAW,SAAUb,MAC5BzvB,OAAOuwB,YACFC,GAAWxwB,OAAOuwB,KAAKd,MAIxBA,EAAM7b,QAAQ,mBAAoB,QAEtCgc,EAAS,GACT5d,EAAI,IAEL,KACKke,EAAOhB,GAAOrL,QAAQ4L,EAAMrlB,OAAO4H,MACnCme,EAAOjB,GAAOrL,QAAQ4L,EAAMrlB,OAAO4H,MACnCoe,EAAOlB,GAAOrL,QAAQ4L,EAAMrlB,OAAO4H,MACnCqe,EAAOnB,GAAOrL,QAAQ4L,EAAMrlB,OAAO4H,MAEnC8d,EAAQI,GAAQ,EAAMC,GAAQ,EAC9BH,GAAgB,GAAPG,IAAc,EAAMC,GAAQ,EACrCH,GAAgB,EAAPG,IAAa,EAAKC,KAEvBI,OAAOC,aAAaZ,GAEjB,KAATM,OACgBK,OAAOC,aAAaV,IAE3B,KAATK,OACgBI,OAAOC,aAAaT,UAEjCje,EAAIyd,EAAMxvB,eACZuwB,GAAWZ,IAQPY,GAAa,SAAUG,UAC3BC,mBAAmBC,OAAOF,KAStBjB,GAAa,SAAUiB,UAC3BG,SAASC,mBAAmBJ,KASxBK,GAAqB,SAAUC,MAChB,oBAAfC,YAA8C,oBAATC,MAAuC,oBAARC,MAAwBA,IAAIC,sBAClG,WAEHvT,EAAMmT,EAAQnd,MAAM,KAAMwd,EAAOxT,EAAI,GAAGnK,MAAM,WAAW,GAC7D4d,EAAOhB,KAAKzS,EAAI,IACd8O,EAAI2E,EAAKtxB,OACPuxB,EAAQ,IAAIN,WAAWtE,GACtBA,OACCA,GAAK2E,EAAKxB,WAAWnD,OAEvB6E,EAAO,IAAIN,MAAMK,IAAS/xB,KAAM6xB,WAC/BF,IAAIC,gBAAgBI,IAShBJ,GAAkB,SAAUI,UAClCA,GAAuB,oBAARL,KAAwBA,IAAIC,gBAGzCD,IAAIC,gBAAgBI,GAFlB,IAQEC,GAAsB,cACb,oBAATP,WACF,OAEHM,EAAO,IAAIN,MAAM,yEAA0E1xB,KAAM,qBAChG4xB,GAAgBI,GALU,GAmCtBE,GAAW,SAAUC,GAC5BA,EAAKvkB,SAAS,gBACTukB,EAAKhe,QAAQ,cAAe,OAAOA,QAAQ,YAAa,cAG7DuK,SAAK0T,gBAEC7xB,OAAO8xB,UAAa,IAAIA,UAAc,IAAI9xB,OAAO+xB,cAAc,qBAClEC,OAAQ,EACb,MAAOnhB,SACD,IAAI5J,MAAM,8CAGZ4qB,EAAKI,UACAJ,EAAKI,QAAQL,IAASC,EAEvBA,EAAKK,gBAAgBN,EAAM,YAEnC,MAAOO,SAAY,IAAIlrB,MAAM,mCACxBkX,GAkCIiU,GAAW,SAAXA,EAAqBngB,EAAMogB,MAClCpgB,GAA0B,IAAlBA,EAAKqgB,SAAgB,GAC1BrgB,WACDD,EAAIC,EAAKsgB,WAAWtyB,OACjB+R,OACIC,EAAKsgB,WAAW/oB,KAAKwI,GAAIqgB,KAiC3BG,GAAiB,SAAU1F,MAClCA,EAAS,IAEPA,EAAQpE,WAAW,gBACdoE,EAAQ2F,UAAU,EAAG3F,EAAQjJ,QAAQ,IAAK,OAG/CiJ,EAAQpE,WAAW,gBACdoE,EAAQ2F,UAAU,EAAG3F,EAAQjJ,QAAQ,IAAK,OAE/CiJ,EAAQpE,WAAW,eACdoE,EAAQ2F,UAAU,EAAG3F,EAAQjJ,QAAQ,aAGzC,MAQElL,GAAU,SAAU1G,UACtBA,EAAKygB,eAAenyB,EAAGoyB,MAAO,SAU5BC,GAAU,SAAU3gB,EAAMQ,KAC9BogB,eAAetyB,EAAGoyB,MAAO,aAAclgB,IAOjCqgB,GAAW,eAChBC,EAAaxV,GAAeyV,gBAC9BC,EAAOF,EAAWG,uBAAuB3yB,EAAGuM,IAAK,eACjDmmB,EAAKhzB,OAAS,IACTgzB,EAAK,MAELF,EAAWI,cAAchsB,gBAAgB5G,EAAGuM,IAAK,QACpDimB,EAAWK,aAEFxb,aAAaqb,EAAMF,EAAWK,WAAW9b,eAGzC3I,OAAOskB,IAGfA,GAYII,GAAc,SAAUrlB,WAC7BC,EAAUD,EAAKzG,YACf+rB,EAAMrlB,EAAQzG,cAEd+rB,UACAC,EAAQvlB,EAAQqC,QAAQ,GAC1BmjB,GAAMD,EAAMxwB,EAAGwwB,EAAMvwB,GAEhB+O,EAAI,EAAGA,EAAIshB,EAAKthB,IAAK,KACtB9D,EAAMD,EAAQqC,QAAQ0B,QAEdlP,IAAVoL,EAAIlL,MAGD,GAAGyG,KAAKgqB,EAAG,MACX,GAAGhqB,KAAKgqB,EAAG,IAEdvlB,EAAIxK,sBACAgwB,GAAMxlB,EAAIxK,GAAIwK,EAAIvK,IACtBgwB,GAAMzlB,EAAItK,GAAIsK,EAAIrK,IAClB+vB,GAAM1lB,EAAIlL,EAAGkL,EAAIjL,cAEVqP,OACDuhB,EAAO,SAAU7e,UACd1J,KAAKC,IAAI,EAAIyJ,EAAG,GAAKye,EAAGnhB,GAC7B,EAAIhH,KAAKC,IAAI,EAAIyJ,EAAG,GAAKA,EAAI0e,EAAGphB,GAChC,GAAK,EAAI0C,GAAK1J,KAAKC,IAAIyJ,EAAG,GAAK2e,EAAGrhB,GAClChH,KAAKC,IAAIyJ,EAAG,GAAK4e,EAAGthB,IAGlB5B,EAAI,EAAI+iB,EAAGnhB,GAAK,GAAKohB,EAAGphB,GAAK,EAAIqhB,EAAGrhB,GACpC7B,GAAK,EAAIgjB,EAAGnhB,GAAK,EAAIohB,EAAGphB,GAAK,EAAIqhB,EAAGrhB,GAAK,EAAIshB,EAAGthB,GAChD3B,EAAI,EAAI+iB,EAAGphB,GAAK,EAAImhB,EAAGnhB,MAEnB,IAAN7B,EAAS,IACD,IAANC,uBAGEsE,GAAKrE,EAAID,SACXsE,EAAI,GAAKA,EAAI,KACR1C,GAAG7I,KAAKoqB,EAAK7e,mBAIlB8e,EAAOxoB,KAAKC,IAAImF,EAAG,GAAK,EAAIC,EAAIF,KAClCqjB,EAAO,uBACL3jB,IAAOO,EAAIpF,KAAKgL,KAAKwd,KAAU,EAAIrjB,GACrCN,EAAK,GAAKA,EAAK,KAAYmC,GAAG7I,KAAKoqB,EAAK1jB,QACtC4jB,IAAOrjB,EAAIpF,KAAKgL,KAAKwd,KAAU,EAAIrjB,GACrCsjB,EAAK,GAAKA,EAAK,KAAYzhB,GAAG7I,KAAKoqB,EAAKE,KA3BrCzhB,EAAI,EAAGA,EAAI,EAAGA,MAAdA,KA6BJshB,QAEE,GAAGnqB,KAAKyE,EAAIlL,KACZ,GAAGyG,KAAKyE,EAAIjL,SAIjBD,EAAIsI,KAAKkQ,IAAI1J,MAAM,KAAMyhB,EAAO,IAChCrY,EAAI5P,KAAKoQ,IAAI5J,MAAM,KAAMyhB,EAAO,IAAMvwB,EACtCC,EAAIqI,KAAKkQ,IAAI1J,MAAM,KAAMyhB,EAAO,yBAK7BrY,SAJC5P,KAAKoQ,IAAI5J,MAAM,KAAMyhB,EAAO,IAAMtwB,IAiB9C,SAAS+wB,GAAY5S,MACf9P,eACW8P,EAASjS,UAAa,MAAO0B,QAEtCojB,EAAMtnB,GAAEunB,KAAK9S,EAAU,OACzB+S,EAAU,KACVC,SAAKC,SAELJ,KACKtnB,GAAEsnB,GAAKK,WAAWhrB,QAAQoI,KAAK,aAAc,aAClD4d,IAAU3gB,OAAO0lB,KACTA,EAAKE,OAAO,iBAEZ5nB,GAAEyU,GAAUiB,KAAK,kBAGzBmS,GAAQ,KACRL,EAAQl0B,YACFyd,KAAK,eACLmP,EAAKxrB,KAAK8N,UACX0d,EAAGrd,OAAUqd,EAAGzd,YACX,KAGRolB,EAAO,KACHrb,EAAQ8a,EAAMI,EAAO1nB,GAAEyU,GAAUkT,aACjCG,GAAetb,UAEfiI,EAASjS,iBAGXiS,EAASjS,iBAEb8kB,KACGjlB,SAEAolB,EAUF,IAAMjlB,GAAU,SAAU8C,OACzBmP,EAAWnP,GAAQsL,GAAemX,qBAAqB,MACvC,IAAlBziB,EAAKqgB,gBAAyB,WAC5BqC,EAASvT,EAASuL,SAEpByH,EAAM,YACFO,OACH,OAC0B,KAAzBvT,EAASvS,eACFA,YAAc,MACjBuS,EAASjS,YACNN,YAAc,IAEnBuS,EAASjS,YAAiBiS,EAASjS,qBAGtC,OP1X+BF,EO8X5BmS,EAASjS,YAAiBiS,EAASjS,aAFjCkkB,GAAYjS,aAKjB,QACA,MACG4S,GAAW5S,oBAIF,QAAXuT,MACIX,GAAW5S,IAEJ,QAAXuT,GAAgC,kBAAXA,GAA8B3jB,QAChDojB,MAAahT,EAASjS,YAItB6B,IAAY,KACT6b,OACHrd,MAAQ4kB,EAAI5kB,QACZJ,OAASglB,EAAIhlB,SACbpM,EAAIoxB,EAAIpxB,EAAIoR,WAAWgN,EAAS/Z,aAAa,MAAQ,KACrDpE,EAAImxB,EAAInxB,EAAImR,WAAWgN,EAAS/Z,aAAa,MAAQ,KAClDwlB,QAEH,GAAIsC,GAAY9hB,SAASsnB,MAC1BvT,QAEMA,EAASjS,UACf,MAAOf,OAGDwmB,EAASxT,EAASyT,gBAAgB,GAClCrlB,EAAQ4R,EAAS0T,6BAElBF,EAAO5xB,IACP4xB,EAAO3xB,iBAEF2xB,EAAOxlB,YAGd,KAEC2lB,EAAKpoB,GAAEyU,GAAU4T,QAAQ,iBAC3BD,EAAG90B,QACD80B,EAAG,GAAG5lB,YACF4lB,EAAG,GAAG5lB,mBAMlBilB,OA9TIpxB,KA+TUoxB,GAhUgBpxB,EACvBC,IAD0BA,EACvBuM,QAD0BA,MACnBJ,SAD0BA,SAoUxCglB,GAiBIa,GAAuB,SAAUC,OACxCtkB,EAAI,aAEN8M,KAAKwX,EAAc,SAAU5iB,kBAAI6iB,OAAYtV,UACxCsV,MACA,IAAInjB,EAAI,EAAGA,EAAI6N,EAAI5f,OAAQ+R,GAAK,KAC7B6N,EAAI7N,GAAK,IAAM6N,EAAI7N,EAAI,GAAM,MAIhCpB,GASIwkB,GAAsB,SAAUnjB,OAEvCkE,EAAM,KACNvF,SAAGH,SAAG4kB,SAAIC,gBACNrjB,EAAKmF,aACR,cACA,iBACCzK,GAAEsF,GAAMP,MAAM,KAAM,KAAM,KAAM,OAC7BoB,IAAAA,GAAIC,IAAAA,KACCtC,MAAV4kB,OAAIC,GACe,WAAjBrjB,EAAKmF,YACFke,EAAK3oB,GAAEsF,GAAMP,KAAK,QAGrBujB,KACD,KAAOniB,EAAKuiB,EAAMtiB,KAClB,KAAOD,EAAKuiB,EAAMtiB,EAAKuiB,EAAKnf,EAAOrD,EAAKuiB,EAAKlf,EAAOpD,EAAKuiB,EAAMxiB,EAAMC,EAAKuiB,KAC1E,KAAOxiB,EAAKuiB,EAAKlf,EAAOpD,EAAKuiB,EAAMxiB,EAAKuiB,EAAMtiB,EAAKuiB,EAAKnf,EAAOrD,EAAKuiB,EAAMtiB,KAC1E,KAAOD,EAAKuiB,EAAMtiB,EAAKuiB,EAAKnf,EAAOrD,EAAKuiB,EAAKlf,EAAOpD,EAAKuiB,EAAMxiB,EAAMC,EAAKuiB,KAC1E,KAAOxiB,EAAKuiB,EAAKlf,EAAOpD,EAAKuiB,EAAMxiB,EAAKuiB,EAAMtiB,EAAKuiB,EAAKnf,EAAOrD,EAAKuiB,EAAMtiB,KAC1E,oBAGA,SACCd,EAAK5K,aAAa,eAEnB,SAEC,OADAsF,GAAEsF,GAAMP,MAAM,KAAM,KAAM,KAAM,QACxBhO,GAAK,IAAM+M,EAAE9M,GAAK,IAAM8M,EAAE7M,GAAK,IAAM6M,EAAE5M,aAEhD,aACC,IAAMoO,EAAK5K,aAAa,oBAEzB,YACC,IAAM4K,EAAK5K,aAAa,UAAY,eAErC,WACG+e,EAAIzZ,GAAEsF,GAAMP,MAAM,KAAM,SAClB0U,EAAViP,KAAUjP,EAANkP,OACA5kB,EAAIuB,EAAK9C,UACRnM,EAAQ0N,EAAR1N,EAAGC,EAAKyN,EAALzN,EAAQiY,EAAIxK,EAAElB,MAAO2L,EAAIzK,EAAEtB,SAC/B,EAAI+G,IAaJ8e,GAXDI,GAAOC,IAYP,KAAMtyB,EAAGC,EAAIqyB,KACb,KAAMtyB,EAAGC,EAAIqyB,EAAKnf,EAAKnT,EAAIqyB,EAAKlf,EAAKlT,EAAGD,EAAIqyB,EAAIpyB,KAChD,KAAMD,EAAIkY,EAAIma,EAAIpyB,KAClB,KAAMD,EAAIkY,EAAIma,EAAKlf,EAAKlT,EAAGD,EAAIkY,EAAGjY,EAAIqyB,EAAKnf,EAAKnT,EAAIkY,EAAGjY,EAAIqyB,KAC3D,KAAMtyB,EAAIkY,EAAGjY,EAAIkY,EAAIma,KACrB,KAAMtyB,EAAIkY,EAAGjY,EAAIkY,EAAIma,EAAKnf,EAAKnT,EAAIkY,EAAIma,EAAKlf,EAAKlT,EAAIkY,EAAGnY,EAAIkY,EAAIma,EAAIpyB,EAAIkY,KACxE,KAAMnY,EAAIqyB,EAAIpyB,EAAIkY,KAClB,KAAMnY,EAAIqyB,EAAKlf,EAAKlT,EAAIkY,EAAGnY,EAAGC,EAAIkY,EAAIma,EAAKnf,EAAKnT,EAAGC,EAAIkY,EAAIma,KAC3D,KAAMtyB,EAAGC,EAAIqyB,KACb,WAlBA,KAAMtyB,EAAGC,KACT,KAAMD,EAAIkY,EAAGjY,KACb,KAAMD,EAAIkY,EAAGjY,EAAIkY,KACjB,KAAMnY,EAAGC,EAAIkY,KACb,KAAMnY,EAAGC,KACT,iBAqBA2N,GASI2kB,GAAqC,SAAUtjB,OACpDuG,eAGJkF,MAAM,eAAgB,aAAc,aAAc,SAAU,aAAc,eACpEjN,EAAIwB,EAAK5K,aAAahG,MACxBoP,MACIpP,MAAQoP,KAGX+H,GAWIgd,GAAyB,SAAUvjB,EAAM+Y,EAAuBjD,OACrE/Z,EAAOgd,WACF,YACHuK,GAAmCtjB,KAGrCwjB,EAAUxjB,EAAK5K,aAAa,aAC9BouB,KACGruB,aAAa,YAAaquB,OAG3Bxd,EAAShG,EAAKuF,WAChBvF,EAAKqF,cACFoe,OAAO1nB,KAELW,OAAOX,OAGV4C,EAAIwkB,GAAoBnjB,GAC1BrB,IACGxJ,aAAa,IAAKwJ,KAElB5B,WAIKyd,iBAAiBze,OACzB6e,GAAK,QAEF7e,EAAKmB,UACV,MAAO0B,aAGJ7B,SACE6d,GA4GF,IAAM8I,GAAuB,SAAU1jB,EAAM+Y,EAAuBjD,OAKrE8E,EAAK1d,GAAQ8C,OAEZ4a,SACI,SAGH9R,EAAQhG,EAAiB9C,GACzBzN,EAAQoxB,GAAkC7a,GAC1C8a,EAAiB/a,GAAmBC,MAEtCvW,GAASqxB,EAAgB,KACvBC,GAAS,KA/BjB,SAA8CtxB,EAAOsW,OAC7Cib,EAAgBvxB,EAAQ,UAGvBsW,KADUib,GAAiB,MAASA,EAAgB,MADzCA,GAAiB,OAASA,EAAgB,OA8BtDC,CAAoCxxB,EAAOqxB,GAAiB,KAG3C,UAAW,OAAQ,OAAQ,WAAY,WAC5CxoB,SAAS4E,EAAKmF,WACrB0e,EAASN,GAAuBvjB,EAAM+Y,EAAuBjD,QAC7D,GAAqB,SAAjB9V,EAAKmF,QAAoB,KAE5Bie,EAAKpjB,EAAK5K,aAAa,MACvBiuB,EAAKrjB,EAAK5K,aAAa,OACzBguB,GAAMC,OACHQ,EAASN,GAAuBvjB,EAAM+Y,EAAuBjD,SAKnE+N,EAAQ,KACJtlB,EAAUoL,GAAyBb,GAAnCvK,SACFwK,GAAa6R,EAAG7pB,EAAG6pB,EAAG5pB,EAAG4pB,EAAGrd,MAAOqd,EAAGzd,OAAQoB,GAAQylB,cAiBxDpJ,GAIT,SAASqJ,GAAwBjkB,OACzBkkB,EAAKlkB,EAAK5K,aAAa,uBACpB+B,MAAM+sB,IAAuC,SAAhClkB,EAAK5K,aAAa,UAAiC,EAAT8uB,EAAK,EAmBhE,IAAM1B,GAAiB,SAAUtb,EAAO6R,EAAuBjD,OAC/D5O,IAAUA,EAAMlZ,cAAiB,MAElCm2B,eACF1Y,KAAKvE,EAAO,WACRid,GACC/0B,KAAKmW,eACDme,GAAqBt0B,KAAM2pB,EAAuBjD,WAI9CjlB,IAAXszB,SAA+B,SAK/BC,EAAOD,EAAOpzB,EAAIozB,EAAO5mB,MACzB8mB,EAAOF,EAAOnzB,EAAImzB,EAAOhnB,OACzBmnB,EAAOH,EAAOpzB,EACdwzB,EAAOJ,EAAOnzB,KAGG,IAAjBkW,EAAMlZ,OAAc,KAChBw2B,EAASP,GAAuB/c,EAAM,OACpCsd,KACAA,KACAA,KACAA,UAEN/Y,KAAKvE,EAAO,SAAUnH,EAAGC,OACnBykB,EAAQf,GAAqB1jB,EAAM+Y,EAAuBjD,MAC5D2O,EAAO,KACHD,EAASP,GAAuBjkB,KAC/B3G,KAAKkQ,IAAI+a,EAAMG,EAAM1zB,EAAIyzB,KACzBnrB,KAAKkQ,IAAIgb,EAAME,EAAMzzB,EAAIwzB,GAEV,IAAlBxkB,EAAKqgB,aACAhnB,KAAKoQ,IAAI2a,EAAMK,EAAM1zB,EAAI0zB,EAAMlnB,MAAQinB,KACvCnrB,KAAKoQ,IAAI4a,EAAMI,EAAMzzB,EAAIyzB,EAAMtnB,OAASqnB,gBAMhDzzB,EAAIuzB,IACJtzB,EAAIuzB,IACJhnB,MAAQ6mB,EAAOE,IACfnnB,OAASknB,EAAOE,EAChBJ,GAWIO,GAAqB,SAAU1e,GACrCA,MACMtL,GAAE4Q,GAAeyV,iBAAiBsB,gBAGvCsC,eACJ3e,GAAQqc,WAAW5W,KAAK,SAAU1L,EAAGC,GACjCA,EAAK9C,WACM1F,KAAKwI,KAGf2kB,EAAaC,WASTC,GAA+B,SAAU3d,UAC/CA,MAAiBwd,MACflC,GACLtb,EACAoE,GAAeyN,sBACfzN,GAAewK,cAWN6N,GAAoC,SAAU7a,EAAOgc,OAC3Dhc,SAAgB,UACfwT,EAAIxT,EAAMvT,cACPwK,EAAI,EAAGA,EAAIuc,IAAKvc,EAAG,KACpBW,EAAQoI,EAAMzK,QAAQ0B,MACT,IAAfW,EAAMlT,YACDs3B,EAAQpkB,EAAMnO,MAAQ8G,KAAK8Q,GAAK,IAAQzJ,EAAMnO,aAGlD,GAUEsU,GAAmB,SAAU7G,EAAM8kB,OACtC3V,EAAWnP,GAAQsL,GAAeiP,sBAAsB,GAExDzR,EAAQhG,EAAiBqM,UACxBwU,GAAkC7a,EAAOgc,IASrC/J,GAAa,SAAUF,UAC3BjO,GAAQ2T,GAAe1F,GAAS5W,OAAO,KASnC2I,GP77B0BlR,EO87BnC,SAAU+G,UAEH4a,GAAS1hB,cAAc,IAAM8G,IP17BL7G,EO47B7B,SAAU6G,UAEH0a,GAAQthB,SACb,sCAAwC4G,EAAK,KAC7C2a,GACA,kBAAqB9uB,EAAGuM,KACxB,EACA,MAAMkqB,iBAER,SAAUtiB,UAEH/H,GAAE2iB,IAAUjN,KAAK,OAAS3N,EAAK,KAAK,IAYpCuiB,GAAmB,SAAUhlB,EAAMuG,EAAO0e,EAAeC,0CACzC3kB,OAAO9R,QAAQ8X,kDAAQ,wBAAtC7G,OAAKC,OACTwlB,EAA2B,SAArBzlB,EAAIuE,OAAO,EAAG,GACtB3V,EAAG82B,IACkB,WAArB1lB,EAAIuE,OAAO,EAAG,GAAkB3V,EAAGoyB,MAAQ,KAE3CyE,IACGvE,eAAeuE,EAAIzlB,EAAKC,GACnBulB,KAGEllB,EAAMN,EAAKC,KAFlBxK,aAAauK,EAAKC,mFAahB0lB,GAAiB,SAAUtL,OAChCuL,kBACY,iBACA,UACP,SACD,0BACY,yBACD,yBACD,wBACA,iBACF,KACZ,KACA,OASD,IAAM7lB,IANc,YAArBsa,EAAQW,kBAEH4K,EAASlC,UACTkC,EAASjC,IAGCiC,EAAU,KACrB9kB,EAAM8kB,EAAS7lB,GACjBsa,EAAQ3kB,aAAaqK,KAAU+e,OAAOhe,MAChCoG,gBAAgBnH,KAWjB2X,GAAa,SAAUzX,OAC5BkE,EAAOyH,GAAexH,cACxByhB,EAAWja,GAAeka,wBACjB,OAAT3hB,OACUN,IAAaM,MAEnBxK,KAAKoR,MAAM9K,EAAQ4lB,GAAYA,GAqB5BE,GAAsB,SAAUC,MACzCA,GAAKC,MAAM,SAAU/mB,KAAOzQ,oBCjvC1BuM,GAAIC,OAENirB,MAkEEC,GAAuC,SAAUC,GAChDvlB,OAAOiE,KAAKohB,IAAuB53B,WAGpC,iBAAiB0O,OAAO,8BAEtBqpB,EAAWD,EAASC,UAAY,MACpC,iBAAiBrpB,OAAO,kCAAoCopB,EAASrjB,GAAK,KAC1EqjB,EAASE,MAAQ,0BACjBD,EAAW,qBC1Ef,SAASE,GAAeC,EAAQrZ,IAC7B,KAAM,QAAS,QAAQne,QAAQ,SAAC0f,GAC3BA,KAAQvB,MACHuB,GAAQvB,EAAKuB,iDAiBnB,WAAuC+X,EAAKC,2GAC1CC,GAAgBF,OAASC,GAAQE,eAAe,qIAQlD,WAAgCH,SAAMI,IAAAA,OAAQD,IAAAA,mGAE1B,cAAev4B,QACrCA,OAAOy4B,YACqB,IAA7Bz4B,OAAOy4B,UAAUC,kDAEVC,GAAaP,OAAKt1B,GAAYy1B,0CAEjCK,GAAaR,mCACZp4B,OAAOw4B,kGAGT,SAASI,GAAcR,OAAKtZ,mEAC7B3M,MAAMC,QAAQgmB,GACTS,QAAQC,IAAIV,EAAIhY,IAAI,SAAC2Y,UACnBH,GAAaG,EAAGja,MAGpB,IAAI+Z,QAAQ,SAACG,EAASC,OACrBd,EAAS93B,SAAS64B,cAAc,UAChCC,EAAa,aACVC,QAAU,OACVC,OAAS,OACTrqB,WACAsqB,IAAM,MAERC,MAAQ,WACDpB,EAAQrZ,KACfsa,QAAU,aACR,IAAInyB,2BAA2BmxB,WAGjCiB,OAAS,sBAITC,IAAMlB,WAEJoB,KAAK7qB,OAAOwpB,KAIlB,SAASQ,GAAcP,OAAKtZ,0HAAYyZ,cAAAA,uBACzCpmB,MAAMC,QAAQgmB,GACTS,QAAQC,IAAIV,EAAIhY,IAAI,SAAC2Y,UACnBJ,GAAaI,EAAGja,MAGpB,IAAI+Z,QAAQ,SAACG,EAASC,OACrBQ,EAAS,iBAAmBnuB,KAAKouB,SAASC,SAAS,IAAIplB,MAAM,GAC7D4jB,EAAS93B,SAAS64B,cAAc,UAChCC,EAAa,kBACVn5B,OAAOy5B,KACPL,QAAU,OACVC,OAAS,OACTrqB,aACH4qB,gBAAgBzB,EAAOmB,OACpBA,IAAM,OAEDnB,EAAQrZ,KACfya,MAAQ,UACR95B,KAAO,WACP25B,QAAU,aACR,IAAInyB,2BAA2BmxB,WAGjCiB,OAAS,aACNr5B,OAAOy5B,aAIXI,yBA1GV,SAAwBzB,OAChB3nB,EAAIpQ,SAAS64B,cAAc,cAC/B9xB,aAAa,OAAQgxB,GAChB3nB,EAAEd,WAAU,GAAOmqB,KAsGTC,CAAc3B,GACgBxkB,QAAQ,KAAM,oBAAmB6lB,SAAYlB,EAAgB,gBAAkB,SACtH9G,EAAO,IAAIN,MAAM0I,IAAWp6B,KAAM,sBACjC65B,IAAMlI,IAAIC,gBAAgBI,YAExB+H,KAAK7qB,OAAOwpB,KCzGzB,IAAMxrB,GAAIC,OAYJotB,yBAUSp5B,EAAMq5B,EAAOC,qBACnBC,MAAQv5B,OACRw5B,OAASF,EAAU,KAAOD,EAE3BC,EAAS,KAELG,EAASH,EAAQ/G,mBAClBiH,OAASC,EAAOlzB,gBAAgB5G,EAAGuM,IAAK,SACvCwtB,EAAaD,EAAOlzB,gBAAgB5G,EAAGuM,IAAK,WACvC+B,YAAcjO,OACpBw5B,OAAOzrB,OAAO2rB,GACfL,KACAA,GAAOM,MAAMl5B,KAAK+4B,UAEZzrB,OAAOtN,KAAK+4B,WAIV/4B,KAAK+4B,WACV/4B,KAAK+4B,OAAQ,SAAUvpB,KAC5BzJ,aAAa,QAAS,iCAGrBgzB,OAAOhzB,aAAa,QAAS8yB,EAAU,qBAAuB,0EAQ5D74B,KAAK84B,gDAQL94B,KAAK+4B,+CAQPA,OAAOhzB,aAAa,QAAS,gEAQ7BgzB,OAAOhzB,aAAa,QAAS,0DAQxBozB,OACJC,OAAuB33B,IAAZ03B,GAAyBA,EAAU,SAAW,OAC5Cn5B,KAAK+4B,OAAO/yB,aAAa,aACzBozB,QACZL,OAAOhzB,aAAa,UAAWqzB,6CASS,SAAxCp5B,KAAK+4B,OAAO/yB,aAAa,oDAQ1BqzB,EAAUr5B,KAAK+4B,OAAO/yB,aAAa,kBACzB,OAAZqzB,QAAgC53B,IAAZ43B,EACf,EAEFtmB,WAAWsmB,sCASRA,GACa,iBAAZA,GAAwBA,GAAW,GAAOA,GAAW,QACzDN,OAAOhzB,aAAa,UAAWszB,0CASxBpG,OACT,IAAItiB,EAAI,EAAGA,EAAIsiB,EAASr0B,SAAU+R,OAChCooB,OAAOzrB,OAAO2lB,EAAStiB,sDAQxBH,EAAMxQ,KAAK+4B,OAAO7H,WAAWtyB,OAC1B+R,EAAI,EAAGA,EAAIH,IAAOG,EAAG,KACtB2oB,EAAQt5B,KAAK+4B,OAAO7H,WAAW/oB,KAAKwI,MACtC2oB,GAA2B,UAAlBA,EAAMvjB,eACVujB,SAGJ,qCASA/5B,EAAMg6B,OACPC,EAAex5B,KAAK84B,QACnB5K,GAAM3uB,OAEPk6B,EAAQz5B,KAAK05B,yBACfD,MACAA,GAAOE,UACHnsB,YAAcjO,OACfu5B,MAAQv5B,EACTg6B,KACQK,cAAcH,GAAQI,QAASL,IAEpCx5B,KAAK84B,OAEP,+CAUDF,EADS54B,KAAK+4B,OAAO5iB,WACNW,YAAY9W,KAAK+4B,oBACjCA,YAASt3B,EACPm3B,WAmBX,SAASkB,GAAelpB,OAChBmpB,EAAUnpB,EAAK5K,aAAa,SAClB,OAAZ+zB,QAAgCt4B,IAAZs4B,GAA0BA,EAAQn7B,OAE9C+5B,GAAMqB,YAAYzkB,KAAKwkB,MAC5Bh0B,aAAa,QAASg0B,EAAU,IAAMpB,GAAMsB,cAF5Cl0B,aAAa,QAAS4yB,GAAMsB,YAhBrCtB,GAAMsB,WAAa,QAKnBtB,GAAMqB,YAAc,IAAI1kB,OAAO,UAAYqjB,GAAMsB,WAAa,eCjKxDC,yBAMSC,kBACNC,aAAeD,OACfE,qBAAuB,UACvBC,0EAUY/sB,UACZvN,KAAKo6B,mBACLC,qBAAuB,IAAI1iB,GAAapK,QACxC+sB,mBAAmBlyB,KAAKpI,KAAKq6B,sBAC3Br6B,MAH0BA,mDAW5BA,KAAKo6B,oBAAuBp6B,QAC7BA,KAAKq6B,qBAAsB,KACvBE,EAAev6B,KAAKq6B,0BACrBC,mBAAmBE,UACjB57B,EAAUoB,KAAKs6B,mBAAf17B,YACFy7B,qBAAuBz7B,EAASoB,KAAKs6B,mBAAmB17B,EAAS,GAAK,UACtE67B,YAAYF,UAEZv6B,yCAWI4Q,EAAMiF,EAAgBC,EAAWvI,UACvCvN,KAAKo6B,mBACLK,YAAY,IAAI7kB,GAAmBhF,EAAMiF,EAAgBC,EAAWvI,IAClEvN,MAF0BA,2CAWpB4Q,EAAMrD,UACdvN,KAAKo6B,mBACLK,YAAY,IAAI9jB,GAAqB/F,EAAMrD,IACzCvN,MAF0BA,2CAapB4Q,EAAMiF,EAAgBC,EAAWvI,UACzCvN,KAAKo6B,mBACLK,YAAY,IAAI1jB,GAAqBnG,EAAMiF,EAAgBC,EAAWvI,IACpEvN,MAF0BA,2CAYpB4Q,EAAMuG,EAAO5J,UACrBvN,KAAKo6B,mBACLK,YAAY,IAAIvjB,GAAqBtG,EAAMuG,EAAO5J,IAChDvN,MAF0BA,yCAWtB+X,OACN/X,KAAKo6B,oBAAuBp6B,KAC7BA,KAAKq6B,0BACFA,qBAAqBthB,cAAchB,QAEnCqiB,aAAa/O,oBAAoBtT,YAQ5CmiB,GAAwBQ,WAAa,IAAIR,GCzIzC,IAAM5uB,GAAIC,OAEJovB,GAAW,4FAA4FloB,MAAM,KAE7GmoB,wBACiB,mBACH,kBACD,GAEfC,GAAUD,GAAeE,oBAEzBC,MAOJ,SAASC,GAAyBzB,UACzBA,GAAa,IAAIW,GAAwBe,GAAQC,SAqB1D,SAASC,GAAiBC,WACpBzqB,EAAI,EAEDyqB,EAAmBpvB,SAAU,SAAW2E,cACxC,SAAWA,MAMP0qB,yBAQExC,EAASyC,iBACfzC,IAAYA,EAAQ9iB,UAAY8iB,EAAQhoB,cACvB,QAApBgoB,EAAQ9iB,SAAqB8iB,EAAQhoB,eAAiB3R,EAAGuM,UACnD,IAAI7F,MAAM,iFAOb21B,SAAW1C,OAMX2C,QAAU,OAMVC,SAAWH,GAAe,YAM1BI,qBAQAC,mBAUAC,kBAMAC,cAAgB,UAMhBC,OAAS,OACRvQ,EAAIvrB,KAAKu7B,SAASlK,eAAenyB,EAAG68B,GAAI,SAGxCxQ,GAAKsP,KAAYD,GAAeoB,qBAC/BF,OAASvQ,EACLsP,KAAYD,GAAeqB,uBAC/BC,SAASjyB,KAAKukB,MAAsB,OAAhBvkB,KAAKouB,sDAQxBhlB,UACJrT,KAAKu7B,SAAShvB,cAETvM,KAAKu7B,SAAShvB,cAAc,IAAM8G,GAGpC/H,GAAEtL,KAAKu7B,UAAUva,KAAK,OAAS3N,EAAK,KAAK,+CAOzCrT,KAAKu7B,mDAOLv7B,KAAK87B,wCAOJvQ,QACHgQ,SAAS/J,eAAetyB,EAAGi9B,MAAO,WAAYj9B,EAAG68B,SACjDR,SAAS/J,eAAetyB,EAAG68B,GAAI,WAAYxQ,QAC3CuQ,OAASvQ,4CAUTuQ,OAAS,0CAQP97B,KAAK87B,OACR97B,KAAKy7B,SAAWz7B,KAAK87B,OAAS,IAAM97B,KAAKw7B,QACzCx7B,KAAKy7B,SAAWz7B,KAAKw7B,gDAQnBY,EAAYp8B,KAAKw7B,QACnBa,GAAmB,EAKnBr8B,KAAK07B,aAAa98B,OAAS,QACxB48B,QAAUx7B,KAAK07B,aAAalB,SACd,QAGdgB,kBAIHnoB,EAAKrT,KAAKuoB,QACPvoB,KAAKs8B,SAASjpB,IACfgpB,SACGb,QAAUY,KACI,QAEhBZ,YACAx7B,KAAKuoB,eAGR8T,SACGb,QAAUY,GAEV/oB,oCAUEA,OAEHkpB,EAAQv8B,KAAKy7B,UAAYz7B,KAAK87B,OAAS97B,KAAK87B,OAAS,IAAM,OAC/C,iBAAPzoB,IAAoBA,EAAGgU,WAAWkV,UACpC,MAGHznB,EAAM2F,SAASpH,EAAGwB,OAAO0nB,EAAM39B,QAAS,YAI3B,iBAARkW,GAAoBA,GAAO,GAAK9U,KAAK07B,aAAa1vB,SAAS8I,WAKjE4mB,aAAatzB,KAAK0M,IAEhB,iDAQA9U,KAAK27B,WAAW/8B,wCAQfW,eACwBkC,IAAzBzB,KAAK47B,UAAUr8B,wCAQVoR,UACLA,GAAK,GAAKA,EAAI3Q,KAAKw8B,eAAiBx8B,KAAK27B,WAAWhrB,GAAG8rB,UAAY,oDAOnEz8B,KAAK67B,cAAgB77B,KAAK67B,cAAca,WAAa,4CAO9Cn9B,OACRo9B,EAAQ38B,KAAK47B,UAAUr8B,UACtBo9B,EAAQA,EAAMD,WAAa,0DAS3B18B,KAAK67B,cAAgB77B,KAAK67B,cAAcY,UAAY,+CASxCl9B,EAAMg6B,OACrBqD,EAAY,QACZ58B,KAAK67B,cAAe,KAChBgB,EAAU78B,KAAK67B,cAAcY,aACvBz8B,KAAK67B,cAAciB,QAAQv9B,EAAMg6B,aAEpCv5B,KAAK47B,UAAUiB,QACjBjB,UAAUgB,GAAa58B,KAAK67B,sBAG9Be,kDAQgBG,OACjBC,EAAah9B,KAAKw8B,mBACnBx8B,KAAK67B,eAAiBkB,EAAS,GAAKA,GAAUC,SAC1C,SAGLC,aACCA,EAAS,EAAGA,EAASD,GACpBh9B,KAAK27B,WAAWsB,KAAYj9B,KAAK67B,gBADCoB,MAIpCA,IAAWD,SAAqB,QAEhCC,IAAWF,EAAQ,KAEfG,EAAel9B,KAAK67B,cAAca,WAClC7mB,EAAiBqnB,EAAajnB,YAEhCknB,EAAW,YACXJ,EAASE,EACPF,EAASC,EAAa,MACbh9B,KAAK27B,WAAWoB,EAAS,GAAGL,cAI9B18B,KAAK27B,WAAWoB,GAAQL,gBAEhCnB,SAAShlB,aAAa2mB,EAAcC,QAEpCC,sBACAC,gBAAgBr9B,KAAKs9B,aAAaP,6CAOlC,wCAOGxD,OACJ2D,EAAel9B,KAAK67B,cAAca,WAClCa,EAAYjyB,GAAE4xB,GAAc7jB,OAAO,MACpCkkB,KAEKC,kBAAkB,mBAEtBC,EAAmBP,EAAajnB,kBAC5BynB,cAAcR,EAAcO,EAAkBz9B,KAAKu7B,UAEtD2B,EAAanL,YAAY,KACxBuH,EAAQ4D,EAAanL,cACH,UAApBuH,EAAMqE,eAKJ9nB,EAAiByjB,EAAMrjB,cACnB3I,OAAOgsB,KACPsE,YAAYtE,EAAOzjB,EAAgBqnB,UANjCQ,cAAcpE,EAAOA,EAAMrjB,YAAainB,KAC5CvvB,cASLkuB,cAAcgC,kBAEb/1B,EAAQ9H,KAAK27B,WAAWnZ,QAAQxiB,KAAK67B,kBACvC/zB,EAAQ,EAAG,KACPvI,EAAOS,KAAK67B,cAAcY,eAC3BZ,cAAgB77B,KAAK27B,WAAW7zB,EAAQ,QACxC6zB,WAAWzzB,OAAOJ,EAAO,UACvB9H,KAAK47B,UAAUr8B,KAGdu+B,0DAOIvE,YAETsC,cAAgB77B,KAAK27B,WAAW37B,KAAK27B,WAAW/8B,OAAS,KAEpD4+B,kBAAkB,oBACrBx9B,KAAK27B,WAAW/8B,OAAS,QACzBm/B,WAAWxE,KAERuE,0DAUKv+B,OACTo9B,EAAQ38B,KAAK47B,UAAUr8B,WACzBo9B,IACE38B,KAAK67B,oBACFA,cAAcmC,kBAEhBnC,cAAgBc,OAChBd,cAAcoC,YACZ,mDAYLj+B,KAAK67B,eAAiB77B,KAAKw8B,eAAiB,EAAG,KAC3C0B,EAAgBl+B,KAAK67B,cAAcgC,0BACpCT,iBACEc,SAEF,mDASFvC,mBACAC,qBAjbsBhD,EAkbrBuF,EAAcn+B,KAAKu7B,SAASrK,WAAWtyB,OAEvCw/B,KAAcC,KAChB1B,EAAQ,KACR2B,GAAc,EACT3tB,EAAI,EAAGA,EAAIwtB,IAAextB,EAAG,KAC9B2oB,EAAQt5B,KAAKu7B,SAASrK,WAAW/oB,KAAKwI,MAExC2oB,GAA4B,IAAnBA,EAAMrI,YACK,MAAlBqI,EAAMvjB,QAAiB,IACX,MACRxW,EA5bP+L,GAAE,QADoBstB,EA6baU,GA5bjB/rB,SACtBmC,KAAakpB,EAAM2F,iBAEhBjzB,GAAEstB,EAAM2F,iBAAiB,UAAUhxB,OACnC,IAybMhO,KACS6I,KAAK7I,KACR,IAAIo5B,GAAMp5B,EAAM+5B,QACnBqC,WAAWvzB,KAAKu0B,QAChBf,UAAUr8B,GAAQo9B,KAGfv0B,KAAKkxB,QAENqB,GAAS3uB,SAASstB,EAAMhO,aAEzBljB,KAAKkxB,GAMf8E,EAAQx/B,OAAS,IAAM0/B,MACjB,IAAI3F,GAAMwC,GAAgBkD,GAAa,KAAMr+B,KAAKu7B,WACpDiD,eAAeJ,QAChBzC,WAAWvzB,KAAKu0B,QAChBf,UAAUr8B,MAAQo9B,KAEjBsB,gBAEHpC,cAAgBc,sCAWVp9B,EAAMg6B,GACbv5B,KAAK67B,oBACFA,cAAcmC,mBAGRv8B,IAATlC,GAA+B,OAATA,GAA0B,KAATA,GAAeS,KAAK47B,UAAUr8B,QAChE47B,GAAgBhqB,OAAOiE,KAAKpV,KAAK47B,iBAIpCe,EAAQ,IAAIhE,GAAMp5B,EAAM,KAAMS,KAAKu7B,iBAErChC,MACQiE,kBAAkB,kBAClBiB,cAAc9B,EAAMD,cACpBoB,wBAGPnC,WAAWvzB,KAAKu0B,QAChBf,UAAUr8B,GAAQo9B,OAClBd,cAAgBc,EACdA,EAAMD,8CAUHn9B,EAAMg6B,OACXv5B,KAAK67B,qBAAwB,UAC7BA,cAAcmC,mBAENv8B,IAATlC,GAA+B,OAATA,GAA0B,KAATA,GAAeS,KAAK47B,UAAUr8B,QAChE47B,GAAgBhqB,OAAOiE,KAAKpV,KAAK47B,qBAIpCsB,EAAel9B,KAAK67B,cAAca,WAClCC,EAAQ,IAAIhE,GAAMp5B,EAAM29B,EAAcl9B,KAAKu7B,UAC3C3C,EAAQ+D,EAAMD,WAGdzJ,EAAWiK,EAAahM,WACrBppB,EAAQ,EAAGA,EAAQmrB,EAASr0B,OAAQkJ,IAAS,KAC9C42B,EAAKzL,EAASnrB,GACC,UAAjB42B,EAAGf,aACDrwB,OAAOtN,KAAK2+B,SAASD,IAGzBnF,MACQiE,kBAAkB,qBAClBiB,cAAc7F,KACdkF,uBAINh2B,EAAQ9H,KAAK27B,WAAWnZ,QAAQxiB,KAAK67B,sBACvC/zB,GAAS,OACN6zB,WAAWzzB,OAAOJ,EAAQ,EAAG,EAAG60B,QAEhChB,WAAWvzB,KAAKu0B,QAElBf,UAAUr8B,GAAQo9B,OAClBd,cAAgBc,EACd/D,6CASWgG,OACZjC,EAAQ38B,KAAK47B,UAAUgD,WACtBjC,GAAQA,EAAMkC,uDAYHD,EAAWE,MACL,kBAAbA,SACF,SAEHnC,EAAQ38B,KAAK47B,UAAUgD,UACxBjC,KACCoC,WAAWD,GACVnC,EAAMD,YAFQ,6CAWNkC,OACTjC,EAAQ38B,KAAK47B,UAAUgD,UACxBjC,EACEA,EAAM9S,aADQ,6CAgBN+U,EAAWvF,QACH,iBAAZA,GAAwBA,EAAU,GAAOA,EAAU,QAGxDsD,EAAQ38B,KAAK47B,UAAUgD,GACzBjC,KACIqC,WAAW3F,qCASX4F,OACFC,EAAOl/B,YL2mBO,SAAX2+B,EAAqBM,EAAIrV,OAE9BuV,EAAQngC,SAAS8G,gBAAgBm5B,EAAGpuB,aAAcouB,EAAG3T,gBACzDjP,KAAK4iB,EAAGr4B,WAAY,SAAU+J,EAAGN,GACV,yBAAnBA,EAAKstB,aACDnM,eAAenhB,EAAKQ,aAAcR,EAAKib,SAAUjb,EAAKE,WAI1DiH,gBAAgB,QAChBnE,GAAKuW,IAIPja,KAA8B,SAAhBsvB,EAAG3T,SAAqB,KAClC8T,EAASxZ,GAAYqZ,KACrBl5B,aAAa,IAAKq5B,SAIxB/iB,KAAK4iB,EAAG/N,WAAY,SAAUvgB,EAAG2oB,UACzBA,EAAMrI,eACT,IACG3jB,OAAOqxB,EAASrF,EAAO1P,eAE1B,IACGpc,YAAc8rB,EAAM+F,aAO1B/zB,GAAE2zB,GAAIpM,KAAK,WACXsM,GAAOtM,KAAK,OAAQsM,EAAMpN,iBACvB,GAAIzmB,GAAE2zB,GAAIpM,KAAK,UAAW,KACzBD,EAAMtnB,GAAE2zB,GAAIpM,KAAK,aACrBsM,GAAOtM,KAAK,MAAOD,GAAKC,KAAK,SAAUD,OACd,UAAlBuM,EAAMppB,YACKopB,UAGfA,EKnpBEG,CAAaL,EADK,kBAAqBC,EAAKtV,uBAa1C2V,GAAe,SAAUC,EAAqBC,QACvB,IAAxBD,EACN5E,GAAeoB,gBACfpB,GAAeqB,oBAEHrB,GAAeqB,kBAAqBwD,EAAeC,WAExD7E,KAAYD,GAAeoB,iBAAmByD,EAAeC,cACvDC,eAFAzD,SAASjyB,KAAKukB,MAAsB,OAAhBvkB,KAAKouB,YAoExC4C,UAMS9e,GAAO,SAAU4Q,MAClBA,GAQCqQ,GAAiB,mBAEpBwC,oBAAoBxC,kBAoNjByC,GAAe,eACpBrvB,EAAMuqB,GAAcn8B,UACtB4R,EAAK,KACF,IAAIG,EAAI,EAAGA,EAAIH,EAAKG,IAAK,KACtBC,EAAOmqB,GAAcpqB,GACrBmvB,EAAO7E,GAAQ8E,OAAOnvB,EAAM,aACrB,IAATkvB,IACG/5B,aAAa,UAAW+5B,KAExBtoB,gBAAgB,aAElBzR,aAAa,QAAS,oCAGrBge,gBAAe,MACfvC,KAAK,aAAc,SAErBwe,gBAAgB,OAUbC,GAAa,SAAUrvB,QAEd,iBAATA,MACF4M,GAAQ5M,OAITovB,gBAAgBpvB,MAGtBA,GAAMsvB,aAAa,eAAeC,UAAUC,WAAW/jB,KAAK,eACtDgkB,EAAOrgC,KAAKgG,aAAa,YAAc,KAErC+5B,OAAO//B,KAAM,YAAaqgC,QAC7Bt6B,aAAa,UAAkB,IAAPs6B,QACxBt6B,aAAa,QAAS,2BACbqC,KAAKpI,WAGb+jB,oBACAvC,KAAK,aAAcyZ,GAAQqF,uGAtPV,SAAU/gC,EAAMg6B,OACnCgH,EAAWtF,GAAQ2E,oBAAoBY,YAC3CjhC,EACAy7B,GAAwBzB,OAElBxV,oBACAvC,KAAK,WAAY+e,gBAaD,SAAUhhC,EAAMg6B,OAElCgH,EAAWtF,GAAQ2E,oBAAoBa,WAAWlhC,EAAMy7B,GAAwBzB,OAE9ExV,yBAEAvC,KAAK,WAAY+e,wBAUO,eAC5BG,EAAezF,GAAQ2E,oBAAoBe,kBACxC1qB,EAAeyqB,EAAfzqB,YACDW,EAAS8pB,EAAavqB,gBACb8kB,GAAQ2E,oBAAoBgB,qBACzB,KACV/nB,EAAW,IAAIlB,GAAa,yBAEzBoB,cAAc,IAAIhC,GAAqB2pB,EAAczqB,EAAaW,OACnEyU,oBAAoBxS,MACpBkL,oBACAvC,KAAK,WAAY5K,KAClB,SAEF,mBAUsB,SAAUrX,OACjCiW,EAASylB,GAAQ2E,oBAAoBvC,gBAAgBnP,GAAM3uB,WAC7DiW,MACMuO,iBAEHvO,sBAYyB,SAAUqrB,OACpCC,EAAU7F,GAAQ2E,oBAClBjD,EAAQmE,EAAQH,qBAClBhE,GACamE,EAAQC,oBAAoBF,EAAS7F,gBAE1CxZ,KAAK,WAAYmb,KAClB,SAGJ,2BAY8B,SAAUqE,OAEzCxrB,EADUylB,GAAQ2E,oBACDqB,wBAAwBD,WAC3CxrB,OACM6V,oBAAoB,IAAIzV,GAAmBJ,EAAO0nB,aAAc1nB,EAAOK,eAAgBolB,GAAQtJ,mBAChG,uBAauB,SAAUiN,EAAWE,OAC/CgC,EAAU7F,GAAQ2E,oBAClBsB,EAAiBJ,EAAQK,mBAAmBvC,GAC5CjC,EAAQmE,EAAQM,mBAAmBxC,EAAWE,OAChDnC,SAIK,MAHD0E,EAAaH,EAAiB,SAAW,iBACvC7V,oBAAoB,IAAInU,GAAqBylB,GAAQ2E,QAASD,GAAa,qBAKjF1E,IAAUmE,EAAQH,uBACZ5c,oBACA2C,YAAY/J,UAGf,uBAU0B,SAAUiiB,OAGrCjC,EADU1B,GAAQ2E,oBACF2B,eAAe3C,OAChCjC,SAAgB,UAEf9jB,EAAW,IAAIlB,GAAa,0BAG5B6pB,EAAWvG,GAAQ9P,sBACrBxa,EAAI6wB,EAAS5iC,OACV+R,KAAK,KACJC,EAAO4wB,EAAS7wB,MACjBC,OACCiF,EAAiBjF,EAAKqF,YAEtBwrB,EAAW7wB,EAAKuF,aAChB7I,OAAOsD,KACJmI,cAAc,IAAInD,GAAmBhF,EAAMiF,EAAgB4rB,eAG9DpW,oBAAoBxS,IAErB,cAQiB,SAAU0gB,MAC1BqG,oBAAoB7B,WAAW/C,GAAwBzB,OACvDxV,yBAEA2d,mCAQoB,SAAUnI,MAC9BqG,oBAAoB+B,eAAe3G,GAAwBzB,OAC3DxV,yBAEA2d,6DCr8BJE,GAAaziC,IAGb0iC,OAEA,QAAS,YAAa,YAAa,OAAQ,eAAgB,YAAa,SAAU,KAAM,OAAQ,UAAW,SAAU,mBAAoB,oBAAqB,iBAAkB,kBAAmB,oBAAqB,iBAAkB,eAAgB,QAAS,iBAAkB,YAAa,aAAc,uBAC3S,QAAS,YAAa,YAAa,KAAM,KAAM,OAAQ,eAAgB,YAAa,SAAU,KAAM,OAAQ,UAAW,IAAK,mBAAoB,SAAU,mBAAoB,oBAAqB,iBAAkB,kBAAmB,oBAAqB,iBAAkB,eAAgB,QAAS,iBAAkB,uBACxT,QAAS,gBAAiB,qBAE7B,yBAEE,QAAS,YAAa,YAAa,KAAM,KAAM,OAAQ,eAAgB,YAAa,SAAU,KAAM,OAAQ,UAAW,mBAAoB,KAAM,KAAM,SAAU,mBAAoB,oBAAqB,iBAAkB,kBAAmB,oBAAqB,iBAAkB,eAAgB,QAAS,iBAAkB,6BAC1T,QAAS,8BAA+B,KAAM,mBAAoB,wBAC1E,QAAS,8BAA+B,YAAa,cAAe,SAAU,KAAM,iBAAkB,mBAAoB,QAAS,IAAK,aAAc,oBAC/I,QAAS,YAAa,SAAU,KAAM,UAAW,mBAAoB,QAAS,YAAa,QAAS,IAAK,QACrH,QAAS,YAAa,YAAa,KAAM,UAAW,OAAQ,eAAgB,YAAa,SAAU,OAAQ,UAAW,mBAAoB,SAAU,mBAAoB,oBAAqB,iBAAkB,kBAAmB,oBAAqB,iBAAkB,eAAgB,QAAS,iBAAkB,YAAa,cAAe,YAAa,aAAc,cAAe,sBACtX,QAAS,YAAa,YAAa,SAAU,SAAU,KAAM,OAAQ,UAAW,mBAAoB,QAAS,iBAAkB,YAAa,QAAS,IAAK,aAAc,cAAe,WACxL,QAAS,YAAa,YAAa,OAAQ,eAAgB,YAAa,SAAU,KAAM,aAAc,aAAc,eAAgB,OAAQ,UAAW,mBAAoB,SAAU,mBAAoB,oBAAqB,iBAAkB,kBAAmB,oBAAqB,iBAAkB,eAAgB,QAAS,iBAAkB,YAAa,KAAM,KAAM,KAAM,sBAC1W,QAAS,KAAM,oBAAqB,gBAAiB,mBAAoB,eAAgB,iBAAkB,KAAM,KAAM,aAAc,KAAM,cACnJ,KAAM,QAAS,eAAgB,cAAe,cAAe,SAAU,sBAAuB,OAAQ,OAAQ,iBAAkB,iBAClI,QAAS,SAAU,KAAM,mBAAoB,YAAa,QAAS,IAAK,eACpE,QAAS,YACb,QAAS,YAAa,YAAa,IAAK,OAAQ,eAAgB,YAAa,SAAU,KAAM,aAAc,aAAc,eAAgB,OAAQ,UAAW,mBAAoB,SAAU,mBAAoB,oBAAqB,iBAAkB,kBAAmB,oBAAqB,iBAAkB,eAAgB,QAAS,iBAAkB,sBACvV,QAAS,SAAU,KAAM,sBAAuB,mBAAoB,eAAgB,mBAAoB,QAAS,iBAAkB,UAAW,QAAS,IAAK,aAAc,cAC1K,QAAS,YAAa,YAAa,KAAM,OAAQ,eAAgB,YAAa,SAAU,KAAM,QAAS,aAAc,aAAc,eAAgB,OAAQ,UAAW,SAAU,mBAAoB,SAAU,mBAAoB,oBAAqB,iBAAkB,kBAAmB,oBAAqB,iBAAkB,eAAgB,QAAS,iBAAkB,uBAC7W,QAAS,YAAa,YAAa,KAAM,OAAQ,eAAgB,YAAa,SAAU,aAAc,aAAc,eAAgB,OAAQ,UAAW,SAAU,mBAAoB,SAAU,mBAAoB,oBAAqB,iBAAkB,kBAAmB,oBAAqB,iBAAkB,eAAgB,QAAS,iBAAkB,6BACzV,QAAS,KAAM,KAAM,KAAM,KAAM,oBAAqB,gBAAiB,KAAM,IAAK,mBAAoB,eAAgB,iBAAkB,oBAClJ,QAAS,YAAa,YAAa,OAAQ,eAAgB,YAAa,SAAU,SAAU,KAAM,OAAQ,UAAW,mBAAoB,KAAM,KAAM,SAAU,mBAAoB,oBAAqB,iBAAkB,kBAAmB,oBAAqB,iBAAkB,eAAgB,QAAS,iBAAkB,YAAa,QAAS,IAAK,WAC1V,QAAS,KAAM,SAAU,mBAAoB,aAAc,eAAgB,QAAS,uBACrF,QAAS,YAAa,YAAa,SAAU,KAAM,SAAU,OAAQ,sBAAuB,mBAAoB,QAAS,iBAAkB,UAAW,QAAS,IAAK,QAAS,WAAY,cAAe,aACrM,QAAS,KAAM,mBAAoB,0BACnC,QAAS,OAAQ,eAAgB,YAAa,SAAU,cAAe,YAAa,aAAc,cAAe,KAAM,UAAW,sBAAuB,mBAAoB,SAAU,mBAAoB,oBAAqB,iBAAkB,kBAAmB,oBAAqB,iBAAkB,eAAgB,QAAS,iBAAkB,YAAa,iBACtW,QAAS,YAAa,YAAa,OAAQ,eAAgB,YAAa,SAAU,cAAe,YAAa,aAAc,cAAe,KAAM,OAAQ,UAAW,mBAAoB,SAAU,mBAAoB,oBAAqB,iBAAkB,kBAAmB,oBAAqB,iBAAkB,eAAgB,QAAS,iBAAkB,cAAe,YAAa,IAAK,YAAa,eAC5Y,QAAS,KAAM,SAAU,mBAAoB,UAAW,cAAe,QAAS,iBAAkB,YAAa,8BAElH,QAAS,YAAa,YAAa,KAAM,KAAM,OAAQ,eAAgB,YAAa,SAAU,cAAe,YAAa,aAAc,cAAe,KAAM,OAAQ,UAAW,mBAAoB,SAAU,SAAU,mBAAoB,oBAAqB,iBAAkB,kBAAmB,oBAAqB,iBAAkB,eAAgB,QAAS,iBAAkB,cAAe,aAAc,YAAa,IAAK,YAAa,UACtb,QAAS,YAAa,YAAa,OAAQ,eAAgB,YAAa,SAAU,SAAU,KAAM,OAAQ,SAAU,mBAAoB,oBAAqB,iBAAkB,kBAAmB,oBAAqB,iBAAkB,eAAgB,QAAS,YAAa,QAAS,IAAK,aAAc,iBAGpS,8BACM,qBACT,aAAc,QAAS,mBAC1B,QAAS,KAAM,UAAW,mBACtB,6BAEH,qBACH,0CAGA,QAAS,SAAU,UAAW,UAAW,SAAU,8BAE9C,SAAU,QAAS,SAAU,QAAS,qDAIzC,aAAc,aAAc,uBAC1B,QAAS,SAAU,0BAEnB,eAAgB,iBAAkB,YAAa,cAAe,kDAI9D,QAAS,cAAe,cAAe,gBAAiB,eAAgB,eAAgB,YAAa,QAAS,WAAY,WAAY,aAAc,cACvJ,cAAe,aAAc,WAAY,yBAEzC,cAAe,0DAQjBC,MACN3wB,OAAO9R,QAAQwiC,IAAeviC,QAAQ,yBAAWyiC,OAAKtkB,OAC9CukB,YACC3iC,QAAQoe,GAAMne,QAAQ,yBAAc2iC,iBACrCA,EAAIj2B,SAAS,KAAM,KACfwhB,EAAIyU,EAAIxvB,MAAM,OACd+a,EAAE,IAAMtuB,EAAIsuB,EAAE,GAAIva,sBAElBgvB,GAAe,UAARA,EAAkB/iC,EAAGi9B,MAAQ,UAG9B4F,GAAOC,IAUlB,IAAME,GAAc,SAAdA,EAAwBC,MAEb,IAAlBA,EAAKlR,aAEFoO,UAAY8C,EAAK9C,UAAU9sB,QAAQ,aAAc,IAEjD4vB,EAAK9C,UAAUzgC,UACb+O,UAMa,IAAlBw0B,EAAKlR,cAIHmR,EAAMD,EAAKrQ,cACXlb,EAASurB,EAAKhsB,cAEfisB,GAAQxrB,OAIPyrB,EAAeR,GAAcM,EAAK7W,UAClCgX,EAAiBR,GAAgBK,EAAK7W,kBAEhB,IAAjB+W,EAA8B,SACjCE,KACF5xB,EAAIwxB,EAAKv7B,WAAWhI,OACjB+R,KAAK,KAGJN,EAAO8xB,EAAKv7B,WAAWuB,KAAKwI,GAC5B+H,EAAWrI,EAAKib,SAChBkX,EAAgBnyB,EAAKstB,UACrB8E,EAAYpyB,EAAKQ,gBAGjByxB,EAAeniB,eAAeqiB,IAAkBC,IAAcH,EAAeE,IAAkBC,IAAcvjC,EAAGi9B,OAClHsG,IAAcvjC,EAAGi9B,OAASyF,GAAWvxB,EAAKE,UAIxCmI,EAAS2O,WAAW,QAAU3O,EAAS2O,WAAW,aAC5Cjf,MAAMsQ,EAAUrI,EAAKE,UAE1BmyB,kBAAkBD,EAAWD,IAIhC5yB,WACM8I,OACH,gBACA,wBACA,uBACGtH,EAAMf,EAAKE,MAAMgC,QAAQ,SAAU,UACpCxM,aAAa2S,EAAUtH,MAMf,UAAbsH,EAAsB,SAClBiqB,EAAQtyB,EAAKE,MAAMkC,MAAM,KAC3BkG,EAAIgqB,EAAM/jC,OACP+Z,KAAK,OACUgqB,EAAMhqB,GAAGlG,MAAM,cAA5BlT,OAAM6R,OACPwxB,GAAiBrjC,GAAQ,IAAIsjC,OAC7BC,GAAgB1xB,GAAO,IAAIyxB,OAE7BR,EAAar2B,SAAS42B,MACnB78B,aAAa68B,EAAeE,KAGhCtrB,gBAAgB,iBAIlB1E,OAAOyvB,GAASjjC,QAAQ,yBAAE2iC,OAAK7wB,SAC/BogB,eAAetyB,EAAG68B,GAAIkG,EAAK7wB,SAK5BqnB,EAAOnhB,GAAQ6qB,MACjB1J,IACD,SAAU,iBAAkB,UAC3B,iBAAkB,WAAY,OAAOzsB,SAASm2B,EAAK7W,WAErC,MAAZmN,EAAK,QAEC0J,EAAM,MACTO,kBAAkBxjC,EAAGoyB,MAAO,SAKf,QAAlB6Q,EAAK7W,WAAuBhU,GAAQ6qB,iBACjCx0B,oBAKAmF,QAAQ,YAAa,OAAQ,SAAU,aAAc,aAAc,eAAgB,OAAQ,UAAW,SAAUzC,OACjHe,EAAM+wB,EAAKn8B,aAAaqK,GACxBe,MACI+f,GAAe/f,KAEC,MAAXA,EAAI,OACRrL,aAAasK,EAAM,MACnBmH,gBAAgBnH,QAMvB8xB,EAAKjR,WAAWtyB,OACb+R,OAAmBwxB,EAAKjR,WAAW/oB,KAAKwI,QAE1C,SAGCsiB,KACCkP,EAAKY,mBACD36B,KAAKwO,EAAOL,aAAa4rB,EAAKpQ,WAAYoQ,MAIhDx0B,iBAGDgD,EAAIsiB,EAASr0B,OACV+R,OAAmBsiB,EAAStiB,QC/NjCrF,GAAIC,OAGJoa,IAAW,EAAG,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IACpE,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAkBjCzJ,GAAiB,KAeR6M,GAAe,SAAUhJ,EAAUjH,EAASvH,WACjDyxB,EAAQ,SAAUrhC,EAAGC,UAAYoX,GAAerX,EAAGC,EAAG2P,IAC1D0xB,EAAS,SAAUppB,UAAYtI,EAAEnC,EAAIyK,GACrCqpB,EAAS,SAAUppB,UAAYvI,EAAEhC,EAAIuK,GACrCqpB,EAAajnB,GAAe6L,mBAAkE,QAA7ChI,EAAS5J,WAAWA,WAAWwnB,UAChFyF,EAAW,cACLD,MACG,IAAME,KAAKvqB,IACNuqB,GAAKrb,GAAWlP,EAAQuqB,OAGnBtjB,EAAUjH,EAAS,KAAM,IAE5CuM,EAAMvX,GAAQiS,GAEPpP,EAAI,EAAGA,EAAI,EAAGA,IAAK,KACpBvS,EAAa,IAANuS,EAAU,OAAS,SAC1B8a,EAAU1L,EAAS/Z,aAAa5H,MAClCqtB,GAAWA,EAAQpE,WAAW,UAC5B9V,EAAEnC,EAAI,GAAKmC,EAAEhC,EAAI,GAAG,KAEhBwc,EADOJ,GAAWF,GACHnd,WAAU,MAC3BiD,EAAEnC,EAAI,EAAG,KAEL/M,EAAK0pB,EAAQ/lB,aAAa,MAC1BzD,EAAKwpB,EAAQ/lB,aAAa,QACxBD,aAAa,OAAQ1D,EAAK,MAC1B0D,aAAa,OAAQxD,EAAK,OAGhCgP,EAAEhC,EAAI,EAAG,KAELjN,EAAKypB,EAAQ/lB,aAAa,MAC1BxD,EAAKupB,EAAQ/lB,aAAa,QACxBD,aAAa,OAAQzD,EAAK,MAC1ByD,aAAa,OAAQvD,EAAK,MAE5B6Q,GAAK6I,GAAeonB,aAAa1Z,iBAC9Btc,OAAOye,KACThmB,aAAa3H,EAAM,QAAU2tB,EAAQ1Y,GAAK,UAUnDkwB,EAASxjB,EAAShK,WACT,MAAXwtB,GAA6B,SAAXA,GAAgC,UAAXA,GAAiC,QAAXA,KAEnD,IAARhyB,EAAEnC,GAAmB,IAARmC,EAAElC,GAAmB,IAARkC,EAAEjC,GAAmB,IAARiC,EAAEhC,GAAoB,IAARgC,EAAE/B,GAAmB,IAAR+B,EAAE9B,EAOjE,KAEC+zB,EAAS9vB,EAAiBqM,GAC1B0jB,EAAKvnB,GAAemD,aAAatQ,uBACpC20B,UAAUxqB,GAAeqB,GAAyBipB,GAAQr0B,OAAQoC,MAC9DoL,UACA3N,WAAWy0B,OAb8D,KAG1EE,EAAWppB,GAAyBwF,GAAU5Q,OAClDy0B,EAAO1qB,GAAeyqB,EAAS1f,UAAW1S,EAAGoyB,KACvChiC,EAAIoR,WAAW+F,EAAQnX,GAAKiiC,EAAKp0B,IACjC5N,EAAImR,WAAW+F,EAAQlX,GAAKgiC,EAAKn0B,SAarC8zB,OACH,oBACA,WAEA,WAEY,UAAXA,IAAuBhyB,EAAEnC,EAAI,GAAKmC,EAAEhC,EAAI,GAAI,KAExCi0B,EAAS9vB,EAAiBqM,GAC1B0jB,EAAKvnB,GAAemD,aAAatQ,uBACpC20B,UAAUxqB,GAAeqB,GAAyBipB,GAAQr0B,OAAQoC,MAC9DoL,UACA3N,WAAWy0B,OACb,KACC7X,EAAMoX,EAAMlqB,EAAQnX,EAAGmX,EAAQlX,KAC7BuM,MAAQ80B,EAAOnqB,EAAQ3K,SACvBJ,OAASm1B,EAAOpqB,EAAQ/K,UACxBpM,EAAIiqB,EAAIjqB,EAAIsI,KAAKkQ,IAAI,EAAGrB,EAAQ3K,SAChCvM,EAAIgqB,EAAIhqB,EAAIqI,KAAKkQ,IAAI,EAAGrB,EAAQ/K,UAChCI,MAAQlE,KAAKuP,IAAIV,EAAQ3K,SACzBJ,OAAS9D,KAAKuP,IAAIV,EAAQ/K,kBAIpC,IAAK,cACCuB,EAAI0zB,EAAMlqB,EAAQrH,GAAIqH,EAAQpH,MAC5BD,GAAKnC,EAAE3N,IACP+P,GAAKpC,EAAE1N,IACPoyB,GAAKiP,EAAOnqB,EAAQkb,MACpBC,GAAKiP,EAAOpqB,EAAQmb,MACpBD,GAAK/pB,KAAKuP,IAAIV,EAAQkb,MACtBC,GAAKhqB,KAAKuP,IAAIV,EAAQmb,cAG9B,IAAK,aACC3kB,EAAI0zB,EAAMlqB,EAAQrH,GAAIqH,EAAQpH,MAC5BD,GAAKnC,EAAE3N,IACP+P,GAAKpC,EAAE1N,MAETiiC,EAAOlqB,GAAa0L,EAAI1jB,EAAG0jB,EAAIzjB,EAAGyjB,EAAIlX,MAAOkX,EAAItX,OAAQwD,GACzDsI,EAAIgqB,EAAK9pB,GAAGpY,EAAIkiC,EAAKvwB,GAAG3R,EAAGmY,EAAI+pB,EAAK7pB,GAAGpY,EAAIiiC,EAAKvwB,GAAG1R,IACjDmjB,EAAI9a,KAAKkQ,IAAIN,EAAI,EAAGC,EAAI,GAE5BhB,EAAQiM,MAAaA,EAAI9a,KAAKuP,IAAIV,EAAQiM,cAG9C,IAAK,WACC6G,EAAMoX,EAAMlqB,EAAQzW,GAAIyW,EAAQxW,IAChCupB,EAAMmX,EAAMlqB,EAAQvW,GAAIuW,EAAQtW,MAC9BH,GAAKupB,EAAIjqB,IACTW,GAAKspB,EAAIhqB,IACTW,GAAKspB,EAAIlqB,IACTa,GAAKqpB,EAAIjqB,MAEd,WACA,YACA,gBAGH,IAAK,QACCkiC,EAAOx4B,GAAEyU,GAAU8S,KAAK,QAC1BiR,MACeA,EAAMhrB,EAAS,KAAM,SAGxC,IAAK,eACF,kBACGtI,EAAMsI,EAAQtO,OAAO5L,OAClB+R,EAAI,EAAGA,EAAIH,IAAOG,EAAG,KACtBuM,EAAKpE,EAAQtO,OAAOmG,KACXqyB,EAAM9lB,EAAGvb,EAAGub,EAAGtb,GAAvBD,IAAAA,EAAGC,IAAAA,IACF4I,OAAOmG,GAAGhP,EAAIA,IACd6I,OAAOmG,GAAG/O,EAAIA,UAIpBmiC,EAAO,GACFpzB,EAAI,EAAGA,EAAIH,IAAOG,EAAG,KACtBuM,EAAKpE,EAAQtO,OAAOmG,MAClBuM,EAAGvb,EAAI,IAAMub,EAAGtb,EAAI,MAErBmE,aAAa,SAAUg+B,SAEhC,IAAK,WACCrlB,EAAUqB,EAAS7Z,YACrBsK,EAAMkO,EAAQvY,gBACVoJ,SACH,IAAIoB,EAAI,EAAGA,EAAIH,IAAOG,EAAG,KACtB9D,EAAM6R,EAAQzP,QAAQ0B,KACpBpB,EAAEoB,SACF9D,EAAIhN,cACPgN,EAAIlL,IACJkL,EAAIjL,KACHiL,EAAIxK,MACJwK,EAAIvK,MACJuK,EAAItK,MACJsK,EAAIrK,MACJqK,EAAI5J,MACJ4J,EAAI3J,SACD2J,EAAI1J,mBACG0J,EAAIzJ,uBACPyJ,EAAIxJ,aAIbyV,EAAQvJ,EAAE3Q,WACVolC,EAAWlrB,EAAQvJ,EAAE,GACzB00B,EAAYjB,EAAMgB,EAASriC,EAAGqiC,EAASpiC,KACjC2N,EAAE,GAAG5N,EAAIsiC,EAAUtiC,IACnB4N,EAAE,GAAG3N,EAAIqiC,EAAUriC,MACtB,IAAI+O,EAAI,EAAGA,EAAIH,IAAOG,EAAG,KACtB9D,EAAMiM,EAAQvJ,EAAEoB,MACP9D,EAARzO,KAGI,GAAM,EAAG,KAGZ8e,EAAK8lB,OAFcvhC,IAAVoL,EAAIlL,EAAmBkL,EAAIlL,EAAIsiC,EAAUtiC,OACnCF,IAAVoL,EAAIjL,EAAmBiL,EAAIjL,EAAIqiC,EAAUriC,GAE9CgqB,EAAMoX,EAAMn2B,EAAIxK,GAAIwK,EAAIvK,IACxBupB,EAAMmX,EAAMn2B,EAAItK,GAAIsK,EAAIrK,MAC1Bb,EAAIub,EAAGvb,IACPC,EAAIsb,EAAGtb,IACPS,GAAKupB,EAAIjqB,IACTW,GAAKspB,EAAIhqB,IACTW,GAAKspB,EAAIlqB,IACTa,GAAKqpB,EAAIjqB,IACTqB,GAAKggC,EAAOp2B,EAAI5J,MAChBC,GAAKggC,EAAOr2B,EAAI3J,WAEhBvB,EAAIshC,EAAOp2B,EAAIlL,KACfC,EAAIshC,EAAOr2B,EAAIjL,KACfS,GAAK4gC,EAAOp2B,EAAIxK,MAChBC,GAAK4gC,EAAOr2B,EAAIvK,MAChBC,GAAK0gC,EAAOp2B,EAAItK,MAChBC,GAAK0gC,EAAOr2B,EAAIrK,MAChBS,GAAKggC,EAAOp2B,EAAI5J,MAChBC,GAAKggC,EAAOr2B,EAAI3J,QAIpBghC,GAAO,KACLprB,EAAQvJ,EAAE3Q,WACX,IAAI+R,GAAI,EAAGA,GAAIH,IAAOG,GAAG,KACtB9D,GAAMiM,EAAQvJ,EAAEoB,IACfvS,GAAQyO,GAARzO,gBACCunB,GAAQvnB,IACRA,SACH,QACA,OACKyO,GAAIlL,EAAI,eAEb,QACA,OACKkL,GAAIjL,EAAI,eAEb,OACA,OACA,QACA,OACA,OACA,OACKiL,GAAIlL,EAAI,IAAMkL,GAAIjL,EAAI,eAE3B,OACA,MACKiL,GAAIxK,GAAK,IAAMwK,GAAIvK,GAAK,IAAMuK,GAAItK,GAAK,IAAMsK,GAAIrK,GAAK,IAC5DqK,GAAIlL,EAAI,IAAMkL,GAAIjL,EAAI,eAErB,OACA,MACKiL,GAAIxK,GAAK,IAAMwK,GAAIvK,GAAK,IAAMuK,GAAIlL,EAAI,IAAMkL,GAAIjL,EAAI,eAEzD,QACA,OACKiL,GAAI5J,GAAK,IAAM4J,GAAI3J,GAAK,IAAM2J,GAAI1J,MAAQ,MAAQ0J,GAAIzJ,aAC5D,MAAQyJ,GAAIxJ,UAAa,IAAMwJ,GAAIlL,EAAI,IAAMkL,GAAIjL,EAAI,eAEpD,QACA,OACKiL,GAAItK,GAAK,IAAMsK,GAAIrK,GAAK,IAAMqK,GAAIlL,EAAI,IAAMkL,GAAIjL,EAAI,OAKvDmE,aAAa,IAAKm+B,MCjSzB54B,GAAIsiB,EAAYriB,QAElB44B,UAoCSC,GAAiB,SAAU/zB,EAAMg0B,EAAIC,OAC1C33B,EAAOgf,GAAWtb,GAAM0hB,WACxBwS,EAAU7wB,EAAiB/G,GAC3B63B,EAAWL,GAAS9kB,aAAatQ,uBAC9B01B,aAAaJ,EAAIC,KAElBt1B,WAAWw1B,MAGG73B,IASX+3B,GAAwB,SAAxBA,EAAkC3kB,MAC7B,MAAZA,SAA2B,QAGL,QAAtBA,EAASuL,UAAsB3f,UAAUH,UAAUQ,SAAS,qBACvD,SAGHmB,EAAUg3B,GAAS9kB,aACnB3F,EAAQhG,EAAiBqM,MAG3BrG,GAASA,EAAMvT,cAAgB,EAAG,SAChCw+B,EAAIjrB,EAAMvT,cACRy+B,EAAMD,EACLA,KAAK,KACJrzB,EAAQoI,EAAMzK,QAAQ01B,MACT,IAAfrzB,EAAMlT,OACFgI,WAAWu+B,QAEZ,GAAmB,IAAfrzB,EAAMlT,SACX6a,GAAW3H,EAAMnC,QAAS,IAChB,IAARy1B,WAKOptB,gBAAgB,aAClB,OAEHpR,WAAWu+B,SAGK,IAAfrzB,EAAMlT,MACK,IAAhBkT,EAAMnO,SACFiD,WAAWu+B,MAKK,IAAxBjrB,EAAMvT,eACNsR,GAAiBsI,UAAoB,SAItCrG,GAAiC,IAAxBA,EAAMvT,uBAETJ,aAAa,YAAa,MAE1ByR,gBAAgB,aAElB,QAILkC,EAAO,SACLmrB,KACAF,EAAIjrB,EAAMvT,cACPw+B,KAAK,KACJrzB,EAAQoI,EAAMzK,QAAQ01B,GACT,IAAfrzB,EAAMlT,OACJgK,MAAMkJ,EAAMnC,OAAQw1B,IACfE,EAAIjmC,kBAIE,IAAfimC,EAAIjmC,OAAc,KACdkmC,EAAO33B,EAAQqN,6BAA6BtB,GAAe2rB,EAAI,GAAG,GAAIA,EAAI,GAAG,OAC7Ez+B,WAAWy+B,EAAI,GAAG,MAClBz+B,WAAWy+B,EAAI,GAAG,MAClB53B,iBAAiB63B,EAAMD,EAAI,GAAG,UAIlCnrB,EAAMvT,gBACD,GAAmC,IAA9BuT,EAAMzK,QAAQ01B,EAAI,GAAGvmC,MAA4C,IAA9Bsb,EAAMzK,QAAQ01B,EAAI,GAAGvmC,KAAY,KAC1EqlC,EAAKt2B,EAAQ4B,qBAEbwC,EAAI2H,GACRQ,EAAMzK,QAAQ01B,EAAI,GAAGx1B,OACrBuK,EAAMzK,QAAQ01B,EAAI,GAAGx1B,UACpBu0B,UAAUnyB,KACPnL,WAAWu+B,EAAI,KACfv+B,WAAWu+B,EAAI,KACf31B,WAAWy0B,WAKb1jB,EAAShK,aAEZ,WACA,eACA,cACA,wBAG0B,IAAxB2D,EAAMvT,eAAiD,IAA1BuT,EAAMzK,QAAQ,GAAG7Q,MACtB,IAAxBsb,EAAMvT,eAAiD,IAA1BuT,EAAMzK,QAAQ,GAAG7Q,MAAwC,IAA1Bsb,EAAMzK,QAAQ,GAAG7Q,YACzE,SAKL0lC,EAAOx4B,GAAEyU,GAAU8S,KAAK,QAGxBha,EAAW,IAAIlB,GAAa,aAG9BmB,KACAisB,EAAU,KACV5tB,YACI4I,EAAShK,aACZ,UACM,KAAM,KAAM,KAAM,gBAExB,YACM,KAAM,KAAM,eAElB,aACM,KAAM,KAAM,KAAM,gBAExB,oBACA,WAEA,WACM,QAAS,SAAU,IAAK,eAE9B,UACA,WACA,WACM,IAAK,eAEX,cACA,kBAEKvL,OAASuV,EAAS/Z,aAAa,cACjCwW,EAAOuD,EAASvV,OAChBgG,EAAMgM,EAAKrW,gBACTqE,OAAS,IAAIsG,MAAMN,OACtB,IAAIG,EAAI,EAAGA,EAAIH,IAAOG,EAAG,KACtBuM,EAAKV,EAAKvN,QAAQ0B,KAChBnG,OAAOmG,IAAMhP,EAAGub,EAAGvb,EAAGC,EAAGsb,EAAGtb,SAGtC,IAAK,cAEG2N,EAAIwQ,EAAS/Z,aAAa,OAC1BuJ,EAAIwQ,EAAS/Z,aAAa,KAIhCmR,EAAMvY,UACE0M,GAAEyU,GAAU1P,KAAK8G,MACzBkF,KAAKvD,EAAS,SAAUzI,EAAMe,KACtBf,GAAQuE,GAAavE,EAAMe,MAE5B0yB,SAGJx4B,GAAEw4B,GAAMzzB,KAAK,MAAQ,IACrB/E,GAAEw4B,GAAMzzB,KAAK,MAAQ,IAMb,MAAX00B,MACQz5B,GAAE05B,QAAO,KAAUlsB,MAC3BuD,KAAK0oB,EAAS,SAAU10B,EAAMe,KACtBf,GAAQuE,GAAavE,EAAMe,QAI/BxC,UAAYu1B,GAASc,qBAAuB,OAEhDC,SAAWC,YAGW,MAArBplB,EAAShK,UAAoB+tB,GAA8B,MAArB/jB,EAAShK,QAAiB,KAC7DsP,EAAMvX,GAAQiS,MAEPpe,EAAG0jB,EAAI1jB,EAAI0jB,EAAIlX,MAAQ,EAAGvM,EAAGyjB,EAAIzjB,EAAIyjB,EAAItX,OAAS,KACnDiL,GACVqM,EAAI1jB,EAAI0jB,EAAIlX,MAAQ,EACpBkX,EAAIzjB,EAAIyjB,EAAItX,OAAS,EACrBwM,GAAyBb,GAAOvK,YAE9BoC,EAAIpE,EAAQ+E,kBAGVkzB,EAAS3tB,GAAiBsI,MAC5BqlB,EAAQ,KACJh2B,EAAIg2B,EAASn7B,KAAK8Q,GAAK,IACzBuB,WACArS,KAAKuP,IAAIpK,GAAM,MACbnF,KAAKsR,IAAInM,IAAM,EAAInF,KAAKqR,IAAIlM,IAG5B,EAAIA,MAEL,IAAIuB,EAAI,EAAGA,EAAI+I,EAAMvT,gBAAiBwK,EAAG,KACtCW,EAAQoI,EAAMzK,QAAQ0B,MACT,IAAfW,EAAMlT,KAAY,KAEdinC,EAAK/zB,EAAMnC,SACPvN,GAAK0a,EAAI+oB,EAAG71B,EAAI61B,EAAG51B,GAAK,IACxB9N,GAAK0jC,EAAG71B,EAAI8M,EAAI+oB,EAAG51B,GAAK,IAC5BrJ,WAAWuK,eAKjBuc,EAAIxT,EAAMvT,cACZk+B,EAAK,EAAGC,EAAK,EAAGgB,EAAY,EAE5BC,SACArY,MACOxT,EAAMzK,QAAQ,GAAGE,YAGxBq2B,YAEAtY,GAAK,GAAmC,IAA9BxT,EAAMzK,QAAQie,EAAI,GAAG9uB,MACH,IAA9Bsb,EAAMzK,QAAQie,EAAI,GAAG9uB,MAA4C,IAA9Bsb,EAAMzK,QAAQie,EAAI,GAAG9uB,KAAY,GACxD,UAINqnC,EAAK/rB,EAAMzK,QAAQie,EAAI,GAAG/d,OAC9Bu2B,EAAKhsB,EAAMzK,QAAQie,EAAI,GAAG/d,OAC1Bw2B,EAAMjsB,EAAMzK,QAAQie,EAAI,GAAG/d,OAEvB8jB,EAAWlT,EAASmR,WACtB5hB,EAAI2jB,EAASr0B,OACV0Q,KAAK,KACJgqB,EAAQrG,EAAS9qB,KAAKmH,QACvB,IACA,EACkB,IAAnBgqB,EAAMrI,SAAgB,KAClB2U,EAAalyB,EAAiB4lB,OAG/BsM,eAECr0B,EAAIgJ,GAAyBqrB,GAAYz2B,OAkBzChM,EAAQsU,GAAiB6hB,QACX6K,GAASc,uBAEpBY,kBAAkBvM,EAAMtzB,aAAa,cAC1C7C,GAASsW,GAAmBmsB,GAAa,KACrCE,EAAM34B,EAAQ4B,uBAChB20B,UAAUxqB,GAAeusB,EAAIC,EAAIC,EAAKp0B,MAC/BoL,UACA3N,WAAW82B,OAGjB,KASCC,EAAM7sB,GAAe3H,EAAE0S,UAAW0hB,EAAKp0B,GAEvCmhB,EAAKvlB,EAAQ+E,oBAChB1C,GAAKu2B,EAAIv2B,IACTC,GAAKs2B,EAAIt2B,MAINu2B,EAAK9sB,GAAewZ,EAAGzO,UAAW1S,EAAE0S,UAAWwhB,EAAIC,EAAIC,EAAKp0B,EAAGw0B,EAAI9hB,WAEnEgiB,GAAkB94B,EAAQ4B,qBAC9Bm3B,GAAQ/4B,EAAQ4B,qBAChBo3B,GAAgBh5B,EAAQ4B,wBACV01B,aAAasB,EAAIv2B,EAAGu2B,EAAIt2B,MAClC22B,SAASJ,EAAG52B,EAAG42B,EAAGz2B,MACVk1B,aAAa/R,EAAGljB,EAAGkjB,EAAGjjB,KACzBT,WAAWm3B,MACXn3B,WAAWk3B,MACXl3B,WAAWi3B,MAOfltB,cAAc2rB,EAAsBpL,OAgBpCuM,kBAAkBL,MAIzBp/B,WAAW8mB,EAAI,KACf9mB,WAAW8mB,EAAI,KACf9mB,WAAW8mB,EAAI,QAChB,GAAIA,GAAK,GAAmC,IAA9BxT,EAAMzK,QAAQie,EAAI,GAAG9uB,KAAY,GACxC,IACRmc,GAAyBb,GAAOvK,WAC9B22B,GAAM34B,EAAQ4B,wBAChB20B,UAAUnyB,KACRoL,UACA3N,WAAW82B,SAIZ,IAAW,IAAN5Y,GAAYA,EAAI,GAA+B,IAA1BxT,EAAMzK,QAAQ,GAAG7Q,OACtB,IAA1Bsb,EAAMzK,QAAQ,GAAG7Q,KAAY,GACjB,MACNioC,GAAM9rB,GAAyBb,GAAOvK,SACtC/I,WAAW,OACXkgC,GAAO/rB,GAAyBb,GAAOvK,OAAO8U,UAC9CsiB,GAAKrtB,GAAeotB,GAAMD,SAE3BE,GAAG/2B,IACH+2B,GAAG92B,EAEG,IAAP40B,GAAmB,IAAPC,EAAU,SAElBrR,GAAWlT,EAASmR,WACtB5hB,GAAI2jB,GAASr0B,OAEb4nC,MAEGl3B,MAAK,KACJgqB,GAAQrG,GAAS9qB,KAAKmH,OACL,IAAnBgqB,GAAMrI,SAAgB,IAEpBqI,GAAMtzB,aAAa,aAAc,KAE7BqK,GAAOipB,GAAMtzB,aAAa,aAC3BwgC,GAAcx6B,SAASqE,SACXA,GAAMg0B,EAAIC,MACXl8B,KAAKiI,OAIH8zB,GAASc,uBACpBY,kBAAkBvM,GAAMtzB,aAAa,kBAExC4/B,GAAalyB,EAAiB4lB,OAEhCsM,GAAY,KACRpB,GAAWr3B,EAAQ4B,wBAChB01B,aAAaJ,EAAIC,GACtBsB,GAAWz/B,iBACF8G,iBAAiBu3B,GAAU,MAE3Bx1B,WAAWw1B,MAEfzrB,cAAc2rB,EAAsBpL,aAIvCmN,GAAO1mB,EAAS8R,uBAAuB3yB,EAAGuM,IAAK,OAC/CgtB,GAAO,IAAMa,GAAMjmB,GACrBqkB,GAAI+O,GAAK7nC,OACN84B,MAAK,KACJgP,GAAUD,GAAKt+B,KAAKuvB,OACtBe,KAASnhB,GAAQovB,IAAU,KACvBC,GAAWx5B,EAAQ4B,wBAChB01B,cAAcJ,GAAKC,KACXoC,IAASz5B,iBAAiB05B,GAAU,KAC5C5tB,cAAc2rB,EAAsBgC,SAGxCb,kBAAkBL,cAMxBK,kBAAkBL,QAIxB,CAAA,GAAU,IAANtY,GAAqC,IAA1BxT,EAAMzK,QAAQ,GAAG7Q,MAAegnC,EAkC/C,IACDA,EAAQ,KACJwB,GAASz5B,EAAQ4B,wBAChB2W,UAAU0f,EAAQD,EAAUxjC,EAAGwjC,EAAUvjC,GAC5C8X,EAAMvT,gBACF8G,iBAAiB25B,GAAQ,KAEzB53B,WAAW43B,WAGO,IAAxBltB,EAAMvT,iBACCqR,gBAAgB,aAEpB,OA9CK,UACNjG,GAAImI,EAAMzK,QAAQ,GAAGE,OACzB8jB,GAAWlT,EAASmR,WAClB5hB,GAAI2jB,GAASr0B,OACV0Q,MAAK,KACJgqB,GAAQrG,GAAS9qB,KAAKmH,OACL,IAAnBgqB,GAAMrI,SAAgB,GACJkT,GAASc,uBACpBY,kBAAkBvM,GAAMtzB,aAAa,kBACxC4/B,GAAalyB,EAAiB4lB,QAE/BsM,gBAECiB,GAAK3tB,GAAe3H,GAAGgJ,GAAyBqrB,IAAYz2B,QAC5D23B,GAAM35B,EAAQ4B,wBAChB20B,UAAUmD,OACHlqB,WACA3N,WAAW83B,GAAK,KAElB/tB,cAAc2rB,EAAsBpL,QACpCuM,kBAAkBL,OAIrB1Q,GAAKwE,GAAMtzB,aAAa,mBACO,SAAjCszB,GAAMtzB,aAAa,YAAyB+B,MAAM+sB,IAAK,KACnDiS,IAAO98B,KAAKuP,IAAIqtB,GAAGz3B,GAAKnF,KAAKuP,IAAIqtB,GAAGt3B,IAAM,KAC1CxJ,aAAa,eAAgB+uB,GAAKiS,QAIxCpqB,WAmBU,IAAd2oB,MACEF,EAAQ,MAELF,EAAUvjC,EAAI4jC,EAAO/1B,IACrB01B,EAAUtjC,EAAI2jC,EAAO91B,OAGpBm3B,GAASz5B,EAAQ4B,wBAChB2W,UAAU0f,EAAQD,EAAUxjC,EAAGwjC,EAAUvjC,GAC5C8X,EAAMvT,gBACF8G,iBAAiB25B,GAAQ,KAEzB53B,WAAW43B,UAIhB,GAAkB,IAAdtB,EAAiB,KACpB/zB,GAAIgJ,GAAyBb,GAAOvK,OACpC63B,GAAQ75B,EAAQ4B,wBAChB2W,UAAU0f,EAAQF,EAAUvjC,EAAGujC,EAAUtjC,OACzCqlC,GAAOD,GAAM73B,OACb+3B,GAAO/5B,EAAQ4B,wBAChB2W,UAAU0f,EAAQD,EAAUxjC,EAAGwjC,EAAUvjC,OACxCulC,GAAUD,GAAK/3B,OAAO8U,UAC1BqiB,GAAO/0B,GAAE0S,UACTmjB,GAASluB,GAAeotB,GAAMa,GAASF,GAAM11B,SAE1C61B,GAAO53B,IACP43B,GAAO33B,EAED,IAAP40B,GAAmB,IAAPC,UAGRrR,GAAWlT,EAASmR,WACtB5hB,GAAI2jB,GAASr0B,OACV0Q,MAAK,KACJgqB,GAAQrG,GAAS9qB,KAAKmH,OACL,IAAnBgqB,GAAMrI,SAAgB,GACJkT,GAASc,uBACpBY,kBAAkBvM,GAAMtzB,aAAa,kBACxC4/B,GAAalyB,EAAiB4lB,IAC9BkL,GAAWr3B,EAAQ4B,wBAChB01B,aAAaJ,EAAIC,GACtBsB,GAAWz/B,iBACF8G,iBAAiBu3B,GAAU,MAE3Bx1B,WAAWw1B,MAGfzrB,cAAc2rB,EAAsBpL,QACpCuM,kBAAkBL,IAK7BJ,IACE1rB,EAAMvT,gBACF8G,iBAAiBi6B,GAAM,KAEvBl4B,WAAWk4B,UAKlB,KAEC7hB,GAAMvX,GAAQiS,OAOfsF,IAA4B,SAArBtF,EAAShK,QAAoB,OAAO,SAE5CxE,GAAIpE,EAAQ+E,kBAEV/O,GAAQsU,GAAiBsI,MAC3B5c,GAAO,IACIxB,EAAG0jB,GAAI1jB,EAAI0jB,GAAIlX,MAAQ,EAAGvM,EAAGyjB,GAAIzjB,EAAIyjB,GAAItX,OAAS,KACnDiL,GACVqM,GAAI1jB,EAAI0jB,GAAIlX,MAAQ,EACpBkX,GAAIzjB,EAAIyjB,GAAItX,OAAS,EACrBwM,GAAyBb,GAAOvK,gBAG5BC,GAAIjM,GAAQ8G,KAAK8Q,GAAK,IACtBuB,GAAKrS,KAAKuP,IAAIpK,IAAM,MACtBnF,KAAKsR,IAAInM,KAAM,EAAInF,KAAKqR,IAAIlM,KAE5B,EAAIA,GAECuB,GAAI,EAAGA,GAAI+I,EAAMvT,gBAAiBwK,GAAG,KACtCW,GAAQoI,EAAMzK,QAAQ0B,OACT,IAAfW,GAAMlT,KAAY,KAEdinC,GAAK/zB,GAAMnC,SACPvN,GAAK0a,GAAI+oB,GAAG71B,EAAI61B,GAAG51B,GAAK,IACxB9N,GAAK0jC,GAAG71B,EAAI8M,GAAI+oB,GAAG51B,GAAK,IAC5BrJ,WAAWuK,gBAOnB20B,GAAY,EACVpY,GAAIxT,EAAMvT,kBAKXwJ,IAAY,KACT03B,GAAOtnB,EAAS/Z,aAAa,WAC/BqhC,IAAQA,GAAKhgB,WAAW,QAAS,KAC7BigB,GAAQ3b,GAAW0b,IACrBjpC,GAAO,aACPkpC,GAAMvxB,UAAY3X,KAAMA,GAAO,YAEnB,mBADAkpC,GAAMthC,aAAa5H,GAAO,SACR,IAE5Bmc,GAAyBb,GAAOvK,WAC9Bo4B,GAAS7zB,EAAiB4zB,IAC1BE,GAAUjtB,GAAyBgtB,IAAQp4B,OAE3Cs4B,GAAO,eADTvuB,GAAe3H,GAAGi2B,KACMp4B,EAAGmC,GAAElC,EAAGkC,GAAEjC,EAAGiC,GAAEhC,EAAGgC,GAAE/B,EAAG+B,GAAE9B,GAAG+B,KAAK,KAAO,OAC9DzL,aAAa3H,GAAO,YAAaqpC,SASzCva,IAAK,GAAmC,IAA9BxT,EAAMzK,QAAQie,GAAI,GAAG9uB,MACH,IAA9Bsb,EAAMzK,QAAQie,GAAI,GAAG9uB,MAA4C,IAA9Bsb,EAAMzK,QAAQie,GAAI,GAAG9uB,QAI5C,KACRmc,GAAyBb,EAAOwT,GAAI,EAAGA,GAAI,GAAG/d,SAC5C/I,WAAW8mB,GAAI,KACf9mB,WAAW8mB,GAAI,KACf9mB,WAAW8mB,GAAI,QAGhB,GAAU,IAANA,IAAyC,IAA9BxT,EAAMzK,QAAQie,GAAI,GAAG9uB,KAAY,IACzC,KACRmc,GAAyBb,GAAOvK,WAC9B22B,GAAM34B,EAAQ4B,wBAChB20B,UAAUnyB,MACRoL,UACA3N,WAAW82B,OAEb34B,EAAQ+E,uBAKP,IAAW,IAANgb,IAAYA,GAAI,GAA+B,IAA1BxT,EAAMzK,QAAQ,GAAG7Q,OACtB,IAA1Bsb,EAAMzK,QAAQ,GAAG7Q,KAAY,IACjB,MACNspC,GAAWhuB,EAAMzK,QAAQ,GAAGE,OAChCw4B,GAAMptB,GAAyBb,EAAO,GAAGvK,OACzCy4B,GAASD,GAAI1jB,aACX/K,GAAe0uB,GAAQF,GAAUC,MAC/BvhC,WAAW,OAGZ,CAAA,GAAU,IAAN8mB,IAAqC,IAA1BxT,EAAMzK,QAAQ,GAAG7Q,MAAe+E,GA8B/C,OACO,EACRA,GAAO,KACHyjC,GAASz5B,EAAQ4B,wBAChB2W,UAAUviB,GAAOgiC,EAAUxjC,EAAGwjC,EAAUvjC,GAE3C8X,EAAMvT,gBACF8G,iBAAiB25B,GAAQ,KAEzB53B,WAAW43B,WAGO,IAAxBltB,EAAMvT,iBACCqR,gBAAgB,aAEpB,eA3CH+C,GAAyBb,GAAOvK,OAC5B4Q,EAAShK,aACZ,SACOzK,GAAEyU,GAAU1P,MAAM,KAAM,KAAM,KAAM,WAE3C,eACA,eACK7F,OAASuV,EAAS/Z,aAAa,UACnC8S,EAAQtO,OAAQ,KACZgS,GAAOuD,EAASvV,OAChBgG,GAAMgM,GAAKrW,gBACTqE,OAAS,IAAIsG,MAAMN,QACtB,IAAIG,GAAI,EAAGA,GAAIH,KAAOG,GAAG,KACtBuM,GAAKV,GAAKvN,QAAQ0B,MAChBnG,OAAOmG,KAAMhP,EAAGub,GAAGvb,EAAGC,EAAGsb,GAAGtb,QAIrC,SACK2N,EAAIwQ,EAAS/Z,aAAa,QACtB,IACN2W,YA0BQ,IAAd2oB,IAAiC,IAAdA,IAAiC,IAAdA,OAC3BvlB,EAAUjH,EAASvH,IAIhB,IAAd+zB,GAAiB,IACfniC,GAAO,CACJsW,GAAmBC,UAEjBwrB,EAAUvjC,EAAI4P,GAAE/B,IAChB01B,EAAUtjC,EAAI2P,GAAE9B,QAGjBm3B,GAASz5B,EAAQ4B,wBAChB2W,UAAUviB,GAAOgiC,EAAUxjC,EAAGwjC,EAAUvjC,GAC3C8X,EAAMvT,gBACF8G,iBAAiB25B,GAAQ,KAEzB53B,WAAW43B,OAMI,SAArB7mB,EAAShK,gBACLkd,GAAWlT,EAASmR,WACtB5hB,GAAI2jB,GAASr0B,OACV0Q,MAAK,KACJgqB,GAAQrG,GAAS9qB,KAAKmH,OACN,UAAlBgqB,GAAMvjB,QAAqB,KACvB8xB,MACDv8B,GAAEguB,IAAOjpB,KAAK,MAAQ,IACtB/E,GAAEguB,IAAOjpB,KAAK,MAAQ,MAEdipB,GAAOuO,GAAct2B,WAQnC,GAAkB,IAAd+zB,IAAmBniC,GAAO,KAC7BoO,GAAIgJ,GAAyBb,GAAOvK,OACpC63B,GAAQ75B,EAAQ4B,wBAChB2W,UAAUviB,GAAO+hC,EAAUvjC,EAAGujC,EAAUtjC,OACxCqlC,GAAOD,GAAM73B,OACb+3B,GAAO/5B,EAAQ4B,wBAChB2W,UAAUviB,GAAOgiC,EAAUxjC,EAAGwjC,EAAUvjC,OACvCulC,GAAUD,GAAK/3B,OAAO8U,UACtBqiB,GAAO/0B,GAAE0S,UACTmjB,GAASluB,GAAeotB,GAAMa,GAASF,GAAM11B,OAEtCwO,EAAUjH,EAASsuB,IAC5BjkC,KACEuW,EAAMvT,gBACF8G,iBAAiBi6B,GAAM,KAEvBl4B,WAAWk4B,aAOG,IAAxBxtB,EAAMvT,iBACCqR,gBAAgB,eAGlBuB,cAAc,IAAI7B,GAAqB6I,EAAUglB,IAEnDlsB,GC/yBHvN,GAAIC,OAENu8B,UACAC,UACAC,UACEC,GAAaj4B,IAAY,GAAK,EAKvBk4B,yBAME70B,EAAIzC,EAAM/C,kBAEhBwF,GAAKA,OAGL8B,gBAAkBvE,OAGlBu3B,QAAS,OAGTC,cAAgBN,GAAYO,0BACtB,UACFh1B,GAAK,gBAAkBrT,KAAKqT,WAIhCi1B,aAAetoC,KAAKooC,cAAczqB,YACrCmqB,GAAYO,0BACD,gBAEF,cAAgBroC,KAAKqT,QACpB,cACE,sBACQ,uBACI,YAEb,+BAMRk1B,eACC,OACD,QACC,OACD,QACC,OACD,QACC,OACD,WAGAC,MAAMxoC,KAAKmV,gBAAiBtH,2CAQ5B2B,EAAG3B,QACHs6B,QAAS,OACThzB,gBAAkB3F,OAClBi5B,OAAO56B,QACPu6B,cAAcriC,aAAa,UAAW,oDAO1B5C,OACbulC,SACEC,KACFC,EAAQ3+B,KAAKoR,MAAMlY,EAAQ,QAE1BulC,KADDE,EAAQ,OAAc,GACdZ,GAAiBa,gBACpBzgC,KAAKsgC,QAEPE,EAAQ,KACNxgC,KAAKugC,EAAOG,iBAGjBn4B,EAAI,MACH+3B,KAAOV,GAAiBa,iBACVA,cAAcH,GAAK3iC,aAAa,QAAU,UAAY4iC,EAAOh4B,GAAK,iDAU5E0R,OACH0mB,EAAQ1mB,EAAO,SAAW,UACf2mB,mBAAmBjjC,aAAa,UAAWgjC,OACtDn4B,EAAO5Q,KAAKmV,qBACb8zB,SAAW5mB,EACZzR,GAAQyR,SACL+lB,cAAc96B,OAAO06B,GAAiBgB,yBACtCE,kBAAkBzxB,GAAiB7G,oCAQpC/C,OACAs7B,EAAcnpC,KAAKsoC,aACvBc,EAAMpB,GACNqB,EAAgBD,EAAIP,cACpB9oB,EAAW/f,KAAKmV,gBAChB2f,EAAK/U,EAAS/Z,aAAa,gBAC3B+W,EAAc+qB,GAAY9qB,iBACxBoY,EAAS,EAAIrY,EACuB,SAApCgD,EAAS/Z,aAAa,WAAyB+B,MAAM+sB,QAC5CA,EAAK,OAGX/e,EAAWgK,EAAXhK,QACS,SAAZA,OACQ,EAAIgH,OAIVrD,EAAQhG,EAAiBqM,GACzBxO,EAAIgJ,GAAyBb,GAAOvK,YAIxCK,GAAKuN,IACLtN,GAAKsN,EAEFlP,MACIC,GAAQiS,IAID,MAAZhK,IAAoBzK,GAAEunB,KAAK9S,EAAU,QAAS,KAG1CupB,EAAclW,IAAgBrT,EAASmR,aACzCoY,MACKA,OAKL1vB,EAAI/L,EAAKlM,EAAGgS,EAAI9F,EAAKjM,EAAGiY,EAAIhM,EAAKM,MAAO2L,EAAIjM,EAAKE,UAC/CpM,EAAGiY,EAAGhY,EAAG+R,EAAGxF,MAAO0L,EAAG9L,OAAQ+L,MAM5BiD,QAEGpD,GAAaC,EAAImD,EAAapJ,EAAIoJ,EAAalD,EAAIkD,EAAajD,EAAIiD,EAAaxL,GAC3FqjB,EAAS2U,EAAT3U,MACC4U,EAAO5U,EAAMjzB,EAAIyzB,EACnBqU,EAAO7U,EAAMhzB,EAAIwzB,EACjBsU,EAAO9U,EAAMzmB,MAAkB,EAATinB,EACtBuU,EAAO/U,EAAM7mB,OAAmB,EAATqnB,EAGnB3jB,EAAK+3B,EAAOE,EAAO,EACvBh4B,EAAK+3B,EAAOE,EAAO,EAEfxmC,EAAQsU,GAAiBsI,MAC3B5c,EAAO,KACHymC,EAAM9B,GAAY+B,UAAU96B,uBAC9B2W,WAAWviB,EAAOsO,EAAIC,OACpBo4B,EAAOF,EAAIz6B,SACZmE,GAAK0F,GAAeuwB,EAAKj2B,GAAG3R,EAAG4nC,EAAKj2B,GAAG1R,EAAGkoC,KAC1C/vB,GAAKf,GAAeuwB,EAAKxvB,GAAGpY,EAAG4nC,EAAKxvB,GAAGnY,EAAGkoC,KAC1C9vB,GAAKhB,GAAeuwB,EAAKvvB,GAAGrY,EAAG4nC,EAAKvvB,GAAGpY,EAAGkoC,KAC1C7vB,GAAKjB,GAAeuwB,EAAKtvB,GAAGtY,EAAG4nC,EAAKtvB,GAAGrY,EAAGkoC,OAGxCx2B,EAAMi2B,EAANj2B,GACH4G,EAAO5G,EAAG3R,EACZ2Y,EAAOhH,EAAG1R,EACVwY,EAAO9G,EAAG3R,EACVooC,EAAOz2B,EAAG1R,EAELuY,EAAYlQ,KAAZkQ,IAAKE,EAAOpQ,KAAPoQ,QAELF,EAAID,EAAMC,EAAIovB,EAAKxvB,GAAGpY,EAAGwY,EAAIovB,EAAKvvB,GAAGrY,EAAG4nC,EAAKtvB,GAAGtY,KAAOyzB,MACvDjb,EAAIG,EAAMH,EAAIovB,EAAKxvB,GAAGnY,EAAGuY,EAAIovB,EAAKvvB,GAAGpY,EAAG2nC,EAAKtvB,GAAGrY,KAAOwzB,OACvD/a,EAAID,EAAMC,EAAIkvB,EAAKxvB,GAAGpY,EAAG0Y,EAAIkvB,EAAKvvB,GAAGrY,EAAG4nC,EAAKtvB,GAAGtY,KAAOyzB,GAK/Clb,OAJRG,EAAI0vB,EAAM1vB,EAAIkvB,EAAKxvB,GAAGnY,EAAGyY,EAAIkvB,EAAKvvB,GAAGpY,EAAG2nC,EAAKtvB,GAAGrY,KAAOwzB,GAK/C9a,MAGX4pB,EAAO,IAAMsF,EAAO,IAAMC,EAC9B,MAAQD,EAAOE,GAAQ,IAAMD,EAC7B,KAAOD,EAAOE,GAAQ,KAAOD,EAAOE,GACpC,IAAMH,EAAO,KAAOC,EAAOE,GAAQ,MACzB5jC,aAAa,IAAKm+B,OAExB5yB,EAAQnO,EAAQ,WAAaA,EAAOsO,EAAIC,GAAIF,KAAK,KAAO,IAAM,OAe/D,IAAMk3B,UAdNN,cAAcriC,aAAa,YAAauL,QAIxCi3B,gBACEiB,EAAMC,OACND,EAAOE,EAAMD,OACbD,EAAMC,EAAOE,OACbH,EAAOE,EAAMD,EAAOE,MACrBH,EAAQE,EAAQ,EAAGD,MACnBD,EAAMC,EAAQE,EAAQ,MACtBH,EAAOE,EAAMD,EAAQE,EAAQ,MAC7BH,EAAQE,EAAQ,EAAGD,EAAOE,IAEd3pC,KAAKuoC,WAAY,KAC3ByB,EAAShqC,KAAKuoC,WAAWG,KACjBA,GAAK3iC,aAAa,KAAMikC,EAAO,MAC/BtB,GAAK3iC,aAAa,KAAMikC,EAAO,MAI3CC,oBAAoBlkC,aAAa,KAAMyjC,EAAQE,EAAQ,KACvDO,oBAAoBlkC,aAAa,KAAM0jC,KACvCQ,oBAAoBlkC,aAAa,KAAMyjC,EAAQE,EAAQ,KACvDO,oBAAoBlkC,aAAa,KAAM0jC,EAAqB,EAAbxB,MAE/CiC,WAAWnkC,aAAa,KAAMyjC,EAAQE,EAAQ,KAC9CQ,WAAWnkC,aAAa,KAAM0jC,EAAqB,EAAbxB,aAQjCkC,0CAGJC,oBAAsB,UAGtBC,cAAgB,UAGhBC,kBAGAC,oBAGA1B,kBACC,OACD,QACC,OACD,QACC,OACD,QACC,OACD,WAGAG,mBAAqB,UACrBiB,oBAAsB,UACtBC,WAAa,UAEbM,8DA6BA,IAAM9B,KArBP1oC,KAAKoqC,qBAAuBpqC,KAAKoqC,oBAAoBj0B,iBAClDi0B,oBAAoBz8B,cAItBy8B,oBAAsBtC,GAAYO,0BAC5B,UACFh1B,GAAI,8BAER21B,mBAAqBlB,GAAYO,0BAC3B,UACF/G,QAAS,eAEb8I,oBAAoB98B,OAAOtN,KAAKgpC,uBACzBa,UAAUv8B,OAAOtN,KAAKoqC,0BAE7BG,oBACAD,kBACAD,cAAgB,KAGHrqC,KAAK6oC,cAAe,KAC9B4B,EAAO3C,GAAYO,0BACd,kBAEF,uBAAyBK,OACxB,SACHT,SACK,UAAYS,EAAM,yBAKV,mBACE,YAIpB7V,KAAK4X,EAAM,MAAO/B,MAClB7V,KAAK4X,EAAM,OAAQ,eAChB5B,cAAcH,GAAO1oC,KAAKgpC,mBAAmBrrB,YAAY8sB,WAI3DR,oBAAsBjqC,KAAKgpC,mBAAmBrrB,YACjDmqB,GAAYO,0BACD,gBAEF,sCACG,sBACQ,aAKjB6B,WAAalqC,KAAKgpC,mBAAmBrrB,YACxCmqB,GAAYO,0BACD,kBAEH,2BACE,SACHJ,UACK,sBACQ,QACT,cAAgBF,GAAQ2C,QAAU,kCAI7C7X,KAAK7yB,KAAKkqC,WAAY,OAAQ,WAE5B5+B,GAAE,qBAAqB1M,gBAEHmpC,GAAQ4C,cAAzBx8B,OAAOJ,OACR68B,EAAW9C,GAAYO,0BAClB,eAEH,sCAGD,IACA,WACQ14B,IAAa,OAAS,gBAC1B,yBAILtE,EAAOy8B,GAAYO,0BACd,mBAEA,cACC,SACL,IACA,iBACa,SACR,YACF,aACC,2BAOF/6B,OAAOjC,MACJw+B,UAAUtzB,aAAaq0B,EAAU9C,GAAY+C,uDAU1Cj6B,EAAM/C,MACT,MAAR+C,SAAuB,SAErBsc,EAAIltB,KAAKsqC,UAAU1rC,UAEgB,WAArCksC,EAAO9qC,KAAKuqC,YAAY35B,EAAKyC,iBAC1Bk3B,YAAY35B,EAAKyC,IAAI80B,QAAS,EAC5BnoC,KAAKuqC,YAAY35B,EAAKyC,QAE1B,IAAI1C,EAAI,EAAGA,EAAIuc,IAAKvc,KACnB3Q,KAAKsqC,UAAU35B,KAAO3Q,KAAKsqC,UAAU35B,GAAGw3B,mBACrCmC,UAAU35B,GAAGw3B,QAAS,OACtBmC,UAAU35B,GAAG63B,MAAM53B,EAAM/C,QACzB08B,YAAY35B,EAAKyC,IAAMrT,KAAKsqC,UAAU35B,GACpC3Q,KAAKsqC,UAAU35B,eAIrB25B,UAAUpd,GAAK,IAAIgb,GAAShb,EAAGtc,EAAM/C,QACrCu8B,oBAAoB98B,OAAOtN,KAAKsqC,UAAUpd,GAAGkb,oBAC7CmC,YAAY35B,EAAKyC,IAAMrT,KAAKsqC,UAAUpd,GACpCltB,KAAKsqC,UAAUpd,2CAQPtc,MACH,MAARA,OACEsc,EAAIltB,KAAKsqC,UAAU1rC,OACvBsrB,EAAMlqB,KAAKuqC,YAAY35B,EAAKyC,IACzB6W,EAAIie,gBAEClxB,IAAI,+DAET,IAAItG,EAAI,EAAGA,EAAIuc,IAAKvc,KACnB3Q,KAAKsqC,UAAU35B,IAAM3Q,KAAKsqC,UAAU35B,KAAOuZ,EAAK,QAC3ClqB,KAAKuqC,YAAY35B,EAAKyC,MACzB80B,QAAS,IACThzB,gBAAkB,OAClB41B,WAAU,SAIR3C,cAAcriC,aAAa,UAAW,QAC1C,MAAOyJ,8DAYRxP,KAAKqqC,qBACHA,cAAgBrqC,KAAKoqC,oBAAoBzsB,YAC5CmqB,GAAYO,0BACD,gBAEH,0BACE,sBACU,WACR,sBACQ,WACP,aACF,2BAKRroC,KAAKqqC,uBC3aV/+B,GAAIsiB,EAAYriB,QAEpBqK,GAEEo1B,GAFkBr0B,GAElBq0B,GAFwCj0B,GAExCi0B,GADF9zB,GACE8zB,GADoBrzB,GACpBqzB,GADkC9yB,GAClC8yB,GAD+Ct1B,GAC/Cs1B,GAECrsC,OAAOqY,iBACHA,kBACAA,QAAQC,IAAM,SAAU7E,YACxB4E,QAAQ0xB,IAAM,SAAUt2B,MAG7BzT,OAAOmN,eACFkL,QAAQC,IAAM,SAAU7E,SAAa64B,UAAU74B,WAC/C4E,QAAQ0xB,IAAM,SAAUt2B,UA+B3B84B,GAKJ,WAAaC,EAAWnU,iBAIpBoU,wBACiB,aACV,cACE,IAAK,MAIhBpU,MACAgO,OAAOoG,EAAWpU,OAIf2T,EAAcS,EAAdT,WAED5d,EAAS/sB,KAITg5B,EAASmS,EAAUrZ,cAOnB3kB,EAAU6rB,EAAOqS,WACrB/a,GACE,4BAA8BpxB,EAAGuM,IAAM,cAAgBvM,EAAGoyB,MAAQ,YACpDqZ,EAAW,GAAK,aAAeA,EAAW,GAAK,QAAUA,EAAW,GAAK,QAAUA,EAAW,GAAK,wTAYjHt9B,iBACF,KAEQC,OAAOH,OAObC,EAAa4rB,EAAOlzB,gBAAgB5G,EAAGuM,IAAK,QAOjBshB,EAAOue,uBAAyB,cAC3Dl+B,GAAYusB,WAGZvsB,GAAYiD,SACR,mBACGs6B,EAAW,UACVA,EAAW,KAChBA,EAAW,KACXA,EAAW,YACJS,EAAUG,oBAAsB,UAAY,eAC/CrsC,EAAGuM,eACEvM,EAAG68B,iBACA78B,EAAGoyB,QACjBka,SAASr+B,OAGNs+B,EAAUzS,EAAO0S,cAAc,kEAC1Bp+B,OAAOm+B,WAKhBE,EAAW,SAQRC,YAAc,SAAUjzB,KAClBA,KAQNkzB,iBAAmB,IAAIC,GAAa1+B,EAAYu+B,OAOjD/L,EAAoB7S,EAAO6S,kBAAoB,kBAC5C7S,EAAO8e,kBAOZ9uB,EAAc,EAGdmgB,EAAe,KAGb6O,gBAEkC,SAA7BX,EAAUY,SAASC,MAAmB,GAAK,KAAOb,EAAUY,SAASC,iBAChE,kBACEb,EAAUY,SAAS3S,eACzB,IAAM+R,EAAUc,WAAWD,mBACrB,oBACEb,EAAUc,WAAW7S,qBACvB+R,EAAUc,WAAW/9B,uBACjB,uBACD,uBACD,eACPi9B,EAAUe,gBAIT5+B,KAAOjC,GAAE05B,QAAO,KAAU+G,EAAcK,UACpDpH,OAAO+G,EAAcx+B,WACf,uBACQ69B,EAAU79B,MAAQ69B,EAAU79B,KAAK8+B,uBACpCjB,EAAU79B,MAAQ69B,EAAU79B,KAAK++B,sBAC/BlB,EAAU79B,MAAQ69B,EAAU79B,KAAKg/B,kBAI1CC,EAAWT,EAAcK,MAI3BK,KAcEC,EAAwB1sC,KAAK0sC,sBAAwB,SAAU7Z,MAE7C,IAAlBA,EAAK5B,SAAgB,OAAO4B,EAAKwM,kBAUrBhvB,EARVs8B,WACK9Z,EAAK9c,6BAOPpF,EAAI,EAAUN,EAAOwiB,EAAKjsB,WAAW+J,GAAKA,MAC1CN,KAAKA,EAAK9Q,MAAQ8Q,EAAKE,UAI3B,IAAW4xB,EAAPxxB,EAAI,EAAUwxB,EAAOtP,EAAK3B,WAAWvgB,GAAKA,MAC1CsiB,SAAStiB,GAAK+7B,EAAsBvK,UAGtCwK,GAQHhjB,EAAwB3pB,KAAK2pB,sBAAwB,SAAUkJ,MAC/C,iBAATA,EAAmB,OAAOmG,EAAO4T,eAAe/Z,OAEvDuZ,EAAQ5uB,GAAQqV,EAAKxiB,KAAKgD,IAExBqtB,EAAed,IAAoBe,qBACrCyL,GAASvZ,EAAKlI,UAAYyhB,EAAMr2B,YAC5BpI,WACE,OAELy+B,EAAO,KACJrW,EAAKlD,EAAKga,WAAa3tC,EAAGuM,MACxButB,EAAOlzB,gBAAgBiwB,EAAIlD,EAAKlI,SACpC+V,IACDxD,GAAgBwD,GAAcpzB,OAAO8+B,UAGtCvZ,EAAKia,cACUV,QACTI,EAASnF,YACPmF,EAASO,sBACDP,EAASH,gCACLG,EAASQ,mCACVR,EAASS,iCACVT,EAASU,gCACTV,EAASW,8BACXX,EAASY,qBAChBZ,EAASnT,QAAU,QACrB,0BACN,QAEY+S,EAAOvZ,EAAKxiB,KAAM,QACpB+7B,GAGXvZ,EAAKI,YACFA,SAAS3zB,QAAQ,SAACg6B,KACfhsB,OAAOqc,EAAsB2P,MAIhC8S,KAGF14B,iBAAmBA,IAEnBwF,eAAiBA,KACjBO,mBAAqBA,KACrBc,yBAA2BA,OAK5B7F,EAAc,kBAAe02B,EAAUiC,Wd7RzB,SAAUC,KACRA,MAGd1hC,EAAM5M,SAAS8G,gBAAgB5G,EAAGuM,IAAK,gBACpC8hC,KAAKjgC,OAAO1B,OACfP,EAAOrM,SAAS8G,gBAAgB5G,EAAGuM,IAAK,UACzC1F,aAAa,QAAS,SACtBA,aAAa,SAAU,SACvBA,aAAa,IAAK,SACnBuH,OAAOjC,OACLmgB,EAAKngB,EAAKyC,YACZH,aAEE6/B,EAAOhiB,EAAG7pB,QAEV6pB,EAAGrd,SACHqd,EAAGzd,UACHy/B,KACAA,EAAO,QACPA,EAAO,QACPA,EAAO,MACPA,EAAO,KACP,MACC,8BciROhwB,+BACUpQ,EAAWpH,aAAa,UAAY+W,8BACrC3P,EAAWpH,aAAa,SAAW+W,oCAC7B0wB,GAAYC,kBAIpC94B,aAAeA,OV5RQwH,EUkSxBuV,EAAgB,kBAAevkB,GAO/B+d,EAAsBnrB,KAAK2tC,iBAAmB,kBAC3ClB,GAGH/lB,EAAcknB,GAMdvuB,EAAa,kBAAMlS,MVnTKiP,gHU8TC4c,qCACCmS,gEAIAC,EAAUyC,kBVjU9BzxB,EAAc0xB,oBACR1xB,EAAc2xB,qBACnB3xB,EAAciD,eUmUpBoS,SAAWA,KACXN,eAAiBA,KACjB7Z,QAAUA,KACVia,QAAUA,GACKxE,EAAOjf,QAAUid,KAChCtT,iBAAmBA,KACnB+F,QAAUA,KACVmO,WAAaA,KACbiK,iBAAmBA,QAErBK,eAAiBA,OAMhBlO,EAAkB,kBAAeqjB,EAAU4C,eH5Y7B,SAAU5xB,MACXA,iCGkZQwjB,2CAKtB7W,aAAeA,GFtZA,SAAU3M,MACjBA,qDE6ZqB6xB,+BACXr/B,MAA8BA,UAGhD81B,sBAAwBA,OAGvBwJ,EAAQ/uC,MACP+iC,YAAcA,OAOfhH,EAAUnO,EAAOmO,QAAU,IAAIhjB,gCAOfi2B,EAAWp2B,OACvBq2B,EAAa14B,MAEfy4B,IAAcC,EAAW33B,gBAAkB03B,IAAcC,EAAW93B,eAC/DyN,sBACF,GAAIoqB,IAAcC,EAAW53B,aAAe23B,IAAcC,EAAW13B,cAAe,KACnFoB,EAAQC,EAAIE,aACXyO,YAAY/J,UACd,UAAW7E,OACVu2B,EAAUt2B,EAAI3Z,OACdkwC,EAAWH,IAAcC,EAAW53B,eACtC63B,IAAYz4B,GAAmBxX,QAClBkwC,EAAUv2B,EAAI7B,UAAY6B,EAAIjC,aAC9B1I,aAGV,GAAIihC,IAAY13B,GAAqBvY,QACxCiwC,IAAYt3B,GAAqB3Y,OAC/B2Z,EAAInB,SAAWxJ,QAGfihC,IAAY13B,GAAqBvY,OAC/BkwC,MAA2Bv2B,EAAInH,MAE9B09B,MAA2Bv2B,EAAInH,MAEb,QAArBmH,EAAInH,KAAKmF,YACAgC,EAAInH,WAEZ,GAAIy9B,IAAYn3B,GAAqB9Y,OAAQ,CAEzB,UAArB2Z,EAAInH,KAAKmF,SACXgC,EAAInH,KAAKuF,WAAWA,aAAe/I,YAI/B0F,EAASw7B,EAAUv2B,EAAIX,UAAYW,EAAIV,UAEzCvE,EAAOy7B,gBACFC,eAAez2B,EAAInH,KAAKuF,WAAYrD,EAAOy7B,mBA0BtDljB,EAAsB,SAAUtT,KAC7BmjB,QAAQ7P,oBAAoBtT,IAQ/BiF,EAAiBhd,KAAKyuC,QAAU,kBAAqB1xB,GAOrD1B,EAAQrb,KAAKqb,MAAQ,SAAUjK,UAC5BqJ,SAASrJ,EAAM2L,EAAa,IAAMA,ID1BvB,SAAUia,EAAQ0X,MAC1B1X,KACI0X,KACK,IAAIvE,IC2BvBiB,6BAMoBuD,UAAkB5hB,EAAOpD,sBAAsBglB,8BAC7CxhC,gCACGC,0BASrBsa,EAAkB1nB,KAAK0nB,gBDrCWsgB,GC2ClCpe,EAAYmD,EAAOnD,UAAY,kBAC5BgW,IAAoBhW,aAOvBrB,EAAQwE,EAAOxE,MAAQ,kBACpBqX,IAAoBrX,SAWvB/G,EAAO,SAAUvjB,EAAI2wC,MACrBC,GAAO5wC,UACF4wC,GAAO5wC,GAAIU,OAAQiwC,IAWxB7qB,EAAiB/jB,KAAK+jB,eAAiB,SAAU+qB,KACpCxvC,QAAQ,SAACsR,GACZ,MAARA,KAGYm+B,gBAAgBn+B,UAI7Bk+B,KAAe,WAAYrC,IAS5BxhB,GAAiBjrB,KAAKirB,eAAiB,SAAU+jB,EAAYjE,MAC5DiE,EAAWpwC,gBAGZqS,EAAI,EACDA,EAAIw7B,EAAiB7tC,QACC,MAAvB6tC,EAAiBx7B,MAGnBA,UAIAN,EAAIq+B,EAAWpwC,OACZ+R,KAAK,KACNC,EAAOo+B,EAAWr+B,MACjBC,OACC/C,EAAOkd,GAAana,MACrB/C,IAEgB,MAAjB+C,EAAKmF,SAA8C,IAA3BnF,EAAKsgB,WAAWtyB,WAEnCgS,EAAKmhB,aAIT0a,EAAiBzgC,SAAS4E,IAAO,GACnBK,GAAKL,UAKhBsZ,EAAMxC,EAAgBunB,gBAAgBr+B,EAAM/C,GAE9C4+B,EAAiB7tC,OAAS,KACxBmsC,WAAU,WAIf,WAAY0B,GAEb1B,GAAyC,IAA5B0B,EAAiB7tC,SAChBqwC,gBAAgBxC,EAAiB,IAAI1B,WAAU,KAE/CkE,gBAAgBxC,EAAiB,IAAI1B,WAAU,KAMhD3mB,KAAK,SAAUhV,EAAGC,UAC7BD,GAAKC,GAAKD,EAAE8/B,wBACP,GAAoC,EAA/B7/B,EAAE6/B,wBAAwB9/B,IAE/B,MAALA,EACK,WAKmB,MAAvBq9B,EAAiB,MACL3D,MAAM,KAOrBjf,GAAa,kBACV2iB,EAASnT,SAOZhQ,GAAiBrpB,KAAKqpB,eAAiB,SAAU1C,MAC1C,MAAPA,SACK,SAELC,EAAcD,EAAI9nB,UAGlB+nB,EAAYuoB,4BAAyCvoB,EAAYuoB,0BAIhEjwC,EAAGkwC,KAAMlwC,EAAGmwC,MAAMrjC,SAAS4a,EAAY/V,eACvB,cAAnB+V,EAAYvT,QAEoB,kBAAzBuT,EAAY0E,iBACH1E,EAAYzQ,mBACChJ,MAMzBuzB,EAAed,IAAoBe,sBACpCxzB,EAASg+B,EAAW/9B,EAAYszB,GAAc10B,SAAS4a,UACnDzZ,KAGO7B,GAAEsb,GAGN+M,QAAQ,wBAAwB/0B,cAGnC8oB,EAAgB0iB,yBAGlBxjB,EAAYzQ,cAAgB+mB,GAAgBwD,MACnC9Z,EAAYzQ,kBAcrByQ,KAQFF,YAAcA,wDAIJ/N,KACb5S,aAAa,IAAK2gB,EAAYd,YAAYjN,mMAqBjCwyB,uBAEG7uB,MACAA,kCAGHiL,0BAEK+nB,aACAA,qCASMhrB,IAAAA,cAAeD,IAAAA,QAErBmI,gBAAiB,IACjB+iB,eAAiBjrB,IACxB,eAAgBA,gBAAeD,YAC/B,WAAYA,+BAQNtM,IAAAA,IAAKnH,IAAAA,OACImH,KACf,WAAYnH,6FAOV4+B,4BAEOC,aACAA,kCAIPxnB,0BAEKynB,aACAA,sBAQZh0B,MAEAif,GAAW,4FACXgV,IAAY,YAAa,OAAQ,SAAU,aAAc,aAAc,eAAgB,OAAQ,UAE/F5P,GAASz0B,GAAEunB,KAGX+c,GAAU5wC,SAAS8G,gBAAgB5G,EAAGuM,IAAK,cAC/CmkC,IAASv/B,oBACM,gBACR,iBACF,OACC,WACLm7B,SAASr+B,UAEN0iC,GAAkB,SAAlBA,EAA4Bj/B,OAE1BuG,EAAQ7L,GAAEsF,GAAMP,KAAKs/B,QACtB,IAAMtM,KAAKlsB,EAAO,KACf/F,EAAM+F,EAAMksB,MACdjyB,GAAOA,EAAIiW,WAAW,QAAS,KAC3BhU,EAAK8d,GAAe/f,GAAKyD,OAAO,GAC1B2I,GAAQnK,UAEP/F,OAAOwiC,GAAgBz8B,WAC3By8B,GAAgBz8B,SAKvB08B,EAASn/B,EAAKo/B,qBAAqB,QAErCD,EAAOnxC,WACJ,IAAI+R,EAAI,EAAGiJ,EAAIm2B,EAAOnxC,OAAQ+R,EAAIiJ,EAAGjJ,MACxBo/B,EAAOp/B,KAsBvBs/B,UAMWvC,aAAc,YAMnB3B,EAAcx+B,oBAUP69B,EAAUV,QAAU,eAG3B,KAGO,QAGH,YAGM,UAGJ8B,KAMD,QAGH,cAMK,KAmBb0D,GAAgBlwC,KAAKkwC,cAAgB,SAAUC,EAAQC,EAAMC,OAC7D76B,IAAS66B,gBACXh0B,KAAKi0B,GAAY,SAAU/wC,EAAMgxC,GAC7BA,GAAOJ,KAAUI,IACC,mBAATH,MACFA,EAAK7wC,IAEV8wC,IACKjoC,KAAKmoC,EAAIJ,GAAQC,MAEfG,EAAIJ,GAAQC,MAIpB56B,QAyHJg7B,2CAAe,WAAgBjxC,EAAMkxC,EAAaC,6FAC1B,mBAAhBD,wBACH,IAAIE,UAAU,0EAGhBpxC,KAAQ+wC,yBAcGhlC,GAAE05B,OAAOjY,EAAO6jB,iEAItBhR,IAAoBF,gCAGzB+Q,kCACaA,EAAYI,iCAEzBC,MACKvxC,KAAOA,MAGLA,GAAQuxC,oBACZtvB,EAAK,kBAAmBsvB,oBAEvB75B,IAAI,yBAA2B1X,EAAO,qJAgB5CwxC,GAAsB/wC,KAAK+wC,oBAAsB,SAAU1lC,MAC9C,MAAbkc,UAA4B,SAE1B3Q,EAASsmB,GAAgB0C,IAAoBe,kBAE/CqQ,YACC3lC,KASU+B,EAAW1B,iBACb/J,EAAI0J,EAAK1J,IACTC,EAAIyJ,EAAKzJ,IACTuM,MAAQ9C,EAAK8C,QACbJ,OAAS1C,EAAK0C,WAbhB,GACIwZ,GAAUzZ,cACjB0d,EAAKpe,EAAW1B,oBAEjB,IAAM23B,KAAK2N,IACX3N,GAAK2N,EAAW3N,GAAKtmB,IAEbyO,MASXylB,EAAa,QACZphC,GACwC,mBAAhC1C,EAAQ4jC,wBAENpvC,GAAK8Y,SAASrN,EAAWpH,aAAa,KAAM,MAC5CpE,GAAK6Y,SAASrN,EAAWpH,aAAa,KAAM,MAE1CmH,EAAQ4jC,oBAAoBC,EAAYp6B,IAIvC,MAAdq6B,GAAiD,mBAApBA,EAAW9oC,KAAqB,MAG1D+oC,GAAUtyC,YAEDuyC,GAA4Bv6B,YAEtCjG,EAAIugC,GAAUtyC,OACX+R,KACAqgC,EAAW7iC,OACZqN,GAAew1B,EAAYE,GAAUvgC,GAAG9C,SAC/BzF,KAAK8oC,GAAUvgC,GAAGC,aAQ5BqgC,QAGJ7d,eAAiBqC,QAEjBH,mBAAqBA,OAgBpB6b,GAA8BnxC,KAAKmxC,4BAA8B,SAAUv6B,GAC1EA,MACMtL,GAAE8B,GAAY6lB,gBAEnBsC,eACJ3e,GAAQqc,WAAW5W,KAAK,SAAU1L,EAAGC,GACjCA,EAAK9C,WACM1F,MAAMwI,OAAM/C,KAAM4nB,IAA8B7kB,QAG1D2kB,EAAaC,WAShB4b,GAAepxC,KAAKoxC,aAAe,SAAUxgC,OAC3C1C,EAAIlP,SAAS8G,gBAAgB5G,EAAGuM,IAAK,OACtC4lC,YAAYnjC,MACfA,GAAGZ,OAAOsD,GAAMiiB,KAAK,OAAQjiB,GAAM,GAAGyC,GAAKuW,KAMzCilB,QAECrtB,KAAOA,IAyHPva,KAAO,SAAUhJ,EAAIwR,OACpBgU,EAAMorB,GAAO5wC,aACZA,GAAMwR,EACNgU,QASJ6tB,WAAa,SAAUC,QACrBrP,YAAYqP,EAAOlkC,6BAGNkkC,EAAO1f,uBAAuB3yB,EAAGuM,IAAK,UAClDnM,QAAQ,SAACqN,KACR5G,aAAa,IAAK2gB,EAAYd,YAAYjZ,MACnCghB,OAAOhhB,UAcjB6kC,GAAU,SAAU5gC,OACnBhB,WAAoBgB,MACnB3I,EAAQ2I,EAAKtC,WAAU,YACxB+lB,OAAOpsB,KACP0F,WACWohC,gBAAgBn+B,KACf,GAAK3I,IACNgnC,gBAAgBhnC,GAAO8iC,WAAU,GAC1C9iC,QAmBJwpC,iBAAmB,SAAUrgC,EAAKsgC,KAE/B3+B,WAAW3B,OACXR,EAAO67B,EAAiB,GACxBkF,EAAe/gC,EAAK5K,aAAa,aACjC6H,EAAOkd,GAAana,GACpBa,EAAK5D,EAAKlM,EAAIkM,EAAKM,MAAQ,EAAGuD,EAAK7D,EAAKjM,EAAIiM,EAAKE,OAAS,EAC1D2L,EAAQhG,EAAiB9C,GAG3B8I,EAAMvT,cAAgB,IAEL,IADLuT,EAAMzK,QAAQ,GAClB7Q,QACFgI,WAAW,OAIT,IAARgL,EAAW,KACPwgC,EAAS54B,GAAevH,EAAIC,EAAI6I,GAAyBb,GAAOvK,QAChEsW,EAAMtY,EAAQ4B,uBAChB2W,UAAUtU,EAAKwgC,EAAOjwC,EAAGiwC,EAAOhwC,GAChC8X,EAAMvT,gBACF8G,iBAAiBwY,EAAK,KAEtBzW,WAAWyW,QAEc,IAAxB/L,EAAMvT,iBACVqR,gBAAgB,iBAGlBk6B,EAAa,KAGVG,EAAejhC,EAAK5K,aAAa,eAClCD,aAAa,YAAa4rC,MACP,YAAaE,EAAcpF,KAC9C,UAAWA,OAMZqF,EAAWpqB,EAAgBunB,gBAAgBxC,EAAiB,MACzDhE,WACAS,kBAAkB93B,QAUvB2gC,GAAmC/xC,KAAK+xC,iCAAmC,mBAEzEl5B,EAAW,IAAIlB,GADe,SAAtBq6B,GAA+B,WAAa,QAGtDrhC,EAAI87B,EAAiB7tC,OAClB+R,KAAK,KACJC,EAAO67B,EAAiB97B,GAExBoH,EAAM2sB,GAAsB9zB,GAC9BmH,KACOgB,cAAchB,GAItBc,EAASo5B,cACQp5B,KACf,UAAW4zB,KAUdyF,GAAY,SAAU3gC,WAClB0F,KAAK1F,EAAEnC,EAAGmC,EAAElC,EAAGkC,EAAEjC,EAAGiC,EAAEhC,EAAGgC,EAAE/B,EAAG+B,EAAE9B,KAItC0iC,GAAW,KAeTC,GAAapyC,KAAKoyC,WAAa,SAAUt6B,EAAOizB,MACrC,MACAjzB,EAAOizB,IAYU/qC,KAAKqyC,oBAAsB,SAAUC,MAC1C,MAAvB7F,EAAiB,IAChB6F,EAAc1zC,gBAGb2zC,KACJ/hC,EAAMi8B,EAAiB7tC,OAChB+R,EAAI,EAAGA,EAAIH,IAAOG,EAAG,KACtBC,EAAO67B,EAAiB97B,GAC1BC,IAEG0hC,EAActmC,SAAS4E,KAGVm+B,gBAAgBn+B,KAFfxI,KAAKwI,MAOT2hC,SAQhBC,wBAA0B,eACvB9R,EAAed,IAAoBe,kBACrCD,OACY,YACHp1B,GAAE4xB,GAAgBwD,GAAczN,kBAQzCwf,GAQF/oB,GACF7C,GACAC,GACA4rB,GACAC,GACAC,GACAC,GACAC,GACAC,GACA5gB,GACA9E,GACA2lB,GACAC,GACAC,GAGIC,GA5BFlrB,GAAY,KAIVwqB,SACE,UACA,UACA,UACA,MAIJ/oB,GAAQ,KACV7C,GAAS,KACTC,GAAS,KACT4rB,GAAU,KACVC,GAAU,KACVC,MACAC,GAAc,EACdC,IAAkBnxC,EAAG,EAAGC,EAAG,GAC3BmxC,IAAkBpxC,EAAG,EAAGC,EAAG,GAC3BuwB,IAASxwB,EAAG,EAAGC,EAAG,GAClByrB,IAAO1rB,EAAG,EAAGC,EAAG,GAChBoxC,IAAWrxC,EAAG,EAAGC,EAAG,GACpBqxC,IAAWtxC,EAAG,EAAGC,EAAG,GACpBsxC,UAGIC,GAAkB,SAAUx/B,OAC1By/B,GAAUzxC,EAAG,EAAGC,EAAG,GACvByxC,EAAKP,GACLQ,EAAKP,GACLQ,EAAKphB,GACLqhB,EAAKnmB,GAELqF,EAAK/e,EAAIA,EACT8/B,EAAK/gB,EAAK/e,EAENpC,KACF,EAAG,GAAI,EAAG,IACX,GAAI,EAAG,EAAG,KACT,EAAG,EAAG,EAAG,IACV,EAAG,EAAG,EAAG,aAGL5P,EAXD,EAAM,IAYT0xC,EAAG1xC,EAAI4P,EAAE,GAAG,GAAK+hC,EAAG3xC,EAAI4P,EAAE,GAAG,GAAKgiC,EAAG5xC,EAAI4P,EAAE,GAAG,GAAKiiC,EAAG7xC,EAAI4P,EAAE,GAAG,IAAMkiC,GACnEJ,EAAG1xC,EAAI4P,EAAE,GAAG,GAAK+hC,EAAG3xC,EAAI4P,EAAE,GAAG,GAAKgiC,EAAG5xC,EAAI4P,EAAE,GAAG,GAAKiiC,EAAG7xC,EAAI4P,EAAE,GAAG,IAAMmhB,GACrE2gB,EAAG1xC,EAAI4P,EAAE,GAAG,GAAK+hC,EAAG3xC,EAAI4P,EAAE,GAAG,GAAKgiC,EAAG5xC,EAAI4P,EAAE,GAAG,GAAKiiC,EAAG7xC,EAAI4P,EAAE,GAAG,IAAMoC,GACrE0/B,EAAG1xC,EAAI4P,EAAE,GAAG,GAAK+hC,EAAG3xC,EAAI4P,EAAE,GAAG,GAAKgiC,EAAG5xC,EAAI4P,EAAE,GAAG,GAAKiiC,EAAG7xC,EAAI4P,EAAE,GAAG,OAE7D3P,EAjBD,EAAM,IAkBTyxC,EAAGzxC,EAAI2P,EAAE,GAAG,GAAK+hC,EAAG1xC,EAAI2P,EAAE,GAAG,GAAKgiC,EAAG3xC,EAAI2P,EAAE,GAAG,GAAKiiC,EAAG5xC,EAAI2P,EAAE,GAAG,IAAMkiC,GACnEJ,EAAGzxC,EAAI2P,EAAE,GAAG,GAAK+hC,EAAG1xC,EAAI2P,EAAE,GAAG,GAAKgiC,EAAG3xC,EAAI2P,EAAE,GAAG,GAAKiiC,EAAG5xC,EAAI2P,EAAE,GAAG,IAAMmhB,GACrE2gB,EAAGzxC,EAAI2P,EAAE,GAAG,GAAK+hC,EAAG1xC,EAAI2P,EAAE,GAAG,GAAKgiC,EAAG3xC,EAAI2P,EAAE,GAAG,GAAKiiC,EAAG5xC,EAAI2P,EAAE,GAAG,IAAMoC,GACrE0/B,EAAGzxC,EAAI2P,EAAE,GAAG,GAAK+hC,EAAG1xC,EAAI2P,EAAE,GAAG,GAAKgiC,EAAG3xC,EAAI2P,EAAE,GAAG,GAAKiiC,EAAG5xC,EAAI2P,EAAE,GAAG,QAI/D6hC,EAAOzxC,IACPyxC,EAAOxxC,OAssCZupC,GAAWuI,UA1rCK,SAAU/sB,OACtBoG,EAAO4mB,UAA2B,IAAfhtB,EAAIitB,YAErBC,EAA4B,IAAfltB,EAAIitB,OAEnBjtB,EAAImtB,UACCC,sBAAsB,EAAG,MAGvBzoC,GAAE,iBAAiB,GAAG0oC,eAAe/vB,cAE1C/G,EAAKlE,GAAe2N,EAAIstB,MAAOttB,EAAIutB,MAAO/B,IAC9CvqB,EAAS1K,EAAGvb,EAAIob,EAChB8K,EAAS3K,EAAGtb,EAAImb,IAEdhe,iBAEA80C,OACY,YACG32B,OAQfvb,EAAIimB,EAAS7K,EACfnb,EAAIimB,EAAS9K,EACX6J,EAAcyC,GAAe1C,GAEL,MAAxBC,EAAY7Q,SAAqD,IAAlC6Q,EAAYsK,WAAWtyB,WAC1CgoB,EAAYmL,gBAItBoiB,EAAQxyC,KACJklB,GAASllB,MACbyyC,EAAQxyC,QACJklB,GAASllB,EAEfwpC,EAAU4C,iBACRhmB,GAAWrmB,KACXqmB,GAAWpmB,MACNomB,GAAWnB,OACXmB,GAAWlB,KAMlBF,IAAgBc,EAAgB0iB,qBAA8C,MAAvBqC,EAAiB,GAAY,KAChFhC,EAAO9jB,EAAI9nB,OACXw1C,EAAWtU,GAAO0K,EAAM,QAEb,WAAb4J,KACY,SAEQ,WAAbA,OACK,YACMtU,GAAO0K,EAAM,UAErBgC,EAAiB,MAGhB7lB,EAAY5gB,aAAa,iBACtC2K,SAAG2jC,SACD56B,EAAQhG,EAAiBkT,UACvB4oB,QACH,gBACO,KACU,OAChBqE,QAAwB,GAExBjtB,IAAgBzZ,MAEbs/B,EAAiBzgC,SAAS4a,KAGxBD,EAAIQ,aAEQ,OAEDP,OACDA,IACHjK,UAITk3B,MAGEljC,EAAI,EAAGA,EAAI87B,EAAiB7tC,SAAU+R,KACd,MAAvB87B,EAAiB97B,QACf4jC,EAAQ7gC,EAAiB+4B,EAAiB97B,IAC5C4jC,EAAMpuC,gBACF8G,iBAAiBE,EAAQ4B,qBAAsB,KAE/CC,WAAW7B,EAAQ4B,4BAIrB8kC,WAEI,cACG,MAAbtsB,QACUG,EAAgBC,uBASbJ,UAPNxK,QACAA,QASF,SACC,UACC,UACR,gBAGF,WACO,EACO,MAAbwK,QACUG,EAAgBC,uBAEbJ,MACZ4sB,EAAQp3B,IACRo3B,EAAQp3B,QACJ,SACC,UACC,UACR,eAEA,aACO,KACDpb,KACAC,KAIEmpB,GAAazf,GAAE,iBAAiB,QACrCkgB,QACJnP,KAAKu2B,GAAU,SAAUtiC,EAAKc,KAC3Bd,GAAOc,EAAM2L,OAEPyO,MAIL/d,EAAMgK,GAAiBmP,GAAe,EAAI,KAE5CnN,GAAmBC,KACfzM,iBAAiBE,EAAQ4B,qBAAsBtB,KAC/CR,iBAAiBE,EAAQ4B,qBAAsBtB,KAC/CR,iBAAiBE,EAAQ4B,qBAAsBtB,aAE/CuB,WAAW7B,EAAQ4B,wBACnBC,WAAW7B,EAAQ4B,wBACnBC,WAAW7B,EAAQ4B,sBAErBmB,IAA4B,KAKxBskC,EAAW7kC,IAEb8kC,SACAD,MACc,SAAUE,OAClBC,EAAUD,EAAIrjB,eAAe,KAAM,YACrCqR,kBAAkB,KAAM,UAEZ,OAAZiS,GAAkBC,WAAW,aAAkBpjB,eAAe,KAAM,SAAUmjB,IAAa,OAGvFnmC,MAAMC,aAAe,qBAC7B+lC,KAA0B5tB,OAExB6Q,EAAM7Q,EAAYopB,qBAAqB,KAC3Cx/B,EAAMinB,EAAI74B,WACP+R,EAAI,EAAGA,EAAIH,EAAKG,IACd8mB,EAAI9mB,GAAGnC,UAGRmC,GAAGnC,MAAMC,aAAe,qBACxB+lC,KAA0B/c,EAAI9mB,eAKrC,gBACA,aACA,YACGhP,EAAIwyC,KACJvyC,EAAIwyC,MACA,KACFD,EAAQ,IAAMC,EAAQ,MACkB,IAAtCrhC,WAAWy5B,EAASH,cAAsB,EAAIG,EAASH,wBAEtD,sBACE,eAED3iB,MACJE,SACE,eACG4iB,EAASnT,QAAU,mBACV,cACX,4BAGFnf,KAAOi6B,KACP/5B,KAAO+5B,KACP75B,KAAO85B,KACPrK,KAAOqK,YAEb,YACO,MACJS,EAAWlrB,WACN,4BAIA,SACC,KACJC,YACK4iB,EAASnT,QAAU,QACrB,+BAGHwb,EAAUC,OACED,aAEjB,aAIA,WACO,KACDlzC,KACAC,aAEE,kBACE,sBAIF,SACC,KACJgoB,YACK4iB,EAASnT,QAAU,eAI7B,WACO,IACkC,IAAlClW,OAAOqpB,EAASH,cAAsB,EAAIG,EAASH,wBAElD,kBACE,WAEL1qC,KACAC,KACAD,KACAC,KACAgoB,WACI4iB,EAASO,sBACDuH,qBACI9H,EAASQ,mCACVR,EAASS,iCACVT,EAASU,gCACTV,EAASW,oBACrB,eACGX,EAASnT,QAAU,QACrB,mCAIR,aACO,aAEC,oBACE,WAEL13B,KACAC,IACD,KACCgoB,YACK4iB,EAASnT,QAAU,eAI7B,cACO,aAEC,qBACE,WAEL13B,KACAC,KACA,KACA,KACAgoB,YACK4iB,EAASnT,QAAU,eAI7B,WACO,EACY1P,WACX,kBACE,mBAILC,SACEmrB,GAAQ1N,oBACE0N,GAAQ1I,yBACX0I,GAAQzI,wBACNyI,GAAQxI,0BACR,qBACF,mBACJC,EAASnT,qBAKnB,WAEA,eACOtc,MACAA,IACEi4B,UAAUruB,EAAKC,EAAaC,GAAQC,QACtC,YAEP,eACO/J,MACAA,KACEi4B,UAAUruB,EAAKC,EAAaC,GAAQC,QACtC,YAEP,aACO,IAEHoU,QAAQ+Z,oBAAoB,YAAaxI,OAgB5CyI,EAAYhF,GAAc,mBACvBvpB,UACEE,WACAC,wBAER,MAEDzK,KAAK64B,EAAW,SAAUvkC,EAAGoU,GACzBA,GAAKA,EAAEowB,cACC,QAq0BkBC,UAvzBhB,SAAUzuB,MACrBwuB,IACc,IAAfxuB,EAAIitB,SAAgB7mB,EAAO4mB,cAE3BhjC,SAAG8Y,SAAQhY,SAAIC,SAAIsJ,SAAIC,SAAIzK,SAAKrN,SAAOkiB,SACzCtF,EAAW0sB,EAAiB,GAE5BvvB,EAAKlE,GAAe2N,EAAIstB,MAAOttB,EAAIutB,MAAO/B,IAC1CvqB,EAAS1K,EAAGvb,EAAIob,EAChB8K,EAAS3K,EAAGtb,EAAImb,EAChBqvB,EAAQ5uB,GAAQ+K,KAEd4rB,EAAQvsB,EAAS7K,EACjBpb,EAAIwyC,EACJC,EAAQvsB,EAAS9K,EACjBnb,EAAIwyC,EAEJhJ,EAAU4C,iBACRhmB,GAAWrmB,KACXqmB,GAAWpmB,MAGb7C,qBACA2a,gBACI81B,QACH,YAIyB,OAAxB/C,EAAiB,GAAa,MAC3B9qC,EAAIklB,KACJjlB,EAAIklB,GAELskB,EAAU4C,iBACPhmB,GAAWhN,KACXgN,GAAW/M,IAGd0L,EAAIQ,SAAU,SACVtM,GAAYgM,GAAQC,GAAQnlB,EAAGC,OACnCD,MAAGC,KAGI,IAAPoZ,GAAmB,IAAPC,EAAU,OAClBwxB,EAAiB7tC,OAClB+R,EAAI,EAAGA,EAAIH,GAEE,SADLi8B,EAAiB97B,MADPA,EAAG,KAWlBW,EAAQnE,EAAQ4B,uBACd2E,EAAiBqM,KAKnB0kB,aAAazpB,EAAIC,GACnBvB,EAAMvT,gBACF2G,YAAYwE,EAAO,KAEnBtC,WAAWsC,KAIH29B,gBAAgBlvB,GAAU0oB,WAGvC,aAAcgE,UAIvB,IAAK,iBACI1vB,KACAA,KACQwK,MACZtd,KAAKkQ,IAAIu4B,GAASyB,KAClBlqC,KAAKkQ,IAAIw4B,GAASyB,SACdnqC,KAAKuP,IAAI26B,EAAQzB,WAChBzoC,KAAKuP,IAAI46B,EAAQzB,KACxB,SAMGL,EAAgB7F,EAAiBv5B,QAAS87B,KAC9CqG,EAAUtE,WAGNsE,EAAQz2C,OACT+R,EAAI,EAAGA,EAAIH,IAAOG,EAAG,KAClB2kC,EAAUD,EAAQ1kC,GAEnB87B,EAAiBzgC,SAASspC,MAClBltC,KAAKktC,OAGZC,EAAWjD,EAAc9vB,QAAQ8yB,IACrB,IAAdC,KACYrtC,OAAOqtC,EAAU,GAI/BjD,EAAc1zC,OAAS,KAClByzC,oBAAoBC,GAGzBtD,EAAWpwC,OAAS,KACfqsB,eAAe+jB,SAIxB,IAAK,WAIGt7B,EAAiBqM,OACnBy1B,EAAY/7B,GAAmBC,QAC/B87B,EAAY5C,GAAW7nB,GAAahL,IAC3Bpe,EACb8zC,EAAMpwB,EAAIzjB,IACQyjB,EAAjBlX,IAAAA,MAAOJ,IAAAA,YACJpM,EAAIklB,KACJjlB,EAAIklB,GAENskB,EAAU4C,iBACPhmB,GAAWhN,KACXgN,GAAW/M,KACP+M,GAAWja,KACZia,GAAW7Z,MAIbsJ,GAAiBsI,GACd,KACHgF,EAAI9a,KAAKgL,KAAK+F,EAAKA,EAAKC,EAAKA,GACjC+J,EAAQ/a,KAAKiR,MAAMD,EAAID,GAAM7X,EAAQ8G,KAAK8Q,GAAK,MAC5CgK,EAAI9a,KAAKqR,IAAI0J,KACbD,EAAI9a,KAAKsR,IAAIyJ,GAKfgtB,GAAkBhmC,SAAS,MAASgmC,GAAkBhmC,SAAS,SAC7D,GAEFgmC,GAAkBhmC,SAAS,MAASgmC,GAAkBhmC,SAAS,SAC7D,SAIA,EAAGs4B,EAAK,EACboR,EAAK3nC,GAAUA,EAASkN,GAAMlN,EAAS,EACvC4nC,EAAKxnC,GAASA,EAAQ6M,GAAM7M,EAAQ,EAElC6jC,GAAkBhmC,SAAS,SACxB+B,GAAUA,EAASkN,GAAMlN,EAAS,IAClCA,GAIHikC,GAAkBhmC,SAAS,SACxBmC,GAASA,EAAQ6M,GAAM7M,EAAQ,IAC/BA,OAID83B,EAAkB94B,EAAQ4B,qBAC9Bm3B,EAAQ/4B,EAAQ4B,qBAChBo3B,EAAgBh5B,EAAQ4B,wBAEtBq8B,EAAU4C,iBACLhmB,GAAW4tB,KACb5tB,GAAWqc,KACVrc,GAAWytB,KACZztB,GAAWsc,MAGFG,eAAemR,EAAOvR,KAAOoR,EAAMnR,IAC/C3d,EAAIQ,WACK,IAAPwuB,IACGD,IACOC,KAEVvP,SAASuP,EAAID,KAELjR,aAAamR,EAAOvR,EAAIoR,EAAMnR,GACxCkR,EAAW,KACP9nB,EAAOvqB,EAAQ,EAAI,IACnB2J,YAAYm5B,EAAiB,EAAIvY,KACjC5gB,YAAYo5B,EAAO,EAAIxY,KACvB5gB,YAAYq5B,EAAehjB,OAAOuK,QACnC,KACCR,GAAIxT,EAAMvT,gBACV2G,YAAYq5B,EAAejZ,GAAI,KAC/BpgB,YAAYo5B,EAAOhZ,GAAI,KACvBpgB,YAAYm5B,EAAiB/Y,GAAI,KAGzB+hB,gBAAgBlvB,GAAU0oB,WAErC,aAAcgE,SAGnB,IAAK,UACI1vB,KACAA,KACQwK,MACZtd,KAAKkQ,IAAIu4B,GAAU31B,EAAao3B,KAChClqC,KAAKkQ,IAAIw4B,GAAU51B,EAAaq3B,SAC5BnqC,KAAKuP,IAAI26B,EAAQzB,GAAU31B,UAC1B9S,KAAKuP,IAAI46B,EAAQzB,GAAU51B,IAClC,WAEH,IAAK,UACYqvB,YAGd,WAEH,IAAK,OACDhB,EAAU4C,iBACRhmB,GAAWrmB,KACXqmB,GAAWpmB,QAGbW,GAAKZ,EACLa,GAAKZ,EAEL+kB,EAAIQ,iBACAtM,GAAYgM,GAAQC,GAAQvkB,GAAIC,KAC7Bb,KACJ8nB,EAAI7nB,KAGL4vB,eAAe,KAAM,KAAMjvB,MAC3BivB,eAAe,KAAM,KAAMhvB,UAEjC,IAAK,oBAEF,aAEA,WAEA,YACGqzC,GAA0B,WAAhBrG,IAA6B7oB,EAAIQ,SAE/CtN,GAAI5P,KAAKuP,IAAI7X,EAAIklB,IACjB/M,GAAI7P,KAAKuP,IAAI5X,EAAIklB,IACfrF,UAAMC,UACNm0B,OACE/7B,GAAI7P,KAAKoQ,IAAIR,GAAGC,OACb+M,GAASllB,EAAIklB,GAASA,GAAShN,MAC/BiN,GAASllB,EAAIklB,GAASA,GAAShN,QAE/B7P,KAAKkQ,IAAI0M,GAAQllB,MACjBsI,KAAKkQ,IAAI2M,GAAQllB,IAGtBwpC,EAAU4C,kBACRhmB,GAAWnO,OACXmO,GAAWlO,OACRkO,GAAWvG,OACXuG,GAAWtG,QAGH0qB,SACRvyB,UACCC,KACL2H,KACAC,IACF,WAGH,IAAK,gBACDpW,GAAE8gC,GAAO/7B,MAAM,KAAM,YACvBoB,QAAIC,OACFokC,GAAM7rC,KAAKgL,MAAMtT,EAAI8P,IAAO9P,EAAI8P,IAAO7P,EAAI8P,IAAO9P,EAAI8P,IACtD05B,EAAU4C,kBACNhmB,GAAW8tB,OAEbtkB,eAAe,KAAM,IAAKskB,UAEhC,IAAK,iBACDxqC,GAAE8gC,GAAO/7B,MAAM,KAAM,YACvBoB,QAAIC,GACF05B,EAAU4C,iBACRhmB,GAAWrmB,KACVqmB,GAAWvW,KACZuW,GAAWpmB,KACVomB,GAAWtW,MAEZ8f,eAAe,KAAM,KAAMvnB,KAAKuP,IAAI7X,EAAI8P,QACxCwiB,GAAKhqB,KAAKuP,IAAImN,EAAIQ,SAAYxlB,EAAI8P,EAAO7P,EAAI8P,KAC7C8f,eAAe,KAAM,KAAMyC,cAG9B,gBACA,YACM/Z,KAAOjQ,KAAKkQ,IAAIg6B,EAAO1B,GAASv4B,SAChCE,KAAOnQ,KAAKoQ,IAAI85B,EAAO1B,GAASr4B,SAChCE,KAAOrQ,KAAKkQ,IAAIi6B,EAAO3B,GAASn4B,SAChCyvB,KAAO9/B,KAAKoQ,IAAI+5B,EAAO3B,GAAS1I,UAGtC,eAGCpoC,EAAIwyC,EAAO9mB,GAAIzrB,EAAIwyC,EACnBtB,GAAenxC,GAAKmxC,GAAelxC,MAChC+O,EAAI,EAAGA,EAAIolC,EAAgBplC,UAClBA,EA7vBL,MA+vBGwiC,IADOxiC,EAAI,GA9vBd,OAgwBGqiC,MACAG,GAAgBD,SACXjpC,KAAKgL,MAAMg+B,GAAQtxC,EAAIqxC,GAAQrxC,IAAMsxC,GAAQtxC,EAAIqxC,GAAQrxC,IAAMsxC,GAAQrxC,EAAIoxC,GAAQpxC,IAAMqxC,GAAQrxC,EAAIoxC,GAAQpxC,KAnwB7G,GAowBmB,KApwBnB,OAwwBPo0C,GAAQ5oC,EAAWkS,oBACnB3d,EAAIqxC,GAAQrxC,KACZC,EAAIoxC,GAAQpxC,IACZ4I,OAAOwE,WAAWgnC,QAIZr0C,EAAGoxC,GAAepxC,EAAGC,EAAGmxC,GAAenxC,OACvCD,EAAGwwB,GAAMxwB,EAAGC,EAAGuwB,GAAMvwB,OAC9BD,EAAG0rB,GAAI1rB,EAAGC,EAAGyrB,GAAIzrB,SAG1B,IAAK,WAGF,iBACEmb,KACAA,EAEDquB,EAAU4C,iBACRhmB,GAAWrmB,KACXqmB,GAAWpmB,MACNomB,GAAWnB,OACXmB,GAAWlB,KAElBH,EAAIQ,SAAU,KACTxa,GAAQihC,GACXvrC,UAAIC,UACJqK,OACGA,GAAKua,SAAWva,GAAKua,SAAS,GAAKL,MACnCla,GAAKua,SAAWva,GAAKua,SAAS,GAAKJ,QAEnCD,MACAC,aAEDjM,GAAYxY,GAAIC,GAAIX,EAAGC,QAC3BD,OAAGC,EAGH2lB,IAAmD,SAAtCA,GAAUvhB,aAAa,gBAC7B+W,KACAA,KACQwK,MACZtd,KAAKkQ,IAAIu4B,GAAU31B,EAAao3B,KAChClqC,KAAKkQ,IAAIw4B,GAAU51B,EAAaq3B,SAC5BnqC,KAAKuP,IAAI26B,EAAQzB,GAAU31B,UAC1B9S,KAAKuP,IAAI46B,EAAQzB,GAAU51B,IAClC,QAEOk5B,UAAUt0C,EAAGC,SAGzB,IAAK,cACAmb,KACAA,KAUOk5B,UAAUruB,EAAQC,SAG9B,IAAK,cACCkD,GAAahL,IACVpe,EAAI0jB,EAAIlX,MAAQ,IACpBkX,EAAIzjB,EAAIyjB,EAAItX,OAAS,MACpBwD,GAAIqJ,GAAUmF,GAClB6xB,GAAS54B,GAAevH,EAAIC,EAAIH,MAC7BqgC,GAAOjwC,IACPiwC,GAAOhwC,KACFqI,KAAKiR,MAAMxJ,EAAK9P,EAAG6P,EAAK9P,IAAM,IAAMsI,KAAK8Q,IAAO,IAAM,IAC5DqwB,EAAU4C,iBACJhmB,GAAW7kB,IAEjBwjB,EAAIQ,aACO,GACLld,KAAKoR,MAAMlY,EADN,OAIRsuC,iBAAiBtuC,GAAS,IAAO,IAAMA,EAASA,GAAO,KACzD,aAAcspC,MAeP,mBACL9lB,UACEiB,UACAC,kBAyY0C0O,MAP5B,SAAU/mB,YACjCzQ,kBACK,IAKwE6e,SAjDhE,SAAU+I,OAEnB/P,EADY+P,EAAI9nB,OACGsX,cAGrBS,IAAWsmB,OAEXtW,EAAcyC,GAAe1C,GAC1B5Q,EAAW6Q,EAAX7Q,WAES,SAAZA,GAAsC,aAAhBy5B,GAA4B,KAC9CtyB,EAAKlE,GAAe2N,EAAIstB,MAAOttB,EAAIutB,MAAO/B,OACpC1vB,OAAOmE,EAAa1J,EAAGvb,EAAGub,EAAGtb,GAG1B,MAAZmU,GAA+B,MAAZA,IACtB0B,GAAiBmP,QAMGA,KACN6lB,EAAiB,MAChB,IAGbvP,QAIoB,MAAnBtmB,EAAOb,SAAsC,MAAnBa,EAAOb,SACpCa,IAAWgpB,IAAoBe,mBAC/B/Z,IAAgBc,EAAgB0iB,wBAKlBxjB,MAWkFsvB,QAvXpF,SAAUvvB,MACL,IAAfA,EAAIitB,YACFuC,EAAmBC,SACV,KACVjB,QACCj4B,EAAKlE,GAAe2N,EAAIstB,MAAOttB,EAAIutB,MAAO/B,IAC9CvqB,EAAS1K,EAAGvb,EAAIob,EAChB8K,EAAS3K,EAAGtb,EAAImb,EAChBpb,EAAIimB,EAAS7K,EACbnb,EAAIimB,EAAS9K,EAEX4N,EAAUnN,GAAQ+K,KAClB8tB,GAAO,EAELlC,EAAQxyC,EACRyyC,EAAQxyC,MAIJ,MACNuV,SAAOxD,gBACH67B,QAEH,aACA,cACc,MAAbjoB,QACQxhB,aAAa,UAAW,kBAGtB,aAEX,YACwB,MAAvB0mC,EAAiB,GAAY,IAEJ,MAAvBA,EAAiB,GAAY,KAEzB1sB,EAAW0sB,EAAiB,UAC1B1sB,EAAShK,aACZ,QACA,UACA,YACA,iCAGWsxB,KAAOtnB,EAAS/Z,aAAa,WAC7BonC,aAAertB,EAAS/Z,aAAa,mBACrC+mC,OAAShtB,EAAS/Z,aAAa,aAC/BmnC,eAAiBptB,EAAS/Z,aAAa,qBACvCqmC,aAAetsB,EAAS/Z,aAAa,mBACrCgnC,iBAAmBjtB,EAAS/Z,aAAa,uBACzCinC,gBAAkBltB,EAAS/Z,aAAa,sBACxCknC,eAAiBntB,EAAS/Z,aAAa,kBAG9B,SAArB+Z,EAAShK,aACHu2B,UAAYvsB,EAAS/Z,aAAa,gBAClCumC,YAAcxsB,EAAS/Z,aAAa,kBAE9BipC,gBAAgBlvB,GAAUgrB,WAAU,WAQlDoJ,IAAUzB,IAAW0B,IAAUzB,WAC3BniC,EAAMi8B,EAAiB7tC,OACpB+R,EAAI,EAAGA,EAAIH,GACS,MAAvBi8B,EAAiB97B,KADIA,EAEpB87B,EAAiB97B,GAAGohB,cAEPkd,gBAAgBxC,EAAiB97B,IAAI83B,gBAKrD9hB,EAAI9nB,OAC6B,SAAjC4tC,EAAiB,GAAGnhB,UAA8C,MAAvBmhB,EAAiB,KAClDhqB,OAAOgqB,EAAiB,IAG3B9lB,EAAIQ,UACTgvB,IAAqBxiC,KAChB0+B,qBAAqB1+B,OAM9BzD,IAA4B,KACxBU,EAAO67B,EAAiB,GAC1B77B,MACG4G,gBAAgB,YACZ5G,EAAM,SAAUA,KAClB4G,gBAAgB,wBAM1B,OACc,MAAb+P,OACQxhB,aAAa,UAAW,YAE9BuwC,EAAS3vB,EAAIQ,SAAW,GAAM,gBAC/B,YACAld,KAAKkQ,IAAIu4B,GAASyB,KAClBlqC,KAAKkQ,IAAIw4B,GAASyB,SACdnqC,KAAKuP,IAAI26B,EAAQzB,WAChBzoC,KAAKuP,IAAI46B,EAAQzB,mBAIxB,YAKW,MACIhxC,EAAG,EAAGC,EAAG,OACTD,EAAG,EAAGC,EAAG,OAClBD,EAAG,EAAGC,EAAG,OACXD,EAAG,EAAGC,EAAG,OACVooC,EAASrf,EAAQ3kB,aAAa,UAC9BuwC,EAAavM,EAAOxnB,QAAQ,QAC9B+zB,GAAc,EACTvM,EAAOxnB,QAAQ,IAAK+zB,EAAa,IAAM,EAEvCvM,EAAOxnB,QAAQ,IAAKwnB,EAAOxnB,QAAQ,KAAO,IAAM,OAG7CkE,EAAY8vB,uBAAuB7rB,cAG5C,SACKrf,GAAEqf,GAASta,MAAM,KAAM,KAAM,KAAM,SACnC8G,EAAM9U,KAAO8U,EAAM5U,IAAM4U,EAAM7U,KAAO6U,EAAM3U,aAEjD,oBACA,aACA,WACA,UACK8I,GAAEqf,GAASta,MAAM,QAAS,aAE1B8G,EAAMhJ,OAASgJ,EAAMpJ,QAA2B,UAAhByhC,aAErC,WACmC,MAA9B7kB,EAAQ3kB,aAAa,eAE1B,YACKsF,GAAEqf,GAASta,MAAM,KAAM,SACvB8G,EAAM6c,IAAM7c,EAAM8c,aAEvB,YACEwe,GAASr4B,KAAOq4B,GAASv4B,KAAQ,GACnCu4B,GAAS1I,KAAO0I,GAASn4B,KAAQ,MACxBqP,WACC,qBACE,YAEJ8oB,GAASv4B,KAAOu4B,GAASr4B,MAAQ,MACjCq4B,GAASn4B,KAAOm4B,GAAS1I,MAAQ,MACjC0I,GAASr4B,KAAOq4B,GAASv4B,MAAQ,MACjCu4B,GAAS1I,KAAO0I,GAASn4B,MAAQ,KAClCiO,SAGH,WAAYoC,OACV,aAGN,SACE8nB,GAASr4B,KAAOq4B,GAASv4B,KAAQ,GACnCu4B,GAAS1I,KAAO0I,GAASn4B,KAAQ,MACxBqP,WACC,kBACE,UAEN8oB,GAASv4B,OACTu4B,GAASn4B,WACJm4B,GAASr4B,KAAOq4B,GAASv4B,YACxBu4B,GAAS1I,KAAO0I,GAASn4B,QAC9BiO,SAGH,WAAYoC,OACV,aAGN,UACI,MACKA,OACAwH,MAAMxH,aAEf,SAEO,SAEA,MAEJ8rB,EAAM/vB,EAAYgwB,QAAQ/vB,EAAKgE,EAAS/C,EAAQC,KACzC4uB,EAAX9rB,UACQ8rB,EAARJ,eAEC,cACI,IACG,OACEK,QAAQ/vB,aAEjB,cACI,IACG,QACE+vB,QAAQ/vB,EAAKiB,EAAQC,aAE9B,YACI,IACG,QACI,aACRhP,EAAWkU,EAAOmO,QAAQyb,uBAC3B99B,EAASo5B,aACQp5B,UAIjB,UAAW4zB,OAeZyI,EAAYhF,GAAc,iBACvBvpB,UACEiB,UACAC,IACR,SAEDxL,KAAK64B,EAAW,SAAUvkC,EAAGoU,GACzBA,MACKA,EAAEsxB,MAAQA,IACJtxB,EAAX4F,WACQ5F,EAAEowB,SAAWA,MAItBkB,GAAmB,MAAX1rB,GAyBN,GAAe,MAAXA,EAAiB,GAKnBisB,UAAW,MAIdC,EAAS,GACTC,YACAlH,GAAQmH,cAAgBhkC,WAAW4X,EAAQ3kB,aAAa,cAAgBwmC,EAASnT,QAAS,GACrF/tB,GAAEskC,IAAS3nC,QAAQoI,SACpBm8B,EAASnT,YACRwd,IACJrL,SAAS7gB,SAGL,GAAGosB,eACR,MAAOvnC,YAEA,aAKA,WACLsnC,KAAanpC,WACT5H,aAAa,UAAWymC,EAASnT,WACjCtzB,aAAa,QAAS,6BACf4kB,GACK,SAAhB6kB,KACUtmB,WAAWyB,GACdygB,EAAU4L,eACPrsB,IAAU,KAIJ,IAAIhU,GAAqBgU,MAExC,WAAYA,KACP,IAATksB,QAlEyB,SACRI,UAAU1uB,OACtB5a,WACE,OAENgZ,EAAI9nB,OAKD8U,GAAKA,EAAEwC,YAAcxC,EAAEwC,WAAWA,YAAkD,MAApCxC,EAAEwC,WAAWA,WAAWJ,WACzEpC,EAAEwC,WAKa,SAAhBq5B,IAA2BvnB,KAC9BtU,IAAKA,EAAEwC,YACa,wBAApBxC,EAAEwC,WAAW9C,IACJ,cAATM,EAAEN,IAA+B,YAATM,EAAEN,OAGnB6jC,QAAQ,cACHvjC,IAAI,OA8CH,YAwDjBw3B,GAAWlkC,KACX,qCAOUuI,MACHA,EAAE2X,YAELpoB,qBACI4nB,EAAMnX,EAAE2nC,iBAEH7rC,GAAE,iBAAiB,GAAG0oC,eAAe/vB,cAE1CmzB,EAAW9rC,GAAE,aAEb+rC,EAAajM,EAAUkM,WAAa,GAAK,EAGzCp6B,EAAKlE,GAAe2N,EAAIstB,MAAOttB,EAAIutB,MAAO/B,IAG1CoF,EAAcH,EAASjpC,QACvBqpC,EAAcJ,EAASrpC,SAGvB0pC,EAAUF,EAXD,GAWwBF,EACjCK,EAAUF,EAZD,GAYwBH,EAGjCM,EAAgBF,EAAUtF,GAAS/iC,EACnCwoC,EAAgBF,EAAUvF,GAAS5iC,EAGnCsoC,EAAUT,EAAShiB,SACnB0iB,EAAcD,EAAA,KAAkBR,EAChCU,EAAaF,EAAA,IAAiBR,EAE9BW,EAASrxB,EAAIsxB,WAActxB,EAAIsxB,WAActxB,EAAIuxB,QAAWvxB,EAAIuxB,OAAS,KAC1EF,OAED1B,EAASrsC,KAAKoQ,IAAI,IAAOpQ,KAAKkQ,IAAI,EAAI,EAAI69B,IAE1CG,SAAOC,SACP9B,EAAS,KACHrsC,KAAKouC,KAAKZ,EAAUE,EAAgBrB,EAAS,KAAO,MACpDrsC,KAAKouC,KAAKX,EAAUE,EAAgBtB,EAAS,KAAO,QAEpDrsC,KAAKukB,MAAMipB,EAAUE,EAAgBrB,EAAS,KAAO,MACrDrsC,KAAKukB,MAAMkpB,EAAUE,EAAgBtB,EAAS,KAAO,SAE3DgC,EAAYruC,KAAKkQ,IAAIg+B,EAAOC,SACpBnuC,KAAKkQ,IAAI,GAAIlQ,KAAKoQ,IAAI,IAAMi+B,OACtBv7B,KAGTu7B,EAAYv7B,MAGfw7B,EAAav/B,GAAe8+B,EAAaC,EAAY5F,IAerDqG,MAXDt7B,EAAGvb,GAAKub,EAAGvb,EAAI42C,EAAW52C,GAAK20C,GAMhBgC,EAMMjB,EAAaE,EAAc,KAXhDr6B,EAAGtb,GAAKsb,EAAGtb,EAAI22C,EAAW32C,GAAK00C,GAMhBgC,EAMMjB,EAAaG,EAAc,KAG9CiB,QAAQH,MACb,SAASlnC,KAAiB,IAAZknC,GAAiB/jC,QAAQ,MAEpC,gBAAiBq9B,QAAQ,EAAO4G,aAChC,qBAWHE,GAAc3rB,EAAO2rB,YAAe,eACtCC,SACAC,SACAC,SACAC,SACAC,SACAC,KACAC,SACA9pC,SACAsb,SAAOC,SACPwuB,kBAEKC,EAAWrxC,OACZ6xB,EAA6B,KAApBif,EAAUroC,YACvBqoC,GAAWQ,SAER1oC,UAAU9R,UACT+6B,IACM,MACH,IACDif,EAAUS,eAAiBT,EAAUU,wBACjCV,EAAUS,iBAIhBE,EAASP,EAASlxC,GACnB6xB,KACO6f,kBAAkB1xC,EAAOA,MAE5B0V,GAAQ,oBAENxe,SAAS8G,gBAAgB5G,EAAGuM,IAAK,WACzBotC,MACX,qBACI,sBACQ,MAETr7B,GAAQ,uBAAuBG,YAAYk7B,IAGjDE,MACOU,YAAY,eACdp3B,EAA2C,SAAnCw2B,EAAO7yC,aAAa,aAC3BD,aAAa,UAAWsc,EAAO,SAAW,SAChD,UAGCq3B,EAAUC,EAAWJ,EAAO53C,EAAGs3C,EAAOr3C,GACtCg4C,EAAQD,EAAWJ,EAAO53C,EAAIs3C,EAAOr3C,EAAIq3C,EAAOlrC,WAErC8qC,MACXa,EAAQ/3C,KACR+3C,EAAQ93C,KACRg4C,EAAMj4C,KACNi4C,EAAMh4C,aACE,kBACH,WAGPk3C,KAAqB/yC,aAAa,IAAK,aAGpC8zC,EAAc1nB,EAAO9E,EAAKysB,MAC7B3nB,IAAU9E,GAKTysB,KACON,kBAAkBrnB,EAAO9E,MAG1B7P,GAAQ,yBAENxe,SAAS8G,gBAAgB5G,EAAGuM,IAAK,WAC3BqtC,MACX,wBACE,gBACG,SACF,2BAED,uBAAuBxrC,OAAOwrC,QAGlCiB,EAAUf,EAAS7mB,GACnB6nB,EAAQhB,EAAS3rB,KAEhBtnB,aAAa,aAAc,cAE5BuN,EAAKqmC,EAAWI,EAAQp4C,EAAGs3C,EAAOr3C,GACtCmY,EAAK4/B,EAAWI,EAAQp4C,GAAKq4C,EAAMr4C,EAAIo4C,EAAQp4C,GAAIs3C,EAAOr3C,GAC1DoY,EAAK2/B,EAAWI,EAAQp4C,EAAGs3C,EAAOr3C,EAAIq3C,EAAOlrC,QAC7CkM,EAAK0/B,EAAWI,EAAQp4C,GAAKq4C,EAAMr4C,EAAIo4C,EAAQp4C,GAAIs3C,EAAOr3C,EAAIq3C,EAAOlrC,QAEjEm2B,EAAO,IAAM5wB,EAAG3R,EAAI,IAAM2R,EAAG1R,EACjC,KAAOmY,EAAGpY,EAAI,IAAMoY,EAAGnY,EACvB,IAAMqY,EAAGtY,EAAI,IAAMsY,EAAGrY,EACtB,IAAMoY,EAAGrY,EAAI,IAAMqY,EAAGpY,EAAI,OAEXk3C,KACZ5U,UACM,kBArCC7W,YAyCL4sB,EAAmBryB,EAAQC,OAE5B3K,EAAK/P,EAAQmS,sBAChB3d,EAAIimB,IACJhmB,EAAIimB,EAGiB,IAApBmxB,EAASp6C,cAAuB,MAEhCs7C,EAAUvB,EAAQwB,qBAAqBj9B,GACvCg9B,EAAU,KAEFlB,EAASp6C,OAAS,EACxBgpB,GAAUoxB,EAAS,GAAGr3C,MACd,IAEHu4C,GAAWlB,EAASp6C,OAAS,MAC5Bo6C,EAASp6C,OAAS,OAExB26C,EAASP,EAASkB,UAEpBtyB,EADQ2xB,EAAO53C,EAAK43C,EAAOprC,MAAQ,OAIhC+rC,WAGAE,EAAoBxyB,EAAQC,KACzBoyB,EAAkBryB,EAAQC,aAG7BwyB,EAA0B14C,EAAGC,EAAG6O,OACjC6pC,EAAK1B,EAAUU,eACfiB,EAAKN,EAAkBt4C,EAAGC,KAElBqI,KAAKkQ,IAAImgC,EAAIC,GACftwC,KAAKoQ,IAAIigC,EAAIC,IACC9pC,YAGnB+pC,EAAYC,EAAKC,OAClB59B,KACD29B,IACAC,QAGD/4C,GAAKob,IACLnb,GAAKmb,EAEL5N,EAAQ,KACJ+N,EAAKlE,GAAe8D,EAAInb,EAAGmb,EAAIlb,EAAGuN,EAAO8U,aAC3CtiB,EAAIub,EAAGvb,IACPC,EAAIsb,EAAGtb,SAGNkb,WAGA68B,EAAYc,EAAKC,OAClB59B,KACD29B,IACAC,MAGDvrC,EAAQ,KACJ+N,EAAKlE,GAAe8D,EAAInb,EAAGmb,EAAIlb,EAAGuN,KACpCxN,EAAIub,EAAGvb,IACPC,EAAIsb,EAAGtb,WAGTD,GAAKob,IACLnb,GAAKmb,EAEFD,WAYA69B,EAAWh0B,KACL,EAAGgyB,EAAQnrC,YAAY5O,WAClCoB,MAAM46C,OAAOj0B,YAGRk0B,EAAYl0B,MACduyB,GAAaP,OAEZmC,EAAM9hC,GAAe2N,EAAIstB,MAAOttB,EAAIutB,MAAO/B,IAG3Cj1B,EAAKs9B,EAFAM,EAAIn5C,EAAIob,EACR+9B,EAAIl5C,EAAImb,GAGbjV,EAAQmyC,EAAkB/8B,EAAGvb,EAAGub,EAAGtb,GACnCwQ,EAAMumC,EAAQnrC,YACdrP,EAAQiU,EAAIyC,OAAO,EAAG/M,GAAOyK,QAAQ,cAAe,IAAI3T,OACxD2S,EAAIa,EAAIyC,OAAO/M,GAAOwK,MAAM,iBAErBnU,GADCoT,EAAIA,EAAE,GAAG3S,OAAS,GAAKkJ,MAInC6e,EAAI9nB,QAAQ03B,MAAMokB,cACT,cACPh0B,EAAI9nB,QAAQ+7C,OAAO,QAASD,IAC7B,6BAUK97C,EAAQ8C,EAAGC,KACP/C,KACEqqB,WAAWvnB,EAAGC,mBAMrBgP,KACKA,KACEsY,iCASHvC,EAAKC,EAAaC,EAAQC,OAC7B5J,EAAKs9B,EAAW3zB,EAAQC,KAEpBsyB,UACSl8B,EAAGvb,EAAGub,EAAGtb,KACpBilB,IACAC,sBASCc,EAAQC,OACX3K,EAAKs9B,EAAW5yB,EAAQC,KACL3K,EAAGvb,EAAGub,EAAGtb,qBAQ3B+kB,EAAKiB,EAAQC,OACd3K,EAAKs9B,EAAW5yB,EAAQC,KAEL3K,EAAGvb,EAAGub,EAAGtb,GAAG,GASnC+kB,EAAI9nB,SAAW85C,GACf/wB,EAAS6C,EAAQ,GACjB7C,EAAS6C,EAAQ,GACjB5C,EAAS6C,EAAQ,GACjB7C,EAAS6C,EAAQ,MAELG,cAAa,oCAcjBlpB,EAAGC,SACF,KACG,aACEqtC,gBAAgB0J,GAAS5N,WAAU,GAE5BrjB,EAAgBunB,gBAAgB0J,MAG3Cx8B,UAEVw8B,GAASoC,IAAI,SAAU,QAOpBrqC,UAAU9R,OAER,KACCse,EAAKs9B,EAAW74C,EAAGC,KACNsb,EAAGvb,EAAGub,EAAGtb,uBAGnB,cACE,GACV,4BAOSo5C,MACE,uBACAjC,KACJ,KACND,MAAcA,GAAUzoC,KAAK,UAAW,QACxCwoC,MAAYA,GAAQxoC,KAAK,aAAc,aACzCsoC,GAASoC,IAAI,SAAU,QAErBC,WAEArC,GAASoC,IAAI,SAAU,UAEpB,YAAapC,QACFA,IAAU,IAExBA,IAAYA,EAAQnrC,YAAY5O,UAE3BouB,4BAGP4rB,GAAWqC,UAEH,yBAUErqC,KACAA,oBAOQ,aAAhB4+B,OACU3kB,8BAOVqwB,MACCvC,OACDhoC,SAAG0c,SAMFsrB,EAAQxiC,eAEDs2B,EAAiB,KACXwC,gBAAgB0J,GAAS5N,WAAU,QAI/Cv6B,EADMmoC,EAAQnrC,YACJ5O,OAEV0S,EAAQqnC,EAAQ3yC,aAAa,mBAE1B+kB,GAAa4tB,KAEbrnC,EAAQsJ,GAAU+9B,GAAW,YAG7B/5C,OAAS4R,IACR4oC,WAERT,GAASiC,OAAO,WAAYC,GAAYj9B,SAASi9B,GAE9CrqC,OACI7O,EAAGs3C,EAAOt3C,EAAKs3C,EAAO9qC,MAAQ,EAAIA,MAAO,IAG7CwC,EAAI,EAAGA,EAAIH,EAAKG,IAAK,KAClBwhB,EAAQwmB,EAAQjrC,uBAAuBiD,QACvCgoC,EAAQwC,qBAAqBxqC,IjB9lGIzD,EiBgmGP,KACxBkoB,EAASrI,EAAOquB,SAAWr+B,IAC3Bpb,GAAKyzB,IACPzzB,GAAKyzB,IAEHzzB,GAAKob,IACPpb,GAAKob,IAOFpM,MACJwhB,EAAMxwB,IACNs3C,EAAOr3C,QACHyrB,EAAI1rB,EAAIwwB,EAAMxwB,SACbs3C,EAAOlrC,UAKV3F,QACJilB,EAAI1rB,QACA,MAEIi3C,EAAUU,eAAgBV,EAAUS,cAAc,MA5bzB,GA2cpCgC,GAAuBr7C,KAAKq7C,qBAAuB,eACjDzpB,EAAOxkB,EAAWykB,uBAAuB3yB,EAAGuM,IAAK,YAClDmmB,IAASA,EAAKhzB,cAAiB,MAI9B08C,KACFC,EAAa,EACXpkC,GAAS,OAAQ,SAAU,SAAU,eAAgB,aAAc,cACnEqkC,EAAOrkC,EAAMvY,OAEb68C,EAASruC,EAAWykB,uBAAuB3yB,EAAGuM,IAAK,KACnDiwC,EAASD,EAAO78C,OAElB+R,SAAGM,aACFN,EAAI,EAAGA,EAAI+qC,EAAQ/qC,IAAK,KACrBsuB,EAAKwc,EAAO9qC,OACbM,EAAI,EAAGA,EAAIuqC,EAAMvqC,IAAK,KACnB2hB,EAAMzB,GAAe8N,EAAGj5B,aAAamR,EAAMlG,KAC7C2hB,KACUxqB,KAAKwqB,EAAI/d,OAAO,QAK1B4jB,EAAOnhB,GAAQ2nB,GACjBxG,GAAQA,EAAKpR,WAAW,QACdjf,KAAKqwB,EAAK5jB,OAAO,QAI3B8mC,EAAWrwC,GAAEsmB,GAAM5Q,KAAK,qEAC1B26B,EAAS/8C,OACN+R,KAAK,KACJirC,EAAUD,EAAShrC,GAClB0C,EAAMuoC,EAANvoC,GACFioC,EAAYtvC,SAASqH,QAERA,GAAMuoC,IACdjuC,qBAKL4tC,YA2TAM,aAKDC,KACAC,KAGAC,kBACYtgC,GAAUugC,2BACXvgC,GAAUwgC,2CACHxgC,GAAUygC,mBAE5BC,EAAU9wC,GAAE8B,SAGZ,SAAU9B,GAAE,YAAY,GAAG+wC,WAAW,UAChC9uC,KAAOmO,GAAU4gC,iBAG3BjgC,KAAK2/B,EAAW,SAAU9xB,EAAKqyB,GAC3BH,EAAQp7B,KAAKkJ,GAAKtrB,WACTwJ,KAAK8hB,KACT9hB,KAAKm0C,OAGRT,SAAQC,mBA9UbS,kBAAoB,gBAEhBnB,KAAyB,MAEpB1+B,OAAM,MAGhBN,KAAKjP,EAAW8jB,WAAY,SAAUvgB,EAAGwxB,GACrCxxB,GAAuB,IAAlBwxB,EAAKlR,UAAkBkR,EAAKtP,KAAK7mB,SAAS,mBACtC+lB,WAAWsC,OAAO8N,KAK7BjF,aAEUA,SAGRuf,QAGJrvC,GAAY4T,KAAK,gBAAgB3E,KAAK,mBAChClF,EAAQnX,KAAK4G,WACf4J,EAAM2G,EAAMvY,OACP+R,EAAI,EAAGA,EAAIH,EAAKG,IACG,OAAtBwG,EAAMxG,GAAG2a,UAA2C,UAAtBnU,EAAMxG,GAAG2a,iBAKzC9a,GAAO,EAAG,KACN5E,EAAM5L,KAAK+xB,aACP3pB,KAAKwD,MACb5L,MAAMqxC,YAAYzlC,UAGlB2iB,EAASvuB,KAAK08C,YAAYtvC,EAAY,UAGxCqvC,EAAU79C,WACV69C,GAAWpgC,KAAK,cACHrc,QAIVuuB,QAUJmuB,YAAc,SAAU9rC,EAAM+rC,OAC3B7/B,KACArI,EAAO22B,EAAUiC,SACjBuP,EAAS,IAAItnC,OAAO,eAAiBb,EAAO,QAE9C7D,EAAM,IACOA,OACTuG,EAAQrG,MAAM+rC,KAAKjsC,EAAKhK,YAC1B+J,SACEo/B,EAASn/B,EAAKsgB,iBACd9M,KAAK,SAAChV,EAAGC,UAAMD,EAAE7P,KAAO8P,EAAE9P,MAAQ,EAAI,IAEvCoR,EAAI,EAAGA,EAAIgsC,EAAQhsC,MAAWvI,KAAK,UACpCA,KAAK,KAAM0U,EAAI1U,KAAKwI,EAAK0a,UACb,eAAZ1a,EAAKyC,GAAqB,KAEtBojC,EAAMqG,KAeC,OAATroC,MACEoF,EAAIrF,GAAYiiC,EAAI58B,EAAGpF,GAAQA,IAC/BqF,EAAItF,GAAYiiC,EAAI38B,EAAGrF,GAAQA,KAGjCrM,KAAK,WAAaquC,EAAI58B,EAAI,aAAe48B,EAAI38B,EAAI,YAAwB5a,EAAGuM,IAAM,SAEhFsxC,QAGJnsC,GAAMoQ,KAAK,KAAKmf,UAAU9jB,KAAK,eAGzB2gC,EAAMh9C,KAAK6Q,aACbmsC,IAAQD,EAAOC,IAAQ9O,EAAM8O,IAAuB,UAAf9O,EAAM8O,IAAmC,QAAf9O,EAAM8O,OAChEA,IAAO,IACV50C,KAAK,UAAY8lC,EAAM8O,GAAO,KAAOA,EAAM,SAG/C3gC,KAAKrc,KAAK4G,WAAY,SAAU+J,EAAGN,OAC7B2sC,EAAM3sC,EAAKQ,aACbmsC,IAAQD,EAAOC,IAAuB,UAAf9O,EAAM8O,IAAmC,QAAf9O,EAAM8O,OAClDA,IAAO,IACV50C,KAAK,UAAY8lC,EAAM8O,GAAO,KAAOA,EAAM,YAKjD7lC,EAAMvY,eACJq+C,GAAa,QAAS,SAAU,QAAS,IAAK,IAAK,UAAW,KAAM,YACnEtsC,KAAK,KACJN,EAAO8G,EAAMxG,GACb8a,EAAUyC,GAAM7d,EAAKE,OAGvBF,EAAKib,SAASjE,WAAW,YAGb,KAAZoE,GAAmBwxB,EAAUjxC,SAASqE,EAAKstB,YACxCttB,EAAKQ,eAAgBq9B,EAAM79B,EAAKQ,kBAC/BzI,KAAK,OACLA,KAAKiI,EAAKib,UAAWxO,EAAI1U,KAAK,QAC9BA,KAAKqjB,GAAU3O,EAAI1U,KAAK,YAI7B,IAEiB,SAAlBwI,EAAK0a,WAAwB1a,EAAKmhB,sBAEhCmrB,GAAY,uBAAwB,4BACrCvsC,EAAIwG,EAAMvY,OAAS,EAAG+R,GAAK,EAAGA,IAAK,KAChCN,EAAO8G,EAAMxG,GACf8a,EAAUyC,GAAM7d,EAAKE,WAErB2sC,EAASlxC,SAASqE,EAAKstB,YACX,KAAZlS,EAAgB,IACdA,EAAQpE,WAAW,8BACA,UAAnBhX,EAAKstB,WAAyBlS,EAAQpE,WAAW,qBACjDjf,KAAK,KACc,MAAnBiI,EAAKstB,cAA+BjX,EAAYd,YAAYhV,GAAM,IACjE7I,MAAM0jB,GAEAmxB,EAAOrnC,KAAKkW,OACXrX,GAAWqX,GAAWhX,KAFtBL,GAAWqX,GAMnBgiB,GAAYh9B,OACI,UAAlBG,EAAK0a,UACc,SAAnBjb,EAAKstB,WACL8P,GAAY0P,QACW,UAAvB1P,GAAY0P,OACZ,KACM7mB,EAAM2Z,GAAgBxkB,GACxB6K,MAAiBA,GAKlBjmB,EAAKQ,cAAgBR,EAAKQ,eAAiB3R,EAAGuM,MAAOyiC,EAAM79B,EAAKQ,kBAC/DzI,KAAKiI,EAAKib,UAAWxO,EAAI1U,KAAK,QAC9BA,KAAKqjB,GAAU3O,EAAI1U,KAAK,WAMhCwI,EAAKmyB,gBAAiB,GACpB36B,KAAK,aAELg1C,GAAW,MAEVzsC,EAAI,EAAGA,EAAIo/B,EAAOnxC,OAAQ+R,IAAK,KAC5B2oB,EAAQyW,EAAO5nC,KAAKwI,UAClB2oB,EAAMrI,eACT,IACC7oB,KAAK,QACLA,KAAKpI,KAAK08C,YAAY3M,EAAO5nC,KAAKwI,GAAIgsC,eAEvC,MACGvqC,EAAMknB,EAAM+F,UAAU9sB,QAAQ,aAAc,IACtC,KAARH,OACS,IACPhK,KAAKgnB,OAAOlB,GAAM9b,iBAGrB,IACChK,KAAK,QACLA,KAAK,IAAI0I,MAAM6rC,EAAS,GAAGnrC,KAAK,QAChCpJ,KAAK,eACLA,KAAKkxB,EAAM+F,aACXj3B,KAAK,kBAEN,IACCA,KAAK,QACLA,KAAK,IAAI0I,MAAM6rC,EAAS,GAAGnrC,KAAK,QAChCpJ,KAAK,aACLA,KAAKkxB,EAAMzG,QACXzqB,KAAK,mBAKRg1C,QACCh1C,KAAK,MACJuI,EAAI,EAAGA,EAAIgsC,EAAQhsC,MAAWvI,KAAK,OAEtCA,KAAK,MAAO0U,EAAI1U,KAAKwI,EAAK0a,UAAWxO,EAAI1U,KAAK,YAE9CA,KAAK,aAGN0U,EAAItL,KAAK,UAgBb6rC,WAAa,SAAUplB,EAAKqlB,UACxB,IAAI9lB,QAAQ,SAAUG,EAASC,MAElC,IAAI2lB,OAASC,KAAK,SAAUC,EAAUC,EAAQC,MAC/B,UAAXD,OAKEE,EAAM5+C,SAAS64B,cAAc,YAC/B1pB,MAAQnO,KAAKmO,QACbJ,OAAS/N,KAAK+N,SAEdsuC,WAAW,MAAMwB,UAAU79C,KAAM,EAAG,WAGlC89C,EAAU,gBAAkBpuB,mBAAmBuI,KACzC2lB,EAAIG,YAAYxrC,QAAQ,UAAWurC,EAAU,cACvC7lB,GAAO6lB,EACvB,MAAOtuC,MACSyoB,IAAO,KAERA,EACbqlB,KAAqBrN,GAAgBhY,MACjCgY,GAAgBhY,WAnBf,IAAIryB,MAAM,wBAA0B+3C,EAAID,OAAS,IAAMC,EAAIK,eAoBnE3tC,KAAK,MAAO4nB,WAUdgmB,aAAe,SAAU7sC,MACXA,QAQd8sC,KAAO,kBAYPC,KAAO,SAAUC,OAIhBA,MAAUpZ,OAAOyI,GAAa2Q,MACtB3tC,OAAQ,MAGd2B,EAAMpS,KAAKw8C,sBACZ,QAASpqC,QAoCZisC,eAoCCC,aAAe,SAAUC,EAASC,EAASC,EAAkBC,gBAC1DtgD,EAAmB,QAAZmgD,EAAoB,MAASA,GAAW,MAC/CI,EAAW,SAAWvgD,EAAKqB,gBACJo8C,KAAtBC,IAAAA,OAAQC,IAAAA,WACTnwC,EAAM5L,KAAKw8C,2BAEV,IAAIhlB,qCAAQ,WAAOG,EAASC,iBAmBxBgnB,qGACD5tC,aACK6tC,UAASjzC,MAAKkwC,SAAQC,aAAY39C,KAAMmgD,aACvCC,UAASC,sBAEhB,WAAYztC,GACb0tC,KACC1tC,KAEGA,IA3BLqtC,mCACcpnB,GAAgBmU,EAAU0T,UAAY,mBAC7C,+BADRT,oBAIC/yC,GAAE,kBAAkB1M,WACrB,YAAayU,GAAI,kBAAkB0rC,OAAOvT,SAAS,WAE7ClgC,GAAE,kBAAkB,IAC5B6C,MAAQ4e,EAAOquB,WACfrtC,OAASgf,EAAOiyB,mBAEZX,GAAM/uC,EAAG1D,gBACKxN,EAAKqB,gBACT++C,EACZlvC,EAAEyuC,UAAU,SAAWkB,EAAaT,GACpClvC,EAAEyuC,UAAU,SAAWkB,aAavB3vC,EAAE4vC,iCACFA,OAAO,SAAC9uB,KACEJ,GAAgBI,QAEzBuuB,EAAUH,gCAGL7uB,GAAmBwvB,yGA8C5BC,UAAY,SAAUX,EAAkBY,EAAYX,gBACjDY,EAAOt/C,YACN,IAAIw3B,qCAAQ,WAAOG,EAASC,6GAC5Bj5B,OAAO4gD,sCAEJhoB,8BAIJ,yCAGuB,cAAe54B,QACrCA,OAAOy4B,YACqB,IAA7Bz4B,OAAOy4B,UAAUC,kBAEbE,GAAa6T,EAAUoU,UAAY,iCACjCC,EACF,SACA,6BAKI3C,OACQrG,EAAI58B,EAAI48B,EAAI38B,EAAI,YAAc,aAItCylC,0BAHC,aAMF9I,EAAI58B,EAAG48B,EAAI38B,OAGL4lC,OACbC,qBACKC,MAMoB/D,KAAtBC,IAAAA,OAAQC,IAAAA,aACHuD,EAAK9C,sBACbqD,OAAOj0C,EAAK,EAAG,OAONA,MAAKkwC,SAAQC,aAAY0C,mBAAkBY,aAD3CA,GAAc,kBAEvB9wB,OAAS6T,EAAI7T,OAAO8wB,GACpBX,KACC1tC,KAEGA,KACH,cAAeA,qGASnB8uC,aAAe,qBACNrvC,OAAQ,EACbzQ,KAAKw8C,0BAaTjd,aAAe,SAAUC,GACxB9uB,UAAU9R,OAAS,IAA6B,IAAxB4gC,MACR,EAAOI,SAEP,EAAMA,UAUtBmgB,GAAgB//C,KAAK+/C,cAAgB,SAAU7xC,OAC7C8xC,KASAC,GAAY,SAAU,iBAAkB,UAAW,iBAAkB,SAAU,WAAY,WAkD5F,IAAMC,QAhDFhyC,EAAG,SAAUqd,MAED,IAAfA,EAAE0F,SAAgB,CAEhB1F,EAAElY,KAEEkY,EAAElY,MAAM2sC,MAERz0B,EAAElY,KAAOzC,KAAM,KAAMuG,SAAWgpC,aAElC50B,EAAElY,IAAIzC,KAAO2a,MAKjBlP,KAAKszB,GAAU,SAAUh/B,EAAGN,OACtB+vC,EAAW70B,EAAE80B,iBAAiBhwC,MAChC+vC,EAAU,KAENrpB,EAAM5F,GAAeivB,EAAS7vC,OAClC+vC,EAAQvpB,EAAMA,EAAIliB,OAAO,GAAK,KAC5ByrC,IACIA,KAASN,MAETM,IAAU1vC,KAAM,KAAMuG,SAAWgpC,aAEnCG,GAAOnpC,MAAM/O,KAAKg4C,WAMtB3nB,EAAOnhB,GAAQiU,MAEjBkN,GAAQwnB,EAASj0C,SAASuf,EAAED,UAAW,KACnCg1B,EAAQ7nB,EAAK5jB,OAAO,GACtByrC,IACIA,KAASN,MAETM,IAAU1vC,KAAM,KAAMuG,SAAWgpC,aAEnCG,GAAOH,MAAM/3C,KAAKmjB,QAOVy0B,KACbE,OACEtvC,EAAQovC,EAAIE,GAAZtvC,QACHA,EAAM,KACF2vC,EAAQ32B,MAGTvW,GAAKktC,UAGHppC,EAAS6oC,EAAIE,GAAb/oC,MACHlG,EAAIkG,EAAMvY,OACPqS,KAAK,KACJZ,EAAO8G,EAAMlG,KACduvC,aAAaz6C,aAAasK,EAAK9Q,KAAM,QAAUghD,EAAQ,aAIxDE,EAAWT,EAAIE,GAAOC,MACxBxb,EAAI8b,EAAS7hD,OACV+lC,KAAK,KACJ+b,EAAUD,EAAS9b,MACjB+b,EAAS,IAAMH,OAYzBI,GAAa3gD,KAAK2gD,WAAa,SAAU/pC,OACzCkB,EAAQxM,GAAEsL,GAES,QAAnBA,EAAOb,YACD+B,EAAMkJ,KAAK,UAGf3E,KAAK,eACHhJ,EAAKiE,GAAQtX,MAAM6U,OAAO,GAC1B+rC,EAAUpjC,GAAQnK,GACnButC,OACH5gD,MAAM6yB,KAAK,MAAO+tB,GACI,WAApBA,EAAQ7qC,SAA4C,QAApB6qC,EAAQ7qC,YACxC/V,MAAM6yB,KAAK,SAAU+tB,GAAS/tB,KAAK,MAAO+tB,OAW5CC,GAAmB7gD,KAAK6gD,iBAAmB,SAAUjwC,OACrDkH,EAAQxM,GAAEsF,GAAMoQ,KAAK,mCACpBlJ,EAAMlZ,QAAU+Q,QAEXrE,GAAEsF,GAAMoQ,KAAK,KAAKkS,OAAO,kBACvBlzB,KAAK+V,QAAQ/J,SAAS,iBAI5BqQ,KAAK,cAE6B,mBAAlC/Q,GADStL,MACDqQ,KAAK,iBAAuC,KAEhDyH,EAAQxM,GAAE8B,GAAY4T,KAAK,eAHtBhhB,KAG4CqT,GAAK,qBAHjDrT,KAG6EqT,GAAK,WACxFyE,EAAMlZ,kBAGL4sB,EAAKT,GAAajT,EAAM,QAIzB0T,YAEgB,mBAbVxrB,KAaF+V,QAA8B,KAC/B+V,EAAUxgB,GAdPtL,MAceqQ,MAAM,KAAM,KAAM,KAAM,OAG1CqJ,EAjBG1Z,KAiBU4T,kBAAkB/E,WACjC6K,GAASA,EAAMvT,cAAgB,EAAG,KAC9BoL,EAAIgJ,GAAyBb,GAAOvK,OACpCyc,EAAM5S,GAAe8S,EAAQzpB,GAAIypB,EAAQxpB,GAAIiP,GAC7Csa,EAAM7S,GAAe8S,EAAQvpB,GAAIupB,EAAQtpB,GAAI+O,KAE3ClP,GAAKupB,EAAIjqB,IACTW,GAAKspB,EAAIhqB,IACTW,GAAKspB,EAAIlqB,IACTa,GAAKqpB,EAAIjqB,EA1BV5B,KA2BFwX,gBAAgB,wBA3BdxX,MA8BDqQ,UACDyb,EAAQzpB,GAAKmpB,EAAG7pB,GAAK6pB,EAAGrd,UACxB2d,EAAQxpB,GAAKkpB,EAAG5pB,GAAK4pB,EAAGzd,WACxB+d,EAAQvpB,GAAKipB,EAAG7pB,GAAK6pB,EAAGrd,UACxB2d,EAAQtpB,GAAKgpB,EAAG5pB,GAAK4pB,EAAGzd,SAlCtB/N,KAoCJwX,gBAAgB,sBAiCvBspC,GAAiB9gD,KAAK8gD,eAAiB,SAAUlwC,GAChDA,MACI67B,EAAiB,QAEpBsU,EAAQz1C,GAAEsF,GACViI,EAAW,IAAIlB,GACjBqpC,YAEAD,EAAMluB,KAAK,QAAS,KAEhBjnB,EAAMgF,EAAKmhB,WACX7U,EAAK5R,GAAEM,GAAKyE,MAAM,IAAK,SAE3BO,EAAKmhB,WAAWA,YAAYkvB,YAC5BrwC,GAAMswC,WAAW,YAEbxnC,EAAQhG,EAAiB9C,GACzBU,EAAQnE,EAAQ4B,uBAChB01B,aAAavnB,EAAGvb,EAAGub,EAAGtb,KACtBoN,WAAWsC,MACKV,KACjB,YAAaA,SACb,GAAImwC,EAAMluB,KAAK,UAAW,GACxBkuB,EAAMluB,KAAK,YAEbkuB,EAAM1wC,KAAK,iBACV5C,EAAMszC,EAAM1wC,MAAM,IAAK,MAEvB8wC,EAAKvwC,EAAK5K,aAAa,cAEzBm7C,EAAI,KACAj1B,EAAOi1B,EAAG1uC,MAAM,OAClB9Q,IAAMuqB,EAAK,KACXtqB,IAAMsqB,EAAK,MAIX,eAAiBze,EAAI9L,GAAK,GAAK,KAAO8L,EAAI7L,GAAK,GAAK,QAEpDyX,EAAO0nC,EAAM1nC,SAGVN,cAAc,IAAIhC,GAAqBgqC,EAAM,GAAIA,EAAM,GAAG9qC,YAAa8qC,EAAM,GAAG5qC,eACnFxI,aAGAyzC,EAAU91C,GAAE8B,GAAY4T,KAAK,oBAAoBpiB,OAEjDsP,EAAI8qB,EAAOlzB,gBAAgB5G,EAAGuM,IAAK,KACnCskC,EAASn/B,EAAKsgB,WAEhBvgB,aACCA,EAAI,EAAGA,EAAIo/B,EAAOnxC,OAAQ+R,MAC3BrD,OAAOyiC,EAAOp/B,GAAGrC,WAAU,OAI3BsB,IAAW,KACPyxC,EAAY/1C,GAAEmmB,MAAYwB,SAAS,yCAAyChrB,WAChFiG,GAAGZ,OAAO+zC,GAGVL,KACAj7C,aAAa,YAAai7C,OAGxBpqC,EAAShG,EAAKuF,iBAENjI,GAGV0B,QACA6hB,MAAYnkB,OAAOhC,GAAE4C,GAAG8S,KAAK,4CAI/B3N,GAAKuW,MAEFsP,MAAMhrB,GAEP0I,EAAQ,KACLwqC,EAAS,KAELnrC,EAAerF,EAAfqF,cACFtI,WACIoL,cAAc,IAAIhC,GAAqBnG,EAAMqF,EAAaW,MAE5DmC,cAAc,IAAIpC,GAAqBzI,OAGvCA,GAEP0B,OACe6hB,SAEAvjB,GVr4HK,SAAU0C,EAAMogB,MACtCpgB,GAA0B,IAAlBA,EAAKqgB,SAAgB,SAC3BtgB,EAAIC,EAAKsgB,WAAWtyB,OACjB+R,QACIC,EAAKsgB,WAAW/oB,KAAKwI,GAAIqgB,KAE/BpgB,KUo4HQ1C,EAAG,SAAUqd,UAEAA,GACtB,MAAO/b,WACCyH,IAAIzH,SAKdtB,GAAG8S,KAAK2Z,IAAUte,KAAK,WAClBrc,KAAKqT,UAAWA,GAAKuW,WAGhB1b,QAENuhC,EAAK6R,GAAoBpzC,GAAG,GAC9BuhC,KACO12B,cAAc02B,KAGL52B,gBAEZ5B,IAAI,iCAAkCrG,SAiB7C2wC,aAAe,SAAUC,EAAW9P,WAG/BH,EAASjhB,GAASkxB,MACpBjQ,EAAOkQ,mBACTlQ,EAAOkQ,kBAAkB5wC,eAAiB3R,EAAGuM,WACtC,OAGJ6lC,WAAWC,OAEV14B,EAAW,IAAIlB,GAAa,iBAG3B1B,EAAe7I,EAAf6I,YACDyrC,EAAUv0C,EAAQ2J,YAAY1J,KAC3B2L,cAAc,IAAIhC,GAAqB2qC,EAASzrC,EAAa9I,MAIlE6rB,EAAO2oB,UACI3oB,EAAO2oB,UAAUpQ,EAAOlkC,iBAExB2rB,EAAOqS,WAAWkG,EAAOlkC,iBAAiB,KAGjDC,OAAOF,OACTgvC,EAAU9wC,GAAE8B,KAEXy+B,iBAAmB,IAAIC,GAAa1+B,EAAYu+B,OAGjDiW,EAAQhiB,IAAoBF,WAC9BkiB,IACG,WAAYA,KAEZ,gBAIC5gC,KAAK,SAAS3E,KAAK,eACnBwlC,EAAQ7hD,QACM6hD,OACdzwC,EAAMkG,GAAQtX,SAChBoR,EAAK,IACHA,EAAIiW,WAAW,SAAU,KAErB9V,EAAIH,EAAIkB,MAAM,yBAChBf,EAAG,KACCwlB,EAAMxH,mBAAmBhe,EAAE,OAC/B,IAAIgsC,OAASC,KAAK,aACZhsB,eAAetyB,EAAGoyB,MAAO,aAAcyF,KAC5C1mB,KAAK,MAAO0mB,MAIZsmB,WAAWjsC,QAKd4P,KAAK,OAAO3E,KAAK,eAEnB/Q,GAAEtL,MAAM2zB,QAAQ,QAAQ/0B,WAEdoB,UAGR8hD,EAAK9hD,KAAKmW,WACa,IAAzB2rC,EAAG5wB,WAAWtyB,QAAgC,MAAhBkjD,EAAGx2B,aACjCw2B,GAAIjvB,KAAK,OAAQ7yB,QAChBqT,GAAKyuC,EAAGzuC,IAAMuW,QAEJ5pB,SAKb4P,OACMoR,KAAK,2CAA2CwqB,SAAS/Z,SAMxD2qB,MAEMA,EAAQ,QAEnBjlC,MACA,sBACMi0B,EAAUG,oBAAsB,UAAY,UAGpDwW,GAAQ,KAGR3F,EAAQ/rC,KAAK,WAAY,KACrB8wC,EAAK/E,EAAQ/rC,KAAK,WAAWoC,MAAM,OACnCtE,MAAQgzC,EAAG,KACXpzC,OAASozC,EAAG,WAGhB9kC,MAAM,QAAS,UAAW,SAAU1L,EAAGqxC,OAEjC5wC,EAAMgrC,EAAQ/rC,KAAK2xC,IAAQ,OAEF,MAA3B5yB,OAAOhe,GAAKyD,QAAQ,MAEd,IAEFmtC,GAAOptC,GAAaotC,EAAK5wC,eAS7B6hB,WAAWjS,KAAK2Z,IAAUte,KAAK,WAChCrc,KAAKqT,UAAWA,GAAKuW,OAIxBm4B,EAAO,KACHv2B,EAAKiK,OACLtnB,MAAQqd,EAAGrd,MAAQqd,EAAG7pB,IACtBoM,OAASyd,EAAGzd,OAASyd,EAAG5pB,EAK5BuV,EAAMhJ,OAAS,MAAWA,MAAQ,KAClCgJ,EAAMpJ,QAAU,MAAWA,OAAS,OAEhCsC,KAAK8G,QACRikC,SAAWjkC,EAAMhJ,WACjB6wC,SAAW7nC,EAAMpJ,SAEbgL,cAAc,IAAIpC,GAAqBvJ,QAE1C0L,EAAUsjC,EAAQ/rC,MAAM,QAAS,aAC9B0I,cAAc,IAAI7B,GAAqB/J,EAAS2L,MAG3C,mBAMNxL,OAAOoa,EAAgB0iB,qBAE1BsH,GAAarmB,EAAoBxS,KACjC,WAAYzL,IACjB,MAAOoC,kBACCyH,IAAIzH,IACL,SAGF,QAiBJyyC,gBAAkB,SAAUT,OAC3BvwC,SAAG+vC,SAAIkB,iBAGHC,EAAMh0B,GAASqzB,EAAU5iD,OAAS4iD,GAAW3sC,OAAO,EAAG,IAEzDutC,GAAc,EAEdC,GAAUF,IACR72C,GAAE+2C,GAAUF,GAAKG,QAAQC,QAAQ,YAAY3jD,YACjC,OAIZia,EAAW,IAAIlB,GAAa,gBAC9B2qC,YACAF,IACUC,GAAUF,GAApBG,SACGD,GAAUF,GAAK7wC,UACf,KAECigC,EAASjhB,GAASkxB,QAEnBlQ,WAAWC,OAGZ3lC,WAEAotB,EAAO2oB,UACH3oB,EAAO2oB,UAAUpQ,EAAOlkC,iBAExB2rB,EAAOqS,WAAWkG,EAAOlkC,iBAAiB,MAGpCzB,OAER42C,EAAS5tC,GAAa,QAAShJ,EAAI5F,aAAa,UACpDy8C,EAAS7tC,GAAa,SAAUhJ,EAAI5F,aAAa,WACjD08C,EAAU92C,EAAI5F,aAAa,aAEtB08C,EAAUA,EAAQjwC,MAAM,MAAQ,EAAG,EAAG+vC,EAAQC,OAChDxxC,EAAI,EAAGA,EAAI,IAAKA,IAChBA,IAAOkwC,EAAGlwC,UAKF7D,EAAWpH,aAAa,YAUhC,mBAPDy8C,EAASD,EACN,SAAYG,EAAU,EAAKxB,EAAG,GAAK,IAEnC,SAAYwB,EAAU,EAAKxB,EAAG,GAAK,KAId,kBAEnBnoB,EAAOlzB,gBAAgB5G,EAAGuM,IAAK,cAClCmmB,EAAOH,SAET7hB,QAIAhE,GAAKoV,KAAK,2CAA2CwqB,SAAS5Z,GAG3DhmB,EAAImmB,YAAY,KACf5zB,EAAQyN,EAAImmB,aACXzkB,OAAOnP,WAEVgZ,EAAQvL,EAAIhF,WACT+J,EAAI,EAAGA,EAAIwG,EAAMvY,OAAQ+R,IAAK,KAC/BN,EAAO8G,EAAMxG,KACZ5K,aAAasK,EAAKib,SAAUjb,EAAKE,SAEnC8C,GAAKuW,OAGFu4B,mBAEDnB,QAGE1zC,OAAOg1C,KACTvpC,cAAc,IAAIpC,GAAqB2rC,OAG1CtpB,EAAOlzB,gBAAgB5G,EAAGuM,IAAK,QACjC4H,GAAKuW,OACHs4B,EAAO,IAAMI,EAAOjvC,KAE3B6pB,GAAgB0C,IAAoBe,mBAAmBrzB,OAAO40C,KACtDnpC,cAAc,IAAIpC,GAAqBurC,UAG1Cn8C,aAAa,YAAai7C,MACVkB,MACpBA,GAAOrvB,KAAK,SAAUyvB,GAAQzvB,KAAK,MAAOyvB,OAC5BJ,MAMIrpC,KACf,WAAYzL,IACjB,MAAOoC,kBACCyH,IAAIzH,GACL,YAIF0yC,IAMP,iBAAkB,cAAe,aAAc,qBAC/C,kBAAmB,qBAAsB,0BACzC,qBAAsB,sBAAuB,aAAc,iBAC3D,eAAgB,cAChB5iD,QAAQ,SAAC0f,KACFA,GAAQ8sB,GAAK9sB,yDASTke,4BAEQ0lB,KACAA,6JAeV,WAAYx1C,YAelBuP,MAAQ,aACCA,cAKL2uB,2BAGAO,iBAAmB,IAAIC,GAAa1+B,KAGpCozB,YAAY,aAGZtF,QAAQ2nB,mBAGCrY,eAGJ9iB,EAAgBC,qBAEvB,iBAIFm7B,kBAAoBp8B,EAAYo8B,uBAMhCC,eAAiB,kBAAqB31C,QAMtC41C,YAAc,kBAAqB71C,OAalC2vC,GAAgB98C,KAAK88C,cAAgB,oBAI/B1vC,EAAWpH,aAAa,SAAW+W,IACnC3P,EAAWpH,aAAa,UAAY+W,OAKtCA,SAQLkmC,cAAgB,kBAAqB7X,EAAU4C,mBAM/CkV,WAAa,iBACT,6BASJvnC,aAAe,SAAUC,UACrBC,OAAOH,GAAWE,EAAKunC,iBACNvnC,SASrBwnC,UAAY,SAAUhF,UAClBviC,OAAOuvB,EAAWgT,SAQtBiF,SAAW,SAAUzyC,QACjBA,GAAQ67B,EAAiB,YAG1BsD,KADCzkC,GAAEsF,GAAMiiB,KAAK,SAAWvnB,GAAEsF,GAAMiiB,KAAK,WAAajiB,GACrCsgB,WACXvgB,EAAI,EAAGA,EAAIo/B,EAAOnxC,OAAQ+R,OACN,UAAvBo/B,EAAOp/B,GAAG2a,gBACLykB,EAAOp/B,GAAGnD,kBAGd,UAUJ81C,cAAgB,SAAUlyC,OACzBR,EAAO67B,EAAiB,KACrBnhC,GAAEsF,GAAMiiB,KAAK,SAAWjiB,MAEzBowC,EAAK11C,GAAEsF,GAAMqiB,SAAS,SAEtBpa,EAAW,IAAIlB,GAAa,aAE9B8hB,YACCroB,EAAIxS,OAKEoiD,EAAGpiD,UAEJoiD,EAAG,KACFjoC,cAAc,IAAI7B,GAAqBuiB,GAAQI,QAASJ,EAAMjsB,iBACjEA,YAAc4D,OAGZ4nB,EAAOlzB,gBAAgB5G,EAAGuM,IAAK,UACjC+B,YAAc4D,KAClBR,GAAM2yC,QAAQ9pB,KACP1gB,cAAc,IAAIpC,GAAqB8iB,SAfjC,KAET+pB,EAAgBxC,EAAG/qC,cAChB8C,cAAc,IAAIhC,GAAqBiqC,EAAG,GAAIwC,EAAe5yC,MACnEjD,WAcekL,QAOhB6mC,GAAmB1/C,KAAK0/C,iBAAmB,kBACxC3yB,EAAOs2B,SAASj2C,SAUpBq2C,iBAAmB,SAAUC,WAC1B3T,EAAS3iC,EAAW8jB,WACtB0uB,GAAW,EAAO+D,EAAW,GAE3B9qC,EAAW,IAAIlB,GAAa,sBAEzBhH,EAAI,EAAGA,EAAIo/B,EAAOnxC,OAAQ+R,OACN,UAAvBo/B,EAAOp/B,GAAG2a,SAAsB,MACvBykB,EAAOp/B,IACEnD,kBAInBoyC,MACQ5mB,EAAOlzB,gBAAgB5G,EAAGuM,IAAK,WAC/B8K,aAAaqpC,EAAUxyC,EAAW2kB,aAI3C2xB,EAAS9kD,SACF4O,YAAck2C,IAGd/1C,WAEFoL,cAAc,IAAI7B,GAAqB0oC,GAAW/lB,QAAS8pB,OAChD9qC,SASjB+qC,YAAc,SAAUC,UACvBA,KACS99C,aAAa,WAAY7G,EAAG68B,IAElC78B,EAAG68B,SAaP+nB,cAAgB,SAAUniD,EAAGC,OAC1B60C,EAAMqG,KACLjjC,EAAQ48B,EAAR58B,EAAGC,EAAK28B,EAAL38B,EACNjB,YAEM,QAANlX,EAAa,KAETkM,EAAO4nB,SAET5nB,SAiBK,IAhBI,IAAI8J,GAAa,6BACtBosC,EAASzuB,QACAyuB,OACT/oC,KAASC,QACboB,KAAK0nC,EAAQ,SAAUpzC,EAAGxI,KACvBC,MAAe,EAAVyF,EAAKlM,KACVyG,MAAe,EAAVyF,EAAKjM,SAGTmW,EAAMgV,EAAOi3B,qBAAqBhpC,EAAIC,GAAI,KACvClC,cAAchB,SAGnB9N,KAAKoR,MAAMxN,EAAKM,SAChBlE,KAAKoR,MAAMxN,EAAKE,eAKpBpM,IAAMkY,GAAKjY,IAAMkY,IACdjB,MACQ,IAAIlB,GAAa,8BAG1B/C,GAAa,QAASjT,KACtBiT,GAAa,SAAUhT,KAEhBmE,aAAa,QAASpE,KACtBoE,aAAa,SAAUnE,QAE7Bw5C,SAAWz5C,OACXq9C,SAAWp9C,IACPmX,cAAc,IAAI7B,GAAqB9J,GAAae,MAAO0L,EAAG9L,OAAQ+L,OAEpE/T,aAAa,WAAY,EAAG,EAAGpE,EAAIob,EAAanb,EAAImb,GAAavL,KAAK,QACxEuH,cAAc,IAAI7B,GAAqB9J,GAAa62C,SAAU,MAAOpqC,EAAGC,GAAGtI,KAAK,UAErEqH,KACf,WAAYzL,MAEZ,QAcJ82C,UAAY,kBACR54C,GAAE8B,GAAYiD,MAAM,IAAK,YAgB7B8zC,YAAc,SAAU/yC,EAAKqmC,EAASC,OACrC0M,EAAS,IACT54B,SACE64B,EAAW,SAAU74B,OACpBA,SAAa,MACZ2sB,EAAQluC,KAAKoR,MAAOo8B,EAAUjsB,EAAGrd,MAAS,IAAMi2C,GAAU,IAC1DhM,EAAQnuC,KAAKoR,MAAOq8B,EAAUlsB,EAAGzd,OAAU,IAAMq2C,GAAU,IAC3DE,EAAOr6C,KAAKkQ,IAAIg+B,EAAOC,YACtBK,QAAQ6L,IACPA,OAAMz2C,KAAM2d,OAGH,qBAARpa,gBAAAA,IAAkB,IAEV,OADZA,GACEjD,OAA6B,IAAdqd,EAAGzd,OAAc,KAC/Bw2C,EAAU/4B,EAAG84B,KAAO94B,EAAG84B,KAAOvnC,EAAcyO,EAAG8qB,gBAC9CmC,QAAQ8L,IACPD,KAAMvnC,EAAalP,KAAM2d,UAE5B64B,EAAS74B,UAGVpa,OACH,gBACEq7B,EAAiB,cAChB+X,EAAgBl5C,GAAEyT,IAAI0tB,EAAkB,SAAUlhB,MAASA,SAAYA,MACxEkK,GAA6B+uB,aAE/B,aACG/N,EAAMqG,OACH,OACH3uC,MAAOsoC,EAAI58B,EAAG9L,OAAQ0oC,EAAI38B,EAAGnY,EAAG,EAAGC,EAAG,aAEzC,YACE6zB,eAEF,UACEA,GAA6BH,GAAmBsK,IAAoBe,gDAKpE0jB,EAAS74B,SAgFbitB,QAAU,SAAUgM,OACjBhO,EAAMqG,OACD/2C,aAAa,UAAW,OAAS0wC,EAAI58B,EAAI4qC,EAAY,IAAMhO,EAAI38B,EAAI2qC,KAChEA,KACZpoC,KAAKowB,EAAkB,SAAU97B,EAAGC,GAC/BA,KACWq+B,gBAAgBr+B,GAAM63B,aAE5Bic,gBACE,cAA+ED,SAO1FE,QAAU,kBACNnV,SASJ0H,QAAU,SAAU33C,KACXod,OAAM,MACNA,WACK8vB,EAAiB,IAAuC,SAAjCA,EAAiB,GAAGnhB,SAAuBypB,GAAUvI,KAC/EjtC,QAiBXqlD,SAAW,SAAUxmD,UACjBymD,GAAczmD,SAYlB0mD,SAAW,SAAU1mD,EAAMgT,EAAKsgC,KAC1BtzC,GAAQgT,KACHhT,EAAO,WAAaA,KAAM,kBAClC0Z,cACGitC,EAASv1C,GACG,MAAfA,EAAE8b,YACEljB,KAAKoH,WAGXmB,EAAI87B,EAAiB7tC,OAClB+R,KAAK,KACJC,EAAO67B,EAAiB97B,GAC1BC,IACmB,MAAjBA,EAAKmF,WACEnF,EAAMm0C,GAEF,SAAT3mD,EACmB,aAAjBwS,EAAKmF,SAA2C,SAAjBnF,EAAKmF,WAChC3N,KAAKwI,KAGPxI,KAAKwI,IAKfkH,EAAMlZ,OAAS,IACZ8yC,KAI2BtzC,EAAMgT,EAAK0G,OAHjB1Z,EAAMgT,EAAK0G,KAC9B,UAAWA,UAahBktC,GAAchlD,KAAKglD,YAAc,SAAU5mD,MAC1CymD,GAAczmD,EAAO,WAAqD,eAAxCymD,GAAczmD,EAAO,UAAUA,UAClEstB,EAAOqB,EAAO3uB,EAAO,QAEnB6mD,EAAgBC,GAAsBx5B,GACtCkG,EAAOH,KAERwzB,IAMIA,KAJArzB,EAAKjU,YAAYqb,EAAOqS,WAAW3f,GAAM,KAE3CrY,GAAKuW,MAILk7B,SAAS1mD,EAAM,QAAUstB,EAAKrY,GAAK,OAStC6xC,GAAwB,SAAUx5B,WAChCkG,EAAOH,KACP0zB,EAAgB75C,GAAEsmB,GAAM5Q,KAAK,kCAC/BrQ,EAAIw0C,EAAcvmD,OAChBwmD,GAAY,IAAK,KAAM,KAAM,KAAM,MAClCz0C,KAAK,KACJ00C,EAAKF,EAAcx0C,MACJ,mBAAjB+a,EAAK3V,YACH2V,EAAK1lB,aAAa,QAAUq/C,EAAGr/C,aAAa,OAC9C0lB,EAAK1lB,aAAa,QAAUq/C,EAAGr/C,aAAa,OAC5C0lB,EAAK1lB,aAAa,QAAUq/C,EAAGr/C,aAAa,OAC5C0lB,EAAK1lB,aAAa,QAAUq/C,EAAGr/C,aAAa,mDAKxCs/C,EAAYh6C,GAAEogB,GAAMrb,KAAK+0C,GACzBG,EAAUj6C,GAAE+5C,GAAIh1C,KAAK+0C,GAEvB13B,GAAO,QACTrR,KAAK+oC,EAAU,SAAUz0C,EAAGN,GACxBi1C,EAAUj1C,KAAUk1C,EAAQl1C,QAAgB,KAG9Cqd,sBAAQ,aAIR83B,EAAQ95B,EAAKmG,uBAAuB3yB,EAAGuM,IAAK,QAC5Cg6C,EAASJ,EAAGxzB,uBAAuB3yB,EAAGuM,IAAK,WAE7C+5C,EAAM5mD,SAAW6mD,EAAO7mD,gBAIxBqS,EAAIu0C,EAAM5mD,OACPqS,KAAK,KACJy0C,EAAOF,EAAMv0C,GACb00C,EAAQF,EAAOx0C,MAEjBy0C,EAAK1/C,aAAa,YAAc2/C,EAAM3/C,aAAa,WACrD0/C,EAAK1/C,aAAa,kBAAoB2/C,EAAM3/C,aAAa,iBACzD0/C,EAAK1/C,aAAa,gBAAkB2/C,EAAM3/C,aAAa,wBAKhD,IAAPiL,SACKo0C,UAIJ,WAUJO,SAAW,SAAUxnD,EAAMkpC,OAExB3uB,EAAI,IAAIrN,GAAEu6C,UAAUC,MAAMxe,eAC3Bye,gBAAgB3nD,EAAMua,EAAEqtC,MAAQ,KAAK,MAG5B5nD,EAAO,UAAYua,EACzBA,EAAEva,UACL,kBACE0mD,SAAS1mD,EAAuB,SAAjBua,EAAEstC,WAAwB,IAAMttC,EAAEstC,WAAa,kBAEhE,qBACA,mBACI7nD,EAAO,QAAUua,EAAEA,EAAEva,SAChBA,UAUX8nD,eAAiB,SAAU5e,QACzBse,SAAS,SAAUte,SAQrB6e,aAAe,SAAU7e,QACvBse,SAAS,OAAQte,SAOnB8e,eAAiB,kBACbvB,GAAcxY,mBAWlBga,eAAiB,SAAUj1C,MAClB,IAARA,IAAc,OAAQ,QAAQpF,SAASwjC,MAClC6W,eAAe,WAGVha,aAAej7B,UAEvB0G,KAMFnH,EAAI87B,EAAiB7tC,OAClB+R,KAAK,KACJC,EAAO67B,EAAiB97B,GAC1BC,IACmB,MAAjBA,EAAKmF,WACEnF,EAAMm0C,KAET38C,KAAKwI,IAIbkH,EAAMlZ,OAAS,OACO,eAAgBwS,EAAK0G,KACxC,UAAW20B,aAlBTsY,EAASv1C,GACG,MAAfA,EAAE8b,YACEljB,KAAKoH,UA4BZ82C,cAAgB,SAAUj2C,EAAMe,KAC1Bf,EAAKkC,QAAQ,IAAK,MAAQnB,UAC7B0G,KAEFnH,EAAI87B,EAAiB7tC,OAClB+R,KAAK,KACJC,EAAO67B,EAAiB97B,GAC1BC,IACmB,MAAjBA,EAAKmF,WACEnF,EAAM,SAAUpB,GAAwB,MAAfA,EAAE8b,YAA0BljB,KAAKoH,OAE7DpH,KAAKwI,IAIbkH,EAAMlZ,OAAS,OACOyR,EAAMe,EAAK0G,KAC9B,UAAW20B,UAqBf8Z,SAAW,kBACP/Z,QAOJ3iB,WAAaA,QAQbmV,WAAa,SAAU5tB,KACjBioB,QAAUjoB,KACK,UAAWA,SAOhCo1C,eAAiB,kBACbha,EAASY,mBAObqZ,iBAAmB,kBACfja,EAASW,qBAWb4Y,gBAAkB,SAAU3nD,EAAMgT,EAAKsgC,KACjCtzC,EAAO,YAAcgT,EACzBsgC,KAG2BtzC,EAAO,WAAYgT,MAFzBhT,EAAO,WAAYgT,SAY1Cs1C,gBAAkB,SAAUtoD,SACf,SAATA,EAAkB4B,KAAKwmD,iBAAmBxmD,KAAKymD,yBASnDE,QAAU,SAAU/1C,OACnBQ,EAAM,KAGNR,GACgBA,EAAK5K,aAAa,UACrB,KACPi1C,EAAOz9B,GAAQ5M,EAAKyC,GAAK,SAC3B4nC,MACIA,EAAKlpB,WAAW/rB,aAAa,wBAIlCoL,kBAILw1C,EAAa,KACb1zB,EAAS,KACT2zB,GAAe,WAiCVC,QACDC,EAAOh6B,EAAOmO,QAAQyb,yBACjB59B,cAAcguC,KACLH,KACP,OACJ,OA9BJI,cAAgB,SAAU51C,MAC1B8hB,KAIO,IAAR9hB,KAG4B,SAAU,OACzB,MACV,KACCR,EAAO67B,EAAiB,GAC1Boa,MAC4B,SAAU,QAAUj2C,EAAKyC,GAAK,UAE1D1D,cACMsH,IAAI,IAAKrG,KACZ4G,gBAAgB,YAChBzR,aAAa,SAAU,QAAU6K,EAAKyC,GAAK,cAEpB,eAAgBjC,GAAM8hB,EAAOnB,eACpDyc,eAAetb,EAAQ9hB,UAnBvB61C,QAAQ71C,MAuCZo9B,eAAiB,SAAUtb,EAAQg0B,GACpCA,EAAS,KAEMh0B,KACZ,SACA,aACI,cACC,QACP,KAGEvjB,QACI6H,gBAAgB,OAChBA,gBAAgB,OAChBA,gBAAgB,WAChBA,gBAAgB,cAYtByvC,QAAU,SAAU71C,EAAK+1C,MAC1BP,eAMEh2C,EAAO67B,EAAiB,GACxB2a,EAASx2C,EAAKyC,KACXmK,GAAQ4pC,EAAS,YAEnB,MAEDvuC,EAAW,IAAIlB,MAGjBub,EACU,IAAR9hB,MACO,UAEN,KAECi2C,EAAU19B,GAAwBgB,QAAS,0BAEzC,6BACUvZ,QAITuY,GAAwBgB,QAAS,kBAElCy8B,EAAS,YAIV95C,OAAO+5C,QACH/5C,OAAO4lB,KAETna,cAAc,IAAIpC,GAAqBuc,QAG5Cpa,GAAWoa,OAAQtiB,EAAK5K,aAAa,cAE/B,IAARoL,WACGoG,gBAAgB,iBACZuB,cAAc,IAAI7B,GAAqBtG,EAAMkI,OAIhC,SAAU,QAAUsuC,EAAS,YAC5CruC,cAAc,IAAI7B,GAAqBtG,EAAMkI,MAC/C01B,eAAetb,EAAQ9hB,KAEjByH,IACNqiB,QAAQ+Z,oBAAoB,gBAAiB/hB,EAASA,EAAOnB,WAAa,OAC7Eo1B,MACKH,cAAc51C,kBAWpBk2C,QAAU,eAEPvnC,EAAW0sB,EAAiB,UAClB,MAAZ1sB,GAAyC,SAArBA,EAAShK,SACR,MAAvB02B,EAAiB,IACgC,SAAzC1sB,EAAS/Z,aAAa,qBAW7BuhD,QAAU,SAAUl4C,OACjB0Q,EAAW0sB,EAAiB,GAClB,MAAZ1sB,GAAyC,SAArBA,EAAShK,SACR,MAAvB02B,EAAiB,OACO,cAAep9B,EAAI,OAAS,UAEjDo9B,EAAiB,GAAGj/B,gBACX2rC,kBASXqO,UAAY,eACTznC,EAAW0sB,EAAiB,UAClB,MAAZ1sB,GAAyC,SAArBA,EAAShK,SACR,MAAvB02B,EAAiB,IAC+B,WAAxC1sB,EAAS/Z,aAAa,oBAW7ByhD,UAAY,SAAU92C,OACnBoP,EAAW0sB,EAAiB,GAClB,MAAZ1sB,GAAyC,SAArBA,EAAShK,SACR,MAAvB02B,EAAiB,OACO,aAAc97B,EAAI,SAAW,UAElD87B,EAAiB,GAAGj/B,gBACX2rC,kBAQXuO,cAAgB,kBACZ3S,GAAQxI,kBASZob,cAAgB,SAAUv2C,MACrBm7B,YAAcn7B,KACE,cAAeA,GACnCq7B,EAAiB,KAAOA,EAAiB,GAAGj/B,gBAClC2rC,kBAUXyO,aAAe,SAAUx2C,MACpBi2B,KAAOj2B,KACS,OAAQA,SAO7By2C,aAAe,kBACX9S,GAAQ1N,WAOZygB,YAAc,kBACV/S,GAAQzI,gBASZyb,YAAc,SAAU32C,MACnBk7B,UAAYl7B,KACI,YAAaA,GAChCq7B,EAAiB,GAAGj/B,gBACX2rC,kBAQX1gC,QAAU,eACPsH,EAAW0sB,EAAiB,UAClB,MAAZ1sB,EAA2B,GACxBA,EAASvS,kBASbw6C,eAAiB,SAAU52C,MACN,QAASA,MACrB+K,KAAK/K,MACL+nC,kBAWT8O,YAAc,SAAU72C,OACrBR,EAAO67B,EAAiB,MACzB77B,OAECuG,EAAQ7L,GAAEsF,GAAMP,MAAM,QAAS,WACjC63C,GAAY/wC,EAAMhJ,QAAUgJ,EAAMpJ,OAEhCo6C,EAAU7wC,GAAQ1G,MAGpBu3C,IAAY/2C,KACJ,OACL,IAAK82C,aAENrvC,EAAW,IAAIlB,GAAa,uBAE1B/G,EAAMQ,KACL2H,cAAc,IAAI7B,GAAqBtG,WACrCu3C,KAGPD,KACA,IAAI3K,OAASC,KAAK,eACZ1kC,EAAUxN,GAAEsF,GAAMP,MAAM,QAAS,cAErCO,GAAMP,YACCrQ,KAAKmO,aACJnO,KAAK+N,WAGCkhC,gBAAgBr+B,GAAM63B,WAE7B1vB,cAAc,IAAI7B,GAAqBtG,EAAMkI,MAClCD,KACf,WAAYjI,MAChBP,KAAK,MAAOe,KAEKyH,UAUnBuvC,WAAa,SAAUh3C,OACtBR,EAAO67B,EAAiB,MACvB77B,MACgB,MAAjBA,EAAKmF,QAAiB,KAElBsyC,EAAW/8C,GAAEsF,GAAM2xC,QAAQ,SAC7B8F,EAASzpD,gBACJypD,EAAS,OAMdF,EAAU7wC,GAAQ1G,MAEpBu3C,IAAY/2C,OAEVyH,EAAW,IAAIlB,GAAa,sBAE1B/G,EAAMQ,KACL2H,cAAc,IAAI7B,GAAqBtG,WACrCu3C,OAGStvC,WAUjByvC,cAAgB,SAAUl3C,OACvB2O,EAAW0sB,EAAiB,MAClB,MAAZ1sB,GAAyC,SAArBA,EAAShK,QAAoB,KAC7CgP,EAAIhF,EAAS/Z,aAAa,MAC5B+e,IAAMqK,OAAOhe,OACNrL,aAAa,KAAMqL,KACnBrL,aAAa,KAAMqL,KACR,IAAI8F,GAAqB6I,GAAWiU,GAAIjP,EAAGkP,GAAIlP,GAAI,aAClE,WAAYhF,YAWlBwoC,cAAgB,SAAUxxB,KACtByxB,sBAAsB,IAAKzxB,SAU/B0xB,gBAAkB,aACdC,+BAaJ7qC,WAAa,SAAUgD,KACdhD,WAAWgD,SAYpB8nC,cAAgB,SAAU/3C,EAAM9C,MACvB,MAAR8C,UAOA9C,EACKqmB,GAAuBvjB,EAAM+Y,EAAuBjD,GVviKlC,SAAU9V,EAAMuG,EAAOwS,EAAuBjD,EAAa3C,EAAgBkH,EAAgB+f,EAAS3f,OACzHxS,EAAW,IAAImyB,EAAQrzB,aAAa,2BAKpChL,EAAOgd,WACF,cAHHre,GAAE05B,UAAW7tB,EAAO+c,GAAmCtjB,MAOzDwjB,EAAUxjB,EAAK5K,aAAa,aAC9BouB,KACGruB,aAAa,YAAaquB,OAG1B/gB,EAAMzC,EAANyC,GACDuD,EAAShG,EAAKuF,WAChBvF,EAAKqF,cACFoe,OAAO1nB,KAELW,OAAOX,OAGV4C,EAAIwkB,GAAoBnjB,MAC1BrB,EAAG,MACAxJ,aAAa,IAAKwJ,GAKnB6kB,EAAS,KACL1a,EAAQhG,EAAiB/G,GAC3B8M,GAAmBC,MACT0R,iBAAiBze,OAI1BsJ,EAAerF,EAAfqF,qBACE8C,cAAc,IAAIiyB,EAAQj0B,qBAAqBnG,EAAMqF,EAAaW,MAClEmC,cAAc,IAAIiyB,EAAQr0B,qBAAqBhK,UAGnDgB,WACA5H,aAAa,KAAMsN,KACnBmE,gBAAgB,iBACL7K,IAAO,KAEHkM,GAEblM,WAGJgB,SACE,KUigKAg7C,CAAc/3C,QAXb47B,EAASnF,oBACCmF,EAASY,oBACjBZ,EAASO,sBACDP,EAASH,gCACLG,EAASQ,mCACVR,EAASS,iCACVT,EAASU,gCACTV,EAASW,uBAClBX,EAASnT,mBACN,UAEoB1P,EAAuBjD,EAAa3C,EAAgBkH,GAAgB+f,GAAS3f,YAvBvGvT,EAAQ20B,KACZpwB,KAAKvE,EAAO,SAAUnH,EAAGC,GACrBA,KAAe+3C,cAAc/3C,WAgCjCg4C,GAAgC,SAAUv4C,EAAMod,EAAU3V,GAC1C,aAAhB03B,MAEUqZ,SAASx4C,EAAMod,WAGzB9c,KADImH,GAAS20B,GACH7tC,OACRkqD,GAAa,IAAK,WAAY,QAC9BC,GAAc,YAAa,UAAW,2BAGtCn4C,EAAOkH,EAAMnH,MACL,MAARC,uBAGU,MAATP,GAAyB,MAATA,IAAiBy4C,EAAU98C,SAAS4E,EAAKmF,SAAU,KAChElI,EAAO4nB,IAA8B7kB,IACrC8S,EAAiB,MAATrT,EAAeod,EAAW5f,EAAKlM,EAAI,EAC3CgiB,EAAiB,MAATtT,EAAeod,EAAW5f,EAAKjM,EAAI,WAC1CoiD,qBAAqBtgC,EAAQ3G,EAAa4G,EAAQ5G,GAAa,cAMnD,MAAjBnM,EAAKmF,SAAmBgzC,EAAW/8C,SAASqE,OAC5C24C,EAAkB,UAAT34C,EAAmBO,EAAKpD,YAAcoD,EAAK5K,aAAaqK,MACvD,MAAV24C,MAA2B,IAC3BA,IAAW55B,OAAO3B,GAAW,CAClB,UAATpd,KAEG7C,YAAcigB,EAGd,SAAUlY,KAAK3E,EAAK5K,aAAa,kBAC7BwrC,GAAQ5gC,KAgBC,UAATP,KACDO,EAAM6c,KACF1nB,aAAasK,EAAMod,GAMb,aAAhB+hB,IAAuC,UAATn/B,GAAoBO,EAAKpD,YAAY5O,WACzDisB,aAAaja,GASvBhB,KAA+B,SAAlBgB,EAAK0a,UAAwB,SAAU/V,KAAK3E,EAAK5K,aAAa,gBACzEopB,OAAO3B,GAAUpG,WAAW,SAAY,YAAa,cAAe,IAAK,KAAKrb,SAASqE,IAASO,EAAKpD,iBAChGgkC,GAAQ5gC,IAOf67B,EAAiBzgC,SAAS4E,eACjB,WAGJA,EAAKuF,cACM84B,gBAAgBr+B,GAAM63B,UACrC,OAICtlC,EAAQsU,GAAiB7G,MACjB,IAAVzN,GAAwB,cAATkN,UACXqJ,EAAQhG,EAAiB9C,GAC3B2a,EAAI7R,EAAMvT,cACPolB,KAAK,IAES,IADL7R,EAAMzK,QAAQsc,GAClBntB,KAAY,GAEdgI,WAAWmlB,OAEXlG,EAAM0F,GAAana,GACnBghC,EAAS54B,GAAeqM,EAAI1jB,EAAI0jB,EAAIlX,MAAQ,EAAGkX,EAAIzjB,EAAIyjB,EAAItX,OAAS,EAAGwM,GAAyBb,GAAOvK,QACvGsC,EAAKmgC,EAAOjwC,EAChB+P,EAAKkgC,EAAOhwC,EACRqnD,EAAS97C,EAAQ4B,uBAChB2W,UAAUviB,EAAOsO,EAAIC,KACtBzE,iBAAiBg8C,EAAQ19B,aA9FlC5a,UAkHHu4C,GAA0BlpD,KAAKkpD,wBAA0B,SAAU74C,EAAMe,EAAK0G,KAC1EA,GAAS20B,IACVvR,QAAQ+Z,oBAAoB5kC,EAAMyH,MAGXzH,EAAMe,EAAK0G,OAEnCe,EAAWkU,EAAOmO,QAAQyb,uBAC3B99B,EAASo5B,aACQp5B,SAWnBmU,uBAAyB,mBACtBnU,EAAW,IAAIlB,GAAa,mBAC5BnH,EAAMi8B,EAAiB7tC,OACvBuqD,KAEGx4C,EAAI,EAAGA,EAAIH,IAAOG,EAAG,KACtBoP,EAAW0sB,EAAiB97B,MAClB,MAAZoP,YAEAnJ,EAASmJ,EAAS5J,WAClBxC,EAAIoM,IAGQgvB,gBAAgBp7B,MAGTA,EAAEN,IAGF,MAAnBuD,EAAOb,SAAgD,IAA7Ba,EAAOsa,WAAWtyB,WAC1CgY,IACKA,EAAOT,gBAGXF,EAAetC,EAAfsC,YACDrF,EAAOgG,EAAOE,YAAYnD,KACnBvL,KAAK2X,KACThH,cAAc,IAAIhC,GAAqBnG,EAAMqF,EAAaW,SAIhEiC,EAASo5B,aAAiCp5B,KAC1C,UAAWswC,aAUbC,oBAAsB,aAClBC,yBACAr8B,+BAQJq8B,qBAAuB,wBACbC,QAAQ,oBAAqBC,KAAKC,UAC7C/c,EAAiB1tB,IAAI,SAAUpd,UAAY+qC,EAAsB/qC,UAGjE,iBAAiB8nD,uBAAuB,gCAYvCC,cAAgB,SAAUtrD,EAAMuD,EAAGC,OAClC+nD,EAAQJ,KAAKK,MAAMC,aAAa56C,QAAQ,sBACxCuB,EAAMm5C,EAAM/qD,UACX4R,OAECs5C,KACAjxC,EAAW,IAAIlB,GAAa,kBAQ5BoyC,WAUAzqD,iBAPG0qD,EAAUp5C,GACbA,EAAKP,MAAQO,EAAKP,KAAKgD,OACdzC,EAAKP,KAAKgD,IAAMuW,MACtBvZ,KAAKgD,GAAK02C,EAAWn5C,EAAKP,KAAKgD,KAElCzC,EAAKqiB,UAAUriB,EAAKqiB,SAAS3zB,QAAQ0qD,QAazC,cAEClyC,MAAO6xC,EAAO7wC,QAASixC,IACxB,GACAzqD,QAAQ,SAAU2qD,GACbA,GAAgB,WAAYA,KAEtBt8C,OAAOrO,QAAQ,SAAU4qD,KAC1BP,EAAMz2B,OAAO,SAAUi3B,UACtBA,EAAc95C,KAAKgD,KAAO62C,QAMhC15C,KAAO,KACNI,EAAO+4C,EAAMn5C,MACdI,OAECoiB,EAAOrJ,EAAsB/Y,KAC5BxI,KAAK4qB,KACHja,cAAc,IAAIpC,GAAqBqc,OAEhCA,UAGP82B,GAEE,aAAT1rD,EAAqB,KACnBgsD,SAAMC,SAELjsD,EAGe,UAATA,MACFuD,IACAC,MAJA0oD,GAAe3oD,IACf2oD,GAAe1oD,OAMlBiM,EAAO4nB,GAA6Bq0B,GACpCr4C,EAAK24C,GAAQv8C,EAAKlM,EAAIkM,EAAKM,MAAQ,GACvCuD,EAAK24C,GAAQx8C,EAAKjM,EAAIiM,EAAKE,OAAS,GACpCiN,KACAC,QAEAoB,KAAKytC,EAAQ,SAAUn5C,EAAGxI,KACvBC,KAAKqJ,KACLrJ,KAAKsJ,SAGJqG,EAAMgV,EAAOi3B,qBAAqBhpC,EAAIC,GAAI,GAC5ClD,GAAKc,EAASE,cAAchB,KAGdc,KACf,UAAWixC,UAUbtB,sBAAwB,SAAUpqD,EAAMmsD,GACtCnsD,MAAe,SAChBosD,EAAS,GACTzzB,gBAEI34B,OACH,MACM,mBACHmsD,GAAU,SAEhB,UACO,MACE,qBAKL1xC,EAAW,IAAIlB,GAAa6yC,GAG5Bt8C,EAAIyb,WACCvrB,WAEHwrB,OAGK,MAATxrB,MACM8P,EAAG6oB,KAEJhe,cAAc,IAAIpC,GAAqBzI,YAG5CyC,EAAI87B,EAAiB7tC,OAClB+R,KAAK,KACNC,EAAO67B,EAAiB97B,MAChB,MAARC,GAE4B,MAA5BA,EAAKuF,WAAWJ,SAAyD,IAAtCnF,EAAKuF,WAAW+a,WAAWtyB,WACzDgS,EAAKuF,gBAGRN,EAAiBjF,EAAKqF,YACtBH,EAAYlF,EAAKuF,aACrB7I,OAAOsD,KACAmI,cAAc,IAAInD,GAAmBhF,EAAMiF,EAAgBC,KAEjE+C,EAASo5B,aAAiCp5B,OAGnC3K,IAAI,QAWZozC,GAAsBthD,KAAKshD,oBAAsB,SAAUpzC,EAAGu8C,WAC5Dx3B,EAAW/kB,EAAEgjB,WACb1gB,EAAMyiB,EAASr0B,OACf0S,EAAQpD,EAAElI,aAAa,aAEvB0kD,EAAQh3C,EAAiBxF,GACzBqD,EAAIgJ,GAAyBmwC,GAAOv7C,OAEpC0J,EAAW,IAAIlB,GAAa,yBAS5BytB,EAAS3tB,GAAiBvJ,GAE1By8C,EAASr/C,GAAE4C,GAAGmC,MAAM,SAAU,YAChCu6C,SAASC,SAAO/xC,SACdgoB,EAAUlB,IAEPjvB,EAAI,EAAGA,EAAIH,EAAKG,IAAK,KACtBC,EAAOqiB,EAAStiB,MAEA,IAAlBC,EAAKqgB,aAEc,OAAnB05B,EAAOtxB,SAAuC,IAAnBsxB,EAAOtxB,QAAe,KAE7CyxB,EAAU7gD,KAAKoR,OAAOzK,EAAK5K,aAAa,YAAc,GAAK2kD,EAAOtxB,QAAU,KAAO,OACjE,UAAWyxB,GAAUl6C,OAG3C+5C,EAAOz3B,OAAQ,KACb63B,EAAQ/qD,KAAK2mD,QAAQ/1C,GACnBo6C,EAAYD,EACbF,MAAiB7qD,KAAK2mD,QAAQz4C,IAC/B68C,IAEM5nC,OAAO0nC,GAAS1nC,OAAO4nC,GACZ,IAAVA,MACDF,GAILG,IAUOr/B,GAAW/a,EAAK5K,aAAa,WARlC4kD,KAIO9pB,EAAQnC,SAASisB,QAChBt9C,OAAOs9C,MAJRj/B,GAAWg/B,EAAOz3B,YAW1B+3B,EAAyC,mBAA/BL,EAAQ74B,WAAWhc,QAAgC,OAAS,WACpE1C,GAAKzC,EAAKyC,GAAK,IAAM43C,KACL,SAAU,QAAUL,EAAQv3C,GAAK,KAAMzC,IAG3Dm6C,OACsB,eAAgBA,GAAQH,EAAQ74B,eACjDyc,eAAeoc,EAASG,QAI/BG,EAAUx3C,EAAiB9C,MAG3BA,EAAKmF,QAAQ/J,SAAS,gBAAyB,MAG9Ck/C,GAGgB,SAAjBt6C,EAAKmF,SAEL20C,EAAMvkD,cAAe,IAInBi/B,GAAkC,IAAxBslB,EAAMvkD,cAAqB,KAWjCglD,EAAMT,EAAMz7C,QAAQ,GAAGE,OAGzBi8C,EAAMj+C,EAAQ+E,kBACZm5C,EAAS5zC,GAAiB7G,GAC5By6C,MACIH,EAAQj8C,QAAQ,GAAGE,YAIrBm8C,EAAOvgC,GAAana,GACpB26C,EAAOhxC,GAAyB2wC,GAAS/7C,OACzCq8C,EAAQxyC,GAAesyC,EAAK3pD,EAAI2pD,EAAKn9C,MAAQ,EAAGm9C,EAAK1pD,EAAI0pD,EAAKv9C,OAAS,EAAGw9C,GAG1EE,EAASrmB,EAASimB,EAGlBnoD,EAAKiK,EAAQ4B,uBAChB2W,UAAU+lC,EAAQD,EAAM7pD,EAAG6pD,EAAM5pD,OAG9B8pD,EAAMxyC,GAAeiyC,EAAKC,EAAKloD,EAAGiM,OAAO8U,cAG3ConC,KACMjlD,WAAW,GAGjBqlD,IACEP,EAAQ/kD,gBACF8G,iBAAiB/J,EAAI,KAErB8L,WAAW9L,IAInBwoD,EAAIl8C,GAAKk8C,EAAIj8C,EAAG,KACZsK,EAAK5M,EAAQ4B,uBAChB01B,aAAainB,EAAIl8C,EAAGk8C,EAAIj8C,GACvBy7C,EAAQ/kD,gBACF8G,iBAAiB8M,EAAI,KAErB/K,WAAW+K,QAGlB,KAGC4xC,EAAW/6C,EAAK5K,aAAa,oBAE3B4I,UAAY+8C,GAAY,OAE1BC,EAAWz+C,EAAQ4B,qBAInB88C,EAAMtxC,GAAyB2wC,GAAS/7C,OAC5C28C,EAASD,EAAI5nC,UACT8nC,EAAK7yC,GAAe4yC,EAAQv6C,EAAGs6C,KAC5BnoB,UAAUqoB,KACX/8C,WAAW48C,OAEf7zC,EAAM2sB,GAAsB9zB,GAC9BmH,KAAgBgB,cAAchB,QAKlCzG,WAEM1C,UAAY0C,IAClBvL,aAAa,YAAa,MAC1ByR,gBAAgB,eACTuB,cAAc,IAAI7B,GAAqBhJ,EAAG4K,KAGjD2xC,IAAa5xC,EAASo5B,iBACjBp5B,QAUN6vC,uBAAyB,eACxBx6C,EAAIu+B,EAAiB,MACpBv+B,KAGD5C,GAAE4C,GAAG2kB,KAAK,SAAWvnB,GAAE4C,GAAG2kB,KAAK,aAElB3kB,WAGC,QAAdA,EAAE6H,QAAmB,KAEjBusC,EAAS9kC,GAAQlG,GAAQpJ,GAAG2G,OAAO,cACvC3G,GAAG2kB,KAAK,SAAUyvB,GAAQzvB,KAAK,MAAOyvB,WACzBp0C,OAGXm6C,EAAW/8C,GAAE4C,GAAGq0C,QAAQ,QAC1B8F,EAASzpD,WACPypD,EAAS,IAIG,MAAdn6C,EAAE6H,SAAiC,MAAd7H,EAAE6H,QAAiB,KACpC8C,EAAW,IAAIlB,GAAa,oBAC5BI,EAAMupC,GAAoBpzC,GAAG,GAC/B6J,KAAgBgB,cAAchB,WAE5BnB,EAAS1I,EAAEiI,WACX61C,EAAS99C,EAAE+H,YACXgd,EAAW,IAAIniB,MAAM5C,EAAEgjB,WAAWtyB,QAEpC+R,EAAI,EACDzC,EAAE6jB,YAAY,KACfnhB,EAAO1C,EAAE6jB,WACPlc,EAAiBjF,EAAKqF,YACtBH,EAAYlF,EAAKuF,cAGF,UAAjBvF,EAAKmF,UAOApF,KAAOC,EAAOgG,EAAOL,aAAa3F,EAAMo7C,KACxCjzC,cAAc,IAAInD,GAAmBhF,EAAMiF,EAAgBC,aAP3DG,EAAerF,EAAfqF,cACE8C,cAAc,IAAIhC,GAAqBnG,EAAMqF,EAAaH,MAC9DnI,kBAYHs+C,EAAe/9C,EAAE+H,cACnBW,EAAOE,YAAY5I,KACd6K,cAAc,IAAIhC,GAAqB7I,EAAG+9C,EAAcr1C,IAE5DiC,EAASo5B,aAAiCp5B,MAGhCoa,WAWdi5B,yBAA2B,eACvBnsC,IAAY0sB,WACH,MAAZ1sB,EAAkB,KAChBpM,EAAIoM,EACFjK,EAAYnC,EAAEwC,WACdN,EAAiBlC,EAAEsC,YAIrBJ,OAHAlC,EAAEwC,WAAWwH,YAAYhK,IAGJsC,gBACH,IAAIL,GAAmBjC,EAAGkC,EAAgBC,EAAW,UACpE,WAAYnC,YAYlBw4C,4BAA8B,eAC1BpsC,IAAY0sB,WACH,MAAZ1sB,EAAkB,KAChBpM,EAAIoM,EACFjK,EAAYnC,EAAEwC,WACdN,EAAiBlC,EAAEsC,YACpB8b,EAAcpe,EAAEwC,WAAhB4b,WACsB,UAAvBA,EAAWhc,YACAgc,EAAW9b,aAIC,SAAvB8b,EAAWhc,YACAgc,EAAW9b,aAKtBJ,OAHAlC,EAAEwC,WAAWI,aAAa5C,EAAGoe,IAGR9b,gBACH,IAAIL,GAAmBjC,EAAGkC,EAAgBC,EAAW,aACpE,WAAYnC,YAalBy4C,mBAAqB,SAAU1jB,OAC5B3oB,EAAW0sB,EAAiB,MAC7B1sB,aAGD4T,SAAS04B,SAEP7vC,EAAOlR,GAAEylC,GAAoBtb,IAA8B1V,MAAausC,aAClE,SAAR5jB,KAAuBlT,aAEzBnZ,KAAKG,EAAM,cACN6vC,WAMKrsD,MACH,EANDA,OAAS+f,OACA,KAOZ4T,OAEChgB,EAAIoM,EACJjK,EAAYnC,EAAEwC,WACdN,EAAiBlC,EAAEsC,eACvB0d,GAAiB,SAAR+U,EAAiB,SAAW,SAAS/0B,GAG5CkC,IAAmBlC,EAAEsC,gBACH,IAAIL,GAAmBjC,EAAGkC,EAAgBC,EAAW,QAAU4yB,MAC9E,WAAY/0B,aAahBqwC,qBAAuB,SAAUhpC,EAAIC,EAAIwvC,GAGxCzvC,EAAGuxC,cAAgBz7C,WACfiM,KACAA,KAEG0tC,IAAY,UACjB5xC,EAAW,IAAIlB,GAAa,YAC9BhH,EAAI87B,EAAiB7tC,OAClB+R,KAAK,KACJoP,EAAW0sB,EAAiB97B,MAClB,MAAZoP,EAAkB,KAQdzO,EAAQnE,EAAQ4B,qBAChB2K,EAAQhG,EAAiBqM,GAG3B/E,EAAGuxC,cAAgBz7C,QAKf2zB,aAAazpB,EAAGrK,GAAIsK,EAAGtK,MAMvB8zB,aAAazpB,EAAIC,GAGrBvB,EAAMvT,gBACF8G,iBAAiBqE,EAAO,KAExBtC,WAAWsC,OAGbyG,EAAM2sB,GAAsB3kB,GAC9BhI,KACOgB,cAAchB,KAGTk3B,gBAAgBlvB,GAAU0oB,cAGzC5vB,EAASo5B,iBACRwY,KACkB5xC,KAEjB,UAAW4zB,GACT5zB,QAYNk7B,sBAAwB,SAAUpyC,EAAGC,OACpC+O,SAAGC,SACDiI,EAAW,IAAIlB,GAAa,kBAE5BnH,EAAMi8B,EAAiB7tC,aAIZwlB,cAHMhV,EAAGC,UAChB/D,GAAE+D,GAAGvH,QAAUwD,GAAE8D,GAAGtH,UAGzB6I,EAAI,EAAGA,EAAIH,GAEF,SADLi8B,EAAiB97B,MADHA,OAKjB67C,EAAiB/f,EAAiBv5B,MAAM,EAAGvC,QAC5CoT,gBAAe,OAGd+c,EAAUlB,UACZ4sB,EAAe5tD,OACZ+R,OAEE67C,EAAe77C,GAAKmwB,EAAQnC,SAAS6tB,EAAe77C,KAC1DusB,GAAgB4D,EAAQH,mBAAmBrzB,OAAOsD,KAC1CmI,cAAc,IAAIpC,GAAqB/F,IAG7CiI,EAASo5B,eACGua,EAAeh3B,gBACzBwuB,qBAAqBriD,EAAGC,GAAG,KACZiX,UAWnB4zC,sBAAwB,SAAUruD,EAAMsuD,OACrCC,KACAn8C,EAAMi8B,EAAiB7tC,UACxB4R,WACD0J,EAAOiJ,OAAOypC,UAAWxyC,EAAO+I,OAAO0pC,UACzCvyC,EAAO6I,OAAOypC,UAAW7iB,EAAO5mB,OAAO0pC,UACrCC,EAAW3pC,OAAO0pC,UAAWE,EAAY5pC,OAAO0pC,UAC3Cl8C,EAAI,EAAGA,EAAIH,GACS,MAAvBi8B,EAAiB97B,KADIA,EAAG,KAEtBC,EAAO67B,EAAiB97B,YACvBA,GAAK8kB,IAA8B7kB,IAGlC87C,OACH,aACY,MAATtuD,GAAyB,MAATA,GAAyB,MAATA,KACnC0uD,IAAa3pC,OAAO0pC,WAAaC,EAAWH,EAAOh8C,GAAGxC,SAC5C,MAAT/P,GAAyB,MAATA,GAAyB,MAATA,KACjC2uD,IAAc5pC,OAAO0pC,WAAaE,EAAYJ,EAAOh8C,GAAG5C,aAElD4+C,EAAOh8C,GAAGhP,IACVgrD,EAAOh8C,GAAG/O,IACV+qD,EAAOh8C,GAAGhP,EAAIgrD,EAAOh8C,GAAGxC,QACxBw+C,EAAOh8C,GAAG/O,EAAI+qD,EAAOh8C,GAAG5C,SACpB4+C,EAAOh8C,GAAGxC,QACTw+C,EAAOh8C,GAAG5C,kBAGrB,YACY,MAAT3P,GAAyB,MAATA,GAAyB,MAATA,KACnC0uD,IAAa3pC,OAAO0pC,WAAaC,EAAWH,EAAOh8C,GAAGxC,SAC5C,MAAT/P,GAAyB,MAATA,GAAyB,MAATA,KACjC2uD,IAAc5pC,OAAO0pC,WAAaE,EAAYJ,EAAOh8C,GAAG5C,aAElD4+C,EAAOh8C,GAAGhP,IACVgrD,EAAOh8C,GAAG/O,IACV+qD,EAAOh8C,GAAGhP,EAAIgrD,EAAOh8C,GAAGxC,QACxBw+C,EAAOh8C,GAAG/O,EAAI+qD,EAAOh8C,GAAG5C,SACpB4+C,EAAOh8C,GAAGxC,QACTw+C,EAAOh8C,GAAG5C,sBAIpB4+C,EAAOh8C,GAAGhP,EAAIuY,MAAeyyC,EAAOh8C,GAAGhP,GACvCgrD,EAAOh8C,GAAG/O,EAAI0Y,MAAeqyC,EAAOh8C,GAAG/O,GACvC+qD,EAAOh8C,GAAGhP,EAAIgrD,EAAOh8C,GAAGxC,MAAQiM,MAAeuyC,EAAOh8C,GAAGhP,EAAIgrD,EAAOh8C,GAAGxC,OACvEw+C,EAAOh8C,GAAG/O,EAAI+qD,EAAOh8C,GAAG5C,OAASg8B,MAAe4iB,EAAOh8C,GAAG/O,EAAI+qD,EAAOh8C,GAAG5C,SAK7D,SAAf2+C,MACK,IACA,IACA3/B,EAAOquB,WACPruB,EAAOiyB,kBAGVhkC,EAAK,IAAIlK,MAAMN,GACfyK,EAAK,IAAInK,MAAMN,GACZG,EAAI,EAAGA,EAAIH,GACS,MAAvBi8B,EAAiB97B,KADIA,EAAG,KAGtB9C,EAAO8+C,EAAOh8C,YACjBA,GAAK,IACLA,GAAK,EACAvS,OACH,MACAuS,GAAKuJ,EAAOrM,EAAKlM,YAEjB,MACAgP,IAAMuJ,EAAOE,GAAQ,GAAKvM,EAAKlM,EAAIkM,EAAKM,MAAQ,aAEhD,MACAwC,GAAKyJ,GAAQvM,EAAKlM,EAAIkM,EAAKM,iBAE3B,MACAwC,GAAK2J,EAAOzM,EAAKjM,YAEjB,MACA+O,IAAM2J,EAAOyvB,GAAQ,GAAKl8B,EAAKjM,EAAIiM,EAAKE,OAAS,aAEjD,MACA4C,GAAKo5B,GAAQl8B,EAAKjM,EAAIiM,EAAKE,cAI7Bi2C,qBAAqBhpC,EAAIC,UAW3BmgC,SAAW0B,KAAgBjjC,OAK3BmlC,SAAWlC,KAAgBhjC,OAoB3BkzC,aAAe,SAAUnzC,EAAGC,KACvB/T,aAAa,QAAS8T,KACtB9T,aAAa,SAAU+T,OACzBmzC,EAAK3hD,GAAE,qBAAqB,GAC5B4hD,EAAO9/C,EAAWpH,aAAa,KAC/BmnD,EAAO//C,EAAWpH,aAAa,KAC/BrE,EAAKkY,EAAI,EAAI7Z,KAAKo7C,SAAWr+B,EAAc,EAC3Cnb,EAAKkY,EAAI,EAAI9Z,KAAKg/C,SAAWjiC,EAAc,KAEhC3P,SACRpN,KAAKo7C,SAAWr+B,SACf/c,KAAKg/C,SAAWjiC,kBAGf,OAAS/c,KAAKo7C,SAAW,IAAMp7C,KAAKg/C,cAG9BiO,SACR7/C,EAAWpH,aAAa,gBACvBoH,EAAWpH,aAAa,wBAK5BonD,EAAQ5vC,GAAQ,2BAClB4vC,MACeA,SACR,cACC,WAIIhjB,oBAAoBrkC,aAAa,YAAa,aAAepE,EAAI,IAAMC,EAAI,QAazF,iBAICyrD,MAAO1rD,EAAG2rD,MAAO1rD,EAAG2rD,MAAOL,EAAMM,MAAOL,EAAMM,IAAK9rD,EAAIurD,EAAMQ,IAAK9rD,EAAIurD,KAEjExrD,IAAGC,IAAG2rD,MAAOL,EAAMM,MAAOL,EAAMM,IAAK9rD,EAAIurD,EAAMQ,IAAK9rD,EAAIurD,SAU7DQ,cAAgB,SAAU1hB,EAAOlV,OAC9Bk2B,EAAKzvC,GAAQ,oBACbowC,EAAStiD,GAAE2hD,GAAIjsC,KAAK,QAAQ,GAC9BosC,EAAQ5vC,GAAQ,sBACbzX,aAAa,OAAQkmC,GACxBlV,GACGq2B,MACKp0B,EAAOlzB,gBAAgB5G,EAAGuM,IAAK,YACtB2hD,MACX,yBACG,cACC,2BACa,iBACd,4BAGHA,EAAOr2B,KACZzpB,OAAO8/C,IACDA,KACHz/C,eAWLkgD,aAAe,SAAUptC,OACxB3L,SACEg5C,EAAUrhB,EAAiB,GAC7B77B,GAAO,EACLm9C,EAAWz4B,GAAmB4H,GAAgB0C,IAAoBe,sBACnEotB,EAASnvD,WACC,MAAXkvD,IAEKC,IADDttC,EAAOstC,EAASnvD,OAAS,EAAI,gBAG/B+R,EAAIo9C,EAASnvD,OACV+R,QACDo9C,EAASp9C,KAAOm9C,EAAS,IACrBrtC,EAAO9P,EAAI,EAAIA,EAAI,IACdo9C,EAASnvD,SACZ,EACGkW,EAAM,MACTi5C,EAASnvD,OAAS,KAEnBmvD,EAASj5C,aAKVlE,IAAO,KACd,WAAY67B,UAGd9vB,aA0CAi0B,kBAAoB,gOAcL9E,sOC5+NpB,IAAM/V,QACC,mCACE,gCAGJp3B,OAAOqY,iBACHA,sBACA5E,kBACAA,OCbTnI,KAAK+jD,UAAY,SAAUz9C,EAAOy9C,eACdvsD,IAAdusD,IAAyBA,EAAY,GAClC/jD,KAAKoR,MAAM9K,EAAQtG,KAAKC,IAAI,GAAI8jD,IAAc/jD,KAAKC,IAAI,GAAI8jD,IAQpE,OCTM1iD,GAAIC,OAEN0iD,UAQSC,GAAa,SAAU9vD,EAAM4S,EAAKgvC,OAEvCppC,EAAStL,GAAE,eAAesL,gBACzBvX,QAAQ2R,GAAK1R,QAAQ,yBAAE4qB,OAAK9Y,UAC5BA,WAAe6F,IAAIiT,GAEpB81B,MAAa,IAAM91B,GACTtT,EAAOoK,KAAKkJ,GAChBtrB,OAAQ,KACVgS,EAAOgG,EAAOoK,KAAKkJ,GAAK,UAEtB9rB,OACH,cACE,IAAW+jC,EAAPxxB,EAAI,EAAUwxB,EAAOvxB,EAAKsgB,WAAWvgB,GAAKA,OAC3B,IAAlBwxB,EAAKlR,UAAkBkR,EAAK30B,YAAYq1B,OAAQ,GAC7Cr1B,YAAc4D,kBAMpB,UACEqoB,MAAQroB,gBAIP6F,IAAI,YAAciT,MAqB5BikC,UAuBSC,8CAAW,WAAgBC,wHACnBF,GAAQG,YAAYL,0BACrC5xC,KAAKkyC,EAAM,SAAU59C,EAAGY,GACpBA,EAAEshB,SACOvnB,GAAEkjD,MAAMH,EAAU98C,EAAEshB,SAK9Bw7B,EAASI,8DAGZA,KAGEJ,GAHFI,MAEAC,IAAAA,WAAY13B,IAAAA,OAAQ23B,IAAAA,OAAQC,IAAAA,OAAQ9yC,IAAAA,MAG3B,0BAEO4yC,EAAWG,4BACbJ,EAAMK,wBACRL,EAAMM,yBACHN,EAAMO,mCACCP,EAAMQ,gCAChBR,EAAMS,sBAENl4B,EAAOm4B,uBACNn4B,EAAOo4B,uBACRp4B,EAAOq4B,uBACNr4B,EAAOs4B,4BACHt4B,EAAOu4B,8BACTv4B,EAAOw4B,6BACNx4B,EAAOy4B,+BAEPhB,EAAMiB,2BAETf,EAAOA,YACdF,EAAMkB,qBACKlB,EAAM/B,yBACRiC,EAAOiB,iCACF54B,EAAO64B,mCAETpB,EAAMqB,iCACPrB,EAAMsB,kCACJrB,EAAWsB,iCAEdh5B,EAAOi5B,eAAiB,oBACvBj5B,EAAOk5B,yCACGl5B,EAAOm5B,uBACrBn5B,EAAOo5B,8BACEp5B,EAAOq5B,4BACbzB,EAAO7gD,qBACRipB,EAAOs5B,8BACDt5B,EAAOu5B,yBACdv5B,EAAOw5B,uBACNx5B,EAAOy5B,wBACP7B,EAAOzgD,2BAEAygD,EAAO8B,0BACT9B,EAAO+B,sBAEP/B,EAAO8B,wBACT9B,EAAO+B,qBAEN/B,EAAO8B,uBACT9B,EAAO+B,oBAENhC,EAAOA,OAAOl8C,MAAM,IAAIjB,KAAK,gBAEnCi9C,EAAMmC,sBACHnC,EAAMoC,qBACRpC,EAAMqC,uBACNrC,EAAMsC,qBACRtC,EAAMuC,mBACNvC,EAAMwC,8BAEKj6B,EAAOk6B,sCACPl6B,EAAOm6B,yBACfn6B,EAAOo6B,gCAEEp6B,EAAOq6B,wBACVr6B,EAAOs6B,iCACRt6B,EAAOu6B,qCACNv6B,EAAOw6B,aAC1B,WAIDn1C,MAAM,MAAO,OAAQ,QAAS,iBAAkB,SAAU,QAAS,UAAW,aAAc,UAAW,YAAa,aAAc,aAC7H,0BAA4Brc,KAAO,MAAQyuD,EAAMzuD,WAGtDqc,MAAM,OAAQ,aAAc,aAAc,aACrC,0BAA4Brc,KAAO,MAAQ2uD,EAAO3uD,UAGpD,mCAAqC2uD,EAAO8C,OAEtC,UAAWrT,MAEX,2BACUqQ,EAAMiD,4BACdhD,EAAWiD,oBACXjD,EAAWkD,mBACZlD,EAAWmD,2BACFnD,EAAWoD,yBAClBpD,EAAWqD,sBACXrD,EAAWsD,sBACXtD,EAAWuD,sBACXvD,EAAWwD,sBACXxD,EAAWyD,uBACVzD,EAAWniB,oBACfmiB,EAAWr7C,gBACNq7C,EAAW0D,uBACd1D,EAAW2D,sBACT3D,EAAW4D,yBACV3D,EAAO8C,eACT9C,EAAO4D,oBACR5D,EAAA,iBACGA,EAAO6D,sBACL5D,EAAO6D,mBACb9D,EAAO+D,gBACRhE,EAAWiE,gBACXjE,EAAWkE,gBACXlE,EAAWmE,gBACXnE,EAAWoE,qBACNpE,EAAWqE,2BACVrE,EAAWsE,6BACVtE,EAAWuE,8BACXvE,EAAWwE,8BACXxE,EAAWyE,8BACXzE,EAAW0E,yBAChB3E,EAAM4E,kBACRv3C,EAAGw3C,wBACAx3C,EAAGy3C,uBACF7E,EAAW8E,mBACX9E,EAAW+E,wBACN/E,EAAWgF,4BACZhF,EAAWiF,oBAClBjF,EAAWkF,uBACNjF,EAAOkF,yBACVnF,EAAWoF,iBACXpF,EAAWqF,mBACTrF,EAAWsF,0BACXtF,EAAWuF,0BACXvF,EAAWriB,2BACVrV,EAAOy5B,eAChB/B,EAAWwF,kCACIp4C,EAAGq4C,qCACN1F,EAAM2F,6BACN3F,EAAM4F,8BACN5F,EAAM6F,4BACR7F,EAAM8F,4BACJ9F,EAAM+F,6BACP/F,EAAMgG,0BACRhG,EAAMiG,qBACThG,EAAWvrD,gBACZurD,EAAWzT,eACXyT,EAAWiG,iBACTlG,EAAMmG,uBACPnG,EAAMxmD,uBACAwmD,EAAMxmD,kBACXwmD,EAAMgD,sBACAhD,EAAMgD,iBACXhD,EAAMoG,4BACJpG,EAAMqG,2BACTrG,EAAMsG,wBACNtG,EAAMuG,2BACHtG,EAAWpiB,8BACNmiB,EAAMwG,8BACXxG,EAAMyG,wBACPzG,EAAM0G,wBACT1G,EAAM2G,uBACL1G,EAAW2G,iBACb5G,EAAM6G,2BACC7G,EAAM8G,0BACT9G,EAAM+G,yBACJ/G,EAAMgH,4BACLhH,EAAMiH,2BACRjH,EAAMkH,uBACRjH,EAAWr1B,4BACJo1B,EAAMmH,yBAChBnH,EAAMoH,wBACFpH,EAAMqH,wBACVrH,EAAMsH,oBACNtH,EAAMuH,mBACFvH,EAAMwH,0BACRxH,EAAMyH,wBACNzH,EAAM0H,wBACN1H,EAAM2H,sBACR3H,EAAM4H,sBACJ5H,EAAM6H,kBACR7H,EAAM8H,kBACH9H,EAAM+H,uBACJ/H,EAAMgI,yBACXhI,EAAMiI,qBACLjI,EAAMkI,WAEjB,sBAEK1I,aAAWI,kHAaRuI,iCAAY,WAAgBC,EAAYC,EAAWC,+FAC1DF,KACUA,OAEAvrD,GAAE0rD,KAAK,WAEbrrD,UAAUsrD,gBACAtrD,UAAUsrD,aACbtrD,UAAU6kD,cACP7kD,UAAU6kD,mBAIlBv5C,IAAI,SAAWg3C,IAGlB6I,EAAU9qD,SAASiiD,KAA4B,SAAdA,QACxB,SAUJ8I,EAAKG,SAAW,QAAUjJ,GAAY,WAC3CG,YAGC+I,GAAuBpgC,UACnB,iBAAmBk3B,GAAU17C,QAAQ,KAAM,mKCnTzD,IAAM6kD,MAEA9rD,IChCS,SAAS+D,GAAwsB,SAASD,EAAEG,MAAsB,iBAATA,EAAEsjB,UAA4BvjB,EAAEC,EAAE6G,QAAQ5G,EAAED,EAAEsjB,KAAKpzB,cAAcgT,MAAM,KAAKlD,EAAE6G,QAAQ,SAASmV,MAAMvrB,OAAOurB,EAAE1sB,SAAS,mBAAmB0W,KAAKgW,EAAE1sB,OAAOysB,WAA2B,SAAhBC,EAAE1sB,OAAOT,UAA2B0b,EAAW,aAATyR,EAAEntB,MAAmBiR,EAAEgoD,QAAQC,YAAY/rC,EAAEgsC,OAAOl0B,EAAEjU,OAAOC,aAAa9D,EAAEgsC,OAAO93D,cAAcklC,EAAI,GAAGz2B,KAAQqd,EAAEuoB,QAAY,QAAJh6B,OAAc,QAAUyR,EAAEisC,SAAa,SAAJ19C,OAAe,SAAWyR,EAAEksC,UAAUlsC,EAAEisC,SAAa,SAAJ19C,OAAe,SAAWyR,EAAEpE,UAAc,UAAJrN,OAAgB,UAAYA,IAAKvI,EAAEuI,IAAG,KAAYvI,EAAE8xB,IAAG,EAAKn1B,EAAEqD,EAAElC,EAAEgoD,QAAQK,UAAUr0B,KAAI,EAAY,WAAJ9xB,MAAgBlC,EAAEgoD,QAAQK,UAAUr0B,KAAI,QAAU,IAAIpyB,EAAE,EAAExB,EAAED,EAAE5Q,OAAOqS,EAAExB,EAAEwB,OAAQ/C,EAAEsB,EAAEyB,WAAY3B,EAAEmB,MAAMzQ,KAAK0Q,uBAAt2C2mD,SAASM,QAAQ,MAAML,aAAaM,EAAE,YAAYC,EAAE,MAAMC,GAAG,SAASC,GAAG,QAAQC,GAAG,OAAOC,GAAG,MAAMC,GAAG,QAAQC,GAAG,WAAWC,GAAG,MAAMC,GAAG,QAAQC,GAAG,SAASC,GAAG,WAAWC,GAAG,MAAMC,GAAG,OAAOC,GAAG,OAAOC,GAAG,KAAKC,GAAG,QAAQC,GAAG,OAAOC,GAAG,SAASC,GAAG,MAAMC,GAAG,IAAIC,GAAG,IAAIC,GAAG,IAAIC,GAAG,IAAIC,IAAI,IAAIC,IAAI,IAAIC,IAAI,IAAIC,IAAI,IAAIC,IAAI,IAAIC,IAAI,IAAIC,IAAI,IAAIC,IAAI,IAAIC,IAAI,IAAIC,IAAI,IAAIC,IAAI,IAAIC,IAAI,KAAKC,IAAI,KAAKC,IAAI,KAAKC,IAAI,KAAKC,IAAI,KAAKC,IAAI,KAAKC,IAAI,KAAKC,IAAI,KAAKC,IAAI,KAAKC,IAAI,MAAMC,IAAI,MAAMC,IAAI,MAAMC,IAAI,UAAUC,IAAI,SAASC,IAAI,IAAIC,IAAI,OAAOC,IAAI,IAAIC,IAAI,KAAKtD,WAAWuD,IAAI,IAAIC,EAAI,IAAIC,EAAI,IAAIC,EAAI,IAAIC,EAAI,IAAIC,EAAI,IAAIC,EAAI,IAAIC,EAAI,IAAI5D,EAAI,IAAIC,EAAI,IAAI4D,EAAI,IAAIC,IAAI,IAAIC,IAAI,IAAIC,IAAI,KAAKC,IAAI,IAAIC,IAAI,IAAIC,IAAI,IAAIC,IAAI,IAAIC,KAAK,QAAyrB5/C,MAAM,UAAU,QAAQ,YAAY,aAAa6/C,MAAMC,QAAQn8D,OAAO6jD,IAAIz0C,KAEt9CC,GCNQ,SAAU9D,mBAEfD,EAAEqN,OAAOhI,EAAyDrB,EAAEsK,EAAE4T,EAAoB4uC,EAAE1kC,EAAEzmB,EAAwI6I,EAA3NvI,EAAET,MAAM5Q,UAAUgT,MAAM6R,EAAEwK,mBAAmBngB,EAAE9D,EAAE+wD,MAAYhtD,EAAE/D,EAAEgxD,IAAIhxD,EAAEgxD,QAAc9sD,EAAElE,EAAE4wD,MAAMC,QAAQ5sD,EAAE,aAAagtD,EAAE,cAAcC,EAAE,WAAW56D,EAAE,cAAcsM,EAAE,WAAWy2B,EAAE,OAAOhxB,EAAE,MAAMhS,EAAE,cAAckY,EAAE,QAAU4iD,KAAK,SAASC,EAAEC,SAAqB,iBAAJA,WAAsBC,EAAEC,OAAOF,EAAEprD,EAAEiQ,KAAK9Q,UAAU,GAAG,OAAO,kBAAkBmsD,EAAEpsD,MAAMzQ,KAAK28D,EAAEG,OAAOvrD,EAAEiQ,KAAK9Q,uBAA8IjB,EAAEstD,EAAEC,EAAEL,EAAEM,EAAEJ,OAAOK,EAAEC,EAAExrD,EAAEub,EAAEkwC,SAAKH,IAAItsD,GAA+DysD,KAA1DT,EAAErqD,MAAMyqD,EAAE,mBAAmB,8BAAiC,IAAI,GAAU,IAAJF,GAAOH,EAAEO,KAAMA,EAAE1qD,QAAQwqD,EAAEljD,EAAElY,EAAE,OAAWiY,EAAEjI,EAAE,IAAIsrD,EAAEP,EAAEO,GAAGrjD,EAAEmjD,EAAEP,EAAED,GAAGU,GAAGA,EAAEE,EAAM,IAAJN,EAAMI,EAAM,IAAJJ,EAAMvxD,EAAE05B,UAAUi4B,EAAE/vC,GAAG5hB,EAAE05B,UAAU9X,EAAE+vC,GAAGE,EAAE/tD,EAAE+tD,GAAMJ,MAAKI,EAAE5qD,QAAQuH,EAAEiL,OAAMpT,EAAE,IAAIorD,EAAE,IAAII,IAAIxrD,EAAE,GAAG,IAAI,IAAIwrD,EAAEC,KAASJ,EAAEL,IAAIhsD,EAAEgsD,EAAEhkD,EAAEzK,GAAGy2B,IAAWu4B,EAAqwB,SAASG,EAAEN,EAAEJ,EAAEE,UAAMF,IAAIhsD,GAAc,kBAAJgsD,KAAiBA,EAAEA,EAAEvtD,EAAE2tD,EAAEP,EAAED,QAAYG,EAAEC,GAAGA,EAAEpqD,QAAQwqD,EAAEljD,EAAElY,EAAE,IAAIg7D,EAAS/iD,EAAE+iD,EAAEE,GAAsJ,SAASvgD,EAAE2gD,EAAEJ,EAAEE,EAAEJ,UAAOD,EAAEK,IAAe,qBAAJA,gBAAAA,QAAgBA,EAAEA,EAAEF,EAAEA,EAAElsD,GAAS3Q,KAAKqc,KAAK,eAAe8gD,EAAE7xD,EAAEtL,MAAMo9D,EAAEP,GAAG5rD,KAAKjR,KAAKsrB,UAAU,IAAI7rB,gBAAgB,GAAGkS,EAAEyrD,GAAGD,EAAE9sD,KAAK+sD,IAAI,GAAGD,EAAE9sD,KAAK+sD,EAAEhuD,EAAE6tD,GAAGtrD,EAAEorD,EAAEJ,QAArsCJ,GAAGK,EAAEntD,EAAE,WAAtZktD,UAAUA,EAAEpqD,QAAQ,6BAA6B,QAA0WnD,EAAEotD,GAAGltD,EAAEstD,EAAEntD,EAAE,WAA3dktD,UAAUA,EAAEpqD,QAAQ,gBAAgB,QAA4bjD,EAAEguD,SAAS,SAAST,KAAKA,GAAG,GAAG,IAAIF,EAAErxD,EAAEyT,IAAI89C,EAAEpqD,MAAM,IAAIid,oBAAoB5V,EAAE,IAAIxE,OAAOqnD,EAAEnrD,KAAK,KAAK,MAAMlC,EAAEguD,SAAS,MAAMhyD,EAAEiyD,QAAQ3jD,EAAE,SAASqjD,EAAEN,OAAOI,KAAKF,GAAGW,MAAO,EAAGC,OAAQ,EAAGC,KAAO,MAA8hB,OAAxhBpyD,EAAE+Q,KAAK4gD,EAAE1qD,QAAQ,MAAM,KAAKE,MAAM,KAAK,SAAS0qD,EAAEQ,OAAgCP,EAAzBzrD,EAAEgsD,EAAElrD,MAAM,KAAKmrD,EAAE74C,EAAEpT,EAAE,IAAMurD,EAAEH,EAAEC,EAAE,EAAEa,EAAED,EAAEnrD,MAAM,MAAMya,EAAE2wC,EAAEj/D,OAAO,KAAK,KAAK2W,KAAKsoD,EAAE,KAAK,MAAMtoD,KAAKsoD,EAAE3wC,OAAOA,GAAG2wC,EAAE3wC,GAAG3a,QAAQ,MAAM,IAAqC2a,GAAjC2wC,EAAEA,EAAE/0B,QAAQr2B,MAAM,KAAKqqD,OAAOe,IAAOj/D,OAAO,KAAS,EAAgB,IAAX+S,EAAE/S,YAAcmmB,EAAEpT,EAAE,IAAOgrD,MAAKS,IAAIr1D,MAAMq1D,IAAIA,EAAM,cAAJA,EAAgBzsD,EAAEksD,EAAEO,KAAKzsD,EAAEksD,EAAEO,GAAGA,GAAKlwC,OAAQ8vC,GAAG9vC,EAAE8vC,IAA+BE,EAAEA,IAAnB,KAAPW,EAAEb,GAAQE,EAAEt+D,OAAOi/D,EAAEb,IAAUA,EAAE9vC,EAAEgwC,EAAEU,KAAKC,EAAEb,EAAE,IAAIj1D,MAAM81D,EAAEb,EAAE,WAAWI,OAAW9xD,EAAEyF,QAAQgsD,EAAEa,MAAOA,GAAGx1D,KAAKg1D,GAAWL,EAAEa,KAAKjtD,IAAKitD,IAAIb,EAAEa,GAAGR,KAAUQ,GAAGR,OAAaQ,MAAKA,GAAGjB,EAAEhsD,EAAE,MAAcosD,KAAwHR,GAAGK,EAAES,EAAE,GAAGzjD,EAAE4iD,GAAGhvC,EAAEovC,EAAES,EAAE,GAAG/xD,EAAE1J,KAAK0J,EAAE1J,GAAG,SAAS+6D,UAAUrxD,EAAE05B,OAAOy3B,EAAEE,MAAMvtD,EAAEu1B,EAAEm5B,KAAKn5B,EAAEo5B,OAAOpqD,EAAE2iB,IAAI3iB,EAAEya,MAAMza,EAAEqqD,KAAK,SAASC,KAAKt5B,EAAE7N,OAAOnjB,IAAI1C,EAAE3F,EAAE1J,KAAyMwO,GAAGmsD,GAAGK,EAAEtgD,EAAEigD,GAAGjxD,EAAE8E,GAAGosD,GAAGI,EAAEtgD,EAAEkgD,GAAGntD,EAAE6uD,UAAU9B,EAAE,SAASa,EAAEN,GAAMD,EAAEO,IAAI,KAAK1nD,KAAK0nD,IAAIN,IAAIhsD,MAAK,OAAMosD,EAAEE,IAAItsD,EAAEksD,EAAEvtD,EAAEqJ,EAAEzK,GAAGy2B,GAAGo4B,EAAEE,KAAKF,EAAEJ,EAAE,GAAGhkD,EAAEzK,GAAGy2B,GAAGk4B,GAAG,IAAItnD,KAAKsnD,GAAG,GAAG,MAAMxtD,EAAE8uD,SAASzmC,EAAE,SAASilC,EAAEE,UAAUF,IAAIhsD,GAAc,kBAAJgsD,EAAcnvC,EAAEmvC,GAAGnvC,EAAEqvC,GAAGF,IAAIttD,EAAE+uD,YAAY,SAASzB,OAAOE,KAAQF,IAAIhsD,MAAK+mB,IAAIpsB,EAAE+Q,KAAK/Q,EAAEyF,QAAQ4rD,GAAGA,EAAEjsD,UAAU,SAASusD,EAAEF,UAAUF,EAAEE,QAAOF,EAAE,IAAIrtD,EAAED,GAAGjE,EAAE05B,OAAOx1B,EAAED,IAAIs0C,IAAI,SAAS8Y,OAAOI,EAAE,SAASF,EAAEO,OAAOH,EAAEG,EAAEZ,GAAGltD,IAAI8tD,EAAEe,SAAS,SAASxsD,EAAEwrD,UAAUxrD,IAAIhB,GAAc,kBAAJgB,EAAciI,EAAEqjD,EAAEtrD,GAAGiI,EAAEqjD,EAAEE,GAAGxrD,IAAIorD,EAAEtsD,MAAMzQ,KAAK0Q,cAAcpF,EAAE+yD,WAAW1B,GAAQ,SAAFA,EAASE,IAASF,EAAEvmD,QAAQumD,EAAEvmD,QAAQymD,MAAQtxD,EAAO5M,iBASznF2M,EAAEqF,EAAEtB,OAAO4B,EAAwW8T,EAAEwG,EAAE8X,EAAE+4B,EAAX7qD,EAAjWozB,EAAEr5B,EAAE4wD,MAAMC,QAAQ7sD,EAAE,WAAWC,EAAE,aAAaqK,EAAE,OAAOnK,EAAEnE,EAAEgzD,QAAQpwD,EAAElP,SAASu/D,aAAazkD,EAAErK,EAAE+uD,gBAAOtwD,GAAOA,EAAE,GAAGsB,EAAE,KAAKD,KAAKoB,IAAImJ,EAAE,SAAS1K,EAAEmC,GAAgB,SAAXA,GAAGZ,EAAErB,GAAGsK,IAAYrH,QAAQ,gBAAgB,QAAQhD,EAAE,SAAS,IAAIo1B,EAAEp1B,GAAGjE,EAAE05B,OAAOL,EAAEp1B,IAAIkvD,MAAM,cAAcjvD,SAAU,IAAQyB,EAAEkhB,QAAQusC,SAAS,cAAclvD,SAAU,IAAQyB,EAAEy0C,UAA2Bn0C,MAA2Q4gB,MAAM,eAAcpN,OAAcpR,EAAEvE,IAAIi0B,MAAvR+4B,EAAE,SAAS9/C,UAAUA,GAAMxC,MAAKxO,EAAE,gCAAgCyzC,OAAO4f,YAAY,QAAQ,GAAGC,cAAcxC,EAAE,kBAAkBhtD,EAAEmc,EAAEvsB,SAASsQ,GAAGsK,MAAKypB,EAAE,SAAS3L,EAAEpb,MAAMob,IAAIpb,EAAE,KAAK3I,EAAE4X,EAAEvsB,SAAS2U,EAAEuqC,OAAO2gB,QAAQlrD,EAAErE,GAAGwvD,KAAK,IAAIpnC,KAAMtoB,OAAuD,SAAUkN,QAAQkR,EAAEpe,IAAIsoB,EAAE0kC,EAAEzoD,GAAM6Z,IAAI7Z,KAAKA,EAAE6Z,EAAEkK,GAAGpsB,EAAEqF,GAAGouD,QAAQxvD,IAAWmoB,IAAI/jB,MAAKrE,GAAGsK,GAAGjJ,EAAErB,GAAGsK,GAAGrH,QAAQ,MAAM,IAAI,IAAImlB,KAAKkd,WAAWt4B,EAAEhR,EAAEiE,EAAE,UAA7I,KAA4JgC,EAAEm0C,KAAK,WAAen6B,OAAMyzC,aAAaj6C,GAAGA,EAAE,IAAthB9T,EAAiiBM,GAAQhG,EAAO5M,QAE/4B4M,GCyEQ,SAAUD,OACjB2zD,KAEFC,kBA0BFD,SAAW,SAAUE,OAAM/gB,4DACrBghB,EAAQ,6BACZC,EAAU,+BACVC,EAAQlhB,EAAKvkC,GAAK,GAClB0lD,EAAQnhB,EAAKtkC,GAAK,GAChBhC,SAAOkhB,SAAQwmC,SACjBC,GAAY,EAAOC,GAAa,EAAOC,EAAe,EAClDjwD,IAAY/Q,OAAOmN,QAGb,2CAER8zD,YACAxhB,EAAKyhB,KAAM,GACJv0D,EAAE,iBAAmB6zD,EAAO,yBAAyB3zB,SAAS,QAAQuT,aAEpE6gB,EAAO,GAAGE,kBACZtiB,KAAKuiB,KACH,GAAG,GACZ,MAAOC,YAGJ,KACCC,EAAS,IAAIxvC,YACjByvC,UACKf,WACK,0BACDtsC,GACFA,KAIIotC,EAAOpvC,gBAAgBgC,EAAM,cACpC,aACS,aALPstC,mBAQCpzD,GAEDpO,OAAOmN,QACP,iBAIEiB,EAAIqzD,iBACGH,EAAOpvC,gBAAgB9jB,EAAIqzD,aAAc,aAEtClvC,WAAWtyB,UACnBuhE,KAEF,aACS,aAGTA,eAOHJ,EAAUp5C,EAAK05C,MACV,SAAR15C,EAAgB,IACd+4C,EAAY,WAKVY,KADGV,EAAO,GAAGE,kBACQ9mC,EAAOunC,eAAe,gBAC5CD,GAAaD,GAAUC,mBAEP,cACNP,EAAU,YAGR,OAIJ,OAGPz0D,EAAE0tB,EAAOjH,YAAYkB,WAExBmrB,EAAKoiB,kBAeG,WACJf,GAAWgB,KACf,SAjBa,KACVC,EAAUC,EAAU,uGAEhBr1D,EAAE,IAAIiyC,OAASltC,UAClBqwD,QACE,SACC,IACPl1B,SAAS,QACTgS,KAAK,cAEM,KACTojB,MAAM,2BAUNC,EAAShiE,EAAQiiE,EAAMztD,EAAI0tD,MAC9BrxD,GAASoxD,EAAK/lB,IAAI,aAAc,UAChCqD,EAAK7rC,QAAS,CACZwuD,GAAOD,EAAKzwD,KAAK,KAAMgD,OACrB2tD,EAAKniE,EAAOwR,KAAK,SACnB2wD,GAAIF,EAAKzwD,KAAK,QAAS,YAAc2wD,KAClC3vB,YAAYyvB,UAEZxzD,OAAOwzD,GAEZpxD,cACS,aACJuxD,WAAW,UACf,OAIHC,kBACKC,EAASL,EAAMztD,QACA5R,IAAlB28C,EAAKgjB,WAA4C,IAAlBhjB,EAAKgjB,YAC9BF,EAAQJ,EAAMztD,GAAI,KAEnBA,GAAMytD,WAGRL,EAAWY,EAASC,OACvB7B,GACArhB,EAAKoiB,SAAQa,GAAU,OAEvBE,YACAF,MACW/1D,EAAEtM,SAAS64B,cAAc,SAC3BknB,OAAOvT,SAAS,QAEzB81B,EAAU,KACN30D,EAAOyxC,EAAKojB,eAAiB,KACjCnlD,KAAKilD,EAAU,SAAUjuD,EAAIouD,KACpBn2D,EAAE,IAAM+H,KACJ/H,EAAE,IAAIiyC,OAChBltC,YACQ,eACF1D,EAAO80D,QACLnC,SACCC,MACH,SAGKlsD,kBAGV7C,EAAMsH,EAAMlZ,OACT+R,EAAI,EAAGA,EAAIH,EAAKG,IAAK,KACtBC,EAAOkH,EAAMnH,GACZ0C,EAAMzC,EAANyC,MACI,YAAPA,EAAkB,QACb/H,EAAE,IAAM+H,OACXlG,EAAUnO,SAAS8G,gBAAgBs5D,EAAO,SAGxC5tC,eAAe,KAAM,WAAY,EAAG,EAAG8tC,EAAOC,GAAO/tD,KAAK,UAE9D5F,EAAMgF,EAAKihB,uBAAuButC,EAAO,OAAO,GAG9CvlD,EAAIjO,EAAI5F,aAAa,SACrB8T,EAAIlO,EAAI5F,aAAa,YACvBwR,gBAAgB,WAChBA,gBAAgB,UAET5L,EAAI5F,aAAa,cAEtBD,aAAa,WAAY,EAAG,EAAG8T,EAAGC,GAAGtI,KAAK,QAIxCzL,aAAa,QAASq5D,KACtBr5D,aAAa,QAASu5D,KACtBv5D,aAAa,SAAUw5D,KACvBx5D,aAAa,cAAes5D,KAC5Bt5D,aAAa,QAAS,YAIzB2J,IAAS9D,EAAMA,EAAI0C,WAAU,MAE1BhB,OAAO1B,OAEXk1D,YACAO,EAAS,GACA1nC,QAAQrsB,OAAOH,OACpBiF,EAAMuuD,EAAUxyC,EAASsB,SAASC,oBAAmB,IAAIgyC,eAAgBC,kBAAkBx0D,QAC1F7B,EAAE,IAAIiyC,OACVltC,MAAMuxD,MAAO,WAAY3pC,IAAK7lB,WAE1B8sD,EAAO5zD,EAAE6B,GAAUwD,KAEpBmwD,EAAMztD,GAId+qC,EAAKyjB,aACLxlD,KAAK+hC,EAAKyjB,UAAW,SAAU33C,EAAK7W,GAC/B4rD,EAAS5rD,MACZ6W,GAAK7N,KAAK,SAAU1L,OAChBqiB,EAAOisC,EAAS5rD,GAAIpL,QACpB0I,EAAI,IAAM0wD,IAASruC,EAAOksC,EAAOlsC,EAAMriB,GAAG,MACtCrF,EAAEtL,MAAOgzB,EAAM3f,OAIxBiuD,IACCD,GAASE,EAAW5zD,SACpBiyD,GAAQA,EAAOjyD,SACf6xD,GAASA,EAAQ7xD,UAEnBywC,EAAK3V,QAAQn9B,EAAEw2D,eAAe1jB,EAAK3V,WAC3B,EAER2V,EAAKd,UAAUc,EAAKd,SAAS2hB,aA4D1BkB,OACHhB,EAAKnzD,SAAS,SAAU,KACpB+1D,EAAU5C,EAAK5sD,QAAQ,QAAS,QAClC5T,OAAOqY,iBACDC,IAAI,oCAEZgoD,SAAS8C,EAAS3jB,QACXA,EAAKkjB,aACJ,EAAOljB,EAAKkjB,mBAIjBnzC,EAAUC,MAEbzvB,OAAO2vB,KAAM,OAAO3vB,OAAO2vB,KAAKF,OAC9B4zC,EAAU,oEACVzzC,EAAS,IAAIzd,MAA2C,EAArC7G,KAAKukB,OAAOJ,EAAMxvB,OAAS,GAAK,IAErD+R,EAAI,EAAGgI,EAAI,IACZ,KACK8V,EAAOL,EAAMM,WAAW/d,KACxBge,EAAOP,EAAMM,WAAW/d,KACxBie,EAAOR,EAAMM,WAAW/d,KAExBke,EAAOJ,GAAQ,EACfK,GAAgB,EAAPL,IAAa,EAAME,GAAQ,EAEtCI,GAAgB,GAAPJ,IAAc,EAAMC,GAAQ,EACrCI,EAAc,GAAPJ,EACP7mB,MAAM4mB,KACDK,EAAO,GACLjnB,MAAM6mB,OACR,MAGFjW,KAAOqpD,EAAQj5D,OAAO8lB,KACtBlW,KAAOqpD,EAAQj5D,OAAO+lB,KACtBnW,KAAOqpD,EAAQj5D,OAAOgmB,KACtBpW,KAAOqpD,EAAQj5D,OAAOimB,SACtBre,EAAIyd,EAAMxvB,eAEZ2vB,EAAO/c,KAAK,MAlGZ,SAAUywD,EAAOC,EAAQC,OAC1BvwC,EAAOqwC,EAAMjhD,KAAK,YACnB4Q,EAAKhzB,OAAQ,OAAOqjE,MAErBG,WACA1yD,EACQkiB,EAAK5Q,KAAK,KAAKkS,OAAO,mBACrBlzB,KAAKqT,KAGNue,EAAK5Q,KAAK,YAGhB+sC,EAAWkU,EAAM,GAAGjyB,qBAAqB,KAAMx/B,EAAMu9C,EAASnvD,gBAE5Dyd,KAAK,SAAU1L,OACd0C,EAAMrT,KAANqT,GAMDgvD,EAAQ,IAAMhvD,EAAK6uD,EAASvxD,OAC7B0C,GAAKgvD,MAEJC,EAAS,QAAUjvD,EAAK,IACxBkvD,EAAS,QAAUF,EAAQ,QAe5B1xD,EAAI,EAAGA,EAAIH,EAAKG,IAAK,KAClBC,EAAOm9C,EAASp9C,GAClBC,EAAK5K,aAAa,UAAYs8D,KAC3Bv8D,aAAa,OAAQw8D,GAExB3xD,EAAK5K,aAAa,YAAcs8D,KAC7Bv8D,aAAa,SAAUw8D,GAE1B3xD,EAAK5K,aAAa,YAAcs8D,KAC7Bv8D,aAAa,SAAUw8D,MAI3BN,MAsDTO,WAAa,SAAUnvD,EAAIovD,OACvB3B,EAAO7B,EAAS5rD,UAChBovD,GAAe3B,MACV5B,EAAO4B,EAAM,GAAG,GAAM74D,OAAM,IAE9B64D,KAoBPgB,eAAiB,SAAU9wD,OAErB0xD,GAAap3D,EAAE,mBAAmB1M,SACtCyd,KAAKrL,EAAK,SAAUkZ,EAAKy4C,OACnBlmD,EAAM3L,MAAMC,QAAQ4xD,GACpB9oD,EAAI4C,EAAMkmD,EAAK,GAAKA,EACxB7oD,EAAI2C,EAAMkmD,EAAK,GAAKA,EAClBD,MACIx4C,EAAI3X,QAAQ,cAAe,UAEjC2X,GAAK7N,KAAK,gBACLtW,aAAa,QAAS8T,QACtB9T,aAAa,SAAU+T,GACxBnb,OAAOmN,OAASnN,OAAOikE,cACpBzsD,WAAW3H,MAAML,MAAQ0L,EAAI,UAC7B1D,WAAW3H,MAAMT,OAAS+L,EAAI,WAKpCxO,GNxcM,SAAUA,GAClBA,EAAEu3D,uBACHA,uBAGCv3D,EAAEu3D,mBAAmB72D,SADP,kCAEf62D,mBAAmBz6D,KAFJ,iCAgGjBy9C,4BA3Eaid,iBACLC,EAAUD,cACX9c,MAAQj+C,MAAMg7D,EAAQ/c,OAAS,IAAM+c,EAAQ/c,MAE9C+c,EAAQ/vC,iBAKL50B,KAAO2kE,EAAQ/vC,KAAK50B,UAMpB4nD,MAAQ+c,EAAQ/vC,KAAKgzB,WAMrBC,WAAa,UAKb+c,eAAiB,UAKjBC,eAAiB,KAEdjjE,KAAK5B,UACR,iBAEA,kBACE6nD,WAAa8c,EAAQ/vC,KAAKizB,qBAE5B,sBACE+c,eAAiBD,EAAQ/vC,KAAKgwC,eAAe10D,WAAU,aAEzD,sBACE20D,eAAiBF,EAAQ/vC,KAAKiwC,eAAe30D,WAAU,QAIrDy0D,EAAQC,qBACZ5kE,KAAO,sBACP6nD,WAAa,UACbgd,eAAiB,UACjBD,eAAiBD,EAAQC,eAAe10D,WAAU,IAE9Cy0D,EAAQE,qBACZ7kE,KAAO,sBACP6nD,WAAa,UACb+c,eAAiB,UACjBC,eAAiBF,EAAQE,eAAe30D,WAAU,IAE9Cy0D,EAAQ9c,iBACZ7nD,KAAO,kBACP6nD,WAAa8c,EAAQ9c,kBAGrB7nD,KAAO,YACP6nD,WAAa,UACb+c,eAAiB,UACjBC,eAAiB,UAsB1B7yD,GAAG8yD,yBAMI,IAAI53D,EAAEu6C,UAAUC,0BASR,mDAUD,mBAML,eAGLl2C,EAAUjE,UAAUH,UAAUQ,SAAS,mBAiBpCm3D,EAAQ5jE,EAAM4X,EAAOisD,OACtBxyD,EAAO5R,SAAS8G,gBAAgBiwB,GAAGnqB,IAAKrM,mBAhB7BqR,EAAMuG,MACnBvH,MACG,IAAMsB,KAASiG,IAAYpR,aAAamL,EAAOiG,EAAMjG,aAErD,IAAMA,KAASiG,EAAO,KACnB/F,EAAM+F,EAAMjG,GAAQ8N,EAAOpO,EAAKM,GAClC8N,GAA6B,cAArBA,EAAKutC,cACV19C,QAAQ0B,MAAQa,IAEhBrL,aAAamL,EAAOE,KAQtBR,EAAMuG,GACXisD,KACQ91D,OAAOsD,GAEZA,WAmCPR,GAAGy1C,UAAY,SAAUkd,EAASM,EAAYC,UACvCtjE,KAAKqc,KAAK,eACTknD,EAAQj4D,EAAEtL,MACdwjE,EAAYl4D,EAAE05B,QAAO,KAAU15B,EAAE8E,GAAG8yD,kBAAmBH,OACvD1vD,EAAKkwD,EAAMlzD,KAAK,MAChBozD,EAAQ,IAAMF,EAAMlzD,KAAK,MAAQ,OAE9BozD,OAKCC,EAAY,kBACRH,EAAMj8B,MAAMlpC,UACf,mBACGkpC,MAAM07B,eAAiB,eAE1B,mBACG17B,MAAM27B,eAAiB,eAE1B,eACG37B,MAAM27B,eAAiBM,EAAMj8B,MAAM07B,eAAiB,KAGhC,mBAArBO,EAAMF,YAA6BE,EAAMF,WAAWE,EAAMj8B,SAC3DyX,QAEF4kB,EAAgB,WACY,mBAAzBJ,EAAMD,gBAAiCC,EAAMD,mBAC9CvkB,UAGN/Z,QAAO,EAAMu+B,SAEN,IAAIj4D,EAAEu6C,UAAUC,OAAO9yB,KAAMwwC,EAAUl8B,mBACZ,mBAAf+7B,EAA4BA,EAAa,oBAClB,mBAAnBC,EAAgCA,EAAiB,aAIhE,KACJM,EAAOt4D,EAAE3M,QAEU,SAArB4kE,EAAMj8B,MAAMlpC,SACRkpC,MAAQ,IAAIh8B,EAAEu6C,UAAUC,OAAOG,WAAY,cAG7C4d,SAAS,sBACTC,KACJ,6XAQczwD,EAAK,kEAEf0wD,EAAYz4D,EAAEm4D,EAAQ,wBACtBO,EAAa14D,EAAEm4D,EAAQ,2BAElBK,KACT,YAAczwD,EAAK,2EACgBmwD,EAAU7kE,OAAOslE,YAAc,iBAClD5wD,EAAK,4EACLA,EAAK,2SAOaA,EAAK,uHAELA,EAAK,iQAOLA,EAAK,qHAELA,EAAK,wUASLA,EAAK,8GAELA,EAAK,oRAMsCA,EAAK,+EAEhDA,EAAK,8GAELA,EAAK,ijBAiBrBA,EAAK,wGACHA,EAAK,gEAAkEmwD,EAAUrmB,OAAO+mB,WAAa,yDAElF7wD,EAAK,qLAI1BA,EAAK,qGACHA,EAAK,8DAAgEmwD,EAAUrmB,OAAO+mB,WAAa,yDAEhF7wD,EAAK,kLAI1BA,EAAK,qGACHA,EAAK,8DAAgEmwD,EAAUrmB,OAAO+mB,WAAa,yDAEhF7wD,EAAK,+JAI1BA,EAAK,kGACHA,EAAK,4DAA8DmwD,EAAUrmB,OAAO+mB,WAAa,yDAE9E7wD,EAAK,6HAIZA,EAAK,4EACLA,EAAK,0EAKjC8wD,EAAM,MAIFA,EAAM,EACdC,EAAQD,EAAM,EAEVE,OAGJ,wBAAwBl2D,MADV,SAGVg9B,EAAY7/B,EAAE,IAAM+H,EAAK,4BAA4B,GAErDzH,EAAMu3D,EAAO,UACb9vD,EAAK,uBACF8wD,SACCA,QACDpuC,GAAGnqB,KACTu/B,GAOCm5B,EAAUf,EAAMj8B,MAAMlpC,KAEtBstB,EAAO63C,EAAMj8B,MAAMg9B,GACnBC,EAAc74C,EAEZ84C,EAAYjB,EAAMj8B,MAAM0e,MAExBye,EAAsB,eAAZH,SAGRA,OACH,iBAEA,oBACEG,MACSpxD,GAAKA,EAAK,uBACfkxD,EAAc34D,EAAI+R,YAAY4mD,MAEhC,qBACDlxD,EAAK,sBACRzH,GACa,mBAAZ04D,YAED,iBACEG,MACSpxD,GAAKA,EAAK,uBACfkxD,EAAc34D,EAAI+R,YAAY4mD,MAEhC,qBACDlxD,EAAK,sBACRzH,OAGD84D,YACAD,EAAS,GACJF,EAAcj5D,EAAE,IAAM+H,EAAK,sBAAsB,MAEjD,EAAG,OADFkwD,EAAMj8B,MAAMg9B,IACG,OAEjBlmE,IAAcolE,EAAUmB,YAEjB,WAATvmE,SACMolE,EAAUmB,aACb,UACI,EAAG,IAAM14B,EAAO,aAGpB,kBAEC24B,EAAW,GACNj0D,EAAI,EAAGA,EAAI,EAAGA,GAAK,EAAG,KAEzBk0D,GAAO,IAAMpqD,SAASwxB,EAAMp3B,OAAOlE,EAAG,GAAI,KAAK2nB,SAAS,IACxDusC,EAAIjmE,OAAS,IAAGimE,EAAM,EAAIA,MAClBA,KAEP,EAAG,IAAMD,EAAU,aAGvB,WACI,EAAG,UAAW,aAGlB,WACI,EAAG,UAAW,QAGlB,GAAa,WAATxmE,EAAmB,KACtBiiC,EAAQ,SAAUmjC,EAAUmB,QAAWnB,EAAUmB,QAAQtkC,KAAO,KAC/D,EAAImjC,EAAUmB,QAAQ14B,OAAS,IAAMA,EAAQ5L,QAIlDh+B,EAAK0Q,WAAW2Y,EAAK1lB,aAAa,OAAS,GAC/C1D,EAAKyQ,WAAW2Y,EAAK1lB,aAAa,OAAS,GAC3CzD,EAAKwQ,WAAW2Y,EAAK1lB,aAAa,OAAS,GAC3CxD,EAAKuQ,WAAW2Y,EAAK1lB,aAAa,OAAS,GAEvCyL,EAAKsB,WAAW2Y,EAAK1lB,aAAa,OAAS,IAC/C0L,EAAKqB,WAAW2Y,EAAK1lB,aAAa,OAAS,IAC3C8+D,EAAK/xD,WAAW2Y,EAAK1lB,aAAa,OAASyL,GAC3CszD,EAAKhyD,WAAW2Y,EAAK1lB,aAAa,OAAS0L,GAEvCszD,EAAc7B,EAAO,WACrB9vD,EAAK,oBA7GC,IACA,QA+GH4xD,SACCb,OACF,QAAU/wD,EAAK,kCACLmxD,EAAY,KAC3B54D,GAGGs5D,EAAa55D,EAAE,UAAU+E,YACtB,sCACA,eACN9C,KAAK,GAAGwtC,SACJz4C,EAAK6hE,OACJ9hE,EAAK8hE,IACVtxC,KAAK,QAAS,SAAS2Y,SAASL,GAE7Bg6B,EAAWD,EAAWj9D,QAAQsF,KAAK,GAAGwtC,SACrCv4C,EAAK2hE,OACJ5hE,EAAK4hE,IACV9zD,KAAK,QAAS,YAAYwiB,KAAK,QAAS,OAAO2Y,SAASL,GAErDi6B,EAAc95D,EAAE,UAAU+E,YACvB,sCACA,gBACN9C,KAAK,KAAKwtC,SACNrpC,EAAKyyD,OACJ1yD,EAAK0yD,IACVtxC,KAAK,QAAS,UAAU2Y,SAASL,GAE9Bk6B,EAAaD,EAAYn9D,QAAQsF,KAAK,KAAKwtC,SAC1CgqB,EAAKZ,OACJW,EAAKX,UACF,SACR9zD,KAAK,QAAS,eAAewiB,KAAK,QAAS,SAAS2Y,SAASL,KAErD,GAAG93B,GAAKA,EAAK,4BAcpBiyD,WACFjpD,MAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,KAAM,MAAO,SAAU1L,EAAGN,OAC9Dk1D,EAAWx9D,MAAMsI,EAAK,IAExBm1D,EAAUjB,EAAYv+D,aAAaqK,GAClCm1D,MAECD,EAEQ,MAGS,OAATl1D,EAAgB,MAAQ,SAI5BA,GAAQ/E,EAAE,IAAM+H,EAAK,cAAgBhD,GAC5Ce,IAAIo0D,GACJC,OAAO,WAEF19D,MAAMgL,WAAW/S,KAAKuQ,SAAWvQ,KAAKuQ,MAAQ,OAC3CA,MAAQ,EACJvQ,KAAKuQ,MAAQ,SACjBA,MAAQ,IAGG,MAAZF,EAAK,IAAei1D,KACnBC,GAAwB,mBAAZjB,IAAmCiB,GAAwB,mBAAZjB,MAClDv+D,aAAasK,EAAMrQ,KAAKuQ,WAIlCwwC,EAAQwkB,EACE,MAAZl1D,EAAK,GAAa+0D,EAAcC,EACpB,MAAZh1D,EAAK,GAAa60D,EAAaC,EAE7BO,EAAUr1D,EAAKrE,SAAS,KAAO,OAAS,QAExC+uC,IAAI2qB,EAAS1lE,KAAKuQ,MAAQ4zD,KAC/BsB,eA4FDE,EAAer6D,EAAE,IAAM+H,EAAK,yBAE9BmyC,SAAOogB,SAASC,SAEdC,EAAU3C,EAAO,UAClB,6CACG,cACE,sBACQ,UACP,aACR1hE,GAYCskE,SAUAC,EAAS,EAAGC,GAAS,EAAG9iE,GAAQ,EAEhC+iE,GAAKz0D,EACL00D,GAAKz0D,EAkDH00D,GAAejD,EAAO,aACnB,cACC,IACPwC,EAAa,IASVU,GAAWlD,EAAO,eACf,UACC,IATWA,EAAO,iBACnB,UACC,gBACM,oBACV,mBACHiD,KAOGE,GAAU9C,EAAUrmB,OAAO+mB,WAAa,qBAErC1yC,eAAeuE,GAAGwwC,MAAO,aAAcD,MAE9CF,IAAc7vC,MAAM,SAAU5P,QACjBg/C,EAAavwC,SAEH,SADNzO,EAAV9nB,OACIkX,aACPpU,EAAIglB,EAAIstB,MAAQ8xB,EAAWnwB,KAAO,QAClCj0C,EAAI,GAAK,GAAKA,EAAIwiE,EAAM,GAAKA,EAAM,GAAKxiE,GACjCwiE,EAAK,EAAG,GAAG,KAClBqC,uBAGJJ,IAAcK,UAAU,cACXn5D,OAAOw4D,OAGV3C,EAAO,OAASiD,MAErB,WACD,MACA,MACAjC,EAAM,MACN,kBACY,SACR,QACPiC,QAEGM,GAAkB1C,EAAWhjD,KAAK,2BAA2BykD,OAAO,aAC5D1/D,aAAa,eAAgBuF,EAAEtL,MAAMoR,SAI/Cu1D,GAAgB,KAEdC,GAAc,SAAUjgD,OACxBhlB,EAAIglB,EAAIstB,MAAQ7e,GAAOwgB,KACvBh0C,EAAI+kB,EAAIutB,MAAQ9e,GAAOqgB,MAGvB9zC,EAAI,EAAI,EAAIA,EAAIwiE,EAAMA,EAAMxiE,IAC5BC,EAAI,EAAI,EAAIA,EAAIuiE,EAAMA,EAAMviE,KAElBm5C,IAAI,OAAQp5C,GAAGo5C,IAAI,MAAOn5C,OAGlCilE,EAAQllE,EAAIsjE,EACZ6B,EAAQllE,EAAIwiE,EAEZhmE,EAAOuoE,GAAc9zC,KAAK,SAC1BnH,EAAO64C,SAELnmE,OACH,UACOiE,GAAG+O,IAAIy1D,KACPvkE,GAAG8O,IAAI01D,KACZ/gE,aAAa,KAAM8gE,KACnB9gE,aAAa,KAAM+gE,aAErB,QACOvkE,GAAG6O,IAAIy1D,KACPrkE,GAAG4O,IAAI01D,KACZ/gE,aAAa,KAAM8gE,KACnB9gE,aAAa,KAAM+gE,aAErB,WACOr1D,GAAGL,IAAIy1D,KACPn1D,GAAGN,IAAI01D,KACZ/gE,aAAa,KAAM8gE,KACnB9gE,aAAa,KAAM+gE,MACnBD,KACAC,iBAGF,UACOhC,GAAG1zD,IAAIy1D,KACP9B,GAAG3zD,IAAI01D,KACZ/gE,aAAa,KAAM8gE,KACnB9gE,aAAa,KAAM+gE,UAItB/nE,kBAGAgoE,GAAY,SAAZA,OACY,OACXnsB,OAAO,YAAagsB,IAAahsB,OAAO,UAAWmsB,IAQtDC,MAFIzC,EAAY1yC,uBAAuBkE,GAAGnqB,IAAK,SAE9BhN,UAEjBooE,GAAW,EAAG,MACTA,GAAW,KACJ15D,OAAOtO,SAAS8G,gBAAgBiwB,GAAGnqB,IAAK,WAClDo7D,KAEIzC,EAAY1yC,uBAAuBkE,GAAGnqB,IAAK,YAGhD,IAAI+E,GAAI,EAAGA,GAAIq2D,GAAUr2D,QACrB,EAAG,EAAG,EAAG,EAAG60C,EAAM70C,QAGXS,IAAImzD,EAAYv+D,aAAa,iBAAmB,WAE5DovB,aAGQ,IAEArvB,aAAa,eAAgBy+D,EAAY,OAEnD,IAAMnxD,EAAK,mBAAmBqgC,UAAU,SAAU/sB,KAC9C5nB,oBACYuM,EAAEtL,SAET2mE,GAAc/vD,SAASwe,WAC3BggB,UAAUwxB,IAAa1wB,QAAQ6wB,QAIpC,IAAM1zD,EAAK,iBAAiBpM,KAAK,QAAS,aACpCqgC,MAAMlpC,KAAOkmE,IACbh9B,MAAMg9B,GAAWC,EAAYj2D,WAAU,KACvCg5B,MAAM2e,WAAa,aAGzB,IAAM5yC,EAAK,qBAAqBpM,KAAK,QAAS,SAAUqgC,SAI1C,mBAAZg9B,IACEgB,IACSjjD,UAEA08B,SACD+lB,GAAG1zD,IAAI,MACP2zD,GAAG3zD,IAAI,QAInB,IAAMiC,EAAK,wBAAwB,GAAG4zD,SAAW3B,MAE/C4B,UAAQC,eAEV,IAAM9zD,EAAK,wBAAwBoyD,OAAO,cAC7BzlE,KAAKinE,UACPG,OAAO9B,KACRR,GAAG1zD,IAAI,MACP2zD,GAAG3zD,IAAI,QACXsa,EAAO64C,KACRe,EAKE,KACCR,EAAKoC,IAAU,GACfnC,EAAKoC,IAAU,KAChBphE,aAAa,KAAM++D,KACnB/+D,aAAa,KAAMg/D,KACdD,GAAG1zD,IAAI0zD,KACPC,GAAG3zD,IAAI2zD,WAVRr5C,EAAK1lB,aAAa,SAClB0lB,EAAK1lB,aAAa,QACtBwR,gBAAgB,QAChBA,gBAAgB,eAWjB+sD,EAAY1yC,uBAAuBkE,GAAGnqB,IAAK,SAClChN,QAEF,EAAG,MACTooE,GAAW,KACJ15D,OAAOtO,SAAS8G,gBAAgBiwB,GAAGnqB,IAAK,WAClDo7D,KAEIzC,EAAY1yC,uBAAuBkE,GAAGnqB,IAAK,YAGjDy7D,UAmDAC,GAAW,EAAGC,GAAW,KAEb,mBAAZjD,EAA8B,KAC1B5qD,GAAQ6qD,EAAY3wD,kBAAkB/E,WAChB,IAAxB6K,GAAMvT,cAAqB,KACvBwN,GAAI+F,GAAMzK,QAAQ,GAClBqN,GAAI5C,GAAMzK,QAAQ,MACT,IAAX0E,GAAEvV,MAAyB,IAAXke,GAAEle,KAAY,KAC1BmT,GAAI+K,GAAEnN,OACA,IAARoC,GAAEnC,KACOnF,KAAKoR,MAAmB,MAAX,EAAI9J,GAAEnC,IACb,IAARmC,GAAEhC,OACAtF,KAAKoR,MAAkB,KAAX,EAAI9J,GAAEhC,WAG5B,GAA4B,IAAxBmK,GAAMvT,cAAqB,KAE9B4e,GAAIrL,GAAMzK,QAAQ,GAClB0E,GAAI+F,GAAMzK,QAAQ,GAClBqN,GAAI5C,GAAMzK,QAAQ,MAET,IAAX8V,GAAE3mB,MACO,IAAXuV,GAAEvV,MACS,IAAXke,GAAEle,KACF,IACW6L,KAAKoR,MAAM0J,GAAE5hB,WAClBoO,GAAI+K,GAAEnN,OACA,IAARoC,GAAEnC,KACOnF,KAAKoR,MAAmB,MAAX,EAAI9J,GAAEnC,IACb,IAARmC,GAAEhC,OACAtF,KAAKoR,MAAkB,KAAX,EAAI9J,GAAEhC,WAM/Bi4D,mBAEM,IAAMn0D,EAAK,gCACZ,IAAMA,EAAK,6BAC4B,KAAxCkxD,EAAYv+D,aAAa,MAAQ,qBAG/B,IAAMqN,EAAK,8BACZ,IAAMA,EAAK,2BACbkwD,EAAMj8B,MAAM0e,OAAS,mBAGlB,IAAM3yC,EAAK,+BACZ,IAAMA,EAAK,4BACbi0D,kBAGG,IAAMj0D,EAAK,+BACZ,IAAMA,EAAK,4BACbk0D,OAIPlrD,KAAKmrD,GAAS,SAAUppE,EAAMy0B,OACxB40C,EAASn8D,EAAEunB,EAAK40C,UACf/zB,UAAU,SAAU/sB,OACnB/P,EAAS6wD,EAAO7wD,yBAGd6wD,QACCn8D,EAAEunB,EAAKzE,uBAENxX,EAAOwe,YAEZggB,UAAUsyB,IAAYxxB,QAAQyxB,MAC/B5oE,qBAGJ8zB,EAAKzE,OAAOhd,IAAIyhB,EAAKzhB,KAAKq0D,OAAO,eAC3BmC,EAAoB,mBAAZtD,EACVlzD,GAAOpR,KAAKuQ,MACZs3D,EAAO,SACHzpE,OACH,SACCwpE,GAAOrD,EAAYx+D,aAAa,IAAKqL,EAAM,OACvCnH,KAAKC,IAAIkH,EAAM,IAAK,IAAW,EA7rB7B,cAgsBP,YACGk2B,MAAM0e,MAAQ50C,IACRrL,aAAa,eAAgBqL,EAAM,YACxCA,YAGJ,aACM60D,GAAS,EACN,IAAR70D,EAAW,GACN02D,WAGL12D,EAAM,OAAMA,EAAM,MAClBA,EAAM,KACC,EAAKA,EAAM,OAETA,EAAM,IAAO,KAGPA,EAAM,KAAO,EAntBtB,IAmtB2B,IACjCw2D,GAAOt2D,eAGR,cACKF,GACO,OACP,MA1tBE,IA4tBNw2D,GAAOt2D,KAETu2D,EA9tBQ,MAAA,IAguBDA,EAAO,MACT,KAEF9sB,KAAKgtB,cAAeF,EAAO,MACjCpC,mBAGCiC,GAAa,SAAU/gD,IA5KX,SAAUnX,OACnB4lB,EAAUiyC,GAAVjyC,OACD4yC,EAAMX,GAAOzwD,OACfjV,EAAK6N,EAAEykC,MAAQ7e,EAAOwgB,KAAOn7B,SAASutD,EAAIjtB,IAAI,sBAC9Cp5C,EA/jBU,MA+jBGA,EA/jBH,KAgkBVA,GAAK,IAAGA,EAAI,OACVsmE,EAAOtmE,EAAI,YAjkBH,IAokBN0lE,GAAOjpE,UACV,YACC6L,KAAKC,IAAQ,EAAJvI,EAAO,MACZ,KAAQA,EAAI,OAAMA,EAAI,GAC1BA,GAAK,MAAMA,EAAI,OACPoE,aAAa,IAAKpE,aAE3B,YACG2lC,MAAM0e,MAAQvrC,SAAa,IAAJ9Y,KACjBoE,aAAa,eAAgBpE,aAEtC,UACM,KACA,EACLA,EAAI,SACD,KACS,EAAI,IAAOA,EAChBA,EAAI,WAET,MADC,MAES,EAAI,IAAOA,QAIvBskE,KAAe,MADd,OAECh8D,KAAKuP,IAAI7X,cAGZ,WACK,MACAA,GAAK,YAER,OAGAiP,KAAKmqC,KAAKgtB,cAAeE,MAC5Bh+D,KAAKoR,MAAU,IAAJ1Z,MACRysB,MAAMhd,IAAIzP,IA+HPglB,KACN5nB,kBAGA4oE,GAAa,SAAbA,EAAuBhhD,KACtBi0B,OAAO,YAAa8sB,IAAY9sB,OAAO,UAAW+sB,MAC9C,MAIPO,IAAiC,IAApB3E,EAAMj8B,MAAM0e,MAAc,KAAK1tB,SAAS,IAClD4vC,GAAUtpE,OAAS,MAAiB,IAAMspE,MACrCA,GAAUz1D,MAAM,KAAK,KACE,SAA3B8wD,EAAMj8B,MAAM2e,WAAwB,GAAKsd,EAAMj8B,MAAM2e,WAAaiiB,GAErEzD,MACKjf,EAAM,GAAGx/C,aAAa,iBAI9Bg/B,OAAO15B,EAAE8E,GAAG+3D,QAAQjyC,SAASv3B,sBACf,EAAMypE,SAAUhqE,KAAM,OAAQiqE,MAAO,OAG3CF,iBAEI1uC,MAAO+pC,EAAU7kE,OAAOslE,qBACxBC,WAAYV,EAAUrmB,OAAO+mB,mBAC9BoE,OAAQr8B,EAAOs8B,cAAc,IAExC,SAAUt8B,KACF3E,MAAMlpC,KAAO,eACbkpC,MAAM0e,MAAQ/Z,EAAM76B,IAAI,QAAUnH,KAAKoR,MAAO4wB,EAAM76B,IAAI,KAAO,IAAO,KAAO,MAC7Ek2B,MAAM2e,WAAaha,EAAM76B,IAAI,OAAS66B,EAAM76B,IAAI,OAAS,SACzDk2B,MAAM27B,eAAiB,UAG/B,KACA,qBAGIuF,GAAOl9D,EAAEm4D,EAAQ,0BAClBltC,MAAM,cACJkyC,YAAY,2BACfzoE,MAAM6jE,SAAS,2BACfJ,EAAQ,UAAU1kB,WACd3gD,EAAOkN,EAAEtL,MAAMqQ,KAAK,gBACF/E,EAAEm4D,EAAQ,wBAAwBphD,OAC7C,OAATjkB,GAA0B,OAATA,EAAe,GAEhC,cAAgBA,EAAO,UAAUikB,SACjC,eAA0B,OAATjkB,EAAgB,KAAO,MAAQ,UAAU2gD,SAE1D,IAAM1rC,EAAK,mBAAmB,GAAGtN,aAAa,OAAQ,QAAUsN,EAAK,IAAMjV,EAAO,sBAIjE,OAATA,EAAgB,iBAAmB,mBAE3C,IAAMiV,EAAK,wBAAwBjC,IAAImyD,EAAMj8B,MAAM0e,OAAOyf,aAEtDiD,EAAUp9D,EAAE,IAAM+H,EAAK,IAAMjV,EAAO,mBAAmB,MAEzDmmE,IAAgBmE,EAAS,KACrBC,EAAWr9D,EAAEi5D,GAAavjD,KAAK,UACnC0nD,GAAS/uC,QAAQrsB,OAAOq7D,KACZD,MACRhjC,EAAKghC,GAAgBt1D,QACfrL,aAAa,eAAgB2/B,KAEtB,OAATtnC,GAAmD,MAAlCmmE,EAAYv+D,aAAa,SAAmByL,IAAOqzD,GAAMpzD,IAAOqzD,KAC3F,IAAM1xD,EAAK,yBAAyB+zD,OAAO9B,GACzCA,MACA,IAAMjyD,EAAK,wBAAwB,GAAG4zD,SAAU,UAGlDxD,EAAQ,wBAAwB1kB,SAChC0kB,EAAQ,uBAAuBphD,WAGnCohD,EAAQ,UAAU1kB,UACf0pB,YAAY,6BACbG,iBACIrF,EAAMj8B,MAAMlpC,UACf,oBACGkN,EAAEm4D,EAAQ,qCAEb,oBACGn4D,EAAEm4D,EAAQ,4CAGVn4D,EAAEm4D,EAAQ,2BAGZphD,kBAGK,cACLwhD,SAAS,yBAAyBttC,SACrC,eAx+BK,wGA+VCsyC,GAAQt9C,EAAG0gB,EAAO5L,EAAMnW,EAAK4+C,OAC9BpjB,EAAOojB,GAAY3F,EAAO,QAAS4F,aAAc98B,EAAO+8B,eAAgB3oC,EAAMjL,OAAQ7J,GAAIg5C,GAC5FuE,KACMA,EAAS9iE,aAAa,gBACvB8iE,EAAS9iE,aAAa,kBACzB8iE,EAAS9iE,aAAa,aAEdsH,OAAOo4C,GAER,OAATrlB,IAAeA,EAAO,OAEpB4oC,EAAU,uIAEVC,EAAS/F,EAAO,UACjB8F,OACG,kCACK,cAAgB,GAAK19C,EAAI44C,GAAO,SAC1CO,GAEG/3D,EAAOw2D,EAAO,UACf8F,OACGh9B,iBACU5L,YACL,cAAgB,GAAK9U,EAAI44C,GAAO,eACnC,sBACQ,KACfO,YAED/3D,GAAM+mC,UAAU,SAAUlkC,aACfxP,QACJ4lE,IACFxwB,UAAU+zB,IAAWjzB,QAAQkzB,MACrBzD,EAAavwC,WACxBr2B,kBACK,IACN8zB,KAAK,OAAQ6yB,GAAM7yB,KAAK,KAAMq2C,GAAQtrD,SAAS,aAC9C,0BAA0ByE,eACtBgnD,EAAcrpE,KAChBspE,GAAe5jB,EAAK1/C,aAAa,iBAAmB,EACpDujE,EAAY7jB,EAAK1/C,aAAa,eAAiB,EAC/CkiE,GAAuC,IAA1Bn1D,WAAWu2D,IAAoBhxC,SAAS,IAClD4vC,EAAUtpE,OAAS,KAAiB,IAAMspE,IACzCqB,EAAU10D,OAAO,GAAKqzD,IAC5B,IAAM70D,EAAK,yBAAyB0nC,KAAKnF,KAAM,IAAK4zB,OAAQ,KAAKrB,iBACvD1uC,MAAO,6DACPyqC,WAAYV,EAAUrmB,OAAO+mB,mBAC9BoE,OAAQr8B,EAAOs8B,cAAc,IACrC,SAAUt8B,EAAOw9B,KACNx9B,EAAM76B,IAAI,OAAU,IAAM66B,EAAM76B,IAAI,OAAU,SACzB,OAAnB66B,EAAM76B,IAAI,KAAgB66B,EAAM76B,IAAI,KAAO,IAAM,IACnDrL,aAAa,OAAQwjE,KACrBxjE,aAAa,eAAgBujE,KACpCvjE,aAAa,aAAcwjE,KAC3BxjE,aAAa,eAAgBujE,KAChC,0BAA0BvqB,SAC1B,IAAM1rC,EAAK,yBAAyB0rC,QACrC,KAAM,aACL,0BAA0BA,SAC1B,IAAM1rC,EAAK,yBAAyB0rC,aAIxCwlB,GAAavjD,KAAK,QAAQ3E,KAAK,eACzBqtD,EAAOp+D,EAAEtL,UACVA,KAAKgG,aAAa,UAAYulB,EAAG,KAC/B0gB,EAAO,KACJ09B,EAAW3pE,KAAKgG,aAAa,cAC7B4jE,EAAU5pE,KAAKgG,aAAa,kBAC7BD,aAAa,aAAc4jE,KAC3B5jE,aAAa,OAAQ4jE,KACrB5jE,aAAa,eAA4B,OAAZ6jE,EAAmB,EAAIA,KACpD7jE,aAAa,eAA4B,OAAZ6jE,EAAmB,EAAIA,YAEtDv1C,OAAOqxB,IACL,KAGPx7B,GAAK2/C,GAAWl9D,GACb+4C,WAuBAmkB,GAAY1hE,GACfy9D,GAASA,EAAQ7/D,aAAa,SAAU,UACvCA,aAAa,SAAU,WAClBoC,GACFgO,WAAW7I,OAAOs4D,YAQnBwD,OACFxuB,OAAO,YAAauuB,IACe,SAApCrD,EAAQ9/D,aAAa,yBAjCjBD,aAAa,UAAW,YAC1B4G,EAAOrB,EAAEs6D,GACTlgB,EAAO/4C,EAAKkmB,KAAK,QACjBo6B,EAAKtgD,EAAKkmB,KAAK,SAClB+yC,EAASlgB,EAAMuH,IAAKt/C,cAgChB,cAOA2D,SACDs4B,EAAMzmC,GAAQ,UAAYA,GAAQ,IAAM+iE,GAAK,IAAMC,GAAK,KAAO,MACtD,IAAXH,GAA2B,IAAXC,KACNzuD,gBAAgB,yBAEvB,KACC7V,GAAKukE,IAAMF,EAAS,GACpBpkE,GAAKukE,IAAMF,GAAS,KACdlgE,aAAa,oBAAqB6jC,EAAM,aAAejoC,EAAI,IAAMC,EAAI,WAAaokE,EAAS,IAAMC,GAAS,eAKjHkD,GAAWxiD,OACdhlB,EAAIglB,EAAIstB,MAAQ8xB,EAAWnwB,KACzBh0C,EAAI+kB,EAAIutB,MAAQ6xB,EAAWtwB,IAO3Bq0B,EAAQ,gBANVnoE,EAAI,GACJ,GACAA,EAAIwiE,EAAM,GACRA,EAAM,GACNxiE,GAE2B,QAC7BC,GAAK,IAAMA,EAAI,OACTmE,aAAa,UAAW,WACxBA,aAAa,YAAa+jE,MAE1B/jE,aAAa,UAAW,UAG7BA,aAAa,YAAa+jE,KAC7Bj3C,KAAKgzC,EAAM,MAAM9/D,aAAa,YAAa+jE,OACvCpkB,EAAOp6C,EAAEunB,KAAKgzC,EAAM,QACpBkE,GAAMpoE,EAAI,IAAMwiE,IAEjBp+D,aAAa,SAAUgkE,OAExBzgD,EAAO,IACTi7C,GAAavjD,KAAK,QAAQ3E,KAAK,SAAU1L,OACnCuS,EAAMljB,KAAKgG,aAAa,UACxB2N,EAAIrI,EAAEtL,MACRkjB,EAAMoG,MACNjQ,OAAOgb,OAAO1gB,KACRrI,EAAEi5D,GAAavjD,KAAK,WAEvBkC,QAkeR5X,GOvqCM,SAAUA,UAClBA,EAAEu3D,uBACHA,uBAGCv3D,EAAEu3D,mBAAmB72D,SADP,oCAEf62D,mBAAmBz6D,KAFJ,mCAoCjBgI,GAAG45D,WAAa,SAAUC,YAEjBC,EAAOjrC,EAAIjgB,WACZ3P,EAAIrQ,SAASuuC,KAEfj+B,EAAI2vB,EAAGjgB,IACHigB,EAAKA,EAAGkrC,eAAkBlrC,IAAO5vB,GAClC/D,EAAEgzD,QAAQE,MAAsC,aAA7Bv/B,EAAGmrC,aAAaC,cACjCprC,EAAGjgB,WAIL1P,WAXH26D,MAcCjqE,KAAKqc,KAAK,gBACViuD,WAAY,OAIZC,aAGGxiE,MAAMgL,WAAWk3D,EAAI9vD,MAA0B,KAAlBgJ,OAAO8mD,EAAI9vD,SACxCpS,MAAMgL,WAAWk3D,EAAI5vD,MAA0B,KAAlB8I,OAAO8mD,EAAI5vD,UACxC4vD,EAAIO,KAAOrnD,OAAO8mD,EAAIO,MAAQ,WAC1BP,EAAIQ,WAAY,OACpBR,EAAIta,KAAOxsC,OAAO8mD,EAAIta,MAAQ,WAC3Bsa,EAAIS,SAAW,eACbT,EAAIU,WAAa,aACrBV,EAAIzhC,OAASxoC,KAAKuQ,YAClB05D,EAAIW,MAAQznD,OAAO8mD,EAAIW,OAAS,aAC7BX,EAAIY,SAAW1nD,OAAO8mD,EAAIY,UAAY,eACpC,cACA,YACJ,aACC,cACCZ,EAAI3sB,UAAY,WAIvBitB,QAAQO,UAAYb,EAAIa,WAAa9qE,KAAKuqE,QAAQC,KAAO,OAEzDO,YAAc,SAAUp6D,OACvB6c,WACAzlB,MAAM/H,KAAKuQ,OACTvQ,KAAKuqE,QAAQ/hC,MACyB,mBAA1BxoC,KAAKuqE,QAAQE,SACzBzqE,KAAKuqE,QAAQE,SAASzqE,KAAM2Q,GAG5BwS,QAAQA,OAAOnjB,KAAKuQ,OAAS4S,OAAOxS,IAAI4D,QAAQ,IAE7B,OAArBvU,KAAKuqE,QAAQpwD,QAAoBlQ,KAAKoQ,IAAImT,EAAGxtB,KAAKuqE,QAAQpwD,MACrC,OAArBna,KAAKuqE,QAAQlwD,QAAoBpQ,KAAKkQ,IAAIqT,EAAGxtB,KAAKuqE,QAAQlwD,WACzD9J,MAAQid,EACwB,mBAA1BxtB,KAAKuqE,QAAQjtB,eAAgCitB,QAAQjtB,SAASt9C,SAGzEA,MACC6jE,SAASoG,EAAIe,WAAa,eAE1B51B,UAAU,SAAU5lC,OAEb7N,EAAI6N,EAAEykC,OAASzkC,EAAE7N,EACjBC,EAAI4N,EAAE0kC,OAAS1kC,EAAE5N,EACjBq9B,EAAKzvB,EAAE3Q,OACPqnC,EAAQ+jC,EAAIgB,SAASC,YAAc,EACnCn9D,EAASzC,EAAE2zB,GAAIlxB,SAAW,EAE1Bo9D,EACHxpE,EAAIuoE,EAAMjrC,EAAI,cACbA,EAAGmsC,YAAcllC,EAAQlmC,KAAKuqE,QAAQc,WAClCzpE,EAAIsoE,EAAMjrC,EAAI,aAAelxB,EAASm4B,EAAS,GAAK,EAAK,KAE7DilC,IAAcnrE,KAAKuqE,QAAQe,WAAY,QAEjCH,QACH,IACDnrE,MAAMyoE,YAAYzoE,KAAKuqE,QAAQI,WAAW9G,SAAS7jE,KAAKuqE,QAAQG,oBAE9D,IACF1qE,MAAMyoE,YAAYzoE,KAAKuqE,QAAQG,SAAS7G,SAAS7jE,KAAKuqE,QAAQI,2BAG9D3qE,MAAMyoE,YAAYzoE,KAAKuqE,QAAQG,SAASjC,YAAYzoE,KAAKuqE,QAAQI,gBAIhEJ,QAAQe,WAAaH,KAI7BI,SAAS,aAENvrE,MAAMyoE,YAAYzoE,KAAKuqE,QAAQG,SAASjC,YAAYzoE,KAAKuqE,QAAQI,gBAC9DJ,QAAQe,WAAa,YACnBE,cAAcxrE,KAAKuqE,QAAQkB,gBAC3BzM,aAAah/D,KAAKuqE,QAAQmB,UAGlCh4B,UAAU,SAAUlkC,iBACF,IAAbA,EAAEokC,QAA4C,IAA5B5zC,KAAKuqE,QAAQe,WAAkB,KAE7Cn1C,EAAW3mB,EAAE2X,SAAWnnB,KAAKuqE,QAAQO,UAAY9qE,KAAKuqE,QAAQC,KAE9DmB,EAAS,aACRZ,YAAYa,EAAKrB,QAAQe,WAAan1C,aAMxCo0C,QAAQmB,OAAS/sE,OAAOi2C,WAAW,iBAGjC21B,QAAQkB,QAAU9sE,OAAO86C,YAAYkyB,EAAQC,EAAKrB,QAAQM,WAC9D7qE,KAAKuqE,QAAQK,UAInB10B,QAAQ,SAAU1mC,UAEVg8D,cAAcxrE,KAAKuqE,QAAQkB,gBAC3BzM,aAAah/D,KAAKuqE,QAAQmB,UAGlC9tD,SAAS,SAAUpO,GACdlE,EAAEgzD,QAAQE,WACPuM,YAAY/qE,KAAKuqE,QAAQe,WAAatrE,KAAKuqE,QAAQC,QAI3DqB,QAAQ,SAAUr8D,UAETA,EAAEs8D,cACL,QAASf,YAAY/qE,KAAKuqE,QAAQC,MAAO,WACzC,QAASO,aAAa/qE,KAAKuqE,QAAQC,MAAO,WAC1C,QAASO,YAAY/qE,KAAKuqE,QAAQ5a,MAAO,WACzC,QAASob,aAAa/qE,KAAKuqE,QAAQ5a,SAUzCoc,SAAS,SAAUv8D,MACdxP,KAAKsqE,iBAEC96D,EAAEs8D,cACL,QAASf,YAAY/qE,KAAKuqE,QAAQC,MAAO,WACzC,QAASO,aAAa/qE,KAAKuqE,QAAQC,MAAO,WAC1C,QAASO,YAAY/qE,KAAKuqE,QAAQ5a,MAAO,WACzC,QAASob,aAAa/qE,KAAKuqE,QAAQ5a,gBAInC2a,WAAY,IAKpB0B,MAAM,SAAUx8D,eACV86D,WAAY,EACT96D,EAAEs8D,cACL,QACA,QACA,QACA,QACA,QAASf,YAAY,MAI3B9jE,KAAK,aAAc,SAAUuI,GAExBA,EAAEyoC,YAAc,SACb8yB,YAAY/qE,KAAKuqE,QAAQC,MACrBh7D,EAAEyoC,aAAe,UACrB8yB,aAAa/qE,KAAKuqE,QAAQC,QAG/BzrE,mBAGH0mE,OAAO,SAAUj2D,QACXu7D,YAAY,KAGjB/qE,KAAKf,uBAEFA,iBAAiB,iBAAkB,SAAUuQ,GAC5CA,EAAE0oC,OAAS,OACR6yB,aAAa/qE,KAAKuqE,QAAQC,MACtBh7D,EAAE0oC,OAAS,QACf6yB,YAAY/qE,KAAKuqE,QAAQC,QAG9BzrE,mBACD,MAIFuM,GJ/QUsiB,EKPnB,SAA4BtiB,OACpB2gE,EAAM3gE,EAAE3M,QACRyjC,EAAM92B,EAAEtM,mBAEZgmC,OAAO15B,EAAE8E,yBAOIizB,EAAGia,eAEC77C,IAAX4hC,EAAE6oC,YACYzqE,IAAd4hC,EAAE8oC,UAAuB9oC,EAAE8oC,QAAU,UACtB1qE,IAAf4hC,EAAE+oC,WAAwB/oC,EAAE+oC,SAAW,IAEzB,IAAd/oC,EAAE8oC,UAAe9oC,EAAE8oC,SAAW,GACf,IAAf9oC,EAAE+oC,WAAgB/oC,EAAE+oC,UAAY,KAElCpsE,MAAMqc,KAAK,eACL4iB,EAAK3zB,EAAEtL,MACPo1B,EAAS9pB,EAAE2zB,GAAI7J,SAEf82C,EAAO5gE,EAAE,IAAM+3B,EAAE6oC,QAGlBrI,SAAS,iBAEZ7jE,MAAMiH,KAAK,YAAa,SAAUuI,OAC5BmX,EAAMnX,IACVxP,MAAMk2C,QAAQ,SAAU1mC,OAClB68D,EAAa/gE,EAAEtL,WACV46C,OAAO,WACC,IAAfj0B,EAAIitB,QAAgBvQ,EAAEipC,WACvB3lD,EAAI6wC,SAAWznD,IAAU,MACxBy2D,oBAEA,gBAAgBznB,OAGd9f,EAAGstC,SAAS,YAAa,OAAO,MAGhC5qE,EAAI6N,EAAEykC,MAAOryC,EAAI4N,EAAE0kC,MAEjBs4B,EAAOP,EAAI99D,QAAU+9D,EAAK/9D,QAC9Bs+D,EAAOR,EAAIl+D,SAAWm+D,EAAKn+D,SAEzBpM,EAAI6qE,EAAO,KAAI7qE,EAAI6qE,EAAO,IAC1B5qE,EAAI6qE,EAAO,KAAI7qE,EAAI6qE,EAAO,MAG1B7xB,OAAO,WACNG,KAAMtF,IAAK7zC,EAAGg0C,KAAMj0C,IAAK+qE,OAAOrpC,EAAE8oC,WAElCnrD,KAAK,KAAKylD,UAAU,aAClBzlD,KAAK,YAAYynD,YAAY,WAChCzoE,MAAM4W,SAASitD,SAAS,WACzB0H,SAAS,aACLvqD,KAAK,YAAYynD,YAAY,aAIhCsD,SAAS,SAAUv8D,UACbA,EAAEs8D,cACL,GACEI,EAAKlrD,KAAK,YAAYpiB,UAGpBoiB,KAAK,YAAYynD,YAAY,SAASkE,QAAQ,qBAAqBC,GAAG,GAAG/I,SAAS,SAClFqI,EAAKlrD,KAAK,YAAYpiB,QAAQstE,EAAKlrD,KAAK,WAAW6iD,SAAS,YAH5D7iD,KAAK,WAAW6iD,SAAS,oBAM7B,GACEqI,EAAKlrD,KAAK,YAAYpiB,UAGpBoiB,KAAK,YAAYynD,YAAY,SAASoE,QAAQ,qBAAqBD,GAAG,GAAG/I,SAAS,SAClFqI,EAAKlrD,KAAK,YAAYpiB,QAAQstE,EAAKlrD,KAAK,YAAY6iD,SAAS,YAH7D7iD,KAAK,YAAY6iD,SAAS,oBAM9B,KACE7iD,KAAK,cAAc+9C,QAAQ,oBAE7B,KACCA,QAAQ,cAMX/9C,KAAK,KAAK45B,OAAO,aACjB55B,KAAK,uBAAuBk1B,QAAQ,oBACnC0E,OAAO,SAASA,OAAO,cACzB,gBAAgBmE,OAEdzB,KACOhyC,EAAEtL,MAAMqQ,KAAK,QAAQwE,OAAO,GAAIvJ,EAAE+gE,IAAc1qE,EAAGA,EAAIyzB,EAAOwgB,KAAMh0C,EAAGA,EAAIwzB,EAAOqgB,IAAKq3B,KAAMnrE,EAAGorE,KAAMnrE,KAE1G,eAIE,aACL20B,MAAM,oBACJqkB,OAAO,SAASA,OAAO,cACtBoyB,QAAQ3pC,EAAE+oC,WACR,KAER,QAML9gE,EAAEgzD,QAAQ2O,UACV,IAAM5pC,EAAE6oC,MAAM7vD,KAAK,aAAgBrc,MAAM+6C,KAAKmyB,cAAe,WACtD5hE,EAAEgzD,QAAQE,OACjB,IAAMn7B,EAAE6oC,MAAM7vD,KAAK,aAAgBrc,MAAMiH,KAAK,gCAAiC,kBAAqB,QAEpG,IAAMo8B,EAAE6oC,MAAM7vD,KAAK,aAAgBrc,MAAMiH,KAAK,8BAA+B,kBAAqB,QAGpGg4B,GAAI4kB,IAAIv4C,EAAE,mBAAmBrE,KAAK,cAAe,kBAAqB,MAEnEqE,EAAEtL,yCAScqjC,eACb5hC,IAAN4hC,KAEArjC,MAAMghB,KAAK,MAAM6iD,SAAS,YACrBv4D,EAAEtL,UAETA,MAAMqc,KAAK,mBACD5a,IAAN4hC,UACI9zB,EAAI8zB,EAAE5wB,MAAM,KACT9B,EAAI,EAAGA,EAAIpB,EAAE3Q,OAAQ+R,MAC1B3Q,MAAMghB,KAAK,WAAazR,EAAEoB,GAAK,MAAMiG,SAASitD,SAAS,cAIxDv4D,EAAEtL,wCASaqjC,eACZ5hC,IAAN4hC,KAEArjC,MAAMghB,KAAK,eAAeynD,YAAY,YACjCn9D,EAAEtL,UAETA,MAAMqc,KAAK,mBACD5a,IAAN4hC,UACI9zB,EAAI8zB,EAAE5wB,MAAM,KACT9B,EAAI,EAAGA,EAAIpB,EAAE3Q,OAAQ+R,MAC1B3Q,MAAMghB,KAAK,WAAazR,EAAEoB,GAAK,MAAMiG,SAAS6xD,YAAY,cAI3Dn9D,EAAEtL,+CASPA,MAAMqc,KAAK,aACTrc,MAAM6jE,SAAS,cAEZv4D,EAAEtL,6CASPA,MAAMqc,KAAK,aACTrc,MAAMyoE,YAAY,cAEfn9D,EAAEtL,8CAUPA,MAAMqc,KAAK,aAETrc,MAAM46C,OAAO,aAAaA,OAAO,aAE9BtvC,EAAEtL,SAGNsL,GP3NO,SAAUA,GACnBA,EAAEu3D,uBAMHA,gCAuBKsK,EAAQC,EAAKrK,OACdQ,EAAQvjE,cAOLg1C,EAAWxlC,OACZ69D,EAAMD,EAAIh4C,YACNxb,EAAc,EAAXyzD,EAAIz3B,KAAUjiC,EAAa,EAAV05D,EAAI53B,kBACrB63B,KAEH14B,WAAW,aACQpzB,KAAK+hD,EAAO/zD,IACtC,KAEDxQ,UAAUiI,KAAK,YAAagvC,GAAWhvC,KAAK,UAAWyvC,KACvD33C,0BAGKk3C,EAAWzmC,uBACL89D,KACH14B,WAAW,aACQpzB,KAAK+hD,EAAO/zD,IACtC,KACDg3D,oBACAznE,kBACK,WAGA23C,EAASlnC,YACdxQ,UAAU47C,OAAO,UAAWlE,GAASkE,OAAO,YAAa3E,KACzDuwB,oBACAznE,kBACK,WAGAwuE,EAA4B/9D,OAC7Bg+D,EAAOJ,EAAIvzD,IACRuzD,EAAItzD,EACT2zD,EAAOj+D,EAAEykC,MAAQ7e,EAAOxb,EAC1B8zD,EAAOl+D,EAAE0kC,MAAQ9e,EAAOzhB,EAEtB85D,EAAO,EAAGA,EAAO,EACZA,EAAOD,IAAMC,EAAOD,GACzBE,EAAO,EAAGA,EAAO,EACZA,EAAOC,IAAMD,EAAOC,KACzBnsD,KAAK+hD,EAAO,MAAQ5hE,EAAK8rE,EAAOD,EAAQI,EAAU14C,EAAMtzB,EAAK8rE,EAAOC,EAAQE,EAAU14C,aA+BnF/jB,EAAK7R,EAAMgR,EAAOu9D,WACHrsE,IAAV8O,cAEG9O,IAATlC,GAA8B,MAARA,IAAcA,EAAO,MACvCA,EAAKE,mBACR,WAAYkC,MACZ,WAAYC,MACZ,oBACaD,IAAGC,QAGR,MAAXksE,GAAmBA,IAAYvK,OAC/BwK,GAAU,EAEVtsD,SAAMC,gBACE,MAARniB,IAAcA,EAAO,MACjBA,EAAKE,mBACR,MACK8Q,IAAWA,EAAM5O,GAAe,EAAV4O,EAAM5O,GAAkB,EAAR4O,IAAe,YAE1D,MACKA,IAAWA,EAAM3O,GAAe,EAAV2O,EAAM3O,GAAkB,EAAR2O,IAAe,YAE1D,eAEKA,GAASA,EAAM5O,GAAe,EAAV4O,EAAM5O,GAAU,IACpC4O,GAASA,EAAM3O,GAAe,EAAV2O,EAAM3O,GAAU,EAGlC,MAAR6f,IACEA,EAAOyT,EAAMzT,EAAOyT,EACfzT,EAAOuT,IAAMvT,EAAOuT,GACzBrzB,IAAM8f,MACJA,KACM,IAGF,MAARC,IACEA,EAAOyT,EAAMzT,EAAOyT,EACfzT,EAAOuT,IAAMvT,EAAOuT,GACzBrzB,IAAM8f,MACJA,KACM,gBAvHWosD,OACpB,IAAIn9D,EAAI,EAAGA,EAAIq9D,EAAapvE,OAAQ+R,MAC1BA,GAAG6Q,KAAK+hD,EAAOA,EAAOuK,IAwHTtsD,KAAK+hD,EAAOuK,GAAWvK,aAqE5Ct8D,EAAMq2C,GACW,mBAAbA,GAAyB0wB,EAAa5lE,KAAKk1C,OAepDloB,SACFk4C,SACA3rE,EAAI,EACJC,EAAI,EACJszB,EAAO,EACPF,EAAO,IACP44C,EAAS,IACTz4C,EAAO,EACPF,EAAO,IACP44C,EAAS,IACTI,EAAQb,EAAIpsD,KAAK,oBAGjBgkB,QAAO,EAAMu+B,wBAhGChkE,EAAMgR,WACE9O,IAAV8O,cAEG9O,IAATlC,GAA8B,MAARA,IAAcA,EAAO,OACvCA,EAAKE,mBACR,cAAey1B,MACf,cAAeF,MACf,gBAAmBE,OAAMF,OAAM44C,cAC/B,cAAez4C,MACf,cAAeF,MACf,gBAAmBE,OAAMF,OAAM44C,cAC/B,qBACa34C,OAAMF,OAAM44C,SAAQz4C,OAAMF,OAAM44C,uBAKlDK,SACAC,SACAC,gBACU,MAAR7uE,IAAcA,EAAO,OACjBA,EAAKE,mBACR,SACQ8Q,IAAWA,EAAM2kB,MAAqB,EAAb3kB,EAAM2kB,MAAqB,EAAR3kB,IAAe,YAEnE,SACQA,IAAWA,EAAMykB,MAAqB,EAAbzkB,EAAMykB,MAAqB,EAARzkB,IAAe,YAEnE,WACQA,GAASA,EAAM2kB,MAAqB,EAAb3kB,EAAM2kB,MAAa,IAC1C3kB,GAASA,EAAMykB,MAAqB,EAAbzkB,EAAMykB,MAAa,YAElD,SACQzkB,IAAWA,EAAM4kB,MAAqB,EAAb5kB,EAAM4kB,MAAqB,EAAR5kB,IAAe,YAEnE,SACQA,IAAWA,EAAM0kB,MAAqB,EAAb1kB,EAAM0kB,MAAqB,EAAR1kB,IAAe,YAEnE,WACQA,GAASA,EAAM4kB,MAAqB,EAAb5kB,EAAM4kB,MAAa,IAC1C5kB,GAASA,EAAM0kB,MAAqB,EAAb1kB,EAAM0kB,MAAa,YAElD,gBAEQ1kB,GAASA,EAAM2kB,MAAqB,EAAb3kB,EAAM2kB,MAAa,IAC1C3kB,GAASA,EAAMykB,MAAqB,EAAbzkB,EAAMykB,MAAa,IAC1CzkB,GAASA,EAAM4kB,MAAqB,EAAb5kB,EAAM4kB,MAAa,IAC1C5kB,GAASA,EAAM0kB,MAAqB,EAAb1kB,EAAM0kB,MAAa,EAGxC,MAAXo5C,GAAmBn5C,IAASm5C,MAErBr5C,KADFq5C,IAGM,MAAXH,GAAmBl5C,IAASk5C,SACvBA,GACSh5C,GAEH,MAAXi5C,GAAmBh5C,IAASg5C,MAErBl5C,KADFk5C,IAGM,MAAXC,GAAmBn5C,IAASm5C,SACvBA,GACSj5C,2BAMHmoB,MACS,mBAAbA,UACP3sC,SACIA,EAAIq9D,EAAahiE,SAASsxC,MAAyBp1C,OAAOyI,EAAG,yBAInE3R,UAAU47C,OAAO,UAAWlE,GAASkE,OAAO,YAAa3E,KACvD2E,OAAO,YAAa5F,KAClB,OACE,OACO,UAyBX/c,IAAM8qC,EAAQkL,OAASlL,EAAQkL,MAAMpsB,QACrChoC,EAAKkpD,EAAQkL,OAASlL,EAAQkL,MAAM9/D,OAAU8/D,EAAM9/D,UACpD2L,EAAKipD,EAAQkL,OAASlL,EAAQkL,MAAMlgE,QAAWkgE,EAAMlgE,WACvD8L,EAAKkpD,EAAQhkD,KAAOgkD,EAAQhkD,IAAI5Q,OAAUi/D,EAAIj/D,UAC9C2L,EAAKipD,EAAQhkD,KAAOgkD,EAAQhkD,IAAIhR,QAAWq/D,EAAIr/D,WAE/C9G,KAAK,YAAa+tC,KACjBxzB,KAAK+hD,iBA3LNiK,EAAOJ,EAAIvzD,EACX8zD,EAAOP,EAAItzD,EACXw0D,EAASL,EAAMp0D,EACf00D,EAASN,EAAMn0D,EACb00D,EAAe,EACjBC,EAAe,aACN,WACLb,EAAS,IAEKY,EAAZ7sE,IAAMqzB,EAAqBw4C,EACT7rE,EAAIisE,EAAUJ,EAAQ,GAE1CK,EAAS,IAEKY,EAAZ7sE,IAAMqzB,EAAqB04C,EACT/rE,EAAIisE,EAAUF,EAAQ,GAG1CW,GAAUd,EAAMgB,GAAgBhB,GAAQ,IAAMc,GAAU,GACvDE,GAAgBF,GAAU,EAE3BC,GAAUZ,EAAMc,GAAgBd,GAAQ,IAAMY,GAAU,GACvDE,GAAgBF,GAAU,IAEzBxzB,KAAMnF,KAAM44B,EAAe,KAAM/4B,IAAKg5B,EAAe,QAC1D,KAjGFnjE,EAAEu3D,mBAAmB72D,SADP,gCAEf62D,mBAAmBz6D,KAFJ,+BAigBjB+/D,uBAiBO,SAAUhsD,OACTonD,EAAQvjE,cACL0uE,EAAkBZ,OACpB,IAAIn9D,EAAI,EAAGA,EAAIq9D,EAAapvE,OAAQ+R,MAAkBA,GAAG6Q,KAAK+hD,EAAOA,EAAOuK,YAE1E18D,EAAK7R,EAAMgR,EAAOu9D,OAEnBa,EAAMC,QAAQr+D,MAChBo+D,GAAsB,KAAfp+D,EAAMs+D,OAAat+D,EAAMs+D,KAAO,aACtCF,EAAK,SACKltE,IAATlC,GAA8B,MAARA,GAAyB,KAATA,IAAaA,EAAO,OACrD,MAALwlB,EAAW,OAAO,YACdxlB,EAAKE,mBACR,cAAeqvE,EAAaC,WAAYhqD,IAAG7W,IAAGmB,IAAGD,UACjD,aAAcgC,EAAI,QAAQggB,UAAU,EAAG,OACvC,aAAgBrM,IAAG7W,IAAGmB,IAAGD,IAAG0K,IAAGwC,IAAGkR,IAAGwhD,IAAK59D,EAAIoQ,KAAK+hD,EAAO,OAAQsL,KAAMz9D,EAAIoQ,KAAK+hD,EAAO,yBAEvFxwC,KACKpiB,EAAI,EAAGA,EAAIpR,EAAKX,OAAQ+R,WACvBpR,EAAKwJ,OAAO4H,QACf,IACiB,IAAhBpR,EAAKX,OAAcm0B,EAAMhO,EACxBgO,EAAIhO,EAAIA,YAEV,IACiB,IAAhBxlB,EAAKX,OAAcm0B,EAAM7kB,EACxB6kB,EAAI7kB,EAAIA,YAEV,IACiB,IAAhB3O,EAAKX,OAAcm0B,EAAM1jB,EACxB0jB,EAAI1jB,EAAIA,YAEV,IACiB,IAAhB9P,EAAKX,OAAcm0B,EAAM3jB,EACxB2jB,EAAI3jB,EAAIA,YAEV,IACiB,IAAhB7P,EAAKX,OAAcm0B,EAAMjZ,EACxBiZ,EAAIjZ,EAAIA,YAEV,IACiB,IAAhBva,EAAKX,OAAcm0B,EAAMzW,EACxByW,EAAIzW,EAAIA,YAEV,IACiB,IAAhB/c,EAAKX,OAAcm0B,EAAMvF,EACxBuF,EAAIvF,EAAIA,SAITjuB,EAAKX,OAAkCm0B,EAAzB3hB,EAAIoQ,KAAK+hD,EAAO,WAG3B,MAAXuK,GAAmBA,IAAYvK,GACvB,MAARhkE,IAAcA,EAAO,QAErBwuE,GAAU,KACD,MAATx9D,SACO,MAALwU,MACE,QACM,GAEH,MAAL7W,MACE,QACM,GAEH,MAALmB,MACE,QACM,GAEH,MAALD,MACE,QACM,GAEH,MAAL0K,MACE,QACM,GAEH,MAALwC,MACE,QACM,GAEH,MAALkR,MACE,QACM,WAEDkhD,EAAiBltD,KAAK+hD,EAAOuK,GAAWvK,WAG7ChkE,EAAKE,mBACR,WACA,UACGszB,EAAM+7C,EAAaG,UAAW1+D,IAAUA,EAAMs+D,MAAQt+D,EAAMy+D,MAASz+D,GAAS,UAChFiR,KAAK+hD,EAAO,QAAUx+C,EAAGgO,EAAIhO,EAAG7W,EAAG6kB,EAAI7kB,EAAGmB,EAAG0jB,EAAI1jB,EAAGD,EAAY,SAAT7P,EAAkBwzB,EAAI3jB,EAAS,MAALA,EAAYA,EAAI,KAAO0+D,oBAGxGv9D,IAAwB,MAAdA,EAAMs+D,MAA6B,MAAbt+D,EAAMy+D,mBACpCxtD,KAAK+hD,EAAO,OAAQhzD,EAAMs+D,MAAQt+D,EAAMy+D,KAAO,WAAYlB,OAG3DoB,KACFC,GAAM,EAAOC,GAAM,OACP3tE,IAAZ8O,EAAMwU,GAAoBxlB,EAAKyM,SAAS,OAAMzM,GAAQ,UAC1CkC,IAAZ8O,EAAMrC,GAAoB3O,EAAKyM,SAAS,OAAMzM,GAAQ,UAC1CkC,IAAZ8O,EAAMlB,GAAoB9P,EAAKyM,SAAS,OAAMzM,GAAQ,UAC1CkC,IAAZ8O,EAAMnB,GAAoB7P,EAAKyM,SAAS,OAAMzM,GAAQ,UAC1CkC,IAAZ8O,EAAMuJ,GAAoBva,EAAKyM,SAAS,OAAMzM,GAAQ,UAC1CkC,IAAZ8O,EAAM+L,GAAoB/c,EAAKyM,SAAS,OAAMzM,GAAQ,UAC1CkC,IAAZ8O,EAAMid,GAAoBjuB,EAAKyM,SAAS,OAAMzM,GAAQ,SACrD,IAAIoR,EAAI,EAAGA,EAAIpR,EAAKX,OAAQ+R,WACvBpR,EAAKwJ,OAAO4H,QACf,OACCy+D,EAAK,YACH,IACDrqD,EAAKxU,GAASA,EAAMwU,GAAe,EAAVxU,EAAMwU,GAAWxU,GAAiB,EAARA,GAAc,EAClE2+D,EAAKnqD,EAAI,EAAGmqD,EAAKnqD,EAAI,EAChBmqD,EAAKnqD,EAAI,MAAKmqD,EAAKnqD,EAAI,KAC5BA,IAAMmqD,EAAKnqD,MACNmqD,EAALnqD,KACQ,aAGT,OACCqqD,EAAK,YACH,IACDlhE,EAAKqC,GAASA,EAAMrC,GAAe,EAAVqC,EAAMrC,GAAWqC,GAAiB,EAARA,GAAc,EAClE2+D,EAAKhhE,EAAI,EAAGghE,EAAKhhE,EAAI,EAChBghE,EAAKhhE,EAAI,MAAKghE,EAAKhhE,EAAI,KAC5BA,IAAMghE,EAAKhhE,MACNghE,EAALhhE,KACQ,aAGT,OACCkhE,EAAK,YACH,IACD//D,EAAKkB,GAASA,EAAMlB,GAAe,EAAVkB,EAAMlB,GAAWkB,GAAiB,EAARA,GAAc,EAClE2+D,EAAK7/D,EAAI,EAAG6/D,EAAK7/D,EAAI,EAChB6/D,EAAK7/D,EAAI,MAAK6/D,EAAK7/D,EAAI,KAC5BA,IAAM6/D,EAAK7/D,MACN6/D,EAAL7/D,KACQ,aAGT,MACED,EAAImB,GAAoB,MAAXA,EAAMnB,EAAsB,EAAVmB,EAAMnB,EAAiB,MAATmB,EAAwB,EAARA,EAAY,IAC1E2+D,EAAK9/D,EAAI,EAAG8/D,EAAK9/D,EAAI,EAChB8/D,EAAK9/D,EAAI,MAAK8/D,EAAK9/D,EAAI,KAC5BA,IAAM8/D,EAAK9/D,MACN8/D,EAAL9/D,KACQ,aAGT,OACC+/D,EAAK,YACH,IACDr1D,EAAKvJ,GAASA,EAAMuJ,GAAe,EAAVvJ,EAAMuJ,GAAWvJ,GAAiB,EAARA,GAAc,EAClE2+D,EAAKp1D,EAAI,EAAGo1D,EAAKp1D,EAAI,EAChBo1D,EAAKp1D,EAAI,MAAKo1D,EAAKp1D,EAAI,KAC5BA,IAAMo1D,EAAKp1D,MACNo1D,EAALp1D,KACQ,aAGT,OACCq1D,EAAK,YACH,IACD7yD,EAAI/L,GAAoB,MAAXA,EAAM+L,EAAsB,EAAV/L,EAAM+L,EAAiB,MAAT/L,EAAwB,EAARA,EAAY,IAC1E2+D,EAAK5yD,EAAI,EAAG4yD,EAAK5yD,EAAI,EAChB4yD,EAAK5yD,EAAI,MAAK4yD,EAAK5yD,EAAI,KAC5BA,IAAM4yD,EAAK5yD,MACN4yD,EAAL5yD,KACQ,aAGT,OACC6yD,EAAK,YACH,IACD3hD,EAAIjd,GAAoB,MAAXA,EAAMid,EAAsB,EAAVjd,EAAMid,EAAiB,MAATjd,EAAwB,EAARA,EAAY,IAC1E2+D,EAAK1hD,EAAI,EAAG0hD,EAAK1hD,EAAI,EAChB0hD,EAAK1hD,EAAI,MAAK0hD,EAAK1hD,EAAI,KAC5BA,IAAM0hD,EAAK1hD,MACN0hD,EAAL1hD,KACQ,MAKZugD,EAAS,IACPoB,EAAK,GACHpqD,GAAK,IACL7W,GAAK,IACLmB,GAAK,MACH0jB,EAAM+7C,EAAaO,UAAWtqD,IAAG7W,IAAGmB,QAC7B0jB,EAAXjZ,IAAWiZ,EAARzW,IAAQyW,EAALvF,OACH,GAAI4hD,EAAK,GACVt1D,GAAK,IACA,MAALwC,EAAYA,EAAI,MACX,MAALkR,EAAYA,EAAI,QACduF,EAAM+7C,EAAaQ,UAAWx1D,IAAGwC,IAAGkR,QAC7BuF,EAAXhO,IAAWgO,EAAR7kB,IAAQ6kB,EAAL1jB,IAED,MAALD,EAAYA,EAAI,MACHoS,KAAK+hD,EAAOuK,GAAWvK,UAkB1Cx+C,SAAG7W,SAAGmB,SAAGD,SAAG0K,SAAGwC,SAAGkR,SAAGwgD,OAEvBhpC,QAAO,EAAMu+B,uBAfAjmB,GACW,mBAAbA,GAAyB0wB,EAAa5lE,KAAKk1C,oBAEvCA,MACS,mBAAbA,UACP3sC,SACIA,EAAIq9D,EAAahiE,SAASsxC,MACnBp1C,OAAOyI,EAAG,yBAIV,QAWbwL,IACe,MAAbA,EAAK0yD,OACH,OAAQ1yD,GACS,MAAZA,EAAK6yD,OAED,MAAV7yD,EAAK/M,EAAY,IAAM,IAAM,MACpB,MAAV+M,EAAK/M,GACAy/D,KAAM1yD,EAAK6yD,IAAMF,EAAaS,SAASpzD,EAAK/M,IAC7C+M,GAEa,MAAVA,EAAK4I,GAAuB,MAAV5I,EAAKjO,GAAuB,MAAViO,EAAK9M,IAC9C,OAAmB,MAAV8M,EAAK/M,EAAY,IAAM,IAAK+M,GACtB,MAAVA,EAAKrC,GAAuB,MAAVqC,EAAKG,GAAuB,MAAVH,EAAKqR,KAC9C,OAAmB,MAAVrR,EAAK/M,EAAY,IAAM,IAAK+M,sCA0BlC6yD,MACG,KAARA,GAAsB,SAARA,EAAgB,OAASjqD,EAAG,KAAM7W,EAAG,KAAMmB,EAAG,KAAMD,EAAG,UAErE2V,EAAI,KAAM7W,EAAI,KAAMmB,EAAI,KAAMD,EAAI,aACnB,OAFbpP,KAAKwvE,YAAYR,IAEfpwE,SAAcowE,GAAO,MACzBA,EAAIpwE,OAAS,KACXowE,EAAI59C,UAAU,EAAG,KACjB49C,EAAI59C,UAAU,EAAG,KACjB49C,EAAI59C,UAAU,EAAG,KACjB49C,EAAI59C,UAAU,EAAG49C,EAAIpwE,UAErBowE,EAAIpwE,OAAS,MACXowE,EAAI59C,UAAU,EAAG49C,EAAIpwE,UACnBowE,EAAI59C,UAAU,EAAG,IAErB49C,EAAIpwE,OAAS,MACXowE,EAAI59C,UAAU,EAAG49C,EAAIpwE,UACnBowE,EAAI59C,UAAU,EAAG,IAErB49C,EAAIpwE,OAAS,IAAGyQ,EAAI2/D,EAAI59C,UAAU,EAAG49C,EAAIpwE,aAG1CoB,KAAKyvE,SAAS1qD,GAAI7W,EAAGlO,KAAKyvE,SAASvhE,GAAImB,EAAGrP,KAAKyvE,SAASpgE,GAAID,EAAGpP,KAAKyvE,SAASrgE,0BAOvE4/D,YAELA,EAAIvvE,cAAc8S,QAAQ,aAAc,KACtC3T,OAAS,IAAGowE,EAAMA,EAAI59C,UAAU,EAAG,IACpC49C,sBAMEU,UACF1vE,KAAKuvE,SAASG,EAAK3qD,GAAK/kB,KAAKuvE,SAASG,EAAKxhE,GAAKlO,KAAKuvE,SAASG,EAAKrgE,GAAKrP,KAAKuvE,SAASG,EAAKtgE,sBAM1FugE,OACJn6D,GAAgB,EAANm6D,GAASr3C,SAAS,WACV,IAAlB9iB,EAAO5W,SAAc4W,EAAU,IAAMA,GAClCA,EAAO/V,iCAMNuvE,UACDv0D,SAASu0D,EAAK,uBAYbG,OACFpqD,EAAIoqD,EAAIpqD,EAAI,IAAK7W,EAAIihE,EAAIjhE,EAAI,IAAKmB,EAAI8/D,EAAI9/D,EAAI,IAAK+/D,GAAQt1D,EAAG,EAAGwC,EAAG,EAAGkR,EAAG,GAC5ErT,EAAM,EAAGE,EAAM,EACf0K,GAAK7W,GAAK6W,GAAK1V,KACX0V,IACA7W,EAAImB,EAAIA,EAAInB,GACTA,GAAKmB,GAAKnB,GAAK6W,KAClB7W,IACA6W,EAAI1V,EAAIA,EAAI0V,MAEZ1V,IACAnB,EAAI6W,EAAIA,EAAI7W,KAEhBsf,EAAInT,IACJiC,EAAIjC,GAAOA,EAAMF,GAAOE,EAAM,MAC9B29B,gBACCo3B,EAAI9yD,KAECjC,EAAMF,EACCi1D,EAAIt1D,EAAfiL,IAAM1K,GAAcnM,EAAImB,GAAK2oC,EACxB9pC,IAAMmM,EAAa,GAAKhL,EAAI0V,GAAKizB,EAC7B,GAAKjzB,EAAI7W,GAAK8pC,IACvBl+B,EAAIW,SAAiB,GAAR20D,EAAIt1D,GACjBs1D,EAAIt1D,EAAI,IAAGs1D,EAAIt1D,GAAK,MAPds1D,EAAIt1D,EAAI,IAShBwC,EAAa,IAAR8yD,EAAI9yD,EAAW,IACpBkR,EAAa,IAAR4hD,EAAI5hD,EAAW,EACjB4hD,qBAMCA,OACFD,GAAOpqD,EAAG,EAAG7W,EAAG,EAAGmB,EAAG,EAAGD,EAAG,KAC7B0K,EAAWs1D,EAAXt1D,EAAGwC,EAAQ8yD,EAAR9yD,EAAGkR,EAAK4hD,EAAL5hD,KACD,IAANlR,EACW6yD,EAAIpqD,EAAIoqD,EAAIjhE,EAAIihE,EAAI9/D,EAAvB,IAANme,EAAiC,EACH,IAAJA,EAAU,IAAO,MAC1C,CACK,MAAN1T,IAAWA,EAAI,OAIbnJ,EAAQ,MAHT,IAIHlB,EAAIqK,EAAInJ,EACRgI,MAHM,MAGG,MAJH,MAKNyjD,EAAI5uC,GAAK,EAAKlR,EAAI7M,GAClBkE,EAAI6Z,GAAK,EAAKlR,GAAK,EAAI7M,WACjBkB,QACH,IACCoU,EAAIyI,IACJtf,EAAIyF,IACJtE,EAAIsJ,aAEL,IACCoM,EAAIq3C,IACJluD,EAAIsf,IACJne,EAAIsJ,aAEL,IACCoM,EAAIpM,IACJzK,EAAIsf,IACJne,EAAIsE,aAEL,IACCoR,EAAIpM,IACJzK,EAAIkuD,IACJ/sD,EAAIme,aAEL,IACCzI,EAAIpR,IACJzF,EAAIyK,IACJtJ,EAAIme,aAEL,IACCzI,EAAIyI,IACJtf,EAAIyK,IACJtJ,EAAI+sD,IAGNr3C,EAAa,IAARoqD,EAAIpqD,EAAW,IACpB7W,EAAa,IAARihE,EAAIjhE,EAAW,IACpBmB,EAAa,IAAR8/D,EAAI9/D,EAAW,SAEnB8/D,WAIuB7jE,EAAE68D,QAA/ByH,IAAAA,MAAOC,IAAAA,KAAMf,IAAAA,sBAclB1+D,GAAG+3D,QAAU,SAAUpF,OACjB+M,EAAap/D,iBACZ1Q,KAAKqc,KAAK,eACTknD,EAAQvjE,KAAM+vE,EAAWzkE,EAAE05B,QAAO,KAAU15B,EAAE8E,GAAG+3D,QAAQjyC,SAAU6sC,GAC1B,UAA3Cz3D,EAAEi4D,GAAOyM,IAAI,GAAG1kD,SAAS7rB,kBACzBulC,QAAO,EAAM+qC,wBAEE,cACD,QACLzkE,EAAEi4D,MAGU,KAAnBj4D,EAAEi4D,GAAOnyD,SACF66B,MAAMq8B,OAAS,IAAIsH,GAAQZ,IAAK,SAChC/iC,MAAMgkC,QAAU,IAAIL,GAAQZ,IAAK,QACjCF,EAAaU,YAAYlkE,EAAEi4D,GAAOnyD,WAClC66B,MAAMq8B,OAAS,IAAIsH,GAAQZ,IAAK1jE,EAAEi4D,GAAOnyD,MAAOhC,EAAG2gE,EAAS9jC,MAAMq8B,OAAOl3D,IAAI,SAC7E66B,MAAMgkC,QAAU,IAAIL,GAAQZ,IAAK1jE,EAAEi4D,GAAOnyD,MAAOhC,EAAG2gE,EAAS9jC,MAAMq8B,OAAOl3D,IAAI,SAGvF2+D,EAASpxE,OAAOuxE,aAChB3M,GAAOrqC,MAAM,wOAENv6B,OAAOwxE,YAAa,MAEzBC,EAAgBr9D,WAAWpH,UAAU0kE,WAAW59D,MAAM,QAAQ,IAAM,GAAKzT,SAASuuC,KAAK+iC,iBAOpFC,EAAcC,OACdlI,EAAUr8B,EAAVq8B,OAEL0G,EAAM1G,EAAOl3D,IAAI,OACfq/D,SAAQC,kBACHzkC,MAAM0kC,KAAOH,EACdA,OACH,kBACQ,aACHhvD,KAAK+hD,EAAOqN,EAAa,iBACrBpvD,KAAK+hD,EAAOsN,EAAY,KACzBrvD,KAAK+hD,EAAOsN,EAAY,OACvBrvD,KAAK+hD,EAAOuN,EAAY,OACzBtvD,KAAK+hD,EAAOuN,EAAY,OAC3BtvD,KAAK+hD,EAAOwN,EAAa,iBACrBvvD,KAAK+hD,EAAOyN,EAAY,KACzBxvD,KAAK+hD,EAAOyN,EAAY,OACvBxvD,KAAK+hD,EAAO0N,EAAY,OACzBzvD,KAAK+hD,EAAO0N,EAAY,OACvBzvD,KAAK+hD,EAAO2N,EAAY,OACzB1vD,KAAK+hD,EAAO2N,EAAY,OACvB1vD,KAAK+hD,EAAO4N,EAAY,OACzB3vD,KAAK+hD,EAAO4N,EAAY,OACvB3vD,KAAK+hD,EAAO6N,EAAY,OACzB5vD,KAAK+hD,EAAO6N,EAAY,MAChC,KACMC,MAAM,OAASn8C,KAAM,EAAGF,KAAM,IAAKG,KAAM,EAAGF,KAAM,SAClDo8C,MAAM,UAAYl8C,KAAM,EAAGF,KAAM,MAChB,MAAtBqzC,EAAOl3D,IAAI,QAAiB,QACvBA,IAAI,MAAQzP,EAAG2mE,EAAOl3D,IAAI,KAAMxP,EAAG,IAAM0mE,EAAOl3D,IAAI,MAAQkgE,MAC5DlgE,IAAI,IAAK,IAAMk3D,EAAOl3D,IAAI,KAAMmgE,cAEtC,kBACQ,aACH/vD,KAAK+hD,EAAOqN,EAAa,iBACrBpvD,KAAK+hD,EAAOsN,GAAa,OACzBrvD,KAAK+hD,EAAOuN,GAAa,OACzBtvD,KAAK+hD,EAAOyN,GAAa,OACzBxvD,KAAK+hD,EAAO0N,GAAa,OACzBzvD,KAAK+hD,EAAO6N,EAAY,OACzB5vD,KAAK+hD,EAAO6N,EAAY,MAChC,KACMC,MAAM,OAASn8C,KAAM,EAAGF,KAAM,IAAKG,KAAM,EAAGF,KAAM,SAClDo8C,MAAM,UAAYl8C,KAAM,EAAGF,KAAM,MAChB,MAAtBqzC,EAAOl3D,IAAI,QAAiB,QACvBA,IAAI,MAAQzP,EAAG2mE,EAAOl3D,IAAI,KAAMxP,EAAG,IAAM0mE,EAAOl3D,IAAI,MAAQkgE,MAC5DlgE,IAAI,IAAK,IAAMk3D,EAAOl3D,IAAI,KAAMmgE,cAEtC,kBACQ,aACH/vD,KAAK+hD,EAAOqN,EAAa,YACrBpvD,KAAK+hD,EAAOsN,GAAa,OACzBrvD,KAAK+hD,EAAOuN,EAAY,OAC5BtvD,KAAK+hD,EAAOwN,EAAa/B,KACrBxtD,KAAK+hD,EAAOyN,GAAa,OACzBxvD,KAAK+hD,EAAO0N,EAAY,OACzBzvD,KAAK+hD,EAAO0N,EAAY,OACvBzvD,KAAK+hD,EAAO6N,EAAY,OACzB5vD,KAAK+hD,EAAO6N,EAAY,MAChC,KACMC,MAAM,OAASn8C,KAAM,EAAGF,KAAM,IAAKG,KAAM,EAAGF,KAAM,SAClDo8C,MAAM,UAAYl8C,KAAM,EAAGF,KAAM,MAChB,MAAtBqzC,EAAOl3D,IAAI,QAAiB,QACvBA,IAAI,MAAQzP,EAAG2mE,EAAOl3D,IAAI,KAAMxP,EAAG,IAAM0mE,EAAOl3D,IAAI,MAAQkgE,MAC5DlgE,IAAI,IAAK,IAAMk3D,EAAOl3D,IAAI,KAAMmgE,cAEtC,UACO,QACA,MACDF,MAAM,OAASn8C,KAAM,EAAGF,KAAM,IAAKG,KAAM,EAAGF,KAAM,SAClDo8C,MAAM,UAAYl8C,KAAM,EAAGF,KAAM,MAChB,MAAtBqzC,EAAOl3D,IAAI,QAAiB,QACvBA,IAAI,MAAQzP,EAAG2mE,EAAOl3D,IAAI,KAAMxP,EAAG,IAAM0mE,EAAOl3D,IAAI,MAAQkgE,MAC5DlgE,IAAI,IAAK,IAAMk3D,EAAOl3D,IAAI,KAAMmgE,cAEtC,UACO,QACA,OACDF,MAAM,OAASn8C,KAAM,EAAGF,KAAM,IAAKG,KAAM,EAAGF,KAAM,SAClDo8C,MAAM,UAAYl8C,KAAM,EAAGF,KAAM,MAChB,MAAtBqzC,EAAOl3D,IAAI,QAAiB,QACvBA,IAAI,MAAQzP,EAAG2mE,EAAOl3D,IAAI,KAAMxP,EAAG,IAAM0mE,EAAOl3D,IAAI,MAAQkgE,MAC5DlgE,IAAI,IAAK,IAAMk3D,EAAOl3D,IAAI,KAAMmgE,cAEtC,UACO,QACA,OACDF,MAAM,OAASn8C,KAAM,EAAGF,KAAM,IAAKG,KAAM,EAAGF,KAAM,SAClDo8C,MAAM,UAAYl8C,KAAM,EAAGF,KAAM,MAChB,MAAtBqzC,EAAOl3D,IAAI,QAAiB,QACvBA,IAAI,MAAQzP,EAAG2mE,EAAOl3D,IAAI,KAAMxP,EAAG,IAAM0mE,EAAOl3D,IAAI,MAAQkgE,MAC5DlgE,IAAI,IAAK,IAAMk3D,EAAOl3D,IAAI,KAAMmgE,cAEtC,kBACQ,aACH/vD,KAAK+hD,EAAOqN,EAAa,iBACrBpvD,KAAK+hD,EAAOsN,GAAa,OACzBrvD,KAAK+hD,EAAOuN,GAAa,OACzBtvD,KAAK+hD,EAAOyN,EAAY,OACxBxvD,KAAK+hD,EAAO0N,EAAY,OACzBzvD,KAAK+hD,EAAO0N,EAAY,OACvBzvD,KAAK+hD,EAAO6N,EAAY,KACzB5vD,KAAK+hD,EAAO6N,EAAY,MAChC,KACMC,MAAM,OAASn8C,KAAM,EAAGF,KAAM,IAAKG,KAAM,EAAGF,KAAM,SAClDo8C,MAAM,UAAYl8C,KAAM,EAAGF,KAAM,MAChB,MAAtBqzC,EAAOl3D,IAAI,QAAiB,QACvBA,IAAI,MAAQzP,EAAG2mE,EAAOl3D,IAAI,KAAMxP,EAAG,IAAM0mE,EAAOl3D,IAAI,MAAQkgE,MAC5DlgE,IAAI,IAAK,IAAMk3D,EAAOl3D,IAAI,KAAMmgE,wBAGnC,IAAI3rE,MAAM,uBAEV4qE,OACH,cAEA,QACA,QACA,eACQ,aACAhvD,KAAK+hD,EAAOsN,EAAY,OACxBrvD,KAAK+hD,EAAOyN,EAAY,OACvBxvD,KAAK+hD,EAAO2N,EAAY,OACzB1vD,KAAK+hD,EAAO2N,EAAY,OACvB1vD,KAAK+hD,EAAO4N,EAAY,OACzB3vD,KAAK+hD,EAAO4N,EAAY,MAChC,aAEA,QACA,QACA,eACQ,aACH3vD,KAAK+hD,EAAOqN,EAAa,iBACzBpvD,KAAK+hD,EAAOwN,EAAa,iBACtBvvD,KAAK+hD,EAAOyN,EAAY,OACxBxvD,KAAK+hD,EAAOsN,EAAY,OACvBrvD,KAAK+hD,EAAOsN,EAAYJ,KACxBjvD,KAAK+hD,EAAOuN,EAAYL,EAAS,OACjCjvD,KAAK+hD,EAAOyN,EAAYN,EAAS,OACjClvD,KAAK+hD,EAAO0N,EAAYP,EAAS,OACjClvD,KAAK+hD,EAAO2N,EAAYR,KACxBlvD,KAAK+hD,EAAO4N,EAAYT,EAAS,OACjClvD,KAAK+hD,EAAO6N,EAAY,OACzB5vD,KAAK+hD,EAAO6N,EAAY,MAChC,GAGqB,MAAtB9I,EAAOl3D,IAAI,WACIoQ,KAAK+hD,EAAO+E,YAGxBkJ,EAAoB11D,EAAIgyD,IAChB,MAAXA,GAAoBA,IAAYyD,IAAYzD,IAAYwD,aA+D5Bx1D,EAAIgyD,MAChCA,IAAYwD,SACNvB,EAAS9jC,MAAM0kC,UAClB,QACGc,EAAK31D,EAAG1K,IAAI,QACTA,IAAI,MAAQzP,EAAS,MAAN8vE,EAAaA,EAAGn1D,EAAI,IAAK1a,EAAG,KAAa,MAAN6vE,EAAaA,EAAGjkD,EAAI,MAAQsgD,aAEpF,QACA,QACG4D,EAAK51D,EAAG1K,IAAI,QACTA,IAAI,MAAQzP,EAAI+vE,GAAMA,EAAG53D,GAAM,EAAGlY,EAAG,KAAa,MAAN8vE,EAAaA,EAAGlkD,EAAI,MAAQsgD,aAE9E,QACG6D,EAAK71D,EAAG1K,IAAI,QACTA,IAAI,MAAQzP,EAAIgwE,GAAMA,EAAG73D,GAAM,EAAGlY,EAAG,KAAa,MAAN+vE,EAAaA,EAAGr1D,EAAI,MAAQwxD,aAE9E,QACG7gB,EAAKnxC,EAAG1K,IAAI,QACTA,IAAI,MAAQzP,EAAIsrD,GAAMA,EAAG59C,GAAM,EAAGzN,EAAG,KAAQqrD,GAAMA,EAAG/+C,GAAM,IAAM4/D,aAExE,QACG7zD,EAAK6B,EAAG1K,IAAI,QACTA,IAAI,MAAQzP,EAAIsY,GAAMA,EAAG5K,GAAM,EAAGzN,EAAG,KAAQqY,GAAMA,EAAG8K,GAAM,IAAM+oD,aAExE,QACG8D,EAAK91D,EAAG1K,IAAI,QACTA,IAAI,MAAQzP,EAAIiwE,GAAMA,EAAG7sD,GAAM,EAAGnjB,EAAG,KAAQgwE,GAAMA,EAAG1jE,GAAM,IAAM4/D,MAI3EA,IAAYyD,UACNxB,EAAS9jC,MAAM0kC,UAClB,OACMv/D,IAAI,IAAK,KAAO0K,EAAG1K,IAAI,MAAQ,GAAI08D,aAEzC,QACGxxD,EAAIR,EAAG1K,IAAI,QACRA,IAAI,IAAK,KAAY,MAALkL,EAAYA,EAAI,KAAMwxD,aAE5C,QACGtgD,EAAI1R,EAAG1K,IAAI,QACRA,IAAI,IAAK,KAAY,MAALoc,EAAYA,EAAI,KAAMsgD,aAE5C,OACM18D,IAAI,IAAK,KAAO0K,EAAG1K,IAAI,MAAQ,GAAI08D,aAEzC,OACM18D,IAAI,IAAK,KAAO0K,EAAG1K,IAAI,MAAQ,GAAI08D,aAEzC,OACM18D,IAAI,IAAK,KAAO0K,EAAG1K,IAAI,MAAQ,GAAI08D,aAEzC,QACG1+D,EAAI0M,EAAG1K,IAAI,QACRA,IAAI,IAAK,KAAY,MAALhC,EAAYA,EAAI,KAAM0+D,KArH4CtsD,KAAK+hD,EAAOznD,EAAIgyD,cACpG,qBAyHWhyD,WAEd2b,EAAM3b,EAAG1K,IAAI,UACL2pC,KAAM82B,gBAAkBp6C,GAAO,IAAMA,EAAIu3C,KAAQ,kBACtDxtD,KAAK+hD,EAAOuO,GAAgBr6C,GAAOxtB,KAAK+jD,UAAmB,IAARv2B,EAAIroB,EAAW,IAAK,IAAO,GACvF,MAAOI,OA7HOgS,KAAK+hD,EAAOznD,YA+HHA,UACjBi0D,EAAS9jC,MAAM0kC,UAClB,MACGnvD,KAAK+hD,EAAOqN,EAAa,IAAIhB,GAAQ91D,EAAGgC,EAAG1K,IAAI,MAAQ,EAAGkL,EAAG,IAAKkR,EAAG,MAAOpc,IAAI,kBAEnF,QACA,QACGkL,EAAIR,EAAG1K,IAAI,OACRoQ,KAAK+hD,EAAOuN,EAAY,KAAY,MAALx0D,EAAYA,EAAI,gBAErD,QACGkR,EAAI1R,EAAG1K,IAAI,OACRoQ,KAAK+hD,EAAOsN,EAAiB,MAALrjD,EAAYA,EAAI,eAE9C,MACMhM,KAAK+hD,EAAOuN,EAAY7mE,KAAK+jD,WAAWlyC,EAAG1K,IAAI,MAAQ,GAAK,IAAM,IAAK,cAE7E,MACMoQ,KAAK+hD,EAAOuN,EAAY7mE,KAAK+jD,WAAWlyC,EAAG1K,IAAI,MAAQ,GAAK,IAAM,IAAK,cAE7E,MACMoQ,KAAK+hD,EAAOuN,EAAY7mE,KAAK+jD,WAAWlyC,EAAG1K,IAAI,MAAQ,GAAK,IAAM,UAGvEhC,EAAI0M,EAAG1K,IAAI,OACRoQ,KAAK+hD,EAAOwO,EAAY9nE,KAAK+jD,UAA8B,KAAlB,KAAO5+C,GAAK,IAAa,IAAK,KAvJ7DoS,KAAK+hD,EAAOznD,YAyJNA,UACjBi0D,EAAS9jC,MAAM0kC,UAClB,QACGvhE,EAAI0M,EAAG1K,IAAI,OACRoQ,KAAK+hD,EAAOyO,EAAY/nE,KAAK+jD,UAA8B,KAAlB,KAAO5+C,GAAK,IAAa,IAAK,cAE7E,QACG6iE,EAAMn2D,EAAG1K,IAAI,OACjB8gE,EAAiB,IAAItC,GAAQ91D,EAAIm4D,GAAOA,EAAIn4D,GAAM,EAAGwC,EAAG,IAAKkR,EAAU,MAAPykD,EAAcA,EAAIzkD,EAAI,QAClFhM,KAAK+hD,EAAOwN,EAAamB,EAAe9gE,IAAI,UACzCoQ,KAAK+hD,EAAO0N,EAAY,KAAc,MAAPgB,EAAcA,EAAIzkD,EAAI,QACrDhM,KAAK+hD,EAAOyO,EAAY/nE,KAAK+jD,UAA2C,KAA/B,KAAQikB,GAAOA,EAAI7iE,GAAM,IAAa,IAAK,cAE1F,QACG+iE,EAAMr2D,EAAG1K,IAAI,OACjBghE,EAAa,IAAIxC,GAAQ91D,EAAIq4D,GAAOA,EAAIr4D,GAAM,EAAGwC,EAAU,MAAP61D,EAAcA,EAAI71D,EAAI,IAAKkR,EAAG,QAC9EhM,KAAK+hD,EAAOwN,EAAaqB,EAAWhhE,IAAI,UACrCoQ,KAAK+hD,EAAOyO,EAAY/nE,KAAK+jD,UAA2C,KAA/B,KAAQmkB,GAAOA,EAAI/iE,GAAM,IAAa,IAAK,cAE1F,QACA,QACA,QACGsgE,EAAO5zD,EAAG1K,IAAI,QAChBihE,EAAS,EAAGC,EAAS,EACG,MAAxBvC,EAAS9jC,MAAM0kC,QACPjB,GAAQA,EAAKrgE,GAAM,IACnBqgE,GAAQA,EAAKxhE,GAAM,GACI,MAAxB6hE,EAAS9jC,MAAM0kC,QACdjB,GAAQA,EAAKrgE,GAAM,IACnBqgE,GAAQA,EAAK3qD,GAAM,GACI,MAAxBgrD,EAAS9jC,MAAM0kC,SACdjB,GAAQA,EAAK3qD,GAAM,IACnB2qD,GAAQA,EAAKxhE,GAAM,OAEzBqkE,EAASD,EAASD,EAASA,EAASC,IACjC9wD,KAAK+hD,EAAO0N,EAAYoB,EAASC,EAASroE,KAAK+jD,WAAYqkB,EAASC,IAAW,IAAMA,GAAW,IAAK,GAAK,KAC1G9wD,KAAK+hD,EAAO2N,EAAYoB,EAASD,EAASpoE,KAAK+jD,WAAYskB,EAASD,IAAW,IAAMA,GAAW,IAAK,GAAK,KAC1G7wD,KAAK+hD,EAAO4N,EAAYlnE,KAAK+jD,UAAWukB,EAAS,IAAO,IAAK,MAC7D/wD,KAAK+hD,EAAOyO,EAAY/nE,KAAK+jD,UAA6C,KAAjC,KAAQ0hB,GAAQA,EAAKtgE,GAAM,IAAa,IAAK,cAE5F,QACGA,EAAI0M,EAAG1K,IAAI,OACXoQ,KAAK+hD,EAAOwN,EAAaj1D,EAAG1K,IAAI,QAAU,YACvCoQ,KAAK+hD,EAAOyO,EAAiB,MAAL5iE,EAAY,EAAI,OACxCoS,KAAK+hD,EAAO6N,EAAiB,MAALhiE,EAAY,IAAM,KApMlCoS,KAAK+hD,EAAOznD,IAC5B,YAGI02D,EAAiB12D,EAAIgyD,OACrBxF,EAAUr8B,EAAVq8B,UACHwF,IAAYwD,GAA4B,MAAhBhJ,EAAOl3D,WAC7BqhE,EAAK32D,EAAG1K,IAAI,cACV2+D,EAAS9jC,MAAM0kC,UAClB,MACIv/D,IAAI,MAAQkL,EAAGm2D,EAAG9wE,EAAG6rB,EAAG,IAAMilD,EAAG7wE,GAAKksE,aAE1C,QACA,MACI18D,IAAI,MAAQ0I,EAAG24D,EAAG9wE,EAAG6rB,EAAG,IAAMilD,EAAG7wE,GAAKksE,aAE1C,MACI18D,IAAI,MAAQ0I,EAAG24D,EAAG9wE,EAAG2a,EAAG,IAAMm2D,EAAG7wE,GAAKksE,aAE1C,MACI18D,IAAI,MAAQlD,EAAG,IAAMukE,EAAG7wE,EAAGyN,EAAGojE,EAAG9wE,GAAKmsE,aAE1C,MACI18D,IAAI,MAAQ2T,EAAG,IAAM0tD,EAAG7wE,EAAGyN,EAAGojE,EAAG9wE,GAAKmsE,aAE1C,MACI18D,IAAI,MAAQ2T,EAAG0tD,EAAG9wE,EAAGuM,EAAG,IAAMukE,EAAG7wE,GAAKksE,cAKxC4E,EAAsB52D,EAAIgyD,OAC1BxF,EAAUr8B,EAAVq8B,UACHwF,IAAYyD,IAA4B,MAAhBjJ,EAAOl3D,aAC3B2+D,EAAS9jC,MAAM0kC,UAClB,MACIv/D,IAAI,KAAO0I,EAAG,IAAMgC,EAAG1K,IAAI,MAAQ08D,aAEvC,MACI18D,IAAI,KAAOkL,EAAG,IAAMR,EAAG1K,IAAI,MAAQ08D,aAEvC,MACI18D,IAAI,KAAOoc,EAAG,IAAM1R,EAAG1K,IAAI,MAAQ08D,aAEvC,MACI18D,IAAI,KAAO2T,EAAG,IAAMjJ,EAAG1K,IAAI,MAAQ08D,aAEvC,MACI18D,IAAI,KAAOlD,EAAG,IAAM4N,EAAG1K,IAAI,MAAQ08D,aAEvC,MACI18D,IAAI,KAAO/B,EAAG,IAAMyM,EAAG1K,IAAI,MAAQ08D,aAEvC,MACI18D,IAAI,IAAK,IAAM0K,EAAG1K,IAAI,KAAM08D,aAmJ9B6E,EAAO1zC,EAAI3vB,KACfyrC,KAAK82B,gBAAkBviE,GAAkB,IAAbA,EAAE1Q,QAAgB,IAAM0Q,GAAM,yBAEtDsjE,EAAQt8C,EAAK2B,GAChBm4C,IAAkBn4C,EAAIjsB,SAAS,iBAAmBisB,EAAIjsB,SAAS,aAAeisB,EAAIjsB,SAAS,gBACzFqE,KAAK,SAAU4nB,KACf8iB,KAAM83B,gBAAiB,OAAQ3/C,OAAQ,2DAA8D+E,EAAM,8BAC1G3B,EAAIykB,KAAM83B,gBAAiB,QAAW56C,EAAM,gBAE5C66C,EAAWx8C,EAAK10B,KACnBm5C,KAAMtF,IAAK7zC,EAAI,gBAEZmxE,EAAU/hE,EAAKg1C,QAClBjL,KAAMi4B,WAAYhtB,EAAQ,EAAI,UAAY,WAC1CA,EAAQ,GAAKA,EAAQ,OACnBoqB,EAAe,KACXn4C,EAAMjnB,EAAIX,KAAK,UACV,MAAP4nB,IACFA,EAAIjsB,SAAS,iBAAmBisB,EAAIjsB,SAAS,aAAeisB,EAAIjsB,SAAS,eAErE+uC,KAAM7nB,OAAQ,2DAA8D+E,EAAM,4EAAiF+tB,EAAQ,MAC1Kh1C,EAAI+pC,KAAM1hB,QAASpvB,KAAK+jD,UAAUhI,EAAQ,IAAK,UACjDh1C,EAAI+pC,KAAM1hB,QAASpvB,KAAK+jD,UAAUhI,EAAQ,IAAK,UACjD,GAAc,IAAVA,GAAyB,MAAVA,KACpBoqB,EAAe,KACXn4C,EAAMjnB,EAAIX,KAAK,UACV,MAAP4nB,IACFA,EAAIjsB,SAAS,iBAAmBisB,EAAIjsB,SAAS,aAAeisB,EAAIjsB,SAAS,eAErE+uC,KAAM7nB,OAAQ,2DAA8D+E,EAAM,6BACjFjnB,EAAI+pC,KAAM1hB,QAAS,UACrBroB,EAAI+pC,KAAM1hB,QAAS,cAIrB45C,MACD3K,OAAOl3D,IAAI,OAAQ66B,EAAMgkC,QAAQ7+D,IAAI,kBAMpC8hE,EAAc1jE,KACnBxP,MAAMuiD,QAAQ,eAAevhC,KAAK,uBAAyBxR,EAAE3Q,OAAO0R,MAAQ,MAAM0wD,WAAW,aAClFz/C,KAAK+hD,EAAO/zD,EAAE3Q,OAAO0R,gBAE3B4iE,MACK3xD,KAAK+hD,YAEVI,MACKniD,KAAK+hD,KACR5kE,OAAOuxE,YAAcnxB,EAAKv9B,KAAK+hD,GACd,mBAAnBD,IAAiCA,GAAe9hD,KAAK+hD,EAAOt3B,EAAMq8B,OAAQ8K,aAE1E1P,kBAdDuM,QAAQ7+D,IAAI,OAAQ66B,EAAMq8B,OAAOl3D,IAAI,WAe/BoQ,KAAK+hD,KACR5kE,OAAOuxE,YAAcnxB,EAAKv9B,KAAK+hD,GACd,mBAAnB8P,IAAiCA,GAAe7xD,KAAK+hD,EAAOt3B,EAAMq8B,OAAQgL,aAE1EC,MACF/xD,KAAK+hD,YAEHiQ,EAAqB13D,EAAIgyD,OAC1BkB,EAAMlzD,EAAG1K,IAAI,UACJ2pC,KAAM82B,gBAAkB7C,GAAO,IAAMA,GAAQ,kBACnDxtD,KAAK+hD,EAAOkQ,GAAgBxpE,KAAK+jD,UAAgC,KAApBlyC,EAAG1K,IAAI,MAAQ,GAAY,IAAK,aAE/EsiE,EAAwB53D,EAAIgyD,OAC7BkB,EAAMlzD,EAAG1K,IAAI,OACbuiE,EAAK73D,EAAG1K,IAAI,SACR2pC,KAAM82B,gBAAkB7C,GAAO,IAAMA,GAAQ,kBAC9CxtD,KAAK+hD,EAAOqQ,GAAW3pE,KAAK+jD,UAAyC,KAA7B,KAAQ2lB,GAAMA,EAAGvkE,GAAM,IAAa,IAAK,IACtF2gE,EAASpxE,OAAOk1E,aAAe9D,EAASpxE,OAAOm1E,oBACxCn1E,OAAOyvB,MAAM2sB,qBACFi0B,GAAO,IAAMA,GAAQ,oBAC1B,MAAN2E,GAAcA,EAAGnmD,EAAI,GAAK,UAAY,qBAI1CumD,EAAkBvkE,KAGTiL,SAAS0wB,EAAU4P,IAAI,WACvBtgC,SAAS0wB,EAAU4P,IAAI,UAC1BvrC,EAAEykC,QACFzkC,EAAE0kC,QAEbl1C,UAAUiI,KAAK,YAAa+sE,GAAmB/sE,KAAK,UAAWgtE,KAC/Dl1E,0BAEKi1E,EAAmBxkE,YAChBurC,KAAMnF,KAAMs+B,GAAiBC,EAAa3kE,EAAEykC,OAAS,KAAMwB,IAAK2+B,GAAiBC,EAAa7kE,EAAE0kC,OAAS,OAC/G67B,EAASpxE,OAAOuxE,aAAe5kE,EAAEgpE,QAAQC,UAAUppC,EAAU9xB,OAAO0hC,KAAMnF,KAAMzK,EAAU4P,IAAI,QAAStF,IAAKtK,EAAU4P,IAAI,WAC5HyrB,oBACAznE,kBACK,WAEAk1E,EAAiBzkE,YACtBxQ,UAAU47C,OAAO,YAAao5B,GAAmBp5B,OAAO,UAAWq5B,KACnEzN,oBACAznE,kBACK,WAEAy1E,EAAkBhlE,YACvBzQ,mBACAynE,oBACI8B,OAAOl3D,IAAI,OAAQ9F,EAAEtL,MAAMqQ,KAAK,UAAY,KAAMb,EAAE3Q,SACnD,WAEAwjB,aAEEoyD,OACF1E,EAASpxE,OAAOuxE,aAAc5kE,EAAEgpE,QAAQC,cACvCG,EAAQvpC,EAAUnqB,KAAK,iBACnBqT,OAAO,eACPhb,OAAO0hC,KAAK5sC,MAAOumE,EAAMvmE,QAASJ,OAAQo9B,EAAUp9B,SAAUsrB,QAAS,EAAGgxC,SAAU,WAAYz0B,KAAMzK,EAAU4P,IAAI,QAAStF,IAAKtK,EAAU4P,IAAI,mBALtJk1B,QAAQ7+D,IAAI,OAAQ66B,EAAMq8B,OAAOl3D,IAAI,SAOvC2+D,EAASpxE,OAAOuxE,eAChBlxE,SAASuuC,MAAMta,SAAS,yBAAyB8nB,KAAK45B,OAAQ,OACtD55B,KAAK45B,OAAQ,MAEjB5E,EAASpxE,OAAOypE,QAAQhqE,UAC3B,SACOsuE,OAAOqD,EAASpxE,OAAOypE,QAAQC,MAAMhmD,KAAMoyD,aAElD,UACOG,UAAU7E,EAASpxE,OAAOypE,QAAQC,MAAMhmD,KAAMoyD,aAErD,iBAEOpyD,KAAK0tD,EAASpxE,OAAOypE,QAAQC,MAAMhmD,KAAMoyD,aAI9C11B,aACE81B,IACH9E,EAASpxE,OAAOuxE,YAAY/kC,EAAU4P,KAAM45B,OAAQ,KACnD5E,EAASpxE,OAAOuxE,aAAc5kE,EAAEgpE,QAAQC,YACnCl7D,OAAO1L,gBAEXoiE,EAASpxE,OAAOypE,QAAQhqE,UAC3B,SACO4uE,QAAQ+C,EAASpxE,OAAOypE,QAAQC,MAAMtpB,KAAM81B,aAEnD,UACOC,QAAQ/E,EAASpxE,OAAOypE,QAAQC,MAAMtpB,KAAM81B,aAEnD,iBAEO91B,KAAKgxB,EAASpxE,OAAOypE,QAAQC,MAAMtpB,KAAM81B,aAI9CE,QACD9I,EAAM8D,EAASpxE,OACnBq2E,EAAQ/I,EAAIiE,WAAa5kE,EAAEi4D,GAAO9iD,OAAOO,KAAK,oBAAsB,QAC1DirD,EAAIiE,WAAa5kE,EAAE,UAAYA,EAAEi4D,IACnCM,SAAS,qBACfoI,EAAIiE,YAAY/kC,EAAU4T,SACpBixB,IAAI,GAAGiF,cAAgB,SAAU/Y,MAAqD,UAAxCA,EAAMr9D,OAAOysB,SAAS7rB,cAA2B,OAAO,OAG1Gg4B,EAAMwU,EAAMq8B,OAAOl3D,IAAI,OACzB66D,EAAIiJ,eAAiB,EAAGjJ,EAAIiJ,eAAiB,EACxCjJ,EAAIiJ,eAAiB,IAAGjJ,EAAIiJ,eAAiB,OAChDC,EAAc,kEAAoElJ,EAAIiE,WAAa,oDAAsD,IAAM,0CAA4CjE,EAAIxyC,OAAS27C,EAAa7nE,KAAKksB,OAAS,mIAAqI0jB,EAAO+mB,WAAa/mB,EAAOm0B,SAASrD,MAAM9O,KAAO,0QAA4QhiB,EAAO+mB,WAAa/mB,EAAOo0B,SAAStD,MAAM9O,KAAO,+DAAiEiW,EAAa7nE,KAAK8nE,SAAW,oCAAsCD,EAAaE,SAASC,OAAOF,SAAW,+CAAiDD,EAAaE,SAASC,OAAOC,aAAe,wBAA0BJ,EAAa7nE,KAAKioE,aAAe,8EAAgFJ,EAAa7nE,KAAKojD,GAAK,YAAcykB,EAAaE,SAASG,QAAQ9kB,GAAK,iDAAmDykB,EAAa7nE,KAAKmjD,OAAS,YAAc0kB,EAAaE,SAASG,QAAQ/kB,OAAS,mGAAqG0kB,EAAaE,SAASI,IAAIC,MAAQ,mCAA6D,MAAxB5F,EAAS9jC,MAAM0kC,KAAe,qBAAuB,IAAM,8EAAuF,MAAPl5C,EAAcA,EAAI3d,EAAI,IAAM,YAAcs7D,EAAaE,SAASI,IAAIE,QAAU,kFAAoFR,EAAaE,SAASO,WAAWF,MAAQ,mCAA6D,MAAxB5F,EAAS9jC,MAAM0kC,KAAe,qBAAuB,IAAM,8EAAuF,MAAPl5C,EAAcA,EAAInb,EAAI,IAAM,YAAc84D,EAAaE,SAASO,WAAWD,QAAU,yEAA2ER,EAAaE,SAAS/kE,MAAMolE,MAAQ,mCAA6D,MAAxB5F,EAAS9jC,MAAM0kC,KAAe,qBAAuB,IAAM,wFAAiG,MAAPl5C,EAAcA,EAAIjK,EAAI,IAAM,YAAc4nD,EAAaE,SAAS/kE,MAAMqlE,QAAU,iFAAmFR,EAAaE,SAASQ,IAAIH,MAAQ,mCAA6D,MAAxB5F,EAAS9jC,MAAM0kC,KAAe,qBAAuB,IAAM,8EAAuF,MAAPl5C,EAAcA,EAAI1S,EAAI,IAAM,YAAcqwD,EAAaE,SAASQ,IAAIF,QAAU,kEAAoER,EAAaE,SAASS,MAAMJ,MAAQ,mCAA6D,MAAxB5F,EAAS9jC,MAAM0kC,KAAe,qBAAuB,IAAM,8EAAuF,MAAPl5C,EAAcA,EAAIvpB,EAAI,IAAM,YAAcknE,EAAaE,SAASS,MAAMH,QAAU,iEAAmER,EAAaE,SAASU,KAAKL,MAAQ,mCAA6D,MAAxB5F,EAAS9jC,MAAM0kC,KAAe,qBAAuB,IAAM,8EAAuF,MAAPl5C,EAAcA,EAAIpoB,EAAI,IAAM,YAAc+lE,EAAaE,SAASU,KAAKJ,QAAU,qDAAuD3J,EAAI1D,aAAe,iBAAmB6M,EAAaE,SAAStvB,MAAM2vB,MAAQ,mCAA6D,MAAxB5F,EAAS9jC,MAAM0kC,KAAe,qBAAuB,IAAM,eAAiB,UAAY,0BAA4B1E,EAAI1D,aAAe,kCAAoC,EAAI0D,EAAIiJ,gBAAkB,aAAsB,MAAPz9C,EAAcxtB,KAAK+jD,UAAmB,IAARv2B,EAAIroB,EAAW,IAAK68D,EAAIiJ,gBAAkB,IAAM,YAAcE,EAAaE,SAAStvB,MAAM4vB,QAAU,aAAe,UAAY,wEAA0ER,EAAaE,SAAStG,IAAI4G,QAAU,4DAAqE,MAAPn+C,EAAcA,EAAIu3C,IAAM,IAAM,eAAiB/C,EAAI1D,aAAe,yDAAkE,MAAP9wC,EAAcA,EAAIo3C,KAAKz9C,UAAU,GAAK,IAAM,YAAcgkD,EAAaE,SAAStG,IAAIhpB,MAAQ,WAAa,UAAY,wBAC57IimB,EAAIiE,cACIpM,KAAKqR,GACV7pE,EAAEtM,SAASuuC,MAAMta,SAAS,yBAAyBr0B,SAGpDI,SAASuuC,MAAMta,SAAS,8BAA8BiG,MAAMiS,KAF5DnsC,SAASuuC,MAAMgW,QAAQpY,KAIjBuI,UACR,aACI10C,SAASuuC,MAAMta,SAAS,yBAAyB8nB,KAAK45B,OAAQ,OACtD55B,KAAK45B,OAAQ,SAEjB55B,UAGe,SAAnBkxB,EAAI5B,SAAS1oE,EACRqzE,EAAM5/C,SAASwgB,KAAO,KAA0B,WAAnBq2B,EAAI5B,SAASzoE,EAAiB,GAAK,GAAM,KACpD,WAAnBqqE,EAAI5B,SAAS1oE,EACVqzE,EAAM5/C,SAASwgB,KAAO,IAAO,KACX,UAAnBq2B,EAAI5B,SAAS1oE,EACVqzE,EAAM5/C,SAASwgB,KAAO,IAAyB,WAAnBq2B,EAAI5B,SAASzoE,EAAiB,GAAK,GAAM,KACnD,iBAAnBqqE,EAAI5B,SAAS1oE,GACT2J,EAAEtM,UAAUmP,SAAW,GAAK,IAAO,KACpC6mE,EAAM5/C,SAASwgB,KAAOn7B,SAASwxD,EAAI5B,SAAS1oE,GAAM,cACrD,eACc,QAAnBsqE,EAAI5B,SAASzoE,EACbozE,EAAM5/C,SAASqgB,IAAM,IAAO,KACV,WAAnBw2B,EAAI5B,SAASzoE,EACVozE,EAAM5/C,SAASqgB,IAAM,IAAO,KACV,WAAnBw2B,EAAI5B,SAASzoE,EACVozE,EAAM5/C,SAASqgB,IAAM,GAAM,KAC3Bu/B,EAAM5/C,SAASqgB,IAAMh7B,SAASwxD,EAAI5B,SAASzoE,GAAM,WAGlD0J,EAAEi4D,IACJO,KAAKqR,OAGXc,EAAQ9qC,EAAUnqB,KAAK,iBACfi1D,EAAMj1D,KAAK,mBACXi1D,EAAMj1D,KAAK,qBACnBk1D,EAAUtF,EAAY5vD,KAAK,QAC3Bm1D,EAAUpF,EAAY/vD,KAAK,UACpBk1D,EAAQhjD,OAAO,iBACfgjD,EAAQhjD,OAAO,iBACfgjD,EAAQhjD,OAAO,iBACfijD,EAAQjjD,OAAO,iBACfijD,EAAQjjD,OAAO,iBACfijD,EAAQjjD,OAAO,iBACfijD,EAAQjjD,OAAO,iBACfijD,EAAQjjD,OAAO,iBACfijD,EAAQjjD,OAAO,kBAEjB,IAAIi6C,EAAOyD,cAGTzzB,EAAOm0B,SAASnjE,aACfgvC,EAAOm0B,SAASvjE,qBAGjBovC,EAAO+mB,WAAa/mB,EAAOm0B,SAASrD,MAAM9O,WAC1ChiB,EAAOm0B,SAASrD,MAAM9/D,aACrBgvC,EAAOm0B,SAASrD,MAAMlgE,WAI3B9G,KAAKurE,OACH,IAAIrF,EAAO4D,cAGT5zB,EAAOo0B,SAASpjE,aACfgvC,EAAOo0B,SAASxjE,qBAGjBovC,EAAO+mB,WAAa/mB,EAAOo0B,SAAStD,MAAM9O,WAC1ChiB,EAAOo0B,SAAStD,MAAM9/D,aACrBgvC,EAAOo0B,SAAStD,MAAMlgE,WAI3B9G,KAAKyrE,MACA,aA/zCO0D,EAAQnqC,EAAOoqC,EAAWnB,OAC7C3R,EAAQvjE,KACRs2E,EAASF,EAAOp1D,KAAK,0BAElBu1D,EAAS/mE,MACO,KAAnBA,EAAE3Q,OAAO0R,OAAgBf,EAAE3Q,SAAWmwE,EAAIgB,IAAI,KAAqB,MAAbqG,GAAqB7mE,EAAE3Q,SAAWw3E,EAAUrG,IAAI,KAAoB,MAAbqG,OAC5GG,EAAYhnE,GAAI,OAAOA,SACpBA,EAAE3Q,aACLi3E,EAAI9F,IAAI,UACHxgE,EAAEs8D,cACL,YACC16D,IAAIqlE,EAAgBj1D,KAAK+hD,EAA0B,GAAlBuS,EAAI1kE,OAAS,GAAQ,EAAG,QACvDA,IAAI,IAAK0kE,EAAI1kE,MAAO5B,EAAE3Q,SACrB,OACJ,YACCuS,IAAIqlE,EAAgBj1D,KAAK+hD,GAAQuS,EAAI1kE,OAAS,GAAK,EAAG,EAAG,QACvDA,IAAI,IAAK0kE,EAAI1kE,MAAO5B,EAAE3Q,SACrB,aAGNk3E,EAAM/F,IAAI,UACLxgE,EAAEs8D,cACL,YACG16D,IAAIqlE,EAAgBj1D,KAAK+hD,EAA4B,GAApBwS,EAAM3kE,OAAS,GAAQ,EAAG,QAC3DA,IAAI,IAAK2kE,EAAM3kE,MAAO5B,EAAE3Q,SACvB,OACJ,YACGuS,IAAIqlE,EAAgBj1D,KAAK+hD,GAAQwS,EAAM3kE,OAAS,GAAK,EAAG,EAAG,QAC3DA,IAAI,IAAK2kE,EAAM3kE,MAAO5B,EAAE3Q,SACvB,aAGNm3E,EAAKhG,IAAI,UACJxgE,EAAEs8D,cACL,YACE16D,IAAIqlE,EAAgBj1D,KAAK+hD,EAA2B,GAAnByS,EAAK5kE,OAAS,GAAQ,EAAG,QACzDA,IAAI,IAAK4kE,EAAK5kE,MAAO5B,EAAE3Q,SACtB,OACJ,YACEuS,IAAIqlE,EAAgBj1D,KAAK+hD,GAAQyS,EAAK5kE,OAAS,GAAK,EAAG,EAAG,QACzDA,IAAI,IAAK4kE,EAAK5kE,MAAO5B,EAAE3Q,SACtB,aAGNmnD,GAASA,EAAMgqB,IAAI,UACdxgE,EAAEs8D,cACL,YACG16D,IAAIqlE,EAAgBj1D,KAAK+hD,EAAOxwD,WAAWizC,EAAM50C,OAAS,EAAG,EAAG,QAChEA,IAAI,IAAKnH,KAAK+jD,UAAyB,IAAdhI,EAAM50C,MAAe,IAAK8jE,GAAiB1lE,EAAE3Q,SACrE,OACJ,YACGuS,IAAIqlE,EAAgBj1D,KAAK+hD,EAAOxwD,WAAWizC,EAAM50C,OAAS,EAAG,EAAG,QAChEA,IAAI,IAAKnH,KAAK+jD,UAAyB,IAAdhI,EAAM50C,MAAe,IAAK8jE,GAAiB1lE,EAAE3Q,SACrE,aAGN62E,EAAI1F,IAAI,UACHxgE,EAAEs8D,cACL,YACC16D,IAAIqlE,EAAgBj1D,KAAK+hD,EAA0B,GAAlBmS,EAAItkE,OAAS,GAAQ,EAAG,QACvDA,IAAI,IAAKskE,EAAItkE,MAAO5B,EAAE3Q,SACrB,OACJ,YACCuS,IAAIqlE,EAAgBj1D,KAAK+hD,GAAQmS,EAAItkE,OAAS,GAAK,EAAG,EAAG,QACvDA,IAAI,IAAKskE,EAAItkE,MAAO5B,EAAE3Q,SACrB,aAGNg3E,EAAW7F,IAAI,UACVxgE,EAAEs8D,cACL,YACQ16D,IAAIqlE,EAAgBj1D,KAAK+hD,EAAiC,GAAzBsS,EAAWzkE,OAAS,GAAQ,EAAG,QACrEA,IAAI,IAAKykE,EAAWzkE,MAAO5B,EAAE3Q,SAC5B,OACJ,YACQuS,IAAIqlE,EAAgBj1D,KAAK+hD,GAAQsS,EAAWzkE,OAAS,GAAK,EAAG,EAAG,QACrEA,IAAI,IAAKykE,EAAWzkE,MAAO5B,EAAE3Q,SAC5B,aAGN0R,EAAMy/D,IAAI,UACLxgE,EAAEs8D,cACL,YACG16D,IAAIqlE,EAAgBj1D,KAAK+hD,EAA4B,GAApBhzD,EAAMa,OAAS,GAAQ,EAAG,QAC3DA,IAAI,IAAKb,EAAMa,MAAO5B,EAAE3Q,SACvB,OACJ,YACGuS,IAAIqlE,EAAgBj1D,KAAK+hD,GAAQhzD,EAAMa,OAAS,GAAK,EAAG,EAAG,QAC3DA,IAAI,IAAKb,EAAMa,MAAO5B,EAAE3Q,SACvB,cAMJ63E,EAAOlnE,MACS,KAAnBA,EAAE3Q,OAAO0R,OAAgBf,EAAE3Q,SAAWmwE,EAAIgB,IAAI,KACjC,MAAbqG,GAAqB7mE,EAAE3Q,SAAWw3E,EAAUrG,IAAI,KACrC,MAAbqG,OACGG,EAAYhnE,GAAI,OAAOA,SACpBA,EAAE3Q,aACLi3E,EAAI9F,IAAI,KACP5+D,IAAIqlE,EAAgBj1D,KAAK+hD,EAAOuS,EAAI1kE,MAAO,EAAG,QAC5CA,IAAI,IAAK0kE,EAAI1kE,MAAO5B,EAAE3Q,mBAEzBk3E,EAAM/F,IAAI,KACP5+D,IAAIqlE,EAAgBj1D,KAAK+hD,EAAOwS,EAAM3kE,MAAO,EAAG,QAChDA,IAAI,IAAK2kE,EAAM3kE,MAAO5B,EAAE3Q,mBAE3Bm3E,EAAKhG,IAAI,KACP5+D,IAAIqlE,EAAgBj1D,KAAK+hD,EAAOyS,EAAK5kE,MAAO,EAAG,QAC9CA,IAAI,IAAK4kE,EAAK5kE,MAAO5B,EAAE3Q,mBAE1BmnD,GAASA,EAAMgqB,IAAI,KAChB5+D,IAAIqlE,EAAgBj1D,KAAK+hD,EAAOvd,EAAM50C,MAAO,EAAG,QAChDA,IAAI,IAAKnH,KAAK+jD,UAAyB,IAAdhI,EAAM50C,MAAe,IAAK8jE,GAAiB1lE,EAAE3Q,mBAEzE62E,EAAI1F,IAAI,KACP5+D,IAAIqlE,EAAgBj1D,KAAK+hD,EAAOmS,EAAItkE,MAAO,EAAG,QAC5CA,IAAI,IAAKskE,EAAItkE,MAAO5B,EAAE3Q,mBAEzBg3E,EAAW7F,IAAI,KACP5+D,IAAIqlE,EAAgBj1D,KAAK+hD,EAAOsS,EAAWzkE,MAAO,EAAG,QAC1DA,IAAI,IAAKykE,EAAWzkE,MAAO5B,EAAE3Q,mBAEhC0R,EAAMy/D,IAAI,KACP5+D,IAAIqlE,EAAgBj1D,KAAK+hD,EAAOhzD,EAAMa,MAAO,EAAG,QAChDA,IAAI,IAAKb,EAAMa,MAAO5B,EAAE3Q,mBAE3BmwE,EAAIgB,IAAI,KACP5+D,IAAI49D,EAAI59D,MAAMmB,QAAQ,gBAAiB,IAAI9S,cAAc2xB,UAAU,EAAG,OAC7DilD,EAAUjlE,IAAI49D,EAAI59D,SACzBA,IAAI,MAAqB,KAAd49D,EAAI59D,MAAe49D,EAAI59D,MAAQ,KAAM5B,EAAE3Q,mBAErDw3E,GAAaA,EAAUrG,IAAI,KACpB5+D,IAAIilE,EAAUjlE,MAAMmB,QAAQ,gBAAiB,IAAI9S,cAAc2xB,UAAU,EAAG,MAClFhgB,IAAIilE,EAAUjlE,SACZA,IAAI,MAA2B,KAApBilE,EAAUjlE,MAAeilE,EAAUjlE,MAAQ,KAAM5B,EAAE3Q,mBAEjEgwE,GAAQA,EAAKmB,IAAI,KACf5+D,IAAIy9D,EAAKz9D,MAAMmB,QAAQ,gBAAiB,IAAI9S,cAAc2xB,UAAU,EAAG,MACtEhgB,IAAI,IAAmB,MAAdy9D,EAAKz9D,MAAgBqJ,SAASo0D,EAAKz9D,MAAO,IAAM,KAAM5B,EAAE3Q,mBAKlEo8C,EAAMzrC,MACM,MAAfy8B,EAAM76B,aACA5B,EAAE3Q,aACLi3E,EAAI9F,IAAI,KAAQ5+D,IAAI66B,EAAM76B,IAAI,MAAO,WACrC2kE,EAAM/F,IAAI,KAAU5+D,IAAI66B,EAAM76B,IAAI,MAAO,WACzC4kE,EAAKhG,IAAI,KAAS5+D,IAAI66B,EAAM76B,IAAI,MAAO,WACvC40C,GAASA,EAAMgqB,IAAI,KAAU5+D,IAAInH,KAAK+jD,UAA4B,IAAjB/hB,EAAM76B,IAAI,KAAc,IAAK8jE,IAAkB,WAChGQ,EAAI1F,IAAI,KAAQ5+D,IAAI66B,EAAM76B,IAAI,MAAO,WACrCykE,EAAW7F,IAAI,KAAe5+D,IAAI66B,EAAM76B,IAAI,MAAO,WACnDb,EAAMy/D,IAAI,KAAU5+D,IAAI66B,EAAM76B,IAAI,MAAO,WACzC49D,EAAIgB,IAAI,QACRqG,GAAaA,EAAUrG,IAAI,KAC1B5+D,IAAI66B,EAAM76B,IAAI,WACLilE,EAAUjlE,IAAI66B,EAAM76B,IAAI,mBAElCy9D,GAAQA,EAAKmB,IAAI,KAAS5+D,IAAI66B,EAAM76B,IAAI,QAAQggB,UAAU,cAI1DolD,EAAahnE,UACZA,EAAEs8D,cACL,OACA,QACA,QACA,QACA,UACI,MACJ,IAAIp9C,iBACJ,IAAIA,gBACHlf,EAAEgoD,QAAS,OAAO,SAEjB,WAGAif,EAAiBlmE,EAAO4J,EAAKE,SACtB,KAAV9J,GAAgBxI,MAAMwI,GAAe4J,EACrC5J,EAAQ8J,EAAYA,EACpB9J,EAAQ4J,EAAYA,EACjB5J,WAEAomE,EAAc76D,EAAIgyD,OACnBr2C,EAAM3b,EAAG1K,IAAI,OACf08D,IAAYgI,EAAI9F,IAAI,IAAI8F,EAAI1kE,IAAW,MAAPqmB,EAAcA,EAAI1S,EAAI,IACtD+oD,IAAYiI,EAAM/F,IAAI,IAAI+F,EAAM3kE,IAAW,MAAPqmB,EAAcA,EAAIvpB,EAAI,IAC1D4/D,IAAYkI,EAAKhG,IAAI,IAAIgG,EAAK5kE,IAAW,MAAPqmB,EAAcA,EAAIpoB,EAAI,IACxD22C,GAAS8nB,IAAY9nB,EAAMgqB,IAAI,IAAIhqB,EAAM50C,IAAW,MAAPqmB,EAAcxtB,KAAK+jD,UAAmB,IAARv2B,EAAIroB,EAAW,IAAK8lE,GAAkB,IACjHpH,IAAY4H,EAAI1F,IAAI,IAAI0F,EAAItkE,IAAW,MAAPqmB,EAAcA,EAAI3d,EAAI,IACtDg0D,IAAY+H,EAAW7F,IAAI,IAAI6F,EAAWzkE,IAAW,MAAPqmB,EAAcA,EAAInb,EAAI,IACpEwxD,IAAYv9D,EAAMy/D,IAAI,IAAIz/D,EAAMa,IAAW,MAAPqmB,EAAcA,EAAIjK,EAAI,IAC1DsgD,IAAYkB,EAAIgB,IAAI,KAAQqG,GAAavI,IAAYuI,EAAUrG,IAAI,KAAQqG,IAAYrH,EAAI59D,IAAW,MAAPqmB,EAAcA,EAAIu3C,IAAM,IACvHqH,GAAavI,IAAYuI,EAAUrG,IAAI,IAAMlC,IAAYkB,EAAIgB,IAAI,IAAIqG,EAAUjlE,IAAW,MAAPqmB,EAAcA,EAAIu3C,IAAM,IAC3GH,GAAQf,IAAYe,EAAKmB,IAAI,IAAInB,EAAKz9D,IAAW,MAAPqmB,EAAcA,EAAIo3C,KAAKz9C,UAAU,GAAK,QAkBpF0kD,EAAMQ,EAAO1J,GAAG,GAChBmJ,EAAQO,EAAO1J,GAAG,GAClBoJ,EAAOM,EAAO1J,GAAG,GACjB5mB,EAAQswB,EAAO13E,OAAS,EAAI03E,EAAO1J,GAAG,GAAK,KAC3C8I,EAAMY,EAAO1J,GAAG,GAChBiJ,EAAaS,EAAO1J,GAAG,GACvBr8D,EAAQ+lE,EAAO1J,GAAG,GAClBoC,EAAMsH,EAAO1J,GAAG0J,EAAO13E,OAAS,EAAI,EAAI,GACxCiwE,EAAOyH,EAAO13E,OAAS,EAAI03E,EAAO1J,GAAG,GAAK,OAC1C5nC,QAAO,EAAMu+B,wBAvBT1f,IAAIkyB,GAAOlyB,IAAImyB,GAAMnyB,IAAImC,GAAOnC,IAAI6xB,GAAK7xB,IAAIgyB,GAAYhyB,IAAItzC,GAAOszC,IAAImrB,GAAKnrB,IAAIwyB,GAAWxyB,IAAIgrB,GAAMj0B,OAAO,QAAS87B,GAAO97B,OAAO,OAAQK,KAC5I4I,IAAIkyB,GAAOlyB,IAAImyB,GAAMnyB,IAAImC,GAAOnC,IAAI6xB,GAAK7xB,IAAIgyB,GAAYhyB,IAAItzC,GAAOqqC,OAAO,UAAW27B,KACpF37B,OAAO+7B,KACP,OACE,OACD,OACC,OACF,OACO,OACL,OACF,OACC,UAgBL9yB,IAAIkyB,GAAOlyB,IAAImyB,GAAMnyB,IAAImC,GAAOnC,IAAI6xB,GAAK7xB,IAAIgyB,GAAYhyB,IAAItzC,GAAOszC,IAAImrB,GAAKnrB,IAAIwyB,GAAWxyB,IAAIgrB,GAAM5nE,KAAK,QAASyvE,GAAOzvE,KAAK,OAAQg0C,KACxI4I,IAAIkyB,GAAOlyB,IAAImyB,GAAMnyB,IAAImC,GAAOnC,IAAI6xB,GAAK7xB,IAAIgyB,GAAYhyB,IAAItzC,GAAOtJ,KAAK,UAAWsvE,KAClFtvE,KAAK0vE,GAylCO,CACZV,EACAhqC,EAAMq8B,OACN2D,EAAIiE,YAAcjE,EAAI4H,YAAc5H,EAAI79C,MAAQ,KAAM69C,EAAIiJ,oBAEtDlG,EAAa,MAAPv3C,EAAcA,EAAIu3C,IAAM,KAClC4H,EAAUX,EAAMj1D,KAAK,YACrB4yB,EAASqiC,EAAMj1D,KAAK,iBACN41D,EAAQ51D,KAAK,iBAAiB+5B,KAAM82B,gBAAkB7C,GAAO,IAAMA,GAAQ,mBAC1E4H,EAAQ51D,KAAK,kBAAkB+5B,KAAM82B,gBAAkB7C,GAAO,IAAMA,GAAQ,gBAAiB/nE,KAAK,QAASksE,KACnH3xD,KAAK+hD,EAAOkQ,GAAgBxpE,KAAK+jD,UAAmC,IAAzB/hB,EAAMgkC,QAAQ7+D,IAAI,MAAc,IAAK,MAC9EwiC,EAAO5yB,KAAK,aAAa/Z,KAAK,QAASy8D,MACnC9vB,EAAO5yB,KAAK,iBAAiB/Z,KAAK,QAAS08D,MACnD/vB,EAAO5yB,KAAK,0BACR,aACFQ,KAAK+hD,EAAOsN,EAAY1zB,EAAO+mB,WAAa,cAC5C1iD,KAAK+hD,EAAOuN,EAAY3zB,EAAO+mB,WAAa,cAC5C1iD,KAAK+hD,EAAOwO,EAAY50B,EAAO+mB,WAAa,qBAC5C1iD,KAAK+hD,EAAOyN,EAAY7zB,EAAO+mB,WAAa,cAC5C1iD,KAAK+hD,EAAO0N,EAAY9zB,EAAO+mB,WAAa,cAC5C1iD,KAAK+hD,EAAO2N,EAAY/zB,EAAO+mB,WAAa,cAC5C1iD,KAAK+hD,EAAO4N,EAAYh0B,EAAO+mB,WAAa,cAC5C1iD,KAAK+hD,EAAOyO,EAAY70B,EAAO+mB,WAAa,qBAC5C1iD,KAAK+hD,EAAO6N,EAAYj0B,EAAO+mB,WAAa,kBAC5C1iD,KAAK+hD,EAAOqT,EAAQ51D,KAAK,aAAcm8B,EAAO+mB,WAAa,wBACjE,KACGljD,KAAK,kBAAkB/Z,KAAK,QAASisE,GAEvCjnC,EAAM4qC,WAAa5qC,EAAM4qC,UAAUj4E,OAAS,EAAG,SAC7CklE,EAAO,GACFnzD,EAAI,EAAGA,EAAIs7B,EAAM4qC,UAAUj4E,OAAQ+R,IAAK,CAEgB,WAA3Dm6B,EAASmB,EAAM4qC,UAAUlmE,IAAK2nB,WAAW74B,gBAA4BwsC,EAAM4qC,UAAUlmE,GAAK,IAAIi/D,GAAQZ,IAAK/iC,EAAM4qC,UAAUlmE,UACzHq1C,EAAQ/Z,EAAM4qC,UAAUlmE,GAAGS,IAAI,KACjCy9D,EAAO5iC,EAAM4qC,UAAUlmE,GAAGS,IAAI,SAC7B66D,EAAI1D,cAAgBsG,IAAMA,EAAOA,EAAKz9C,UAAU,EAAG,GAAK,UACvD0lD,EAAW7qC,EAAM4qC,UAAUlmE,GAAGS,IAAI,OACnCy9D,IAAMA,EAAO,eACV,4BAA+BA,GAAQ,YAAcA,EAAO,KAAQ,QAAU,6BAAgCiI,GAAY,IAAMA,GAAa,IAAM,KAAOA,EAAW,GAAK,wBAA0B35B,EAAO+mB,WAAa,iBAAmB+H,EAAI1D,cAAgBviB,GAASA,EAAQ,IAAM,YAAc/7C,KAAK+jD,UAAUhI,EAAQ,IAAK,GAAK,yBAA2B/7C,KAAK+jD,UAAUhI,EAAQ,KAAM,GAAK,IAAM,IAAM,oBAEjZxkC,KAAK+hD,EAAOlS,GAAMlU,EAAO+mB,WAAa,sBACxCJ,KAAKA,MACL9iD,KAAK,eAAeuV,MAAMi+C,KAEpBhzD,KAAK+hD,EAAOwM,EAAS9jC,MAAM0kC,QAClCrI,OAAOrhE,KAAKuqE,GACM,mBAAjBuF,IAA+B9qC,EAAMq8B,OAAOrhE,KAAK8vE,MAClD9G,QAAQhpE,KAAKusE,GAEfvH,EAAIiE,cACApP,KAAOkU,EAAMzyB,QAAQ,kBACfghB,EAAMzC,KAAK9/C,KAAK,gBAAgB+5B,KAAM82B,gBAAkB7C,GAAO,IAAMA,GAAQ,mBAC7EzL,EAAMzC,KAAK9/C,KAAK,kBACrBQ,KAAK+hD,EAAOqQ,GAAWz2B,EAAO+mB,WAAa,qBACzC1iD,KAAK+hD,EAAOqQ,GAAW3pE,KAAK+jD,UAA+C,KAAnC,KAAc,MAAPv2B,EAAcA,EAAIroB,EAAI,IAAa,IAAK,OACpFm0D,EAAMzC,KAAK9/C,KAAK,gBAAgB+5B,qBACzB,QAAWoC,EAAO+mB,WAAa/mB,EAAOi5B,OAAOjX,KAAO,OACpEl4D,KAAK,QAASssE,GACbtH,EAAI4H,aAAe5H,EAAI6H,oBACrB1lD,MAAM2sB,qBACUi0B,GAAO,IAAMA,GAAQ,oBACzB,MAAPv3C,GAAeA,EAAIjK,EAAI,GAAK,UAAY,eAGzCyoD,EAAMj1D,KAAK,eAAe/Z,KAAK,YAAa8sE,KAChDzL,OAAOrhE,KAAKysE,IACbrxD,EAAKb,KAAK+hD,OA6CZpmB,EAAwB4yB,EAAxB5yB,OAAQi4B,EAAgBrF,EAAhBqF,aACTnpC,UACgE,WAA5DnB,EAAQilC,EAAS9jC,MAAMq8B,QAAQhwC,WAAW74B,cAC9C,IAAImwE,GAAOf,MAAOkB,EAASpxE,OAAO4pE,cAAgBwH,EAAS9jC,MAAMq8B,OAC/DyH,EAAS9jC,MAAMq8B,OAAOl3C,UAAU,EAAG,GAAK,KACxC2+C,EAAS9jC,MAAMq8B,SAEjB,IAAIsH,GAAOf,MAAOkB,EAASpxE,OAAO4pE,cAChCwH,EAAS9jC,MAAMq8B,OAAOl3D,IAAI,QAC1B2+D,EAAS9jC,MAAMq8B,OAAOl3D,IAAI,QAAQggB,UAAU,EAAG,GAAK,KACpD2+C,EAAS9jC,MAAMq8B,OAAOl3D,IAAI,kBAEqC,WAA5D05B,EAAQilC,EAAS9jC,MAAMq8B,QAAQhwC,WAAW74B,cAC/C,IAAImwE,GAAOf,MAAOkB,EAASpxE,OAAO4pE,cAAgBwH,EAAS9jC,MAAMq8B,OAC/DyH,EAAS9jC,MAAMq8B,OAAOl3C,UAAU,EAAG,GAAK,KACxC2+C,EAAS9jC,MAAMq8B,SACjB,IAAIsH,GAAOf,MAAOkB,EAASpxE,OAAO4pE,cAChCwH,EAAS9jC,MAAMq8B,OAAOl3D,IAAI,QAC1B2+D,EAAS9jC,MAAMq8B,OAAOl3D,IAAI,QAAQggB,UAAU,EAAG,GAAK,KACpD2+C,EAAS9jC,MAAMq8B,OAAOl3D,IAAI,oBAErB2+D,EAAS9jC,MAAM4qC,WAGxB3C,EAAgB,OACF,KAChBC,EAAa,OACA,KACbhpC,EAAY,KACZylC,EAAc,KACdG,EAAc,KACdF,EAAa,OACA,KACbkB,EAAa,KACbf,EAAa,KACbC,EAAa,KACbC,EAAa,KACbC,EAAa,KACba,EAAa,KACbZ,EAAa,KACbE,EAAW,QACA,KACX0F,GAAc,KACdlF,GAAgB,QACC,KACjBwB,GAAW,KACXF,GAAe,KACf/hB,GAAO,QACK,QACA,QACA,QACF,QACgC,mBAAlBye,EAAW,GAAoBA,EAAW,GAAK,KACvEiH,GAAwC,mBAAlBjH,EAAW,GAAoBA,EAAW,GAAK,KACrExM,GAA0C,mBAAlBwM,EAAW,GAAoBA,EAAW,GAAK,OAEvE9qC,QAAO,EAAMu+B,kGAlGHviD,KAAK,kBAAkB45B,OAAO,QAASs4B,MAClCt4B,OAAO,QAASu4B,MAClBv4B,OAAO,QAAS+oB,MACpB/oB,OAAO,QAAS8oB,GACrBqM,EAASpxE,OAAOuxE,gBACRt1B,OAAO,QAAS24B,MAClB34B,OAAO,YAAam5B,KACtBjT,KAAO,QAEL9/C,KAAK,eAAe45B,OAAO,QAAS45B,KAChC,OACA,OACD,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACA,OACJyC,YACE,QACFA,aACE,QACCA,aACE,QACE,QACC,QACN,QACI,QACR,QACU,QACA,QACF,OACLnT,KAAK,QACV,IAAInzD,EAAI,EAAGA,EAAIk/D,EAAKjxE,OAAQ+R,IAC3Bk/D,EAAKl/D,KAAO4yD,KACTr7D,OAAOyI,EAAG,QAsEhBvI,KAAKm7D,cACC,aACE/hD,KAAK+hD,IACf,QAoFLnzD,GAAG+3D,QAAQjyC,wBAEF,mBAEC,oBAEE,YACA,qBAIL,iBACA,mBAEO,cACA,gBACE,iBACE,oBACE,eAGZ,WACE,IAAI05C,GAAOf,KAAM,yBAEvB,IAAIe,GAAQ91D,EAAG,IAAKwC,EAAG,GAAIkR,EAAG,MAC9B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,GAAIkR,EAAG,MAC9B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,MAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,KAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,KAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,EAAGkR,EAAG,MAC7B,IAAIoiD,GAAQ91D,EAAG,GAAIwC,EAAG,GAAIkR,EAAG,MAC7B,IAAIoiD,GAAQ91D,EAAG,GAAIwC,EAAG,GAAIkR,EAAG,MAC7B,IAAIoiD,GAAQ91D,EAAG,GAAIwC,EAAG,IAAKkR,EAAG,MAC9B,IAAIoiD,GAAQ91D,EAAG,GAAIwC,EAAG,IAAKkR,EAAG,KAC9B,IAAIoiD,GAAQ91D,EAAG,GAAIwC,EAAG,IAAKkR,EAAG,KAC9B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,EAAGkR,EAAG,KAC7B,IAAIoiD,GAAQ91D,EAAG,GAAIwC,EAAG,GAAIkR,EAAG,MAC7B,IAAIoiD,GAAQ91D,EAAG,GAAIwC,EAAG,GAAIkR,EAAG,MAC7B,IAAIoiD,GAAQ91D,EAAG,GAAIwC,EAAG,IAAKkR,EAAG,MAC9B,IAAIoiD,GAAQ91D,EAAG,GAAIwC,EAAG,IAAKkR,EAAG,KAC9B,IAAIoiD,GAAQ91D,EAAG,GAAIwC,EAAG,IAAKkR,EAAG,KAC9B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,EAAGkR,EAAG,KAC7B,IAAIoiD,GAAQ91D,EAAG,GAAIwC,EAAG,GAAIkR,EAAG,MAC7B,IAAIoiD,GAAQ91D,EAAG,GAAIwC,EAAG,GAAIkR,EAAG,MAC7B,IAAIoiD,GAAQ91D,EAAG,GAAIwC,EAAG,IAAKkR,EAAG,MAC9B,IAAIoiD,GAAQ91D,EAAG,GAAIwC,EAAG,IAAKkR,EAAG,KAC9B,IAAIoiD,GAAQ91D,EAAG,GAAIwC,EAAG,IAAKkR,EAAG,KAC9B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,EAAGkR,EAAG,KAC7B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,GAAIkR,EAAG,MAC9B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,GAAIkR,EAAG,MAC9B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,MAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,KAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,KAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,EAAGkR,EAAG,KAC7B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,GAAIkR,EAAG,MAC9B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,GAAIkR,EAAG,MAC9B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,MAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,KAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,KAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,EAAGkR,EAAG,KAC7B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,GAAIkR,EAAG,MAC9B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,GAAIkR,EAAG,MAC9B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,MAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,KAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,KAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,EAAGkR,EAAG,KAC7B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,GAAIkR,EAAG,MAC9B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,GAAIkR,EAAG,MAC9B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,MAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,KAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,KAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,EAAGkR,EAAG,KAC7B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,GAAIkR,EAAG,MAC9B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,GAAIkR,EAAG,MAC9B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,MAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,KAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,KAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,EAAGkR,EAAG,KAC7B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,GAAIkR,EAAG,MAC9B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,GAAIkR,EAAG,MAC9B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,MAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,KAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,KAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,EAAGkR,EAAG,KAC7B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,GAAIkR,EAAG,MAC9B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,GAAIkR,EAAG,MAC9B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,MAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,KAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,KAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,EAAGkR,EAAG,IAC7B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,GAAIkR,EAAG,MAC9B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,GAAIkR,EAAG,MAC9B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,MAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,KAC/B,IAAIoiD,GAAQ91D,EAAG,IAAKwC,EAAG,IAAKkR,EAAG,KAC/B,IAAIoiD,uBAIM,mCAEH,WACC,gBAEA,qBACC,UACC,qBAIH,UACC,gBAEA,wBACC,UACC,iBAIJ,mBACC,UACC,+BAKD,wCACG,mBACI,aACV,YACI,qCAII,4DACI,iDAGV,wCACI,kDAGD,8CACE,kEAGF,qDACE,gEAGF,gDACE,yDAGF,8CACE,wDAGF,gDACE,yDAGF,+CACE,yDAGF,gDACE,0DAGA,gEACF,kDAKRtkE,IEz/DP4rE,OAAO,SAAC5rE,EAAGozC,UAAOA,EAAGpzC,IAAIC,QAQtBD,GAAEu3D,mBAAmB72D,SADP,sBAEf62D,mBAAmBz6D,KAFJ,kBAKfkD,GAAEu3D,mBAAmBxtD,KAAK,SAAClN,UACrB2I,MAAMC,QAAQ5I,IAFR,oBAEiBA,EAAK,SAElC06D,mBAAmBz6D,MAJP,mBAIuB+uE,SAAS,KAUhD/f,GAAO8T,WAAa,EAIpB9T,GAAOggB,eAAiB,EAIxBhgB,GAAOigB,aAAc,EAIrBjgB,GAAOkgB,iBAAkB,EAIzBlgB,GAAOmgB,qBAAsB,EAE7B,IAAMC,MAsBJC,SAKQ,YAKI,cACE,gBACF,YAEA,0BAGQ,sBACE,GAMtBC,IACE,mBACA,oBACA,cACA,kBACA,iBACA,yBACA,iBACA,iBACA,gBACA,cACA,kBAoEFC,eACc,2BACM,kBAET,iBACE,qBAGF,QACA,iBACE,sBAGK,YACH,eACE,qBAEF,iBACG,cACN,0BACQ,iBACP,cACC,mBACK,UAGR,mBACC,kBACD,wBACE,mBACA,sBACG,4BACC,gCAGF,IAAK,mBAGJ,YACH,gBACD,kBACI,eACF,uBAES,4BACK,kBAEV,uBACK,YAEX,mBAEO,gBACH,yBACS,MAObvgB,GAAO17C,aAEjBk8D,UAAW95B,UACbwiB,IAAU,EACVuX,IAAoB,EACpBC,IAAkB,EAClBC,MAIA3sC,oDAsBF,SAAS4sC,GAAe5lE,EAAKkrC,OACrB26B,GAA0C,IAAhCL,GAAUr2B,aAAanvC,KAC5BkrC,GAAYhyC,GAAE4sE,KACrBD,KACO,MAEP1pE,MAAMmN,GAAUynC,aAAag1B,gBAAiB,cACrC,KAWf,SAASC,UAAkBC,IAAAA,YAAaC,IAAAA,8DAO/B,kDACL,WAA6BC,iGACZntC,GAAUotC,sBAAqBj5E,MAAQg5E,0BAC/CphB,GAAuBpgC,sCACQx3B,MAAQg5E,gKAJbh5E,KAAAA,aAAO+4E,QAAaC,KAAAA,aAAOF,qHAQrD3nC,EAAa6nC,6DAEb7nC,EAAa,qHAqBxBsmB,KAAO,SAAU1mD,EAAKc,UAClBA,MACOd,GAAOc,UAMT2mE,SAAWA,KAGZznE,KAAOynE,GAAYA,GAASznE,GAAOmnE,GAAannE,IAQ1D8mD,GAAOR,UAAYA,GACnBQ,GAAOhJ,SAAWA,GAClBgJ,GAAOlJ,WAAaA,GAepBkJ,GAAOqhB,oBAAsB,cACtBrtC,GAAUstC,eACZttC,GAAUutC,iBACN35E,SAAS45E,OAAOtmE,MAAM,qDAOzB8kD,GAAOyhB,aACEH,eACPttC,GAAUutC,iBACV35E,SAAS45E,OAAOtmE,MAAM,oCAE1B,KACM/S,EAAO,WAAa6rC,GAAU0tC,WAC9BC,EAAS3hB,GAAOyhB,QAAQ5pE,QAAQ1P,GAClCw5E,MACKC,eAAeD,OAKrB,IAAMzoE,KAAOmnE,MACZA,GAAat3D,eAAe7P,GAAM,KAC9B2oE,EAAW,YAAc3oE,KAC3B8mD,GAAOyhB,QAAS,KACZznE,EAAMgmD,GAAOyhB,QAAQ5pE,QAAQgqE,GAC/B7nE,OACWd,GAAO8e,OAAOhe,SAExB,GAAIzS,OAAOikE,UACHtyD,GAAO3R,OAAOikE,OAAOsW,iBAAiBD,OAC9C,KACCzjE,EAASxW,SAAS45E,OAAOtmE,MAAM,IAAIgD,OAAO,edyzBnBlD,EczzBqDsd,mBAAmBupD,Gd2zBpG7pD,OAAOhd,GAAKG,QAAQ,IAAI+C,OAAO,oCAAqC,KAAM,Sc3zBuC,gBACrGhF,GAAOkF,EAAS+Z,mBAAmB/Z,EAAO,IAAM,IdwzB1C,IAAUpD,Ic9xBrCglD,GAAOhU,UAAY,SAAUhF,EAAM+6B,YAExBC,EAAaC,EAAQ/oE,EAAKc,GAC7BioE,EAAO/oE,IAA+B,WAAvBw6B,EAAOuuC,EAAO/oE,OAC7B00B,QAAO,EAAMq0C,EAAO/oE,GAAMc,KAErBd,GAAOc,IALT+nE,SAQP98D,KAAK+hC,EAAM,SAAU9tC,EAAKc,MACtBgtC,EAAKj+B,eAAe7P,MAElBmnE,GAAat3D,eAAe7P,GAAM,KACX,IAArB6oE,EAAOG,YACTluC,GAAUmuC,qBACVxB,GAAS53D,eAAe7P,YAIc,IAApC6oE,EAAOK,4BACIlpE,GAAOc,KAElB4lD,KAAK1mD,EAAKc,QAET,IAAK,aAAc,cAAe,kBAAkBpF,SAASsE,GAAM,KAC/C,IAArB6oE,EAAOG,YAEPluC,GAAUmuC,sBACT,iBAAkB,eAAevtE,SAASsE,IAClC,eAARA,GAAwB86B,GAAUquC,0BAK7BnpE,GAAO86B,GAAU96B,GAAKwsD,OAAO1rD,QAElC,GAAIumE,GAAcx3D,eAAe7P,GAAM,KACnB,IAArB6oE,EAAOG,YACTluC,GAAUmuC,qBACVnuC,GAAUjrB,eAAe7P,cAKvB86B,GAAUjrB,eAAe7P,GAAM,KACR,IAArB6oE,EAAOG,mBAGCluC,GAAW96B,EAAKc,QAEY,IAApC+nE,EAAOK,2BACG7B,GAAernE,EAAKc,GAE5BumE,GAAcrnE,IAAsC,WAA9Bw6B,EAAO6sC,GAAcrnE,QACnCA,SACR00B,QAAO,EAAMoG,GAAU96B,GAAMc,OAErBd,GAAOc,QAYtBg6B,UAAYA,IAuDrBgsB,GAAOsiB,kBAAoB,SAAUt7B,MAC5Bu7B,MAAM,WACPv7B,EAAKF,UACL,mCAAmCvwC,YACnC,cAAc0U,UACN67B,KAAOE,EAAKF,MAEpBE,EAAKD,UACAm5B,iBAAkB,KACfrwE,KAAK,QAASm3C,EAAKD,OAE3BC,EAAKw7B,iBACax7B,EAAKw7B,eACf3yE,KAAK,WAAY4wE,KAEzBz5B,EAAKgB,eACWhB,EAAKgB,aACbn4C,KAAK,cAAe6wE,QASpC1gB,GAAO73B,aAAe,SAAUqP,UACvBgpC,GAAUr4C,aAAaqP,IAOhCwoB,GAAOj7C,KAAO,aACa,cAAexd,QACrCA,OAAOy4B,YACqB,IAA7Bz4B,OAAOy4B,UAAUC,iBAEVxb,OAAO87D,aACF,0BACD,gCACE,qBACA,iBAQT,iBAAkBh5E,YAUbk6E,QAAUhvB,cAEnB,MAAO98C,QAGH+pD,cAUG+iB,QACKvuE,GAAE05B,QAAO,KAAU2yC,GAAevsC,KAG/B0uC,yBACHxpC,WAAalF,GAAUkF,WAAWwsB,OAAO4a,MAGpD,aAAc,cAAe,kBAAkBp4E,QAAQ,SAAU2qE,MACtDA,GAAO3+D,GAAEyuE,KAAK3uC,GAAU6+B,GAAM,SAAU1+C,EAAG5a,UAC5CA,IAAMy6B,GAAU6+B,GAAKznD,QAAQ+I,UAIjC6f,UAAYA,MAvBnB,uBAAuB/uB,KAAK,aAClBjU,KAAKpI,KAAKuQ,wBA0BhB0nB,SAAK+hD,eACC1uE,GAAEiyD,QAAQ0c,aAAY,GAC3B3uE,GAAE4uE,cAAcp8B,WAyDZ26B,0BAzDsB,IACzB36B,GAAQnT,gBACFA,WAAamT,GAAQnT,WAAWl4B,MAAM,MAG5CqrC,GAAQq8B,gBACFA,WAAa,IAAMr8B,GAAQq8B,YAGjCr8B,GAAQxN,gBAEFA,WAAawN,GAAQxN,WAAWh+B,MAAM,UAAY,GAAKwrC,GAAQxN,WAAW79B,MAAM,OAQxF,UAAW,UAAW,eAAgB,YACtC,WAAY,gBAAiB,aAC7BnT,QAAQ,SAAU86E,GACdt8B,GAAQs8B,WACHt8B,GAAQs8B,QAIZh3B,UAAUtF,IAAUw7B,WAAW,SAIjCluC,GAAUivC,yBAA0B,MACjCv8B,GAAQhzC,SACPQ,GAAE+wD,MAAM4d,cACVhiD,GACC+hD,EAAKhuE,SAAS,oBACVguE,EAAK1nE,MAAM,uBAAuB,IAGxC2lB,cACEA,EAAI5Q,WAAW,YACVizD,gBAAgBriD,MAEhB+gD,eAAe/gD,OAItB6lB,GAAQ/mB,mBACHwjD,YAAYz8B,GAAQ/mB,KAI1B+mB,GAAQ66B,kBAAmBvtC,GAAUstC,iBACjCD,yBA7EAntE,GAAE05B,QAAO,KAAUyyC,GAAcM,OAErCA,SAAWA,YA2FdlX,EAAUzJ,GAAOyJ,QAAU,SAAUjwD,EAAM4pE,EAAQC,OACjD3Z,EAA0B,iBAAX0Z,EAAuBlvE,GAAEk3D,WAAWgY,GAAQ,GAAQA,EAAOvyE,QAC3E64D,KAIHlwD,GAAM+oB,QAAQrsB,OAAOwzD,WAHb7pD,IAAI,6BAA+BujE,IAazCE,+BAAmB,6HAEatjB,GAAOR,UAAU,KAAME,EAAW1rB,+BAA/D6iB,cAAWI,YACVJ,EAAWI,qBAGX72B,QAAQC,IACZ2T,GAAUkF,WAAWvxB,+CAAI,WAAO47D,yGACdA,EAAQroE,MAAM,2EAIlB84B,GAAUotC,QAAUmC,oBAaPxjB,GAAuBpgC,UACpC,sBAAwB6jD,EAAQ,GAAGroE,QAAQ,KAAM,gCAEzBsoE,EAA3Bt7E,KAAAA,aAAOq7E,EAAQ,KAAIz+D,EAAQ0+D,EAAR1+D,OACLi8D,IAAiBC,YAAapqB,EAAWqqB,YAAa/4E,sBACpE63D,GAAO5mB,aAAajxC,EAAO4c,GAAQA,EAAKlV,KAAKmwD,IAAU1mB,8CAEtDz5B,kBACA2pD,MAAM,6BAA+B+Z,EAAU,kIAInD1zE,KAAK,4BAOZglE,EAAKp5C,OACc,KACVioD,YAEN,6BAA6Bz+D,KAAK,cAChCrc,MAAMsN,OAAOhC,GAAEk3D,WAAW,eAAe,GAAMr0D,MAAM,GAAGJ,OAAO,SAEtDzO,iBAMVy7E,MACWv5D,KAAK,UAAWu5D,UAKxBv5D,KAAK,8EAEPvK,8GAINg0D,GAAYC,WAAY9T,GAAO8T,YAE/B8P,EAAqB,cACvB,iBAAiB3+D,KAAK,eAChB4+D,EAAS3vE,GAAE,IAAMtL,KAAKqT,GAAK,WACb4nE,EAAO7lD,SAApBwgB,IAAAA,KAAMH,IAAAA,IACP57B,EAAIohE,EAAOC,gBACfl7E,MAAM+6C,KAAKnF,MAAOA,EAAO/7B,GAAKu9C,GAAO8T,WAAYz1B,WAIjD0lC,EAAY,eACVC,EAAQ,yCACRC,EAAar8E,SAASgxC,qBAAqB,UAAU,OACtD,IAAMhxB,KAAQq8D,EAAW7sE,SACxB4sE,EAAM7lE,KAAKyJ,UAGNA,EAAK1M,MAAM8oE,GAAO,SAIzB,kBAAmBC,EAAW7sE,MAAgB,SAC9C,iBAAkB6sE,EAAW7sE,MAAgB,QAE1C,GAdS,GAuDZ8sE,EAAclkB,GAAOkkB,YAAc,SAAU3Y,OAE3C4Y,EAAa,4MAIbzjE,EAAQxM,GAAEiwE,GAEZr1C,EAAQ,KACQ,iBAATy8B,IACDA,MACH,IACcrmD,EAAG,IAAM/K,EAAG,EAAGqI,EAAG,KAAM4hE,GAAI,KAC7B7Y,KAGXuI,WAAa9T,GAAO8T,WAAahlC,UAYpCu1C,EAAW3jE,EAAMyqC,QAAQ,aACtBxH,IAAI,aAAc,UAAU14B,OAnEjB,SAAUvK,EAAOouB,OAE/Bw1C,GAAS,MAAO,OAAQ,SAAU,WAElCr/D,KAAK,mBAGH4iB,EAAK3zB,GAAEtL,MACP6Z,EAAIolB,EAAGi8C,cAAgBh1C,EAAQ,GAC/BpsB,EAAImlB,EAAG08C,eAAiBz1C,EAAQ,GAG7Bv1B,EAAI,EAAGA,EAAI,EAAGA,IAAK,KACpB2L,EAAIo/D,EAAM/qE,GACZuS,EAAM+b,EAAGpM,KAAK,eAAiBvW,GACxB,MAAP4G,MACIzI,SAASwkB,EAAG8b,IAAI,UAAYz+B,GAAI,MAEnCuW,KAAK,eAAiBvW,EAAG4G,QAE1B9R,EAAM8R,EAAMgjB,EACN,UAAN5pB,KACKzC,EACQ,WAANyC,OACFxC,KAGNihC,IAAI,UAAYz+B,EAAGlL,OAyCZ0G,EAAOouB,KACZ6U,IAAI,aAAc,WAAWgE,UAGpCiY,KAAK,WAAY2L,MACjB,aAAavxD,IAAIuxD,OAmBbiZ,sBAqBI,GAAKtwE,GAAE,gBAAgB6C,eACrB,yBAGD,OACF,yBAGC,OACD,KAsFL0tE,EAAWvwE,GAAE,uBACZuwE,EAASj9E,SAGH+6B,UAFEruB,GAAE,wCAAwCkgC,SAAS,QAKnD,MAATm3B,EAAc,KACZmZ,EAAW,MACbz/D,KAAKu/D,EAAgB,SAAU9pC,EAAUiqC,KAC9B,eAAiBjqC,EAASv/B,QAAQ,KAAM,oBACvCu/B,EAAW,OACrBz1B,KAAK0/D,EAAO,SAAU/8D,EAAMlM,OACxB1B,SACkB,iBAAX0B,IACFA,EAASozB,EAAS,MAChBpzB,EAAO6vD,IAAS7vD,EAAO2kB,SACzB3kB,EAAO6vD,IAAS7vD,EAAO2kB,QAEnBzY,EAAO,IAAM5N,EAAM,SAEtB,UAGR4qE,EAAS,IAAMb,EAAS17E,cAAgB,OACjC87E,EAAa,IAAMS,EAAS,oBAAsB91C,EAAQ,yCAC7B81C,EAAS,yEACnBA,EAAS,oBAAuB,EAAI91C,EAAS,QAEpE34B,KAAKuuE,WAKhB7c,SAAS7zB,GAAUV,QAAU,wBAC1B,GAAI5wB,EAAG,aACA,UACDnK,kBACMy7B,GAAUV,uBAEjB,kBAEE,yBACK,yBAEL,kBACF,mBACG,6BACD,qBACC,yBACG,6BACJ,iBACH,gBACC,gBACA,uBACO,6BACD,0BACD,qBAEJ,iBACD,uBAEO,8BACI,iCACL,oBACN,kBACE,qBACC,wBAEE,iBACL,kBACE,kBACF,kBACE,sBACE,iCACF,uBACG,qBAEL,gBACA,iBAEC,mBACC,mBACD,oBACE,2BACK,+BACD,2BACH,uBACD,4BACM,6BACL,8BACM,mCAEP,+BACG,uBACL,mBACC,sBACE,qBACH,iBACD,oBACI,qBACH,uBAEK,8BACE,+BACD,4BACF,6BACG,gCACA,gCAEA,kCACE,mCACD,mCACC,oCACA,oCACA,yBACX,mBACK,kBAEN,kBACI,qBACC,0BAEI,6BACD,4BAEA,qCAGH,oCAEqB,6BACZ,0BACE,8BACE,8BACE,wBACR,gCACQ,6BACL,yBAEL,oBACA,sBAEE,wBACA,sBACF,oCACiB,sBACf,wBACA,8CACqB,yBACrB,2BACG,0BACL,kCACc,qBACb,qBACD,uCAEmB,2BACb,6DAC6B,6BAC5B,kCACA,qCACG,6BACN,+BACG,6BACL,4BACG,iCACD,kCACM,iCACP,6BACG,8CAEc,kDACI,kDACF,6CACJ,iDACM,oDACA,+BACrB,qCAEa,gCACZ,kCACC,iDAEc,mCACd,mCACA,+BAEJ,sBAEF,sBACE,4BACI,wCACO,+DAEgC,oEACM,sCAElC,uCACE,mCACL,yBACZ,2DACqC,0BACtC,0BACM,kCACQ,+BACL,uBACT,yBACK,iCAEI,yDACqB,kEACU,sCAGnC,mCACc,8DAC4B,gCAC/B,qCACM,kCACH,8CACW,sCACR,oCACF,mCACD,sBAEzBuxC,MACN,8DAA8D5/D,KAAK,cACjErc,MAAM4W,SAAS2sC,QAAQvjD,YAGrBk8E,EAAQ5wE,GAAE,eAEZ6wE,SACAD,EAAMt9E,WACIs9E,EAAM9mD,SAASqgB,IAAMymC,EAAMP,mBAGnChZ,EAAOr3D,GAAE0rD,KAAK,qBAiBXolB,EAAuBC,UACtBA,OACH,mCACI,MACJ,qCACI,M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"}